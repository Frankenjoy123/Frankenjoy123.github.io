<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="单节点"><a href="#单节点" class="headerlink" title="单节点"></a>单节点</h2><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><blockquote>
<p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#a-simple-example">http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#a-simple-example</a></p>
</blockquote>
<h3 id="上传解压"><a href="#上传解压" class="headerlink" title="上传解压"></a>上传解压</h3><pre><code>scp apache-flume-1.6.0-bin.tar.gz root@node02:/root
tar -zxvf apache-flume-1.6.0-bin.tar.gz
mv apache-flume-1.6.0-bin/ /usr/install/
</code></pre><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><pre><code>vi /etc/profile
source /etc/profile
</code></pre><pre><code>export FLUME_HOME=/usr/install/apache-flume-1.6.0-bin
export PATH=$PATH:$ZOOKEEPER_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$HIVE_HOME/bin:$HBASE_HOME/bin:$FLUME_HOME/bin
</code></pre><h3 id="修改conf-flume-env-sh-文件中的JDK目录"><a href="#修改conf-flume-env-sh-文件中的JDK目录" class="headerlink" title="修改conf/flume-env.sh  文件中的JDK目录"></a>修改conf/flume-env.sh  文件中的JDK目录</h3><pre><code>cp flume-env.sh.template flume-env.sh
vi flume-env.sh
</code></pre><pre><code>export JAVA_HOME=/usr/install/jdk/jdk1.8.0_171
</code></pre><h3 id="验证安装是否成功"><a href="#验证安装是否成功" class="headerlink" title="验证安装是否成功"></a>验证安装是否成功</h3><pre><code>flume-ng version
</code></pre><h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><pre><code>cd conf/
vi simple.conf
</code></pre><pre><code>
# Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = netcat
a1.sources.r1.bind = node02
a1.sources.r1.port = 44444

# Describe the sink
a1.sinks.k1.type = logger

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre><h3 id="启动flume"><a href="#启动flume" class="headerlink" title="启动flume"></a>启动flume</h3><pre><code>flume-ng agent -n a1 -c conf -f simple.conf -Dflume.root.logger=INFO,console
</code></pre><h3 id="发送数据"><a href="#发送数据" class="headerlink" title="发送数据"></a>发送数据</h3><pre><code>telnet node02 44444
</code></pre><h2 id="两个flume做集群"><a href="#两个flume做集群" class="headerlink" title="两个flume做集群"></a>两个flume做集群</h2><h3 id="参考文档-1"><a href="#参考文档-1" class="headerlink" title="参考文档"></a>参考文档</h3><blockquote>
<p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#setting-multi-agent-flow">http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#setting-multi-agent-flow</a></p>
</blockquote>
<h3 id="右侧节点-node03"><a href="#右侧节点-node03" class="headerlink" title="右侧节点(node03)"></a>右侧节点(node03)</h3><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><blockquote>
<p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-source">http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-source</a></p>
</blockquote>
<pre><code>vi double-flume.conf
</code></pre><pre><code># Name the components on this agent
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = avro
a1.sources.r1.bind = node03
a1.sources.r1.port = 60000

# Describe the sink
a1.sinks.k1.type = logger

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre><h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><pre><code>flume-ng agent  -n a1 -c conf -f double-flume.conf -Dflume.root.logger=INFO,console
</code></pre><h3 id="左侧节点-node02"><a href="#左侧节点-node02" class="headerlink" title="左侧节点(node02)"></a>左侧节点(node02)</h3><h4 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h4><blockquote>
<p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-sink">http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-sink</a></p>
</blockquote>
<pre><code>scp -r apache-flume-1.6.0-bin/ root@node03:/usr/install
</code></pre><pre><code>vi double-flume.conf
</code></pre><pre><code>a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = netcat
a1.sources.r1.bind = node02
a1.sources.r1.port = 44444

# Describe the sink
a1.sinks.k1.type = avro
a1.sinks.k1.hostname = node03
a1.sinks.k1.port = 60000


# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre><h4 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h4><pre><code>flume-ng agent  -n a1 -c conf -f double-flume.conf -Dflume.root.logger=INFO,console
</code></pre><h3 id="发送数据-1"><a href="#发送数据-1" class="headerlink" title="发送数据"></a>发送数据</h3><pre><code>telnet node02 44444
</code></pre><h2 id="Exec-Source方式，监控文件tail命令"><a href="#Exec-Source方式，监控文件tail命令" class="headerlink" title="Exec Source方式，监控文件tail命令"></a>Exec Source方式，监控文件tail命令</h2><h3 id="参考-2"><a href="#参考-2" class="headerlink" title="参考"></a>参考</h3><blockquote>
<p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#exec-source">http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#exec-source</a></p>
</blockquote>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><pre><code>vi exec.conf
</code></pre><pre><code>a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = exec
a1.sources.r1.command = tail -F /root/test.txt

# Describe the sink
a1.sinks.k1.type = logger

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre><h3 id="启动-2"><a href="#启动-2" class="headerlink" title="启动"></a>启动</h3><pre><code>flume-ng agent -n a1 -c conf -f exec.conf -Dflume.root.logger=INFO,console
</code></pre><h3 id="添加数据"><a href="#添加数据" class="headerlink" title="添加数据"></a>添加数据</h3><p>循环添加数据</p>
<pre><code>for i in {1..50}; do echo &quot;$i hi flume&quot; &gt;&gt; /root/test.txt ; sleep 0.1; done
</code></pre><h2 id="Spooling-Directory-Source监控目录"><a href="#Spooling-Directory-Source监控目录" class="headerlink" title="Spooling Directory Source监控目录"></a>Spooling Directory Source监控目录</h2><h3 id="参考-3"><a href="#参考-3" class="headerlink" title="参考"></a>参考</h3><blockquote>
<p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#spooling-directory-source">http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#spooling-directory-source</a></p>
</blockquote>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><pre><code>vi spool.conf
</code></pre><pre><code>a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = spooldir
a1.sources.r1.spoolDir = /root/logs
a1.sources.r1.fileHeader = true

# Describe the sink
a1.sinks.k1.type = logger

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre><h3 id="启动-3"><a href="#启动-3" class="headerlink" title="启动"></a>启动</h3><pre><code>flume-ng agent -n a1 -c conf -f spool.conf -Dflume.root.logger=INFO,console
</code></pre><h3 id="拷贝文件演示"><a href="#拷贝文件演示" class="headerlink" title="拷贝文件演示"></a>拷贝文件演示</h3><pre><code>mkdir logs
mv aa logs/
</code></pre><h2 id="flume和kafka"><a href="#flume和kafka" class="headerlink" title="flume和kafka"></a>flume和kafka</h2><p>两者经常配对使用，谁在前后都可以</p>
<h2 id="hdfs-sink方式"><a href="#hdfs-sink方式" class="headerlink" title="hdfs sink方式"></a>hdfs sink方式</h2><h3 id="参考-4"><a href="#参考-4" class="headerlink" title="参考"></a>参考</h3><blockquote>
<p><a href="http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hdfs-sink">http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hdfs-sink</a></p>
</blockquote>
<h3 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h3><pre><code>vi hdfs-sink.conf
</code></pre><pre><code>
a1.sources = r1
a1.sinks = k1
a1.channels = c1

# Describe/configure the source
a1.sources.r1.type = spooldir
a1.sources.r1.spoolDir = /root/logs
a1.sources.r1.fileHeader = true

# Describe the sink 文件目录格式
a1.sinks.k1.type=hdfs
a1.sinks.k1.hdfs.path=hdfs://mycluster/flume/%Y-%m-%d/%H%M

##每隔60s或者文件大小超过10M的时候产生新文件，roll对文件设置
# hdfs有多少条消息时新建文件，0不基于消息个数
a1.sinks.k1.hdfs.rollCount=0
# hdfs创建多长时间新建文件，0不基于时间
a1.sinks.k1.hdfs.rollInterval=60
# hdfs多大时新建文件，0不基于文件大小
a1.sinks.k1.hdfs.rollSize=10240
# 当目前被打开的临时文件在该参数指定的时间（秒）内，没有任何数据写入，则将该临时文件关闭并重命名成目标文件
a1.sinks.k1.hdfs.idleTimeout=3

a1.sinks.k1.hdfs.fileType=DataStream
a1.sinks.k1.hdfs.useLocalTimeStamp=true

## 每五分钟生成一个目录，round对目录设置
# 是否启用时间上的”舍弃”，这里的”舍弃”，类似于”四舍五入”，后面再介绍。如果启用，则会影响除了%t的其他所有时间表达式
a1.sinks.k1.hdfs.round=true
# 时间上进行“舍弃”的值；
a1.sinks.k1.hdfs.roundValue=5
# 时间上进行”舍弃”的单位，包含：second,minute,hour
a1.sinks.k1.hdfs.roundUnit=minute

# Use a channel which buffers events in memory
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

# Bind the source and sink to the channel
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre><h3 id="启动-4"><a href="#启动-4" class="headerlink" title="启动"></a>启动</h3><pre><code>flume-ng agent -n a1 -c conf -f hdfs-sink.conf -Dflume.root.logger=INFO,console
</code></pre><h3 id="拷贝文件演示-1"><a href="#拷贝文件演示-1" class="headerlink" title="拷贝文件演示"></a>拷贝文件演示</h3><pre><code>mkdir logs
mv aa logs/
</code></pre><h2 id="tengine和flume集成项目"><a href="#tengine和flume集成项目" class="headerlink" title="tengine和flume集成项目"></a>tengine和flume集成项目</h2><h3 id="配置-3"><a href="#配置-3" class="headerlink" title="配置"></a>配置</h3><pre><code>vi tengine_project.conf
</code></pre><pre><code>a1.sources = r1
a1.sinks = k1
a1.channels = c1


## 监听tengine的access log文件
a1.sources.r1.type = exec
a1.sources.r1.command = tail -F /opt/data/access.log

a1.sinks.k1.type=hdfs
a1.sinks.k1.hdfs.path=hdfs://mycluster/log/%Y%m%d
a1.sinks.k1.hdfs.rollCount=0
a1.sinks.k1.hdfs.rollInterval=0
a1.sinks.k1.hdfs.rollSize=10240
a1.sinks.k1.hdfs.idleTimeout=5
a1.sinks.k1.hdfs.fileType=DataStream
a1.sinks.k1.hdfs.useLocalTimeStamp=true
a1.sinks.k1.hdfs.callTimeout=40000

a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100

a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
</code></pre><h3 id="启动-5"><a href="#启动-5" class="headerlink" title="启动"></a>启动</h3><pre><code>flume-ng agent -n a1 -c conf -f tengine_project.conf -Dflume.root.logger=INFO,console
</code></pre><h3 id="拷贝文件演示-2"><a href="#拷贝文件演示-2" class="headerlink" title="拷贝文件演示"></a>拷贝文件演示</h3><pre><code>mkdir logs
mv aa logs/
</code></pre>