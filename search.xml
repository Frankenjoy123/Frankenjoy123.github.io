<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Dubboæºç åˆ†æžâ€”â€”NIO-æœåŠ¡å™¨ï¼ˆä¸€ï¼‰ä¹‹æŠ½è±¡API]]></title>
    <url>%2F2019%2F08%2F23%2FDubbo%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E2%80%94%E2%80%94NIO-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%B8%80%EF%BC%89%E4%B9%8B%E6%8A%BD%E8%B1%A1API%2F</url>
    <content type="text"><![CDATA[1. æ¦‚è¿°ä»Žæœ¬å°èŠ‚å¼€å§‹ï¼Œæˆ‘ä»¬æ¥åˆ†äº« Dubbo è‡ªå·±å®žçŽ°çš„ NIO æœåŠ¡å™¨ï¼Œä½¿ç”¨åœ¨ dubbo:// å’Œ thrift:// åè®®ä¸Šã€‚ åœ¨ NIO æ¡†æž¶çš„é€‰åž‹ä¸Šï¼Œå¼ºå¤§çš„ Java ç¤¾åŒºé‡Œæœ‰ minaã€nettyã€grizzly ç­‰ï¼Œç”šè‡³ netty æä¾›äº† 3.x å’Œ 4.x çš„ç‰ˆæœ¬ã€‚é‚£ä¹ˆè¯¥å’‹åŠžå‘¢ï¼Ÿ Dubbo å¼€å‘å›¢é˜Ÿçš„é€‰æ‹©æ˜¯ï¼š API å±‚ï¼š dubbo-remoting-api å®žçŽ°å±‚ï¼š dubbo-remoting-netty3 dubbo-remoting-netty4 dubbo-remoting-mina dubbo-remoting-grizzly dubbo-remoting-p2p å†é…åˆä¸Š Dubbo SPI çš„æœºåˆ¶ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªå®šä¹‰ä½¿ç”¨å“ªä¸€ç§å…·ä½“çš„å®žçŽ°ã€‚ 2. ä¸€è§ˆè¿˜æ˜¯è€æ ·å­ï¼Œç¬”è€…ä¹ æƒ¯æ€§å¯¹ä»£ç é‡è¿›è¡Œä¸‹ç»Ÿè®¡ï¼Œdubbo-remoting çš„ä»£ç é‡å¦‚ä¸‹å›¾ï¼š dubbo-remoting-api çš„ä»£ç é‡ç«Ÿç„¶è¿‘ä¸‡è¡Œï¼Ÿ æˆ‘ä»¬æ¥é¦–å…ˆçœ‹ä¸€å¼ å›¾ï¼š FROM ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ¡†æž¶è®¾è®¡ã€‹ çº¢æ¡†éƒ¨åˆ†ï¼ŒProtocol =&gt; Exchange =&gt; Transport =&gt; Serialize çš„è°ƒç”¨é¡ºåºã€‚ exchange ä¿¡æ¯äº¤æ¢å±‚ï¼šå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥ï¼Œä»¥ Request, Response ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æŽ¥å£ä¸º Exchanger, ExchangeChannel, ExchangeClient, ExchangeServerã€‚ transport ç½‘ç»œä¼ è¾“å±‚ï¼šæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æŽ¥å£ï¼Œä»¥ Message ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æŽ¥å£ä¸º Channel, Transporter, Client, Server, Codec serialize æ•°æ®åºåˆ—åŒ–å±‚ï¼šå¯å¤ç”¨çš„ä¸€äº›å·¥å…·ï¼Œæ‰©å±•æŽ¥å£ä¸º Serialization, ObjectInput, ObjectOutput, ThreadPool åœ¨ç¬”è€…åˆçœ‹ dubbo-remoting-api çš„ä»£ç æ—¶ï¼Œå¯¹ exchange å’Œ transport çš„ç†è§£æ˜¯æ¯”è¾ƒæ¨¡ç³Šçš„ã€‚ç®€å•æ¥è¯´ï¼Œexchange åœ¨ transport ä¹‹ä¸Šï¼Œæž„é€ äº† Requestï¼ŒResponse æ¨¡åž‹ï¼Œä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªå“åº”ã€‚è¿™æ ·çš„æ–¹å¼ï¼Œæ‰ç¬¦åˆæˆ‘ä»¬å®žé™…ä¸šåŠ¡å¼€å‘çš„éœ€è¦ã€‚å½“ç„¶ï¼Œå³ä½¿æ˜¯ Requestï¼ŒResponse ä¹Ÿåˆ†æˆåŒæ­¥å’Œå¼‚æ­¥è¿”å›žï¼Œé‡è¦çš„æ˜¯ï¼Œèƒ½å¤Ÿä¸€ä¸€æ˜ å°„ã€‚ å¦‚æžœæœ‰å…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹ï¼š ã€ŠRequestâ€“responseã€‹ ã€ŠClientâ€“server modelã€‹ çœ‹å®Œä»¥ä¸ŠçŸ¥è¯†ï¼Œæˆ‘ä»¬åœ¨å›žè¿‡å¤´çœ‹ dubbo-remoting-api çš„é¡¹ç›®ç»“æž„å°±æ¸…æ™°äº†ï¼š æœ€å¤–å±‚ï¼šé€šç”¨æŽ¥å£ã€‚ buffer åŒ…ï¼šç¼“å†²åŒºã€‚ exchange åŒ…ï¼šä¿¡æ¯äº¤æ¢å±‚ transporter åŒ…ï¼šç½‘ç»œä¼ è¾“å±‚ telnet åŒ…ï¼šTelnet å‘½ä»¤ å¦‚ä¸Šçš„æ¯ä¸€å±‚/åŒ…ï¼Œæˆ‘ä»¬éƒ½ä¼šç‹¬ç«‹ä¸€ç¯‡æ–‡ç« ï¼Œè¿›è¡Œåˆ†äº«ã€‚å½“ç„¶ï¼Œdubbo-remoting-api æ¨¡å—ï¼Œåªè´Ÿè´£ API å±‚æŠ½è±¡å’Œéƒ¨åˆ†å®žçŽ°ï¼Œæœ€ç»ˆèƒ½å¤ŸçœŸæ­£é€šä¿¡ï¼Œéœ€è¦ dubbo-remoting-netty ç­‰ç­‰æ¨¡å—æ¥å®žçŽ°ã€‚å¯¹åº”çš„æ¯ä¸€ä¸ªå®žçŽ°æ¨¡å—ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ç‹¬ç«‹ä¸€ç¯‡æ–‡ç« ã€‚ ðŸ™‚ æ˜¯ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œç¾Žæ»‹æ»‹ï¼Ÿ 3. æœ€å¤–å±‚ï¼šé€šç”¨æŽ¥å£å…ˆçœ‹çœ‹ ã€ŠNetty4.0å­¦ä¹ ç¬”è®°ç³»åˆ—ä¹‹ä¸€ï¼šServerä¸ŽClientçš„é€šè®¯ã€‹ æ•™ç¨‹æ–‡ç« ã€‚åœ¨è¯¥æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ Netty åœ¨å››ä¸ªç±»ï¼š 1ã€HelloServer ï¼šserverç±»ï¼Œå¯åŠ¨Netty server 2ã€HelloServerInHandlerï¼šserverçš„handlerï¼ŒæŽ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ 3ã€HelloClientï¼šclientç±»ï¼Œå»ºç«‹äºŽNetty serverçš„è¿žæŽ¥ 4ã€HelloClientIntHandlerï¼šclientçš„handlerï¼ŒæŽ¥æ”¶serverç«¯çš„æ¶ˆæ¯ï¼Œå¹¶å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ æ°å¥½ï¼Œå’Œ dubbo-remoting-api æ¨¡å—ï¼Œå®šä¹‰çš„ Serverã€Clientã€ChannelHandler æŽ¥å£å¯¹åº”ã€‚æˆ‘ä»¬ä»¥ dubbo-remoting-netty4 æ¨¡å—çš„ï¼Œä¸¾ä¾‹å­ã€‚æ•´ç†å¦‚ä¸‹ï¼š ä¸Šæ–‡ dubbo-remoting-api dubbo-remoting-netty4 HelloServer Server æŽ¥å£ NettyServer å®žçŽ°ç±» HelloServerInHandlerï¼šserver ChannelHandler æŽ¥å£ NettyServerHandler å®žçŽ°ç±» HelloClient Client æŽ¥å£ NettyClient å®žçŽ°ç±» HelloServerInHandler ChannelHandler æŽ¥å£ NettyClientHandler å®žçŽ°ç±» å› ä¸ºæ•™ç¨‹æ–‡ç« ï¼Œä»¥æ•™ç¨‹ Demo ä¸ºå‡†ï¼Œå®žé™…ä¼šæœ‰æ›´å¤šéœ€è¦æŠ½è±¡çš„ï¼Œä¾‹å¦‚ï¼šCodec åè®®ç¼–è§£ç ï¼ŒDispatcher æ¶ˆæ¯ç­‰åˆ†å‘ã€‚å†æ¥çœ‹çœ‹ dubbo:// çš„å¤„ç†æµç¨‹ï¼š FROM ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” dubbo://ã€‹ Transporter: mina, netty, grizzy Serialization: dubbo, hessian2, java, json Dispatcher: all, direct, message, execution, connection ThreadPool: fixed, cached å¦‚æžœè¿™ä¸ªå›¾è¯»ä¸æ‡‚ï¼Œæ²¡å…³ç³»ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ªæŽ¥å£ã€‚åŽé¢ï¼Œå¯ä»¥å›žè¿‡å¤´æ¥ç†è§£è¿™ä¸ªå›¾ã€‚ æœ¬æ–‡æ¶‰åŠçš„ç±»å›¾å¦‚ä¸‹ï¼š 4. Endpointcom.alibaba.dubbo.remoting.Endpoint ï¼Œç«¯ç‚¹æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š å±žæ€§ç›¸å…³ 12345URL getUrl();InetSocketAddress getLocalAddress();ChannelHandler getChannelHandler(); å‘é€æ¶ˆæ¯ 12void send(Object message) throws RemotingException;void send(Object message, boolean sent) throws RemotingException; å…³ç³»ç›¸å…³ 123456void close();void close(int timeout);void startClose();boolean isClosed(); Endpoint ï¼Œä»Žä¸­æ–‡ä¸Šè§£é‡Šæ¥è¯´æ˜¯ï¼Œâ€œç«¯ç‚¹â€ã€‚ä»Žå­—é¢ä¸Šæ¥çœ‹ï¼Œä¸å¤ªå®¹æ˜“ç†è§£ã€‚åœ¨ dubbo-remoting-api ä¸­ï¼Œä¸€ä¸ª Client æˆ– Server ï¼Œéƒ½æ˜¯ä¸€ä¸ª Endpoint ã€‚ä¸åŒç³»ç»Ÿçš„ï¼ŒEndpoint ä»£è¡¨çš„ä¼šç•¥æœ‰å·®è·ï¼Œä¾‹å¦‚ SpringMVC ä¸­ï¼Œä¸€ä¸ªè¯·æ±‚ Restful URL ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª Endpoint ï¼Œå¯ä»¥ Google æŸ¥è¯¢ï¼Œç†è§£æ›´å¤šã€‚ 4.1 Channelcom.alibaba.dubbo.remoting.Channel ï¼Œç»§æ‰¿ Endpoint æŽ¥å£ï¼Œé€šé“æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š è¿žæŽ¥ç›¸å…³ 12InetSocketAddress getRemoteAddress();boolean isConnected(); å±žæ€§ç›¸å…³ 1234boolean hasAttribute(String key);Object getAttribute(String key);void setAttribute(String key, Object value);void removeAttribute(String key); å’Œ Netty Channel ä¸€è‡´ï¼Œé€šè®¯çš„è½½ä½“ã€‚åœ¨åŽé¢çš„æ–‡ç« ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨ dubbo-remoting-netty4 é¡¹ç›®ä¸­ï¼ŒNettyChannel æ˜¯ Dubbo Channel çš„å®žçŽ°ï¼Œå†…éƒ¨æœ‰çœŸæ­£çš„ Netty Channel å±žæ€§ï¼Œç”¨äºŽé€šè®¯ã€‚ 4.2 Clientcom.alibaba.dubbo.remoting.Client ï¼Œå®žçŽ° Endpoint å’Œ Channel å’Œ Resetable æŽ¥å£ï¼Œå®¢æˆ·ç«¯æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 12// é‡è¿žvoid reconnect() throws RemotingException; 4.3 Servercom.alibaba.dubbo.remoting.Server ï¼Œç»§æ‰¿ Endpoint å’Œ Resetable æŽ¥å£ï¼ŒæœåŠ¡å™¨æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 123456// æ˜¯å¦ç»‘å®šæœ¬åœ°ç«¯å£ï¼Œæä¾›æœåŠ¡ã€‚å³ï¼Œæ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œå¯è¿žæŽ¥ï¼ŒæŽ¥æ”¶æ¶ˆæ¯ç­‰ã€‚boolean isBound();// èŽ·å¾—è¿žæŽ¥ä¸ŠæœåŠ¡å™¨çš„é€šé“ï¼ˆå®¢æˆ·ç«¯ï¼‰ä»¬Collection&lt;Channel&gt; getChannels();Channel getChannel(InetSocketAddress remoteAddress); 4.3.1 Resetablecom.alibaba.dubbo.common.Resetable ï¼Œå¯é‡ç½®æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 1void reset(URL url); Server å®žçŽ° Resetable æŽ¥å£ï¼Œåœ¨å®žçŽ° #reset(url) æ–¹æ³•ï¼Œç”¨äºŽæ ¹æ®æ–°ä¼ å…¥çš„ url å±žæ€§ï¼Œé‡ç½®è‡ªå·±å†…éƒ¨çš„ä¸€äº›å±žæ€§ï¼Œä¾‹å¦‚ AbstractServer#reset(url) æ–¹æ³•ã€‚ 5. ChannelHandlercom.alibaba.dubbo.remoting.ChannelHandler ï¼Œé€šé“å¤„ç†å™¨æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 1234567void connected(Channel channel) throws RemotingException;void disconnected(Channel channel) throws RemotingException;void sent(Channel channel, Object message) throws RemotingException;void received(Channel channel, Object message) throws RemotingException;void caught(Channel channel, Throwable exception) throws RemotingException; å’Œ Netty ChannelHandler ä¸€è‡´ï¼Œè´Ÿè´£ Channel ä¸­çš„é€»è¾‘å¤„ç†ã€‚åœ¨åŽé¢çš„æ–‡ç« ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨ dubbo-remoting-netty4 é¡¹ç›®ä¸­ï¼ŒNettyServerHandler æ˜¯ Netty ChannelHandler çš„å®žçŽ°ï¼Œå†…éƒ¨è°ƒç”¨ Netty ChannelHandler çš„æ–¹æ³•ï¼Œè¿›è¡Œé€»è¾‘å¤„ç†ã€‚ 6. Transportercom.alibaba.dubbo.remoting.Transporter ï¼Œç½‘ç»œä¼ è¾“æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132@SPI("netty")public interface Transporter &#123; /** * Bind a server. * * ç»‘å®šä¸€ä¸ªæœåŠ¡å™¨ * * @param url server url * @param handler é€šé“å¤„ç†å™¨ * @return server æœåŠ¡å™¨ * @throws RemotingException å½“ç»‘å®šå‘ç”Ÿå¼‚å¸¸æ—¶ * @see com.alibaba.dubbo.remoting.Transporters#bind(URL, Receiver, ChannelHandler) */ @Adaptive(&#123;Constants.SERVER_KEY, Constants.TRANSPORTER_KEY&#125;) Server bind(URL url, ChannelHandler handler) throws RemotingException; /** * Connect to a server. * * è¿žæŽ¥ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå³åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ * * @param url server url æœåŠ¡å™¨åœ°å€ * @param handler é€šé“å¤„ç†å™¨ * @return client å®¢æˆ·ç«¯ * @throws RemotingException å½“è¿žæŽ¥å‘ç”Ÿå¼‚å¸¸æ—¶ * @see com.alibaba.dubbo.remoting.Transporters#connect(URL, Receiver, ChannelListener) */ @Adaptive(&#123;Constants.CLIENT_KEY, Constants.TRANSPORTER_KEY&#125;) Client connect(URL url, ChannelHandler handler) throws RemotingException;&#125; @SPI(&quot;netty&quot;) æ³¨è§£ï¼ŒDubbo SPI æ‹“å±•ç‚¹ï¼Œé»˜è®¤ä¸º &quot;netty&quot; ã€‚æ³¨æ„ï¼Œæ­¤å¤„çš„ netty å¯¹åº”çš„æ˜¯ netty3 ï¼Œå› ä¸º Dubbo é¡¹ç›®åœ¨å¼€å‘æ—¶ï¼Œnetty4 å¹¶æœªå‘å¸ƒã€‚é…ç½®æ–¹å¼è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” Netty4ã€‹ æ–‡æ¡£ã€‚ @Adaptive({Constants.SERVER_KEY, Constants.TRANSPORTER_KEY}) æ³¨è§£ï¼ŒåŸºäºŽ Dubbo SPI Adaptive æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„ Server å®žçŽ°ï¼Œä½¿ç”¨ URL.server æˆ– URL.transporter å±žæ€§ã€‚ @Adaptive({Constants.CLIENT_KEY, Constants.TRANSPORTER_KEY}) æ³¨è§£ï¼ŒåŸºäºŽ Dubbo SPI Adaptive æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„ Client å®žçŽ°ï¼Œä½¿ç”¨ URL.client æˆ– URL.transporter å±žæ€§ã€‚ 6.1 Transporterscom.alibaba.dubbo.remoting.Transporters ï¼ŒTransporter é—¨é¢ç±»ã€‚ å‹æƒ…æç¤ºï¼šFacade è®¾è®¡æ¨¡å¼ï¼Œå‚è§ ã€Š è®¾è®¡æ¨¡å¼ï¼ˆä¹ï¼‰å¤–è§‚æ¨¡å¼Facadeï¼ˆç»“æž„åž‹ï¼‰ã€‹ æ–‡ç« ã€‚ #bind(String url, ChannelHandler... handler) é™æ€æ–¹æ³•ï¼Œç»‘å®šä¸€ä¸ªæœåŠ¡å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021 1: public static Server bind(String url, ChannelHandler... handler) throws RemotingException &#123; 2: return bind(URL.valueOf(url), handler); 3: &#125; 4: 5: public static Server bind(URL url, ChannelHandler... handlers) throws RemotingException &#123; 6: if (url == null) &#123; 7: throw new IllegalArgumentException("url == null"); 8: &#125; 9: if (handlers == null || handlers.length == 0) &#123;10: throw new IllegalArgumentException("handlers == null");11: &#125;12: // åˆ›å»º handler13: ChannelHandler handler;14: if (handlers.length == 1) &#123;15: handler = handlers[0];16: &#125; else &#123;17: handler = new ChannelHandlerDispatcher(handlers);18: &#125;19: // åˆ›å»º Server å¯¹è±¡20: return getTransporter().bind(url, handler);21: &#125; å’Œ Transporter#bind(url, handler) æ–¹æ³•ï¼Œå¯¹åº”ã€‚ ç¬¬ 12 è‡³ 18 è¡Œï¼šåˆ›å»º handler ã€‚è‹¥ handlers æ˜¯å¤šä¸ªï¼Œä½¿ç”¨ ChannelHandlerDispatcher è¿›è¡Œå°è£…ã€‚åœ¨ ChannelHandlerDispatcher ä¸­ï¼Œä¼šå¾ªçŽ¯è°ƒç”¨ handlers ï¼Œå¯¹åº”çš„æ–¹æ³•ã€‚ ç¬¬ 20 è¡Œï¼šè°ƒç”¨ #getTransporter() æ–¹æ³•ï¼ŒåŸºäºŽ Dubbo SPI æœºåˆ¶ï¼ŒèŽ·å¾— Transporter$Adaptive å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š 123public static Transporter getTransporter() &#123; return ExtensionLoader.getExtensionLoader(Transporter.class).getAdaptiveExtension();&#125; ç¬¬ 20 è¡Œï¼šè°ƒç”¨ Transporter#bind(url, handler) æ–¹æ³•ï¼Œåœ¨ Transporter$Adaptive å¯¹è±¡ä¸­ï¼Œä¼šæ ¹æ® url å‚æ•°ï¼ŒèŽ·å¾—å¯¹åº”çš„ Transporter å®žçŽ°å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œ NettyTransporterï¼‰ï¼Œä»Žè€Œåˆ›å»ºå¯¹åº”çš„ Server å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œ NettyServerï¼‰ã€‚ å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª #connect(url, handler) é™æ€æ–¹æ³•ï¼Œè¿žæŽ¥ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå³åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ã€‚ðŸ™‚ å’Œä¸Šé¢æ–¹æ³•ç±»ä¼¼ï¼Œè‡ªå·±çœ‹å’¯ã€‚ 7. Codec2com.alibaba.dubbo.remoting.Codec2 ï¼Œç¼–è§£ç å™¨æŽ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021/** * ç¼–ç  * * @param channel é€šé“ * @param buffer Buffer * @param message æ¶ˆæ¯ * @throws IOException å½“ç¼–ç å‘ç”Ÿå¼‚å¸¸æ—¶ */@Adaptive(&#123;Constants.CODEC_KEY&#125;)void encode(Channel channel, ChannelBuffer buffer, Object message) throws IOException;/** * è§£ç  * * @param channel é€šé“ * @param buffer Buffer * @return æ¶ˆæ¯ * @throws IOException å½“è§£ç å‘ç”Ÿå¼‚å¸¸æ—¶ */@Adaptive(&#123;Constants.CODEC_KEY&#125;)Object decode(Channel channel, ChannelBuffer buffer) throws IOException; @SPI(&quot;netty&quot;) æ³¨è§£ï¼ŒDubbo SPI æ‹“å±•ç‚¹ã€‚ @Adaptive({Constants.CODEC_KEY}) æ³¨è§£ï¼ŒåŸºäºŽ Dubbo SPI Adaptive æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„ Codec2 å®žçŽ°ï¼Œä½¿ç”¨ URL.codec å±žæ€§ã€‚ å¦å¤–ï¼Œè§£ç è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è§£å†³ TCP æ‹†åŒ…ã€ç²˜åŒ…çš„åœºæ™¯ï¼Œå› æ­¤è§£ç ç»“æžœå¦‚ä¸‹ï¼š 1234567891011// Codec2.javaenum DecodeResult &#123; /** * éœ€è¦æ›´å¤šè¾“å…¥ */ NEED_MORE_INPUT, /** * å¿½ç•¥ä¸€äº›è¾“å…¥ */ SKIP_SOME_INPUT&#125; ç›®å‰ SKIP_SOME_INPUT ï¼Œæš‚æœªä½¿ç”¨ã€‚ æ„Ÿå…´è¶£çš„ï¼Œå¯ä»¥æå‰çœ‹ä¸‹ ã€Šé«˜æ€§èƒ½ç½‘ç»œæ¡†æž¶Nettyçš„TCPæ‹†åŒ…ã€ç²˜åŒ…è§£å†³æ–¹æ¡ˆã€‹ æ–‡ç« ã€‚åœ¨åŽç»­çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ—¢ä¼šçœ‹åˆ°åŸºäºŽé•¿åº¦çš„æ–¹æ¡ˆï¼Œä¹Ÿä¼šçœ‹åˆ°åŸºäºŽç•Œå®šç¬¦çš„æ–¹æ¡ˆã€‚ 7.1 Codeccom.alibaba.dubbo.remoting.Codec ï¼Œè€çš„ç¼–è§£ç å™¨æŽ¥å£ï¼Œè¢« Codec2 å–ä»£ã€‚ é€šè¿‡ CodecAdapter ï¼Œå°† Codec é€‚é…æˆ Codec2 ã€‚ 7.2 Decodeablecom.alibaba.dubbo.remoting.Decodeable ï¼Œå¯è§£ç çš„æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 12// è§£ç void decode() throws Exception; 8. Dispatchercom.alibaba.dubbo.remoting.Dispatcher ï¼Œè°ƒåº¦å™¨æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 12345678@SPI(AllDispatcher.NAME)public interface Dispatcher &#123; @Adaptive(&#123;Constants.DISPATCHER_KEY, "dispather", "channel.handler"&#125;) // The last two parameters are reserved for compatibility with the old configuration ChannelHandler dispatch(ChannelHandler handler, URL url);&#125; @SPI(AllDispatcher.NAME) æ³¨è§£ï¼ŒDubbo SPI æ‹“å±•ç‚¹ï¼Œé»˜è®¤ä¸º &quot;all&quot; ã€‚ @Adaptive({Constants.DISPATCHER_KEY, &quot;dispather&quot;, &quot;channel.handler&quot;}) æ³¨è§£ï¼ŒåŸºäºŽ Dubbo SPI Adaptive æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„ ChanelHander å®žçŽ°ï¼Œä½¿ç”¨ URL.dispatcher å±žæ€§ã€‚ ä¸ºä»€ä¹ˆä¼ å…¥çš„ handler å‚æ•°ï¼Œåˆ›å»ºè¿”å›žçš„è¿˜æ˜¯ ChannelHandler å¯¹è±¡å‘¢ï¼Ÿæ„Ÿå…´è¶£çš„ï¼Œå¯ä»¥æå‰çœ‹ä¸‹ AllChannelHandler å’Œ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” çº¿ç¨‹æ¨¡åž‹ã€‹ ã€‚ðŸ™‚ æ–‡ç« ï¼ŒåŽé¢è§ã€‚ 9. RemotingExceptioncom.alibaba.dubbo.remoting.RemotingException ï¼Œå®žçŽ° Exception ç±»ï¼Œdubbo-remoting-api çš„åŸºç¡€å¼‚å¸¸ã€‚ä»£ç å¦‚ä¸‹ï¼š 12345678910111213public class RemotingException extends Exception &#123; /** * æœ¬åœ°åœ°å€ */ private InetSocketAddress localAddress; /** * è¿œç¨‹åœ°å€ */ private InetSocketAddress remoteAddress; // ... çœç•¥æ–¹æ³•&#125; 9.1 ExecutionExceptioncom.alibaba.dubbo.remoting.ExecutionException ï¼Œå®žçŽ° RemotingException ç±»ï¼Œæ‰§è¡Œå¼‚å¸¸ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789public class ExecutionException extends RemotingException &#123; /** * è¯·æ±‚ */ private final Object request; // ... çœç•¥æ–¹æ³•&#125; 9.2 TimeoutExceptioncom.alibaba.dubbo.remoting.TimeoutException ï¼Œå®žçŽ° RemotingException ç±»ï¼Œè¶…æ—¶å¼‚å¸¸ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718public class TimeoutException extends RemotingException &#123; /** * å®¢æˆ·ç«¯ */ public static final int CLIENT_SIDE = 0; /** * æœåŠ¡ç«¯ */ public static final int SERVER_SIDE = 1; /** * é˜¶æ®µ */ private final int phase; // ... çœç•¥æ–¹æ³•&#125; dubbo-remoting-api æ¨¡å—ï¼Œæ¶‰åŠåˆ°å¤§é‡çš„å°è£…ï¼Œå¦‚æžœä¸å¤ªç†è§£çš„ï¼Œå»ºè®®å¤šå¤šè°ƒè¯•ã€‚]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Dubboæºç åˆ†æžâ€”â€”NIO æœåŠ¡å™¨ï¼ˆäºŒï¼‰ä¹‹Transportå±‚]]></title>
    <url>%2F2019%2F08%2F23%2FDubbo%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E2%80%94%E2%80%94NIO-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B9%8BTransport%E5%B1%82%2F</url>
    <content type="text"><![CDATA[1. æ¦‚è¿°æœ¬æ–‡æŽ¥ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” NIO æœåŠ¡å™¨ï¼ˆä¸€ï¼‰ä¹‹æŠ½è±¡ APIã€‹ä¸€æ–‡ï¼Œåˆ†äº« dubbo-remoting-api æ¨¡å—ï¼Œ transportåŒ…ï¼Œç½‘ç»œä¼ è¾“å±‚ã€‚ transport ç½‘ç»œä¼ è¾“å±‚ï¼šæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æŽ¥å£ï¼Œä»¥ Message ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æŽ¥å£ä¸º Channel, Transporter, Client, Server, Codec æ¶‰åŠçš„ç±»å›¾å¦‚ä¸‹ï¼š ç™½è‰²éƒ¨åˆ†ï¼Œä¸ºé€šç”¨æŽ¥å£ã€‚ è“è‰²éƒ¨åˆ†ï¼Œä¸º transport åŒ…ä¸‹çš„ç±»ã€‚ æ•´ä¸ªç±»å›¾ï¼Œæˆ‘ä»¬åˆ†æˆ å…­ä¸ª éƒ¨åˆ†ï¼š Client Server Channel ChannelHandler Codec Dispacher ä»Žæµç¨‹ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬åˆ†æˆï¼š Server å¯åŠ¨ å…³é—­ Client å¯åŠ¨ å…³é—­ ChannelHandler å¤„ç†è¿žæŽ¥ å¤„ç†æ–­å¼€ å‘é€æ¶ˆæ¯ æŽ¥æ”¶æ¶ˆæ¯ å¤„ç†å¼‚å¸¸ è‰¿è‰¿çš„æ—ç™½ï¼šæ¶‰åŠè¾ƒå¤šç±»å’Œæµç¨‹ï¼Œå†…å®¹ä¸æ˜¯å¾ˆçº¿æ€§ï¼Œå¯èƒ½åˆ†äº«çš„æ¯”è¾ƒå‡Œä¹±ï¼Œè¿˜æœ›èƒ–å‹è°…è§£ã€‚å»ºè®®ï¼Œè¯» 2-3 éï¼Œå¹¶ä¸”åšä¸€äº›è°ƒè¯•ã€‚ 2. AbstractPeercom.alibaba.dubbo.remoting.transport.AbstractPeer ï¼Œå®žçŽ° Endpointã€ChannelHandler æŽ¥å£ï¼ŒPeer æŠ½è±¡ç±»ã€‚ æž„é€ æ–¹æ³• 1234567891011121314151617181920212223242526272829303132 1: /** 2: * é€šé“å¤„ç†å™¨ 3: */ 4: private final ChannelHandler handler; 5: /** 6: * URL 7: */ 8: private volatile URL url; 9: /**10: * æ­£åœ¨å…³é—­11: *12: * &#123;@link #startClose()&#125;13: */14: // closing closed means the process is being closed and close is finished15: private volatile boolean closing;16: /**17: * å…³é—­å®Œæˆ18: *19: * &#123;@link #close()&#125;20: */21: private volatile boolean closed;22:23: public AbstractPeer(URL url, ChannelHandler handler) &#123;24: if (url == null) &#123;25: throw new IllegalArgumentException("url == null");26: &#125;27: if (handler == null) &#123;28: throw new IllegalArgumentException("handler == null");29: &#125;30: this.url = url;31: this.handler = handler;32: &#125; 1handler å±žæ€§ï¼Œé€šé“å¤„ç†å™¨ï¼Œé€šè¿‡æž„é€ æ–¹æ³•ä¼ å…¥ã€‚å®žçŽ°çš„ ChannelHandler çš„æŽ¥å£æ–¹æ³•ï¼Œç›´æŽ¥è°ƒç”¨ 1handler çš„æ–¹æ³•ï¼Œè¿›è¡Œæ‰§è¡Œé€»è¾‘å¤„ç†ã€‚ å‚è§ä»£ç ï¼šä¼ é€é—¨ è¿™ç§æ–¹å¼åœ¨è®¾è®¡æ¨¡å¼ä¸­è¢«ç§°ä½œ â€œè£…é¥°æ¨¡å¼â€œ ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¤§é‡çš„è£…é¥°æ¨¡å¼çš„ä½¿ç”¨ã€‚å®žé™…ä¸Šï¼Œè¿™ä¹Ÿæ˜¯ dubbo-remoting æŠ½è±¡ API + å®žçŽ°æœ€æ ¸å¿ƒçš„æ–¹å¼ä¹‹ä¸€ã€‚ url å±žæ€§ï¼ŒURL ï¼Œé€šè¿‡æž„é€ æ–¹æ³•ä¼ å…¥ã€‚é€šè¿‡è¯¥å±žæ€§ï¼Œä¼ é€’ Dubbo æœåŠ¡å¼•ç”¨å’ŒæœåŠ¡æš´éœ²çš„é…ç½®é¡¹ã€‚ closing å±žæ€§ï¼Œæ­£åœ¨å…³é—­ï¼Œè°ƒç”¨ #startClose() æ–¹æ³•ï¼Œå˜æ›´ã€‚ close å±žæ€§ï¼Œå…³é—­å®Œæˆï¼Œè°ƒç”¨ #close() æ–¹æ³•ï¼Œå˜æ›´ã€‚ å‘é€æ¶ˆæ¯ 1234@Overridepublic void send(Object message) throws RemotingException &#123; send(message, url.getParameter(Constants.SENT_KEY, false));&#125; 1sent é…ç½®é¡¹ï¼š true ç­‰å¾…æ¶ˆæ¯å‘å‡ºï¼Œæ¶ˆæ¯å‘é€å¤±è´¥å°†æŠ›å‡ºå¼‚å¸¸ã€‚ false ä¸ç­‰å¾…æ¶ˆæ¯å‘å‡ºï¼Œå°†æ¶ˆæ¯æ”¾å…¥ IO é˜Ÿåˆ—ï¼Œå³åˆ»è¿”å›žã€‚ è¯¦ç»†å‚è§ï¼šã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” å¼‚æ­¥è°ƒç”¨ã€‹ å…¶ä»–æ–¹æ³• èƒ–å‹ç‚¹å‡» AbstractPeer ï¼Œå†çœ‹çœ‹æ‰€æœ‰çš„æ–¹æ³•ã€‚ 2.1 AbstractEndpintcom.alibaba.dubbo.remoting.transport.AbstractPeer.AbstractEndpint ï¼Œå®žçŽ° Resetable æŽ¥å£ï¼Œç»§æ‰¿ AbstractPeer æŠ½è±¡ç±»ï¼Œç«¯ç‚¹æŠ½è±¡ç±»ã€‚ æž„é€ æ–¹æ³• 12345678910111213141516171819 1: /** 2: * ç¼–è§£ç å™¨ 3: */ 4: private Codec2 codec; 5: /** 6: * è¶…æ—¶æ—¶é—´ 7: */ 8: private int timeout; 9: /**10: * è¿žæŽ¥è¶…æ—¶æ—¶é—´11: */12: private int connectTimeout;13:14: public AbstractEndpoint(URL url, ChannelHandler handler) &#123;15: super(url, handler);16: this.codec = getChannelCodec(url);17: this.timeout = url.getPositiveParameter(Constants.TIMEOUT_KEY, Constants.DEFAULT_TIMEOUT);18: this.connectTimeout = url.getPositiveParameter(Constants.CONNECT_TIMEOUT_KEY, Constants.DEFAULT_CONNECT_TIMEOUT);19: &#125; codec å±žæ€§ï¼Œç¼–è§£ç å™¨ã€‚åœ¨æž„é€ æ–¹æ³•ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨ #getChannelCodec(url) æ–¹æ³•ï¼ŒåŸºäºŽ url å‚æ•°ï¼ŒåŠ è½½å¯¹åº”çš„ Codec å®žçŽ°å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456781: protected static Codec2 getChannelCodec(URL url) &#123;2: String codecName = url.getParameter(Constants.CODEC_KEY, "telnet");3: if (ExtensionLoader.getExtensionLoader(Codec2.class).hasExtension(codecName)) &#123; // ä¾‹å¦‚ï¼Œåœ¨ DubboProtocol ä¸­ï¼Œä¼šèŽ·å¾— DubboCodec4: return ExtensionLoader.getExtensionLoader(Codec2.class).getExtension(codecName);5: &#125; else &#123;6: return new CodecAdapter(ExtensionLoader.getExtensionLoader(Codec.class).getExtension(codecName));7: &#125;8: &#125; ç¬¬ 3 è¡Œï¼šåŸºäºŽ Dubbo SPI æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„ Codec å®žçŽ°å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œåœ¨ DubboProtocol ä¸­ï¼Œä¼šèŽ·å¾— DubboCodec å¯¹è±¡ã€‚ ç¬¬ 6 è¡Œï¼šCodec æŽ¥å£ï¼Œå·²ç»åºŸå¼ƒäº†ï¼Œç›®å‰ Dubbo é¡¹ç›®é‡Œï¼Œä¹Ÿæ²¡æœ‰å®ƒçš„æ‹“å±•å®žçŽ°ã€‚ é‡ç½®å±žæ€§ #reset(url) å®žçŽ°æ–¹æ³•ï¼Œä½¿ç”¨æ–°çš„ url å±žæ€§ï¼Œå¯é‡ç½® codec timeout connectTimeout å±žæ€§ã€‚ 3. Client3.1 AbstractClientcom.alibaba.dubbo.remoting.transport.AbstractClient ï¼Œå®žçŽ° Client æŽ¥å£ï¼Œç»§æ‰¿ AbstractEndpoint æŠ½è±¡ç±»ï¼Œå®¢æˆ·ç«¯æŠ½è±¡ç±»ï¼Œé‡ç‚¹å®žçŽ°äº†å…¬ç”¨çš„é‡è¿žé€»è¾‘ï¼ŒåŒæ—¶æŠ½è±¡äº†è¿žæŽ¥ç­‰æ¨¡æ¿æ–¹æ³•ï¼Œä¾›å­ç±»å®žçŽ°ã€‚æŠ½è±¡æ–¹æ³•å¦‚ä¸‹ï¼š 1234567protected abstract void doOpen() throws Throwable;protected abstract void doClose() throws Throwable;protected abstract void doConnect() throws Throwable;protected abstract void doDisConnect() throws Throwable;protected abstract Channel getChannel(); æž„é€ æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970 1: /** 2: * é‡è¿žå®šæ—¶ä»»åŠ¡æ‰§è¡Œå™¨ 3: */ 4: private static final ScheduledThreadPoolExecutor reconnectExecutorService = new ScheduledThreadPoolExecutor(2, new NamedThreadFactory("DubboClientReconnectTimer", true)); 5: /** 6: * å‘é€æ¶ˆæ¯æ—¶ï¼Œè‹¥æ–­å¼€ï¼Œæ˜¯å¦é‡è¿ž 7: */ 8: private final boolean send_reconnect; 9: /**10: * é‡è¿ž warning çš„é—´éš”.(waringå¤šå°‘æ¬¡ä¹‹åŽï¼Œwarningä¸€æ¬¡) //for test11: */12: // reconnect warning period. Reconnect warning interval (log warning after how many times) //for test13: private final int reconnect_warning_period;14: /**15: * å…³é—­è¶…æ—¶æ—¶é—´16: */17: private final long shutdown_timeout;18: /**19: * çº¿ç¨‹æ± 20: *21: * åœ¨è°ƒç”¨ &#123;@link #wrapChannelHandler(URL, ChannelHandler)&#125; æ—¶ï¼Œä¼šè°ƒç”¨ &#123;@link com.alibaba.dubbo.remoting.transport.dispatcher.WrappedChannelHandler&#125; åˆ›å»º22: */23: protected volatile ExecutorService executor;24:25: public AbstractClient(URL url, ChannelHandler handler) throws RemotingException &#123;26: super(url, handler);27: // ä»Ž URL ä¸­ï¼ŒèŽ·å¾—é‡è¿žç›¸å…³é…ç½®é¡¹28: send_reconnect = url.getParameter(Constants.SEND_RECONNECT_KEY, false);29: shutdown_timeout = url.getParameter(Constants.SHUTDOWN_TIMEOUT_KEY, Constants.DEFAULT_SHUTDOWN_TIMEOUT);30: // The default reconnection interval is 2s, 1800 means warning interval is 1 hour.31: reconnect_warning_period = url.getParameter("reconnect.waring.period", 1800);32:33: // åˆå§‹åŒ–å®¢æˆ·ç«¯34: try &#123;35: doOpen();36: &#125; catch (Throwable t) &#123;37: close(); // å¤±è´¥ï¼Œåˆ™å…³é—­38: throw new RemotingException(url.toInetSocketAddress(), null,39: "Failed to start " + getClass().getSimpleName() + " " + NetUtils.getLocalAddress()40: + " connect to the server " + getRemoteAddress() + ", cause: " + t.getMessage(), t);41: &#125;42:43: // è¿žæŽ¥æœåŠ¡å™¨44: try &#123;45: // connect.46: connect();47: if (logger.isInfoEnabled()) &#123;48: logger.info("Start " + getClass().getSimpleName() + " " + NetUtils.getLocalAddress() + " connect to the server " + getRemoteAddress());49: &#125;50: &#125; catch (RemotingException t) &#123;51: if (url.getParameter(Constants.CHECK_KEY, true)) &#123;52: close(); // å¤±è´¥ï¼Œåˆ™å…³é—­53: throw t;54: &#125; else &#123;55: logger.warn("Failed to start " + getClass().getSimpleName() + " " + NetUtils.getLocalAddress()56: + " connect to the server " + getRemoteAddress() + " (check == false, ignore and retry later!), cause: " + t.getMessage(), t);57: &#125;58: &#125; catch (Throwable t) &#123;59: close(); // å¤±è´¥ï¼Œåˆ™å…³é—­60: throw new RemotingException(url.toInetSocketAddress(), null,61: "Failed to start " + getClass().getSimpleName() + " " + NetUtils.getLocalAddress()62: + " connect to the server " + getRemoteAddress() + ", cause: " + t.getMessage(), t);63: &#125;64:65: // èŽ·å¾—çº¿ç¨‹æ± 66: executor = (ExecutorService) ExtensionLoader.getExtensionLoader(DataStore.class).getDefaultExtension()67: .get(Constants.CONSUMER_SIDE, Integer.toString(url.getPort()));68: ExtensionLoader.getExtensionLoader(DataStore.class).getDefaultExtension()69: .remove(Constants.CONSUMER_SIDE, Integer.toString(url.getPort()));70: &#125; reconnectExecutorService å±žæ€§ï¼Œé‡è¿žå®šæ—¶ä»»åŠ¡æ‰§è¡Œå™¨ã€‚åœ¨å®¢æˆ·ç«¯è¿žæŽ¥æœåŠ¡ç«¯æ—¶ï¼Œä¼šåˆ›å»ºåŽå°ä»»åŠ¡ï¼Œå®šæ—¶æ£€æŸ¥è¿žæŽ¥ï¼Œè‹¥æ–­å¼€ï¼Œä¼šè¿›è¡Œé‡è¿žã€‚ ç¬¬ 27 è‡³ 31 è¡Œï¼šä»Ž URL ä¸­ï¼ŒèŽ·å¾—é‡è¿žç›¸å…³é…ç½®é¡¹ã€‚ ç¬¬ 33 è‡³ 41 è¡Œï¼šè°ƒç”¨ #doOpen() æŠ½è±¡æ–¹æ³•ï¼Œåˆå§‹åŒ–å®¢æˆ·ç«¯ã€‚è‹¥å¼‚å¸¸ï¼Œè°ƒç”¨ #close() æ–¹æ³•ï¼Œè¿›è¡Œå…³é—­ã€‚ ç¬¬ 43 è‡³ 63 è¡Œï¼šè°ƒç”¨ 1#connect() å®žçŽ° æ–¹æ³•ï¼Œè¿žæŽ¥æœåŠ¡å™¨ã€‚è‹¥å¼‚å¸¸ï¼Œè°ƒç”¨ 1#close() æ–¹æ³•ï¼Œè¿›è¡Œå…³é—­ã€‚ ç¬¬ 51 è‡³ 57 è¡Œï¼šè‹¥æ˜¯è¿žæŽ¥å¤±è´¥ RemotingException ï¼Œè‹¥å¼€å¯äº† å¯åŠ¨æ—¶æ£€æŸ¥ ï¼Œåˆ™è°ƒç”¨ #close() æ–¹æ³•ï¼Œè¿›è¡Œå…³é—­ã€‚ ç¬¬ 66 è‡³ 69 è¡Œï¼šä»ŽDataStoreä¸­ï¼ŒèŽ·å¾—çº¿ç¨‹æ± ã€‚ DataStore åœ¨ dubbo-common æ¨¡å—ï¼Œstore åŒ…ä¸‹å®žçŽ°ã€‚ç›®å‰çš„å®žçŽ°æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ ConcurrentMap&lt;String, ConcurrentMap&lt;String, Object&gt;&gt; çš„é›†åˆã€‚èƒ–å‹å¯ä»¥è‡ªå·±çœ‹ç›¸å…³å®žçŽ°ã€‚ æ­¤å¤„çš„çº¿ç¨‹æ± ï¼Œå®žé™…å°±æ˜¯ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” çº¿ç¨‹æ¨¡åž‹ã€‹ ä¸­è¯´çš„çº¿ç¨‹æ± ã€‚åœ¨ ã€Œ8. Dispacherã€ ä¸­ï¼Œè¯¦ç»†è§£æžã€‚ è¿žæŽ¥æœåŠ¡å™¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445/** * è¿žæŽ¥é”ï¼Œç”¨äºŽå®žçŽ°å‘èµ·è¿žæŽ¥å’Œæ–­å¼€è¿žæŽ¥äº’æ–¥ï¼Œé¿å…å¹¶å‘ã€‚ */private final Lock connectLock = new ReentrantLock(); 1: protected void connect() throws RemotingException &#123; 2: // èŽ·å¾—é” 3: connectLock.lock(); 4: try &#123; 5: // å·²è¿žæŽ¥ï¼Œ 6: if (isConnected()) &#123; 7: return; 8: &#125; 9: // åˆå§‹åŒ–é‡è¿žçº¿ç¨‹ 10: initConnectStatusCheckCommand(); 11: // æ‰§è¡Œè¿žæŽ¥ 12: doConnect(); 13: // è¿žæŽ¥å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ 14: if (!isConnected()) &#123; 15: throw new RemotingException(this, "Failed connect to server " + getRemoteAddress() + " from " + getClass().getSimpleName() + " " 16: + NetUtils.getLocalHost() + " using dubbo version " + Version.getVersion() 17: + ", cause: Connect wait timeout: " + getTimeout() + "ms."); 18: // è¿žæŽ¥æˆåŠŸï¼Œæ‰“å°æ—¥å¿— 19: &#125; else &#123; 20: if (logger.isInfoEnabled()) &#123; 21: logger.info("Successed connect to server " + getRemoteAddress() + " from " + getClass().getSimpleName() + " " 22: + NetUtils.getLocalHost() + " using dubbo version " + Version.getVersion() 23: + ", channel is " + this.getChannel()); 24: &#125; 25: &#125; 26: // è®¾ç½®é‡è¿žæ¬¡æ•°å½’é›¶ 27: reconnect_count.set(0); 28: // è®¾ç½®æœªæ‰“å°è¿‡é”™è¯¯æ—¥å¿— 29: reconnect_error_log_flag.set(false); 30: &#125; catch (RemotingException e) &#123; 31: throw e; 32: &#125; catch (Throwable e) &#123; 33: throw new RemotingException(this, "Failed connect to server " + getRemoteAddress() + " from " + getClass().getSimpleName() + " " 34: + NetUtils.getLocalHost() + " using dubbo version " + Version.getVersion() 35: + ", cause: " + e.getMessage(), e); 36: &#125; finally &#123; 37: // é‡Šæ”¾é” 38: connectLock.unlock(); 39: &#125; 40: &#125; ç¬¬ 3 è¡Œï¼šèŽ·å¾—é”ã€‚åœ¨è¿žæŽ¥å’Œæ–­å¼€è¿žæŽ¥æ—¶ï¼Œé€šè¿‡é”ï¼Œé¿å…å¹¶å‘å†²çªã€‚ ç¬¬ 5 è‡³ 8 è¡Œï¼šè°ƒç”¨ #isConnected() æ–¹æ³•ï¼Œåˆ¤æ–­è¿žæŽ¥çŠ¶æ€ã€‚è‹¥å·²ç»è¿žæŽ¥ï¼Œå°±ä¸é‡å¤è¿žæŽ¥ã€‚ä»£ç å¦‚ä¸‹ï¼š 12345@Overridepublic boolean isConnected() &#123; Channel channel = getChannel(); return channel != null &amp;&amp; channel.isConnected();&#125; è¯¥æ–¹æ³•ï¼Œæ˜¯å› ä¸ºå®žçŽ° Channel æŽ¥å£( Client å®žçŽ° Channel æŽ¥å£ )ï¼Œæ‰€ä»¥éœ€è¦å®žçŽ°çš„ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®žé™…æ–¹æ³•å†…éƒ¨ï¼Œè°ƒç”¨çš„æ˜¯ channelå¯¹è±¡ï¼Œè¿›è¡Œåˆ¤æ–­ã€‚å…¶å®ƒå®žçŽ° Channel çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯è¿™ä¹ˆå¤„ç†çš„ï¼Œä¾‹å¦‚ #getAttribute(key) ç­‰æ–¹æ³•ã€‚ ç¬¬ 10 è¡Œï¼šè°ƒç”¨ #initConnectStatusCheckCommand() æ–¹æ³•ï¼Œåˆå§‹åŒ–é‡è¿žçº¿ç¨‹ã€‚ æ–¹æ³•ä¼šå¤æ‚ä¸€äº›ï¼Œä¸æ‚ç³…åœ¨è¿™é‡Œè®²ã€‚ ç¬¬ 14 è‡³ 17 è¡Œï¼šè¿žæŽ¥å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ RemotingException ã€‚ ç¬¬ 18 è‡³ 25 è¡Œï¼šè¿žæŽ¥æˆåŠŸï¼Œæ‰“å°æ—¥å¿—ã€‚ ç¬¬ 26 è‡³ 29 è¡Œï¼šè®¾ç½®é‡è¿žæ¬¡æ•°å½’é›¶ï¼Œæ‰“å°è¿‡é”™è¯¯æ—¥å¿—çŠ¶æ€ä¸ºå¦ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™äº›çŠ¶æ€å­—æ®µçš„å˜æ›´ã€‚ ç¬¬ 38 è¡Œï¼šé‡Šæ”¾é”ã€‚ åˆå§‹åŒ–é‡è¿žçº¿ç¨‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758/** * é‡è¿žæ¬¡æ•° */private final AtomicInteger reconnect_count = new AtomicInteger(0);/** * é‡è¿žæ—¶ï¼Œæ˜¯å¦å·²ç»æ‰“å°è¿‡é”™è¯¯æ—¥å¿—ã€‚ */// Reconnection error log has been called before?private final AtomicBoolean reconnect_error_log_flag = new AtomicBoolean(false);/** * é‡è¿žæ‰§è¡Œä»»åŠ¡ Future */private volatile ScheduledFuture&lt;?&gt; reconnectExecutorFuture = null;/** * æœ€åŽæˆåŠŸè¿žæŽ¥æ—¶é—´ */// the last successed connected timeprivate long lastConnectedTime = System.currentTimeMillis(); 1: private synchronized void initConnectStatusCheckCommand() &#123; 2: //reconnect=false to close reconnect 3: // èŽ·å¾—èŽ·å¾—é‡è¿žé¢‘çŽ‡ï¼Œé»˜è®¤å¼€å¯ã€‚ 4: int reconnect = getReconnectParam(getUrl()); 5: // è‹¥å¼€å¯é‡è¿žåŠŸèƒ½ï¼Œåˆ›å»ºé‡è¿žçº¿ç¨‹ 6: if (reconnect &gt; 0 &amp;&amp; (reconnectExecutorFuture == null || reconnectExecutorFuture.isCancelled())) &#123; 7: // åˆ›å»º Runnable å¯¹è±¡ 8: Runnable connectStatusCheckCommand = new Runnable() &#123; 9: public void run() &#123; 10: try &#123; 11: // æœªè¿žæŽ¥ï¼Œé‡è¿ž 12: if (!isConnected()) &#123; 13: connect(); 14: // å·²è¿žæŽ¥ï¼Œè®°å½•æœ€åŽè¿žæŽ¥æ—¶é—´ 15: &#125; else &#123; 16: lastConnectedTime = System.currentTimeMillis(); 17: &#125; 18: &#125; catch (Throwable t) &#123; 19: // è¶…è¿‡ä¸€å®šæ—¶é—´æœªè¿žæŽ¥ä¸Šï¼Œæ‰æ‰“å°å¼‚å¸¸æ—¥å¿—ã€‚å¹¶ä¸”ï¼Œä»…æ‰“å°ä¸€æ¬¡ã€‚é»˜è®¤ï¼Œ15 åˆ†é’Ÿã€‚ 20: String errorMsg = "client reconnect to " + getUrl().getAddress() + " find error . url: " + getUrl(); 21: // wait registry sync provider list 22: if (System.currentTimeMillis() - lastConnectedTime &gt; shutdown_timeout) &#123; 23: if (!reconnect_error_log_flag.get()) &#123; 24: reconnect_error_log_flag.set(true); 25: logger.error(errorMsg, t); 26: return; 27: &#125; 28: &#125; 29: // æ¯ä¸€å®šæ¬¡å‘çŽ°æœªé‡è¿žï¼Œæ‰æ‰“å°å‘Šè­¦æ—¥å¿—ã€‚é»˜è®¤ï¼Œ1800 æ¬¡ï¼Œ1 å°æ—¶ã€‚ 30: if (reconnect_count.getAndIncrement() % reconnect_warning_period == 0) &#123; 31: logger.warn(errorMsg, t); 32: &#125; 33: &#125; 34: &#125; 35: &#125;; 36: // å‘èµ·å®šæ—¶ä»»åŠ¡ 37: reconnectExecutorFuture = reconnectExecutorService.scheduleWithFixedDelay(connectStatusCheckCommand, reconnect, reconnect, TimeUnit.MILLISECONDS); 38: &#125; 39: &#125; ç¬¬ 4 è¡Œï¼šè°ƒç”¨ #getReconnectParam(url) æ–¹æ³•ï¼ŒèŽ·å¾—é‡è¿žé¢‘çŽ‡ã€‚é»˜è®¤å¼€å¯ï¼Œ2000 æ¯«ç§’ã€‚ ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±ç‚¹å‡»æ–¹æ³•æŸ¥çœ‹ã€‚ ç¬¬ 6 è‡³ 38 è¡Œï¼šè‹¥ å¼€å¯ é‡è¿žåŠŸèƒ½ï¼Œ åˆ›å»ºé‡è¿žçº¿ç¨‹ã€‚ ç¬¬ 8 è‡³ 35 è¡Œï¼šåˆ›å»º Runnable å¯¹è±¡ã€‚ ç¬¬ 11 è‡³ 13 è¡Œï¼šæœªè¿žæŽ¥æ—¶ï¼Œè°ƒç”¨ #connect() æ–¹æ³•ï¼Œè¿›è¡Œé‡è¿žã€‚ ç¬¬ 14 è‡³ 17 è¡Œï¼šå·²è¿žæŽ¥æ—¶ï¼Œè®°å½•æœ€åŽè¿žæŽ¥æ—¶é—´ã€‚ ç¬¬ 18 è‡³ 33 è¡Œï¼šç¬¦åˆæ¡ä»¶æ—¶ï¼Œæ‰“å°é”™è¯¯æˆ–å‘Šè­¦æ—¥å¿—ã€‚ä¸ºä»€ä¹ˆè¦ç¬¦åˆæ¡ä»¶æ‰æ‰“å°å‘¢ï¼Ÿä¹‹å‰ä¹Ÿå’Œæœ‹å‹èŠèµ·æ¥è¿‡ï¼Œçº¿ä¸Šå› ä¸ºä¸­é—´ä»¶ç»„ä»¶ï¼Œæ‰“å°äº†å¤ªå¤šçš„æ—¥å¿—ï¼Œç»“æžœæ•´ä¸ª JVM å´©äº†ã€‚ç‰¹åˆ«åœ¨ç½‘ç»œåœºæ™¯ + å¤§é‡â€œæ— é™â€é‡è¯•çš„åœºæ™¯ï¼Œç‰¹åˆ«å®¹æ˜“æ‰“å‡ºæ»¡å±çš„æ—¥å¿—ã€‚è¿™å—ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ ä¸‹ã€‚å¦å¤–ï¼ŒEureka åœ¨é›†ç¾¤åŒæ­¥ï¼Œä¹Ÿæœ‰ç±»ä¼¼å¤„ç†ã€‚ ç¬¬ 36 è¡Œï¼šå‘èµ·ä»»åŠ¡ï¼Œå®šæ—¶æ£€æŸ¥ï¼Œæ˜¯å¦éœ€è¦é‡è¿žã€‚ reconnect=false to close reconnect ï¼Œä»Žç›®å‰ä»£ç ä¸Šæ¥çœ‹ï¼Œæœªå®žçŽ° #reset(url) æ–¹æ³•ï¼Œåœ¨ URL çš„ reconnect=false é…ç½®é¡¹æ—¶ï¼Œå…³é—­é‡è¿žçº¿ç¨‹ã€‚ å‘é€æ¶ˆæ¯ 1234567891011121314@Overridepublic void send(Object message, boolean sent) throws RemotingException &#123; // æœªè¿žæŽ¥æ—¶ï¼Œå¼€å¯é‡è¿žåŠŸèƒ½ï¼Œåˆ™å…ˆå‘èµ·è¿žæŽ¥ if (send_reconnect &amp;&amp; !isConnected()) &#123; connect(); &#125; // å‘é€æ¶ˆæ¯ Channel channel = getChannel(); //TODO Can the value returned by getChannel() be null? need improvement. if (channel == null || !channel.isConnected()) &#123; throw new RemotingException(this, "message can not send, because channel is closed . url:" + getUrl()); &#125; channel.send(message, sent);&#125; åŒ…è£…é€šé“å¤„ç†å™¨ 1234567891011121314151617181920// Constants.javapublic static final String DEFAULT_CLIENT_THREADPOOL = "cached";protected static final String CLIENT_THREAD_POOL_NAME = "DubboClientHandler"; 1: /** 2: * åŒ…è£…é€šé“å¤„ç†å™¨ 3: * 4: * @param url URL 5: * @param handler è¢«åŒ…è£…çš„é€šé“å¤„ç†å™¨ 6: * @return åŒ…è£…åŽçš„é€šé“å¤„ç†å™¨ 7: */ 8: protected static ChannelHandler wrapChannelHandler(URL url, ChannelHandler handler) &#123; 9: // è®¾ç½®çº¿ç¨‹å 10: url = ExecutorUtil.setThreadName(url, CLIENT_THREAD_POOL_NAME); 11: // è®¾ç½®ä½¿ç”¨çš„çº¿ç¨‹æ± ç±»åž‹ 12: url = url.addParameterIfAbsent(Constants.THREADPOOL_KEY, Constants.DEFAULT_CLIENT_THREADPOOL); 13: // åŒ…è£…é€šé“å¤„ç†å™¨ 14: return ChannelHandlers.wrap(handler, url); 15: &#125; ç¬¬ 10 è¡Œï¼šè°ƒç”¨ ExecutorUtil#setThreadName(url, CLIENT_THREAD_POOL_NAME)æ–¹æ³•ï¼Œè®¾ç½®çº¿ç¨‹åï¼Œå³ URL.threadname=xxx ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456public static URL setThreadName(URL url, String defaultName) &#123; String name = url.getParameter(Constants.THREAD_NAME_KEY, defaultName); name = new StringBuilder(32).append(name).append("-").append(url.getAddress()).toString(); url = url.addParameter(Constants.THREAD_NAME_KEY, name); return url;&#125; æ³¨æ„ï¼Œçº¿ç¨‹åä¸­ï¼ŒåŒ…å« URL çš„åœ°å€ä¿¡æ¯ã€‚ ç¬¬ 12 è¡Œï¼šè®¾ç½®çº¿ç¨‹ç±»åž‹ï¼Œå³ URL.threadpool=xxx ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ &quot;cached&quot; ç±»åž‹ï¼Œè¿™ä¸ªå’Œ Server æ˜¯ä¸åŒçš„ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šçœ‹åˆ°ã€‚ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” çº¿ç¨‹æ± ã€‹ ç¬¬ 14 è¡Œï¼šè°ƒç”¨ ChannelHandlers#wrap(handler, url) æ–¹æ³•ï¼ŒåŒ…è£…é€šé“å¤„ç†å™¨ã€‚è¿™é‡Œæˆ‘ä»¬ä¸ç»†è¯´ï¼Œåœ¨ ã€Œ8. Dispacherã€ ä¸­ï¼Œç»“åˆè§£æžã€‚ è¿™æ˜¯ä¸€ä¸ªéžå¸¸å…³é”®çš„æ–¹æ³•ï¼Œåœ¨ä¾‹å¦‚ NettyClient ç­‰é‡Œï¼Œéƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚ å…¶ä»–æ–¹æ³• å¦‚ä¸‹æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œè‰¿è‰¿å°±ä¸é‡å¤å•°å—¦äº†ã€‚ #disconnect() æ–¹æ³•ï¼Œæ–­å¼€è¿žæŽ¥ã€‚ #reconnect() æ–¹æ³•ï¼Œä¸»åŠ¨é‡è¿žã€‚ #close() æ–¹æ³•ï¼Œå¼ºåˆ¶å…³é—­ã€‚ #close(timeout) æ–¹æ³•ï¼Œä¼˜é›…å…³é—­ã€‚ å­ç±»ç±»å›¾ 3.2 ClientDelegatecom.alibaba.dubbo.remoting.transport.ClientDelegate ï¼Œå®žçŽ° Client æŽ¥å£ï¼Œå®¢æˆ·ç«¯è£…é¥°è€…å®žçŽ°ç±»ã€‚åœ¨æ¯ä¸ªå®žçŽ°çš„æ–¹æ³•é‡Œï¼Œç›´æŽ¥è°ƒç”¨è¢«è£…é¥°çš„ client å±žæ€§çš„æ–¹æ³•ã€‚ ç›®å‰ dubbo-rpc-default æ¨¡å—ä¸­ï¼ŒChannelWrapper ç»§æ‰¿äº† ClientDelegate ç±»ã€‚ä½†å®žé™…ä¸Šï¼ŒChannelWrapper é‡æ–°å®žçŽ°äº†æ‰€æœ‰çš„æ–¹æ³•ï¼Œå¹¶ä¸”ï¼Œå¹¶æœªå¤ç”¨ä»»ä½•æ–¹æ³•ã€‚æ‰€ä»¥ï¼ŒClientDelegate ç›®å‰ç”¨é€”ä¸å¤§ã€‚ 4. Server4.1 AbstractServercom.alibaba.dubbo.remoting.transport.AbstractServer ï¼Œå®žçŽ° Server æŽ¥å£ï¼Œç»§æ‰¿ AbstractEndpoint æŠ½è±¡ç±»ï¼ŒæœåŠ¡å™¨æŠ½è±¡ç±»ï¼Œé‡ç‚¹å®žçŽ°äº†å…¬ç”¨çš„é€»è¾‘ï¼ŒåŒæ—¶æŠ½è±¡äº†å¼€å¯ã€å…³é—­ç­‰æ¨¡æ¿æ–¹æ³•ï¼Œä¾›å­ç±»å®žçŽ°ã€‚æŠ½è±¡æ–¹æ³•å¦‚ä¸‹ï¼š 123protected abstract void doOpen() throws Throwable;protected abstract void doClose() throws Throwable; æž„é€ æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253 1: /** 2: * çº¿ç¨‹æ±  3: */ 4: ExecutorService executor; 5: /** 6: * æœåŠ¡åœ°å€ 7: */ 8: private InetSocketAddress localAddress; 9: /**10: * ç»‘å®šåœ°å€11: */12: private InetSocketAddress bindAddress;13: /**14: * æœåŠ¡å™¨æœ€å¤§å¯æŽ¥å—è¿žæŽ¥æ•°15: */16: private int accepts;17: /**18: * ç©ºé—²è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’19: */20: private int idleTimeout; //600 seconds21:22: public AbstractServer(URL url, ChannelHandler handler) throws RemotingException &#123;23: super(url, handler);24: // æœåŠ¡åœ°å€25: localAddress = getUrl().toInetSocketAddress();26: // ç»‘å®šåœ°å€27: String bindIp = getUrl().getParameter(Constants.BIND_IP_KEY, getUrl().getHost());28: int bindPort = getUrl().getParameter(Constants.BIND_PORT_KEY, getUrl().getPort());29: if (url.getParameter(Constants.ANYHOST_KEY, false) || NetUtils.isInvalidLocalHost(bindIp)) &#123;30: bindIp = NetUtils.ANYHOST;31: &#125;32: bindAddress = new InetSocketAddress(bindIp, bindPort);33: // æœåŠ¡å™¨æœ€å¤§å¯æŽ¥å—è¿žæŽ¥æ•°34: this.accepts = url.getParameter(Constants.ACCEPTS_KEY, Constants.DEFAULT_ACCEPTS);35: // ç©ºé—²è¶…æ—¶æ—¶é—´36: this.idleTimeout = url.getParameter(Constants.IDLE_TIMEOUT_KEY, Constants.DEFAULT_IDLE_TIMEOUT);37:38: // å¼€å¯æœåŠ¡å™¨39: try &#123;40: doOpen();41: if (logger.isInfoEnabled()) &#123;42: logger.info("Start " + getClass().getSimpleName() + " bind " + getBindAddress() + ", export " + getLocalAddress());43: &#125;44: &#125; catch (Throwable t) &#123;45: throw new RemotingException(url.toInetSocketAddress(), null, "Failed to bind " + getClass().getSimpleName()46: + " on " + getLocalAddress() + ", cause: " + t.getMessage(), t);47: &#125;48:49: // èŽ·å¾—çº¿ç¨‹æ± 50: //fixme replace this with better method51: DataStore dataStore = ExtensionLoader.getExtensionLoader(DataStore.class).getDefaultExtension();52: executor = (ExecutorService) dataStore.get(Constants.EXECUTOR_SERVICE_COMPONENT_KEY, Integer.toString(url.getPort()));53: &#125; ç¬¬ 24 è‡³ 36 è¡Œï¼šä»Ž URL ä¸­ï¼ŒåŠ è½½ 1localAddress 1bindAddress 1accepts 1idleTimeout é…ç½®é¡¹ã€‚æ¯”è¾ƒéš¾ç†è§£çš„ï¼Œå¯èƒ½æ˜¯ä¸¤ä¸ªåœ°å€å±žæ€§ï¼Œå¦‚ä¸‹æ˜¯æ¯”ä¾‹æä¾›çš„ä¸€ä¸ªä¾‹å­ï¼š é…ç½®é¡¹å¯åœ¨ #reset(url) æ–¹æ³•ä¸­ï¼Œé‡ç½®å±žæ€§ã€‚ ç¬¬ 38 è‡³ 47 è¡Œï¼šè°ƒç”¨ #doOpen() æ–¹æ³•ï¼Œå¼€å¯æœåŠ¡å™¨ã€‚ ç¬¬ 49 è‡³ 52 è¡Œï¼šä»ŽDataStoreä¸­ï¼ŒèŽ·å¾—çº¿ç¨‹æ± ã€‚ fixme replace this with better method ï¼Œè¯´æ˜Žå®˜æ–¹åœ¨è¿™å—å®žçŽ°ä¸Šï¼Œä¹Ÿä¸æ˜¯å¾ˆæ»¡æ„ï¼ŒåŽé¢ä¼šä¼˜åŒ–æŽ‰ã€‚ è¢«å®¢æˆ·ç«¯è¿žæŽ¥ 12345678910111213141516171819@Overridepublic void connected(Channel ch) throws RemotingException &#123; // If the server has entered the shutdown process, reject any new connection if (this.isClosing() || this.isClosed()) &#123; logger.warn("Close new channel " + ch + ", cause: server is closing or has been closed. For example, receive a new connect request while in shutdown process."); ch.close(); return; &#125; // è¶…è¿‡ä¸Šé™ï¼Œå…³é—­æ–°çš„é“¾æŽ¥ Collection&lt;Channel&gt; channels = getChannels(); if (accepts &gt; 0 &amp;&amp; channels.size() &gt; accepts) &#123; logger.error("Close channel " + ch + ", cause: The server " + ch.getLocalAddress() + " connections greater than max config " + accepts); ch.close(); // å…³é—­æ–°çš„é“¾æŽ¥ return; &#125; // è¿žæŽ¥ super.connected(ch);&#125; å‘é€æ¶ˆæ¯ 1234567891011@Overridepublic void send(Object message, boolean sent) throws RemotingException &#123; // èŽ·å¾—æ‰€æœ‰çš„å®¢æˆ·ç«¯çš„é€šé“ Collection&lt;Channel&gt; channels = getChannels(); // ç¾¤å‘æ¶ˆæ¯ for (Channel channel : channels) &#123; if (channel.isConnected()) &#123; channel.send(message, sent); &#125; &#125;&#125; å…¶ä»–æ–¹æ³• å¦‚ä¸‹æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œè‰¿è‰¿å°±ä¸é‡å¤å•°å—¦äº†ã€‚ #disconnect() æ–¹æ³•ï¼Œæ–­å¼€è¿žæŽ¥ã€‚ #close() æ–¹æ³•ï¼Œå¼ºåˆ¶å…³é—­ã€‚ #close(timeout) æ–¹æ³•ï¼Œä¼˜é›…å…³é—­ã€‚ å­ç±»ç±»å›¾ 4.2 ServerDelegatecom.alibaba.dubbo.remoting.transport.ServerDelegate ï¼Œå®žçŽ° Client æŽ¥å£ï¼Œå®¢æˆ·ç«¯è£…é¥°è€…å®žçŽ°ç±»ã€‚åœ¨æ¯ä¸ªå®žçŽ°çš„æ–¹æ³•é‡Œï¼Œç›´æŽ¥è°ƒç”¨è¢«è£…é¥°çš„ server å±žæ€§çš„æ–¹æ³•ã€‚ ç›®å‰ dubbo-remoting-p2p æ¨¡å—ä¸­ï¼ŒPeerServer ä¼šç»§æ‰¿è¯¥ç±»ï¼ŒåŽç»­å†çœ‹ã€‚ 5. Channel5.1 AbstractChannelcom.alibaba.dubbo.remoting.transport.AbstractChannel ï¼Œå®žçŽ° Channel æŽ¥å£ï¼Œå®žçŽ° AbstractPeer æŠ½è±¡ç±»ï¼Œé€šé“æŠ½è±¡ç±»ã€‚ å‘é€æ¶ˆæ¯ 12345678@Overridepublic void send(Object message, boolean sent) throws RemotingException &#123; if (isClosed()) &#123; throw new RemotingException(this, "Failed to send message " + (message == null ? "" : message.getClass().getName()) + ":" + message + ", cause: Channel closed. channel: " + getLocalAddress() + " -&gt; " + getRemoteAddress()); &#125;&#125; å…·ä½“çš„å‘é€æ–¹æ³•ï¼Œå­ç±»å®žçŽ°ã€‚åœ¨ AbstractChannel ä¸­ï¼Œç›®å‰åªåšçŠ¶æ€æ£€æŸ¥ã€‚ å­ç±»ç±»å›¾ 5.2 ChannelDelegatecom.alibaba.dubbo.remoting.transport.ChannelDelegate ï¼Œå®žçŽ° Channel æŽ¥å£ï¼Œé€šé“è£…é¥°è€…å®žçŽ°ç±»ã€‚åœ¨æ¯ä¸ªå®žçŽ°çš„æ–¹æ³•é‡Œï¼Œç›´æŽ¥è°ƒç”¨è¢«è£…é¥°çš„ channel å±žæ€§çš„æ–¹æ³•ã€‚ ç›®å‰ Dubbo ä¸­ï¼Œæš‚æœªç”¨åˆ°ã€‚ 7. ChannelHandler7.1 ChannelHandlerAdaptercom.alibaba.dubbo.remoting.transport.ChannelHandlerAdapter ï¼Œå®žçŽ° ChannelHandler æŽ¥å£ï¼Œé€šé“å¤„ç†å™¨é€‚é…å™¨ï¼Œæ¯ä¸ªæ–¹æ³•ä¸ºç©ºå®žçŽ°ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789@Override public void connected(Channel channel) throws RemotingException &#123; &#125;@Override public void disconnected(Channel channel) throws RemotingException &#123; &#125;@Override public void sent(Channel channel, Object message) &#123; &#125;@Override public void received(Channel channel, Object message) throws RemotingException &#123; &#125;@Override public void caught(Channel channel, Throwable exception) throws RemotingException &#123; &#125; å­ç±»ï¼Œå¯ç»§æ‰¿å®ƒï¼Œä»…å®žçŽ°æƒ³è¦çš„æ–¹æ³•ã€‚ 7.2 ChannelHandlerDispatchercom.alibaba.dubbo.remoting.transport.ChannelHandlerDispatcher ï¼Œå®žçŽ° ChannelHandler æŽ¥å£ï¼Œé€šé“å¤„ç†å™¨è°ƒåº¦å™¨ã€‚åœ¨å®ƒå†…éƒ¨ï¼Œæœ‰ä¸€ä¸ªé€šé“å¤„ç†å™¨æ•°ç»„ channelHandlers å±žæ€§ã€‚ æ¯ä¸ªå®žçŽ°çš„æ–¹æ³•ï¼Œéƒ½ä¼šå¾ªçŽ¯è°ƒç”¨ channelHandlers çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š 123456789public void received(Channel channel, Object message) &#123; for (ChannelHandler listener : channelHandlers) &#123; try &#123; listener.received(channel, message); &#125; catch (Throwable t) &#123; logger.error(t.getMessage(), t); &#125; &#125;&#125; æœç´¢äº†ä¸‹ ChannelHandlerDispatcher çš„ä½¿ç”¨æƒ…å†µï¼Œä¸»è¦ç”¨åœ¨ dubbo-remoting-p2p çš„ AbstractGroup ä¸­ã€‚ 7.3 ChannelHandlerDelegatecom.alibaba.dubbo.remoting.transport.ChannelHandlerDelegate ï¼Œå®žçŽ° ChannelHandler æŽ¥å£ï¼Œé€šé“å¤„ç†å™¨è£…é¥°è€…æŽ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 1ChannelHandler getHandler(); æ­£å¦‚ï¼Œæˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­è¯´é“ï¼Œè£…é¥°å™¨æ¨¡å¼ï¼Œåœ¨ dubbo-remoting-api æ‰®æ¼”äº†éžå¸¸é‡è¦çš„è§’è‰²ï¼Œé‚£ä¹ˆæœ€ä½³æ¼”å‘˜å°±æ˜¯ ChannelHandlerDelegate ä»¬ã€‚ä¸‹é¢ï¼Œå¼€å§‹ä»–ä»¬çš„è¡¨æ¼”ã€‚ 7.3.1 AbstractChannelHandlerDelegatecom.alibaba.dubbo.remoting.transport.AbstractChannelHandlerDelegate ï¼Œå®žçŽ° ChannelHandlerDelegate æŽ¥å£ï¼Œé€šé“å¤„ç†å™¨è£…é¥°è€…æŠ½è±¡å®žçŽ°ç±»ã€‚åœ¨æ¯ä¸ªå®žçŽ°çš„æ–¹æ³•é‡Œï¼Œç›´æŽ¥è°ƒç”¨è¢«è£…é¥°çš„ handler å±žæ€§çš„æ–¹æ³•ã€‚ 7.3.2 DecodeHandlercom.alibaba.dubbo.remoting.transport.DecodeHandler ï¼Œå®žçŽ° AbstractChannelHandlerDelegate æŠ½è±¡ç±»ï¼Œè§£ç å¤„ç†å™¨ï¼Œå¤„ç†æŽ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œå®žçŽ°äº† Decodeable æŽ¥å£çš„æƒ…å†µã€‚ è¦†å†™äº† #received(channel, message) æ–¹æ³• 12345678910111213141516 1: @Override 2: public void received(Channel channel, Object message) throws RemotingException &#123; 3: if (message instanceof Decodeable) &#123; 4: decode(message); 5: &#125; 6: 7: if (message instanceof Request) &#123; 8: decode(((Request) message).getData()); 9: &#125;10:11: if (message instanceof Response) &#123;12: decode(((Response) message).getResult());13: &#125;14:15: handler.received(channel, message);16: &#125; ç¬¬ 3 è‡³ 5 è¡Œï¼šå½“æ¶ˆæ¯æ˜¯ Decodeable ç±»åž‹æ—¶ï¼Œè°ƒç”¨ #decode(message) æ–¹æ³•ï¼Œè§£æžæ¶ˆæ¯ã€‚ ç¬¬ 7 è‡³ 9 è¡Œï¼šå½“æ¶ˆæ¯æ˜¯ Request ç±»åž‹æ—¶ï¼Œè°ƒç”¨ #decode(message) æ–¹æ³•ï¼Œè§£æž data å±žæ€§ã€‚ ç¬¬ 11 è‡³ 13 è¡Œï¼šå½“æ¶ˆæ¯æ˜¯ Response ç±»åž‹æ—¶ï¼Œè°ƒç”¨ #decode(message) æ–¹æ³•ï¼Œè§£æž result å±žæ€§ã€‚ ç¬¬ 15 è¡Œï¼šè°ƒç”¨ ChannelHandler#received(channel, message) æ–¹æ³•ï¼Œå°†æ¶ˆæ¯äº¤ç»™å§”æ‰˜çš„ handler ï¼Œç»§ç»­å¤„ç†ã€‚ðŸ™‚ èƒ–å‹æ˜¯å¦æ„Ÿå—åˆ°ï¼Œè£…é¥°å™¨æ¨¡å¼çš„å¥½å¤„ï¼šé€šè¿‡ç»„åˆçš„æ–¹å¼ï¼Œå®žçŽ°åŠŸèƒ½çš„å åŠ ã€‚ è§£æžæ¶ˆæ¯ 1234567891011121314 1: private void decode(Object message) &#123; 2: if (message != null &amp;&amp; message instanceof Decodeable) &#123; 3: try &#123; 4: ((Decodeable) message).decode(); // è§£æžæ¶ˆæ¯ 5: if (log.isDebugEnabled()) &#123; 6: log.debug(new StringBuilder(32).append("Decode decodeable message ").append(message.getClass().getName()).toString()); 7: &#125; 8: &#125; catch (Throwable e) &#123; 9: if (log.isWarnEnabled()) &#123;10: log.warn(new StringBuilder(32).append("Call Decodeable.decode failed: ").append(e.getMessage()).toString(), e);11: &#125;12: &#125; // ~ end of catch13: &#125; // ~ end of if14: &#125; // ~ end of method decode ç¬¬ 2 è‡³ 4 è¡Œï¼šå½“ç±»åž‹æ˜¯ Decodeable æ—¶ï¼Œè°ƒç”¨ Decodeable#decode() æ–¹æ³•ï¼Œè¿›ä¸€æ­¥è§£æžã€‚ åœ¨ dubbo-rpc-default é¡¹ç›®ä¸­ï¼ŒDecodeableRpcInvocation å’Œ DecodeableRpcResult å®žçŽ° Decodeable æŽ¥å£ï¼ŒåŽé¢æˆ‘ä»¬æ¥åˆ†äº«ã€‚ 7.3.3 MultiMessageHandlercom.alibaba.dubbo.remoting.transport.MultiMessageHandler ï¼Œå®žçŽ° AbstractChannelHandlerDelegate æŠ½è±¡ç±»ï¼Œå¤šæ¶ˆæ¯å¤„ç†å™¨ï¼Œå¤„ç†ä¸€æ¬¡æ€§æŽ¥æ”¶åˆ°å¤šæ¡æ¶ˆæ¯çš„æƒ…å†µã€‚ è¦†å†™äº† #received(channel, message) æ–¹æ³• 1234567891011 1: @Override 2: public void received(Channel channel, Object message) throws RemotingException &#123; 3: if (message instanceof MultiMessage) &#123; // å¤šæ¶ˆæ¯ 4: MultiMessage list = (MultiMessage) message; 5: for (Object obj : list) &#123; 6: handler.received(channel, obj); 7: &#125; 8: &#125; else &#123; 9: handler.received(channel, message);10: &#125;11: &#125; ç¬¬ 3 è‡³ 7 è¡Œï¼šå½“æ¶ˆæ¯æ˜¯ MultiMessage ç±»åž‹ï¼Œå³å¤šæ¶ˆæ¯ï¼Œå¾ªçŽ¯æäº¤ç»™ handler å¤„ç†ã€‚ ç¬¬ 8 è‡³ 10 è¡Œï¼šå½“å•æ¶ˆæ¯æ—¶ï¼Œç›´æŽ¥æäº¤ç»™ handler å¤„ç†ã€‚ ðŸ™‚ åœ¨ä¸‹é¢çš„æ–‡ç« ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° ChannelHandlerDelegate çš„ç»„åˆä½¿ç”¨çš„ä¾‹å­ã€‚ 8. Dispacheræœ¬å°èŠ‚å†…å®¹ï¼Œå¯¹åº” ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” çº¿ç¨‹æ¨¡åž‹ã€‹ ã€‚ ç®€å•æ¦‚æ‹¬è¿™èŠ‚ï¼Œä»¥æŽ¥æ”¶æ¶ˆæ¯ä¸¾ä¾‹å­ï¼Œä»£ç å¦‚ä¸‹ï¼š 123executor.execute(new Runnable() &#123; handler.received(channel, message)&#125;); å°† ChannelHandler çš„å…·ä½“æ“ä½œï¼Œè°ƒåº¦åˆ°çº¿ç¨‹æ± ä¸­ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæ¨¡å—å« dispacher çš„åŽŸå› ã€‚ 8.1 ChannelHandlerscom.alibaba.dubbo.remoting.transport.dispatcher.ChannelHandlers ï¼Œé€šé“å¤„ç†å™¨å·¥åŽ‚ã€‚åœ¨ä¸Šæ–‡ ã€Œ3.1 AbstractClientã€ ï¼Œæˆ‘ä»¬çœ‹åˆ° AbstractClient#wrapChannelHandler(url, handler) æ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨ ChannelHandlers#wrap(url, handler) æ–¹æ³•ã€‚å®žé™…ä¸Šï¼ŒServer éƒ¨åˆ†ä¹Ÿä¼šæœ‰è¿™æ ·ç±»ä¼¼çš„é€»è¾‘ï¼Œåªæ˜¯ä»£ç å®žçŽ°ä¸Šæš‚æœªç»Ÿä¸€ã€‚ä»¥ dubbo-remoting-netty4 æ¥ä¸¾ä¾‹å­ï¼š NettyClient ï¼š 123public NettyClient(final URL url, final ChannelHandler handler) throws RemotingException &#123; super(url, wrapChannelHandler(url, handler));&#125; NettyServer ï¼š 123public NettyServer(URL url, ChannelHandler handler) throws RemotingException &#123; super(url, ChannelHandlers.wrap(handler, ExecutorUtil.setThreadName(url, SERVER_THREAD_POOL_NAME) /* è®¾ç½®çº¿ç¨‹ååˆ° URL ä¸Š */));&#125; æ— è®º Client è¿˜æ˜¯ Server ï¼Œéƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå°†ä¼ å…¥çš„ handler ï¼Œæœ€ç»ˆä½¿ç”¨ ChannelHandlers è¿›è¡Œä¸€æ¬¡åŒ…è£…ã€‚OK ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åŒ…è£…é€šé“å¤„ç†å™¨çš„å…·ä½“ä»£ç ï¼š 12345678910111213141516 1: /** 2: * å•ä¾‹ 3: */ 4: private static ChannelHandlers INSTANCE = new ChannelHandlers(); 5: 6: public static ChannelHandler wrap(ChannelHandler handler, URL url) &#123; 7: return ChannelHandlers.getInstance().wrapInternal(handler, url); 8: &#125; 9:10: protected ChannelHandler wrapInternal(ChannelHandler handler, URL url) &#123;11: return new MultiMessageHandler(12: new HeartbeatHandler(13: ExtensionLoader.getExtensionLoader(Dispatcher.class).getAdaptiveExtension().dispatch(handler, url)14: )15: );16: &#125; ç¬¬ 11 è‡³ 15 è¡Œï¼šåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±çœ‹åˆ°äº†å¤šä¸ª ChannelHandlerDelegate çš„ç»„åˆã€‚åŒ…æ‹¬ï¼Œç¬¬ 15 è¡Œçš„ï¼ŒDispatcher#dispatch(handler, url) æ–¹æ³•ï¼Œå®žé™…ä¸Šä¹Ÿæ˜¯è¿”å›žä¸€ä¸ª ChannelHandlerDelegate å¯¹è±¡ã€‚ 8.2 Dispatcher å®žçŽ°ç±»åœ¨ Dubbo ä¸­ï¼Œæœ‰å¤šç§ Dispatcher çš„å®žçŽ°ï¼Œå¦‚ä¸‹ï¼š FROM ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” çº¿ç¨‹æ¨¡åž‹ã€‹ all æ‰€æœ‰æ¶ˆæ¯éƒ½æ´¾å‘åˆ°çº¿ç¨‹æ± ï¼ŒåŒ…æ‹¬è¯·æ±‚ï¼Œå“åº”ï¼Œè¿žæŽ¥äº‹ä»¶ï¼Œæ–­å¼€äº‹ä»¶ï¼Œå¿ƒè·³ç­‰ã€‚ direct æ‰€æœ‰æ¶ˆæ¯éƒ½ä¸æ´¾å‘åˆ°çº¿ç¨‹æ± ï¼Œå…¨éƒ¨åœ¨ IO çº¿ç¨‹ä¸Šç›´æŽ¥æ‰§è¡Œã€‚ message åªæœ‰è¯·æ±‚å“åº”æ¶ˆæ¯æ´¾å‘åˆ°çº¿ç¨‹æ± ï¼Œå…¶å®ƒè¿žæŽ¥æ–­å¼€äº‹ä»¶ï¼Œå¿ƒè·³ç­‰æ¶ˆæ¯ï¼Œç›´æŽ¥åœ¨ IO çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚ execution åªè¯·æ±‚æ¶ˆæ¯æ´¾å‘åˆ°çº¿ç¨‹æ± ï¼Œä¸å«å“åº”ï¼Œå“åº”å’Œå…¶å®ƒè¿žæŽ¥æ–­å¼€äº‹ä»¶ï¼Œå¿ƒè·³ç­‰æ¶ˆæ¯ï¼Œç›´æŽ¥åœ¨ IO çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚ connection åœ¨ IO çº¿ç¨‹ä¸Šï¼Œå°†è¿žæŽ¥æ–­å¼€äº‹ä»¶æ”¾å…¥é˜Ÿåˆ—ï¼Œæœ‰åºé€ä¸ªæ‰§è¡Œï¼Œå…¶å®ƒæ¶ˆæ¯æ´¾å‘åˆ°çº¿ç¨‹æ± ã€‚ å­ç±»ç±»å›¾ 8.2.1 AllDispatcheræˆ‘ä»¬ä»¥ all å¯¹åº”çš„ AllDispatcher ä¸¾ä¾‹å­ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789public class AllDispatcher implements Dispatcher &#123; public static final String NAME = "all"; public ChannelHandler dispatch(ChannelHandler handler, URL url) &#123; return new AllChannelHandler(handler, url); &#125;&#125; åœ¨è¯¥ç±»çš„ #dispatch(...) çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ›å»º AllChannelHandler å¯¹è±¡ï¼Œå¹¶ä¼ å…¥ handler å±žæ€§ã€‚ðŸ™‚ èªæ…§å¦‚ä½ ï¼Œå·²ç»çŒœåˆ° AllChannelHandler ä¹Ÿæ˜¯ ChannelHandlerDelegate ç±»åž‹ã€‚ä¹Ÿå°±æ˜¯è¯´â€œçº¿ç¨‹æ¨¡åž‹â€ï¼Œä¹Ÿæ˜¯é€šè¿‡è£…é¥°å™¨æ¨¡å¼ï¼Œç»„åˆè€Œæˆã€‚ æ¯ä¸ª Dispatcher å®žçŽ°ç±»ï¼Œéƒ½å¯¹åº”ä¸€ä¸ª ChannelHandler å®žçŽ°ç±»ã€‚é»˜è®¤æœªé…ç½®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ AllDispatcher è°ƒåº¦ã€‚ 8.2.2 AllChannelHandlercom.alibaba.dubbo.remoting.transport.dispatcher.all.AllChannelHandler ï¼Œå®žçŽ° WrappedChannelHandler æŠ½è±¡ç±»ã€‚è¦†å†™ #connected(channel) æ–¹æ³•å¦‚ä¸‹ï¼š WrappedChannelHandler æ˜¯å®žçŽ° ChannelHandlerDelegate çš„æŠ½è±¡ç±»ï¼Œä¸‹æ–‡å†çœ‹ã€‚ 123456789@Overridepublic void connected(Channel channel) throws RemotingException &#123; ExecutorService cexecutor = getExecutorService(); try &#123; cexecutor.execute(new ChannelEventRunnable(channel, handler, ChannelState.CONNECTED)); &#125; catch (Throwable t) &#123; throw new ExecutionException("connect event", channel, getClass() + " error when process connected event .", t); &#125;&#125; åˆ›å»º ChannelEventRunnable å¯¹è±¡ï¼Œæäº¤ç»™çº¿ç¨‹æ± æ‰§è¡Œã€‚ æ³¨æ„ï¼Œä¼ å…¥çš„çŠ¶æ€ä¸º ChannelState.CONNECTED ã€‚ä¸åŒçš„å®žçŽ°æ–¹æ³•ï¼Œå¯¹åº”ä¸åŒçš„çŠ¶æ€ã€‚ 8.3 ChannelEventRunnablecom.alibaba.dubbo.remoting.transport.dispatcher.ChannelEventRunnable ï¼Œå®žçŽ° Runnable æŽ¥å£ã€‚ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±çœ‹å™¢ã€‚ä¸»è¦åˆ†æˆä¸‰éƒ¨åˆ†ï¼š æž„é€ æ–¹æ³• ChannelState #run() æ–¹æ³•ï¼Œç®€åŒ–ä»£ç å¦‚ä¸‹ï¼š 1234567891011@Overridepublic void run() &#123; switch (state) &#123; case CONNECTED: handler.connected(channel); break; case DISCONNECTED:handler.disconnected(channel); break; case SENT:handler.sent(channel, message);break; case RECEIVED:handler.received(channel, message);break; case CAUGHT:handler.caught(channel, exception);break; default: logger.warn("unknown state: " + state + ", message is " + message); &#125;&#125; 8.4 WrappedChannelHandlercom.alibaba.dubbo.remoting.transport.dispatcher.WrappedChannelHandler ï¼Œå®žçŽ° ChannelHandlerDelegate æŽ¥å£ï¼ŒåŒ…è£…çš„ WrappedChannelHandler å®žçŽ°ç±»ã€‚ ä»Žç›®å‰çš„å®žçŽ°æ¥çœ‹ï¼ŒWrappedChannelHandler ç»§æ‰¿ AbstractChannelHandlerDelegate æ›´åˆé€‚ï¼Œå› ä¸º #connected(channel) ç­‰ï¼Œå®žçŽ°çš„æ–¹æ³•éƒ½æ˜¯ç›¸åŒçš„ã€‚ æž„é€ æ–¹æ³• 12345678910111213141516171819202122232425262728 1: /** 2: * çº¿ç¨‹æ±  3: */ 4: protected final ExecutorService executor; 5: /** 6: * é€šé“å¤„ç†å™¨ 7: */ 8: protected final ChannelHandler handler; 9: /**10: * URL11: */12: protected final URL url;13:14: public WrappedChannelHandler(ChannelHandler handler, URL url) &#123;15: this.handler = handler;16: this.url = url;17:18: // åˆ›å»ºçº¿ç¨‹æ± 19: executor = (ExecutorService) ExtensionLoader.getExtensionLoader(ThreadPool.class).getAdaptiveExtension().getExecutor(url);20:21: // æ·»åŠ çº¿ç¨‹æ± åˆ° DataStore ä¸­22: String componentKey = Constants.EXECUTOR_SERVICE_COMPONENT_KEY;23: if (Constants.CONSUMER_SIDE.equalsIgnoreCase(url.getParameter(Constants.SIDE_KEY))) &#123;24: componentKey = Constants.CONSUMER_SIDE;25: &#125;26: DataStore dataStore = ExtensionLoader.getExtensionLoader(DataStore.class).getDefaultExtension();27: dataStore.put(componentKey, Integer.toString(url.getPort()), executor);28: &#125; ç¬¬ 19 è¡Œï¼šåŸºäºŽ Dubbo SPI Adaptive æœºåˆ¶ï¼Œåˆ›å»ºçº¿ç¨‹æ± ã€‚ ç¬¬ 21 è‡³ 27 è¡Œï¼šæ·»åŠ çº¿ç¨‹æ± åˆ° DataStore ä¸­ã€‚ðŸ™‚ è¿™å°±æ˜¯ä¸Šæ–‡ AbstractClient æˆ– AbstractServer ä»Ž DataStore èŽ·å¾—çº¿ç¨‹æ± çš„æ–¹å¼ã€‚å½“ç„¶ï¼Œå®˜æ–¹ä¹Ÿè¯´äº†ï¼Œè¿™ç§æ–¹å¼ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œæœ‰ç‚¹å¥‡æ·«æŠ€å·§ï¼Œæœªæ¥ä¼šä¼˜åŒ–æŽ‰ã€‚ å…±äº«çº¿ç¨‹æ±  åœ¨ WrappedChannelHandler ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…ç½®çš„å…±äº«çº¿ç¨‹æ± ï¼Œå¦‚ä¸‹ï¼š 1protected static final ExecutorService SHARED_EXECUTOR = Executors.newCachedThreadPool(new NamedThreadFactory("DubboSharedHandler", true)); ã€TODO 8024ã€‘æžä¸æ‡‚ï¼Œè¿™ä¸ªè®¾è®¡çš„æ„å›¾ï¼Œå…ˆmarkç•™ç€ã€‚ å­ç±»ç±»å›¾ 9. Codec9.1 CodecSupportcom.alibaba.dubbo.remoting.transport.CodecSupport ï¼Œç¼–è§£ç å·¥å…·ç±»ï¼Œæä¾›æŸ¥è¯¢ Serialization çš„åŠŸèƒ½ã€‚ åˆå§‹åŒ– 1234567891011121314151617181920212223242526272829/** * åºåˆ—åŒ–å¯¹è±¡é›†åˆ * keyï¼šåºåˆ—åŒ–ç±»åž‹ç¼–å· &#123;@link Serialization#getContentTypeId()&#125; */private static Map&lt;Byte, Serialization&gt; ID_SERIALIZATION_MAP = new HashMap&lt;Byte, Serialization&gt;();/** * åºåˆ—åŒ–åé›†åˆ * keyï¼šåºåˆ—åŒ–ç±»åž‹ç¼–å· &#123;@link Serialization#getContentTypeId()&#125; * value: åºåˆ—åŒ–æ‹“å±•å */private static Map&lt;Byte, String&gt; ID_SERIALIZATIONNAME_MAP = new HashMap&lt;Byte, String&gt;();static &#123; // åŸºäºŽ Dubbo SPI ï¼Œåˆå§‹åŒ– Set&lt;String&gt; supportedExtensions = ExtensionLoader.getExtensionLoader(Serialization.class).getSupportedExtensions(); for (String name : supportedExtensions) &#123; Serialization serialization = ExtensionLoader.getExtensionLoader(Serialization.class).getExtension(name); byte idByte = serialization.getContentTypeId(); if (ID_SERIALIZATION_MAP.containsKey(idByte)) &#123; logger.error("Serialization extension " + serialization.getClass().getName() + " has duplicate id to Serialization extension " + ID_SERIALIZATION_MAP.get(idByte).getClass().getName() + ", ignore this Serialization extension"); continue; &#125; ID_SERIALIZATION_MAP.put(idByte, serialization); ID_SERIALIZATIONNAME_MAP.put(idByte, name); &#125;&#125; Dubbo æä¾›äº†å¤šç§åºåˆ—åŒ–æ–¹å¼ï¼Œæ­¤å¤„åˆå§‹åŒ–ç»“æžœï¼Œå¦‚ä¸‹å›¾ï¼š æŸ¥æ‰¾ Serialization å¯¹è±¡ 123456789101112public static Serialization getSerialization(URL url, Byte id) throws IOException &#123; Serialization serialization = getSerializationById(id); String serializationName = url.getParameter(Constants.SERIALIZATION_KEY, Constants.DEFAULT_REMOTING_SERIALIZATION); // é»˜è®¤ï¼Œhessian2 // å‡ºäºŽå®‰å…¨çš„ç›®çš„ï¼Œé’ˆå¯¹ JDK çš„åºåˆ—åŒ–æ–¹å¼ï¼ˆå¯¹åº”ç¼–å·ä¸º 3ã€4ã€7ï¼‰ï¼Œæ£€æŸ¥è¿žæŽ¥åˆ°æœåŠ¡å™¨çš„ URL å’Œå®žé™…ä¼ è¾“çš„æ•°æ®ï¼Œåè®®æ˜¯å¦ä¸€è‡´ã€‚ // https://github.com/apache/incubator-dubbo/issues/1138 // Check if "serialization id" passed from network matches the id on this side(only take effect for JDK serialization), for security purpose. if (serialization == null || ((id == 3 || id == 7 || id == 4) &amp;&amp; !(serializationName.equals(ID_SERIALIZATIONNAME_MAP.get(id))))) &#123; throw new IOException("Unexpected serialization id:" + id + " received from network, please check if the peer send the right id."); &#125; return serialization;&#125; ðŸ™‚ åœ¨æœ€æ–°çš„ Dubbo ç‰ˆæœ¬ä¸­ï¼Œå·²ç»å°† serialization æ¨¡å—ï¼Œä»Ž dubbo-common ä¸­ï¼Œç‹¬ç«‹æˆ dubbo-serialization ã€‚So ï¼Œæˆ‘ä»¬åŽé¢å¼€ä¸€ä¸ªç³»åˆ—æ¥åˆ†äº«ã€‚ 9.2 AbstractCodeccom.alibaba.dubbo.remoting.transport.AbstractCodec ï¼Œå®žçŽ° Codec2 æŽ¥å£ï¼Œæä¾›å¦‚ä¸‹å…¬ç”¨æ–¹æ³•ï¼š #checkPayload(channel, size) é™æ€æ–¹æ³•ï¼Œæ ¡éªŒæ¶ˆæ¯é•¿åº¦ã€‚ #getSerialization(channel) æ–¹æ³•ï¼ŒèŽ·å¾— Serialization å¯¹è±¡ã€‚ #isClientSide(channel) æ–¹æ³•ï¼Œæ˜¯å¦ä¸ºå®¢æˆ·ç«¯ä¾§çš„é€šé“ã€‚ #isServerSide(channel) æ–¹æ³•ï¼Œæ˜¯å¦ä¸ºæœåŠ¡ç«¯ä¾§çš„é€šé“ã€‚ å­ç±»ç±»å›¾ ç¼–è§£ç å™¨çš„å®žçŽ°ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼ŒèŽ·å¾—æ›´å¤šçš„åŠŸèƒ½ã€‚æ¯ä¸€ä¸ª Codec2 ç±»å®žçŽ°å¯¹ä¸åŒæ¶ˆæ¯çš„ç¼–è§£ç ã€‚é€šè¿‡åè®®å¤´æ¥åˆ¤æ–­ï¼Œå…·ä½“ä½¿ç”¨å“ªä¸ªç¼–è§£ç é€»è¾‘ã€‚å¬èµ·æ¥æœ‰ç‚¹ç»•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€æ®µç®€åŒ– ExchangeCodec çš„ #decode(...) ä¾‹å­ï¼š 1234567891011121: protected Object decode(Channel channel, ChannelBuffer buffer, int readable, byte[] header) throws IOException &#123;2: // check magic number.3: if (readable &gt; 0 &amp;&amp; header[0] != MAGIC_HIGH4: || readable &gt; 1 &amp;&amp; header[1] != MAGIC_LOW) &#123;5: // ... çœç•¥6: return super.decode(channel, buffer, readable, header);7: &#125;8:9: // ... çœç•¥10:11: return decodeBody(channel, is, header);12: &#125; ç¬¬ 2 è‡³ 7 è¡Œï¼šé€šè¿‡ magic number åˆ¤æ–­åˆ°ï¼Œå¹¶éž Dubbo Exchange ä¿¡æ¯äº¤æ˜“çš„åè®®å¤´ï¼Œè½¬äº¤ç»™çˆ¶ç±» TelnetCodec å¤„ç†ï¼Œä¸€èˆ¬æ­¤æ—¶æ˜¯ Telnet æ¶ˆæ¯ã€‚ ç¬¬ 8 è‡³ 11 è¡Œï¼šé€šè¿‡ magic number åˆ¤æ–­åˆ°ï¼Œç¬¦åˆ Dubbo Exchange ä¿¡æ¯äº¤æ˜“çš„åè®®å¤´ï¼ŒExchangeCodec è‡ªå·±å¤„ç†ã€‚ 9.2.1 TransportCodeccom.alibaba.dubbo.remoting.transport.codec.TransportCodec ï¼Œä¼ è¾“ç¼–è§£ç å™¨ï¼Œä½¿ç”¨ Serialization è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œç›´æŽ¥ç¼–è§£ç ã€‚ ç¼–ç æ¶ˆæ¯ 12345678910111213 1: @Override 2: public void encode(Channel channel, ChannelBuffer buffer, Object message) throws IOException &#123; 3: // èŽ·å¾—ååºåˆ—åŒ–çš„ ObjectOutput å¯¹è±¡ 4: OutputStream output = new ChannelBufferOutputStream(buffer); 5: ObjectOutput objectOutput = getSerialization(channel).serialize(channel.getUrl(), output); 6: // å†™å…¥ ObjectOutput 7: encodeData(channel, objectOutput, message); 8: objectOutput.flushBuffer(); 9: // é‡Šæ”¾10: if (objectOutput instanceof Cleanable) &#123;11: ((Cleanable) objectOutput).cleanup();12: &#125;13: &#125; ç¬¬ 3 è‡³ 5 è¡Œï¼šèŽ·å¾—å¯¹åº”çš„ Serialization å¯¹è±¡ï¼Œå¹¶åˆ›å»ºç”¨äºŽååºåˆ—åŒ–çš„ ObjectOutput å¯¹è±¡ã€‚ä¸åŒçš„ Serialization å®žçŽ°ï¼Œå¯¹åº”ä¸åŒçš„ ObjectOutput å®žçŽ°ç±»ã€‚ðŸ™‚ è¿™é‡Œï¼Œæˆ‘ä»¬åªè¦è¯»æ‡‚å¤§ä½“æµç¨‹ï¼Œè¯¦ç»†çš„ï¼Œæˆ‘ä»¬åŽé¢æ–‡ç« è§ã€‚ ç¬¬ 7 è¡Œï¼šè°ƒç”¨ #encodeData(channel, objectOutput, message) æ–¹æ³•ï¼Œå†™å…¥ ObjectOutputã€‚ä»£ç å¦‚ä¸‹ï¼š 1234567protected void encodeData(Channel channel, ObjectOutput output, Object message) throws IOException &#123; encodeData(output, message);&#125;protected void encodeData(ObjectOutput output, Object message) throws IOException &#123; output.writeObject(message);&#125; ç¬¬ 9 è‡³ 12 è¡Œï¼šé‡Šæ”¾èµ„æºã€‚ç›®å‰ï¼Œä»…æœ‰ kryo çš„ KryoObjectInput ã€KryoObjectOutput å®žçŽ°äº† Cleanable æŽ¥å£ï¼Œéœ€è¦é‡Šæ”¾èµ„æºã€‚ è§£ç æ¶ˆæ¯ #decode(channel, buffer) å®žçŽ°æ–¹æ³•ï¼Œå’Œè§£ç æ¶ˆæ¯åŸºæœ¬ä¸€è‡´ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹ã€‚ 9.3 CodecAdaptercom.alibaba.dubbo.remoting.transport.codec.CodecAdapter ï¼Œå®žçŽ° Code2 æŽ¥å£ï¼ŒCodec é€‚é…å™¨ï¼Œå°† Codec é€‚é…æˆ Codec2 ã€‚ ðŸ™‚ ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹ã€‚ 666. å½©è›‹ ä»£ç æ¯”è¾ƒå¤šï¼Œå¦‚æžœä¸ç†Ÿæ‚‰ Netty ç­‰æ¡†æž¶çš„èƒ–å‹ï¼Œå¯èƒ½ä¼šä¸€è„¸æ‡µé€¼çš„çœ‹åˆ°æ–‡æœ«ã€‚å»ºè®®èƒ–å‹ç»“åˆå¦‚ä¸‹çš„ä»£ç ï¼š 12345678910// Netty.javanew ChannelInitializer&lt;NioSocketChannel&gt;() &#123; @Override protected void initChannel(NioSocketChannel ch) &#123; NettyCodecAdapter adapter = new NettyCodecAdapter(getCodec(), getUrl(), NettyServer.this); ch.pipeline().addLast("decoder", adapter.getDecoder()) // è§£ç  .addLast("encoder", adapter.getEncoder()) // è§£ç  .addLast("handler", nettyServerHandler); // å¤„ç†å™¨ &#125;&#125; åœ¨è„‘è¡¥ Debug + IDE Debug ï¼Œå¤šè€ƒè™‘ä¸‹ã€‚ æŽ¨èé˜…è¯»ï¼š ã€ŠDubboæºä»£ç å®žçŽ°å…­ï¼šçº¿ç¨‹æ± æ¨¡åž‹ä¸Žæä¾›è€…ã€‹ ã€ŠDubboæºä»£ç åˆ†æžå…«ï¼šå†è¯´Providerçº¿ç¨‹æ± è¢«EXHAUSTEDã€‹]]></content>
      <categories>
        <category>Dubbo</category>
        <category>remoting-api-interface</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SparkåŽŸç†æ¡ˆä¾‹åŠæ­å»º]]></title>
    <url>%2F2019%2F08%2F02%2FSpark%E5%8E%9F%E7%90%86%E6%A1%88%E4%BE%8B%E5%8F%8A%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡åŸºäºŽSpark 2.3.1 scala 2.11 RDDç®—å­a resilient distributed dataset (RDD), which is a collection of elements partitioned across the nodes of the cluster that can be operated on in parallel Transformationç®—å­http://spark.apache.org/docs/latest/rdd-programming-guide.html#transformations æ‡’æ‰§è¡Œï¼Œè¿”å›žå€¼ä¾ç„¶æ˜¯RDD map filter flatMap groupByKey reduceByKey mapValues sort Actionç®—å­http://spark.apache.org/docs/latest/rdd-programming-guide.html#actions è§¦å‘çœŸæ­£æ‰§è¡Œï¼Œè¿”å›žå€¼ä¸å†æ˜¯RDD reduceä¸éœ€è¦æ ¹æ®keyåˆ†ç»„ï¼Œç›´æŽ¥è¿›è¡Œèšåˆï¼ŒreduceåŒå­æ²¡å¿…è¦å¿…é¡»ä½œç”¨åœ¨KVæ ¼å¼çš„RDDä¸Š collectå°†RDDçš„å…ƒç´ æ”¶é›†å›žæ¥ï¼Œæ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚æ…Žç”¨ï¼Œä¸€èˆ¬åœ¨æµ‹è¯•çŽ¯å¢ƒä½¿ç”¨ countRDDæŒä¹…åŒ–http://spark.apache.org/docs/latest/rdd-programming-guide.html#rdd-persistence cache cacheç®—å­å°†æ•°æ®ä¿å­˜åˆ°å†…å­˜ä¸­ cacheç®—å­æ˜¯æ‡’åŠ è½½ç®—å­ï¼Œéœ€è¦Actionç®—å­è§¦å‘æ‰§è¡Œ cache æ˜¯ persistç®€åŒ–ç‰ˆ StorageLevel åŠç”Ÿå¯¹è±¡ deseriliezd ä¸åºåˆ—åŒ–çš„æ„æ€ï¼Œ åºåˆ—åŒ–ï¼Œå ç”¨ç©ºé—´å° persistStorageLevelä¼˜å…ˆçº§ MEMORY_ONLY åªæ”¾å†…å­˜ï¼Œä¸å¤Ÿæ”¾å¼ƒã€‚é‡Šæ”¾ï¼š1.è‡ªåŠ¨ttlï¼Œ2.æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ unpersistã€‚ MEMORY_ONLY_SER MEMORY_AND_DISK_SER å†…å­˜æ”¾ä¸äº†ï¼Œå†æ”¾ç£ç›˜ DISK_ONLY ä¸å»ºè®®ä½¿ç”¨ ä¸€ä¸ªactionç®—å­ï¼Œå°±æ˜¯ä¸€ä¸ªJob standloneéƒ¨ç½²spark-env.sh ä¿®æ”¹123456789101112131415161718# masterIPSPARK_MASTER_HOST=node01# masteré€šä¿¡ç«¯å£SPARK_MASTER_PORT=7077# å¿ƒè·³è¶…æ—¶æ—¶é—´SPARK_MASTER_OPTS="-Dspark.worker.timeout=100"# webUIç«¯å£SPARK_MASTER_WEBUI_PORT=8888# æ—¥å¿—å­˜æ”¾ä½ç½®SPARK_LOCAL_DIRS="/var/zfg/spark"# workerè¿›ç¨‹æ‰€ç®¡ç†çš„æ ¸å¿ƒæ•°SPARK_WORKER_CORES=2# workerè¿›ç¨‹æ‰€ç®¡ç†çš„å†…å­˜æ•°SPARK_WORKER_MEMORY=3G# è®¡ç®—å·¥ä½œåŒºSPARK_WORKER_DIR="/var/zfg/spark/work"# å·¥ä½œåŒºæ–‡ä»¶çš„æœ‰æ•ˆæœŸSPARK_WORKER_OPTS="-Dspark.worker.cleanup.enabled=true -Dspark.worker.cleanup.appDataTtl=259200" slaveä¿®æ”¹123node02node03node04 sbinçš„ç›®å½•ä¸‹çš„spark-config.sh æ–‡ä»¶ä¸‹æ·»åŠ  1export JAVA_HOME=/usr/install/jdk/jdk1.8.0_171 çŽ¯å¢ƒå˜é‡é…ç½®çŽ¯å¢ƒå˜é‡ï¼Œsbin binæ·»åŠ åˆ°path start-all.sh æ”¹åstart-spark.sh scpåˆ°node02 node03 node04å¯åŠ¨å¯åŠ¨ start-spark.sh è®¿é—® http://node01:8888 åŠ¨æ€æ·»åŠ worker1./sbin/start-slave.sh &lt;master-spark-URL&gt; spark shellé›†ç¾¤æ–¹å¼ 1./bin/spark-shell --master spark://IP:PORT æœ¬åœ°æ–¹å¼ 1./bin/spark-shell REPLè¯»ã€æ‰§è¡Œã€æ‰“å°ã€å¾ªçŽ¯ standalone HAéƒ¨ç½²Spark Standalone Mode - Spark 2.4.3 Documentation Configuration - Spark 2.4.3 Documentation å¤„äºŽactiveçŠ¶æ€çš„masterï¼Œä¼šå°†æ”¶é›†çš„å…ƒä¿¡æ¯æ”¾åˆ°zookeeperï¼ŒåŒ…æ‹¬workerä¸ªæ•°ï¼Œåœ°å€ã€‚ å¤‡ç”¨masterç›‘å¬zkï¼Œé€šçŸ¥activeæŒ‚äº†ã€‚å¤‡ç”¨masterä¼šä»Žzkä¸­è¯»å–å…ƒæ•°æ®åˆ°å†…å­˜ï¼Œé€šçŸ¥workerä»¥åŽçš„ä¸»ã€å¿ƒè·³å‘é€ é…ç½®SPARK_DAEMON_JAVA_OPTS in spark-env by configuring spark.deploy.recoveryMode and related spark.deploy.zookeeper.* configurations. 1SPARK_DAEMON_JAVA_OPTS="-Dspark.deploy.recoveryMode=ZOOKEEPER spark.deploy.zookeeper.url=node02:2181,node03:2181,node04:2181 -Dspark.deploy.zookeeper.dir=spark201908" å°†spark-env.sh åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ å¯åŠ¨start-spark.shï¼Œå‘çŽ°åªæœ‰ä¸€ä¸ªmaster åœ¨node02ä¸­ï¼Œä¿®æ”¹SPARK_MASTER_HOST=node02ï¼Œå† start-masterå¯åŠ¨ å¤‡ç”¨ node02 start-master.shMaster=node02 RECAVering å‡†å¤‡åˆ‡æ¢çŠ¶æ€ æœ¯è¯­ Master(standalone)ï¼šèµ„æºç®¡ç†çš„ä¸»èŠ‚ç‚¹(è¿›ç¨‹) Cluster Managerï¼šåœ¨é›†ç¾¤ä¸ŠèŽ·å–èµ„æºçš„å¤–éƒ¨æœåŠ¡(ä¾‹å¦‚standalone,Mesos,Yarn ) Worker Node(standalone)ï¼šèµ„æºç®¡ç†çš„ä»ŽèŠ‚ç‚¹(è¿›ç¨‹) æˆ–è€…è¯´ç®¡ç†æœ¬æœºèµ„æºçš„è¿›ç¨‹ Applicationï¼šåŸºäºŽSparkçš„â½¤ç”¨æˆ·ç¨‹åºï¼ŒåŒ…å«äº†driverç¨‹åºå’Œè¿è¡Œåœ¨é›†ç¾¤ä¸Šçš„executorç¨‹åº Driver Programï¼šç”¨æ¥è¿žæŽ¥å·¥ä½œè¿›ç¨‹ï¼ˆWorkerï¼‰çš„ç¨‹åº Executorï¼šæ˜¯åœ¨ä¸€ä¸ªworkerè¿›ç¨‹æ‰€ç®¡ç†çš„èŠ‚ç‚¹ä¸Šä¸ºæŸApplicationå¯åŠ¨çš„â¼€ä¸€ä¸ªè¿›ç¨‹ï¼Œè¯¥è¿› ç¨‹è´Ÿè´£è¿è¡Œä»»åŠ¡ï¼Œå¹¶ä¸”è´Ÿè´£å°†æ•°æ®å­˜åœ¨å†…å­˜æˆ–è€…ç£ç›˜ä¸Šã€‚æ¯ä¸ªåº”â½¤ç”¨éƒ½æœ‰å„è‡ªç‹¬â½´ç«‹çš„ executors Taskï¼šè¢«é€åˆ°æŸä¸ªexecutorä¸Šçš„å·¥ä½œå•å…ƒ Jobï¼šåŒ…å«å¾ˆå¤šä»»åŠ¡(Task)çš„å¹¶è¡Œè®¡ç®—ï¼Œå¯ä»¥çœ‹åšå’Œactionå¯¹Jobï¼šåŒ…å«å¾ˆå¤šä»»åŠ¡(Task)çš„å¹¶è¡Œè®¡ç®—ï¼Œå¯ä»¥çœ‹åšå’Œactionå¯¹våº” Stageï¼šâ¼€ä¸ªJobä¼šè¢«æ‹†åˆ†å¾ˆå¤šç»„ä»»åŠ¡ï¼Œæ¯ç»„ä»»åŠ¡è¢«ç§°ä¸ºStage(å°±åƒMapreduceåˆ†map task å’Œreduce taskä¸€æ ·) å®½ä¾èµ– å®½ä¾èµ–ï¼šçˆ¶RDDçš„åˆ†åŒºï¼šå­RDDçš„åˆ†åŒºï¼Œ1å¯¹å¤š å¯¼è‡´å®½ä¾èµ–çš„ç®—å­: groupByKey å®½ä¾èµ–å’Œshuffleæ˜¯ä¸€ä¸€å¯¹åº”çš„ çª„ä¾èµ– map fitler union ä¸ä¼šå¯¼è‡´å®½ä¾èµ– çª„ä¾èµ–ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿshuffle Stageåˆ‡å‰²è§„åˆ™ æŒ‰å®½ä¾èµ–è¿›è¡Œåˆ’åˆ†ï¼Œè¿žç€çš„çª„ä¾èµ–ä¸ºä¸€ä¸ªstage æ­£æ˜¯æœ‰äº†å®½çª„ä¾èµ–ï¼Œæ‰èƒ½å°†jobåˆ‡åˆ†æˆä¸€ä¸ªä¸ªstage ä¸€ä¸ªstageçš„taskä¸ªæ•°ï¼ˆå¹¶å‘æ•°ï¼‰ï¼Œä»¥æœ€åŽä¸€ä¸ªRDDçš„åˆ†åŒºæ•°ä¸ºå‡† pipelineæ“ä½œ ä¸€ä¸ªstageå†…ï¼ˆéƒ½æ˜¯çª„ä¾èµ–ï¼‰è¿›è¡Œpipelineæ“ä½œ è®¡ç®—å‘æ•°æ®ç§»åŠ¨ï¼ŒCã€Dã€Fçš„è®¡ç®—éƒ½å¯ä»¥ç§»åŠ¨åˆ°Cæ“ä½œ ä¸ºä»€ä¹ˆæœ‰æ‡’æ‰§è¡Œç®—å­ï¼Œå°±æ˜¯ä¸ºäº†æž„å»ºpipelineï¼Œå¢žåŠ å¹¶è¡Œåº¦ ä¸¾ä¾‹12345val RDD = sc.textFile(hdfs)val filterRDD = RDD.filter(x =&gt; x.contains("Ab"))val mapRDD = filterRDD.map(x =&gt; x+"~")val flatMapRDD = mapRDD.flatMap(x =&gt; x.split(" "))flatMapRDD.collect task1æœ€å¥½åœ¨B1æ‰§è¡Œ task2æœ€å¥½åœ¨B2æ‰§è¡Œ æŒä¹…åŒ–ç®¡é“ä¸­çš„æ•°æ®ä»€ä¹ˆæ—¶å€™æŒä¹…åŒ–åˆ°ç£ç›˜ shuttle çš„writeçš„é˜¶æ®µï¼ˆstageå’Œstageä¹‹é—´ï¼Œshuttfle write å’Œ shuttfle readï¼‰ å¯¹ä¸€ä¸ªRDDæ‰§è¡Œäº†æŒä¹…åŒ–ç®—å­(persist) ä»»åŠ¡è°ƒåº¦ ä»»åŠ¡é‡è¯• é»˜è®¤å€¼é‡è¯•3æ¬¡ ï¼Œ åŠ ä¸Š1æ¬¡ï¼Œä¸€å…±4æ¬¡ã€‚é‡è¯•æ¬¡æ•°ä¸º4-1=3 http://spark.apache.org/docs/latest/configuration.html#scheduling spark.task.maxFailures 4 Number of failures of any particular task before giving up on the job. The total number of failures spread across different tasks will not cause the job to fail; a particular task has to fail this number of attempts. Should be greater than or equal to 1. Number of allowed retries = this value - 1. 1.ä»£ç é…ç½® 2.spark-default.xmlé…ç½®æ–‡ä»¶ 3.æäº¤Applicationçš„æ—¶å€™ï¼Œå¸¸ç”¨ 1spark-submit --conf spark.task.maxFailures=10 æŒ£æ‰Žçš„ä»»åŠ¡TaskSchedulerè´Ÿè´£ä»»åŠ¡çš„é‡è¯•ï¼Œå’ŒæŒ£æ‰Žçš„ä»»åŠ¡(æŽ¨æµ‹æ‰§è¡Œ) æŽ¨æµ‹è¿‡ç¨‹ 75%çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®ŒæˆåŽï¼Œä¼šæ¯éš”100msæ¥é‰´å®šä¸€æ¬¡å‰©ä½™çš„taskæ˜¯å¦æ˜¯æŒ£æ‰Žçš„taskã€‚é‰´å®šè¿‡ç¨‹ï¼š25taskçš„æ‰§è¡Œæ—¶é—´ï¼ŒæŒ‰ç…§æ‰§è¡Œæ—¶é—´æ¥æŽ’åºï¼Œå–ä¸­ä½æ•°10sï¼Œ10s*1.5å€æ•°=15sã€‚25taskä¸­å¤§äºŽè¿™ä¸ª15sçš„ä»»åŠ¡å°±æ˜¯æŒ£æ‰Žçš„ä»»åŠ¡ã€‚ spark.speculation false If set to â€œtrueâ€, performs speculative execution of tasks. This means if one or more tasks are running slowly in a stage, they will be re-launched. spark.speculation.interval 100ms How often Spark will check for tasks to speculate. spark.speculation.multiplier 1.5 How many times slower a task is than the median to be considered for speculation. spark.speculation.quantile 0.75 Fraction of tasks which must be complete before speculation is enabled for a particular stage. stageé‡è¯•DAGSchedulerè´Ÿè´£é‡è¯•stageï¼Œé»˜è®¤é‡è¯•æ¬¡æ•°ä¸º4 spark.stage.maxConsecutiveAttempts 4 Number of consecutive stage attempts allowed before a stage is aborted. å•æœºæ‰§è¡Œ3hï¼ŒSparkå¹¶è¡Œæ‰§è¡Œå´è¦12hï¼Ÿï¼Ÿ å¯èƒ½å‘ç”Ÿæ•°æ®å€¾æ–œï¼Œ99task 100Mï¼Œ1task 1T-100M å¯èƒ½å¼€å¯äº†æŽ¨æµ‹æ‰§è¡Œï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½1taskä¸ºæŒ£æ‰Žçš„taskï¼Œé‚£ä¹ˆTaskSchedulerä¼šæ–°èµ·ä¸€ä¸ªtaskå’ŒæŒ£æ‰Žçš„taskæ¯”èµ›æ‰§è¡Œ è§£å†³æ–¹æ¡ˆï¼š å…³é—­æŽ¨æµ‹æ‰§è¡Œ è§£å†³æ•°æ®å€¾æ–œé—®é¢˜ èµ„æºè°ƒåº¦ DAGScheduler taskshceduler å­˜åœ¨äºŽdriverä¸­ ä¸ºäº†é˜²æ­¢masteråŽ‹åŠ›è¿‡å¤§ï¼Œéƒ½è¦å¢žåŠ client client spark-submit é€šè¿‡æ‰§è¡ŒMainå‡½æ•°ï¼Œå¯åŠ¨ä¸€ä¸ªdriverè¿›ç¨‹ã€‚åˆ›å»ºsparkContextï¼ŒåŒæ—¶åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼ŒDAGScheduler,TaskSchedulerã€‚ èµ„æºè°ƒåº¦è¿‡ç¨‹ TaskScheduleråˆ›å»ºæˆåŠŸåŽï¼Œä¼šæ‰¾masterï¼Œç»™å½“å‰applicationç”³è¯·èµ„æºã€‚ masterä¼šæŸ¥çœ‹è‡ªå·±çš„èµ„æºæƒ…å†µï¼Œå‘Šè¯‰workerèŠ‚ç‚¹ï¼Œå¯åŠ¨ä¸€ä¸ªexecutorè¿›ç¨‹ã€‚é»˜è®¤ä½¿ç”¨1Gå†…å­˜ï¼Œæ‰€æœ‰æ ¸ã€‚ excutorå¯åŠ¨æˆåŠŸåŽï¼Œä¼šåå‘æ³¨å†Œç»™TaskScheduler DAGSchedulerï¼Œæ ¹æ®RDDçš„å®½çª„ä¾èµ–åˆ‡åˆ†stageï¼Œå°†ä¸€ä¸ªä¸ªstageæäº¤ç»™taskSehduler TaskSchedulerï¼ŒæŽ¥æ”¶åˆ°stageä¹‹åŽï¼ŒéåŽ†æ‹¿åˆ°æ¯ä¸ªtaskï¼Œè°ƒç”¨HDFSçš„æ–¹æ³•ï¼Œå¾—åˆ°blockä½ç½®ã€‚å°†taskåˆ†å‘åˆ°æ•°æ®èŠ‚ç‚¹æ‰§è¡Œã€‚ å¤‡æ³¨ å®Œå…¨ä¸€è‡´éƒ¨ç½²ï¼Œä¹Ÿä¸èƒ½é¿å…æ•°æ®ç§»åŠ¨ã€‚ä¹Ÿæœ‰å¯èƒ½ä»Žå…¶ä»–èŠ‚ç‚¹æ‹‰å–æ•°æ®ï¼Œåœ¨èŠ‚ç‚¹è®¡ç®—ã€‚ å¯åŠ¨Exetoræˆ–è€…ç”³è¯·èµ„æºï¼Œä¸ä¼šè€ƒè™‘æ•°æ®çš„ä½ç½®ã€‚ å¯¹æ¯” Spark MR on YARN ç±»åž‹ ç²—ç²’åº¦çš„èµ„æºè°ƒåº¦ ç»†ç²’åº¦çš„èµ„æºè°ƒåº¦ è¿‡ç¨‹ åœ¨æäº¤Applicationçš„æ—¶å€™ï¼ŒtaskSchedulerå…ˆåŽ»ç”³è¯·èµ„æºã€‚ç„¶åŽtaskScheduleråˆ†å‘ä»»åŠ¡ï¼Œæ‰§è¡Œæ‰€æœ‰taskæ‰§è¡Œå®Œæ¯•ï¼Œæ‰é‡Šæ”¾è¿™éƒ¨åˆ†èµ„æºã€‚ åœ¨æäº¤Applicaitonçš„æ—¶å€™ï¼Œå…ˆå‘æ•°æ®èŠ‚ç‚¹åˆ†å‘taskï¼Œtaskè‡ªå·±åŽ»ç”³è¯·èµ„æºã€‚å¦‚æžœç”³è¯·åˆ°äº†èµ„æºï¼Œç«‹å³æ‰§è¡Œã€‚å¦åˆ™ä¸€ç›´ç­‰å¾…ã€‚å½“taskæ‰§è¡Œå®Œæ¯•ï¼Œç«‹å³é‡Šæ”¾èµ„æºã€‚ ä¼˜ç‚¹ 1. æ¯ä¸€ä¸ªtaskçš„ç­‰å¾…æ—¶é—´å˜çŸ­äº† 2.å¯ä»¥èµ„æºå¤ç”¨ é›†ç¾¤èµ„æºèƒ½å……åˆ†åˆ©ç”¨ ç¼ºç‚¹ 10000task 9999task 1taskæ²¡æ‰§è¡Œå®Œï¼Œæ— æ³•å……åˆ†åˆ©ç”¨é›†ç¾¤èµ„æº taskçš„ç­‰å¾…æ—¶é—´å¤ªé•¿ æºç è§£è¯» workerè¿›ç¨‹å¯åŠ¨æˆåŠŸåŽï¼Œä¼šå‘masteræ³¨å†Œï¼Œå‘é€workerçš„ç®¡ç†çš„èµ„æºä¿¡æ¯ å½“workerå¯åŠ¨å®Œæ¯•åŽï¼Œä¼šå®šæœŸå‘masterå‘é€å¿ƒè·³ï¼Œæ­¤æ—¶ä¸ä¼šæºå¸¦workerçš„èµ„æºä¿¡æ¯ï¼Œåªä¼šæºå¸¦å½“å‰workerçš„idå·ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªworkerèŠ‚ç‚¹ä¸ºå½“å‰çš„ApplicationæŒ‡å®šå¯åŠ¨ä¸€ä¸ª1executorï¼Œè¿™ä¸ªexecutoré»˜è®¤ä½¿ç”¨1G æ‰€æœ‰çš„core clientæŒ‡å®šdriverä¸åœ¨æœ¬åœ°æ‰§è¡Œï¼Œä¸ºDriverç”³è¯·èµ„æºï¼Œ1G 1core masteræŸ¥è¯¢workersä¿¡æ¯ï¼ŒéšæœºæŒ‡å®šworker2å¯åŠ¨å¯åŠ¨Driverè¿›ç¨‹ã€‚ 1spark-submit --class org.apache.spark.examples.SparkPi --master spark://node01:7077 --deploy-mode cluster --driver-memory 1g --num-executors 2 --executor-memory 1g --executor-cores 1 /opt/sxt/spark-2.3.1/examples/jars/spark-examples_2.11-2.3.1.jar 1spark-submit --class org.apache.spark.examples.SparkPi --master spark://node01:7077 --deploy-mode cluster --total-executor-cores=6 --executor-memory 1g --executor-cores 1 /opt/sxt/spark-2.3.1/examples/jars/spark-examples_2.11-2.3.1.jar ` 1spark.deploy.spreadOut=true é»˜è®¤æƒ…å†µä¸‹ï¼ˆåœ¨æäº¤Applicationçš„æ—¶å€™ï¼Œæ²¡æœ‰æŒ‡å®šâ€“executor-coresï¼‰ï¼Œæ¯ä¸€ä¸ªworkerèŠ‚ç‚¹ä¸ºå½“å‰çš„Applicationåªå¯åŠ¨1ä¸ªExecutorï¼Œè¿™ä¸ªExecutorä½¿ç”¨æ‰€æœ‰çš„æ ¸ å¦‚æžœæƒ³è¦ä¸€ä¸ªWorkerèŠ‚ç‚¹ä¸Šå¯åŠ¨å¤šä¸ªExecutorï¼Œé‚£ä¹ˆåœ¨æäº¤Applicationçš„æ—¶å€™éœ€è¦æŒ‡å®š--executor-coresè¿™ä¸ªé€‰é¡¹ spark.deploy.spreadOuté»˜è®¤ä¸ºtrueï¼Œè¡¨ç¤ºè½®è¯¢åœ¨workerså¯åŠ¨executor 1spark-submit --class org.apache.spark.examples.SparkPi --master spark://node01:7077 --deploy-mode cluster --total-executor-cores=6 --executor-memory 1g --executor-cores 1 --spark.deploy.spreadOut false /opt/sxt/spark-2.3.1/examples/jars/spark-examples_2.11-2.3.1.jar å‚è€ƒ https://spark.apache.org/docs/latest/spark-standalone.html]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[stormæ­å»ºåŠåŽŸç†åˆ†æž]]></title>
    <url>%2F2019%2F06%2F23%2Fstorm%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[http://storm.apache.org/ ç¼–ç¨‹æ¨¡åž‹ DAG ï¼ˆTopologyï¼‰æœ‰å‘æ— çŽ¯å›¾Spout â€“ æ•°æ®æº nextTuple Spoutä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯nextTupleï¼Œè¯¥æ–¹æ³•ä¼šè¢«Stormçº¿ç¨‹ä¸æ–­è°ƒç”¨ã€ä¸»åŠ¨ä»Žæ•°æ®æºæ‹‰å–æ•°æ®ï¼Œå†é€šè¿‡emitæ–¹æ³•å°†æ•°æ®ç”Ÿæˆå…ƒç»„ï¼ˆTupleï¼‰å‘é€ç»™ä¹‹åŽçš„Boltè®¡ç®— OutputFieldsDeclarer å¯å…ˆé€šè¿‡OutputFieldsDeclarerä¸­çš„declareæ–¹æ³•å£°æ˜Žå®šä¹‰çš„ä¸åŒæ•°æ®æµï¼Œå‘é€æ•°æ®æ—¶é€šè¿‡SpoutOutputCollectorä¸­çš„emitæ–¹æ³•æŒ‡å®šæ•°æ®æµIdï¼ˆstreamIdï¼‰å‚æ•°å°†æ•°æ®å‘é€å‡ºåŽ» Bolt â€“ æ•°æ®æµå¤„ç†ç»„ä»¶Boltï¼šå¤„ç†è€…ï¼Œå¯ä»¥æœ‰å¤šä¸ªã€‚å¤šä¸ªboltå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚ ä¸€ä¸ªBoltå¯ä»¥å‘é€å¤šä¸ªæ•°æ®æµï¼ˆStreamï¼‰ OutputFieldsDeclarer å¯å…ˆé€šè¿‡OutputFieldsDeclarerä¸­çš„declareæ–¹æ³•å£°æ˜Žå®šä¹‰çš„ä¸åŒæ•°æ®æµï¼Œå‘é€æ•°æ®æ—¶é€šè¿‡SpoutOutputCollectorä¸­çš„emitæ–¹æ³•æŒ‡å®šæ•°æ®æµIdï¼ˆstreamIdï¼‰å‚æ•°å°†æ•°æ®å‘é€å‡ºåŽ» execute Boltä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯executeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è´Ÿè´£æŽ¥æ”¶åˆ°ä¸€ä¸ªå…ƒç»„ï¼ˆTupleï¼‰æ•°æ®ã€çœŸæ­£å®žçŽ°æ ¸å¿ƒçš„ä¸šåŠ¡é€»è¾‘ Stream Grouping â€“ æ•°æ®æµåˆ†ç»„ï¼ˆå³æ•°æ®åˆ†å‘ç­–ç•¥ï¼‰é«˜å¯é æ€§å¼‚å¸¸å¤„ç† æ¶ˆæ¯å¯é æ€§ä¿éšœæœºåˆ¶(ACK) æµå¼å¤„ç†å¼‚æ­¥æ–¹å¼ æµå¼å¤„ç†ï¼ˆå¼‚æ­¥ ä¸Ž åŒæ­¥ï¼‰ å®¢æˆ·ç«¯æäº¤æ•°æ®è¿›è¡Œç»“ç®—ï¼Œå¹¶ä¸ä¼šç­‰å¾…æ•°æ®è®¡ç®—ç»“æžœ é€æ¡å¤„ç† ä¾‹ï¼šETLï¼ˆæ•°æ®æ¸…æ´—ï¼‰extracted transform load ç»Ÿè®¡åˆ†æž ä¾‹ï¼šè®¡ç®—PVã€UVã€è®¿é—®çƒ­ç‚¹ ä»¥åŠ æŸäº›æ•°æ®çš„èšåˆã€åŠ å’Œã€å¹³å‡ç­‰ â€‹ å®¢æˆ·ç«¯æäº¤æ•°æ®ä¹‹åŽï¼Œè®¡ç®—å®Œæˆç»“æžœå­˜å‚¨åˆ°Redisã€HBaseã€MySQLæˆ–è€…å…¶ä»–MQå½“ä¸­ï¼Œ â€‹ å®¢æˆ·ç«¯å¹¶ä¸å…³å¿ƒæœ€ç»ˆç»“æžœæ˜¯å¤šå°‘ã€‚ åŒæ­¥æ–¹å¼å®¢æˆ·ç«¯æäº¤æ•°æ®è¯·æ±‚ä¹‹åŽï¼Œç«‹åˆ»å–å¾—è®¡ç®—ç»“æžœå¹¶è¿”å›žç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯é€šè¿‡å’ŒDRPC serveräº¤äº’ï¼Œç«‹åˆ»å–å¾—è¿”å›žç»“æžœ å’ŒMapReduceæ¯”è¾ƒ Stormï¼šè¿›ç¨‹ã€çº¿ç¨‹å¸¸é©»å†…å­˜è¿è¡Œï¼Œæ•°æ®ä¸è¿›å…¥ç£ç›˜ï¼Œæ•°æ®é€šè¿‡ç½‘ç»œä¼ é€’ã€‚ MapReduceï¼šä¸ºTBã€PBçº§åˆ«æ•°æ®è®¾è®¡çš„æ‰¹å¤„ç†è®¡ç®—æ¡†æž¶ã€‚ å’ŒSpark Streamingæ¯”è¾ƒ Stormï¼šçº¯æµå¼å¤„ç†ï¼Œæ¯«ç§’çº§ ä¸“é—¨ä¸ºæµå¼å¤„ç†è®¾è®¡ æ•°æ®ä¼ è¾“æ¨¡å¼æ›´ä¸ºç®€å•ï¼Œå¾ˆå¤šåœ°æ–¹ä¹Ÿæ›´ä¸ºé«˜æ•ˆ å¹¶ä¸æ˜¯ä¸èƒ½åšæ‰¹å¤„ç†ï¼Œå®ƒä¹Ÿå¯ä»¥æ¥åšå¾®æ‰¹å¤„ç†ï¼Œæ¥æé«˜åžå Spark Streamingï¼šå¾®æ‰¹å¤„ç†ï¼Œç§’çº§ å°†RDDåšçš„å¾ˆå°æ¥ç”¨å°çš„æ‰¹å¤„ç†æ¥æŽ¥è¿‘æµå¼å¤„ç† åŸºäºŽå†…å­˜å’ŒDAGå¯ä»¥æŠŠå¤„ç†ä»»åŠ¡åšçš„å¾ˆå¿« æ•°æ®ç´¯åŠ demoä»£ç å‚è€ƒeclipse-hadoop-workspace/ws é›†ç¾¤å®‰è£…1python -V nimbus supervisor zookeeper node01 * node02 * * node03 * * node04 * scpå®‰è£…åŒ…åˆ°node01 apache-storm-0.10.0.tar.gz 12345678910111213141516$ vim conf/storm.yamlstorm.zookeeper.servers: - "node02" - "node03" - "node04"storm.local.dir: "/tmp/storm"nimbus.host: "node01"# slot ä»£è¡¨ä¸€ä¸ªè¿›ç¨‹supervisor.slots.ports: - 6700 - 6701 - 6702 - 6703 12scp -r apache-storm-0.10.0 root@node02:`pwd`scp -r apache-storm-0.10.0 root@node03:`pwd` 123çŽ¯å¢ƒå˜é‡é…ç½®export STORM_HOME=/opt/sxt/stormexport PATH=$PATH:$STORM_HOME/bin åœ¨stormç›®å½•ä¸­åˆ›å»ºlogsç›®å½•12cd $STORM_HOMEmkdir logs node01ä¸Šå¯åŠ¨Nimbus1234storm nimbus &gt;&gt; ./logs/nimbus.out 2&gt;&amp;1 &amp;tail -f logs/nimbus.logstorm ui &gt;&gt; ./logs/ui.out 2&gt;&amp;1 &amp;tail -f logs/ui.log èŠ‚ç‚¹node2å’Œnode3å¯åŠ¨supervisorï¼ŒæŒ‰ç…§é…ç½®ï¼Œæ¯å¯åŠ¨ä¸€ä¸ªsupervisorå°±æœ‰äº†4ä¸ªslots1234cd $STORM_HOMEmkdir logsstorm supervisor &gt;&gt; ./logs/supervisor.out 2&gt;&amp;1 &amp;tail -f logs/supervisor.log å¸®åŠ©å‘½ä»¤12storm helpstorm help jar kill1storm kill test webè¿ç»´é¡µé¢ http://node01:8080/ é›†ç¾¤æäº¤æäº¤ä»»åŠ¡åˆ°Stormé›†ç¾¤å½“ä¸­è¿è¡Œï¼šä»£ç å‚è€ƒ(eclipse-hadoop-workspace/wordcount) srcæ‰“åŒ…ï¼Œtestä¸ºå‚æ•°è¡¨ç¤ºé›†ç¾¤æ–¹å¼è¿è¡Œï¼Œä½œä¸ºtopologyåç§° 1storm jar wordcount.jar com.sxt.storm.test.Test test 123456789101112131415if (args.length&gt;0) &#123; try &#123; StormSubmitter.submitTopology(args[0], config, tb.createTopology()); &#125; catch (AlreadyAliveException e) &#123; e.printStackTrace(); &#125; catch (InvalidTopologyException e) &#123; e.printStackTrace(); &#125;&#125; else &#123; LocalCluster lc = new LocalCluster(); lc.submitTopology("wordcount", config, tb.createTopology());&#125; æµç¨‹ï¼š spout â€”&gt; bolt(åˆ‡åˆ†å•è¯)â€”&gt; bolt(è®¡æ•°) æž¶æž„è®¾è®¡ Nimbus èµ„æºè°ƒåº¦ ä»»åŠ¡åˆ†é… æŽ¥æ”¶jaråŒ… Supervisor æŽ¥æ”¶nimbusåˆ†é…çš„ä»»åŠ¡ å¯åŠ¨ã€åœæ­¢è‡ªå·±ç®¡ç†çš„workerè¿›ç¨‹ï¼ˆå½“å‰supervisorä¸Šworkeræ•°é‡ç”±é…ç½®æ–‡ä»¶è®¾å®šï¼‰ Worker è¿è¡Œå…·ä½“å¤„ç†è¿ç®—ç»„ä»¶çš„è¿›ç¨‹ï¼ˆæ¯ä¸ªWorkerå¯¹åº”æ‰§è¡Œä¸€ä¸ªTopologyçš„å­é›†ï¼‰ workerä»»åŠ¡ç±»åž‹ï¼Œå³spoutä»»åŠ¡ã€boltä»»åŠ¡ä¸¤ç§ å¯åŠ¨executor â€‹ ï¼ˆexecutorå³worker JVMè¿›ç¨‹ä¸­çš„ä¸€ä¸ªjavaçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤æ¯ä¸ªexecutorè´Ÿè´£æ‰§è¡Œä¸€ä¸ªtaskä»»åŠ¡ï¼‰ ä¸Žhadoop yarnå¯¹æ¯” Hadoop Storm ä¸»èŠ‚ç‚¹ ResourceManager Nimbus ä»ŽèŠ‚ç‚¹ NodeManager Supervisor åº”ç”¨ç¨‹åº Job Topology å·¥ä½œè¿›ç¨‹ Child Worker è®¡ç®—æ¨¡åž‹ Map/Reduce(split,map,shuffle,reduce) Spout/Bolt è¿è¡Œè¿‡ç¨‹ æäº¤jaråŒ…åˆ°nimbus/inboxç›®å½•ä¸‹ å¯¹topologyè¿›è¡Œæ ¡éªŒå¤„ç† nimbus/stormdist/${topology-id}ä¸‹ï¼ŒåŒ…å«jaråŒ…ã€stormcodeåºåˆ—åŒ–æ–¹æ³•ã€stormconfè¿è¡Œé…ç½® nimbusåˆå§‹åŒ–spout/boltçš„taskï¼Œå†™åˆ°zookeeperçš„/tasksèŠ‚ç‚¹ä¸‹ nimbusåˆ›å»º/taskbeatsçš„zkèŠ‚ç‚¹ï¼Œç›‘æŽ§taskå¿ƒè·³ å°†ä»»åŠ¡åˆ†é…ä¿¡æ¯ï¼Œå†™åˆ°zk assignment/${topology-id}èŠ‚ç‚¹ä¸­ï¼Œæ­¤æ—¶è®¤ä¸ºä»»åŠ¡æäº¤å®Œæ¯• åœ¨zkçš„storms/${topology-id}ä¸‹å­˜æ”¾ä»»åŠ¡çš„è¿è¡Œæ—¶é—´ã€çŠ¶æ€ä¿¡æ¯ æœ¬åœ°ç›®å½•æ ‘ zookeeperç›®å½•æ ‘ Storm DRPCåŽŸç† DRPC (Distributed RPC) remote procedure call åˆ†å¸ƒå¼è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ DRPC æ˜¯é€šè¿‡ä¸€ä¸ª DRPC æœåŠ¡ç«¯(DRPC server)æ¥å®žçŽ°åˆ†å¸ƒå¼ RPC åŠŸèƒ½çš„ã€‚ DRPC Server è´Ÿè´£æŽ¥æ”¶ RPC è¯·æ±‚ï¼Œå¹¶å°†è¯¥è¯·æ±‚å‘é€åˆ° Stormä¸­è¿è¡Œçš„ Topologyï¼Œç­‰å¾…æŽ¥æ”¶ Topology å‘é€çš„å¤„ç†ç»“æžœï¼Œå¹¶å°†è¯¥ç»“æžœè¿”å›žç»™å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯ã€‚ ï¼ˆå…¶å®žï¼Œä»Žå®¢æˆ·ç«¯çš„è§’åº¦æ¥è¯´ï¼ŒDPRC ä¸Žæ™®é€šçš„ RPC è°ƒç”¨å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ï¼‰ DRPCè®¾è®¡ç›®çš„ï¼š ä¸ºäº†å……åˆ†åˆ©ç”¨Stormçš„è®¡ç®—èƒ½åŠ›å®žçŽ°é«˜å¯†åº¦çš„å¹¶è¡Œå®žæ—¶è®¡ç®—ã€‚ ï¼ˆStormæŽ¥æ”¶è‹¥å¹²ä¸ªæ•°æ®æµè¾“å…¥ï¼Œæ•°æ®åœ¨Topologyå½“ä¸­è¿è¡Œå®Œæˆï¼Œç„¶åŽé€šè¿‡DRPCå°†ç»“æžœè¿›è¡Œè¾“å‡ºã€‚ï¼‰ éƒ¨ç½²1vi storm.yaml 12drpc.servers: - "node01" 12scp storm.yaml root@node02:`pwd`scp storm.yaml root@node03:`pwd` node01æ‰§è¡Œ 123456nohup storm nimbus &gt;&gt; ./logs/nimbus.out 2&gt;&amp;1 &amp;tail -f logs/nimbus.lognohup storm drpc &gt;&gt; ./logs/drpc.out 2&gt;&amp;1 &amp;tail -f logs/drpc.lognohup storm ui &gt;&gt; ./logs/ui.out 2&gt;&amp;1 &amp;tail -f logs/ui.log node02 node03æ‰§è¡Œ 123cd $STORM_HOMEnohup storm supervisor &gt;&gt; ./logs/supervisor.out 2&gt;&amp;1 &amp;tail -f logs/supervisor.log ä»£ç å‚è€ƒeclipse-hadoop-workspace/StormDemo 1scp drpc.jar root@node01:/root/ 1storm jar drpc.jar com.sxt.storm.drpc.BasicDRPCTopology test å®¢æˆ·ç«¯æ‰§è¡Œç»“æžœ 123456789101112131415public class MyDRPCclient &#123; public static void main(String[] args) &#123; DRPCClient client = new DRPCClient("node01", 3772); try &#123; String result = client.execute("exclamation", "11,22"); System.out.println(result); &#125; catch (TException e) &#123; e.printStackTrace(); &#125; catch (DRPCExecutionException e) &#123; e.printStackTrace(); &#125; &#125;&#125; Storm å®¹é”™æœºåˆ¶é›†ç¾¤èŠ‚ç‚¹å®•æœº NimbusæœåŠ¡å™¨ å•ç‚¹æ•…éšœï¼Ÿ éžNimbusæœåŠ¡å™¨ æ•…éšœæ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸Šæ‰€æœ‰Taskä»»åŠ¡éƒ½ä¼šè¶…æ—¶ï¼ŒNimbusä¼šå°†è¿™äº›Taskä»»åŠ¡é‡æ–°åˆ†é…åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œ è¿›ç¨‹æŒ‚æŽ‰WorkeræŒ‚æŽ‰æ—¶ï¼ŒSupervisorä¼šé‡æ–°å¯åŠ¨è¿™ä¸ªè¿›ç¨‹ã€‚å¦‚æžœå¯åŠ¨è¿‡ç¨‹ä¸­ä»ç„¶ä¸€ç›´å¤±è´¥ï¼Œå¹¶ä¸”æ— æ³•å‘Nimbuså‘é€å¿ƒè·³ï¼ŒNimbusä¼šå°†è¯¥Workeré‡æ–°åˆ†é…åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Š Supervisoræ— çŠ¶æ€ï¼ˆæ‰€æœ‰çš„çŠ¶æ€ä¿¡æ¯éƒ½å­˜æ”¾åœ¨Zookeeperä¸­æ¥ç®¡ç†ï¼‰ å¿«é€Ÿå¤±è´¥ï¼ˆæ¯å½“é‡åˆ°ä»»ä½•å¼‚å¸¸æƒ…å†µï¼Œéƒ½ä¼šè‡ªåŠ¨æ¯ç­ï¼‰ Nimbusæ— çŠ¶æ€ï¼ˆæ‰€æœ‰çš„çŠ¶æ€ä¿¡æ¯éƒ½å­˜æ”¾åœ¨Zookeeperä¸­æ¥ç®¡ç†ï¼‰ å¿«é€Ÿå¤±è´¥ï¼ˆæ¯å½“é‡åˆ°ä»»ä½•å¼‚å¸¸æƒ…å†µï¼Œéƒ½ä¼šè‡ªåŠ¨æ¯ç­ï¼‰ æ¶ˆæ¯çš„å®Œæ•´æ€§ ä»ŽSpoutä¸­å‘å‡ºçš„Tupleï¼Œä»¥åŠåŸºäºŽä»–æ‰€äº§ç”ŸTupleï¼ˆä¾‹å¦‚ä¸Šä¸ªä¾‹å­å½“ä¸­Spoutå‘å‡ºçš„å¥å­ï¼Œä»¥åŠå¥å­å½“ä¸­å•è¯çš„tupleç­‰ï¼‰ ç”±è¿™äº›æ¶ˆæ¯å°±æž„æˆäº†ä¸€æ£µtupleæ ‘ å½“è¿™æ£µtupleæ ‘å‘é€å®Œæˆï¼Œå¹¶ä¸”æ ‘å½“ä¸­æ¯ä¸€æ¡æ¶ˆæ¯éƒ½è¢«æ­£ç¡®å¤„ç†ï¼Œå°±è¡¨æ˜Žspoutå‘é€æ¶ˆæ¯è¢«â€œå®Œæ•´å¤„ç†â€ï¼Œå³æ¶ˆæ¯çš„å®Œæ•´æ€§ ä¸­å›½ç§»åŠ¨é¡¹ç›®ä»£ç å‚è€ƒcmccstormjk02 å’Œcmcc02_hbase hbase1create 'cell_monitor_table','cf']]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[hadoopæ—¥å¿—åˆ†æžå®žæˆ˜é¡¹ç›®æ­å»ºåŠåˆ†æž]]></title>
    <url>%2F2019%2F06%2F21%2Fhadoop%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[æ•´ä½“é¡¹ç›®æµç¨‹ jsæˆ–è€…java sdkè®¿é—®nginxæä¾›çš„æŽ¥å£ï¼Œnginxå†™å…¥è®¿é—®æ—¥å¿—æ–‡ä»¶ flume tail -Fç›‘æŽ§æ—¥å¿—æ–‡ä»¶ï¼Œå­˜å‚¨æ—¥å¿—åˆ°hdfs é€šè¿‡Mapper Reducer ä»»åŠ¡ï¼Œæ¸…æ´—æ—¥å¿—ä¸ºæ ‡å‡†çš„æ•°æ®ï¼Œå­˜å‚¨åˆ°hbase é€šè¿‡map reduce ä»»åŠ¡ï¼ŒæŒ‰ä¸åŒçš„ç»´åº¦ï¼Œç»Ÿè®¡æ•°æ®ï¼Œå†™å…¥åˆ°mysqlã€‚æˆ–è€…ä½¿ç”¨hiveå»ºç«‹å¤–éƒ¨è¡¨ï¼Œå…³è”hbaseï¼Œé€šè¿‡spoopï¼Œè½¬æ¢hiveæ•°æ®åˆ°mysqlã€‚ tengineå®‰è£…å‚è€ƒ http://tengine.taobao.org/document/install.html Nginxæ–‡æ¡£ngx_http_log_moduleæ¨¡å— å®‰è£…1234yum install gcc openssl-devel pcre-devel zlib-devel -y# æœç´¢yum search é…ç½®nginx.confçš„httpæ¨¡å—ä¸‹é…ç½® 1log_format my_format '$remote_addr^A$msec^A$http_host^A$request_uri'; serveré…ç½®è®¿é—®æ—¥å¿—çš„æ ¼å¼å’Œæ–‡ä»¶åœ°å€ 1234location = /log.gif &#123; default_type image/gif; access_log /opt/data/access.log my_format;&#125; å¯åŠ¨1./n flumeå®‰è£…å•èŠ‚ç‚¹å‚è€ƒæ–‡æ¡£ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#a-simple-example ä¸Šä¼ è§£åŽ‹123scp apache-flume-1.6.0-bin.tar.gz root@node02:/roottar -zxvf apache-flume-1.6.0-bin.tar.gzmv apache-flume-1.6.0-bin/ /usr/install/ é…ç½®çŽ¯å¢ƒå˜é‡12vi /etc/profilesource /etc/profile 12export FLUME_HOME=/usr/install/apache-flume-1.6.0-binexport PATH=$PATH:$ZOOKEEPER_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$HIVE_HOME/bin:$HBASE_HOME/bin:$FLUME_HOME/bin ä¿®æ”¹conf/flume-env.sh æ–‡ä»¶ä¸­çš„JDKç›®å½•12cp flume-env.sh.template flume-env.shvi flume-env.sh 1export JAVA_HOME=/usr/install/jdk/jdk1.8.0_171 éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ1flume-ng version ä¿®æ”¹é…ç½®12cd conf/vi simple.conf 12345678910111213141516171819202122# Name the components on this agenta1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = netcata1.sources.r1.bind = node02a1.sources.r1.port = 44444# Describe the sinka1.sinks.k1.type = logger# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨flume1flume-ng agent -n a1 -c conf -f simple.conf -Dflume.root.logger=INFO,console å‘é€æ•°æ®1telnet node02 44444 ä¸¤ä¸ªflumeåšé›†ç¾¤å‚è€ƒæ–‡æ¡£ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#setting-multi-agent-flow å³ä¾§èŠ‚ç‚¹(node03)å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-source 1vi double-flume.conf 123456789101112131415161718192021# Name the components on this agenta1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = avroa1.sources.r1.bind = node03a1.sources.r1.port = 60000# Describe the sinka1.sinks.k1.type = logger# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f double-flume.conf -Dflume.root.logger=INFO,console å·¦ä¾§èŠ‚ç‚¹(node02)å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-sink 1scp -r apache-flume-1.6.0-bin/ root@node03:/usr/install 1vi double-flume.conf 1234567891011121314151617181920212223a1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = netcata1.sources.r1.bind = node02a1.sources.r1.port = 44444# Describe the sinka1.sinks.k1.type = avroa1.sinks.k1.hostname = node03a1.sinks.k1.port = 60000# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f double-flume.conf -Dflume.root.logger=INFO,console å‘é€æ•°æ®1telnet node02 44444 Exec Sourceæ–¹å¼ï¼Œç›‘æŽ§æ–‡ä»¶tailå‘½ä»¤å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#exec-source é…ç½®1vi exec.conf 12345678910111213141516171819a1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = execa1.sources.r1.command = tail -F /root/test.txt# Describe the sinka1.sinks.k1.type = logger# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f exec.conf -Dflume.root.logger=INFO,console æ·»åŠ æ•°æ®å¾ªçŽ¯æ·»åŠ æ•°æ® 1for i in &#123;1..50&#125;; do echo "$i hi flume" &gt;&gt; /root/test.txt ; sleep 0.1; done Spooling Directory Sourceç›‘æŽ§ç›®å½•å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#spooling-directory-source é…ç½®1vi spool.conf 1234567891011121314151617181920a1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = spooldira1.sources.r1.spoolDir = /root/logsa1.sources.r1.fileHeader = true# Describe the sinka1.sinks.k1.type = logger# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f spool.conf -Dflume.root.logger=INFO,console æ‹·è´æ–‡ä»¶æ¼”ç¤ºmkdir logs mv aa logs/ flumeå’Œkafkaä¸¤è€…ç»å¸¸é…å¯¹ä½¿ç”¨ï¼Œè°åœ¨å‰åŽéƒ½å¯ä»¥ hdfs sinkæ–¹å¼å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hdfs-sink é…ç½®1vi hdfs-sink.conf 12345678910111213141516171819202122232425262728293031323334353637383940414243a1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = spooldira1.sources.r1.spoolDir = /root/logsa1.sources.r1.fileHeader = true# Describe the sink æ–‡ä»¶ç›®å½•æ ¼å¼a1.sinks.k1.type=hdfsa1.sinks.k1.hdfs.path=hdfs://mycluster/flume/%Y-%m-%d/%H%M##æ¯éš”60sæˆ–è€…æ–‡ä»¶å¤§å°è¶…è¿‡10Mçš„æ—¶å€™äº§ç”Ÿæ–°æ–‡ä»¶ï¼Œrollå¯¹æ–‡ä»¶è®¾ç½®# hdfsæœ‰å¤šå°‘æ¡æ¶ˆæ¯æ—¶æ–°å»ºæ–‡ä»¶ï¼Œ0ä¸åŸºäºŽæ¶ˆæ¯ä¸ªæ•°a1.sinks.k1.hdfs.rollCount=0# hdfsåˆ›å»ºå¤šé•¿æ—¶é—´æ–°å»ºæ–‡ä»¶ï¼Œ0ä¸åŸºäºŽæ—¶é—´a1.sinks.k1.hdfs.rollInterval=60# hdfså¤šå¤§æ—¶æ–°å»ºæ–‡ä»¶ï¼Œ0ä¸åŸºäºŽæ–‡ä»¶å¤§å°a1.sinks.k1.hdfs.rollSize=10240# å½“ç›®å‰è¢«æ‰“å¼€çš„ä¸´æ—¶æ–‡ä»¶åœ¨è¯¥å‚æ•°æŒ‡å®šçš„æ—¶é—´ï¼ˆç§’ï¼‰å†…ï¼Œæ²¡æœ‰ä»»ä½•æ•°æ®å†™å…¥ï¼Œåˆ™å°†è¯¥ä¸´æ—¶æ–‡ä»¶å…³é—­å¹¶é‡å‘½åæˆç›®æ ‡æ–‡ä»¶a1.sinks.k1.hdfs.idleTimeout=3a1.sinks.k1.hdfs.fileType=DataStreama1.sinks.k1.hdfs.useLocalTimeStamp=true## æ¯äº”åˆ†é’Ÿç”Ÿæˆä¸€ä¸ªç›®å½•ï¼Œroundå¯¹ç›®å½•è®¾ç½®# æ˜¯å¦å¯ç”¨æ—¶é—´ä¸Šçš„â€èˆå¼ƒâ€ï¼Œè¿™é‡Œçš„â€èˆå¼ƒâ€ï¼Œç±»ä¼¼äºŽâ€å››èˆäº”å…¥â€ï¼ŒåŽé¢å†ä»‹ç»ã€‚å¦‚æžœå¯ç”¨ï¼Œåˆ™ä¼šå½±å“é™¤äº†%tçš„å…¶ä»–æ‰€æœ‰æ—¶é—´è¡¨è¾¾å¼a1.sinks.k1.hdfs.round=true# æ—¶é—´ä¸Šè¿›è¡Œâ€œèˆå¼ƒâ€çš„å€¼ï¼›a1.sinks.k1.hdfs.roundValue=5# æ—¶é—´ä¸Šè¿›è¡Œâ€èˆå¼ƒâ€çš„å•ä½ï¼ŒåŒ…å«ï¼šsecond,minute,houra1.sinks.k1.hdfs.roundUnit=minute# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f hdfs-sink.conf -Dflume.root.logger=INFO,console æ‹·è´æ–‡ä»¶æ¼”ç¤º12mkdir logsmv aa logs/ tengineå’Œflumeé›†æˆé…ç½®1vi tengine_project.conf 12345678910111213141516171819202122232425a1.sources = r1a1.sinks = k1a1.channels = c1## ç›‘å¬tengineçš„access logæ–‡ä»¶a1.sources.r1.type = execa1.sources.r1.command = tail -F /opt/data/access.loga1.sinks.k1.type=hdfsa1.sinks.k1.hdfs.path=hdfs://mycluster/log/%Y%m%da1.sinks.k1.hdfs.rollCount=0a1.sinks.k1.hdfs.rollInterval=0a1.sinks.k1.hdfs.rollSize=10240a1.sinks.k1.hdfs.idleTimeout=5a1.sinks.k1.hdfs.fileType=DataStreama1.sinks.k1.hdfs.useLocalTimeStamp=truea1.sinks.k1.hdfs.callTimeout=40000a1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100a1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f tengine_project.conf -Dflume.root.logger=INFO,console æ‹·è´æ–‡ä»¶æ¼”ç¤º12mkdir logsmv aa logs/ ç»è¿‡ETLæ¸…æ´—å­˜å‚¨åˆ°hbaseç›®æ ‡ è¿‡æ»¤è„æ•°æ® åˆ†æžIPï¼Œå¾—åˆ°çœã€å¸‚åŒº åˆ†æžuseragentï¼Œå¾—åˆ°æµè§ˆå™¨ç‰ˆæœ¬ AnalyserLogDataRunner123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152package com.sxt.etl.mr.ald;import java.io.IOException;import org.apache.commons.lang.StringUtils;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.hbase.HBaseConfiguration;import org.apache.hadoop.hbase.client.Put;import org.apache.hadoop.hbase.mapreduce.TableMapReduceUtil;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.mapreduce.Job;import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;import org.apache.hadoop.util.Tool;import org.apache.hadoop.util.ToolRunner;import org.apache.log4j.Logger;import com.sxt.common.EventLogConstants;import com.sxt.common.GlobalConstants;import com.sxt.util.TimeUtil;/** * ç¼–å†™mapreduceçš„runnerç±» * * @author root * */public class AnalyserLogDataRunner implements Tool &#123; private static final Logger logger = Logger .getLogger(AnalyserLogDataRunner.class); private Configuration conf = null; public static void main(String[] args) &#123; try &#123; ToolRunner.run(new Configuration(), new AnalyserLogDataRunner(), args); &#125; catch (Exception e) &#123; logger.error("æ‰§è¡Œæ—¥å¿—è§£æžjobå¼‚å¸¸", e); throw new RuntimeException(e); &#125; &#125; @Override public void setConf(Configuration conf) &#123; conf.set("fs.defaultFS", "hdfs://node01:8020");// conf.set("yarn.resourcemanager.hostname", "node3"); conf.set("hbase.zookeeper.quorum", "node02,node03,node04"); this.conf = HBaseConfiguration.create(conf); &#125; @Override public Configuration getConf() &#123; return this.conf; &#125; @Override public int run(String[] args) throws Exception &#123; Configuration conf = this.getConf(); this.processArgs(conf, args); Job job = Job.getInstance(conf, "analyser_logdata"); // è®¾ç½®æœ¬åœ°æäº¤jobï¼Œé›†ç¾¤è¿è¡Œï¼Œéœ€è¦ä»£ç  // File jarFile = EJob.createTempJar("target/classes"); // ((JobConf) job.getConfiguration()).setJar(jarFile.toString()); // è®¾ç½®æœ¬åœ°æäº¤jobï¼Œé›†ç¾¤è¿è¡Œï¼Œéœ€è¦ä»£ç ç»“æŸ job.setJarByClass(AnalyserLogDataRunner.class); job.setMapperClass(AnalyserLogDataMapper.class); job.setMapOutputKeyClass(NullWritable.class); job.setMapOutputValueClass(Put.class); // è®¾ç½®reduceré…ç½® // 1. é›†ç¾¤ä¸Šè¿è¡Œï¼Œæ‰“æˆjarè¿è¡Œ(è¦æ±‚addDependencyJarså‚æ•°ä¸ºtrueï¼Œé»˜è®¤å°±æ˜¯true) // TableMapReduceUtil.initTableReducerJob(EventLogConstants.HBASE_NAME_EVENT_LOGS, // null, job); // 2. æœ¬åœ°è¿è¡Œï¼Œè¦æ±‚å‚æ•°addDependencyJarsä¸ºfalse TableMapReduceUtil.initTableReducerJob( EventLogConstants.HBASE_NAME_EVENT_LOGS, null, job, null, null, null, null, false); job.setNumReduceTasks(0); // è®¾ç½®è¾“å…¥è·¯å¾„ this.setJobInputPaths(job); return job.waitForCompletion(true) ? 0 : -1; &#125; /** * å¤„ç†å‚æ•° * * @param conf * @param args */ private void processArgs(Configuration conf, String[] args) &#123; String date = null; for (int i = 0; i &lt; args.length; i++) &#123; if ("-d".equals(args[i])) &#123; if (i + 1 &lt; args.length) &#123; date = args[++i]; break; &#125; &#125; &#125; System.out.println("-----" + date); // è¦æ±‚dateæ ¼å¼ä¸º: yyyy-MM-dd if (StringUtils.isBlank(date) || !TimeUtil.isValidateRunningDate(date)) &#123; // dateæ˜¯ä¸€ä¸ªæ— æ•ˆæ—¶é—´æ•°æ® date = TimeUtil.getYesterday(); // é»˜è®¤æ—¶é—´æ˜¯æ˜¨å¤© System.out.println(date); &#125; conf.set(GlobalConstants.RUNNING_DATE_PARAMES, date); &#125; /** * è®¾ç½®jobçš„è¾“å…¥è·¯å¾„ * * @param job */ private void setJobInputPaths(Job job) &#123; Configuration conf = job.getConfiguration(); FileSystem fs = null; try &#123; fs = FileSystem.get(conf); String date = conf.get(GlobalConstants.RUNNING_DATE_PARAMES); // Path inputPath = new Path("/flume/" + // TimeUtil.parseLong2String(TimeUtil.parseString2Long(date), // "MM/dd/")); Path inputPath = new Path("/log/" + TimeUtil.parseLong2String( TimeUtil.parseString2Long(date), "yyyyMMdd") + "/"); if (fs.exists(inputPath)) &#123; FileInputFormat.addInputPath(job, inputPath); &#125; else &#123; throw new RuntimeException("æ–‡ä»¶ä¸å­˜åœ¨:" + inputPath); &#125; &#125; catch (IOException e) &#123; throw new RuntimeException("è®¾ç½®jobçš„mapreduceè¾“å…¥è·¯å¾„å‡ºçŽ°å¼‚å¸¸", e); &#125; finally &#123; if (fs != null) &#123; try &#123; fs.close(); &#125; catch (IOException e) &#123; // nothing &#125; &#125; &#125; &#125;&#125; AnalyserLogDataMapper123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141package com.sxt.etl.mr.ald;import java.io.IOException;import java.util.Map;import java.util.zip.CRC32;import org.apache.commons.lang.StringUtils;import org.apache.hadoop.hbase.client.Put;import org.apache.hadoop.hbase.util.Bytes;import org.apache.hadoop.io.LongWritable;import org.apache.hadoop.io.NullWritable;import org.apache.hadoop.io.Text;import org.apache.hadoop.mapreduce.Mapper;import org.apache.log4j.Logger;import com.sxt.common.EventLogConstants;import com.sxt.common.EventLogConstants.EventEnum;import com.sxt.etl.util.LoggerUtil;/** * è‡ªå®šä¹‰æ•°æ®è§£æžmapç±» * * @author root * */public class AnalyserLogDataMapper extends Mapper&lt;LongWritable, Text, NullWritable, Put&gt; &#123; private final Logger logger = Logger.getLogger(AnalyserLogDataMapper.class); private int inputRecords, filterRecords, outputRecords; // ä¸»è¦ç”¨äºŽæ ‡å¿—ï¼Œæ–¹ä¾¿æŸ¥çœ‹è¿‡æ»¤æ•°æ® private byte[] family = Bytes.toBytes(EventLogConstants.EVENT_LOGS_FAMILY_NAME); private CRC32 crc32 = new CRC32(); @Override protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123; this.inputRecords++; this.logger.debug("Analyse data of :" + value); try &#123; // è§£æžæ—¥å¿— Map&lt;String, String&gt; clientInfo = LoggerUtil.handleLog(value.toString()); // è¿‡æ»¤è§£æžå¤±è´¥çš„æ•°æ® if (clientInfo.isEmpty()) &#123; this.filterRecords++; return; &#125; // èŽ·å–äº‹ä»¶åç§° String eventAliasName = clientInfo.get(EventLogConstants.LOG_COLUMN_NAME_EVENT_NAME); EventEnum event = EventEnum.valueOfAlias(eventAliasName); switch (event) &#123; case LAUNCH: case PAGEVIEW: case CHARGEREQUEST: case CHARGEREFUND: case CHARGESUCCESS: case EVENT: // å¤„ç†æ•°æ® this.handleData(clientInfo, event, context); break; default: this.filterRecords++; this.logger.warn("è¯¥äº‹ä»¶æ²¡æ³•è¿›è¡Œè§£æžï¼Œäº‹ä»¶åç§°ä¸º:" + eventAliasName); &#125; &#125; catch (Exception e) &#123; this.filterRecords++; this.logger.error("å¤„ç†æ•°æ®å‘å‡ºå¼‚å¸¸ï¼Œæ•°æ®:" + value, e); &#125; &#125; @Override protected void cleanup(Context context) throws IOException, InterruptedException &#123; super.cleanup(context); logger.info("è¾“å…¥æ•°æ®:" + this.inputRecords + "ï¼›è¾“å‡ºæ•°æ®:" + this.outputRecords + "ï¼›è¿‡æ»¤æ•°æ®:" + this.filterRecords); &#125; /** * å…·ä½“å¤„ç†æ•°æ®çš„æ–¹æ³• * * @param clientInfo * @param context * @param event * @throws InterruptedException * @throws IOException */ private void handleData(Map&lt;String, String&gt; clientInfo, EventEnum event, Context context) throws IOException, InterruptedException &#123; String uuid = clientInfo.get(EventLogConstants.LOG_COLUMN_NAME_UUID); String memberId = clientInfo .get(EventLogConstants.LOG_COLUMN_NAME_MEMBER_ID); String serverTime = clientInfo .get(EventLogConstants.LOG_COLUMN_NAME_SERVER_TIME); if (StringUtils.isNotBlank(serverTime)) &#123; // è¦æ±‚æœåŠ¡å™¨æ—¶é—´ä¸ä¸ºç©º clientInfo.remove(EventLogConstants.LOG_COLUMN_NAME_USER_AGENT); // æµè§ˆå™¨ä¿¡æ¯åŽ»æŽ‰ String rowkey = this.generateRowKey(uuid, memberId, event.alias, serverTime); // timestamp // + // (uuid+memberid+event).crc Put put = new Put(Bytes.toBytes(rowkey)); for (Map.Entry&lt;String, String&gt; entry : clientInfo.entrySet()) &#123; if (StringUtils.isNotBlank(entry.getKey()) &amp;&amp; StringUtils.isNotBlank(entry.getValue())) &#123; put.add(family, Bytes.toBytes(entry.getKey()), Bytes.toBytes(entry.getValue())); &#125; &#125; context.write(NullWritable.get(), put); this.outputRecords++; &#125; else &#123; this.filterRecords++; &#125; &#125; /** * æ ¹æ®uuid memberid servertimeåˆ›å»ºrowkey * * @param uuid * @param memberId * @param eventAliasName * @param serverTime * @return */ private String generateRowKey(String uuid, String memberId, String eventAliasName, String serverTime) &#123; StringBuilder sb = new StringBuilder(); sb.append(serverTime).append("_"); this.crc32.reset(); if (StringUtils.isNotBlank(uuid)) &#123; this.crc32.update(uuid.getBytes()); &#125; if (StringUtils.isNotBlank(memberId)) &#123; this.crc32.update(memberId.getBytes()); &#125; this.crc32.update(eventAliasName.getBytes()); sb.append(this.crc32.getValue() % 100000000L); return sb.toString(); &#125;&#125; map reduceåˆ†æžhbaseçš„æ•°æ®ï¼Œè½åˆ°mysqlç»è¿‡ä¸åŒç»´åº¦ mysqlæ•°æ®åº“å‡†å¤‡1create database 'result_db'; ä½¿ç”¨mysql_è¡¨è®¾è®¡.sqlåˆ›å»ºè¡¨ æ–°ç”¨æˆ·æ¨¡å—NewInstallUserMapperç»è¿‡1æ¬¡mapï¼Œè¾“å‡ºå¤šä¸ªç»´åº¦ï¼Œå‡å°‘ç½‘ç»œIO è¾“å‡ºçš„key StatsUserDimensionï¼ŒåŒ…å«ä»¥ä¸‹ä¸¤ä¸ªç»´åº¦ã€‚åˆ†åˆ«æ˜¯æ™®é€šç»Ÿè®¡ç”¨æˆ· æ–°ç”¨æˆ·è®¿é—®æ•°æ®ï¼š æ—¶é—´ è®¿é—®å¹³å°(jsæµè§ˆå™¨) è®¿é—®æµè§ˆå™¨ è¿™æ ·æµè§ˆå™¨æ–°ç”¨æˆ·KPIï¼Œå¯ä»¥ç»è¿‡ç¬›å¡å°”ç§¯2*2ï¼Œç»Ÿè®¡4ä¸ªç»´åº¦çš„ä¿¡æ¯ã€‚ å½“å‰æµè§ˆå™¨(å…¨éƒ¨ç‰ˆæœ¬) å½“å‰æµè§ˆå™¨(ç‰ˆæœ¬1.0) å½“å‰å¹³å°(jsæµè§ˆå™¨ç«¯æˆ–è€…æ‰‹æœºå®‰å“) å…¨éƒ¨å¹³å° å¦å¤–ï¼Œåªç»Ÿè®¡æ–°ç”¨æˆ·KPIï¼Œå¹³å°ä¿¡æ¯æ”¯æŒè¾“å‡ºï¼Œä¸å¸¦æµè§ˆå™¨ï¼Œæœ‰2ç§ç»“æžœã€‚è¿™æ ·4+2=6ç§ç»“æžœã€‚ 12private StatsCommonDimension statsCommon = new StatsCommonDimension();private BrowserDimension browser = new BrowserDimension(); 12private StatsUserDimension statsUserDimension = new StatsUserDimension(); private TimeOutputValue timeOutputValue = new TimeOutputValue(); 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091package com.sxt.transformer.mr.nu;import java.io.IOException;import java.util.List;import org.apache.commons.lang.StringUtils;import org.apache.hadoop.hbase.client.Result;import org.apache.hadoop.hbase.io.ImmutableBytesWritable;import org.apache.hadoop.hbase.mapreduce.TableMapper;import org.apache.hadoop.hbase.util.Bytes;import org.apache.log4j.Logger;import com.sxt.common.DateEnum;import com.sxt.common.EventLogConstants;import com.sxt.common.KpiType;import com.sxt.transformer.model.dim.StatsCommonDimension;import com.sxt.transformer.model.dim.StatsUserDimension;import com.sxt.transformer.model.dim.base.BrowserDimension;import com.sxt.transformer.model.dim.base.DateDimension;import com.sxt.transformer.model.dim.base.KpiDimension;import com.sxt.transformer.model.dim.base.PlatformDimension;import com.sxt.transformer.model.value.map.TimeOutputValue;public class NewInstallUserMapper extends TableMapper&lt;StatsUserDimension, TimeOutputValue&gt;&#123; private static final Logger logger = Logger.getLogger(NewInstallUserMapper.class); private StatsUserDimension statsUserDimension = new StatsUserDimension(); private TimeOutputValue timeOutputValue = new TimeOutputValue(); private byte[] family = Bytes.toBytes(EventLogConstants.EVENT_LOGS_FAMILY_NAME); //ä»£è¡¨ç”¨æˆ·åˆ†æžæ¨¡å—çš„ç»Ÿè®¡ private KpiDimension newInstallUserKpi = new KpiDimension(KpiType.NEW_INSTALL_USER.name); //æµè§ˆå™¨åˆ†æžæ¨¡å—çš„ç»Ÿè®¡ private KpiDimension newInstallUserOfBrowserKpi = new KpiDimension(KpiType.BROWSER_NEW_INSTALL_USER.name); @Override protected void map(ImmutableBytesWritable key, Result value, Context context) throws IOException, InterruptedException &#123; String uuid = Bytes.toString(value.getValue(family, Bytes.toBytes(EventLogConstants.LOG_COLUMN_NAME_UUID))); String serverTime = Bytes.toString(value.getValue(family, Bytes.toBytes(EventLogConstants.LOG_COLUMN_NAME_SERVER_TIME))); String platform = Bytes.toString(value.getValue(family, Bytes.toBytes(EventLogConstants.LOG_COLUMN_NAME_PLATFORM))); System.out.println(uuid + "-" + serverTime +"-"+ platform); if (StringUtils.isBlank(uuid) || StringUtils.isBlank(serverTime) || StringUtils.isBlank(platform)) &#123; logger.warn("uuid&amp;servertime&amp;platformä¸èƒ½ä¸ºç©º"); return; &#125; long longOfTime = Long.valueOf(serverTime.trim()); timeOutputValue.setTime(longOfTime); timeOutputValue.setId(uuid); DateDimension dateDimension = DateDimension.buildDate(longOfTime, DateEnum.DAY); // è®¾ç½®dateç»´åº¦ StatsCommonDimension statsCommonDimension = this.statsUserDimension.getStatsCommon(); statsCommonDimension.setDate(dateDimension); List&lt;PlatformDimension&gt; platformDimensions = PlatformDimension.buildList(platform); String browserName = Bytes.toString(value.getValue(family, Bytes.toBytes(EventLogConstants.LOG_COLUMN_NAME_BROWSER_NAME))); String browserVersion = Bytes.toString(value.getValue(family, Bytes.toBytes(EventLogConstants.LOG_COLUMN_NAME_BROWSER_VERSION))); List&lt;BrowserDimension&gt; browserDimensions = BrowserDimension.buildList(browserName, browserVersion); //ç©ºæµè§ˆå™¨ç»´åº¦ï¼Œä¸è€ƒè™‘æµè§ˆå™¨ç»´åº¦ BrowserDimension defaultBrowser = new BrowserDimension("", ""); for(PlatformDimension pfDimension : platformDimensions) &#123; statsUserDimension.setBrowser(defaultBrowser); statsCommonDimension.setKpi(newInstallUserKpi); statsCommonDimension.setPlatform(pfDimension); context.write(statsUserDimension, timeOutputValue); for(BrowserDimension browserDimension : browserDimensions) &#123; statsUserDimension.setBrowser(browserDimension); statsCommonDimension.setKpi(newInstallUserOfBrowserKpi); context.write(statsUserDimension, timeOutputValue); &#125; &#125; &#125;&#125; NewInstallUserReducer12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.sxt.transformer.mr.nu;import java.io.IOException;import org.apache.hadoop.mapreduce.Reducer;import com.sxt.transformer.model.dim.StatsUserDimension;import com.sxt.transformer.model.value.map.TimeOutputValue;import com.sxt.transformer.model.value.reduce.MapWritableValue;import java.io.IOException;import java.util.HashSet;import java.util.Set;import org.apache.hadoop.io.IntWritable;import org.apache.hadoop.io.MapWritable;import org.apache.hadoop.mapreduce.Reducer;import com.sxt.common.KpiType;public class NewInstallUserReducer extends Reducer&lt;StatsUserDimension, TimeOutputValue, StatsUserDimension, MapWritableValue&gt;&#123; private MapWritableValue outputValue = new MapWritableValue(); private Set&lt;String&gt; unique = new HashSet&lt;String&gt;(); @Override protected void reduce(StatsUserDimension key, Iterable&lt;TimeOutputValue&gt; values, Reducer&lt;StatsUserDimension, TimeOutputValue, StatsUserDimension, MapWritableValue&gt;.Context context) throws IOException, InterruptedException &#123; this.unique.clear(); for(TimeOutputValue value : values) &#123; this.unique.add(value.getId()); &#125; MapWritable map = new MapWritable(); map.put(new IntWritable(-1), new IntWritable(unique.size())); outputValue.setValue(map); String kpiName = key.getStatsCommon().getKpi().getKpiName(); if (KpiType.NEW_INSTALL_USER.name.equals(kpiName)) &#123; outputValue.setKpi(KpiType.NEW_INSTALL_USER); &#125;else if (KpiType.BROWSER_NEW_INSTALL_USER.name.equals(kpiName)) &#123; outputValue.setKpi(KpiType.BROWSER_NEW_INSTALL_USER); &#125; context.write(key, outputValue); &#125;&#125; æ³¨æ„æ£€æŸ¥é…ç½®jdbc:mysql://node01:3306/result_db zké…ç½® å’Œ hdfsé…ç½®æ­£ç¡®ã€‚ TransformerOutputFormat123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161package com.sxt.transformer.mr;import java.io.IOException;import java.sql.Connection;import java.sql.PreparedStatement;import java.sql.SQLException;import java.util.HashMap;import java.util.Map;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.mapreduce.JobContext;import org.apache.hadoop.mapreduce.OutputCommitter;import org.apache.hadoop.mapreduce.OutputFormat;import org.apache.hadoop.mapreduce.RecordWriter;import org.apache.hadoop.mapreduce.TaskAttemptContext;import org.apache.hadoop.mapreduce.lib.output.FileOutputCommitter;import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;import org.apache.log4j.Logger;import com.sxt.common.GlobalConstants;import com.sxt.common.KpiType;import com.sxt.transformer.model.dim.base.BaseDimension;import com.sxt.transformer.model.value.BaseStatsValueWritable;import com.sxt.transformer.service.IDimensionConverter;import com.sxt.transformer.service.impl.DimensionConverterImpl;import com.sxt.util.JdbcManager;/** * è‡ªå®šä¹‰è¾“å‡ºåˆ°mysqlçš„outputformatç±» * BaseDimension:reducerè¾“å‡ºçš„key * BaseStatsValueWritableï¼šreducerè¾“å‡ºçš„value * @author root * */public class TransformerOutputFormat extends OutputFormat&lt;BaseDimension, BaseStatsValueWritable&gt; &#123; private static final Logger logger = Logger.getLogger(TransformerOutputFormat.class); /** * å®šä¹‰æ¯æ¡æ•°æ®çš„è¾“å‡ºæ ¼å¼ï¼Œä¸€æ¡æ•°æ®å°±æ˜¯reducerä»»åŠ¡æ¯æ¬¡æ‰§è¡Œwriteæ–¹æ³•è¾“å‡ºçš„æ•°æ®ã€‚ */ @Override public RecordWriter&lt;BaseDimension, BaseStatsValueWritable&gt; getRecordWriter(TaskAttemptContext context) throws IOException, InterruptedException &#123; Configuration conf = context.getConfiguration(); Connection conn = null; IDimensionConverter converter = new DimensionConverterImpl(); try &#123; conn = JdbcManager.getConnection(conf, GlobalConstants.WAREHOUSE_OF_REPORT); conn.setAutoCommit(false); &#125; catch (SQLException e) &#123; logger.error("èŽ·å–æ•°æ®åº“è¿žæŽ¥å¤±è´¥", e); throw new IOException("èŽ·å–æ•°æ®åº“è¿žæŽ¥å¤±è´¥", e); &#125; return new TransformerRecordWriter(conn, conf, converter); &#125; @Override public void checkOutputSpecs(JobContext context) throws IOException, InterruptedException &#123; // æ£€æµ‹è¾“å‡ºç©ºé—´ï¼Œè¾“å‡ºåˆ°mysqlä¸ç”¨æ£€æµ‹ &#125; @Override public OutputCommitter getOutputCommitter(TaskAttemptContext context) throws IOException, InterruptedException &#123; return new FileOutputCommitter(FileOutputFormat.getOutputPath(context), context); &#125; /** * è‡ªå®šä¹‰å…·ä½“æ•°æ®è¾“å‡ºwriter * * @author root * */ public class TransformerRecordWriter extends RecordWriter&lt;BaseDimension, BaseStatsValueWritable&gt; &#123; private Connection conn = null; private Configuration conf = null; private IDimensionConverter converter = null; private Map&lt;KpiType, PreparedStatement&gt; map = new HashMap&lt;KpiType, PreparedStatement&gt;(); private Map&lt;KpiType, Integer&gt; batch = new HashMap&lt;KpiType, Integer&gt;(); public TransformerRecordWriter(Connection conn, Configuration conf, IDimensionConverter converter) &#123; super(); this.conn = conn; this.conf = conf; this.converter = converter; &#125; @Override /** * å½“reduceä»»åŠ¡è¾“å‡ºæ•°æ®æ˜¯ï¼Œç”±è®¡ç®—æ¡†æž¶è‡ªåŠ¨è°ƒç”¨ã€‚æŠŠreducerè¾“å‡ºçš„æ•°æ®å†™åˆ°mysqlä¸­ */ public void write(BaseDimension key, BaseStatsValueWritable value) throws IOException, InterruptedException &#123; if (key == null || value == null) &#123; return; &#125; try &#123; KpiType kpi = value.getKpi(); PreparedStatement pstmt = null;//æ¯ä¸€ä¸ªpstmtå¯¹è±¡å¯¹åº”ä¸€ä¸ªsqlè¯­å¥ int count = 1;//sqlè¯­å¥çš„æ‰¹å¤„ç†ï¼Œä¸€æ¬¡æ‰§è¡Œ10 if (map.get(kpi) == null) &#123; // ä½¿ç”¨kpiè¿›è¡ŒåŒºåˆ†ï¼Œè¿”å›žsqlä¿å­˜åˆ°configä¸­ pstmt = this.conn.prepareStatement(conf.get(kpi.name)); map.put(kpi, pstmt); &#125; else &#123; pstmt = map.get(kpi); count = batch.get(kpi); count++; &#125; batch.put(kpi, count); // æ‰¹é‡æ¬¡æ•°çš„å­˜å‚¨ String collectorName = conf.get(GlobalConstants.OUTPUT_COLLECTOR_KEY_PREFIX + kpi.name); Class&lt;?&gt; clazz = Class.forName(collectorName); IOutputCollector collector = (IOutputCollector) clazz.newInstance();//æŠŠvalueæ’å…¥åˆ°mysqlçš„æ–¹æ³•ã€‚ç”±äºŽkpiç»´åº¦ä¸ä¸€æ ·ã€‚æ’å…¥åˆ°ä¸èƒ½è¡¨é‡Œé¢ã€‚ collector.collect(conf, key, value, pstmt, converter); if (count % Integer.valueOf(conf.get(GlobalConstants.JDBC_BATCH_NUMBER, GlobalConstants.DEFAULT_JDBC_BATCH_NUMBER)) == 0) &#123; pstmt.executeBatch(); conn.commit(); batch.put(kpi, 0); // å¯¹åº”æ‰¹é‡è®¡ç®—åˆ é™¤ &#125; &#125; catch (Throwable e) &#123; logger.error("åœ¨writerä¸­å†™æ•°æ®å‡ºçŽ°å¼‚å¸¸", e); throw new IOException(e); &#125; &#125; @Override public void close(TaskAttemptContext context) throws IOException, InterruptedException &#123; try &#123; for (Map.Entry&lt;KpiType, PreparedStatement&gt; entry : this.map.entrySet()) &#123; entry.getValue().executeBatch(); &#125; &#125; catch (SQLException e) &#123; logger.error("æ‰§è¡ŒexecuteUpdateæ–¹æ³•å¼‚å¸¸", e); throw new IOException(e); &#125; finally &#123; try &#123; if (conn != null) &#123; conn.commit(); // è¿›è¡Œconnectionçš„æäº¤åŠ¨ä½œ &#125; &#125; catch (Exception e) &#123; // nothing &#125; finally &#123; for (Map.Entry&lt;KpiType, PreparedStatement&gt; entry : this.map.entrySet()) &#123; try &#123; entry.getValue().close(); &#125; catch (SQLException e) &#123; // nothing &#125; &#125; if (conn != null) try &#123; conn.close(); &#125; catch (Exception e) &#123; // nothing &#125; &#125; &#125; &#125; &#125;&#125; è¿è¡Œrun as java application æ·»åŠ  è¿è¡Œå‚æ•° -d 2019-06-15 è·‘å‡ºç»“æžœï¼Œdimension_å¼€å¤´ä¸ºç»´åº¦è¡¨ï¼Œstats_å¼€å¤´ä¸ºçœŸæ­£çš„ç»Ÿè®¡æ•°æ® hiveå’Œhbaseæ•´åˆå‚è€ƒ https://cwiki.apache.org/confluence/display/Hive/HBaseIntegration é…ç½®libæŠŠhive-hbase-handler-1.2.1.jar cpåˆ°hbase/lib ä¸‹ 1cp hive-hbase-handler-1.2.1.jar $HBASE_HOME/lib/ åŒæ—¶æŠŠhbaseä¸­çš„æ‰€æœ‰çš„jarï¼Œcpåˆ°hive/lib 1cp -r $HBASE_HOME/lib/* ./ åœ¨hiveçš„é…ç½®æ–‡ä»¶å¢žåŠ å±žæ€§ï¼š1234&lt;property&gt; &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt; &lt;value&gt;node02,node03,node04&lt;/value&gt;&lt;/property&gt; åœ¨hiveä¸­åˆ›å»ºä¸´æ—¶è¡¨12345678910CREATE EXTERNAL TABLE tmp_order(key string, id string, user_id string)STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'WITH SERDEPROPERTIES ("hbase.columns.mapping" = ":key,order:order_id,order:user_id")TBLPROPERTIES ("hbase.table.name" = "t_order");CREATE TABLE hbasetbl(key int, value string)STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'WITH SERDEPROPERTIES ("hbase.columns.mapping" = ":key,cf1:val")TBLPROPERTIES ("hbase.table.name" = "xyz", "hbase.mapred.output.outputtable" = "xyz"); hiveåˆ†æžsqoopè¾“å‡ºåˆ°mysqlåœ¨hiveä¸­åˆ›å»ºhbaseçš„event_logå¯¹åº”è¡¨123456CREATE EXTERNAL TABLE event_logs(key string, pl string, en string, s_time bigint, p_url string, u_ud string, u_sd string) ROW FORMAT SERDE 'org.apache.hadoop.hive.hbase.HBaseSerDe'STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'with serdeproperties('hbase.columns.mapping'=':key,log:pl,log:en,log:s_time,log:p_url,log:u_ud,log:u_sd')tblproperties('hbase.table.name'='eventlog'); åˆ›å»ºmysqlåœ¨hiveä¸­çš„å¯¹åº”è¡¨123456789101112131415161718-- 2. åˆ›å»ºmysqlåœ¨hiveä¸­çš„å¯¹åº”è¡¨ï¼Œhiveä¸­çš„è¡¨ï¼Œæ‰§è¡ŒHQLä¹‹åŽåˆ†æžçš„ç»“æžœä¿å­˜è¯¥è¡¨ï¼Œç„¶åŽé€šè¿‡sqoopå·¥å…·å¯¼å‡ºåˆ°mysqlCREATE TABLE `stats_view_depth` ( `platform_dimension_id` bigint , `data_dimension_id` bigint , `kpi_dimension_id` bigint , `pv1` bigint , `pv2` bigint , `pv3` bigint , `pv4` bigint , `pv5_10` bigint , `pv10_30` bigint , `pv30_60` bigint , `pv60_plus` bigint , `created` string) row format delimited fields terminated by '\t';-- 3. hiveåˆ›å»ºä¸´æ—¶è¡¨:æŠŠhqlåˆ†æžä¹‹åŽçš„ä¸­é—´ç»“æžœå­˜æ”¾åˆ°å½“å‰çš„ä¸´æ—¶è¡¨ã€‚CREATE TABLE `stats_view_depth_tmp`(`pl` string, `date` string, `col` string, `ct` bigint); ç¼–å†™UDFç¼–å†™UDF(platformdimension &amp; datedimension)éœ€è¦æ³¨æ„ï¼Œè¦åˆ é™¤DimensionConvertClientç±»ä¸­æ‰€æœ‰FileSystemå…³é—­çš„æ“ä½œ node03æ‰§è¡Œ 1hive 1add jar /root/transform_date.jar; åˆ›å»ºhiveçš„function 1create function date_convert as 'com.sxt.transformer.hive.DateDimensionUDF'; ç»Ÿè®¡ç”¨æˆ·è§’åº¦çš„æµè§ˆæ·±åº¦åˆ†æžå¾—åˆ°ä¸´æ—¶è¡¨stats_view_depth_tmp tmpè¡¨ å¯ä»¥å°†tmpï¼Œæ‹†åˆ†äº†çœ‹æ¯”è¾ƒæ¸…æ™°ã€‚ ç»Ÿè®¡æ¯ä¸ªç”¨æˆ·ã€æ¯ä¸ªå¹³å°ï¼Œåœ¨å½“å¤©çš„è®¿é—®æ¬¡æ•° stats_view_depth_tmp groupby pl,day,pvæ•°ï¼Œå°†u_ud distinctæ±‚å’Œï¼Œå¾—å‡ºå½“å¤©çš„å¹³å°çš„æŸä¸ªpvæ•°çš„ç”¨æˆ·æ•°ï¼Œå³pv 123456789101112131415161718192021222324-- 7. hqlç¼–å†™(ç»Ÿè®¡ç”¨æˆ·è§’åº¦çš„æµè§ˆæ·±åº¦)&lt;æ³¨æ„ï¼šæ—¶é—´ä¸ºå¤–éƒ¨ç»™å®š&gt;from ( select pl, from_unixtime(cast(s_time/1000 as bigint),'yyyy-MM-dd') as day, u_ud, (case when count(p_url) = 1 then "pv1" when count(p_url) = 2 then "pv2" when count(p_url) = 3 then "pv3" when count(p_url) = 4 then "pv4" when count(p_url) &gt;= 5 and count(p_url) &lt;10 then "pv5_10" when count(p_url) &gt;= 10 and count(p_url) &lt;30 then "pv10_30" when count(p_url) &gt;=30 and count(p_url) &lt;60 then "pv30_60" else 'pv60_plus' end) as pv from event_logs where en='e_pv' and p_url is not null and pl is not null and s_time &gt;= unix_timestamp('2019-06-15','yyyy-MM-dd')*1000 and s_time &lt; unix_timestamp('2019-06-16','yyyy-MM-dd')*1000 group by pl, from_unixtime(cast(s_time/1000 as bigint),'yyyy-MM-dd'), u_ud) as tmpinsert overwrite table stats_view_depth_tmp select pl,day,pv,count(distinct u_ud) as ct where u_ud is not null group by pl,day,pv; å¤šè¡Œè½¬1è¡Œå¹³å° æ—¥æœŸ pv1 ç”¨æˆ·æ•° å±•å¼€è½¬æ¢ä¸º pv2 pv5 pv10 ç­‰éƒ½ä¸º0 å¹³å° æ—¥æœŸ pv1 0 0 0 0 ç”¨æˆ·æ•° pl date pv1 pv2 pv3 pv4 pv5 pv10 pv30 pv60 web_site 2019-06-15 5 0 0 0 0 0 0 0 1select pl,`date` as date1,ct as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv1' è¿™æ ·ä¹‹åŽï¼Œpv1åˆ°pv60ï¼Œéƒ½åˆå¹¶æ±‚å’Œã€‚åˆå¹¶æˆ1è¡Œã€‚ 12345678910111213141516171819202122232425--æŠŠä¸´æ—¶è¡¨çš„å¤šè¡Œæ•°æ®ï¼Œè½¬æ¢ä¸€è¡Œwith tmp as(select pl,`date` as date1,ct as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv1' union allselect pl,`date` as date1,0 as pv1,ct as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv2' union allselect pl,`date` as date1,0 as pv1,0 as pv2,ct as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv3' union allselect pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,ct as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv4' union allselect pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,0 as pv4,ct as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv5_10' union allselect pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,ct as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv10_30' union allselect pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,ct as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv30_60' union allselect pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,ct as pv60_plus from stats_view_depth_tmp where col='pv60_plus' union allselect 'all' as pl,`date` as date1,ct as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv1' union allselect 'all' as pl,`date` as date1,0 as pv1,ct as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv2' union allselect 'all' as pl,`date` as date1,0 as pv1,0 as pv2,ct as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv3' union allselect 'all' as pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,ct as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv4' union allselect 'all' as pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,0 as pv4,ct as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv5_10' union allselect 'all' as pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,ct as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv10_30' union allselect 'all' as pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,ct as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv30_60' union allselect 'all' as pl,`date` as date1,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,ct as pv60_plus from stats_view_depth_tmp where col='pv60_plus')from tmpinsert overwrite table stats_view_depthselect 2,3,6,sum(pv1),sum(pv2),sum(pv3),sum(pv4),sum(pv5_10),sum(pv10_30),sum(pv30_60),sum(pv60_plus),'2019-06-15' group by pl,date1; ä¸Šé¢sqlä¸­çš„2ï¼Œ3ï¼Œ6è¦å…ˆè®¡ç®—å‡ºæ¥ï¼Œè¿™é‡Œå…ˆæ‰‹å·¥å¡«å…¥ã€‚ sqoopè„šæœ¬ç¼–å†™(ç»Ÿè®¡ç”¨æˆ·è§’åº¦)1sqoop export --connect jdbc:mysql://node01:3306/result_db --username root --password 123 --table stats_view_depth --export-dir /user/hive/warehouse/stats_view_depth/* --input-fields-terminated-by "\t" --update-mode allowinsert --update-key platform_dimension_id,data_dimension_id,kpi_dimension_id â€“export-dir hiveè¡¨å¯¹åº”çš„hdfsä½ç½® â€“input-fields-terminated-by hiveè¡¨çš„å­—æ®µåˆ†éš”ç¬¦ â€“update-mode æ›´æ–°æ¨¡å¼ â€“update-key æ›´æ–°key æˆåŠŸè¾“å‡ºåˆ°mysql 12 3 6 0 0 0 0 1 0 0 0 2019-06-15 shellå®šæ—¶ä»»åŠ¡ä½¿ç”¨cron å®šæ—¶æ‰§è¡Œsqoopå‘½ä»¤ å‚è€ƒ `` ç»Ÿè®¡ä¼šè¯è§’åº¦çš„æµè§ˆæ·±åº¦ç»Ÿè®¡å½“å¤©æ¯ä¸ªä¼šè¯æ•°æ®µçš„tmpè¡¨ï¼š group by pl,date , u_sd æ¯ä¸ªä¼šè¯idçš„ pvæ•° stats_view_depth_tmpï¼š æ¯ä¸ªä¼šè¯æ•°æ®µçš„ ä¼šè¯æ•° 12345678-- 8. hqlç¼–å†™(ç»Ÿè®¡ä¼šè¯è§’åº¦çš„æµè§ˆæ·±åº¦)&lt;æ³¨æ„ï¼šæ—¶é—´ä¸ºå¤–éƒ¨ç»™å®š&gt;from (select pl, from_unixtime(cast(s_time/1000 as bigint),'yyyy-MM-dd') as day, u_sd, (case when count(p_url) = 1 then "pv1" when count(p_url) = 2 then "pv2" when count(p_url) = 3 then "pv3" when count(p_url) = 4 then "pv4" when count(p_url) &gt;= 5 and count(p_url) &lt;10 then "pv5_10" when count(p_url) &gt;= 10 and count(p_url) &lt;30 then "pv10_30" when count(p_url) &gt;=30 and count(p_url) &lt;60 then "pv30_60" else 'pv60_plus' end) as pvfrom event_logswhere en='e_pv' and p_url is not null and pl is not null and s_time &gt;= unix_timestamp('2019-06-15','yyyy-MM-dd')*1000 and s_time &lt; unix_timestamp('2019-06-16','yyyy-MM-dd')*1000group by pl, from_unixtime(cast(s_time/1000 as bigint),'yyyy-MM-dd'), u_sd) as tmpinsert overwrite table stats_view_depth_tmp select pl,day,pv,count(distinct u_sd) as ct where u_sd is not null group by pl,day,pv; å¤šè¡Œè½¬1è¡Œdate_convert æ—¥æœŸè½¬æ¢å‡½æ•° platform_convert å¹³å°è½¬åŒ–å‡½æ•° 1234567891011121314151617181920212223242526272829with tmp as(select pl,date,ct as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv1' union allselect pl,date,0 as pv1,ct as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv2' union allselect pl,date,0 as pv1,0 as pv2,ct as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv3' union allselect pl,date,0 as pv1,0 as pv2,0 as pv3,ct as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv4' union allselect pl,date,0 as pv1,0 as pv2,0 as pv3,0 as pv4,ct as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv5_10' union allselect pl,date,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,ct as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv10_30' union allselect pl,date,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,ct as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv30_60' union allselect pl,date,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,ct as pv60_plus from stats_view_depth_tmp where col='pv60_plus' union allselect 'all' as pl,date,ct as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv1' union allselect 'all' as pl,date,0 as pv1,ct as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv2' union allselect 'all' as pl,date,0 as pv1,0 as pv2,ct as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv3' union allselect 'all' as pl,date,0 as pv1,0 as pv2,0 as pv3,ct as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv4' union allselect 'all' as pl,date,0 as pv1,0 as pv2,0 as pv3,0 as pv4,ct as pv5_10,0 as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv5_10' union allselect 'all' as pl,date,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,ct as pv10_30,0 as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv10_30' union allselect 'all' as pl,date,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,ct as pv30_60,0 as pv60_plus from stats_view_depth_tmp where col='pv30_60' union allselect 'all' as pl,date,0 as pv1,0 as pv2,0 as pv3,0 as pv4,0 as pv5_10,0 as pv10_30,0 as pv30_60,ct as pv60_plus from stats_view_depth_tmp where col='pv60_plus')from tmpinsert overwrite table stats_view_depthselect platform_convert(pl),date_convert(date),6,sum(pv1),sum(pv2),sum(pv3),sum(pv4),sum(pv5_10),sum(pv10_30),sum(pv30_60),sum(pv60_plus),'2019-06-15' group by pl,date;-- 9. sqoopè„šæ­¥ç¼–å†™(ç»Ÿè®¡ä¼šè¯è§’åº¦)sqoop export --connect jdbc:mysql://node01:3306/result_db --username root --password 123 --table stats_view_depth --export-dir /user/hive/warehouse/stats_view_depth/* --input-fields-terminated-by "\t" --update-mode allowinsert --update-key platform_dimension_id,data_dimension_id,kpi_dimension_id-- 10. shellè„šæ­¥ç¼–å†™ sqoop å°†å…³ç³»æ•°æ®åº“ï¼ˆoracleã€mysqlã€postgresqlç­‰ï¼‰æ•°æ®ä¸Žhadoopæ•°æ®è¿›è¡Œè½¬æ¢çš„å·¥å…· sqoopç”±clientç«¯ç›´æŽ¥æŽ¥å…¥hadoopï¼Œä»»åŠ¡é€šè¿‡è§£æžç”Ÿæˆå¯¹åº”çš„maprecueæ‰§è¡Œ å®‰è£…node04ä¸­è§£åŽ‹å®‰è£…ï¼Œæ³¨æ„ä¸‹è½½å®Œæ•´ç‰ˆ http://www.apache.org/dyn/closer.lua/sqoop/1.4.7 1scp /Users/zhouxiaowu/big-data/sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz root@node04:/root/ 12mv sqoop-1.4.7.tar.gz /usr/install/tar -zxvf sqoop-1.4.7.tar.gz é…ç½®çŽ¯å¢ƒå˜é‡ 123456vi /etc/profileexport SQOOP_HOME=/usr/install/sqoop-1.4.7export PATH=$PATH:$JAVA_HOME/bin:$ZOOKEEPER_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$HBASE_HOME/bin:$SQOOP_HOME/binsource /etc/profile æ·»åŠ æ•°æ®åº“é©±åŠ¨åŒ… 1scp /Users/zhouxiaowu/big-data/hadoopé¡¹ç›®1/01èµ„æ–™/mysql-connector-java-5.1.26-bin.jar root@node04:/root/ 1mv ~/mysql-connector-java-5.1.26-bin.jar lib/ é‡å‘½åé…ç½®æ–‡ä»¶ 1mv sqoop-env-template.sh sqoop-env.sh æµ‹è¯• 12sqoop versionsqoop list-databases -connect jdbc:mysql://node01:3306/ -username root -password 123 åŽ»é™¤è­¦å‘Š 1vi configure-sqoop åŽ»æŽ‰æœªå®‰è£…æœåŠ¡ç›¸å…³å†…å®¹ï¼Œ ä¾‹å¦‚ï¼ˆHBaseã€HCatalogã€Accumuloï¼‰ 1234#if [ ! -d "$&#123;HBASE_HOME&#125;" ]; then# echo "Error: $HBASE_HOME does not exist!"# echo 'Please set $HBASE_HOME to the root of your HBase installation.'# exit 1 http://sqoop.apache.org/docs/1.4.7/SqoopUserGuide.html å¯¼å…¥ å‘½ä»¤è¡Œæ–¹å¼ æ–‡ä»¶é…ç½®æ–¹å¼ 123$ sqoop import --connect jdbc:mysql://localhost/db --username foo --table TEST$ sqoop --options-file /users/homer/work/import.txt --table TEST å‚è€ƒ http://sqoop.apache.org/docs/1.4.6/SqoopUserGuide.html#_literal_sqoop_import_literal 123456create table t_test( id int default '0' null, name varchar(100) default '' null); mysqlå¯¼å…¥åˆ°hdfsvi option1 1234567891011121314151617import--connectjdbc:mysql://node01:3306/test--usernameroot--password123--as-textfile--columnsid,name--tablet_test--delete-target-dir--target-dir/sqoop/data-m1 1sqoop --options-file /root/sqoop_option/option1 mysqlå¯¼å…¥åˆ°hdfsï¼Œå¸¦æŸ¥è¯¢1vi option2 123456789101112131415161718192021import--connectjdbc:mysql://node01/test--usernameroot--password123--as-textfile--query'select id, name, msg from psn where id like "1%" and $CONDITIONS'--delete-target-dir--target-dir/sqoop/tmp-m1--hive-home/home/hive-1.2.1--hive-import--create-hive-table--hive-tablet_test å¯¼å‡ºå‚è€ƒ http://sqoop.apache.org/docs/1.4.6/SqoopUserGuide.html#_literal_sqoop_export_literal åˆ›å»ºmysqlè¡¨ 12345create table t_test2( id int default '0' null, name varchar(100) default '' null) åˆ›å»ºå‘½ä»¤é…ç½® 1vi option3 123456789101112131415export--connectjdbc:mysql://node01/test--usernameroot--password123-m1--columnsid,name--export-dir/sqoop/data--tablet_test2 æ‰§è¡Œ 1sqoop --options-file /root/sqoop_option/option3]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[javaçº¿ç¨‹æ± è®¾ç½®æŒ‡å—]]></title>
    <url>%2F2019%2F06%2F12%2Fjava%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AE%BE%E7%BD%AE%E6%8C%87%E5%8D%97%2F</url>
    <content type="text"><![CDATA[çº¿ç¨‹æ•°è®¾ç½®å…¬å¼1æœ€ä½³çº¿ç¨‹æ•°ç›® = ï¼ˆï¼ˆçº¿ç¨‹ç­‰å¾…æ—¶é—´+çº¿ç¨‹CPUæ—¶é—´ï¼‰/çº¿ç¨‹CPUæ—¶é—´ ï¼‰* CPUæ•°ç›® æœåŠ¡å™¨CPUæ ¸æ•°ä¸º4æ ¸ï¼Œä¸€ä¸ªä»»åŠ¡çº¿ç¨‹cpuè€—æ—¶ä¸º20msï¼Œçº¿ç¨‹ç­‰å¾…ï¼ˆç½‘ç»œIOã€ç£ç›˜IOï¼‰è€—æ—¶80msï¼Œé‚£æœ€ä½³çº¿ç¨‹æ•°ç›®ï¼š( 80 + 20 )/20 * 4 = 20ã€‚ä¹Ÿå°±æ˜¯è®¾ç½®20ä¸ªçº¿ç¨‹æ•°æœ€ä½³ã€‚ ä»Žè¿™ä¸ªå…¬å¼ä¸Šé¢æˆ‘ä»¬å°±å¾—å‡ºï¼Œçº¿ç¨‹çš„ç­‰å¾…æ—¶é—´è¶Šå¤§ï¼Œçº¿ç¨‹æ•°å°±è¦è®¾ç½®è¶Šå¤§ï¼Œè¿™ä¸ªæ­£å¥½ç¬¦åˆæˆ‘ä»¬ä¸Šé¢çš„åˆ†æžï¼Œå¯æå‡CPUåˆ©ç”¨çŽ‡ã€‚é‚£ä»Žå¦ä¸€ä¸ªè§’åº¦ä¸Šé¢è¯´ï¼Œçº¿ç¨‹æ•°è®¾ç½®å¤šå¤§ï¼Œæ˜¯æ ¹æ®æˆ‘ä»¬è‡ªèº«çš„ä¸šåŠ¡çš„ï¼Œéœ€è¦è‡ªå·±åŽ»åŽ‹åŠ›æµ‹è¯•ï¼Œè®¾ç½®ä¸€ä¸ªåˆç†çš„æ•°å€¼ã€‚ å¸¸ç”¨æ ‡å‡†è®¾ç½®CPUå¯†é›†åž‹ï¼šæ“ä½œå†…å­˜å¤„ç†çš„ä¸šåŠ¡ï¼Œä¸€èˆ¬çº¿ç¨‹æ•°è®¾ç½®ä¸ºï¼šCPUæ ¸æ•° + 1 æˆ–è€… CPUæ ¸æ•°2æ ¸æ•°ä¸º4çš„è¯ï¼Œä¸€èˆ¬è®¾ç½® 5 æˆ– 8*IOå¯†é›†åž‹ï¼š æ–‡ä»¶æ“ä½œï¼Œç½‘ç»œæ“ä½œï¼Œæ•°æ®åº“æ“ä½œï¼Œä¸€èˆ¬çº¿ç¨‹è®¾ç½®ä¸ºï¼šcpuæ ¸æ•° / (1-0.9)æ ¸æ•°ä¸º4çš„è¯ï¼Œä¸€èˆ¬è®¾ç½® 40]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[jfré‡‡é›†ä½¿ç”¨åŠjmcåˆ†æž]]></title>
    <url>%2F2019%2F06%2F11%2Fjfr%E9%87%87%E9%9B%86%E4%BD%BF%E7%94%A8%E5%8F%8Ajmc%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[æ‰¾åˆ°javaè¿›ç¨‹1ps -ef | grep java è§£é”Javaç¨‹åºçš„å•†ä¸šç‰¹æ€§1234jcmd 12174 VM.check_commercial_features12174:Commercial Features are locked. é‡‡é›†JFRå›ºå®šæ—¶é•¿é‡‡é›†123jcmd $pid JFR.start name=myrec settings=temple delay=20s duration=2m filename=/tmp/$pid.jfrjcmd 12174 JFR.start name=10min.jfr settings=profile delay=3s duration=5m æŒç»­é‡‡é›†JFR1jcmd 12174 JFR.start name=endless settings=profile delay=3s duration=0 compress=true å¯¹äºŽè¿™ç§æŒç»­é‡‡é›†çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è½¬å­˜ï¼š 1jcmd 12174 JFR.dump recording=3 filename="/Users/jianyuan/Personal/dump_endless.jfr" compress=true åˆ†æžJFRæ–‡ä»¶çº¿ä¸‹è¾“å…¥jmc 1jmc æ‰“å¼€java mission control é€‰æ‹©æ‰“å¼€å¯¼å‡ºçš„jfræ–‡ä»¶ åˆ†æžè§’åº¦ä¸€èˆ¬æ¥è¯´å¯ä»¥ä»Žä¸‹é¢å‡ ä¸ªæ–¹å¼æ¥å…¥æ‰‹ï¼š åº”ç”¨å¼‚å¸¸ çƒ­ç‚¹çº¿ç¨‹å’Œæ–¹æ³• ä¸åˆé¢„æœŸçš„IO è¿‡é•¿çš„GC å‚è€ƒ https://blog.csdn.net/yue530tomtom/article/details/80805412 http://www.manongjc.com/article/7589.html]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Arthasä½¿ç”¨æ–‡æ¡£]]></title>
    <url>%2F2019%2F06%2F11%2FArthas%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3%2F</url>
    <content type="text"><![CDATA[å®‰è£…æ‰‹åŠ¨å®‰è£…æŽ¨èhttps://alibaba.github.io/arthas/manual-install.html ä½¿ç”¨å‘½ä»¤watch æŸ¥çœ‹æ–¹æ³•çš„è¿”å›žå€¼12watch demo.MathGame primeFactors returnObjwatch stack æŸ¥çœ‹æ–¹æ³•è°ƒç”¨æ ˆå‚è€ƒ https://alibaba.github.io/arthas/stack.html 1stack demo.MathGame primeFactors threadå‚è€ƒ https://alibaba.github.io/arthas/thread.html å½“å‰æœ€å¿™çš„å‰Nä¸ªçº¿ç¨‹1thread -n 3 æ‰¾å‡ºå½“å‰é˜»å¡žå…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹1thread -b]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[HBaseåŽŸç†æ¡ˆä¾‹åŠæ­å»º]]></title>
    <url>%2F2019%2F06%2F08%2FHBase%E5%8E%9F%E7%90%86%E6%A1%88%E4%BE%8B%E5%8F%8A%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[HBase æ•°æ®æ¨¡åž‹ Row Key Time Stamp CF1 CF2 CF3 11248112 t6 CF2:q1=val1 CF3:q3=val3 t3 t2 CF1:q2=val2 ROW KEY å†³å®šä¸€è¡Œæ•°æ® æŒ‰ç…§å­—å…¸é¡ºåºæŽ’åºçš„ã€‚ Row keyåªèƒ½å­˜å‚¨64kçš„å­—èŠ‚æ•°æ® Column Familyåˆ—æ— HBaseè¡¨ä¸­çš„æ¯ä¸ªåˆ—éƒ½å½’å±žäºŽæŸä¸ªåˆ—æ—ï¼Œåˆ—æ—å¿…é¡»ä½œä¸ºè¡¨æ¨¡å¼(schema)å®šä¹‰çš„ä¸€éƒ¨åˆ†é¢„å…ˆç»™å‡ºã€‚å¦‚create &#39;tbl&#39;, â€˜cfâ€™ åˆ—åä»¥åˆ—æ—ä½œä¸ºå‰ç¼€ï¼Œcf:name æƒé™æŽ§åˆ¶ã€å­˜å‚¨ä»¥åŠè°ƒä¼˜éƒ½æ˜¯åœ¨åˆ—æ—å±‚é¢è¿›è¡Œçš„ï¼› HBaseæŠŠåŒä¸€åˆ—æ—é‡Œé¢çš„æ•°æ®å­˜å‚¨åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œç”±å‡ ä¸ªæ–‡ä»¶ä¿å­˜ã€‚ Timestampæ—¶é—´æˆ³ åœ¨HBaseæ¯ä¸ªcellå­˜å‚¨å•å…ƒå¯¹åŒä¸€ä»½æ•°æ®æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ ¹æ®å”¯ä¸€çš„æ—¶é—´æˆ³æ¥åŒºåˆ†æ¯ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ï¼Œä¸åŒç‰ˆæœ¬çš„æ•°æ®æŒ‰ç…§æ—¶é—´å€’åºæŽ’åºï¼Œæœ€æ–°çš„æ•°æ®ç‰ˆæœ¬æŽ’åœ¨æœ€å‰é¢ã€‚ æ—¶é—´æˆ³çš„ç±»åž‹æ˜¯ 64ä½æ•´åž‹ã€‚ æ—¶é—´æˆ³å¯ä»¥ç”±HBase(åœ¨æ•°æ®å†™å…¥æ—¶è‡ªåŠ¨)èµ‹å€¼ï¼Œæ­¤æ—¶æ—¶é—´æˆ³æ˜¯ç²¾ç¡®åˆ°æ¯«ç§’çš„å½“å‰ç³»ç»Ÿæ—¶é—´ã€‚ æ—¶é—´æˆ³ä¹Ÿå¯ä»¥ç”±å®¢æˆ·æ˜¾å¼èµ‹å€¼ï¼Œå¦‚æžœåº”ç”¨ç¨‹åºè¦é¿å…æ•°æ®ç‰ˆæœ¬å†²çªï¼Œå°±å¿…é¡»è‡ªå·±ç”Ÿæˆå…·æœ‰å”¯ä¸€æ€§çš„æ—¶é—´æˆ³ã€‚ Cellå•å…ƒæ ¼ ç”±{row keyï¼Œ column(&lt;family&gt; +&lt;qualifier&gt;)ï¼Œ version}å”¯ä¸€ç¡®å®šçš„å•å…ƒã€‚ cellä¸­çš„æ•°æ®æ˜¯æ²¡æœ‰ç±»åž‹çš„ï¼Œå…¨éƒ¨æ˜¯å­—èŠ‚ç å½¢å¼å­˜è´®ã€‚ HLog(WAL log) HLogæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„Hadoop Sequence Fileï¼ŒSequence File çš„Keyæ˜¯HLogKeyå¯¹è±¡ï¼ŒHLogKeyä¸­è®°å½•äº†å†™å…¥æ•°æ®çš„å½’å±žä¿¡æ¯ï¼Œé™¤äº†tableå’Œregionåå­—å¤–ï¼ŒåŒæ—¶è¿˜åŒ…æ‹¬ sequence numberå’Œtimestampï¼Œtimestampæ˜¯â€ å†™å…¥æ—¶é—´â€ï¼Œsequence numberçš„èµ·å§‹å€¼ä¸º0ï¼Œæˆ–è€…æ˜¯æœ€è¿‘ä¸€æ¬¡å­˜å…¥æ–‡ä»¶ç³»ç»Ÿä¸­sequence numberã€‚ ç±»ä¼¼binlog HBase æž¶æž„ å†™æµç¨‹ clientè®°å½•å†™å…¥æ•°æ®ï¼Œåˆ°Hlog memstore memstoreè¾¾åˆ°é˜ˆå€¼,å†™å…¥åˆ°store file Client åŒ…å«è®¿é—®HBaseçš„æŽ¥å£å¹¶ç»´æŠ¤cacheæ¥åŠ å¿«å¯¹HBaseçš„è®¿é—® Zookeeper ä¿è¯ä»»ä½•æ—¶å€™ï¼Œé›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªmaster å­˜è´®æ‰€æœ‰Regionçš„å¯»å€å…¥å£ã€‚ å®žæ—¶ç›‘æŽ§Region serverçš„ä¸Šçº¿å’Œä¸‹çº¿ä¿¡æ¯ã€‚å¹¶å®žæ—¶é€šçŸ¥Master å­˜å‚¨HBaseçš„schemaå’Œtableå…ƒæ•°æ® Master ä¸ºRegion serveråˆ†é…region è´Ÿè´£Region serverçš„è´Ÿè½½å‡è¡¡ å‘çŽ°å¤±æ•ˆçš„Region serverå¹¶é‡æ–°åˆ†é…å…¶ä¸Šçš„region ç®¡ç†ç”¨æˆ·å¯¹tableçš„å¢žåˆ æ”¹æ“ä½œ RegionServer Region serverç»´æŠ¤regionï¼Œå¤„ç†å¯¹è¿™äº›regionçš„IOè¯·æ±‚ Region serverè´Ÿè´£åˆ‡åˆ†åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å˜å¾—è¿‡å¤§çš„region Region HBaseè‡ªåŠ¨æŠŠè¡¨æ°´å¹³åˆ’åˆ†æˆå¤šä¸ªåŒºåŸŸ(region)ï¼Œæ¯ä¸ªregionä¼šä¿å­˜ä¸€ä¸ªè¡¨é‡Œé¢æŸæ®µè¿žç»­çš„æ•°æ® æ¯ä¸ªè¡¨ä¸€å¼€å§‹åªæœ‰ä¸€ä¸ªregionï¼Œéšç€æ•°æ®ä¸æ–­æ’å…¥è¡¨ï¼Œregionä¸æ–­å¢žå¤§ï¼Œå½“å¢žå¤§åˆ°ä¸€ä¸ªé˜€å€¼çš„æ—¶å€™ï¼Œregionå°±ä¼šç­‰åˆ†ä¼šä¸¤ä¸ªæ–°çš„regionï¼ˆè£‚å˜ï¼‰ å½“tableä¸­çš„è¡Œä¸æ–­å¢žå¤šï¼Œå°±ä¼šæœ‰è¶Šæ¥è¶Šå¤šçš„regionã€‚è¿™æ ·ä¸€å¼ å®Œæ•´çš„è¡¨è¢«ä¿å­˜åœ¨å¤šä¸ªRegionserver ä¸Šã€‚ HRegionæ˜¯HBaseä¸­åˆ†å¸ƒå¼å­˜å‚¨å’Œè´Ÿè½½å‡è¡¡çš„æœ€å°å•å…ƒã€‚æœ€å°å•å…ƒå°±è¡¨ç¤ºä¸åŒçš„HRegionå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„ HRegion serverä¸Šã€‚ HRegionç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªStoreç»„æˆï¼Œæ¯ä¸ªstoreä¿å­˜ä¸€ä¸ªcolumns familyã€‚ æ¯ä¸ªStroreåˆç”±ä¸€ä¸ªmemStoreå’Œ0è‡³å¤šä¸ªStoreFileç»„æˆã€‚å¦‚å›¾ï¼šStoreFileä»¥HFileæ ¼å¼ä¿å­˜åœ¨HDFSä¸Šã€‚ memstore ä¸Ž storefile ä¸€ä¸ªregionç”±å¤šä¸ªstoreç»„æˆï¼Œä¸€ä¸ªstoreå¯¹åº”ä¸€ä¸ªCFï¼ˆåˆ—æ—ï¼‰ storeåŒ…æ‹¬ä½äºŽå†…å­˜ä¸­çš„memstoreå’Œä½äºŽç£ç›˜çš„storefileå†™æ“ä½œå…ˆå†™å…¥memstoreï¼Œå½“memstoreä¸­çš„æ•°æ®è¾¾åˆ°æŸä¸ªé˜ˆå€¼ï¼Œhregionserverä¼šå¯åŠ¨flashcacheè¿›ç¨‹å†™å…¥storefileï¼Œæ¯æ¬¡å†™å…¥å½¢æˆå•ç‹¬çš„ä¸€ä¸ªstorefile å½“storefileæ–‡ä»¶çš„æ•°é‡å¢žé•¿åˆ°ä¸€å®šé˜ˆå€¼åŽï¼Œç³»ç»Ÿä¼šè¿›è¡Œåˆå¹¶ï¼ˆminorã€major compactionï¼‰ï¼Œåœ¨åˆå¹¶è¿‡ç¨‹ä¸­ä¼šè¿›è¡Œç‰ˆæœ¬åˆå¹¶å’Œåˆ é™¤å·¥ä½œï¼ˆmajarï¼‰ï¼Œå½¢æˆæ›´å¤§çš„storefile å½“ä¸€ä¸ªregionæ‰€æœ‰storefileçš„å¤§å°å’Œæ•°é‡è¶…è¿‡ä¸€å®šé˜ˆå€¼åŽï¼Œä¼šæŠŠå½“å‰çš„regionåˆ†å‰²ä¸ºä¸¤ä¸ªï¼Œå¹¶ç”±hmasteråˆ†é…åˆ°ç›¸åº”çš„regionserveræœåŠ¡å™¨ï¼Œå®žçŽ°è´Ÿè½½å‡è¡¡ å®¢æˆ·ç«¯æ£€ç´¢æ•°æ®ï¼Œå…ˆåœ¨memstoreæ‰¾ï¼Œæ‰¾ä¸åˆ°å†æ‰¾storefile SequeceFileçš„Valueæ˜¯HBaseçš„KeyValueå¯¹è±¡ï¼Œå³å¯¹åº”HFileä¸­çš„KeyValue StoreFile ç­‰ä»·äºŽhdfs file è¯»é¡ºåº 1.è¯»memstoreï¼Œæ²¡æœ‰åˆ™ä¸‹ä¸€æ­¥ 2.è¯»block cacheï¼Œæ²¡æœ‰åˆ™ä¸‹ä¸€æ­¥ 3.è¯»store file å†™é¡ºåº 1.å†™memstoreï¼Œè¾¾åˆ°é˜ˆå€¼ï¼Œä¸‹ä¸€æ­¥ 2.å†™store file HBase å®Œå…¨HAåˆ†å¸ƒå¼æ­å»º zookeeper master region server master backup node01 * node02 * * node03 * * node04 * * hbase-env.sh é…ç½®confä¸­ jdkåœ°å€ ä½¿ç”¨è‡ªå·±é…ç½®zkï¼Œä¸é€‚ç”¨hbaseè‡ªå¸¦å†…ç½®çš„zk 1234vi hbase-env.shexport JAVA_HOME=/usr/install/jdk/jdk1.8.0_171/export HBASE_MANAGES_ZK=false hbase-site.xmlé…ç½® hbaseåœ¨hdfsçš„ç›®å½• æ˜¯å¦åˆ†å¸ƒå¼ zkåœ°å€ 123456789101112131415vi hbase-site.xml&lt;property&gt; &lt;name&gt;hbase.rootdir&lt;/name&gt; &lt;value&gt;hdfs://mycluster/hbase&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hbase.cluster.distributed&lt;/name&gt; &lt;value&gt;true&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt; &lt;value&gt;node02,node03,node04&lt;/value&gt;&lt;/property&gt; regionserversé…ç½®123vi regionserversnode02 node03 backup-mastersé…ç½®æ·»åŠ  backup-masters 123vi backup-mastersnode04 hdfs-site.xmlå¤åˆ¶1cp /opt/sxt/hadoop-2.6.5/etc/hadoop/hdfs-site.xml ./ çŽ¯å¢ƒå˜é‡é…ç½®123456vi /etc/profileexport HBASE_HOME=/root/hbase-0.98.12.1-hadoop2export PATH=$PATH:$ZOOKEEPER_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$HBASE_HOME/binsource /etc/profile æ³¨æ„å„èŠ‚ç‚¹çš„æ—¶é—´ä¸€è‡´ ç»™å…¶ä»–èŠ‚ç‚¹scpä¸€ä»½123scp -r hbase-0.98.12.1-hadoop2 root@node02:/root/scp -r hbase-0.98.12.1-hadoop2 root@node03:/root/scp -r hbase-0.98.12.1-hadoop2 root@node04:/root/ å¯åŠ¨start-hbase.shéœ€è¦æå‰å¯åŠ¨node02ã€03ã€04çš„zkï¼Œstart-hdfs.shæœåŠ¡ 1start-hbase.sh éªŒè¯æ˜¯å¦å¯åŠ¨æˆåŠŸ123hbase shellhelpcreate 'tbl','cf' 123456hbase(main):023:0&gt; scan 'tbl'ROW COLUMN+CELL 1111 column=cf:age, timestamp=1559984836555, value=12 1111 column=cf:name, timestamp=1559984734803, value=zhangsan 2222 column=cf:sex, timestamp=1559984896283, value=boy2 row(s) in 0.0480 seconds 1get 'tbl','1111' æ•°æ®å†…å®¹å…ˆå†™åˆ°memstore æ‰§è¡Œflushï¼ŒæŸ¥çœ‹filestore http://node02:50070/explorer.html#/hbase/data/default/tbl/78a2935308b5f14d4c23a999ee797ed2/cf 1flush 'tbl' http://node02:50070/explorer.html#/hbase/data/default/tbl 1node01:60010 DDLæ“ä½œè¿›å…¥client shell1hbase shell å¸®åŠ©1help åˆ›å»ºè¡¨åˆ—æ—æ•°é‡2åˆ°3ä¸ª 1create 'tbl','cf1','cf2' æè¿°è¡¨1desc 'tbl' åˆ—è¡¨list1list åˆ é™¤è¡¨12disable 'tbl'drop 'tbl' æ’å…¥æ•°æ®123put 'tbl','1111','cf:name','zhangsan'put 'tbl','1111','cf:age','12'put 'tbl','2222','cf:sex','boy' flushæ•°æ®ï¼Œmemstoreç«‹å³åˆ°store fileï¼Œåˆ°hdfsä¸­ 1flush 'tbl' æŸ¥çœ‹æ•°æ®æŸ¥çœ‹å…¨è¡¨1scan 'tbl' æŸ¥çœ‹å•æ¡1get 'tbl','1111' æº¢å†™æ•°æ®hbase shellæ‰§è¡Œ 1flush 'eventlog' æŸ¥çœ‹hdfsçš„å­˜å‚¨æ–‡ä»¶hdfsæŸ¥çœ‹ç›®å½• /hbase/data/default/eventlog/43169c43dc06d3e24836e3291149f8e5/log ç›´æŽ¥æœåŠ¡å™¨æ‰§è¡Œ 1hbase hfile -p -f /hbase/data/default/eventlog/43169c43dc06d3e24836e3291149f8e5/log/9bb18168d5e2437491a5adeaae62f864 hbase javaå®žæˆ˜è¡¨åˆ›å»º1234567891011121314151617181920private static void createTable() &#123; try &#123; Configuration conf = new Configuration(); conf.set("hbase.zookeeper.quorum", "node02,node03,node04"); admin = new HBaseAdmin(conf); HTableDescriptor desc = new HTableDescriptor(tableName); HColumnDescriptor columnDescriptor = new HColumnDescriptor("cf"); desc.addFamily(columnDescriptor); admin.createTable(desc); if (admin != null) &#123; admin.close(); &#125; &#125; catch (Exception e) &#123; // TODO: handle exception &#125;&#125; æ’å…¥12345678910111213141516171819202122private static void insertTable() &#123; try &#123; Configuration conf = new Configuration(); conf.set("hbase.zookeeper.quorum", "node02,node03,node04"); HTable hTable = new HTable(conf, tableName); Put put = new Put("1111".getBytes()); put.add("cf".getBytes(), "name".getBytes(), "zhangsan".getBytes()); put.add("cf".getBytes(), "age".getBytes(), "12".getBytes()); put.add("cf".getBytes(), "sex".getBytes(), "boy".getBytes()); hTable.put(put); if (admin != null) &#123; admin.close(); &#125; &#125; catch (Exception e) &#123; // TODO: handle exception &#125;&#125; æŸ¥è¯¢12345678910111213141516171819202122232425262728293031 private static void getTable() &#123; try &#123; Configuration conf = new Configuration(); conf.set("hbase.zookeeper.quorum", "node02,node03,node04"); HTable hTable = new HTable(conf, tableName); Get get = new Get("1111".getBytes()); // define return columns in family get.addColumn("cf".getBytes(), "name".getBytes()); get.addColumn("cf".getBytes(), "age".getBytes()); get.addColumn("cf".getBytes(), "sex".getBytes()); Result result = hTable.get(get); Cell cell = result.getColumnLatestCell("cf".getBytes(), "name".getBytes()); Cell cell2 = result.getColumnLatestCell("cf".getBytes(), "age".getBytes()); Cell cell3 = result.getColumnLatestCell("cf".getBytes(), "sex".getBytes());// System.out.println(new String( cell.getValue())); System.out.println(new String(CellUtil.cloneValue(cell))); System.out.println(new String(CellUtil.cloneValue(cell2))); System.out.println(new String(CellUtil.cloneValue(cell3))); if (admin != null) &#123; admin.close(); &#125; &#125; catch (Exception e) &#123; // TODO: handle exception &#125; &#125; Hbaseå‡ºçŽ°ServerNotRunningYetExceptionçš„è§£å†³æ–¹æ¡ˆå› ä¸ºhadoopå¤„åœ¨å®‰å…¨æ¨¡å¼ä¸‹ã€‚æ‰€ä»¥hbaseçš„æ“ä½œä¼šå‡ºçŽ°å¼‚å¸¸ã€‚ 1hadoop dfsadmin -safemode leave hbase shellä¸­ä½¿ç”¨listå‘½ä»¤æŠ¥é”™ https://blog.csdn.net/hll19950830/article/details/80022676]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[HiveåŽŸç†æ¡ˆä¾‹åŠæ­å»º]]></title>
    <url>%2F2019%2F05%2F21%2FHive%E5%8E%9F%E7%90%86%E6%A1%88%E4%BE%8B%E5%8F%8A%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[Hiveæ­å»ºin-memory derbyå†…å­˜æ•°æ®åº“ï¼Œå®žé™…ä¸ç”¨ è¿œç¨‹æœåŠ¡å™¨æ¨¡å¼ å‰é¢ä¸ºhadoopéƒ¨åˆ† å…ƒæ•°æ® ä¿å­˜åœ¨MySQL namenode ä¸»å¤‡ ZKFC datanode zookeeper JNN mysql hive Metastore Server hive client node01 * * * * node02 * * * * * * node03 * * * * node04 * * Thrift MetaStore Server mysqlå®‰è£…123è§£å†³æ— åŒ…å¯ç”¨ï¼Œä¸‹è½½åœ°å€ http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpmrpm -ivh mysql-community-release-el7-5.noarch.rpmyum install -y mysql-server æœåŠ¡mysqlå¯åŠ¨ 1service mysqld start 12345mysqlshow databasesuse mysqlshow tablesdesc user; ä¿®æ”¹æŽˆæƒç”¨æˆ·å¯†ç  123456789select Host , User , Password from user;GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123' WITH GRANT OPTION;delete from user where Host != '%';flush privileges;quitmysql -uroot -p;å«ä¹‰ï¼šALL PRIVILEGESæ‰€æœ‰æƒé™ï¼Œ*.*æ‰€æœ‰åº“æ‰€æœ‰è¡¨ï¼Œ %ä»»ä½•host rootç”¨æˆ·å 123å¯†ç  hive Metastore Server1234æœåŠ¡ç«¯éœ€è¦è¿žæŽ¥mysqlscp apache-hive-1.2.1-bin.tar.gz mysql-connector-java-5.1.32-bin.jar root@node02:/root/tar zxvf apache-hive-1.2.1-bin.tar.gzcp mysql-connector-java-5.1.32-bin.jar apache-hive-1.2.1-bin/lib/ çŽ¯å¢ƒå˜é‡ 1234vi /etc/profileexport HIVE_HOME=/root/apache-hive-1.2.1-binexport PATH=$PATH:$ZOOKEEPER_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$HIVE_HOME/binsource /etc/profile é…ç½®æ–‡ä»¶ å‚è€ƒ https://cwiki.apache.org/confluence/display/Hive/AdminManual+Configuration https://cwiki.apache.org/confluence/display/Hive/AdminManual+Metastore+Administration https://cwiki.apache.org/confluence/display/Hive/AdminManual+Metastore+Administration#AdminManualMetastoreAdministration-RemoteMetastoreServer 12345cd conf/mv hive-default.xml.template hive-site.xmlvi hive-site.xmlä»Žå½“å‰è¡Œ &lt;configuration&gt;ä¸‹é¢ä¸€è¡Œï¼Œ åˆ é™¤åˆ°å€’æ•°-1è¡Œ:.,$-1d 123456789101112131415161718192021222324&lt;property&gt; &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt; &lt;value&gt;/user/hive/warehouse&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt; &lt;value&gt;jdbc:mysql://node01:3306/hive?createDatabaseIfNotExist=true&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt; &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt; &lt;value&gt;root&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt; &lt;value&gt;123&lt;/value&gt; &lt;/property&gt; å¯åŠ¨metastore server1hive --service metastore ä¹Ÿå¯ä½¿ç”¨hiveserver2 beelineæ–¹å¼ hive clientvi hive-site.xml 1:.,$-1d è¿žæŽ¥metastore çŽ¯å¢ƒå˜é‡ ./hive 1234567891011121314&lt;property&gt; &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt; &lt;value&gt;/user/hive/warehouse&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hive.metastore.local&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hive.metastore.uris&lt;/name&gt; &lt;value&gt;thrift://node02:9083&lt;/value&gt; &lt;/property&gt; 12345&lt;property&gt; &lt;name&gt;hive.metastore.local&lt;/name&gt; &lt;value&gt;false&lt;/value&gt; &lt;/property&gt; å¯ä»¥åŽ»æŽ‰,é¿å…waringMetastore is remote. Note: This is no longer needed as of Hive 0.10. Setting hive.metastore.uri is sufficient. é¿å…jlineæŠ¥é”™ 123cd /opt/sxt/hadoop-2.6.5/share/hadoop/yarn/librm jline-0.9.94.jarcp /root/apache-hive-1.2.1-bin/lib/jline-2.12.jar ./ å¯åŠ¨ 1hive hiveæ“ä½œ12create table tbl(id int,age int);show tables; 1insert into tbl values(1,1); Time taken: 175.393 seconds æŸ¥çœ‹map reduece æ‰§è¡ŒjobçŠ¶æ€ http://node03:8088/cluster 1select * from tbl; æŸ¥çœ‹hdfså­˜å‚¨ http://node01:50070/explorer.html#/user/hive/warehouse/tbl 1hdfs dfs -cat /user/hive/warehouse/tbl/* hiveæ•°æ®ç±»åž‹: primitive_type | array_type æ•°ç»„ | map_type mapç±»åž‹ | struct_type ç»“æž„ä½“ ï¼šprimitive_type |TINYINT | SMALLINT | INT | BIGINT | BOOLEAN | FLOAT | DOUBLE | STRING å‚è€ƒ https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-CreateTable åˆ›å»ºè¡¨å†…éƒ¨è¡¨12345678910create table psn(id int,name string,likes array&lt;string&gt;,address map&lt;string,string&gt;)row format DELIMITEDFIELDS TERMINATED BY ','COLLECTION ITEMS TERMINATED BY '-'MAP KEYS TERMINATED BY ':'; 1234äººå‘˜è¡¨id,å§“å,çˆ±å¥½ï¼Œä½å€1,å°æ˜Ž1,lol-book-movie,zhejiang:hangzhou-guangdong:shenzhen2,å°æ˜Ž2,lol-book,zhejiang:hangzhou-guangdong:shenzhen æè¿°è¡¨1234desc psn;desc formatted psn;Table Type: MANAGED_TABLE å†…éƒ¨è¡¨ æ•°æ®æ’å…¥å‚è€ƒ https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-Loadingfilesintotables æ–‡ä»¶å¯¼å…¥ 1LOAD DATA LOCAL INPATH '/root/persondata' INTO TABLE psn; 1234hive&gt; select * from psn;OK1 å°æ˜Ž1 ["lol","book","movie"] &#123;"zhejiang":"hangzhou","guangdong":"shenzhen"&#125;2 å°æ˜Ž2 ["lol","book"] &#123;"zhejiang":"hangzhou","guangdong":"shenzhen"&#125; å¤–éƒ¨è¡¨persondataä¸ºæ•°æ®txt 12hdfs dfs mkdir /external_tablehdfs dfs -put persondata /external_table/ åˆ›å»ºtable 1234567891011create EXTERNAL table psn_external(id int,name string,likes array&lt;string&gt;,address map&lt;string,string&gt;)row format DELIMITEDFIELDS TERMINATED BY ','COLLECTION ITEMS TERMINATED BY '-'MAP KEYS TERMINATED BY ':'LOCATION '/external_table'; 123select * from psn_external;desc formatted psn_external;Table Type: EXTERNAL_TABLE å†…éƒ¨ï¼šåˆ é™¤å…ƒæ•°æ®ï¼ŒåŠç›®å½• å¤–éƒ¨ï¼šåªåˆ é™¤å…ƒæ•°æ®ï¼Œå­˜æ”¾ç›®å½•ä¸ä¼šåˆ é™¤ å…¶ä»–åˆ›å»ºè¡¨æ–¹å¼1create table like table; 1create table psn2 as select id,name,likes from psn; åˆ†åŒºè¡¨å•ä¸ªå­—æ®µåˆ†åŒºæŒ‰å¹´é¾„åˆ†åŒº 123id,å¹´é¾„çˆ±å¥½ï¼Œä½å€1,å°æ˜Ž1,lol-book-movie,zhejiang:hangzhou-guangdong:shenzhen2,å°æ˜Ž2,lofl-book,zhejiang:hangzhou-guangdong:shenzhen 1234567891011create table psn_partition(id int,name string,likes array&lt;string&gt;,address map&lt;string,string&gt;)PARTITIONED BY (age int)row format DELIMITEDFIELDS TERMINATED BY ','COLLECTION ITEMS TERMINATED BY '-'MAP KEYS TERMINATED BY ':'; é€šè¿‡åˆ†åŒºæŒ‡å®šå¹´é¾„ 12LOAD DATA LOCAL INPATH '/root/persondata' INTO TABLE psn_partition partition(age=10);LOAD DATA LOCAL INPATH '/root/persondata' INTO TABLE psn_partition partition(age=20); å¤šä¸ªå­—æ®µåˆ†åŒºæŒ‰å¹´é¾„å’Œæ€§åˆ«åˆ†åŒº 1234567891011create table psn_partition_multi(id int,name string,likes array&lt;string&gt;,address map&lt;string,string&gt;)PARTITIONED BY (age int,sex string)row format DELIMITEDFIELDS TERMINATED BY ','COLLECTION ITEMS TERMINATED BY '-'MAP KEYS TERMINATED BY ':'; é€šè¿‡åˆ†åŒºæŒ‡å®šå¹´é¾„ã€æ€§åˆ« 123LOAD DATA LOCAL INPATH '/root/persondata' INTO TABLE psn_partition_multi partition(age=10,sex='boy');LOAD DATA LOCAL INPATH '/root/persondata' INTO TABLE psn_partition_multi partition(age=10,sex='girl');LOAD DATA LOCAL INPATH '/root/persondata' INTO TABLE psn_partition_multi partition(age=20,sex='girl'); åˆ é™¤åˆ†åŒºå‚è€ƒæ–‡æ¡£ https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-DropPartitions 10å’Œ20çš„girläºŒçº§åˆ†åŒºéƒ½åˆ æŽ‰ 1ALTER TABLE psn_partition_multi DROP PARTITION (sex='girl'); æ·»åŠ åˆ†åŒºå¿…é¡»æŒ‡å®šç¬¬ä¸€çº§åˆ†åŒºå¹´é¾„ 1ALTER TABLE psn_partition_multi ADD PARTITION (age=10,sex='girl'); DMLfrom insert selectæ–¹å¼1create table psn_copy like psn; 123FROM psnINSERT OVERWRITE TABLE psn_copySELECT id,name,likes,address; Hive Beelinehiveserver2node02 1hiveserver2 beelinenode03 1beeline ç”Ÿäº§çŽ¯å¢ƒç”¨ ç”¨æˆ·åã€å¯†ç ä¸æ ¡éªŒ 123!connect jdbc:hive2://node02:10000/default; root 123show tables; 123456780: jdbc:hive2://node02:10000/default&gt; select * from psn;+---------+-----------+-------------------------+-------------------------------------------------+--+| psn.id | psn.name | psn.likes | psn.address |+---------+-----------+-------------------------+-------------------------------------------------+--+| 1 | å°æ˜Ž1 | ["lol","book","movie"] | &#123;"zhejiang":"hangzhou","guangdong":"shenzhen"&#125; || 2 | å°æ˜Ž2 | ["lol","book"] | &#123;"zhejiang":"hangzhou","guangdong":"shenzhen"&#125; |+---------+-----------+-------------------------+-------------------------------------------------+--+2 rows selected (3.391 seconds) é€€å‡º 1!quit hive jdbc demoå‚è€ƒhivedemo 1234567891011121314151617181920public class HiveJdbcClient &#123; private static String driverName = "org.apache.hive.jdbc.HiveDriver"; public static void main(String[] args) throws SQLException &#123; try &#123; Class.forName(driverName); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; Connection conn = DriverManager.getConnection("jdbc:hive2://node02:10000/default", "root", ""); Statement stmt = conn.createStatement(); String sql = "select * from psn limit 5"; ResultSet res = stmt.executeQuery(sql); while (res.next()) &#123; System.out.println(res.getString(1) + "-" + res.getString("name")); &#125; &#125;&#125; hive å‡½æ•°UDF ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°12345678910111213141516package cn.laolian;import org.apache.hadoop.hive.ql.exec.UDF;import org.apache.hadoop.io.Text;public class TuoMin extends UDF &#123; public Text evaluate(final Text s) &#123; if (s == null) &#123; return null; &#125; String str = s.toString().substring(0, 3) + "***"; return new Text(str); &#125;&#125; eclipse å¯¼å‡ºjar åŒ…export jar node02 1hive --service metastore node03 12345hiveadd jar /root/tuomin.jar;create temporary function tm AS 'cn.laolian.TuoMin';select tm(name) from psn; ä¸´æ—¶å‡½æ•°ï¼Œå½“å‰ä¼šè¯æœ‰æ•ˆ 1234hive&gt; select tm(name) from psn;OKå°æ˜Ž1***å°æ˜Ž2*** UDAFUDTF ä¸€è¿›å¤šå‡º1select explode(likes) from psn; 12345678910: jdbc:hive2://node02:10000/default&gt; select explode(likes) from psn;+--------+--+| col |+--------+--+| lol || book || movie || lol || book |+--------+--+ hiveå‚æ•°æ‰“å°å¤´ä¿¡æ¯ æ–¹å¼ä¸€12hiveset hive.cli.print.header=true; 1set; è¿›è¡Œæç¤ºï¼Œå¯¼å‡ºé…ç½® æ–¹å¼äºŒ å¯åŠ¨æ—¶è®¾ç½®1hive --hiveconf hive.cli.print.header=true; åªåœ¨å½“å‰ä¼šè¯æœ‰æ•ˆ 12345hive&gt; select * from psn;OKpsn.id psn.name psn.likes psn.address1 å°æ˜Ž1 ["lol","book","movie"] &#123;"zhejiang":"hangzhou","guangdong":"shenzhen"&#125;2 å°æ˜Ž2 ["lol","book"] &#123;"zhejiang":"hangzhou","guangdong":"shenzhen"&#125; æ–¹å¼ä¸‰ æ‰€æœ‰ä¼šè¯æœ‰æ•ˆ123vi .hiverchive.cli.print.header=true; åŽ†å²å‘½ä»¤1cat .hivehistory Hive åŠ¨æ€åˆ†åŒºä¸¥æ ¼æ¨¡å¼ï¼šè‡³å°‘ä¿è¯æœ‰ä¸€ä¸ªé™æ€åˆ†åŒº 12set hive.exec.dynamic.partition=true;set hive.exec.dynamic.partition.mode=nostrict; 1vi persondata_daynamic_partition 12345id,å§“åï¼Œå¹´é¾„ï¼Œæ€§åˆ«ï¼Œçˆ±å¥½ï¼Œä½å€1,å°æ˜Ž1,10,boy,lol-book-movie,zhejiang:hangzhou-guangdong:shenzhen2,å°æ˜Ž2,10,man,lofl-book,zhejiang:hangzhou-guangdong:shenzhen3,å°æ˜Ž3,20,boy,lofl-book,zhejiang:hangzhou-guangdong:shenzhen2,å°æ˜Ž3,20,man,lofl-book,zhejiang:hangzhou-guangdong:shenzhen åŽŸå§‹è¡¨123456789101112create table psn_dynamic_partition(id int,name string,age int,sex string,likes array&lt;string&gt;,address map&lt;string,string&gt;)row format DELIMITEDFIELDS TERMINATED BY ','COLLECTION ITEMS TERMINATED BY '-'MAP KEYS TERMINATED BY ':'; 1load data local inpath '/root/persondata_daynamic_partition' into table psn_dynamic_partition; åˆ†åŒºè¡¨1234567891011create table psn_dynamic_partition_r(id int,name string,likes array&lt;string&gt;,address map&lt;string,string&gt;)PARTITIONED BY (age int , sex string)row format DELIMITEDFIELDS TERMINATED BY ','COLLECTION ITEMS TERMINATED BY '-'MAP KEYS TERMINATED BY ':'; ä»ŽåŽŸå§‹è¡¨å¯¼å…¥åˆ°åˆ†åŒºè¡¨æ³¨æ„age,sexçš„é¡ºåº 123from psn_dynamic_partitioninsert overwrite table psn_dynamic_partition_r partition(age,sex)select id,name,likes,address,age,sex distribute by age,sex; Hiveè„šæœ¬è¿è¡Œæ–¹å¼12345hive -e "select * from psn"é‡å®šå‘hive -e "select * from psn" &gt; aaaé™é»˜è¾“å‡ºhive -S -e "select * from psn" &gt; aaa æ–‡ä»¶è„šæœ¬12vi sqlselect * from psn 1hive -f sql hive clientç»ˆç«¯äº¤äº’hdfsäº¤äº’1234567hive&gt; dfs -ls / ;Found 5 itemsdrwxr-xr-x - root supergroup 0 2019-04-17 22:08 /datadrwxr-xr-x - root supergroup 0 2019-06-02 19:25 /external_table-rw-r--r-- 2 root supergroup 118 2019-06-02 19:10 /persondatadrwx------ - root supergroup 0 2019-06-02 11:55 /tmpdrwxr-xr-x - root supergroup 0 2019-06-02 12:06 /user linuxäº¤äº’12hive&gt; !pwd;/root Hiveä¼˜åŒ–æ ¸å¿ƒæ€æƒ³ï¼šhive SQL å½“åšMap Reduceç¨‹åºåŽ»ä¼˜åŒ–ä¸¤ç§ä¸ä¼šè½¬åŒ–ä¸ºMapreduceæ‰§è¡Œ selectä»…æŸ¥è¯¢æœ¬è¡¨å­—æ®µ 1select * from psn; selectä»…å¯¹æœ¬è¡¨å­—æ®µåšæ¡ä»¶è¿‡æ»¤ 1select * from psn where id=1; Explainæ‰§è¡Œè®¡åˆ’12explain select * from psn;explain extended select * from psn; æŠ“å–ç­–ç•¥è¿™æ ·ä¼šæ‰§è¡Œmapreduceï¼Œé»˜è®¤å€¼more 12set hive.fetch.task.conversion=none;select * from psn; hiveè¿è¡Œæ–¹å¼æœ¬åœ°æ¨¡å¼æœ¬åœ°æ¨¡å¼ï¼Œå¼€å‘æµ‹è¯•ç”¨ï¼Œç”Ÿäº§ä¸è¦ç”¨ 12set hive.exec.mode.local.auto=true;select count(*) from psn; hive.exec.mode.local.inputbytes.max é»˜è®¤å€¼128Mï¼Œå¤§äºŽè¯¥é…ç½®ï¼Œä¹Ÿä¼šä»¥é›†ç¾¤æ–¹æ³•è¿è¡Œ å¹¶è¡Œè®¡ç®—]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spring framworkæŠ€æœ¯ä½“ç³»ç›®å½•]]></title>
    <url>%2F2019%2F05%2F15%2FSpring-framwork%E6%8A%80%E6%9C%AF%E4%BD%93%E7%B3%BB%E7%9B%AE%E5%BD%95%2F</url>
    <content type="text"><![CDATA[å¼‚å¸¸å¤„ç†åœ¨Springä¸­å¸¸è§çš„å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œä¸»è¦æœ‰ä¸‰ç§ï¼š æ³¨è§£ @ExceptionHandler åœ¨ Controller å†…éƒ¨ï¼Œç”¨ @ExceptionHandleræ³¨è§£çš„æ–¹æ³•ï¼Œå°±ä¼šä½œä¸ºè¯¥Controllerå†…éƒ¨çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ã€‚ è¯¥æ–¹å¼éœ€è¦åœ¨æ¯ä¸ªç±»ä¸­å¤„ç†å¼‚å¸¸ï¼Œä¸é€‚åˆå…¨å±€å¼‚å¸¸å¤„ç†ã€‚ ç»§æ‰¿HandlerExceptionResolveræŽ¥å£ 1234567891011121314151617181920212223@Component@Slf4jpublic class CustomHandlerExceptionResolver implements HandlerExceptionResolver &#123; @Override public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) &#123; Method method = null; if (handler != null &amp;&amp; handler instanceof HandlerMethod) &#123; method = ((HandlerMethod) handler).getMethod(); &#125; log.error("[&#123;&#125;] system error", method, ex); ResponseDTO response = ResponseDTO.builder() .errorCode(ErrorCode.SYSTEM_ERROR) .build(); byte[] bytes = JSON.toJSONString(response).getBytes(StandardCharsets.UTF_8)); try &#123; FileCopyUtils.copy(bytes, response.getOutputStream()); &#125; catch (IOException e) &#123; log.error("error", e); throw new RuntimeException(e); &#125; return new ModelAndView(); &#125;&#125; å‡½æ•°è¿˜å¯ä»¥è¿”å›žä¸€ä¸ª ModelAndView å¯¹è±¡ï¼Œè¡¨ç¤ºæ¸²æŸ“ä¸€ä¸ªè§†å›¾ï¼Œæ¯”æ–¹è¯´é”™è¯¯é¡µé¢ã€‚ä¸è¿‡ï¼Œåœ¨å‰åŽç«¯åˆ†ç¦»ä¸ºä¸»æµæž¶æž„çš„ä»Šå¤©ï¼Œè¿™ä¸ªå¾ˆå°‘ç”¨äº†ã€‚å¦‚æžœå‡½æ•°è¿”å›žçš„è§†å›¾ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºä¸éœ€è¦è§†å›¾ã€‚ æ³¨è§£ @ControllerAdvice 1234567891011@ControllerAdvice(assignableTypes = &#123;GlobalExceptionHandlerMixin.class&#125;)public class ExceptionAdvice &#123; @ExceptionHandler(ErrorCodeWrapperException.class) @ResponseBody public ResponseDTO&lt;?&gt; exceptionHandler(ErrorCodeWrapperException e) &#123; if ((errCodeException.getErrorCode().equals(ErrorCode.SYSTEM_ERROR))) &#123; log.error(e); &#125; return ResponseDTO.ofErroCodeWrapperException(errCodeException); &#125;&#125; ControllerAdvice æ”¯æŒçš„é™å®šèŒƒå›´ æŒ‰æ³¨è§£ï¼š@ControllerAdvice(annotations = RestController.class) æŒ‰åŒ…åï¼š@ControllerAdvice(&quot;org.example.controllers&quot;) æŒ‰ç±»åž‹ï¼š@ControllerAdvice(assignableTypes = {ControllerInterface.class, AbstractController.class}) æºç å¯¹åº” ExceptionHandlerExceptionResolver @ExceptionHandler @ControllerAdvice ResponseStatusExceptionResolver DefaultHandlerExceptionResolver MyHandlerExceptionResolver å‚è€ƒæ–‡æ¡£ å¸¸è§çš„Springå¼‚å¸¸åˆ†æžåŠå¤„ç† https://my.oschina.net/u/4007037/blog/3049044 Springä¸­çš„ç»Ÿä¸€å¼‚å¸¸å¤„ç† http://www.importnew.com/29962.html Springå…¨å±€å¼‚å¸¸å¤„ç†çš„ä¸‰ç§æ–¹å¼ https://www.jianshu.com/p/f968b8dcf95a Spring RestFul APIç»Ÿä¸€å¼‚å¸¸å¤„ç† http://daobin.wang/2017/05/spring-restful-api/]]></content>
      <categories>
        <category>Spring</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å•ç‚¹ç™»å½•å®žçŽ°â€”â€”åŸºäºŽOAuth2.0åè®®çš„æŽ¥å…¥æ–¹æ¡ˆ]]></title>
    <url>%2F2019%2F04%2F16%2F%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0%E2%80%94%E2%80%94%E5%9F%BA%E4%BA%8EOAuth2-0%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%8E%A5%E5%85%A5%E6%96%B9%E6%A1%88%2F</url>
    <content type="text"><![CDATA[å‚è€ƒ å•ç‚¹ç™»å½•å®žçŽ°â€”â€”åŸºäºŽOAuth2.0åè®®çš„æŽ¥å…¥æ–¹æ¡ˆ Spring Security Oauth2 å•ç‚¹ç™»å½•æ¡ˆä¾‹å®žçŽ°å’Œæ‰§è¡Œæµç¨‹å‰–æž å•ç‚¹ç™»å½•åŽŸç†ä¸Žç®€å•å®žçŽ° CASå®žçŽ°å•ç‚¹ç™»å½•SSOæ‰§è¡ŒåŽŸç†æŽ¢ç©¶]]></content>
      <categories>
        <category>å•ç‚¹ç™»å½•</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Hadoop MapReduceåŽŸç†æ¡ˆä¾‹åŠæ­å»º]]></title>
    <url>%2F2019%2F04%2F14%2FHadoop-MapReduce%E5%8E%9F%E7%90%86%E6%A1%88%E4%BE%8B%E5%8F%8A%E6%90%AD%E5%BB%BA%2F</url>
    <content type="text"><![CDATA[MapReduceè¯­ä¹‰ MapTask(å·¦è¾¹) a. blockå’Œåˆ‡ç‰‡ï¼šblockæ˜¯ç‰©ç†çš„å­˜å‚¨ï¼Œåç§»é‡å’Œä½ç½®ä¿¡æ¯ï¼›åˆ‡ç‰‡æ˜¯é€»è¾‘æ¦‚å¿µã€‚1:1 1:N N:1å…³ç³» b. åˆ‡ç‰‡å’Œmapï¼š1ï¼š1å…³ç³» ã€‚ æ•°æ®å¤šä¸ªåˆ‡ç‰‡ï¼Œå¤šä¸ªmapã€‚ä¸€ä¸ªmapæœ‰å¤šä¸ªkeyã€‚ c. åŒä¸€ä¸ªmapï¼Œæ ¹æ®partionçš„åˆ†åŒºä¿¡æ¯æŽ’åºï¼Œå†æ ¹æ®keyï¼Œè¿›è¡Œä¸€æ¬¡å¿«æŽ’ã€‚ ReduceTask(å³è¾¹) a. reduceæœ€ç»ˆæ•°é‡ç”±äººï¼Œé»˜è®¤ä¸€ä¸ªreduceã€‚mapå’Œreduceçš„å…³ç³»æ•°ç›®ä¸å›ºå®šã€‚ b. ä»Žå…¶ä»–mapæ‹¿åˆ°ç›¸åŒçš„keyï¼Œåšå½’å¹¶æŽ’åºã€‚1ä¸ªkeyä¸èƒ½åˆ†å‰²ï¼Œåªèƒ½åœ¨ä¸€ä¸ªåˆ†åŒºpartitionï¼ˆåŽŸè¯­ï¼‰ã€‚ shufferæ´—ç‰Œ a. ä¸€ä¸ªåˆ‡ç‰‡split =&gt; ä¸€ä¸ªmap=&gt; å†…å­˜æ ¹æ®åˆ†åŒºå’ŒKeyåšä¸€æ¬¡å¿«æŽ’ , (partition,key,value) çŽ¯å½¢ç¼“å†²åŒºï¼Œè¾¾åˆ°80%ï¼Œäº§ç”Ÿæº¢å†™ï¼Œå¿«æŽ’ b. reduceTaskæ˜¯åœ¨ä¸€ä¸ªåˆ†åŒºpartitionï¼Œä»Žä¸åŒçš„mapï¼Œæ‹¿åˆ°ç›¸åŒçš„keyã€‚å†…éƒ¨æœ‰åºï¼Œå¤–éƒ¨æ— åºï¼Œè¿›è¡Œå½’å¹¶æŽ’åºã€‚ å¦‚ä¸Šå›¾ a. splitè¿›è¡Œé€»è¾‘åˆ†å‰²ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªblockä¸ºä¸€ä¸ªsplit b. mapæ“ä½œï¼Œ(key,value,partition)ä¿¡æ¯ï¼ŒæŽ’åºå¯é€‰ c. shufflerï¼Œæ´—ç‰Œï¼Œä»Žä¸åŒçš„mapæ‹¿åˆ°ç›¸åŒçš„Keyï¼Œå½’å¹¶ d. reduceè®¡ç®— e. åˆå¹¶æ‹¿åˆ°æœ€åŽç»“æžœ YARN HAéƒ¨ç½² a. clientæäº¤ä»»åŠ¡ï¼ŒåŒ…å«è®¡ç®—æ¸…å• b. ResourceManageræ ¹æ®NodeManagerçš„çŠ¶æ€ï¼ŒæŒ‘é€‰ä¸€å°ï¼Œä½œä¸ºApp Master c. App Masterå‘ResourceMangerå‘èµ·èµ„æºè¯·æ±‚ï¼Œåˆ†é…Containerã€‚å½“Containerå¤±è´¥åŽï¼ŒResourceManageråˆä¼šé‡æ–°åˆ†é…ã€‚ HDFSèŒƒå›´ YARNèŒƒå›´ namenode ä¸»å¤‡ ZKFC datanode zookeeper JNN ResourceMangager NodeManager node01 * * * node02 * * * * * * node03 * * * * * node04 * * * * HDFS åˆ†å¸ƒå¼HAæ­å»ºå‚è€ƒä¸Šç¯‡æ–‡æ¡£ hdfs1.0 å°±æœ‰äº†ï¼Œè€ƒè™‘å…¼å®¹ï¼Œå¢žåŠ zkfcä¿è¯HA ã€‚yarnæ˜¯åœ¨2.0å¼€å‘çš„ï¼Œresourcemangerä¸ç”¨zkfc nodeManageer å’Œ dataNode 1æ¯”1å…³ç³» mapred-site.xml 1234&lt;property&gt; &lt;name&gt;mapreduce.framework.name&lt;/name&gt; &lt;value&gt;yarn&lt;/value&gt; &lt;/property&gt; æ ‡è¯†mapreduceçš„æ¡†æž¶ä¸ºyarn yarn-site.xml 12345678910111213141516171819202122232425262728 &lt;property&gt; &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt; &lt;value&gt;mapreduce_shuffle&lt;/value&gt; &lt;/property&gt;&lt;property&gt; &lt;name&gt;yarn.resourcemanager.ha.enabled&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.cluster-id&lt;/name&gt; &lt;value&gt;cluster1&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.ha.rm-ids&lt;/name&gt; &lt;value&gt;rm1,rm2&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname.rm1&lt;/name&gt; &lt;value&gt;node03&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.hostname.rm2&lt;/name&gt; &lt;value&gt;node04&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;yarn.resourcemanager.zk-address&lt;/name&gt; &lt;value&gt;node02:2181,node03:2181,node04:2181&lt;/value&gt; &lt;/property&gt; a. mapreduce_shuffleæ ‡è¯†ï¼Œä»Žå¤šä¸ªmapå–å‡ºç›¸åŒçš„keyï¼Œshuffleè¿‡ç¨‹ b.å¼€å¯ha c. yarnçš„resourcemanagerçš„é€»è¾‘å’Œç‰©ç†å…³ç³» d. yarnçš„resourcemanagerçš„zké…ç½® åˆ†åˆ«å¤åˆ¶åˆ°node02 node03 node04 1scp -r mapred-site.xml yarn-site.xml node02:/`pwd` node01ä¸Šå¯åŠ¨NodeManagerï¼Œnode02 node03 node04 1start-yarn.sh node03 node04æ‰‹å·¥å¯ç”¨resourcemanager 1yarn-daemon.sh start resourcemanager http://node03:8088/cluster/cluster æŸ¥çœ‹yarn resourcemanagerçŠ¶æ€ æ‰§è¡Œexampleå•è¯è®¡æ•° 12345cd /opt/sxt/hadoop-2.6.5/share/hadoop/mapreduce#æ‰§è¡Œä»»åŠ¡hadoop jar hadoop-mapreduce-examples-2.6.5.jar wordcount /user/root/test.txt /data/output/#ä»Žhdfsåˆ°æœ¬åœ°hdfs dfs -get /data/output/part-r-00000 ~/result_count.txt å¼€å‘MapReduceï¼Œå•è¯è®¡æ•°hadoop-2.6.5/share/hadoop ä¸­çš„jaråŒ…ï¼Œæ ¹ç›®å½•åŠlibï¼Œå¤åˆ¶åˆ°hadoop-user-libä¸­ã€‚é…ç½®æˆå…¨å±€çš„user-libaray ï¼Œæ·»åŠ hadoop-2.6.5/share/hadoop/mapreduce/sourcesç­‰ä½œä¸ºsourceæºç ã€‚ å¯åŠ¨Main 12345678910111213141516171819202122232425262728293031323334353637public class MyWC &#123; public static void main(String[] args) throws Exception &#123; Configuration conf = new Configuration(true); Job job =Job.getInstance(conf); job.setJarByClass(MyWC.class); job.setJobName("sxt-wc"); Path path = new Path("/user/root/test.txt"); FileInputFormat.addInputPath(job,path); Path output = new Path("/data/wc/output"); //å­˜åœ¨åˆ é™¤æ–‡ä»¶ if (output.getFileSystem(conf).exists(output))&#123; output.getFileSystem(conf).delete(output,true); &#125; FileOutputFormat.setOutputPath(job,output); job.setMapperClass(MyMapper.class); job.setReducerClass(MyReducer.class); //mapçš„kev vauleç±»åž‹ job.setMapOutputKeyClass(Text.class); job.setMapOutputValueClass(IntWritable.class); //outputçš„key valueç±»åž‹ job.setOutputKeyClass(Text.class); job.setOutputValueClass(IntWritable.class); // Submit the job, then poll for progress until the job is complete job.waitForCompletion(true); &#125;&#125; Mapper 123456789101112131415public class MyMapper extends Mapper&lt;Object, Text, Text, IntWritable&gt;&#123; private final static IntWritable one = new IntWritable(1); private Text word = new Text(); //hello sxt 1 public void map(Object key, Text value, Context context) throws IOException, InterruptedException &#123; StringTokenizer itr = new StringTokenizer(value.toString()); while (itr.hasMoreTokens()) &#123; word.set(itr.nextToken()); context.write(word, one); &#125; &#125;&#125; Reducer 12345678910111213public class MyReducer extends Reducer&lt;Text,IntWritable, Text,IntWritable&gt; &#123; private IntWritable result = new IntWritable(); public void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException &#123; int sum = 0; for (IntWritable val : values) &#123; sum += val.get(); &#125; result.set(sum); context.write(key, result); &#125;&#125; Build Artifact jaråŒ…ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨node01 1hadoop jar wordcount.jar com.sxt.hadoop.mapreduce.MyWC http://node04:8088 æŸ¥çœ‹jobæ‰§è¡Œ MapReduce Jobè¿è¡Œæºç è§£è¯»å®¢æˆ·ç«¯æºç è§£è¯» å…¥å£ job.waitForCompletion(true); 1submit(); -&gt; submitter.submitJobInternal(Job.this, cluster); org.apache.hadoop.mapreduce.JobSubmitter#submitJobInternal æ–¹æ³• è®¡ç®—åˆ‡ç‰‡å’Œmapï¼ŒJobSubmitter197è¡Œ 123int maps = writeSplits(job, submitJobDir);maps = writeNewSplits(job, jobSubmitDir); ReflectionUtils.newInstatnce é»˜è®¤ TextInputFormat.class ç»§æ‰¿ FileInputFormat input.getSplits(jb) FileInputFormat#getSplits å¾—åˆ° blocklocations 1blkLocations = fs.getFileBlockLocations(file, 0, length); è®¡ç®—åˆ‡ç‰‡çš„å¤§å° è‹¥è¦åˆ‡ç‰‡æ¯”å—å¤§ï¼Œé…ç½®minSize æ¯”å—å¤§ï¼Œå¾—å‡ºçš„åˆ‡ç‰‡å¤§å°å¤§äºŽå— 123long splitSize = computeSplitSize(blockSize, minSize, maxSize);Math.max(minSize, Math.min(maxSize, blockSize)); 123456789101112131415161718long blockSize = file.getBlockSize();long splitSize = computeSplitSize(blockSize, minSize, maxSize);long bytesRemaining = length;while (((double) bytesRemaining)/splitSize &gt; SPLIT_SLOP) &#123; int blkIndex = getBlockIndex(blkLocations, length-bytesRemaining); splits.add(makeSplit(path, length-bytesRemaining, splitSize, blkLocations[blkIndex].getHosts(), blkLocations[blkIndex].getCachedHosts())); bytesRemaining -= splitSize;&#125;if (bytesRemaining != 0) &#123; int blkIndex = getBlockIndex(blkLocations, length-bytesRemaining); splits.add(makeSplit(path, length-bytesRemaining, bytesRemaining, blkLocations[blkIndex].getHosts(), blkLocations[blkIndex].getCachedHosts()));&#125; bytesRemainingå‰©ä½™çš„å­—èŠ‚æ•° length-bytesRemaining å¾—å‡ºçš„å°±æ˜¯æ¯ä¸ªåˆ‡ç‰‡çš„åç§»é‡ getBlockIndex ç”¨åˆ‡ç‰‡çš„åç§»é‡ï¼Œåœ¨å“ªä¸ªå—çš„åç§»é‡å’Œç»ˆæ­¢åç§»é‡ä¹‹é—´ï¼Œå¾—åˆ°ç¬¬å‡ ä¸ªå— 1234567for (int i = 0 ; i &lt; blkLocations.length; i++) &#123; // is the offset inside this block? if ((blkLocations[i].getOffset() &lt;= offset) &amp;&amp; (offset &lt; blkLocations[i].getOffset() + blkLocations[i].getLength()))&#123; return i; &#125;&#125; makeSplit å®Œæˆåˆ‡ç‰‡ï¼Œä¼ é€’pathï¼Œåˆ‡ç‰‡çš„åç§»é‡ï¼Œåˆ‡ç‰‡çš„å¤§å°ï¼Œblockçš„locationsçš„ä¸»æœºä¿¡æ¯ 1234protected FileSplit makeSplit(Path file, long start, long length, String[] hosts, String[] inMemoryHosts) &#123; return new FileSplit(file, start, length, hosts, inMemoryHosts);&#125; waitForCompletion submit() -&gt; submitter.submitJob -&gt; 197 line -&gt; writeSplites -&gt; writeNewSplits -&gt; ReflectionUtils.newInstatnce é»˜è®¤ TextInputFormat.class input.getSplits(jb) -&gt; FileInputFormatç»§æ‰¿ -&gt; minSizeæœ€å°1 maxSize Longæœ€å¤§å€¼ -ã€‹ file.getLen blkLocatons -&gt; fs.getFileSystem -&gt; fs.getFileBlockLocations(file ,0 ,length) æ‹¿åˆ°æ–‡ä»¶çš„blockæ¸…å• å¯åˆ‡ç‰‡ -ã€‹ splitSize = computeSpliteSize() é»˜è®¤åˆ‡ç‰‡å¤§å°ï¼ŒminSize æ¯”å—å¤§å°å¤§ï¼Œå¾—å‡ºçš„åˆ‡ç‰‡å¤§å°å¤§äºŽå— =ã€‹ FileInputFormt.setMinInputSplitSize(job,128) getBlockIndex å¾—åˆ°å±žäºŽç¬¬å‡ ä¸ªå— lenth-byteRemainging åˆ‡ç‰‡çš„åç§»é‡ ï¼Œ åˆ‡ç‰‡çš„åç§»é‡ åœ¨å—çš„åç§»é‡ å’Œ å—çš„ç»“æŸåç§»é‡ä¹‹é—´ï¼Œå¾—åˆ°blockçš„index æ–‡ä»¶ åˆ‡ç‰‡åç§»é‡ å¤§å° getHostsä¸»æœº Thread.sleep -&gt; .tmp/haddp-yarn/staging/root.stagging/_003/ -&gt; jaråŒ… job.split ; job.xml è¿è¡Œé…ç½®æ¸…å• Mapper class Reduce.class TextFormat.minSize Map Taskè¿‡ç¨‹ Mapper.java 12345678910public void run(Context context) throws IOException, InterruptedException &#123; setup(context); try &#123; while (context.nextKeyValue()) &#123; map(context.getCurrentKey(), context.getCurrentValue(), context); &#125; &#125; finally &#123; cleanup(context); &#125;&#125; MapTask.java 12345678910111213141516171819202122232425262728293031323334353637public void run(final JobConf job, final TaskUmbilicalProtocol umbilical) throws IOException, ClassNotFoundException, InterruptedException &#123; this.umbilical = umbilical; if (isMapTask()) &#123; if (conf.getNumReduceTasks() == 0) &#123; mapPhase = getProgress().addPhase("map", 1.0f); &#125; else &#123; mapPhase = getProgress().addPhase("map", 0.667f); sortPhase = getProgress().addPhase("sort", 0.333f); &#125; &#125; TaskReporter reporter = startReporter(umbilical); boolean useNewApi = job.getUseNewMapper(); initialize(job, getJobID(), reporter, useNewApi); if (jobCleanup) &#123; runJobCleanupTask(umbilical, reporter); return; &#125; if (jobSetup) &#123; runJobSetupTask(umbilical, reporter); return; &#125; if (taskCleanup) &#123; runTaskCleanupTask(umbilical, reporter); return; &#125; if (useNewApi) &#123; runNewMapper(job, splitMetaInfo, umbilical, reporter); &#125; else &#123; runOldMapper(job, splitMetaInfo, umbilical, reporter); &#125; done(umbilical, reporter);&#125; a. conf.getNumReduceTasks() == 0 æ²¡æœ‰reduceçŽ¯èŠ‚ï¼Œmapæ—¶é—´å æ¯”100% æ¯”å¦‚æ•°æ®è¿‡æ»¤ï¼Œä¸ç»è¿‡reducer b. å¦åˆ™çš„è¯ï¼Œ ç»è¿‡ mapã€ æŽ’åº 12mapPhase = getProgress().addPhase("map", 0.667f);sortPhase = getProgress().addPhase("sort", 0.333f); c. æœ€åŽrunNewMapper(job, splitMetaInfo, umbilical, reporter); runNewMapper 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667void runNewMapper(final JobConf job, final TaskSplitIndex splitIndex, final TaskUmbilicalProtocol umbilical, TaskReporter reporter ) throws IOException, ClassNotFoundException, InterruptedException &#123; // make a task context so we can get the classes org.apache.hadoop.mapreduce.TaskAttemptContext taskContext = new org.apache.hadoop.mapreduce.task.TaskAttemptContextImpl(job, getTaskID(), reporter); // make a mapper org.apache.hadoop.mapreduce.Mapper&lt;INKEY,INVALUE,OUTKEY,OUTVALUE&gt; mapper = (org.apache.hadoop.mapreduce.Mapper&lt;INKEY,INVALUE,OUTKEY,OUTVALUE&gt;) ReflectionUtils.newInstance(taskContext.getMapperClass(), job); // make the input format org.apache.hadoop.mapreduce.InputFormat&lt;INKEY,INVALUE&gt; inputFormat = (org.apache.hadoop.mapreduce.InputFormat&lt;INKEY,INVALUE&gt;) ReflectionUtils.newInstance(taskContext.getInputFormatClass(), job); // rebuild the input split org.apache.hadoop.mapreduce.InputSplit split = null; split = getSplitDetails(new Path(splitIndex.getSplitLocation()), splitIndex.getStartOffset()); LOG.info("Processing split: " + split); org.apache.hadoop.mapreduce.RecordReader&lt;INKEY,INVALUE&gt; input = new NewTrackingRecordReader&lt;INKEY,INVALUE&gt; (split, inputFormat, reporter, taskContext); job.setBoolean(JobContext.SKIP_RECORDS, isSkipping()); org.apache.hadoop.mapreduce.RecordWriter output = null; // get an output object if (job.getNumReduceTasks() == 0) &#123; output = new NewDirectOutputCollector(taskContext, job, umbilical, reporter); &#125; else &#123; output = new NewOutputCollector(taskContext, job, umbilical, reporter); &#125; org.apache.hadoop.mapreduce.MapContext&lt;INKEY, INVALUE, OUTKEY, OUTVALUE&gt; mapContext = new MapContextImpl&lt;INKEY, INVALUE, OUTKEY, OUTVALUE&gt;(job, getTaskID(), input, output, committer, reporter, split); org.apache.hadoop.mapreduce.Mapper&lt;INKEY,INVALUE,OUTKEY,OUTVALUE&gt;.Context mapperContext = new WrappedMapper&lt;INKEY, INVALUE, OUTKEY, OUTVALUE&gt;().getMapContext( mapContext); try &#123; input.initialize(split, mapperContext); mapper.run(mapperContext); mapPhase.complete(); setPhase(TaskStatus.Phase.SORT); statusUpdate(umbilical); input.close(); input = null; output.close(mapperContext); output = null; &#125; finally &#123; closeQuietly(input); closeQuietly(output, mapperContext); &#125;&#125; åå°„åˆå§‹åŒ–Mapperï¼Œä¸šåŠ¡å®žçŽ°çš„Mapperã€‚JobContextImplæŸ¥çœ‹é»˜è®¤å®žçŽ°ã€‚ 123org.apache.hadoop.mapreduce.Mapper&lt;INKEY,INVALUE,OUTKEY,OUTVALUE&gt; mapper = (org.apache.hadoop.mapreduce.Mapper&lt;INKEY,INVALUE,OUTKEY,OUTVALUE&gt;) ReflectionUtils.newInstance(taskContext.getMapperClass(), job); åå°„å·¥å…· Mapper å®žä¾‹åŒ– InputFormatå®žä¾‹åŒ–ï¼ŒJobContextImpl é»˜è®¤TextINputFormat 12345public Class&lt;? extends InputFormat&lt;?,?&gt;&gt; getInputFormatClass() throws ClassNotFoundException &#123; return (Class&lt;? extends InputFormat&lt;?,?&gt;&gt;) conf.getClass(INPUT_FORMAT_CLASS_ATTR, TextInputFormat.class);&#125; å®žä¾‹åŒ–NewTrakingRecordReader 123org.apache.hadoop.mapreduce.RecordReader&lt;INKEY,INVALUE&gt; input = new NewTrackingRecordReader&lt;INKEY,INVALUE&gt; (split, inputFormat, reporter, taskContext); MapTask.NewTrackingRecordReaderline 512 åˆ›å»º RecordReader 1this.real = inputFormat.createRecordReader(split, taskContext); TextInputFormatå®žçŽ° ï¼Œ å‚æ•°ä¸ºå­—èŠ‚æ•°ç»„ï¼Œè¿”å›ž LineRecordReader 12345678910public RecordReader&lt;LongWritable, Text&gt; createRecordReader(InputSplit split, TaskAttemptContext context) &#123; String delimiter = context.getConfiguration().get( "textinputformat.record.delimiter"); byte[] recordDelimiterBytes = null; if (null != delimiter) recordDelimiterBytes = delimiter.getBytes(Charsets.UTF_8); return new LineRecordReader(recordDelimiterBytes);&#125; MapContextImplçš„å®žçŽ°éƒ½æ˜¯å§”æ‰˜ç»™LIneRecordReder reader.getCurrentKey reader.nestKeyValue() LineRecordReader1234567891011121314151617181920212223242526public LineRecordReader(Configuration job, FileSplit split, byte[] recordDelimiter) throws IOException &#123; this.maxLineLength = job.getInt(org.apache.hadoop.mapreduce.lib.input. LineRecordReader.MAX_LINE_LENGTH, Integer.MAX_VALUE); start = split.getStart(); end = start + split.getLength(); final Path file = split.getPath(); compressionCodecs = new CompressionCodecFactory(job); codec = compressionCodecs.getCodec(file); final FileSystem fs = file.getFileSystem(job); fileIn = fs.open(file); if (isCompressedInput()) &#123; ... &#125; else &#123; fileIn.seek(start); in = new UncompressedSplitLineReader( fileIn, job, recordDelimiter, split.getLength()); filePosition = fileIn; &#125; if (start != 0) &#123; start += in.readLine(new Text(), 0, maxBytesToConsume(start)); &#125; this.pos = start;&#125; fileIn.seek(start)ç›´æŽ¥ä»Žåˆ‡ç‰‡çš„åç§»é‡å¼€å§‹è¯» start !=0 ç¬¬äºŒä¸ªåˆ‡ç‰‡å¼€å§‹éƒ½è¦å¤„ç†ï¼Œ in.readLine(new Text(),0,) è¯»å‡ºç¬¬ä¸€è¡Œï¼Œæ¢è¡Œç¬¦ï¼Œä¸ç”¨ï¼Œç®—å‡ºå­—èŠ‚æ•° start = start + æ•°å€¼ ï¼Œè¿™æ ·å¤„ç†ä¸€è¡Œæ–‡æœ¬ï¼Œè¢«æ‹†åˆ†åˆ°å¤šä¸ªblockçš„æƒ…å†µã€‚ mappper -&gt; map é‡å†™ -&gt; è¾“å…¥ è¾“å‡º context.write 340è¡Œ runNewMapper try finally åˆå§‹åŒ– mapper.run æŽ’åº é‡Šæ”¾ å…³é—­ åå°„å·¥å…· Mapper å®žä¾‹åŒ– InputFormatå®žä¾‹åŒ–ï¼Œé»˜è®¤TextINputFormat hadoopä¸­spilte sparkä¸­æ˜¯partition NewTrakingRecordReader 512è¡Œ inputFormat.createRecordReader -&gt; new LIneRecordReder é‡è¦ MapContextImplçš„å®žçŽ° éƒ½æ˜¯LIneRecordReder reader.getCurrentKey reader.nestKeyValue() LIneRecordReader initlize hostä¿¡æ¯å·²ç»åœ¨åˆ†é…containeråšäº†ï¼ŒfileIn.seek(start)ç›´æŽ¥å†²åˆ‡ç‰‡çš„åç§»é‡å¼€å§‹è¯» start !=0 ç¬¬äºŒä¸ªåˆ‡ç‰‡å¼€å§‹éƒ½è¦å¤„ç†ï¼Œ in.readLine(new Text(),0,) è¯»å‡ºç¬¬ä¸€è¡Œï¼Œæ¢è¡Œç¬¦ï¼Œä¸é€‚ç”¨ï¼Œç®—å‡ºå­—èŠ‚æ•°ï¼Œstart = start + æ•°å€¼ æ¯ä¸ªåˆ‡ç‰‡éƒ½ä¼šå¤šè¯»1è¡Œï¼ŒLineRecordReader ï¼Œ æ•°æ®ç§»åŠ¨éƒ½æ˜¯å°é‡çš„ è®¡ç®—éƒ½æ˜¯å’Œfsæ‹¿æ–‡ä»¶ï¼Œä¸æ˜¯blockå— this.pos = start åˆ‡ç‰‡çš„ç¬¬äºŒè¡Œçš„åç§»é‡ LIneRecordReader nextKeyValue key valueèµ‹å€¼ output reduceræ•°æ®ä¸º0 ç›´æŽ¥é€Ÿå‡º NewOUtputCollerctor reduceæ•°é‡å°±æ˜¯partitionæ•° åªæœ‰1ä¸ªåˆ†åŒºï¼ŒPartioneråˆ†åŒºå™¨ï¼Œ0 å¤§äºŽ1çš„æ—¶å€™ï¼Œmorning hashPartitioner key.hashCOde &amp; Integer.max % reducetaskNum è¾“å‡º k ,v ï¼Œå˜ä¸º k,v,p createSorting MapoutBuffer åˆå§‹åŒ– sortmb å†…å­˜ç¼“å†²åŒº sorter å¿«æŽ’ comparotor é»˜è®¤ è®¾ç½®æŽ’åºå™¨ï¼Œæ²¡æœ‰å–keyçš„Textçš„é»˜è®¤ MapTask combiner: è¢«ç§»æ¤åˆ°mapé˜¶æ®µçš„reducerTask å°reducer mapè¾“å‡ºä¸€æ¬¡ï¼Œå½’å¹¶ä¸€æ¬¡ MapoutBuffer 80%æº¢å‡ºå†™ï¼Œä¸­é—´20%ç»§ç»­ï¼Œä¸ä¼šé˜»å¡ž mapçš„è¾“å‡º åˆ° çŽ¯å½¢ç¼“å†²å™¨ keyå’Œç´¢å¼•éƒ½æ”¾è¿›åŽ»åŽ» èµ¤é“ æ¯”è¾ƒï¼Œç´¢å¼•æ¢ä½ç½®å³å¯ MapTask&amp;MapOutBuffer spillyixie æ¬¡æ•° å°äºŽ SplliThread run Reducer è¿‡ç¨‹ ReducerTask ReducerTask runæ–¹æ³• line 376 è§¦å‘shufferè¿‡ç¨‹ æ‹‰å–æ•°æ®ã€‚RawKeyValueIterator rIter èŽ·å–çœŸè¿­ä»£å™¨ï¼Œä¼ å…¥åˆ°reducerContextä¸­ã€‚ 1234567891011121314 org.apache.hadoop.mapreduce.Reducer.Context reducerContext = createReduceContext(reducer, job, getTaskID(), rIter, reduceInputKeyCounter, reduceInputValueCounter, trackedRW, committer, reporter, comparator, keyClass, valueClass);try &#123; reducer.run(reducerContext); &#125; finally &#123; trackedRW.close(reducerContext); &#125; 627 reduce.run åˆ›å»ºä¸Šä¸‹æ–‡ Reducer 1234567891011121314public void run(Context context) throws IOException, InterruptedException &#123; setup(context); try &#123; while (context.nextKey()) &#123; reduce(context.getCurrentKey(), context.getValues(), context); Iterator&lt;VALUEIN&gt; iter = context.getValues().iterator(); if(iter instanceof ReduceContext.ValueIterator) &#123; ((ReduceContext.ValueIterator&lt;VALUEIN&gt;)iter).resetBackupStore(); &#125; &#125; &#125; finally &#123; cleanup(context); &#125;&#125; reduceæ–¹æ³•ç”¨æˆ·é‡å†™ ReduceContextImpl nextKeyValue() ä»ŽçœŸè¿­ä»£å™¨å–å€¼ï¼Œline138 1DataInputBuffer nextKey = input.getKey(); line 158 nextKeyIsSameæ ¹æ®åˆ†ç»„æ¯”è¾ƒå™¨ï¼Œæ¯”è¾ƒä¸‹ä¸€æ¬¡çš„keyæ˜¯å¦ç›¸åŒã€‚ 123456789101112hasMore = input.next();if (hasMore) &#123; nextKey = input.getKey(); nextKeyIsSame = comparator.compare(currentRawKey.getBytes(), 0, currentRawKey.getLength(), nextKey.getData(), nextKey.getPosition(), nextKey.getLength() - nextKey.getPosition() ) == 0;&#125; else &#123; nextKeyIsSame = false;&#125; å‡è¿­ä»£å™¨ï¼ŒgetValuesæ–¹æ³•è¿”å›ž 1private ValueIterable iterable = new ValueIterable(); docæ–‡æ¡£ mapä¸­æ˜¯æ— åºåˆ°æœ‰åº reduceréƒ½æ˜¯å½’å¹¶æŽ’åº ReduceTask run line 376 è§¦å‘shufferè¿‡ç¨‹ æ‹‰å–æ•°æ®ï¼Œæ²¡æœ‰sparkä¼˜ç¾Ž,ï¼ŒçœŸè¿­ä»£å™¨rIter 386 map task çŽ¯å½¢ç¼“å†²åŒº çš„ ã€‚ åˆ†åŒºæ¯”è¾ƒå™¨ map task ç”¨æˆ·è®¾ç½®ï¼Œæ²¡æœ‰åˆ™å–keyè‡ªèº«çš„æŽ’åºå™¨ reduce task ç”¨æˆ·è®¾ç½®ï¼Œåˆ†ç»„æ¯”è¾ƒå™¨-ã€‹ æŽ’åºæ¯”è¾ƒå™¨ï¼Œæ²¡æœ‰å–valueè‡ªèº«çš„æŽ’åº 627 reduce.run åˆ›å»ºä¸Šä¸‹æ–‡ Reducer.class run nexyKye nextKey æ”¾ç©ºè¿‡ ReduceContestImpl.class nextKeyValue() ä»ŽçœŸè¿­ä»£å™¨å–å€¼ hasMore nextKeyIsSmae åˆ†ç»„æ¯”è¾ƒå™¨ å½“å‰å’Œå–ä¸‹ä¸€æ¬¡çš„æ¯”è¾ƒ getValues iterable ValueIterrable å‡ã€‚è¿­ä»£å™¨ 239è¡Œ æ¡ˆä¾‹ æ¯ä¸ªæœˆæœ€é«˜æ°”æ¸©çš„2å¤© MyMain ä¸»å…¥å£ TMapper TSorterComparator æŽ’åºæ¯”è¾ƒå™¨ã€‚MapTaské˜¶æ®µç”¨ï¼Œ80%çŽ¯å½¢ç¼“å†²åŒºæº¢å†™ï¼Œå¿«æŽ’ã€‚ TPartition åˆ†åŒºæ¯”è¾ƒå™¨ï¼Œå†³å®škeyåˆ°å“ªä¸ªåˆ†åŒºã€‚åˆ†åŒºæ•°å³reducerTaskæ•°ã€‚è¦ä¹ˆé‡å†™keyçš„hash equals ,å¦åˆ™é‡å†™åˆ†åŒºå™¨ã€‚ TGroupComparator åˆ†ç»„æ¯”è¾ƒå™¨ï¼ŒReducerTaské˜¶æ®µç”¨ã€‚å†³å®škeyæ˜¯ä¸æ˜¯ä¸€ç»„ã€‚ æ¡ˆä¾‹ è¯é¢‘æœç´¢ TF*IDFå¾®åšè´¦å·æ€»æ•°ã€ä¸€ä¸ªè¯æœ‰å¤šå°‘ä¸ªå¾®åšåŒ…å« addCacheFile æ¯ä¸ªmapå‘é€è¿‡åŽ»ï¼Œä½œä¸ºæœ¬åœ°æ–‡ä»¶ TF * idF LastJob LastMapper setup æ•°æ®é›†ä¸æ˜¯å¾ˆå¤§ï¼Œå¾ˆå…¶ä»–mapéƒ½è¦å…³è” cmap : count å¾®åšæ€»æ•° dfï¼š ä¸€ä¸ªè¯æœ‰å¤šå°‘ä¸ªå¾®åšåŒ…å« æ¡ˆä¾‹ ç”µå•†å¹¿å‘ŠæŽ¨èUserCF ç”¨æˆ·çš„ç›¸ä¼¼æ€§ï¼ŒååŒè¿‡æ»¤ ItemCF åŸºäºŽç‰©å“çš„ååŒè¿‡æ»¤ MapReducer ç”¨æˆ·è¯„åˆ†å‘é‡ u1 : i1 i2 i3 u2: i2 i3 setp1 NullWrite.get() ä¸å†™ Run as java Application setp2 ç”¨æˆ·è¯„åˆ†å‘é‡ setp3 åŒçŽ°çŸ©é˜µ å¯¹ç§°çŸ©é˜µ setp4 setup çŸ©é˜µ * å‘é‡ reduceç›¸åŒçš„keyä¸ºä¸€ç»„ï¼Œç‰©å“ä½œä¸ºKey]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[centos7è™šæ‹Ÿæœºé…ç½®åŠç½‘ç»œé…ç½®]]></title>
    <url>%2F2019%2F03%2F31%2Fcentos7%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8F%8A%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[è™šæ‹Ÿæœºé…ç½® æ·»åŠ è™šæ‹Ÿæœºï¼Œé€‰æ‹©centos7é•œåƒ ç§»é™¤åŽŸæœ‰çš„ç½‘ç»œé€‚é…å™¨ï¼Œæ·»åŠ ç½‘ç»œé€‚é…å™¨ï¼Œé€‰æ‹©æ¡¥æŽ¥æ–¹å¼ é™æ€ipé…ç½®1.ip addræŸ¥çœ‹ç½‘å¡é…ç½® 2.cd /etc/sysconfig/network-scripts ä¿®æ”¹ifcfg-ens33æ–‡ä»¶ï¼Œæ³¨æ„NAMEå’ŒDEVICEçš„åç§°åŒæ­¥ã€‚ 12345678910111213141516171819202122232425TYPE="Ethernet"#BOOTPROTO="dhcp"DEFROUTE="yes"PEERDNS="yes"PEERROUTES="yes"IPV4_FAILURE_FATAL="no"IPV6INIT="yes"IPV6_AUTOCONF="yes"IPV6_DEFROUTE="yes"IPV6_PEERDNS="yes"IPV6_PEERROUTES="yes"IPV6_FAILURE_FATAL="no"NAME="ens33"UUID="157c8fb5-23b3-414c-8519-25bef9b20a54"DEVICE="ens33"#ONBOOT="yes"#static assignmentNM_CONTROLLED=no #è¡¨ç¤ºè¯¥æŽ¥å£å°†é€šè¿‡è¯¥é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®ï¼Œè€Œä¸æ˜¯é€šè¿‡ç½‘ç»œç®¡ç†å™¨è¿›è¡Œç®¡ç†ONBOOT=yes #å¼€æœºå¯åŠ¨BOOTPROTO=static #é™æ€IPIPADDR=192.168.0.151 #æœ¬æœºåœ°å€NETMASK=255.255.255.0 #å­ç½‘æŽ©ç GATEWAY=192.168.0.255 #é»˜è®¤ç½‘å…³ 3.é…ç½®/etc/sysconfig/network 123NETWORKING=yesHOSTNAME=node01GATEWAY=192.168.0.255 4.é‡å¯æœåŠ¡ service network restart]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[flumeé›†ç¾¤å®‰è£…éƒ¨ç½²æ–‡æ¡£]]></title>
    <url>%2F2019%2F03%2F28%2Fflume%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3%2F</url>
    <content type="text"><![CDATA[å®‰è£…å•èŠ‚ç‚¹å‚è€ƒæ–‡æ¡£ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#a-simple-example ä¸Šä¼ è§£åŽ‹123scp apache-flume-1.6.0-bin.tar.gz root@node02:/roottar -zxvf apache-flume-1.6.0-bin.tar.gzmv apache-flume-1.6.0-bin/ /usr/install/ é…ç½®çŽ¯å¢ƒå˜é‡12vi /etc/profilesource /etc/profile 12export FLUME_HOME=/usr/install/apache-flume-1.6.0-binexport PATH=$PATH:$ZOOKEEPER_HOME/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$HIVE_HOME/bin:$HBASE_HOME/bin:$FLUME_HOME/bin ä¿®æ”¹conf/flume-env.sh æ–‡ä»¶ä¸­çš„JDKç›®å½•12cp flume-env.sh.template flume-env.shvi flume-env.sh 1export JAVA_HOME=/usr/install/jdk/jdk1.8.0_171 éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ1flume-ng version ä¿®æ”¹é…ç½®12cd conf/vi simple.conf 12345678910111213141516171819202122# Name the components on this agenta1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = netcata1.sources.r1.bind = node02a1.sources.r1.port = 44444# Describe the sinka1.sinks.k1.type = logger# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨flume1flume-ng agent -n a1 -c conf -f simple.conf -Dflume.root.logger=INFO,console å‘é€æ•°æ®1telnet node02 44444 ä¸¤ä¸ªflumeåšé›†ç¾¤å‚è€ƒæ–‡æ¡£ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#setting-multi-agent-flow å³ä¾§èŠ‚ç‚¹(node03)å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-source 1vi double-flume.conf 123456789101112131415161718192021# Name the components on this agenta1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = avroa1.sources.r1.bind = node03a1.sources.r1.port = 60000# Describe the sinka1.sinks.k1.type = logger# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f double-flume.conf -Dflume.root.logger=INFO,console å·¦ä¾§èŠ‚ç‚¹(node02)å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#avro-sink 1scp -r apache-flume-1.6.0-bin/ root@node03:/usr/install 1vi double-flume.conf 1234567891011121314151617181920212223a1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = netcata1.sources.r1.bind = node02a1.sources.r1.port = 44444# Describe the sinka1.sinks.k1.type = avroa1.sinks.k1.hostname = node03a1.sinks.k1.port = 60000# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f double-flume.conf -Dflume.root.logger=INFO,console å‘é€æ•°æ®1telnet node02 44444 Exec Sourceæ–¹å¼ï¼Œç›‘æŽ§æ–‡ä»¶tailå‘½ä»¤å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#exec-source é…ç½®1vi exec.conf 12345678910111213141516171819a1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = execa1.sources.r1.command = tail -F /root/test.txt# Describe the sinka1.sinks.k1.type = logger# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f exec.conf -Dflume.root.logger=INFO,console æ·»åŠ æ•°æ®å¾ªçŽ¯æ·»åŠ æ•°æ® 1for i in &#123;1..50&#125;; do echo "$i hi flume" &gt;&gt; /root/test.txt ; sleep 0.1; done Spooling Directory Sourceç›‘æŽ§ç›®å½•å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#spooling-directory-source é…ç½®1vi spool.conf 1234567891011121314151617181920a1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = spooldira1.sources.r1.spoolDir = /root/logsa1.sources.r1.fileHeader = true# Describe the sinka1.sinks.k1.type = logger# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f spool.conf -Dflume.root.logger=INFO,console æ‹·è´æ–‡ä»¶æ¼”ç¤ºmkdir logs mv aa logs/ flumeå’Œkafkaä¸¤è€…ç»å¸¸é…å¯¹ä½¿ç”¨ï¼Œè°åœ¨å‰åŽéƒ½å¯ä»¥ hdfs sinkæ–¹å¼å‚è€ƒ http://flume.apache.org/releases/content/1.9.0/FlumeUserGuide.html#hdfs-sink é…ç½®1vi hdfs-sink.conf 12345678910111213141516171819202122232425262728293031323334353637383940414243a1.sources = r1a1.sinks = k1a1.channels = c1# Describe/configure the sourcea1.sources.r1.type = spooldira1.sources.r1.spoolDir = /root/logsa1.sources.r1.fileHeader = true# Describe the sink æ–‡ä»¶ç›®å½•æ ¼å¼a1.sinks.k1.type=hdfsa1.sinks.k1.hdfs.path=hdfs://mycluster/flume/%Y-%m-%d/%H%M##æ¯éš”60sæˆ–è€…æ–‡ä»¶å¤§å°è¶…è¿‡10Mçš„æ—¶å€™äº§ç”Ÿæ–°æ–‡ä»¶ï¼Œrollå¯¹æ–‡ä»¶è®¾ç½®# hdfsæœ‰å¤šå°‘æ¡æ¶ˆæ¯æ—¶æ–°å»ºæ–‡ä»¶ï¼Œ0ä¸åŸºäºŽæ¶ˆæ¯ä¸ªæ•°a1.sinks.k1.hdfs.rollCount=0# hdfsåˆ›å»ºå¤šé•¿æ—¶é—´æ–°å»ºæ–‡ä»¶ï¼Œ0ä¸åŸºäºŽæ—¶é—´a1.sinks.k1.hdfs.rollInterval=60# hdfså¤šå¤§æ—¶æ–°å»ºæ–‡ä»¶ï¼Œ0ä¸åŸºäºŽæ–‡ä»¶å¤§å°a1.sinks.k1.hdfs.rollSize=10240# å½“ç›®å‰è¢«æ‰“å¼€çš„ä¸´æ—¶æ–‡ä»¶åœ¨è¯¥å‚æ•°æŒ‡å®šçš„æ—¶é—´ï¼ˆç§’ï¼‰å†…ï¼Œæ²¡æœ‰ä»»ä½•æ•°æ®å†™å…¥ï¼Œåˆ™å°†è¯¥ä¸´æ—¶æ–‡ä»¶å…³é—­å¹¶é‡å‘½åæˆç›®æ ‡æ–‡ä»¶a1.sinks.k1.hdfs.idleTimeout=3a1.sinks.k1.hdfs.fileType=DataStreama1.sinks.k1.hdfs.useLocalTimeStamp=true## æ¯äº”åˆ†é’Ÿç”Ÿæˆä¸€ä¸ªç›®å½•ï¼Œroundå¯¹ç›®å½•è®¾ç½®# æ˜¯å¦å¯ç”¨æ—¶é—´ä¸Šçš„â€èˆå¼ƒâ€ï¼Œè¿™é‡Œçš„â€èˆå¼ƒâ€ï¼Œç±»ä¼¼äºŽâ€å››èˆäº”å…¥â€ï¼ŒåŽé¢å†ä»‹ç»ã€‚å¦‚æžœå¯ç”¨ï¼Œåˆ™ä¼šå½±å“é™¤äº†%tçš„å…¶ä»–æ‰€æœ‰æ—¶é—´è¡¨è¾¾å¼a1.sinks.k1.hdfs.round=true# æ—¶é—´ä¸Šè¿›è¡Œâ€œèˆå¼ƒâ€çš„å€¼ï¼›a1.sinks.k1.hdfs.roundValue=5# æ—¶é—´ä¸Šè¿›è¡Œâ€èˆå¼ƒâ€çš„å•ä½ï¼ŒåŒ…å«ï¼šsecond,minute,houra1.sinks.k1.hdfs.roundUnit=minute# Use a channel which buffers events in memorya1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100# Bind the source and sink to the channela1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f hdfs-sink.conf -Dflume.root.logger=INFO,console æ‹·è´æ–‡ä»¶æ¼”ç¤º12mkdir logsmv aa logs/ tengineå’Œflumeé›†æˆé¡¹ç›®é…ç½®1vi tengine_project.conf 12345678910111213141516171819202122232425a1.sources = r1a1.sinks = k1a1.channels = c1## ç›‘å¬tengineçš„access logæ–‡ä»¶a1.sources.r1.type = execa1.sources.r1.command = tail -F /opt/data/access.loga1.sinks.k1.type=hdfsa1.sinks.k1.hdfs.path=hdfs://mycluster/log/%Y%m%da1.sinks.k1.hdfs.rollCount=0a1.sinks.k1.hdfs.rollInterval=0a1.sinks.k1.hdfs.rollSize=10240a1.sinks.k1.hdfs.idleTimeout=5a1.sinks.k1.hdfs.fileType=DataStreama1.sinks.k1.hdfs.useLocalTimeStamp=truea1.sinks.k1.hdfs.callTimeout=40000a1.channels.c1.type = memorya1.channels.c1.capacity = 1000a1.channels.c1.transactionCapacity = 100a1.sources.r1.channels = c1a1.sinks.k1.channel = c1 å¯åŠ¨1flume-ng agent -n a1 -c conf -f tengine_project.conf -Dflume.root.logger=INFO,console æ‹·è´æ–‡ä»¶æ¼”ç¤º12mkdir logsmv aa logs/]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hadoop HDFSé›†ç¾¤å®‰è£…éƒ¨ç½²æ–‡æ¡£]]></title>
    <url>%2F2019%2F03%2F28%2Fhadoop%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3%2F</url>
    <content type="text"><![CDATA[ä¼ªé›†ç¾¤å®‰è£…æ–¹å¼1.JAVA_HOMEé…ç½®ç¼–è¾‘/etc/profileï¼Œé…ç½®å¦‚ä¸‹ 12export JAVA_HOME=/usr/install/jdk/jdk1.8.0_171export PATH=$PATH:$&#123;JAVA_HOME&#125;/bin 2.HADOOP_HOMEé…ç½®ç¼–è¾‘/etc/profileï¼Œé…ç½®å¦‚ä¸‹ 12export HADOOP_HOME=/opt/sxt/hadoop-2.6.5export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin 3.é…ç½®hostnameç¼–è¾‘/etc/hostname 1node01 ç¼–è¾‘/etc/sysconfig\networkï¼Œé…ç½®å¦‚ä¸‹ 123NETWORKING=yesHOSTNAME=node01GATEWAY=192.168.0.255 é…ç½®é™æ€ipï¼Œå‚è€ƒâ€œcentos7è™šæ‹Ÿæœºé…ç½®â€ é…ç½®hosts vi /etc/hosts 1234192.168.0.151 node01192.168.0.152 node02192.168.0.153 node03192.168.0.154 node04 æ‰§è¡Œhostname node01 æ‰§è¡Œuname -nï¼ŒæŸ¥çœ‹hostname ï¼Œä¸ºnode1é…ç½®æ­£å¸¸ã€‚ 4.é…ç½®ssh12ssh-keygen -t dsa -P '' -f ~/.ssh/id_dsacat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys æ‰§è¡Œssh node01ï¼Œæ­£å¸¸è¿žæŽ¥ã€‚ 5.é…ç½®core-site.xmlç¼–è¾‘/opt/sxt/hadoop-2.6.5/etc/hadoop/core-site.xml é…ç½®namenodeçš„å†…å­˜æŒä¹…åŒ–å­˜å‚¨åœ°å€ï¼Œhdfsæ˜¯å…¶ä¸­ä¸€ç§ã€‚ 1234&lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://node01:9000&lt;/value&gt;&lt;/property&gt; viå‘½ä»¤,4yyå¤åˆ¶4è¡Œï¼Œnpå†è¿›è¡Œç²˜è´´ é…ç½®hadoop.tmp.dirï¼Œæ ¹æ®core-default.xmlçš„é…ç½®ï¼Œé»˜è®¤é…ç½®æ˜¯ä¸´æ—¶tmpç›®å½•/tmp/hadoop-${user.name}ï¼Œä¼šæœ‰è¢«åˆ é™¤çš„é£Žé™©ã€‚æ ¹æ®hdfs-default.xmlçš„é…ç½®ï¼Œdfs.namenode.name.dirçš„é»˜è®¤é…ç½®ä¸ºfile://${hadoop.tmp.dir}/dfs/nameï¼Œdfs.datanode.data.dirçš„é»˜è®¤é…ç½®ä¸ºfile://${hadoop.tmp.dir}/dfs/dataã€‚ 1234&lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/var/sxt/hadoop/local&lt;/value&gt;&lt;/property&gt; 6.é…ç½®hdfs-site.xmlç¼–è¾‘/opt/sxt/hadoop-2.6.5/etc/hadoop/hdfs-site.xml é…ç½®dfs.replication blockçš„å‰¯æœ¬ä¸º1ï¼Œå› ä¸ºä¼ªé›†ç¾¤åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚ 1234&lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; &lt;value&gt;1&lt;/value&gt;&lt;/property&gt; vi 4yyï¼Œå†npç²˜è´´ é…ç½®secondaryçš„åœ°å€ 1234&lt;property&gt; &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt; &lt;value&gt;node01:50090&lt;/value&gt;&lt;/property&gt; 7.é…ç½®hadoop-env.shç¼–è¾‘/opt/sxt/hadoop-2.6.5/etc/hadoop/hadoop-env.xmlï¼Œå› ä¸ºsshå…ç™»ä¼šè¯»ä¸åˆ°JAVA_HOMEçš„çŽ¯å¢ƒå˜é‡ã€‚ 12# The java implementation to use.export JAVA_HOME=/usr/install/jdk/jdk1.8.0_171 8.hdfsæ ¼å¼åŒ–æ ¼å¼åŒ–namenodeï¼Œ/var/sxt/hadoop/localç›®å½•ä¸‹ä¼šå‡ºçŽ°ã€‚ç”Ÿäº§çŽ¯å¢ƒï¼Œè°¨æ…Žæ“ä½œ data name namesecondary 1hdfs namenode -format 1start-dfs.sh æ­¤æ—¶jpsæŸ¥çœ‹å¯åŠ¨NameNode DataNode SecondaryNameNode ä¸‰ä¸ªè¿›ç¨‹ cat /var/sxt/hadoop/local/dfs/data/current/VERSIONï¼ŒclusterIDä¸ºé›†ç¾¤idï¼Œä¸€ä¸ªé›†ç¾¤çš„ç›¸åŒã€‚ 1234567#Fri Mar 29 23:44:23 CST 2019storageID=DS-ecfbb1c3-3054-432b-adc1-3d0420278192clusterID=CID-56727752-38bd-4609-8a00-e3166867c072cTime=0datanodeUuid=43d62867-0669-4277-b37f-859f7194bc51storageType=DATA_NODElayoutVersion=-56 9.ä¸ºrootç”¨æˆ·åˆ›å»ºç”¨æˆ·ç›®å½•hdfs dfs -mkdir /user/root æµè§ˆå™¨æŸ¥çœ‹[http://192.168.0.117:50070](http://192.168.0.117:50070/) 10. ä¸Šä¼ æ–‡ä»¶åˆ°ç”¨æˆ·ç›®å½•1hdfs dfs -put hadoop-2.6.5.tar.gz /user/root æŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶ ç”Ÿæˆæ–‡ä»¶ 1for i in ` seq 100000 `; do echo "hello sxt $i" &gt;&gt; test.txt;done é…ç½®blocksizeçš„å¤§å°ï¼Œä¸Šä¼ æ–‡ä»¶ 1hdfs dfs -D dfs.blocksize=1048576 -put test.txt /user/root blockå—ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ 1/var/sxt/hadoop/local/dfs/data/current/BP-280976167-127.0.0.1-1553874062300/current/finalized/subdir0/subdir0 1234567891011# hadoop-2.6.5.tar.gzä¸¤ä¸ªblock-rw-r--r--. 1 root root 134217728 3æœˆ 29 23:56 blk_1073741825-rw-r--r--. 1 root root 1048583 3æœˆ 29 23:56 blk_1073741825_1001.meta-rw-r--r--. 1 root root 49377148 3æœˆ 29 23:56 blk_1073741826-rw-r--r--. 1 root root 385767 3æœˆ 29 23:56 blk_1073741826_1002.meta# test.txtçš„ä¸¤ä¸ªblock-rw-r--r--. 1 root root 1048576 3æœˆ 30 21:31 blk_1073741827-rw-r--r--. 1 root root 8199 3æœˆ 30 21:31 blk_1073741827_1003.meta-rw-r--r--. 1 root root 540319 3æœˆ 30 21:31 blk_1073741828-rw-r--r--. 1 root root 4231 3æœˆ 30 21:31 blk_1073741828_1004.meta åˆ†å¸ƒå¼é›†ç¾¤éƒ¨ç½²æ–¹å¼ namenode datanode secondarynode node01(192.168.0.151) * node02(192.168.0.152) * * node03(192.168.0.153) * node04(192.168.0.154) * 1. sshé…ç½®node01åˆ°node02 node03 node04åˆ‡æ¢åˆ°node01 12cd .sshscp id_dsa.pub root@192.168.0.152:`pwd`/node01.pub åˆ‡æ¢åˆ°node02 12cd .sshcat node01.pub &gt;&gt; authorized_keys å¦‚æ­¤é…ç½®node03 node04 2.hostsé…ç½®4å°æœºå™¨1vi /etc/hosts é…ç½®å¦‚ä¸‹ 1234192.168.0.151 node01192.168.0.152 node02192.168.0.153 node03192.168.0.154 node04 3. é…ç½®core-site.xml12cd /opt/sxt/hadoop-2.6.5/etc/hadoopvi core-site.xml é…ç½®å¦‚ä¸‹ 1234567891011&lt;configuration&gt; &lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; # namenodeå¯åŠ¨èŠ‚ç‚¹åŠç«¯å£ &lt;value&gt;hdfs://node01:9000&lt;/value&gt; &lt;/property&gt; &lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/var/sxt/hadoop/full&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; 4.é…ç½®datanodeçš„slaveèŠ‚ç‚¹12cd /opt/sxt/hadoop-2.6.5/etc/hadoopvi slaves é…ç½®å¦‚ä¸‹ 123node02node03node04 5.é…ç½®hdfs-site.xmlï¼Œdatanodeæ•°æ®æ•°é‡ï¼Œsecondarynodeçš„å¯åŠ¨èŠ‚ç‚¹1vi hdfs-site.xml 123456789101112&lt;configuration&gt; &lt;property&gt; &lt;name&gt;dfs.replication&lt;/name&gt; # datanodeå‰¯æœ¬æ•°é‡ &lt;value&gt;2&lt;/value&gt; &lt;/property&gt; &lt;property&gt; #secondarynodeçš„å¯åŠ¨èŠ‚ç‚¹ &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt; &lt;value&gt;node02:50090&lt;/value&gt; &lt;/property&gt;&lt;/configuration&gt; 6.scpé…ç½®å¥½çš„å®‰è£…ç›®å½•åˆ°å…¶ä»–3å°12cd /optscp -r sxt root@192.168.0.152:/opt/ 7.formatå’Œå¯åŠ¨åœ¨node01formatå’Œå¯åŠ¨ http://192.168.0.151:50070/dfshealth.html#tab-datanode å¯ä»¥æŸ¥çœ‹datanodeèŠ‚ç‚¹ 12hdfs namenode -formatstart-dfs.sh haé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²æ–¹å¼ namenode ä¸»å¤‡ï¼Œfsimage + editLog JournalNode æ›´æ–°æ—¥å¿— ZKFCäº‰æŠ¢é”ï¼Œä¸ºnamenodeåˆ¤æ–­ä¸»èŠ‚ç‚¹ namenode ä¸»å¤‡ ZKFC datanode zookeeper JNN node01 * * * node02 * * * * * node03 * * * node04 * * éœ€è¦é…ç½®node01 å’Œ node02ä¹‹é—´çš„ç›¸äº’å…å¯† éœ€è¦é…ç½®node01 åˆ° node02 node03 node04çš„å…å¯† éœ€è¦é…ç½®node02 åˆ° node01 node03 node04çš„å…å¯† 1.zookeeperå®‰è£…(node02 node03 node04)ç¼–è¾‘å¯ç”¨node02(192.168.0.152) 12345dataDir=/var/sxt/zkserver.1=192.168.0.152:2888:3888server.2=192.168.0.153:2888:3888server.3=192.168.0.154:2888:3888 12mkdir -p /var/sxt/zkecho "1" &gt; /var/sxt/zk/myid ä¾æ¬¡å¯åŠ¨node03 node04 ä¼šå‘çŽ°node03ä½œä¸ºleaderèŠ‚ç‚¹ï¼Œæ¯”è¾ƒç‰ˆæœ¬æœ€æ–°ï¼Œç‰ˆæœ¬ä¸€æ¬¡æ¯”è¾ƒmyidçš„å¤§å°ã€‚ å¯åŠ¨å®Œnode02ï¼Œnode03çš„myidæ¯”è¾ƒå¤§ï¼Œä½œä¸ºleaderã€‚å¯åŠ¨node04çš„æ—¶å€™ï¼ŒleaderèŠ‚ç‚¹å·²å­˜åœ¨ã€‚ 12zkServer.sh startzkServer.sh status 2.é…ç½®hdfs-site.xmlé…ç½®é€»è¾‘å’Œç‰©ç†çš„å…³ç³» 123456789101112131415161718192021222324&lt;property&gt; &lt;name&gt;dfs.nameservices&lt;/name&gt; &lt;value&gt;mycluster&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.ha.namenodes.mycluster&lt;/name&gt; &lt;value&gt;nn1,nn2&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.rpc-address.mycluster.nn1&lt;/name&gt; &lt;value&gt;node01:8020&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.rpc-address.mycluster.nn2&lt;/name&gt; &lt;value&gt;node02:8020&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.http-address.mycluster.nn1&lt;/name&gt; &lt;value&gt;node01:50070&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.namenode.http-address.mycluster.nn2&lt;/name&gt; &lt;value&gt;node02:50070&lt;/value&gt;&lt;/property&gt; é…ç½®journalnode å’Œ ssh 123456789101112131415161718192021222324&lt;property&gt; &lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt; &lt;value&gt;qjournal://node01:8485;node02:8485;node03:8485/mycluster&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.journalnode.edits.dir&lt;/name&gt; &lt;value&gt;/var/sxt/hadoop/ha/jn&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.client.failover.proxy.provider.mycluster&lt;/name&gt; &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt; &lt;value&gt;sshfence&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt; &lt;value&gt;/root/.ssh/id_dsa&lt;/value&gt;&lt;/property&gt; å¯ç”¨zkfcé…ç½® 1234&lt;property&gt; &lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt; &lt;value&gt;true&lt;/value&gt; &lt;/property&gt; 3.é…ç½®core-site.xmlé…ç½®namenodeçš„å­˜å‚¨é…ç½®ï¼Œä»¥åŠzookeeperçš„é…ç½® 1234567891011121314&lt;property&gt; &lt;name&gt;fs.defaultFS&lt;/name&gt; &lt;value&gt;hdfs://mycluster&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;hadoop.tmp.dir&lt;/name&gt; &lt;value&gt;/var/sxt/hadoop/ha&lt;/value&gt;&lt;/property&gt;&lt;property&gt; &lt;name&gt;ha.zookeeper.quorum&lt;/name&gt; &lt;value&gt;node02:2181,node03:2181,node04:2181&lt;/value&gt; &lt;/property&gt; å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°node02 node03 node04 1scp hdfs-site.xml core-site.xml node02:`pwd` 4.å¯åŠ¨journalnodeï¼Œnode01 node02 node031hadoop-daemon.sh start journalnode 5.æ ¼å¼åŒ–namenode æ ¼å¼åŒ–zkfczookeeper å¯åŠ¨namenode123hdfs namenode -formathdfs zkfc -formtZKhadoop-daemon.sh start namenode æŸ¥çœ‹zkCli.sh 1ls /hadoop-ha/mycluster 6.node02 å¤åˆ¶é…ç½®ï¼Œä»¥standbyæ–¹å¼å¯åŠ¨1hdfs namenode -bootstrapStandby 7.æœ€åŽå¯åŠ¨ hdfs1start-dfs.sh 8.é‡å¯åªéœ€è¦å¯åŠ¨zkï¼Œå¯åŠ¨start-dfs.sh9.éªŒè¯hahttp://node01:50070/dfshealth.html#tab-overview æŸ¥çœ‹node01ä¸ºactiveçŠ¶æ€ æ€æŽ‰node01kill -9 namenode http://node02:50070/dfshealth.html#tab-overview node02å˜ä¸ºactiveçŠ¶æ€ ä»ŽzkèŠ‚ç‚¹æŸ¥çœ‹äº‰æŠ¢é”çŠ¶æ€ 1get /hadoop-ha/mycluster/ActiveStandbyElectorLock 123456789101112 myclusternn2node02cZxid = 0x100000175ctime = Sat Apr 06 23:58:59 EDT 2019mZxid = 0x100000175mtime = Sat Apr 06 23:58:59 EDT 2019pZxid = 0x100000175cversion = 0dataVersion = 0aclVersion = 0ephemeralOwner = 0x269f5aa4c8b003adataLength = 30numChildren = 0 é‡æ–°å¯ç”¨node01 1hadoop-daemon.sh start namenode zkFC downä¹‹åŽï¼Œåº”è¯¥æ˜¯zkäº‰æŠ¢é”èŠ‚ç‚¹ï¼Œå¤±åŽ»å¿ƒè·³é“¾æŽ¥ æœåŠ¡å™¨downä¹‹åŽçš„åŽæžœï¼Œä¹Ÿå¯æ­£å¸¸åˆ‡æ¢ å¼€å‘åˆ†å¸ƒå¼å­˜å‚¨windows eclipseå¼€å‘é…ç½®1.ä½¿ç”¨eclipse marsè§£åŽ‹ï¼Œè§£åŽ‹hadoop-2.6.5ï¼Œ 2.å¤åˆ¶hadoop-2.6.5\sharre\hadoopä¸­comonã€hdfsã€mapreduceã€toolsã€yarnä¸­çš„æ ¹ç›®å½•çš„jaråŒ…ï¼Œä»¥åŠlibç›®å½•ä¸‹çš„jaråŒ…ï¼Œç»Ÿä¸€å¤åˆ¶åˆ°ç›®å½•ï¼Œå…±121ä¸ªï¼Œé…ç½®æˆuser-library 3.é…ç½®HADOOP_HOMEçŽ¯å¢ƒå˜é‡ï¼ŒHADOOP_USER_NAMEçŽ¯å¢ƒå˜é‡ä¸ºrootï¼Œé…ç½®path 4.hadoop.dll æ”¾åˆ° c:/windows/system32ä¸‹ 5.å¤åˆ¶æœåŠ¡æœºå™¨é…ç½®ä¸­çš„core-site.xml hdfs-site.xml åˆ°confç›®å½•ä¸‹ï¼Œå¹¶å°†æ–‡ä»¶å¤¹è®¾ç½®ä¸ºresource æµ‹è¯•ç”¨ä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475package com.sxt.hadoop.hdfs;import java.io.BufferedInputStream;import java.io.File;import java.io.FileInputStream;import java.io.FileNotFoundException;import java.io.IOException;import java.io.InputStream;import org.apache.hadoop.conf.Configuration;import org.apache.hadoop.fs.BlockLocation;import org.apache.hadoop.fs.FSDataOutputStream;import org.apache.hadoop.fs.FileStatus;import org.apache.hadoop.fs.FileSystem;import org.apache.hadoop.fs.Path;import org.apache.hadoop.io.IOUtils;import org.junit.After;import org.junit.Before;import org.junit.Test;public class TetsHDFS &#123; Configuration conf = null; FileSystem fs = null; @Before public void connect() throws IOException&#123; conf = new Configuration(true); fs = FileSystem.get(conf); &#125; @After public void close() throws IOException&#123; fs.close(); &#125; @Test public void mkdir() throws IOException&#123; Path dirs = new Path("/data"); if(fs.exists(dirs))&#123; fs.delete(dirs,true); &#125; fs.mkdirs(dirs); &#125; @Test public void upload() throws IOException&#123; InputStream input = new BufferedInputStream(new FileInputStream( new File("D:\\uninstall\\redis\\redis\\redis.windows.conf"))); Path f = new Path("/data/ooxx.txt"); FSDataOutputStream out = fs.create(f); IOUtils.copyBytes(input, out, conf , true); &#125; @Test public void blocksize() throws IOException&#123; Path path = new Path("/user/root/test.txt"); FileStatus fileStatus = fs.getFileStatus(path); BlockLocation[] lcts = fs.getFileBlockLocations(fileStatus, 0, fileStatus.getLen()); for(BlockLocation lct : lcts)&#123; System.out.println(lct); &#125; &#125;&#125; 1234567891011121314for i in `seq 100` ;do echo "" &gt;&gt; test.txt;donefs.getFileStatus(f);Boclocatin[] fs.getFileBOckeLocations(file,0.file.getLen);sout(locaiton);FSInput fs.open(f);sout((cahr)in.redfByte());ç¬¬äºŒä¸ªå—indexin.seek(1048576);è·³è¿‡]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
      <tags>
        <tag>å¤§æ•°æ®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Netty ByteBuf]]></title>
    <url>%2F2019%2F03%2F08%2FNetty-ByteBuf%2F</url>
    <content type="text"><![CDATA[æœ¬ç« ä¸»è¦å†…å®¹ByteBufByteBufHolderByteBufAllocatorä½¿ç”¨ä¸Šè¿°æŽ¥å£ä¼ è¾“æ•°æ®æ—¶ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºåŒ…è£…æ•°æ®ã€‚Javaçš„NIOæœ‰è‡ªå·±çš„Bufferç±»ï¼Œï¼Œå®ƒä»¬å®žçŽ°çš„åŠŸèƒ½æœ‰é™å¹¶ä¸”æ²¡æœ‰ä¼˜åŒ–è¿‡ã€‚ä½¿ç”¨JDKçš„ByteBufferå¾€å¾€æ˜¯æ¯”è¾ƒéº»çƒ¦ä¹Ÿæ¯”è¾ƒå¤æ‚çš„ã€‚ç¼“å†²åŒºæ˜¯ç½‘ç»œåº”ç”¨éžå¸¸é‡è¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œæœ‰å¿…è¦æä¾›ç»™å¼€å‘è€…ï¼Œå¹¶ä¸”åº”è¯¥æ˜¯APIçš„ä¸€éƒ¨åˆ†ã€‚å¹¸è¿çš„æ˜¯ï¼ŒNettyæä¾›äº†åŠŸèƒ½å¼ºå¤§çš„ç¼“å†²åŒºå®žçŽ°ï¼Œå®ƒç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œå¸®åŠ©å¼€å‘è€…æ“ä½œåŽŸå§‹å­—èŠ‚æ•°æ®æˆ–è€…è‡ªå®šä¹‰çš„Javaå¯¹è±¡ã€‚Nettyä¸­çš„ç¼“å†²åŒºå«ByteBufï¼Œå®žé™…ä¸Šç­‰ä»·äºŽJDKçš„ByteBufferã€‚ByteBufçš„ä½œç”¨æ˜¯é€šè¿‡Nettyçš„ç®¡é“ä¼ è¾“æ•°æ®ã€‚å®ƒä»Žæ ¹æœ¬ä¸Šè§£å†³äº†JDKç¼“å†²åŒºçš„é—®é¢˜ï¼Œå¹¶ä¸”Nettyåº”ç”¨å¼€å‘è€…ç»å¸¸ä¼šä½¿ç”¨åˆ°å®ƒï¼Œè¿™äº›å› ç´ éƒ½è®©å®ƒæœ‰å¾ˆå¼ºçš„ç”Ÿäº§åŠ›ã€‚åœ¨ä¸ŽJDKçš„ç¼“å†²æœŸç›¸æ¯”æœ‰å¾ˆå¤§ä¼˜åŠ¿ã€‚å› ä¸ºç¼“å†²åŒºä¼ é€æ•°æ®éƒ½æ˜¯é€šè¿‡Nettyçš„ChannelPipelineå’ŒChannelHandlerï¼Œæ‰€ä»¥Nettyåº”ç”¨éƒ½ä¼šä½¿ç”¨åˆ°ç¼“å†²åŒºAPIã€‚ ä¸€ã€Buffer APINettyçš„Buffer APIä¸»è¦æœ‰ä¸¤ä¸ªæŽ¥å£ï¼šByteBufByteBufHolderNettyç¼“å†²APIæœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼šå¦‚æžœæœ‰éœ€è¦ä½ å¯ä»¥è‡ªå®šä¹‰ç¼“å†²ç±»åž‹å†…ç½®å¤åˆç¼“å†²ç±»åž‹å®žçŽ°é›¶æ‹·è´å®¹é‡æ˜¯æŒ‰éœ€æ‰©å±•çš„ï¼Œç±»ä¼¼StringBufferä¸éœ€è¦é€šè¿‡è°ƒç”¨flip()æ–¹æ³•åˆ‡æ¢è¯»å†™æ¨¡å¼è¯»ç´¢å¼•å’Œå†™ç´¢å¼•æ˜¯åˆ†å¼€çš„æ–¹æ³•è°ƒç”¨æ˜¯é“¾å¼ç»“æž„çš„å¼•ç”¨æŠ€æœ¯åŠŸèƒ½è‡ªåŠ¨é‡Šæ”¾èµ„æºæ± ä¼˜åŒ–æŠ€æœ¯ä¸Šé¢è¿™äº›æˆ‘ä»¬åŽé¢éƒ½ä¼šä»‹ç»ï¼ŒåŒ…æ‹¬æ± ä¼˜åŒ–æŠ€æœ¯ã€‚çŽ°åœ¨æˆ‘ä»¬å…ˆä»Žæœ€å¸¸ç”¨çš„å­—èŠ‚å®¹å™¨å¼€å§‹ã€‚ äºŒã€å­—èŠ‚å®¹å™¨ByteBufå½“ä½ éœ€è¦é€šè¿‡ç½‘ç»œä¸Žå¯¹ç«¯å¦‚æ•°æ®åº“äº¤æ¢æ•°æ®æ—¶ï¼Œéƒ½æ˜¯é€šè¿‡å­—èŠ‚æ¥æ²Ÿé€šçš„ ByteBufæ˜¯ä¸€ä¸ªå¯ä»¥è®©ä½ æœ‰æ•ˆçš„è¯»å†™å­—èŠ‚æ•°æ®çš„æ•°æ®å®¹å™¨ã€‚ä¸ºäº†æ˜“äºŽæ“ä½œï¼Œå®ƒä½¿ç”¨äº†ä¸¤ä¸ªç´¢å¼•ï¼šä¸€ä¸ªç”¨æ¥è¯»ä¸€ä¸ªç”¨æ¥å†™ã€‚è¿™æ ·ä½ åªéœ€è¦è°ƒæ•´è¯»ç´¢å¼•å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„é‡å¤è¯»å–å®¹å™¨å†…çš„æ•°æ®äº†ã€‚ 2.1ã€å·¥ä½œæ–¹å¼å½“å‘ByteBufå†™æ•°æ®æ—¶ï¼Œå†™ç´¢å¼•ä¼šæ ¹æ®æ ¹æ®å†™å…¥çš„å­—ç¬¦æ•°å¢žåŠ åŒæ ·æ•°å€¼ã€‚å½“ä½ å¼€å§‹è¯»æ•°æ®æ—¶ï¼Œè¯»ç´¢å¼•ä¹Ÿä¼šå¢žåŠ ï¼Œåªæœ‰è¯»å†™ç´¢å¼•å¤„äºŽåŒä¸€ä½ç½®ã€‚ç„¶åŽByteBufå°±ä¸å¯è¯»äº†ï¼Œå¦‚æžœç»§ç»­è¯»çš„è¯å°±ä¼šæŠ›å‡ºIndexOutOfBoundsExceptionå¼‚å¸¸ï¼Œç±»ä¼¼è¯»æ•°ç»„è¶Šç•Œä¸€æ ·ã€‚å½“è°ƒç”¨ä»»ä½•ä»¥readæˆ–writeå¼€å¤´çš„æ–¹æ³•æ—¶ï¼Œè¯»å†™ç´¢å¼•éƒ½ä¼šè‡ªåŠ¨å¢žé•¿ã€‚ä¹Ÿæœ‰ä¸€äº›ç›¸å¯¹æ“ä½œæ–¹æ³•å¦‚getæˆ–setï¼Œè¿™äº›æ–¹æ³•ä¸ä¼šåŽ»ç§»åŠ¨ç´¢å¼•ï¼Œä½†ä¼šåŽ»æ“ä½œç»™å®šçš„ç›¸å¯¹ç´¢å¼•ã€‚ByteBufæ˜¯æœ‰å®¹é‡ä¸Šé™çš„ï¼Œå¦‚æžœå°†å†™ç´¢å¼•ç§»åˆ°è¶…è¿‡å®¹é‡ä¸Šé™çš„ä½ç½®å°±ä¼šå‡ºçŽ°å¼‚å¸¸ã€‚é»˜è®¤çš„å®¹é‡ä¸Šé™æ˜¯Integer.MAX_VALUEã€‚ä¸‹å›¾å±•ç¤ºäº†ByteBufçš„åŸºæœ¬ç»“æž„å›¾ã€‚ä»Žä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒByteBufå¾ˆç±»ä¼¼å­—èŠ‚æ•°ç»„ï¼Œæœ€æ˜Žæ˜¾çš„åŒºåˆ«å°±æ˜¯ByteBufæœ‰åˆ†å¼€äº†è¯»å†™ç´¢å¼•è¿›è¡Œè®¿é—®æ•°æ®ã€‚ 2.2ã€ä¸åŒç±»åž‹çš„ByteBufå¸¸ç”¨çš„ByteBufä¸€å…±æœ‰ä¸‰ç§ï¼Œå…¶ä»–çš„ä¹Ÿæœ‰ä¸å°‘ï¼Œä¸è¿‡ä¸€èˆ¬å¼€å‘è€…å¾ˆå°‘ä¼šç”¨åˆ°ï¼Œéƒ½æ˜¯Nettyå†…éƒ¨ä½¿ç”¨ã€‚å¯èƒ½ä½ è¿˜ä¼šå®žçŽ°è‡ªå·±çš„ç¼“å†²åŒºï¼Œä¸è¿‡è¿™ä¸ªä¸åœ¨æœ¬ç« å†…å®¹ä¹‹å†…ã€‚é¦–å…ˆæ¥çœ‹çœ‹ä½ å¯èƒ½æœ€æ„Ÿå…´è¶£çš„ç¼“å†²ã€‚ å †ç¼“å†²æœ€å¸¸ç”¨çš„ByteBufæ˜¯å­˜å‚¨æ•°æ®åœ¨JVMå †å†…å­˜ä¸Šçš„ç¼“å†²åŒºã€‚è¿™ç§ç¼“å†²åŒºå†…éƒ¨å®žçŽ°å°±æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ä¸‹é¢å±•ç¤ºä¸€ä¸‹å®ƒçš„åŸºæœ¬ç”¨æ³•ã€‚ 123456789101112ByteBuf heapBuf = ...;//æ£€æµ‹ByteBufæ˜¯å¦æœ‰æ•°ç»„if (heapBuf.hasArray()) &#123; //èŽ·å–æ•°ç»„å¼•ç”¨ byte[] array = heapBuf.array(); //è®¡ç®—ç¬¬ä¸€ä¸ªå­—èŠ‚æ‰€åœ¨ä½ç½® int offset = heapBuf.arrayOffset() + heapBuf.position(); //èŽ·å–å¯è¯»å­—èŠ‚æ€»æ•° int length = heapBuf.readableBytes(); //ä½¿ç”¨è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å¤„ç†æ•°æ® YourImpl.method(array, offset, length);&#125; å¦‚æžœè®¿é—®éžå †å†…å­˜ByteBufçš„æ•°ç»„ï¼Œå°±ä¼šæŠ›å‡ºUnsupportedOperationExceptionã€‚å› æ­¤è®¿é—®ByteBufæ•°ç»„ä¹‹å‰åº”è¯¥ä½¿ç”¨hasArray()æ–¹æ³•æ£€æµ‹æ­¤ç¼“å†²åŒºæ˜¯å¦æ”¯æŒæ•°ç»„ã€‚ ç›´æŽ¥ç¼“å†²åŒºå¦ä¸€ä¸ªByteBufçš„å®žçŽ°æ˜¯ç›´æŽ¥ç¼“å†²åŒºã€‚ç›´æŽ¥çš„æ„æ€å°±æ˜¯è¿™ä¸ªç¼“å†²åŒºåˆ†é…çš„å†…å­˜æ˜¯åœ¨JVMå †å†…å­˜å¤–éƒ¨ã€‚ä½¿ç”¨ç›´æŽ¥å†…å­˜æ—¶ä½ ä¸ä¼šåœ¨JVMå †ç©ºé—´ä¸­çœ‹è§å®ƒçš„ä½¿ç”¨é‡ã€‚æ‰€ä»¥ä½ è®¡ç®—ä½ çš„åº”ç”¨å†…å­˜ä½¿ç”¨é‡æ—¶ï¼Œç›´æŽ¥å†…å­˜åŒºåŸŸä¹Ÿè¦ç®—ä¸Šï¼Œç„¶åŽé™åˆ¶å®ƒçš„æœ€å¤§ä½¿ç”¨é‡ï¼Œé˜²æ­¢ç³»ç»Ÿå†…å­˜ä¸å¤Ÿç”¨å‡ºçŽ°é”™è¯¯ã€‚é€šè¿‡ç½‘ç»œä¼ è¾“æ•°æ®æ—¶ä½¿ç”¨ç›´æŽ¥ç¼“å†²æ€§èƒ½æ˜¯å¾ˆé«˜çš„ã€‚ä¸‹é¢çš„ä¸€éƒ¨åˆ†ä»£ç å±•ç¤ºäº†å¦‚ä½•é€šè¿‡æ•°ç»„çš„æ–¹å¼è®¿é—®ç›´æŽ¥ç¼“å†²åŒºçš„æ•°æ®ã€‚ 123456789101112ByteBuf directBuf = ...;//æ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦æœ‰æ•°ç»„ï¼Œè¿”å›žflaseå°±æ˜¯ç›´æŽ¥ç¼“å†²if (!directBuf.hasArray()) &#123;//èŽ·å–å¯è¯»å­—èŠ‚æ•°é‡int length = directBuf.readableBytes();//åˆå§‹åŒ–ç›¸åŒé•¿åº¦çš„ç›´æŽ¥æ•°ç»„byte[] array = new byte[length];//è¯»å–æ•°æ®åˆ°æ•°ç»„ä¸­directBuf.getBytes(array);//ç”¨æˆ·ä¸šåŠ¡é€»è¾‘æ“ä½œå­—èŠ‚æ•°ç»„YourImpl.method(array, 0, array.length);&#125; å¯ä»¥çœ‹å‡ºï¼Œç›´æŽ¥ç¼“å†²åŒºéœ€è¦å°†æ•°æ®å¤åˆ¶åˆ°æ•°ç»„ï¼Œå¦‚æžœä½ æƒ³ç›´æŽ¥é€šè¿‡å­—èŠ‚æ•°ç»„è®¿é—®æ•°æ®ï¼Œç”¨å †ç¼“å†²åŒºæ›´å¥½ä¸€äº›ã€‚ ç»„åˆç¼“å†²åŒºçŽ°åœ¨æ¥ä»‹ç»ä¸€ä¸ªç»„åˆç¼“å†²åŒºï¼Œå®ƒçš„åå­—å«CompositeByteBufã€‚äººå¦‚å…¶åï¼Œå®ƒå…è®¸ä½ å°†ä¸åŒç±»åž‹çš„ByteBufç»„åˆåœ¨ä¸€èµ·å¹¶ä¸”æä¾›è®¿é—®ä»–ä»¬çš„æ–¹å¼ã€‚CompositeByteBufä¹Ÿåƒæ˜¯å„ç§ç±»åž‹ByteBufçš„è§†å›¾ï¼Œå®ƒçš„hasArray()æ–¹æ³•è¿”å›žçš„falseï¼Œå› ä¸ºå®ƒé‡Œé¢å¯èƒ½åŒ…å«å¤šä¸ªå †ç¼“å†²æˆ–ç›´æŽ¥ç¼“å†²ã€‚ä¾‹å¦‚ï¼Œä¸€æ¡æ¶ˆæ¯å¯èƒ½ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼šæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ã€‚æ¨¡å—åŒ–åº”ç”¨ä¸­ï¼Œè¿™ä¸¤éƒ¨åˆ†å¯èƒ½æ˜¯ç”±ä¸åŒæ¨¡å—çš„äº§ç”Ÿå¹¶ç»„åˆåœ¨ä¸€èµ·ç„¶åŽå†å‘é€ã€‚å¾ˆå¤šæ—¶å€™ï¼Œä½ å‘é€çš„æ¶ˆæ¯å¾€å¾€åªä¿®æ”¹ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚æ¶ˆæ¯ä½“ä¸€æ ·ï¼Œæ”¹å˜æ¶ˆæ¯å¤´ã€‚è¿™é‡Œå°±ä¸ç”¨æ¯æ¬¡éƒ½é‡æ–°åˆ†é…ç¼“å­˜äº† ä¸Šé¢è¿™ç§åœºæ™¯å°±å¾ˆé€‚åˆCompositeByteBufï¼Œä¸éœ€è¦å†…å­˜æ‹·è´ï¼Œè€Œä¸”ä½¿ç”¨çš„æ˜¯å’Œéžç»„åˆç¼“å†²ç›¸åŒçš„APIã€‚ä¸‹å›¾å±•ç¤ºäº†ä¸‹é¢çš„ä¼ªä»£ç å±•ç¤ºè¿™ä¸¤ä¸ªæ–¹å¼ã€‚ 12345678//ç¬¬ä¸€ç§ä½¿ç”¨æ•°ç»„ç»„åˆByteBuffer[] message = new ByteBuffer[] &#123; header, body &#125;;//ç¬¬äºŒç§å°†å¤´å°¾éƒ½å¤åˆ¶åˆ°æ–°çš„ByteBufferByteBuffer message2 = ByteBuffer.allocate(header.remaining()+ body.remaining());message2.put(header);message2.put(body);message2.flip(); ä¸Šé¢çš„æ–¹å¼éƒ½æœ‰å¾ˆæ˜Žæ˜¾çš„ç¼ºç‚¹ï¼šä½¿ç”¨æ•°ç»„å¤„ç†ï¼Œä»£ç é‡åŠAPIéƒ½æ¯”è¾ƒå¤æ‚ã€‚ä½¿ç”¨æ•°æ®å¤åˆ¶ä»£ä»·æœ‰å¾ˆå¤§ï¼Œæµªè´¹æ—¶é—´å’Œèµ„æºã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹Nettyçš„CompositeByteBufæ€Žä¹ˆå¤„ç†è¿™ç§æƒ…å†µã€‚ CompositeByteBufç»„åˆæ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“çš„ç»“æž„ CompositeBytebufä¹Ÿæ˜¯ä¸èƒ½é€šè¿‡æ•°ç»„çš„æ–¹å¼ç›´æŽ¥è®¿é—®å…¶é‡Œé¢çš„æ•°æ®ã€‚ä¸‹é¢å±•ç¤ºCompositeBytebufæ€Žä¹ˆè®¿é—®æ•°æ® 123456789101112CompositeByteBuf compBuf = ...;ByteBuf heapBuf = ...;ByteBuf directBuf = ...;//å°†æ•°æ®éƒ½æ”¾å…¥åˆ°CompositeByteBufcompBuf.addComponent(heapBuf, directBuf).....//ç§»é™¤ç´¢å¼•æ˜¯0çš„æ•°æ®ï¼Œå°±åƒListcompBuf.removeComponent(0);//éåŽ†ç»„åˆç¼“å†²ä¸­çš„ç¼“å†²å®žä¾‹for (ByteBuf buf: compBuf) &#123; System.out.println(buf.toString());&#125; ä¸‰ã€ByteBufçš„å­—èŠ‚æ“ä½œByteBufæä¾›äº†å¾ˆå¤šè¯»å†™å†…å®¹çš„æ–¹æ³•ã€‚ 3.1ã€éšæœºè®¿é—®å’ŒåŽŸå§‹å­—èŠ‚æ•°ç»„ä¸€æ ·ï¼ŒByteBufçš„ç´¢å¼•ä¹Ÿæ˜¯ä»Ž0å¼€å§‹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„ä½ç½®æ˜¯0ï¼Œæœ€åŽä¸€ä¸ªå­—èŠ‚çš„ä½ç½®æ˜¯å®¹é‡-1ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼Œå¯ä»¥ç›´æŽ¥éåŽ†ByteBufçš„æ‰€æœ‰å­—èŠ‚ï¼Œè€Œä¸ç”¨åŽ»ç®¡å®ƒå†…éƒ¨å¦‚ä½•å®žçŽ°çš„ã€‚å‰é¢è¯´è¿‡ï¼Œä½¿ç”¨setæˆ–getå¼€å¤´çš„æ–¹æ³•ä¸ä¼šå¢žé•¿å®ƒçš„è¯»å†™ç´¢å¼•ï¼Œæ‰€ä»¥å¦‚æžœä½ ä½¿ç”¨ä¸Šé¢çš„æ–¹å¼è¯»å–æ•°æ®ï¼Œå¯ä»¥å†™ä»£ç æ›´æ–°è¯»å†™ç´¢å¼•ã€‚ 12345ByteBuf buffer = ...;for (int i = 0; i &lt; buffer.capacity(); i ++) &#123; byte b = buffer.getByte(i); System.out.println((char) b);&#125; 3.2ã€é¡ºåºè®¿é—®ByteBufæä¾›äº†ä¸¤ä¸ªç´¢å¼•æ¥æ”¯æŒé¡ºåºè®¿é—®çš„éœ€æ±‚ï¼Œä¸€ä¸ªæ˜¯readerIndexè¯»ç´¢å¼•æ”¯æŒè¯»æ“ä½œçš„ï¼Œä¸€ä¸ªæ˜¯writerIndexå†™ç´¢å¼•æ”¯æŒå†™æ“ä½œçš„ï¼Œå„è‡ªä¹‹é—´åˆ†å·¥å¾ˆæ˜Žç¡®ã€‚è€ŒJDKçš„ByteBufferåªæœ‰ä¸€ä¸ªç´¢å¼•ï¼Œæ‰€ä»¥æ¯æ¬¡åˆ‡æ¢è¯»å†™æ¨¡å¼çš„æ—¶å€™ä½ éƒ½éœ€è¦è°ƒç”¨ä¸€ä¸‹flip()æ–¹æ³•ã€‚ä¸‹å›¾å±•ç¤ºäº†ByteBufè¢«ä¸¤ä¸ªç´¢å¼•åˆ†æˆä¸‰ä¸ªåŒºåŸŸçš„ç»“æž„ã€‚ 3.3ã€å¯è¯»å­—èŠ‚å†…å®¹(å®žé™…å†…å®¹)ByteBufä¸­çš„å®žé™…å†…å®¹å­˜å‚¨åœ¨å¯è¯»å­—èŠ‚åŒºåŸŸã€‚ä»¥readæˆ–skipå¼€å¤´çš„æ–¹æ³•ï¼Œä½ è¯»äº†å¤šå°‘æ•°é‡çš„å­—èŠ‚ï¼Œç›¸åº”çš„è¯»ç´¢å¼•å°±ä¼šå¢žåŠ å¤šå°‘ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•è¯»å–ByteBufä¸­çš„æ‰€æœ‰å¯è¯»å†…å®¹ã€‚ 1234ByteBuf buffer = ...;while (buffer.readable()) &#123; System.out.println(buffer.readByte());&#125; 3.4ã€å¯å†™å­—èŠ‚è¿™å—åŒºåŸŸæ˜¯éœ€è¦å¡«å……çš„æœªå®šä¹‰åŒºåŸŸã€‚ä»¥writeå¼€å¤´çš„æ–¹æ³•ä¼šä»Žå½“å‰çš„writerIndexä½ç½®å†™å…¥æ•°æ®ï¼Œå¹¶ä¸”å†™äº†å¤šå°‘æ•°æ®,è¿™ä¸ªwriterIndexä¹Ÿä¼šå¢žåŠ ç›¸åº”çš„æ•°é‡ã€‚å¦‚æžœå†™æ“ä½œæ–¹æ³•çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªByteBufå¹¶ä¸”æ²¡æœ‰æŒ‡å®šæºç´¢å¼•ï¼Œåˆ™è¿™ä¸ªå‚æ•°çš„è¯»ç´¢å¼•ä¹Ÿä¼šå¢žé•¿ç›¸åº”çš„æ•°é‡ã€‚å¦‚æžœæ²¡æœ‰è¶³å¤Ÿçš„å¯å†™åŒºåŸŸäº†è¿˜ç»§ç»­ä½¿ç”¨å†™æ“ä½œå°±ä¼šæŠ›å‡ºIndexOutOfBoundExceptionå¼‚å¸¸ã€‚æ–°åˆ†é…çš„ByteBufçš„å†™ç´¢å¼•é»˜è®¤å€¼ä¹Ÿæ˜¯0ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ç”¨Intç±»åž‹æ•°æ®å¡«æ»¡å¯å†™åŒºåŸŸã€‚ 1234ByteBuf buffer = ...;while (buffer.writableBytes() &gt;= 4) &#123; buffer.writeInt(random.nextInt());&#125; 3.5ã€æ´¾ç”Ÿç¼“å†²åŒºæ´¾ç”Ÿç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç¼“å†²åŒºçš„è§†å›¾ï¼Œå¯ä»¥è°ƒç”¨duplicate(),slice(),slice(int, int),readOnly()å’Œorder(ByteOrder)ç­‰æ–¹æ³•å®žçŽ°ã€‚æ´¾ç”Ÿç¼“å†²åŒºä¼šäº§ç”Ÿè‡ªå·±çš„è¯»å†™ç´¢å¼•å’Œå…¶ä»–æ ‡è®°ç´¢å¼•ï¼Œä½†æ˜¯ä»–ä»¬å…±äº«å†…éƒ¨çš„æ•°æ®ã€‚å› ä¸ºå®ƒä»¬å…±äº«å†…éƒ¨çš„æ•°æ®ï¼Œæ‰€ä»¥åˆ›å»ºæ´¾ç”Ÿç¼“å†²æ˜¯æ²¡æœ‰ä»€ä¹ˆæ€§èƒ½æŸè€—çš„ï¼Œè€Œä¸”æ˜¯æ¯”è¾ƒå¥½çš„æ–¹å¼ï¼Œä¾‹å¦‚ä½ æƒ³æ‹¥æœ‰ä¸€ä¸ªç¼“å†²åŒºçš„åˆ‡ç‰‡ã€‚å¦‚æžœéœ€è¦å¤åˆ¶ä¸€ä¸ªç¼“å†²åŒºï¼Œå¯ä»¥ä½¿ç”¨copy()æˆ–copy(int, int)æ–¹æ³•ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†æ€Žä¹ˆèŽ·å–ä¸€ä¸ªByteBufçš„åˆ‡ç‰‡ã€‚ 1234567891011Charset utf8 = Charset.forName(â€œUTF-8â€œ);//æ ¹æ®ç»™å®šçš„å­—ç¬¦ä¸²å†…å®¹åˆ›å»ºä¸€ä¸ªByteBufByteBuf buf = Unpooled.copiedBuffer(â€œxxxxâ€œ, utf8);//åˆ›å»ºByteBufçš„åˆ‡ç‰‡ï¼Œèµ·å§‹ä½ç½®æ˜¯0ï¼Œæˆªæ­¢ä½ç½®æ˜¯14ByteBuf sliced = buf.slice(0, 14);//æ‰“å°åˆ‡ç‰‡å†…å®¹ï¼Œæ­£å¸¸åº”è¯¥æ˜¯"xxxx"System.out.println(sliced.toString(utf8);//ä¿®æ”¹ç´¢å¼•0å†…å®¹buf.setByte(0, (byte) â€™Jâ€™);//æ–­è¨€ä¼šæˆåŠŸï¼Œå› ä¸ºä»–ä»¬å…±äº«å†…éƒ¨çš„æ•°æ®ï¼Œå…¶å®žä¿®æ”¹çš„å°±æ˜¯ä»–ä»¬å†…éƒ¨æŒ‡å‘çš„å…±åŒæ•°æ®å—assert buf.get(0) == sliced.get(0); å¯ä»¥å‘çŽ°ï¼Œåˆ‡ç‰‡å’ŒåŽŸå§‹ByteBufé‡Œé¢çš„å†…å®¹å…¶å®žæ˜¯åŒä¸€å—å†…å­˜åŒºåŸŸã€‚çŽ°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ€Žä¹ˆå¤åˆ¶ByteBufï¼Œä»¥åŠå®ƒå’Œåˆ‡ç‰‡ByteBufæœ‰ä»€ä¹ˆä¸åŒï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç ã€‚ 1234567891011Charset utf8 = Charset.forName(â€œUTF-8â€œ);//åŒæ ·æ ¹æ®ç»™å®šå­—ç¬¦ä¸²åˆ›å»ºByteBufByteBuf buf = Unpooled.copiedBuffer(â€œxxx!â€œ, utf8);//å¤åˆ¶ByteBuf 0-14ä½ç½®çš„å†…å®¹ByteBuf copy = buf.copy(0, 14);//è¾“å‡ºå¤åˆ¶çš„ByteBufå†…å®¹ï¼Œæ­£å¸¸åº”è¯¥æ˜¯"xxx"System.out.println(copy.toString(utf8);//åŒæ ·ä¿®æ”¹å†…å®¹buf.setByte(0, (byte) â€™Jâ€™);//æ–­è¨€ä¼šæˆåŠŸï¼Œå› ä¸ºå¤åˆ¶ç¼“å†²å’ŒåŽŸå§‹ç¼“å†²å¹¶æ²¡æœ‰å…±äº«æ•°æ®assert buf.get(0) != copy.get(0); APIåŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡ä¸åŒçš„æ–¹å¼æ´¾ç”Ÿçš„ByteBufï¼Œå†…éƒ¨ä¹Ÿä¼šæœ‰ç»†å¾®å·®åˆ«ä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨åˆ‡ç‰‡ï¼Œé™¤éžå¿…é¡»ä¸å…±äº«æ•°æ®æ‰ä½¿ç”¨å¤åˆ¶æ–¹å¼ã€‚å› ä¸ºå¤åˆ¶ByteBuféœ€è¦è¿›è¡Œå†…å­˜å¤åˆ¶æ“ä½œï¼Œä¸ä»…æ¶ˆè€—æ›´å¤šèµ„æºï¼Œæ‰§è¡Œæ–¹æ³•ä¹Ÿä¼šæ›´è€—æ—¶ã€‚ 3.6ã€è¯»å†™æ“ä½œByteBufçš„è¯»å†™æ“ä½œå…±æœ‰ä¸¤å¤§ç±»ï¼šåŸºäºŽç´¢å¼•çš„ï¼ŒæŒ‡å®šç´¢å¼•è¯»å†™ç›¸åº”ä½ç½®çš„æ•°æ®ä»Žå½“å‰ç´¢å¼•è¯»å†™æ•°æ®ï¼Œç„¶åŽå¢žé•¿è¯»å†™ç´¢å¼•å…ˆæ¥çœ‹ä¸€ä¸‹è¿™äº›æ–¹æ³•ï¼Œä¸‹é¢åˆ—å‡ºæ¥çš„éƒ½æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•ï¼Œå¦‚æžœæƒ³çœ‹å…¶ä»–æ–¹æ³•ï¼Œè¯·å‚è€ƒAPI DOCã€‚å…ˆçœ‹ä¸€ä¸‹è¯»æ“ä½œçš„ã€‚ åç§°æè¿°getBoolean(int) èŽ·å–æŒ‡å®šä½ç½®çš„Booleanç±»åž‹æ•°æ®getByte(int) èŽ·å–æŒ‡å®šä½ç½®çš„å­—èŠ‚å†…å®¹getUnsignedByte(int) èŽ·å–æŒ‡å®šä½ç½®çš„æ— ç¬¦å·å­—èŠ‚å†…å®¹getMedium(int) èŽ·å–æŒ‡å®šä½ç½®çš„24ä½æ•´æ•°å†…å®¹getUnsignedMedium(int) èŽ·å–æŒ‡å®šä½ç½®çš„æ— ç¬¦å·24ä½æ•´æ•°å†…å®¹getInt(int) èŽ·å–æŒ‡å®šä½ç½®çš„Intç±»åž‹å†…å®¹getUnsignedInt(int) èŽ·å–æŒ‡å®šä½ç½®çš„æ— ç¬¦å·Intç±»åž‹å†…å®¹getLong(int) èŽ·å–æŒ‡å®šä½ç½®çš„Longç±»åž‹å†…å®¹getUnsignedLong(int) èŽ·å–æŒ‡å®šä½ç½®çš„æ— ç¬¦å·Longç±»åž‹å†…å®¹getShort(int) èŽ·å–æŒ‡å®šä½ç½®çš„Shortç±»åž‹å†…å®¹getUnsignedShort(int) èŽ·å–æŒ‡å®šä½ç½®çš„æ— ç¬¦å·Shortç±»åž‹å†…å®¹getBytes(int, â€¦) ä»Žç»™å®šä½ç½®å¼€å§‹å°†æ•°æ®è½¬æ¢åˆ°ç›®æ ‡å®¹å™¨ä¸­åç§°æè¿°setBoolean(int, boolean) è®¾ç½®æŒ‡å®šä½ç½®çš„Booleanç±»ä¼¼æ•°æ®setByte(int, int) è®¾ç½®æŒ‡å®šä½ç½®å­—èŠ‚æ•°æ®setMedium(int, int) è®¾ç½®æŒ‡å®šä½ç½®24ä½æ•´æ•°æ•°æ®setInt(int, int) è®¾ç½®æŒ‡å®šä½ç½®Intç±»åž‹æ•°æ®setLong(int, long) è®¾ç½®æŒ‡å®šä½ç½®Longç±»åž‹æ•°æ®setShort(int, int) è®¾ç½®æŒ‡å®šä½ç½®Shortç±»åž‹æ•°æ®setBytes(int,â€¦) ä»ŽæŒ‡å®šä½ç½®å°†æºæ•°æ®å®¹å™¨ä¸­è½¬æ¢è¿‡æ¥å®ƒçš„setæ“ä½œå’Œgetæ“ä½œéƒ½å¾ˆç±»ä¼¼ï¼Œè¯·çœ‹ä¸‹é¢çš„è¡¨æ ¼ã€‚ä½ å¯èƒ½ä¼šå‘çŽ°setæ–¹æ³•æ²¡æœ‰æ— ç¬¦å·ç±»åž‹çš„ã€‚è¿™æ˜¯å› ä¸ºåœ¨è®¾ç½®æ•°æ®çš„æ—¶å€™æ²¡æœ‰æ— ç¬¦å·çš„æ¦‚å¿µã€‚ä¸Šé¢å·²ç»ä»‹ç»äº†ç›¸å…³çš„æ–¹æ³•ï¼ŒçŽ°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ€Žä¹ˆåœ¨å®žé™…ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬ã€‚Charset utf8 = Charset.forName(â€œUTF-8â€);//æ ¹æ®å­—ç¬¦ä¸²åˆ›å»ºByteBufByteBuf buf = Unpooled.copiedBuffer(â€œNetty in Action rocks!â€, utf8);//æ‰“å°ä½ç½®0çš„å­—ç¬¦ï¼Œæ­£å¸¸è¾“å‡ºâ€™Nâ€™System.out.println((char) buf.getByte(0));//æŸ¥è¯¢çŽ°åœ¨çš„è¯»å†™ç´¢å¼•åç§°æè¿°readBoolean() è¯»å–å½“å‰è¯»ç´¢å¼•Booleanæ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readByte() è¯»å–å½“å‰è¯»ç´¢å¼•Byteæ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readUnsignedByte() è¯»å–å½“å‰è¯»ç´¢å¼•æ— ç¬¦å·Byteæ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readMedium() è¯»å–å½“å‰è¯»ç´¢å¼•24ä½æ•´æ•°æ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readUnsignedMedium() è¯»å–å½“å‰è¯»ç´¢å¼•æ— ç¬¦å·24ä½æ•´æ•°æ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readInt() è¯»å–å½“å‰è¯»ç´¢å¼•Intç±»åž‹æ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readUnsignedInt() è¯»å–å½“å‰è¯»ç´¢å¼•æ— ç¬¦å·Intç±»åž‹æ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readLong() è¯»å–å½“å‰è¯»ç´¢å¼•Longç±»åž‹æ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readUnsignedLong() è¯»å–å½“å‰è¯»ç´¢å¼•æ— ç¬¦å·Longç±»åž‹æ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readShort() è¯»å–å½“å‰è¯»ç´¢å¼•Shortç±»åž‹æ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readUnsignedShort() è¯»å–å½“å‰è¯»ç´¢å¼•æ— ç¬¦å·Shortç±»åž‹æ•°æ®ï¼ŒåŒæ—¶è¯»ç´¢å¼•ä¼šåŠ 1readBytes(int) ä»Žå½“å‰è¯»ç´¢å¼•è¯»å–æŒ‡å®šé•¿åº¦çš„å­—èŠ‚å†…å®¹ï¼Œè¯»ç´¢å¼•ä¹Ÿä¼šå¢žåŠ æŒ‡å®šé•¿åº¦æŽ¥ä¸‹æ¥ä»‹ç»åˆ°çš„è¯»å†™æ“ä½œå°±æ˜¯readå’Œwriteå¼€å¤´çš„æ–¹æ³•ï¼Œå‰é¢è¯´è¿‡ï¼Œè¿™äº›æ–¹æ³•ä¹Ÿä¼šå½±å“åˆ°ç¼“å†²çš„è¯»å†™ç´¢å¼•ã€‚è¿™é‡Œé¢ç”¨åˆ°æœ€å¤šçš„æ–¹æ³•å°±æ˜¯æŠŠByteBufå½“æˆä¸€ä¸ªæµæ¥è¯»å–æ•°æ®ã€‚åŒæ ·ï¼Œwriteæ–¹æ³•ç›¸å½“äºŽåœ¨ByteBufä¸Šè¿½åŠ æ•°æ®ã€‚å¸¸ç”¨çš„readæ–¹æ³•å¦‚ä¸‹è¡¨æ ¼ã€‚å®ƒçš„writeæ–¹æ³•åŸºæœ¬ä¸Šå’Œreadæ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚int readerIndex = buf.readerIndex();int writerIndex = buf.writerIndex();//ä¿®æ”¹ä½ç½®0çš„æ•°æ®buf.setByte(0, (byte)â€Bâ€);//å†æ¬¡æ‰“å°ä½ç½®0çš„æ•°æ®ï¼Œè¿™æ¬¡åº”è¯¥æ˜¯â€™Bâ€™System.out.println((char) buf.getByte(0));//setæˆ–getæ–¹æ³•ä¸ä¼šæ”¹å˜è¯»å†™ç´¢å¼•assert readerIndex = buf.readerIndex();assert writerIndex = buf.writerIndex();åç§°æè¿°writeBoolean(boolean) åœ¨å½“å‰å†™ç´¢å¼•ä½ç½®å†™å…¥Booleanç±»åž‹æ•°æ®ï¼ŒåŒæ—¶å†™ç´¢å¼•åŠ 1writeByte(int) å½“å‰å†™ç´¢å¼•å†™å…¥Byteç±»åž‹æ•°æ®ï¼ŒåŒæ—¶å†™ç´¢å¼•åŠ 1writeMedium(int) å½“å‰å†™ç´¢å¼•å†™å…¥24ä½æ•´æ•°æ•°æ®ï¼ŒåŒæ—¶å†™ç´¢å¼•ä¼šåŠ 3ï¼Œ24ä½=3å­—èŠ‚writeInt(int) åœ¨å½“å‰å†™ç´¢å¼•å†™å…¥32ä½æ•´æ•°æ•°æ®ï¼ŒåŒæ—¶å†™ç´¢å¼•åŠ 4ï¼Œ32ä½=4å­—èŠ‚writeLong(long) å½“å‰å†™ç´¢å¼•å†™å…¥64ä½æ•´æ•°æ•°æ®ï¼ŒåŒæ—¶å†™ç´¢å¼•åŠ 8ï¼Œ64ä½=8å­—èŠ‚writeShort(int) å½“å‰å†™ç´¢å¼•å†™å…¥Shortç±»åž‹æ•°æ®ï¼ŒåŒæ—¶å†™ç´¢å¼•åŠ 2writeBytes(ByteBuf src, intlength)ä»Žæºæ•°æ®ä¸­è½¬æ¢æŒ‡å®šé•¿åº¦æ•°æ®åˆ°å½“å‰å†™ç´¢å¼•ï¼ŒåŒæ—¶å†™ç´¢å¼•å¢žåŠ ç›¸åº”æ•°é‡çŽ°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ä¸Šé¢è¿™äº›readå’Œwriteæ–¹æ³•åœ¨å®žé™…é¡¹ç›®ä¸­çš„åº”ç”¨ã€‚ä¸€ç›´å¿˜è®°äº†è¯´ä¸€ä»¶äº‹ï¼ŒèŽ·å–å½“å‰è¯»å†™ç´¢å¼•çš„æ–¹æ³•æ˜¯ä¸ä¼šä¿®æ”¹è¯»å†™ç´¢å¼•ã€‚ä¸Šé¢å·²ç»ä»‹ç»äº†å¾ˆå¤šè¯»å†™æ•°æ®çš„æ–¹æ³•ï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–å¾ˆæœ‰ç”¨çš„æ–¹æ³•ï¼Œä¸‹é¢ä¼šä»‹ç»è¿™äº›æ–¹æ³•ã€‚3.11ã€å…¶ä»–å¸¸ç”¨æ–¹æ³•è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•æˆ‘ä»¬æ²¡æœ‰ä»‹ç»åˆ°ï¼Œä¸‹è¡¨åˆ—å‡ºæ¥è¿™äº›å¸¸ç”¨æ–¹æ³•ï¼Œå¹¶ç®€è¦ä»‹ç»å®ƒä»¬çš„ç”¨æ³•ã€‚Charset utf8 = Charset.forName(â€œUTF-8â€);//æ ¹æ®å­—ç¬¦ä¸²åˆ›å»ºByteBufByteBuf buf = Unpooled.copiedBuffer(â€œxxxâ€, utf8);//æ‰“å°é¦–ä½ç½®å­—ç¬¦ï¼Œæ­£å¸¸æ˜¯â€™xâ€™System.out.println((char) buf.readByte());//èŽ·å–å½“å‰çš„è¯»å†™ç´¢å¼•int readerIndex = buf.readerIndex();int writerIndex = buf.writerIndex();//ä¿®æ”¹å†™ç´¢å¼•0ä½ç½®çš„æ•°æ®buf.writeByte( (byte) â€˜?â€™);//å†™æ•°æ®è¯»ç´¢å¼•ä¸ä¼šå˜åŒ–ï¼Œå†™ç´¢å¼•ä¼šåŠ 1assert readerIndex = buf.readerIndex();assert writerIndex != buf.writerIndex();åç§°æè¿°isReadable() æœ‰ä¸€ä¸ªå­—èŠ‚å¯è¯»å°±ä¼šè¿”å›žtrueisWritable() æœ‰ä¸€ä¸ªå¯å†™å­—èŠ‚ç©ºé—´å°±ä¼šè¿”å›žtruereadableBytes() è¿”å›žå¯è¯»å­—èŠ‚å†…å®¹æ€»æ•°writablesBytes() è¿”å›žå¯å†™å†…å®¹åŒºåŸŸæ€»æ•°capacity()è¿”å›žç¼“å†²åŒºç›®å‰å®¹é‡ï¼Œå¦‚æžœè¶…è¿‡è¿™ä¸ªæ•°å€¼ï¼Œç¼“å†²åŒºä¼šæ‰©å®¹ï¼Œ åªåˆ°è¾¾åˆ°maxCapacity()çš„é™åˆ¶maxCapacity() è¿”å›žç¼“å†²åŒºæœ€å¤§å®¹é‡hasArray() å¦‚æžœç¼“å†²åŒºå†…éƒ¨ä»¥æ•°ç»„å­˜å‚¨è¿”å›žtruearray() è¿”å›žå†…éƒ¨å­˜å‚¨çš„æ•°ç»„ï¼Œå¦‚æžœæ²¡æœ‰æ•°ç»„åˆ™ æŠ›å‡ºUnsupportedOperationExceptionåç§°æè¿°content() è¿”å›žå®ƒå­˜å‚¨çš„å†…å®¹çš„ByteBufcopy() è¿”å›žä¸€ä¸ªæ·±æ‹·è´çš„ByteBufHolderï¼Œä¹Ÿå°±æ˜¯ä»–ä»¬çš„æ•°æ®ä¸å…±äº«å‰é¢ä»‹ç»çš„éƒ½æ˜¯JavaåŸºç¡€ç±»åž‹ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç½‘ç»œåº”ç”¨éœ€è¦å¤„ç†æ™®é€šJavaå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯Java Beanã€‚éœ€è¦å­˜å‚¨å’Œæ£€æŸ¥ï¼Œè€Œä¸”åœ¨å®¹å™¨ä¸­æŒ‰ç…§é¡ºåºå­˜å‚¨ä¹Ÿå¾ˆé‡è¦ã€‚å› æ­¤ï¼ŒNettyæä¾›äº†å¦ä¸€ä¸ªæ•°æ®å®¹å™¨MessageBufã€‚ å››ã€ByteBufHolderä½ æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢å¾ˆå¤šå±žæ€§ï¼Œä½†æ˜¯éƒ½æ˜¯é€šè¿‡å­—èŠ‚åŽ»ä¼ è¾“çš„ã€‚ä¾‹å¦‚ï¼ŒHTTPåè®®ä¸­çš„ç›¸åº”æ•°æ®å°±å¾ˆç¬¦åˆè¿™ç§æƒ…å†µã€‚HTTPå“åº”æ•°æ®æœ‰å¾ˆå¤šå±žæ€§ï¼Œå¦‚æžœçŠ¶æ€ç ï¼ŒCookieç­‰ç­‰ï¼Œè€Œä¸”å®ƒå®žé™…çš„å†…å®¹éƒ½æ˜¯ä»¥å­—èŠ‚æ–¹å¼ä¼ è¾“çš„ã€‚å› ä¸ºè¿™ç§æƒ…å†µå¾ˆæ™®éï¼Œæ‰€ä»¥NettyæŠ½è±¡äº†ä¸€ä¸ªæŽ¥å£ByteBufHolderã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯Nettyå¯ä»¥ä¼˜åŒ–åˆ†é…ByteBufï¼Œä¾‹å¦‚ä½¿ç”¨æ± æŠ€æœ¯ï¼Œä¹Ÿèƒ½å¤Ÿè‡ªåŠ¨é‡Šæ”¾è¿™éƒ¨åˆ†èµ„æºã€‚ByteBufHolderå®žé™…ä¸Šæ¯”è¾ƒæœ‰ç”¨çš„æ–¹æ³•å°±æ˜¯è®¿é—®å®ƒé‡Œé¢å­˜å‚¨çš„æ•°æ®ä»¥åŠä½¿ç”¨å¼•ç”¨è®¡æ•°åŠŸèƒ½ã€‚ä¸‹è¡¨å±•ç¤ºäº†å®ƒå¸¸ç”¨çš„æ–¹æ³•ã€‚å¦‚æžœä½ ä¼ è¾“çš„æ•°æ®å­˜å‚¨çš„æ˜¯ByteBufï¼Œé‚£ä¹ˆä½¿ç”¨ByteBufHolderæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ 4.1ã€Nettyç¼“å†²åŒºå¸®åŠ©ç±»ä½¿ç”¨JDKçš„NIO APIçš„ä¸€ä¸ªå›°éš¾æ˜¯å®Œæˆä¸€ä¸ªç®€å•çš„ä»»åŠ¡æœ‰å¾ˆå¤šé‡å¤æ€§çš„ä»£ç ã€‚è™½ç„¶Nettyæä¾›çš„ç¼“å†²åŒºAPIå·²ç»å¾ˆå®¹æ˜“ä½¿ç”¨äº†ï¼Œä½†æ˜¯Nettyè¿˜æ˜¯æä¾›äº†å¾ˆå¤šå·¥å…·ç±»æ–¹ä¾¿å¼€å‘è€…åˆ›å»ºæˆ–ä½¿ç”¨ç¼“å†²åŒºã€‚åç§°æè¿°buffer() åˆ›å»ºByteBufï¼Œç±»ä¼¼å¯èƒ½æ˜¯å †æˆ–ç›´æŽ¥çš„ï¼Œä¾èµ–å…·ä½“çš„å®žçŽ°buffer(int)buffer(int, int)heapBuffer() åˆ›å»ºå †ç±»åž‹ByteBufheapBuffer(int)heapBuffer(int, int)directBuffer() åˆ›å»ºç›´æŽ¥ç±»åž‹ByteBufdirectBuffer(int)directBuffer(int, int)compositeBuffer() åˆ›å»ºå¤åˆç±»åž‹ç¼“å†²åŒºcompositeBuffer(int)heapCompositeBuffer() å†…éƒ¨ä¸ºå †ç±»åž‹ByteBufçš„å¤åˆç¼“å†²åŒºheapCompositeBuffer(int)directCompositeBuffer() å†…éƒ¨ä¸ºç›´æŽ¥ç±»åž‹ByteBufçš„å¤åˆç¼“å†²åŒºdirectCompositeBuffer(int)ioBuffer() åˆ›å»ºç”¨äºŽIOæ“ä½œçš„ByteBuf 4.2ã€ByteBufAllocatorå‰é¢æåˆ°è¿‡ï¼ŒNettyæä¾›äº†æ± æŠ€æœ¯ä¼˜åŒ–äº†å„ç§ByteBufã€‚ä¸ºäº†å®žçŽ°è¿™ä¸ªåŠŸèƒ½NettyæŠ½è±¡äº†ä¸€ä¸ªByteBufAllocatoræŽ¥å£ã€‚å®ƒä¸»è¦æ˜¯ç”¨æ¥åˆ†é…ByteBufå®žä¾‹çš„ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ByteBufAllocatoræä¾›äº†å“ªäº›æ“ä½œã€‚æœ‰äº›æ–¹æ³•åŽé¢å¸¦äº†ä¸€ä¸ªæˆ–ä¸¤ä¸ªIntç±»åž‹å‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å°±æ˜¯æŒ‡å®šByteBufçš„åˆå§‹å®¹é‡å’Œæœ€å¤§å®¹é‡çš„ã€‚ä½ åº”è¯¥è®°å¾—ByteBufæ˜¯å¯ä»¥æ‰©å®¹çš„ã€‚ByteBufå¯ä»¥ä¸æ–­æ‰©å®¹åªåˆ°è¾¾åˆ°äº†æœ€å¤§å®¹é‡ã€‚èŽ·å–ByteBufAllocatorçš„å¼•ç”¨ä¹Ÿæ˜¯å¾ˆå®¹æ˜“çš„äº‹æƒ…ã€‚é€šè¿‡Channelæˆ–è€…ä½ å®žçŽ°çš„ChannelHandlerçš„æ–¹æ³•ä¸­çš„ChannelHandlerContextã€‚æ›´å¤šå…³äºŽChannelHandlerContextå’ŒChannelHandlerçš„çŸ¥è¯†å°†ä¼šåœ¨ç¬¬å…­ç« ä»‹ç»ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†èŽ·å–ByteBufAllocatorçš„æ–¹å¼ã€‚åç§°æè¿°buffer() åˆ›å»ºæœªä½¿ç”¨æ± æŠ€æœ¯çš„å †ç¼“å†²ByteBufbuffer(int)buffer(int, int)directBuffer() åˆ›å»ºæœªä½¿ç”¨æ± æŠ€æœ¯çš„ç›´æŽ¥ç¼“å†²ByteBufdirectBuffer(int)directBuffer(int, int)wrappedBuffer() åˆ›å»ºåŒ…å«ç»™å®šæ•°æ®çš„ByteBufcopiedBuffer() å¤åˆ¶ç»™å®šæ•°æ®ç„¶åŽåˆ›å»ºByteBuf 4.3ã€Unpooledæœ‰æ—¶å€™ä½ æ²¡åŠžæ³•èŽ·å–ByteBufAllocatorçš„å®žä¾‹ï¼Œä¹Ÿå°±æ˜¯æ²¡åŠžæ³•ä½¿ç”¨ä¸Šä¸€èŠ‚ä»‹ç»çš„æ–¹å¼åˆ›å»ºByteBufå®žä¾‹ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒNettyæä¾›äº†ä¸€ä¸ªå·¥å…·ç±»Unpooledã€‚è¿™ä¸ªå·¥å…·ç±»æä¾›äº†å¾ˆå¤šé™æ€æ–¹æ³•å¸®åŠ©æˆ‘ä»¬åˆ›å»ºByteBufå®žä¾‹ï¼Œä¸è¿‡æ²¡æœ‰ä½¿ç”¨æ± æŠ€æœ¯ã€‚ å…ˆæ¥çœ‹çœ‹å®ƒæä¾›äº†å“ªäº›å¸¸ç”¨æ–¹æ³•ç»™æˆ‘ä»¬ä½¿ç”¨ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨éžNettyé¡¹ç›®ä¸­ä½¿ç”¨Unpooledï¼Œå› ä¸ºå®ƒçš„APIå¾ˆç®€å•ï¼Œæ€§èƒ½ä¹Ÿå¾ˆé«˜ï¼Œé¡¹ç›®ä¸­å¦‚æžœéœ€è¦è¿™ç§é«˜æ€§èƒ½ç¼“å†²åŒºçš„åœ°æ–¹å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚ 4.4ã€ByteBufUtilå¦ä¸€ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„ç±»æ˜¯ByteBufUtilã€‚è¿™ä¸ªç±»æä¾›äº†å¾ˆå¤šé™æ€æ–¹æ³•ç›´æŽ¥æ“ä½œByteBufã€‚ç›¸æ¯”è¾ƒä¸Šé¢çš„Unpooledï¼Œè¿™ä¸ªç±»æä¾›çš„æ–¹æ³•æ˜¯æ¯”è¾ƒé€šç”¨çš„å¹¶ä¸”ä¸ç”¨å…³å¿ƒä½ çš„ByteBufæ˜¯ä½¿ç”¨äº†æ± æŠ€æœ¯çš„è¿˜æ˜¯æ²¡æœ‰ä½¿ç”¨ã€‚ ä¾‹å¦‚å®ƒæœ€å¸¸ç”¨çš„æ–¹æ³•hexdump()ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›žByteBufå†…å®¹çš„åå…­è¿›åˆ¶æ ¼å¼ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥ä½¿ç”¨åœ¨å¾ˆå¤šåœºæ™¯ï¼Œä¾‹å¦‚æ—¥å¿—åœºæ™¯ã€‚åå…­è¿›åˆ¶æ ¼å¼çš„å†…å®¹ä¹Ÿå¾ˆå®¹æ˜“è½¬æˆå­—èŠ‚è¡¨ç¤ºã€‚ä½ ä¹Ÿè®¸å¥‡æ€ªä¸ºä»€ä¹ˆä¸ç›´æŽ¥æ˜¾ç¤ºå­—èŠ‚å†…å®¹ã€‚ä¸»è¦æ˜¯å› ä¸ºå­—èŠ‚å†…å®¹äººç±»éš¾ä»¥é˜…è¯»ï¼Œè€Œ16è¿›åˆ¶å°±æ¯”è¾ƒå‹å¥½äº†ã€‚ è¿™ä¸ªç±»æä¾›äº†å¾ˆå¤šByteBufç›¸å…³çš„é™æ€æ–¹æ³•ï¼Œä¾‹å¦‚å¤åˆ¶ã€ç¼–ç ã€è§£ç ç­‰ç­‰ï¼Œè¿™ä¸ªå¤§å®¶åœ¨ä»¥åŽå¼€å‘ä¸­ä¼šæ…¢æ…¢ç”¨åˆ°ï¼Œç”šè‡³å½“ä½ éœ€è¦å®žçŽ°è‡ªå·±çš„ByteBufçš„æ—¶å€™ä¹Ÿä¼šç”¨åˆ°å®ƒä»¬ã€‚ äº”ã€æ€»ç»“æˆ‘ä»¬è¿˜å­¦ä¹ äº†Nettyçš„æ•°æ®å®¹å™¨æœ‰å“ªäº›ç±»åž‹çš„å®žçŽ°ï¼Œå·²ç»å„è‡ªçš„ä½¿ç”¨åœºæ™¯å’Œæ€§èƒ½é«˜ä½Žï¼Œè¿˜æœ‰åˆ†é…æˆ–é‡Šæ”¾éœ€è¦çš„èµ„æºä»£ä»·ã€‚Channel channel = â€¦;ByteBufAllocator allocator = channel.alloc();â€¦.ChannelHandlerContext ctx = â€¦;ByteBufAllocator allocator2 = ctx.alloc();]]></content>
      <categories>
        <category>Netty</category>
      </categories>
      <tags>
        <tag>Netty</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DESã€AESã€RSAç­‰å¸¸ç”¨åŠ å¯†ç®—æ³•ä»‹ç»ä¸Žæ¯”è¾ƒ]]></title>
    <url>%2F2019%2F03%2F04%2FDES%E3%80%81AES%E3%80%81RSA%E7%AD%89%E5%B8%B8%E7%94%A8%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E4%BB%8B%E7%BB%8D%E4%B8%8E%E6%AF%94%E8%BE%83%2F</url>
    <content type="text"><![CDATA[åŠ å¯†ç®—æ³•åˆ†å¯¹ç§°åŠ å¯†å’Œéžå¯¹ç§°ç®—æ³•ï¼Œå…¶ä¸­å¯¹ç§°åŠ å¯†ç®—æ³•çš„åŠ å¯†ä¸Žè§£å¯†å¯†é’¥ç›¸åŒï¼Œéžå¯¹ç§°åŠ å¯†ç®—æ³•çš„åŠ å¯†å¯†é’¥ä¸Žè§£å¯†å¯†é’¥ä¸åŒï¼Œæ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç±»ä¸éœ€è¦å¯†é’¥çš„æ•£åˆ—ç®—æ³•ã€‚ â€‹ å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•ä¸»è¦æœ‰DESã€3DESã€AESç­‰ï¼Œå¸¸è§çš„éžå¯¹ç§°ç®—æ³•ä¸»è¦æœ‰RSAã€DSAç­‰ï¼Œæ•£åˆ—ç®—æ³•ä¸»è¦æœ‰SHA-1ã€MD5ç­‰ã€‚ éžå¯¹ç§°ç®—æ³•éžå¯¹ç§°åŠ å¯†ç®—æ³•çš„åŠ å¯†å¯†é’¥ä¸Žè§£å¯†å¯†é’¥ä¸åŒ éžå¯¹ç§°åŠ å¯†ï¼Œå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œåä¹‹äº¦ç„¶ã€‚ç”±äºŽéœ€è¦å¤§æ•°çš„ä¹˜å¹‚æ±‚æ¨¡ç­‰ç®—æ³•ï¼Œè¿è¡Œé€Ÿåº¦æ…¢ï¼Œä¸æ˜“äºŽç¡¬ä»¶å®žçŽ°ã€‚ é€šå¸¸ç§é’¥é•¿åº¦æœ‰512bitï¼Œ1024bitï¼Œ2048bitï¼Œ4096bitï¼Œé•¿åº¦è¶Šé•¿ï¼Œè¶Šå®‰å…¨ï¼Œä½†æ˜¯ç”Ÿæˆå¯†é’¥è¶Šæ…¢ï¼ŒåŠ è§£å¯†ä¹Ÿè¶Šè€—æ—¶ã€‚ æ—¢ç„¶æ˜¯åŠ å¯†ï¼Œé‚£è‚¯å®šæ˜¯ä¸å¸Œæœ›åˆ«äººçŸ¥é“æˆ‘çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥åªæœ‰æˆ‘æ‰èƒ½è§£å¯†ï¼Œæ‰€ä»¥å¯å¾—å‡ºå…¬é’¥è´Ÿè´£åŠ å¯†ï¼Œç§é’¥è´Ÿè´£è§£å¯†ï¼› åŒç†ï¼Œæ—¢ç„¶æ˜¯ç­¾åï¼Œé‚£è‚¯å®šæ˜¯ä¸å¸Œæœ›æœ‰äººå†’å……æˆ‘å‘æ¶ˆæ¯ï¼Œåªæœ‰æˆ‘æ‰èƒ½å‘å¸ƒè¿™ä¸ªç­¾åï¼Œæ‰€ä»¥å¯å¾—å‡ºç§é’¥è´Ÿè´£ç­¾åï¼Œå…¬é’¥è´Ÿè´£éªŒè¯ã€‚ éžå¯¹ç§°å¼åŠ å¯†å°±æ˜¯åŠ å¯†å’Œè§£å¯†æ‰€ä½¿ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªå¯†é’¥ï¼Œé€šå¸¸æœ‰ä¸¤ä¸ªå¯†é’¥ï¼Œç§°ä¸ºâ€å…¬é’¥â€å’Œâ€ç§é’¥â€ï¼Œå®ƒä»¬ä¸¤ä¸ªå¿…éœ€é…å¯¹ä½¿ç”¨ï¼Œå¦åˆ™ä¸èƒ½æ‰“å¼€åŠ å¯†æ–‡ä»¶ã€‚å‘é€åŒæ–¹A,Bäº‹å…ˆå‡ç”Ÿæˆä¸€å †å¯†åŒ™ï¼Œç„¶åŽAå°†è‡ªå·±çš„å…¬æœ‰å¯†åŒ™å‘é€ç»™Bï¼ŒBå°†è‡ªå·±çš„å…¬æœ‰å¯†åŒ™å‘é€ç»™Aï¼Œå¦‚æžœAè¦ç»™Bå‘é€æ¶ˆ æ¯ï¼Œåˆ™å…ˆéœ€è¦ç”¨Bçš„å…¬æœ‰å¯†åŒ™è¿›è¡Œæ¶ˆæ¯åŠ å¯†ï¼Œç„¶åŽå‘é€ç»™Bç«¯ï¼Œæ­¤æ—¶Bç«¯å†ç”¨è‡ªå·±çš„ç§æœ‰å¯†åŒ™è¿›è¡Œæ¶ˆæ¯è§£å¯†ï¼ŒBå‘Aå‘é€æ¶ˆæ¯æ—¶ä¸ºåŒæ ·çš„é“ç†ã€‚ RSAéžå¯¹ç§°åŠ å¯†ï¼Œå…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œåä¹‹äº¦ç„¶ã€‚ç”±äºŽéœ€è¦å¤§æ•°çš„ä¹˜å¹‚æ±‚æ¨¡ç­‰ç®—æ³•ï¼Œè¿è¡Œé€Ÿåº¦æ…¢ï¼Œä¸æ˜“äºŽç¡¬ä»¶å®žçŽ°ã€‚ é€šå¸¸ç§é’¥é•¿åº¦æœ‰512bitï¼Œ1024bitï¼Œ2048bitï¼Œ4096bitï¼Œé•¿åº¦è¶Šé•¿ï¼Œè¶Šå®‰å…¨ï¼Œä½†æ˜¯ç”Ÿæˆå¯†é’¥è¶Šæ…¢ï¼ŒåŠ è§£å¯†ä¹Ÿè¶Šè€—æ—¶ã€‚ æ—¢ç„¶æ˜¯åŠ å¯†ï¼Œé‚£è‚¯å®šæ˜¯ä¸å¸Œæœ›åˆ«äººçŸ¥é“æˆ‘çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥åªæœ‰æˆ‘æ‰èƒ½è§£å¯†ï¼Œæ‰€ä»¥å¯å¾—å‡ºå…¬é’¥è´Ÿè´£åŠ å¯†ï¼Œç§é’¥è´Ÿè´£è§£å¯†ï¼› åŒç†ï¼Œæ—¢ç„¶æ˜¯ç­¾åï¼Œé‚£è‚¯å®šæ˜¯ä¸å¸Œæœ›æœ‰äººå†’å……æˆ‘å‘æ¶ˆæ¯ï¼Œåªæœ‰æˆ‘æ‰èƒ½å‘å¸ƒè¿™ä¸ªç­¾åï¼Œæ‰€ä»¥å¯å¾—å‡ºç§é’¥è´Ÿè´£ç­¾åï¼Œå…¬é’¥è´Ÿè´£éªŒè¯ã€‚ DSADSAï¼ˆDigital Signature Algorithmï¼‰ï¼šæ•°å­—ç­¾åç®—æ³•ï¼Œæ˜¯ä¸€ç§æ ‡å‡†çš„ DSSï¼ˆæ•°å­—ç­¾åæ ‡å‡†ï¼‰ï¼Œä¸¥æ ¼æ¥è¯´ä¸ç®—åŠ å¯†ç®—æ³•ã€‚ ECCECCï¼ˆElliptic Curves Cryptographyï¼‰ï¼šæ¤­åœ†æ›²çº¿å¯†ç ç¼–ç å­¦ã€‚ECCå’ŒRSAç›¸æ¯”ï¼Œå…·æœ‰å¤šæ–¹é¢çš„ç»å¯¹ä¼˜åŠ¿ï¼Œä¸»è¦æœ‰ï¼šæŠ—æ”»å‡»æ€§å¼ºã€‚ç›¸åŒçš„å¯†é’¥é•¿åº¦ï¼Œå…¶æŠ—æ”»å‡»æ€§è¦å¼ºå¾ˆå¤šå€ã€‚è®¡ç®—é‡å°ï¼Œå¤„ç†é€Ÿåº¦å¿«ã€‚ECCæ€»çš„é€Ÿåº¦æ¯”RSAã€DSAè¦å¿«å¾—å¤šã€‚å­˜å‚¨ç©ºé—´å ç”¨å°ã€‚ECCçš„å¯†é’¥å°ºå¯¸å’Œç³»ç»Ÿå‚æ•°ä¸ŽRSAã€DSAç›¸æ¯”è¦å°å¾—å¤šï¼Œæ„å‘³ç€å®ƒæ‰€å çš„å­˜è´®ç©ºé—´è¦å°å¾—å¤šã€‚è¿™å¯¹äºŽåŠ å¯†ç®—æ³•åœ¨ICå¡ä¸Šçš„åº”ç”¨å…·æœ‰ç‰¹åˆ«é‡è¦çš„æ„ä¹‰ã€‚å¸¦å®½è¦æ±‚ä½Žã€‚å½“å¯¹é•¿æ¶ˆæ¯è¿›è¡ŒåŠ è§£å¯†æ—¶ï¼Œä¸‰ç±»å¯†ç ç³»ç»Ÿæœ‰ç›¸åŒçš„å¸¦å®½è¦æ±‚ï¼Œä½†åº”ç”¨äºŽçŸ­æ¶ˆæ¯æ—¶ECCå¸¦å®½è¦æ±‚å´ä½Žå¾—å¤šã€‚å¸¦å®½è¦æ±‚ä½Žä½¿ECCåœ¨æ— çº¿ç½‘ç»œé¢†åŸŸå…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚ å¯¹ç§°åŠ å¯†ç®—æ³•å¯¹ç§°å¼åŠ å¯†å°±æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ã€‚ä¿¡æ¯æŽ¥æ”¶åŒæ–¹éƒ½éœ€äº‹å…ˆçŸ¥é“å¯†åŒ™å’ŒåŠ è§£å¯†ç®—æ³•ä¸”å…¶å¯†åŒ™æ˜¯ç›¸åŒçš„ï¼Œä¹‹åŽä¾¿æ˜¯å¯¹æ•°æ®è¿›è¡ŒåŠ è§£å¯†äº†ã€‚å¯¹ç§°åŠ å¯†ç®—æ³•ç”¨æ¥å¯¹æ•æ„Ÿæ•°æ®ç­‰ä¿¡æ¯è¿›è¡ŒåŠ å¯†ã€‚ å¯¹ç§°åŠ å¯†ç®—æ³•çš„åŠ å¯†ä¸Žè§£å¯†å¯†é’¥ç›¸åŒ AESAESï¼ˆAdvanced Encryption Standardï¼‰ï¼šé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œæ˜¯ä¸‹ä¸€ä»£çš„åŠ å¯†ç®—æ³•æ ‡å‡†ï¼Œé€Ÿåº¦å¿«ï¼Œå®‰å…¨çº§åˆ«é«˜ï¼›AESæ˜¯ä¸€ä¸ªä½¿ç”¨128ä¸ºåˆ†ç»„å—çš„åˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œåˆ†ç»„å—å’Œ128ã€192æˆ–256ä½çš„å¯†é’¥ä¸€èµ·ä½œä¸ºè¾“å…¥ï¼Œå¯¹4Ã—4çš„å­—èŠ‚æ•°ç»„ä¸Šè¿›è¡Œæ“ä½œã€‚ä¼—æ‰€å‘¨ä¹‹AESæ˜¯ç§ååˆ†é«˜æ•ˆçš„ç®—æ³•ï¼Œå°¤å…¶åœ¨8ä½æž¶æž„ä¸­ï¼Œè¿™æºäºŽå®ƒé¢å‘å­—èŠ‚çš„è®¾è®¡ã€‚AES é€‚ç”¨äºŽ8ä½çš„å°åž‹å•ç‰‡æœºæˆ–è€…æ™®é€šçš„32ä½å¾®å¤„ç†å™¨,å¹¶ä¸”é€‚åˆç”¨ä¸“é—¨çš„ç¡¬ä»¶å®žçŽ°ï¼Œç¡¬ä»¶å®žçŽ°èƒ½å¤Ÿä½¿å…¶åžåé‡ï¼ˆæ¯ç§’å¯ä»¥åˆ°è¾¾çš„åŠ å¯†/è§£å¯†bitæ•°ï¼‰è¾¾åˆ°åäº¿é‡çº§ã€‚åŒæ ·ï¼Œå…¶ä¹Ÿé€‚ç”¨äºŽRFIDç³»ç»Ÿã€‚ å¯¹ç§°åŠ å¯†ï¼Œå¯†é’¥æœ€é•¿åªæœ‰256ä¸ªbitï¼Œæ‰§è¡Œé€Ÿåº¦å¿«ï¼Œæ˜“äºŽç¡¬ä»¶å®žçŽ°ã€‚ç”±äºŽæ˜¯å¯¹ç§°åŠ å¯†ï¼Œå¯†é’¥éœ€è¦åœ¨ä¼ è¾“å‰é€šè®¯åŒæ–¹èŽ·çŸ¥ã€‚ åŸºäºŽä»¥ä¸Šç‰¹ç‚¹ï¼Œé€šå¸¸ä½¿ç”¨RSAæ¥é¦–å…ˆä¼ è¾“AESçš„å¯†é’¥ç»™å¯¹æ–¹ï¼Œç„¶åŽå†ä½¿ç”¨AESæ¥è¿›è¡ŒåŠ å¯†é€šè®¯ã€‚ DESDESï¼ˆData Encryption Standardï¼‰ï¼šæ•°æ®åŠ å¯†æ ‡å‡†ï¼Œé€Ÿåº¦è¾ƒå¿«ï¼Œé€‚ç”¨äºŽåŠ å¯†å¤§é‡æ•°æ®çš„åœºåˆã€‚ 3DES3DESï¼ˆTriple DESï¼‰ï¼šæ˜¯åŸºäºŽDESï¼Œå¯¹ä¸€å—æ•°æ®ç”¨ä¸‰ä¸ªä¸åŒçš„å¯†é’¥è¿›è¡Œä¸‰æ¬¡åŠ å¯†ï¼Œå¼ºåº¦æ›´é«˜ã€‚ æ•£åˆ—ç®—æ³•æ•£åˆ—ç®—æ³•ï¼Œåˆç§°å“ˆå¸Œå‡½æ•°ï¼Œæ˜¯ä¸€ç§å•å‘åŠ å¯†ç®—æ³•ã€‚åœ¨ä¿¡æ¯å®‰å…¨æŠ€æœ¯ä¸­ï¼Œç»å¸¸éœ€è¦éªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼Œæ•£åˆ—(Hash)å‡½æ•°æä¾›äº†è¿™ä¸€æœåŠ¡ï¼Œå®ƒå¯¹ä¸åŒé•¿åº¦çš„è¾“å…¥æ¶ˆæ¯ï¼Œäº§ç”Ÿå›ºå®šé•¿åº¦çš„è¾“å‡ºã€‚è¿™ä¸ªå›ºå®šé•¿åº¦çš„è¾“å‡ºç§°ä¸ºåŽŸè¾“å…¥æ¶ˆæ¯çš„â€æ•£åˆ—â€æˆ–â€æ¶ˆæ¯æ‘˜è¦â€(Message digest)ã€‚æ•£åˆ—ç®—æ³•ä¸ç®—åŠ å¯†ç®—æ³•ï¼Œå› ä¸ºå…¶ç»“æžœæ˜¯ä¸å¯é€†çš„ï¼Œæ—¢ç„¶æ˜¯ä¸å¯é€†çš„ï¼Œé‚£ä¹ˆå½“ç„¶ä¸æ˜¯ç”¨æ¥åŠ å¯†çš„ï¼Œè€Œæ˜¯ç­¾åã€‚ æ•£åˆ—ç®—æ³•ä¸»è¦æœ‰SHA-1ã€MD5ç­‰ MD5è¾“å‡º128bitã€SHA1è¾“å‡º160bitã€SHA256è¾“å‡º256bitSHA-1æ˜¯160ä½çš„å“ˆå¸Œå€¼ï¼Œè€ŒSHA-2æ˜¯ç»„åˆå€¼ï¼Œæœ‰ä¸åŒçš„ä½æ•°ï¼Œå…¶ä¸­æœ€å—æ¬¢è¿Žçš„æ˜¯256ä½ã€‚ å› ä¸ºSHA-2æœ‰å¤šç§ä¸åŒçš„ä½æ•°ï¼Œå¯¼è‡´è¿™ä¸ªåè¯æœ‰ä¸€äº›æ··ä¹±ã€‚ä½†æ˜¯æ— è®ºæ˜¯â€œSHA-2â€ï¼Œâ€œSHA-256â€æˆ–â€œSHA-256ä½â€ï¼Œå…¶å®žéƒ½æ˜¯æŒ‡åŒä¸€ç§åŠ å¯†ç®—æ³•ã€‚ä½†æ˜¯SHA-224ï¼Œâ€œSHA-384â€æˆ–â€œSHA-512â€ï¼Œè¡¨ç¤ºSHA-2çš„äºŒè¿›åˆ¶é•¿åº¦ã€‚è¿˜è¦å¦ä¸€ç§å°±æ˜¯ä¼šæŠŠç®—æ³•å’ŒäºŒè¿›åˆ¶é•¿åº¦éƒ½å†™ä¸Šï¼Œå¦‚â€œSHA-2 384â€ã€‚ SSLè¡Œä¸šé€‰æ‹©SHAä½œä¸ºæ•°å­—ç­¾åçš„æ•£åˆ—ç®—æ³•ï¼Œä»Ž2011åˆ°2015ï¼Œä¸€ç›´ä»¥SHA-1ä½ä¸»å¯¼ç®—æ³•ã€‚ä½†éšç€äº’è”ç½‘æŠ€æœ¯çš„æå‡ï¼ŒSHA-1çš„ç¼ºç‚¹è¶Šæ¥è¶Šçªæ˜¾ã€‚ä»ŽåŽ»å¹´èµ·ï¼ŒSHA-2æˆä¸ºäº†æ–°çš„æ ‡å‡†ï¼Œæ‰€ä»¥çŽ°åœ¨ç­¾å‘çš„SSLè¯ä¹¦ï¼Œå¿…é¡»ä½¿ç”¨è¯¥ç®—æ³•ç­¾åã€‚ ä¹Ÿè®¸æœ‰äººå¶å°”ä¼šçœ‹åˆ°SHA-2 384ä½çš„è¯ä¹¦ï¼Œå¾ˆå°‘ä¼šçœ‹åˆ°224ä½ï¼Œå› ä¸º224ä½ä¸å…è®¸ç”¨äºŽå…¬å…±ä¿¡ä»»çš„è¯ä¹¦ï¼Œ512ä½ï¼Œä¸è¢«è½¯ä»¶æ”¯æŒã€‚åˆæ­¥é¢„è®¡ï¼ŒSHA-2çš„ä½¿ç”¨å¹´é™ä¸ºäº”å¹´ï¼Œä½†ä¹Ÿè®¸ä¼šè¢«æå‰æ·˜æ±°ã€‚è¿™éœ€è¦æ—¶é—´æ¥éªŒè¯ã€‚ ä»¥ä¸€ä¸ª60Mçš„æ–‡ä»¶ä¸ºæµ‹è¯•æ ·æœ¬ï¼Œç»è¿‡1000æ¬¡çš„æµ‹è¯•å¹³å‡å€¼ï¼Œä¸‰ç§ç®—æ³•çš„è¡¨çŽ°ä¸ºï¼š 123MD5ç®—æ³•è¿è¡Œ1000æ¬¡çš„å¹³å‡æ—¶é—´ä¸ºï¼š226msSHA1ç®—æ³•è¿è¡Œ1000æ¬¡çš„å¹³å‡æ—¶é—´ä¸ºï¼š308msSHA256ç®—æ³•è¿è¡Œ1000æ¬¡çš„å¹³å‡æ—¶é—´ä¸ºï¼š473ms123 å®‰å…¨æ€§æ–¹é¢ï¼Œæ˜¾ç„¶SHA256ï¼ˆåˆç§°SHA2ï¼‰çš„å®‰å…¨æ€§æœ€é«˜ï¼Œä½†æ˜¯è€—æ—¶è¦æ¯”å…¶ä»–ä¸¤ç§å¤šå¾ˆå¤šã€‚MD5ç›¸å¯¹è¾ƒå®¹æ˜“ç ´è§£ï¼Œå› æ­¤ï¼ŒSHA1åº”è¯¥æ˜¯è¿™ä¸‰ç§ä¸­æ€§èƒ½æœ€å¥½çš„ä¸€æ¬¾åŠ å¯†ç®—æ³•ã€‚]]></content>
      <categories>
        <category>å®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨Spring5çš„Webfluxå¼€å‘Reactiveåº”ç”¨ï¼ˆSSE ã€Websocket)]]></title>
    <url>%2F2019%2F02%2F26%2F%E4%BD%BF%E7%94%A8Spring5%E7%9A%84Webflux%E5%BC%80%E5%8F%91Reactive%E5%BA%94%E7%94%A8%EF%BC%88SSE-%E3%80%81Websocket%2F</url>
    <content type="text"><![CDATA[å¯¹ Java å¼€å‘è€…æ¥è¯´ï¼Œ2017 å¹´ 9 æœˆæ˜¯ä¸ªçƒ­é—¹çš„æœˆä»½ï¼ŒJava SE 9ã€Java EE 8 ç›¸ç»§å‘å¸ƒï¼Œè€Œ Spring ä¹Ÿåœ¨è¿™æ®µæ—¶é—´ï¼Œå‘å¸ƒäº† 5.0 æ­£å¼ç‰ˆæœ¬ã€‚ èº«ä¸º Java å¼€å‘è€…ï¼Œå¯¹äºŽ Spring æ¡†æž¶å¹¶ä¸é™Œç”Ÿã€‚Spring åœ¨ Rod Johnson åå‡ å¹´å‰ä¸€ä¸ªäººå•æŒ‘ J2EE ä½“ç³»å¼€å§‹ï¼Œåˆ°åå¹´å‰å¼€å§‹å¤§è¡Œå…¶é“è‡³ä»Šï¼ŒåŸºæœ¬ä¸Šå·²æ˜¯ Java å¼€å‘é¢†åŸŸçš„äº‹å®žæ ‡å‡†äº†ã€‚ Spring 5 ä¸­æœ€é‡è¦æ”¹åŠ¨æ˜¯æŠŠååº”å¼ç¼–ç¨‹çš„æ€æƒ³åº”ç”¨åˆ°äº†æ¡†æž¶çš„å„ä¸ªæ–¹é¢ï¼ŒSpring 5 çš„ååº”å¼ç¼–ç¨‹ä»¥ Reactor åº“ä¸ºåŸºç¡€ã€‚Spring 5 æ¡†æž¶æ‰€åŒ…å«çš„å†…å®¹å¾ˆå¤šï¼Œè¿™é‡Œåªé‡ç‚¹ä»‹ç»å…¶ä¸­æ–°å¢žçš„ WebFlux æ¨¡å—ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ WebFlux åˆ›å»ºé«˜æ€§èƒ½çš„ Web åº”ç”¨å’Œå®¢æˆ·ç«¯ã€‚æœ¬æ–‡å¯¹ WebFlux æ¨¡å—è¿›è¡Œäº†è¯¦ç»†ä»‹ç»ï¼ŒåŒ…æ‹¬å…¶ä¸­çš„ HTTPã€æœåŠ¡å™¨æŽ¨é€äº‹ä»¶ï¼ˆSSEï¼‰å’Œ WebSocket æ”¯æŒã€‚ WebFlux ç®€ä»‹WebFlux æ¨¡å—çš„åç§°æ˜¯ spring-webfluxï¼Œåç§°ä¸­çš„ Flux æ¥æºäºŽ Reactor ä¸­çš„ç±» Fluxã€‚è¯¥æ¨¡å—ä¸­åŒ…å«äº†å¯¹ååº”å¼ HTTPã€æœåŠ¡å™¨æŽ¨é€äº‹ä»¶å’Œ WebSocket çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„æ”¯æŒã€‚å¯¹äºŽå¼€å‘äººå‘˜æ¥è¯´ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯æœåŠ¡å™¨ç«¯çš„å¼€å‘ï¼Œè¿™ä¹Ÿæ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼ŒWebFlux æ”¯æŒä¸¤ç§ä¸åŒçš„ç¼–ç¨‹æ¨¡åž‹ï¼šç¬¬ä¸€ç§æ˜¯ Spring MVC ä¸­ä½¿ç”¨çš„åŸºäºŽ Java æ³¨è§£çš„æ–¹å¼ï¼›ç¬¬äºŒç§æ˜¯åŸºäºŽ Java 8 çš„ Lambda è¡¨è¾¾å¼çš„å‡½æ•°å¼ç¼–ç¨‹æ¨¡åž‹ã€‚è¿™ä¸¤ç§ç¼–ç¨‹æ¨¡åž‹åªæ˜¯åœ¨ä»£ç ç¼–å†™æ–¹å¼ä¸Šå­˜åœ¨ä¸åŒã€‚å®ƒä»¬è¿è¡Œåœ¨åŒæ ·çš„ååº”å¼åº•å±‚æž¶æž„ä¹‹ä¸Šï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶æ˜¯ç›¸åŒçš„ã€‚WebFlux éœ€è¦åº•å±‚æä¾›è¿è¡Œæ—¶çš„æ”¯æŒï¼ŒWebFlux å¯ä»¥è¿è¡Œåœ¨æ”¯æŒ Servlet 3.1 éžé˜»å¡ž IO API çš„ Servlet å®¹å™¨ä¸Šï¼Œæˆ–æ˜¯å…¶ä»–å¼‚æ­¥è¿è¡Œæ—¶çŽ¯å¢ƒï¼Œå¦‚ Netty å’Œ Undertowã€‚ Spring Boot 2 æ˜¯åŸºäºŽ Spring 5 çš„ï¼Œå…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ›´æ–°å°±åœ¨äºŽæ”¯æŒåŒ…æ‹¬ spring-webflux å’Œå“åº”å¼çš„ spring-data åœ¨å†…çš„å“åº”å¼æ¨¡å—ï¼Œä¸‹è¾¹çš„ä¾‹å­æˆ‘ä»¬å°±ç”¨ Spring Boot 2 åœ¨è¿›è¡Œæ­å»ºã€‚ æœ¬æ–‡ä»Žä¸‰ä¸ªæ–¹é¢å¯¹ WebFlux è¿›è¡Œä»‹ç»ã€‚é¦–å…ˆæ˜¯ä½¿ç”¨ç»å…¸çš„åŸºäºŽ Java æ³¨è§£çš„ç¼–ç¨‹æ¨¡åž‹æ¥è¿›è¡Œå¼€å‘ï¼Œå…¶æ¬¡æ˜¯ä½¿ç”¨ WebFlux æ–°å¢žçš„å‡½æ•°å¼ç¼–ç¨‹æ¨¡åž‹æ¥è¿›è¡Œå¼€å‘ï¼Œæœ€åŽä»‹ç» WebFlux åº”ç”¨çš„æµ‹è¯•ã€‚é€šè¿‡è¿™æ ·å¾ªåºæ¸è¿›çš„æ–¹å¼è®©è¯»è€…äº†è§£ WebFlux åº”ç”¨å¼€å‘çš„ç»†èŠ‚ã€‚ Java æ³¨è§£ç¼–ç¨‹æ¨¡åž‹åŸºäºŽ Java æ³¨è§£çš„ç¼–ç¨‹æ¨¡åž‹ï¼Œå¯¹äºŽä½¿ç”¨è¿‡ Spring MVC çš„äººæ¥è¯´æ˜¯å†ç†Ÿæ‚‰ä¸è¿‡çš„ã€‚åœ¨ WebFlux åº”ç”¨ä¸­ä½¿ç”¨åŒæ ·çš„æ¨¡å¼ï¼Œå®¹æ˜“ç†è§£å’Œä¸Šæ‰‹ã€‚æˆ‘ä»¬å…ˆä»Žæœ€ç»å…¸çš„ Hello World å¼€å§‹è¯´æ˜Žã€‚ æˆ‘ä»¬é€šè¿‡ Spring Initializ åˆ›å»ºä¸€ä¸ª Spring Boot å·¥ç¨‹ï¼Œå› ä¸ºç›®å‰æˆ‘ä»¬è¿˜ä¸æ¶‰åŠ DAO å±‚ï¼Œæ‰€ä»¥åªé€‰æ‹© Reactive Web å°±è¡Œäº† ä¹Ÿå¯ä»¥ä½¿ç”¨ç½‘é¡µç‰ˆçš„ https://start.spring.io æ¥åˆ›å»ºé¡¹ç›®ï¼š åˆ›å»ºåŽçš„é¡¹ç›® POM ä¸­ï¼ŒåŒ…å«ä¸‹è¾¹çš„ä¾èµ–ï¼Œå³è¡¨ç¤ºåŸºäºŽ Spring WebFluxï¼š 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;&lt;/dependency&gt; åˆ›å»º Controller ç±»HelloControllerï¼Œä»…æä¾›ä¸€ä¸ª Endpoint/helloï¼š 123456789@RestControllerpublic class HelloController &#123; @GetMapping("/hello") public Mono&lt;String&gt; sayHello()&#123; return Mono.just("Hello World!"); &#125;&#125; æˆ‘ä»¬å¯åŠ¨åº”ç”¨ï¼Œé€šè¿‡è®¿é—® http://localhost:8080/hello å¯ä»¥å¾—åˆ°è¿”å›žå€¼Hello World!ã€‚ é€šè¿‡è¿™ä¸ªç®€å•çš„ Hello World ç¤ºä¾‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ WebFlux ä¸Ž Spring MVC çš„ä¸åŒåœ¨äºŽï¼ŒWebFlux æ‰€ä½¿ç”¨çš„ç±»åž‹æ˜¯ä¸Žååº”å¼ç¼–ç¨‹ç›¸å…³çš„ Flux å’Œ Mono ç­‰ï¼Œè€Œä¸æ˜¯ç®€å•çš„å¯¹è±¡ã€‚å¯¹äºŽç®€å•çš„ Hello World ç¤ºä¾‹æ¥è¯´ï¼Œè¿™ä¸¤è€…ä¹‹é—´å¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„å·®åˆ«ã€‚å¯¹äºŽå¤æ‚çš„åº”ç”¨æ¥è¯´ï¼Œååº”å¼ç¼–ç¨‹å’Œè´ŸåŽ‹çš„ä¼˜åŠ¿ä¼šä½“çŽ°å‡ºæ¥ï¼Œå¯ä»¥å¸¦æ¥æ•´ä½“çš„æ€§èƒ½çš„æå‡ã€‚ RESTful APIç®€å•çš„ Hello World ç¤ºä¾‹å¹¶ä¸è¶³ä»¥è¯´æ˜Ž WebFlux çš„ç”¨æ³•ã€‚åœ¨ä¸‹é¢çš„å°èŠ‚ä¸­ï¼Œæœ¬æ–‡å°†ä»‹ç»å…¶ä»–å…·ä½“çš„å®žä¾‹ã€‚å…ˆä»Ž RESTful API å¼€å§‹è¯´èµ·ã€‚RESTful API åœ¨ Web æœåŠ¡å™¨ç«¯åº”ç”¨ä¸­å æ®äº†å¾ˆå¤§çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„å®žä¾‹æ¥è¯´æ˜Žå¦‚ä½•ä½¿ç”¨ WebFlux æ¥å¼€å‘ RESTful APIï¼Œè¯¥ RESTful API ç”¨æ¥å¯¹ç”¨æˆ·æ•°æ®è¿›è¡ŒåŸºæœ¬çš„ CRUD æ“ä½œã€‚ ä½œä¸ºé¢†åŸŸå¯¹è±¡çš„Userç±»ä¸­åŒ…å«äº†idã€nameå’Œemailä¸‰ä¸ªåŸºæœ¬çš„å±žæ€§ã€‚ 123456789101112@Data // ç”Ÿæˆæ— å‚æž„é€ æ–¹æ³• getter setter hashCode equals toString@AllArgsConstructor // ç”Ÿæˆæ‰€æœ‰å‚æ•°æž„é€ æ–¹æ³•@NoArgsConstructor // @AllArgsConstructor ä¼šå¯¼è‡´ @Data ä¸ç”Ÿæˆæ— å‚æž„é€ æ–¹æ³•ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ  @NoArgsConstructorï¼Œå¦‚æžœæ²¡æœ‰æ— å‚æž„é€ æ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¯”å¦‚ com.fasterxml.jackson åœ¨åºåˆ—åŒ–å¤„ç†æ—¶æŠ¥é”™public class User &#123; private Integer id; private String name; private String email;&#125; ä¸ºäº†å¯¹Userç±»è¿›è¡Œæ“ä½œï¼Œæˆ‘ä»¬éœ€è¦æä¾›æœåŠ¡ç±»UserServiceã€‚UserServiceä½¿ç”¨ä¸€ä¸ª Map æ¥ä¿å­˜æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªæŒä¹…åŒ–çš„å®žçŽ°ï¼Œè¿™å¯¹äºŽç¤ºä¾‹åº”ç”¨æ¥è¯´å·²ç»è¶³å¤Ÿäº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839@Servicepublic class UserService &#123; private final Map&lt;Integer, User&gt; data = new ConcurrentHashMap&lt;&gt;(); @PostConstruct private void init() &#123; data.put(1, new User(1, "å¼ ä¸‰", "z3@qq.com")); data.put(2, new User(2, "æŽå››", "l4@qq.com")); data.put(3, new User(3, "çŽ‹äº”", "w5@qq.com")); &#125; public Flux&lt;User&gt; list() &#123; return Flux.fromIterable(this.data.values()); &#125; public Flux&lt;User&gt; getByIds(Flux&lt;Integer&gt; ids) &#123; return ids.flatMap(id -&gt; Mono.justOrEmpty(this.data.get(id))); &#125; public Mono&lt;User&gt; getById(Integer id) &#123; return Mono.justOrEmpty(this.data.get(id)) .switchIfEmpty(Mono.error(new ResourceNotFoundException())); &#125; public Flux&lt;User&gt; createOrUpdate(Flux&lt;User&gt; users) &#123; return users.doOnNext(user -&gt; this.data.put(user.getId(), user)); &#125; public Mono&lt;User&gt; createOrUpdate(User user) &#123; this.data.put(user.getId(), user); return Mono.just(user); &#125; public Mono&lt;User&gt; delete(Integer id) &#123; return Mono.justOrEmpty(this.data.remove(id)); &#125;&#125; UserControlleræ˜¯å…·ä½“çš„ Spring MVC æŽ§åˆ¶å™¨ç±»ï¼Œå®ƒä½¿ç”¨UserServiceæ¥å®Œæˆå…·ä½“çš„åŠŸèƒ½ã€‚UserControllerä¸­ä½¿ç”¨äº†æ³¨è§£@ExceptionHandleræ¥æ·»åŠ äº†ResourceNotFoundExceptionå¼‚å¸¸çš„å¤„ç†æ–¹æ³•ï¼Œå¹¶è¿”å›ž 404 é”™è¯¯ã€‚UserControllerä¸­çš„æ–¹æ³•éƒ½å¾ˆç®€å•ï¼Œåªæ˜¯ç®€å•åœ°ä»£ç†ç»™UserServiceä¸­çš„å¯¹åº”æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839@RestController@RequestMapping("/user")public class UserController &#123; @Autowired private UserService userService; @ExceptionHandler(ResourceNotFoundException.class) @ResponseStatus(code = HttpStatus.NOT_FOUND, reason = "User not found") public void notFound()&#123;&#125; @GetMapping("") public Flux&lt;User&gt; list() &#123; return userService.list(); &#125; @GetMapping("/&#123;id&#125;") public Mono&lt;User&gt; getById(@PathVariable Integer id)&#123; return userService.getById(id); &#125; @PostMapping("") public Flux&lt;User&gt; create(@RequestBody Flux&lt;User&gt; users)&#123; return userService.createOrUpdate(users); &#125; @PutMapping("/&#123;id&#125;") public Mono&lt;User&gt; update(@PathVariable Integer id, @RequestBody User user)&#123; Objects.requireNonNull(user); user.setId(id); return userService.createOrUpdate(user); &#125; @DeleteMapping("/&#123;id&#125;") public Mono&lt;User&gt; delete(@PathVariable Integer id)&#123; return userService.delete(id); &#125;&#125; æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—® http://127.0.0.1:8080/user èŽ·å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå…¶ä»–çš„ CRUD æ“ä½œå¯ä»¥è‡ªè¡Œæµ‹è¯• 1234567891011121314151617[ &#123; "id": 1, "name": "å¼ ä¸‰", "email": "z3@qq.com" &#125;, &#123; "id": 2, "name": "æŽå››", "email": "l4@qq.com" &#125;, &#123; "id": 3, "name": "çŽ‹äº”", "email": "w5@qq.com" &#125;] æœåŠ¡å™¨æŽ¨é€äº‹ä»¶ï¼ˆSSEï¼‰æœåŠ¡å™¨æŽ¨é€äº‹ä»¶ï¼ˆServer-Sent Eventsï¼ŒSSEï¼‰å…è®¸æœåŠ¡å™¨ç«¯ä¸æ–­åœ°æŽ¨é€æ•°æ®åˆ°å®¢æˆ·ç«¯ã€‚ç›¸å¯¹äºŽ WebSocket è€Œè¨€ï¼ŒæœåŠ¡å™¨æŽ¨é€äº‹ä»¶åªæ”¯æŒæœåŠ¡å™¨ç«¯åˆ°å®¢æˆ·ç«¯çš„å•å‘æ•°æ®ä¼ é€’ã€‚è™½ç„¶åŠŸèƒ½è¾ƒå¼±ï¼Œä½†ä¼˜åŠ¿åœ¨äºŽ SSE åœ¨å·²æœ‰çš„ HTTP åè®®ä¸Šä½¿ç”¨ç®€å•æ˜“æ‡‚çš„æ–‡æœ¬æ ¼å¼æ¥è¡¨ç¤ºä¼ è¾“çš„æ•°æ®ã€‚ä½œä¸º W3C çš„æŽ¨èè§„èŒƒï¼ŒSSE åœ¨æµè§ˆå™¨ç«¯çš„æ”¯æŒä¹Ÿæ¯”è¾ƒå¹¿æ³›ï¼Œé™¤äº† IE ä¹‹å¤–çš„å…¶ä»–æµè§ˆå™¨éƒ½æä¾›äº†æ”¯æŒã€‚åœ¨ IE ä¸Šä¹Ÿå¯ä»¥ä½¿ç”¨ polyfill åº“æ¥æä¾›æ”¯æŒã€‚åœ¨æœåŠ¡å™¨ç«¯æ¥è¯´ï¼ŒSSE æ˜¯ä¸€ä¸ªä¸æ–­äº§ç”Ÿæ–°æ•°æ®çš„æµï¼Œéžå¸¸é€‚åˆäºŽç”¨ååº”å¼æµæ¥è¡¨ç¤ºã€‚åœ¨ WebFlux ä¸­åˆ›å»º SSE çš„æœåŠ¡å™¨ç«¯æ˜¯éžå¸¸ç®€å•çš„ã€‚åªéœ€è¦è¿”å›žçš„å¯¹è±¡çš„ç±»åž‹æ˜¯ Fluxï¼Œå°±ä¼šè¢«è‡ªåŠ¨æŒ‰ç…§ SSE è§„èŒƒè¦æ±‚çš„æ ¼å¼æ¥å‘é€å“åº”ã€‚ ä¸‹é¢çš„SseControlleræ˜¯ä¸€ä¸ªä½¿ç”¨ SSE çš„æŽ§åˆ¶å™¨çš„ç¤ºä¾‹ã€‚ 123456789101112131415161718@RestController@RequestMapping("/sse")public class SseController &#123; @GetMapping("/random") public Flux&lt;ServerSentEvent&lt;Integer&gt;&gt; random() &#123; return Flux.interval(Duration.ofSeconds(1)) // 1 .map(seq -&gt; &#123; return ServerSentEvent.&lt;Integer&gt;builder() // 2 .event("random") .id(seq.toString()) .data(ThreadLocalRandom.current().nextInt()) .build(); &#125; ); &#125;&#125; æ¯ 1 ç§’å‘å‡ºä¸€ä¸ªè‡ªå¢žçš„ Long å€¼ ä½¿ç”¨ServerSentEvent.Builderæ¥åˆ›å»ºServerSentEventå¯¹è±¡ åœ¨æµ‹è¯• SSE æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ curl æ¥è®¿é—®å³å¯ã€‚ 123456789101112$ curl http://localhost:8080/sse/randomid:0event:randomdata:-244762412id:1event:randomdata:-1757349679id:2event:randomdata:496598301 WebSocketWebSocket æ”¯æŒå®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ç«¯çš„åŒå‘é€šè®¯ã€‚å½“å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ç«¯ä¹‹é—´çš„äº¤äº’æ–¹å¼æ¯”è¾ƒå¤æ‚æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ WebSocketã€‚WebSocket åœ¨ä¸»æµçš„æµè§ˆå™¨ä¸Šéƒ½å¾—åˆ°äº†æ”¯æŒã€‚WebFlux ä¹Ÿå¯¹åˆ›å»º WebSocket æœåŠ¡å™¨ç«¯æä¾›äº†æ”¯æŒã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼Œæˆ‘ä»¬éœ€è¦å®žçŽ°æŽ¥å£org.springframework.web.reactive.socket.WebSocketHandleræ¥å¤„ç† WebSocket é€šè®¯ï¼Œå…¶handleæ–¹æ³•çš„å‚æ•°æ˜¯WebSocketSessionå¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥èŽ·å–å®¢æˆ·ç«¯ä¿¡æ¯ã€æŽ¥é€æ¶ˆæ¯å’Œå‘é€æ¶ˆæ¯ã€‚ ä¸‹é¢çš„EchoHandlerå¯¹äºŽæ¯ä¸ªæŽ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œéƒ½ä¼šåœ¨å…¶å‰è¾¹æ·»åŠ ä¸€ä¸ªå‰ç¼€Echo -&gt;å†å‘é€å‡ºåŽ»ã€‚WebSocketSessionçš„receive()æ–¹æ³•çš„è¿”å›žå€¼æ˜¯ä¸€ä¸ªFlux&lt;WebSocketMessage&gt;å¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯æŽ¥æ”¶åˆ°çš„æ¶ˆæ¯æµï¼Œè€Œsend()æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªPublisher&lt;WebSocketMessage&gt;å¯¹è±¡ï¼Œè¡¨ç¤ºè¦å‘é€çš„æ¶ˆæ¯æµã€‚ 12345678910@Componentpublic class EchoHandler implements WebSocketHandler &#123; @Override public Mono&lt;Void&gt; handle(WebSocketSession session) &#123; return session.send( session.receive() .map(msg -&gt; session.textMessage("Echo -&gt; " + msg.getPayloadAsText()))); &#125;&#125; ä»…åˆ›å»ºä¸€ä¸ªWebSocketHandleræ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŠŠå®ƒæ³¨å†Œåˆ° WebFlux ä¸­ã€‚æˆ‘ä»¬å†æ¥éœ€è¦åˆ›å»ºä¸€ä¸ªWebSocketHandlerAdapterå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è´Ÿè´£æŠŠ WebSocketHandler å…³è”åˆ° WebFlux ä¸­ã€‚å…¶ä¸­æˆ‘ä»¬ä½¿ç”¨HandlerMappingæŠŠEchoHandleræ˜ å°„åˆ°/echoç«¯ç‚¹ã€‚ 123456789101112131415161718192021@Configurationpublic class WebSocketConfiguration &#123; @Autowired @Bean public HandlerMapping webSocketMapping(EchoHandler echoHandler)&#123; Map&lt;String, WebSocketHandler&gt; map = new HashMap&lt;&gt;(1); map.put("/echo", echoHandler); SimpleUrlHandlerMapping mapping = new SimpleUrlHandlerMapping(); mapping.setOrder(Ordered.HIGHEST_PRECEDENCE); mapping.setUrlMap(map); return mapping; &#125; @Bean public WebSocketHandlerAdapter webSocketHandlerAdapter()&#123; return new WebSocketHandlerAdapter(); &#125;&#125; è¿è¡Œåº”ç”¨ä¹‹åŽï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·æ¥æµ‹è¯•è¯¥ WebSocket æœåŠ¡ã€‚æ‰“å¼€å·¥å…·é¡µé¢ï¼Œç„¶åŽè¿žæŽ¥åˆ°ws://localhost:8080/echoå¯ä»¥å‘é€æ¶ˆæ¯å¹¶æŸ¥çœ‹æœåŠ¡å™¨ç«¯è¿”å›žçš„ç»“æžœã€‚ å‡½æ•°å¼ç¼–ç¨‹æ¨¡åž‹å‰é¢ä»‹ç»äº†åŸºäºŽ Java æ³¨è§£çš„ç¼–ç¨‹æ¨¡åž‹ï¼ŒWebFlux è¿˜æ”¯æŒåŸºäºŽ Lambda è¡¨è¾¾å¼çš„å‡½æ•°å¼ç¼–ç¨‹æ¨¡åž‹ã€‚ä¸ŽåŸºäºŽ Java æ³¨è§£çš„ç¼–ç¨‹æ¨¡åž‹ç›¸æ¯”ï¼Œå‡½æ•°å¼ç¼–ç¨‹æ¨¡åž‹çš„æŠ½è±¡å±‚æ¬¡æ›´ä½Žï¼Œä»£ç ç¼–å†™æ›´çµæ´»ï¼Œå¯ä»¥æ»¡è¶³ä¸€äº›å¯¹åŠ¨æ€æ€§è¦æ±‚æ›´é«˜çš„åœºæ™¯ã€‚ä¸è¿‡åœ¨ç¼–å†™æ—¶çš„ä»£ç å¤æ‚åº¦ä¹Ÿè¾ƒé«˜ï¼Œå­¦ä¹ æ›²çº¿ä¹Ÿè¾ƒé™¡ã€‚ ç›®å‰ Spring Boot å·²æ”¯æŒåœ¨ä¸€ä¸ªåº”ç”¨ä¸­åŒæ—¶ä½¿ç”¨ä¸¤ç§ä¸åŒçš„ç¼–ç¨‹æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å®žé™…çš„éœ€è¦æ¥é€‰æ‹©åˆé€‚çš„ç¼–ç¨‹æ¨¡åž‹ã€‚ åœ¨å‡½æ•°å¼ç¼–ç¨‹æ¨¡åž‹ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚æ˜¯ç”±ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†çš„ï¼Œ é€šè¿‡æŽ¥å£org.springframework.web.reactive.function.server.HandlerFunctionæ¥è¡¨ç¤ºã€‚HandlerFunctionæ˜¯ä¸€ä¸ªå‡½æ•°å¼æŽ¥å£ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå› æ­¤å¯ä»¥ç”¨ Labmda è¡¨è¾¾å¼æ¥å®žçŽ°è¯¥æŽ¥å£ï¼š 1Mono&lt;T extends ServerResponse&gt; handle(ServerRequest request); ç„¶åŽé€šè¿‡å‡½æ•°å¼æŽ¥å£org.springframework.web.reactive.function.server.RouterFunctionæ¥ä¸ºè¿™äº›HandlerFunctionæä¾›è·¯ç”±ä¿¡æ¯ï¼Œè¾“å…¥ä¸ºè¯·æ±‚ï¼Œè¾“å‡ºä¸ºè£…åœ¨ Mono é‡Œè¾¹çš„Handlerfunction 1Mono&lt;HandlerFunction&lt;T&gt;&gt; route(ServerRequest request); æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨ WebFlux ä¸­ï¼Œè¯·æ±‚å’Œå“åº”ä¸å†æ˜¯ WebMVC ä¸­çš„ServletRequestå’ŒServletResponseï¼Œè€Œæ˜¯ServerRequestå’ŒServerResponseã€‚åŽè€…æ˜¯åœ¨å“åº”å¼ç¼–ç¨‹ä¸­ä½¿ç”¨çš„æŽ¥å£ï¼Œå®ƒä»¬æä¾›äº†å¯¹éžé˜»å¡žå’Œå›žåŽ‹ç‰¹æ€§çš„æ”¯æŒï¼Œä»¥åŠ HTTP æ¶ˆæ¯ä½“ä¸Žå“åº”å¼ç±»åž‹ Mono å’Œ Flux çš„è½¬æ¢æ–¹æ³•ã€‚ ä¸‹é¢æˆ‘ä»¬ç”¨å‡½æ•°å¼çš„æ–¹å¼å¼€å‘ä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨ï¼Œæœ‰addã€subtractã€multiplyå’Œdivideå››ä¸ªæ–¹æ³•ï¼Œéƒ½æ˜¯æŽ¥å£HandlerFunctionçš„å®žçŽ°ï¼Œåˆ†åˆ«å¯¹åº”åŠ ã€å‡ã€ä¹˜ã€é™¤å››ç§è¿ç®—ã€‚ å¯¹äºŽè¿™ä¸ªéœ€æ±‚ï¼ŒHandlerFunction å¾ˆå®¹æ˜“å†™ï¼š 12345678910HandlerFunction&lt;ServerResponse&gt; add = request -&gt; ServerResponse.ok() .body(Mono.just(parseOperand(request, "v1") + parseOperand(request, "v2")), Integer.class);private int parseOperand(final ServerRequest request, final String param) &#123; try &#123; return Integer.parseInt(request.queryParam(param).orElse("0")); &#125; catch (final NumberFormatException e) &#123; return 0; &#125;&#125; é‚£ä¹ˆ RouterFunction ä¸ºï¼š 1234@Beanpublic RouterFunction&lt;ServerResponse&gt; routerFunction() &#123; return RouterFunctions.route(RequestPredicates.GET("/add"), add);&#125; å¯åŠ¨æœåŠ¡ï¼Œè®¿é—® http://localhost:8080/add?v1=2&amp;v2=3 å³è®¡ç®— 2+3 å¾—åˆ°è¿”å›žå€¼5ã€‚ ä¸è¿‡è¿™ä¹ˆå†™åœ¨ä¸šåŠ¡é€»è¾‘å¤æ‚çš„æ—¶å€™ä¸å¤ªå¥½ç»„ç»‡ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨è·Ÿ MVC ç±»ä¼¼çš„ä»£ç ç»„ç»‡æ–¹å¼ï¼Œå°†åŒç±»ä¸šåŠ¡çš„ HandlerFunction æ”¾åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œç„¶åŽåœ¨ Java Config ä¸­å°† RouterFunction é…ç½®ä¸º Spring å®¹å™¨çš„ Beanã€‚æˆ‘ä»¬ç»§ç»­åœ¨è¿™ä¸ªè®¡ç®—å™¨çš„ä»£ç ä¸Šå¼€å‘ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940@Componentpublic class CalculatorHandler &#123; public Mono&lt;ServerResponse&gt; add(final ServerRequest request) &#123; return calculate(request, (v1, v2) -&gt; v1 + v2); &#125; public Mono&lt;ServerResponse&gt; subtract(final ServerRequest request) &#123; return calculate(request, (v1, v2) -&gt; v1 - v2); &#125; public Mono&lt;ServerResponse&gt; multiply(final ServerRequest request) &#123; return calculate(request, (v1, v2) -&gt; v1 * v2); &#125; public Mono&lt;ServerResponse&gt; divide(final ServerRequest request) &#123; return calculate(request, (v1, v2) -&gt; v1 / v2); &#125; private Mono&lt;ServerResponse&gt; calculate(final ServerRequest request, final BiFunction&lt;Integer, Integer, Integer&gt; calculateFunc) &#123; final Tuple2&lt;Integer, Integer&gt; operands = extractOperands(request); return ServerResponse .ok() .body(Mono.just(calculateFunc.apply(operands.getT1(), operands.getT2())), Integer.class); &#125; private Tuple2&lt;Integer, Integer&gt; extractOperands(final ServerRequest request) &#123; return Tuples.of(parseOperand(request, "v1"), parseOperand(request, "v2")); &#125; private int parseOperand(final ServerRequest request, final String param) &#123; try &#123; return Integer.parseInt(request.queryParam(param).orElse("0")); &#125; catch (final NumberFormatException e) &#123; return 0; &#125; &#125;&#125; æˆ‘ä»¬é‡‡ç”¨ Spring çŽ°åœ¨æ¯”è¾ƒæŽ¨èçš„ Java Config çš„é…ç½® Bean çš„æ–¹å¼ï¼Œåˆ›å»ºç”¨äºŽå­˜æ”¾ Router çš„é…ç½®ç±»RouterConfig.javaï¼š 123456789101112131415@Configurationpublic class RouterConfig &#123; @Bean @Autowired public RouterFunction&lt;ServerResponse&gt; routerFunction(final CalculatorHandler calculatorHandler) &#123; return RouterFunctions.route(RequestPredicates.path("/calculator"), request -&gt; request.queryParam("operator").map(operator -&gt; Mono.justOrEmpty(ReflectionUtils.findMethod(CalculatorHandler.class, operator, ServerRequest.class)) .flatMap(method -&gt; (Mono&lt;ServerResponse&gt;) ReflectionUtils.invokeMethod(method, calculatorHandler, request)) .switchIfEmpty(ServerResponse.badRequest().build()) .onErrorResume(ex -&gt; ServerResponse.status(HttpStatus.INTERNAL_SERVER_ERROR).build())) .orElse(ServerResponse.badRequest().build())); &#125;&#125; åœ¨ä¸Šè¾¹çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆç”¨RouterFunctions.routeæ¥æ ¹æ®Predicateæ˜¯å¦åŒ¹é…æ¥ç¡®å®šHandlerFunctionæ˜¯å¦è¢«åº”ç”¨ã€‚RequestPredicatesä¸­åŒ…å«äº†å¾ˆå¤šé™æ€æ–¹æ³•æ¥åˆ›å»ºå¸¸ç”¨çš„åŸºäºŽä¸åŒåŒ¹é…è§„åˆ™çš„Predicateï¼Œå¦‚RequestPredicates.pathç”¨æ¥æ ¹æ® HTTP è¯·æ±‚çš„è·¯å¾„æ¥è¿›è¡ŒåŒ¹é…ï¼Œæ­¤å¤„æˆ‘ä»¬æ£€æŸ¥è¯·æ±‚çš„è·¯å¾„æ˜¯/calculatorã€‚ç„¶åŽä½¿ç”¨ServerRequestçš„queryParamæ–¹æ³•æ¥èŽ·å–åˆ°å‚æ•°operatorçš„å€¼ï¼Œç„¶åŽé€šè¿‡åå°„ API åœ¨CalculatorHandlerä¸­æ‰¾åˆ°ä¸Žå‚æ•°operatorçš„å€¼åç§°ç›¸åŒçš„æ–¹æ³•æ¥ç¡®å®šè¦è°ƒç”¨çš„HandlerFunctionçš„å®žçŽ°ï¼Œæœ€åŽè°ƒç”¨æŸ¥æ‰¾åˆ°çš„æ–¹æ³•æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚å¦‚æžœæ‰¾ä¸åˆ°å‚æ•°operatorï¼ŒæœåŠ¡å™¨ç«¯è¿”å›ž 400 é”™è¯¯ï¼›å¦‚æžœåå°„ API çš„æ–¹æ³•è°ƒç”¨ä¸­å‡ºçŽ°é”™è¯¯ï¼ŒæœåŠ¡å™¨ç«¯è¿”å›ž 500 é”™è¯¯ã€‚ é‡å¯æœåŠ¡ç„¶åŽæˆ‘ä»¬è®¿é—® http://127.0.0.1:8080/calculator?operator=add&amp;v1=2&amp;v2=3 å¾—åˆ°è¿”å›žå€¼5ã€‚ å®¢æˆ·ç«¯é™¤äº†æœåŠ¡å™¨ç«¯å®žçŽ°ä¹‹å¤–ï¼ŒWebFlux ä¹Ÿæä¾›äº†ååº”å¼å®¢æˆ·ç«¯ï¼Œå¯ä»¥è®¿é—® HTTPã€SSE å’Œ WebSocket æœåŠ¡å™¨ç«¯ã€‚ HTTPå¯¹äºŽ HTTP å’Œ SSEï¼Œå¯ä»¥ä½¿ç”¨ WebFlux æ¨¡å—ä¸­çš„ç±»org.springframework.web.reactive.function.client.WebClientã€‚ä¸‹é¢çš„ä»£ç ä¸­æˆ‘ä»¬å°†ç”¨RESTClientæ¥è®¿é—®å‰é¢å°èŠ‚ä¸­åˆ›å»ºçš„ REST APIã€‚ 1234567891011121314@Testpublic void testRESTClient() throws InterruptedException &#123; User user = new User(4, "èµµå…­", "z6@qq.com"); WebClient client = WebClient.create("http://localhost:8080/user"); // 1 Flux&lt;User&gt; createdUser = client.post() // 2 .uri("") // 3 .accept(MediaType.APPLICATION_JSON) // 4 .body(Mono.just(user), User.class) // 5 .retrieve() // 6 .bodyToFlux(User.class); // 7 createdUser.subscribe(System.out::println); // 8 TimeUnit.SECONDS.sleep(1); // 9&#125; ä½¿ç”¨WebClient.createæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„WebClientå¯¹è±¡ ä½¿ç”¨postæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª POST è¯·æ±‚ æŒ‡å®š baseUrl é…ç½®è¯·æ±‚ Headerï¼šContent-Type: application/json ä½¿ç”¨body()æ–¹æ³•æ¥è®¾ç½® POST è¯·æ±‚çš„å†…å®¹ å¼‚æ­¥åœ°èŽ·å– response ä¿¡æ¯ï¼Œè¿”å›žå€¼ä¸ºWebClient.ResponseSpecï¼Œretrive()å¯ä»¥çœ‹åšæ˜¯exchange()æ–¹æ³•çš„ â€œå¿«æ·ç‰ˆâ€ï¼ˆexchange()çš„è¿”å›žå€¼ä¸ºClientResponseï¼‰ WebClient.ResponseSpecçš„bodyToFluxæ–¹æ³•æŠŠå“åº”å†…å®¹è½¬æ¢æˆUserå¯¹è±¡ï¼Œæœ€ç»ˆå¾—åˆ°çš„ç»“æžœæ˜¯Flux&lt;User&gt; æ‰“å°å‡ºæ¥ ç”±äºŽæ˜¯å¼‚æ­¥çš„ï¼Œæˆ‘ä»¬å°†æµ‹è¯•çº¿ç¨‹ sleep 1 ç§’ç¡®ä¿æ‹¿åˆ° responseï¼Œä¹Ÿå¯ä»¥ç”¨CountDownLatch SEEWebClient è¿˜å¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼æ¥è®¿é—® SSE æœåŠ¡ã€‚è¿™é‡Œæˆ‘ä»¬è®¿é—®çš„æ˜¯åœ¨ä¹‹å‰çš„å°èŠ‚ä¸­åˆ›å»ºçš„ç”Ÿæˆéšæœºæ•°çš„ SSE æœåŠ¡ã€‚ä½¿ç”¨ WebClient è®¿é—® SSE åœ¨å‘é€è¯·æ±‚éƒ¨åˆ†ä¸Žè®¿é—® REST API æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºŽå¯¹ HTTP å“åº”çš„å¤„ç†ã€‚ 1234567891011121314151617181920@Testpublic void testSEEClient() &#123; final WebClient client = WebClient.create(); client.get() .uri("http://localhost:8080/sse/random") .accept(MediaType.TEXT_EVENT_STREAM) .exchange() .flatMapMany(response -&gt; // 1 response.body( BodyExtractors.toFlux( new ParameterizedTypeReference&lt;ServerSentEvent&lt;String&gt;&gt;() &#123;&#125; ) ) ) .filter(sse -&gt; Objects.nonNull(sse.data())) .map(ServerSentEvent::data) .buffer(10) // 2 .doOnNext(System.out::println) // 3 .blockFirst(); // 4&#125; ç”±äºŽ SSE æœåŠ¡çš„å“åº”æ˜¯ä¸€ä¸ªæ¶ˆæ¯æµï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨flatMapManyæŠŠ Mono&lt;ServerResponse&gt;è½¬æ¢æˆä¸€ä¸ªFlux&lt;ServerSentEvent&gt;å¯¹è±¡ï¼Œè¿™æ˜¯é€šè¿‡æ–¹æ³•BodyExtractors.toFluxæ¥å®Œæˆçš„ï¼Œå…¶ä¸­çš„å‚æ•°new ParameterizedTypeReference&lt;ServerSentEvent&lt;String&gt;&gt;() {}è¡¨æ˜Žäº†å“åº”æ¶ˆæ¯æµä¸­çš„å†…å®¹æ˜¯ServerSentEventå¯¹è±¡ ç”±äºŽ SSE æœåŠ¡å™¨ä¼šä¸æ–­åœ°å‘é€æ¶ˆæ¯ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯é€šè¿‡bufferæ–¹æ³•æ¥èŽ·å–å‰ 10 æ¡æ¶ˆæ¯å¹¶è¾“å‡º åªè¯»åœ° peek æ¯ä¸ªå…ƒç´ ï¼Œç„¶åŽæ‰“å°å‡ºæ¥ï¼Œå®ƒå¹¶ä¸æ˜¯ subscribeï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘æµ blockFirstæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œåœ¨æ”¶åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ å‰ä¼šé˜»å¡žï¼Œå“åº”å¼ä¸šåŠ¡åœºæ™¯ä¸­æ…Žç”¨ è¿è¡Œæ•ˆæžœå¦‚ä¸‹ï¼š æˆ–è€…ä¹Ÿå¯ä»¥åƒä¸‹è¾¹è¿™æ · 123456789101112@Testpublic void testSEEClient2() &#123; WebClient client = WebClient.create(); client.get() .uri("http://localhost:8080/sse/random") .accept(MediaType.TEXT_EVENT_STREAM) .retrieve() .bodyToFlux(String.class) .log() .take(10) .blockLast();&#125; è¿è¡Œæ•ˆæžœå¦‚ä¸‹ï¼š WebSocketè®¿é—® WebSocket ä¸èƒ½ä½¿ç”¨ WebClientï¼Œè€Œåº”è¯¥ä½¿ç”¨ä¸“é—¨çš„ WebSocketClient å®¢æˆ·ç«¯ã€‚Spring Boot çš„ WebFlux æ¨¡æ¿ä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯ Reactor Netty åº“ã€‚Reactor Netty åº“æä¾›äº† WebSocketClient çš„å®žçŽ°ã€‚æˆ‘ä»¬è¿™é‡Œè®¿é—®å‰é¢åˆ›å»ºçš„ WebSocket æœåŠ¡ã€‚ 12345678910@Testpublic void testWSClient() &#123; WebSocketClient client = new ReactorNettyWebSocketClient(); // 1 client.execute(URI.create("ws://localhost:8080/echo"), session -&gt; // 2 session.send(Flux.just(session.textMessage("Hello"))) // 3 .thenMany(session.receive().take(1).map(WebSocketMessage::getPayloadAsText)) // 4 .doOnNext(System.out::println) .then()) .block(Duration.ofMillis(5000));&#125; åˆ›å»ºä¸€ä¸ª WebSocketClient å®žä¾‹ ä½¿ç”¨ WebSocketClient çš„executeæ–¹æ³•ä¸Ž WebSocket æœåŠ¡å™¨å»ºç«‹è¿žæŽ¥ï¼Œå¹¶æ‰§è¡Œç»™å®šçš„ WebSocketHandler å¯¹è±¡ é€šè¿‡ WebSocketSession çš„sendæ–¹æ³•æ¥å‘é€å­—ç¬¦ä¸²â€Helloâ€ åˆ°æœåŠ¡å™¨ç«¯ é€šè¿‡receiveæ–¹æ³•æ¥ç­‰å¾…æœåŠ¡å™¨ç«¯çš„å“åº”å¹¶è¾“å‡ºï¼Œtake(1)çš„ä½œç”¨æ˜¯è¡¨æ˜Žå®¢æˆ·ç«¯åªèŽ·å–æœåŠ¡å™¨ç«¯å‘é€çš„ç¬¬ä¸€æ¡æ¶ˆæ¯ è¿è¡Œæ•ˆæžœå¦‚ä¸‹ï¼š æµ‹è¯•åœ¨ spring-test æ¨¡å—ä¸­ä¹Ÿæ·»åŠ äº†å¯¹ WebFlux çš„æ”¯æŒã€‚é€šè¿‡ç±» org.springframework.test.web.reactive.server.WebTestClientå¯ä»¥æµ‹è¯• WebFlux æœåŠ¡å™¨ã€‚è¿›è¡Œæµ‹è¯•æ—¶æ—¢å¯ä»¥é€šè¿‡ mock çš„æ–¹å¼æ¥è¿›è¡Œï¼Œä¹Ÿå¯ä»¥å¯¹å®žé™…è¿è¡Œçš„æœåŠ¡å™¨è¿›è¡Œé›†æˆæµ‹è¯•ã€‚ æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªé›†æˆæµ‹è¯•æ¥æµ‹è¯•UserControllerä¸­çš„åˆ›å»ºç”¨æˆ·çš„åŠŸèƒ½ã€‚æ–¹æ³• WebTestClient.bindToServerç»‘å®šåˆ°ä¸€ä¸ªè¿è¡Œçš„æœåŠ¡å™¨å¹¶è®¾ç½®äº†åŸºç¡€ URLã€‚å‘é€ HTTP è¯·æ±‚çš„æ–¹å¼ä¸Žä¹‹å‰çš„ä»£ç ç›¸åŒï¼Œä¸åŒçš„æ˜¯exchangeæ–¹æ³•çš„è¿”å›žå€¼æ˜¯ResponseSpecå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†expectStatuså’ŒexpectBodyç­‰æ–¹æ³•æ¥éªŒè¯ HTTP å“åº”çš„çŠ¶æ€ç å’Œå†…å®¹ã€‚æ–¹æ³•jsonPathå¯ä»¥æ ¹æ® JSON å¯¹è±¡ä¸­çš„è·¯å¾„æ¥è¿›è¡ŒéªŒè¯ã€‚ 1234567891011121314151617public class UserControllerTest &#123; private final WebTestClient client = WebTestClient.bindToServer().baseUrl("http://localhost:8080").build(); @Test public void testCreateUser() throws Exception &#123; User user = new User(5, "é’±ä¸ƒ", "q7@qq.com"); client.post().uri("/user") .contentType(MediaType.APPLICATION_JSON) .body(Mono.just(user), User.class) .exchange() .expectStatus().isOk() .expectBody().jsonPath("$[0].name") .isEqualTo("é’±ä¸ƒ"); &#125;&#125; JsonPath çš„è¯­æ³•å¯ä»¥çœ‹ https://github.com/json-path/JsonPath æ€»ç»“ååº”å¼ç¼–ç¨‹èŒƒå¼ä¸ºå¼€å‘é«˜æ€§èƒ½ Web åº”ç”¨å¸¦æ¥äº†æ–°çš„æœºä¼šå’ŒæŒ‘æˆ˜ã€‚Spring 5 ä¸­çš„ WebFlux æ¨¡å—å¯ä»¥ä½œä¸ºå¼€å‘ååº”å¼ Web åº”ç”¨çš„åŸºç¡€ã€‚ç”±äºŽ Spring æ¡†æž¶çš„æµè¡Œï¼ŒWebFlux ä¼šæˆä¸ºå¼€å‘ Web åº”ç”¨çš„é‡è¦è¶‹åŠ¿ä¹‹ä¸€ã€‚æœ¬æ–‡å¯¹ Spring 5 ä¸­çš„ WebFlux æ¨¡å—è¿›è¡Œäº†è¯¦ç»†çš„ä»‹ç»ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”¨ WebFlux å¼€å‘ HTTPã€SSE å’Œ WebSocket æœåŠ¡å™¨ç«¯åº”ç”¨ï¼Œä»¥åŠä½œä¸ºå®¢æˆ·ç«¯æ¥è®¿é—® HTTPã€SSE å’Œ WebSocket æœåŠ¡ã€‚å¯¹äºŽ WebFlux çš„åŸºäºŽ Java æ³¨è§£å’Œå‡½æ•°å¼ç¼–ç¨‹ç­‰ä¸¤ç§æ¨¡åž‹éƒ½è¿›è¡Œäº†ä»‹ç»ã€‚æœ€åŽä»‹ç»äº†å¦‚ä½•æµ‹è¯• WebFlux åº”ç”¨ã€‚ ç¤ºä¾‹ä»£ç ï¼šGithub å‚è€ƒWeb on Reactive Stack23. WebFlux frameworkä½¿ç”¨ Spring 5 çš„ WebFlux å¼€å‘ååº”å¼ Web åº”ç”¨ä½¿ç”¨ Reactor è¿›è¡Œååº”å¼ç¼–ç¨‹Reactor NettySpring WebFlux å¿«é€Ÿä¸Šæ‰‹]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>SSE</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[java nioå¸¸ç”¨æ–¹æ³•]]></title>
    <url>%2F2019%2F02%2F23%2Fjava-nio%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ByteBuffer1ã€å®žä¾‹åŒ–java.nio.Bufferç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½è¢«å®žä¾‹åŒ–ã€‚Bufferç±»çš„ç›´æŽ¥å­ç±»ï¼Œå¦‚ByteBufferç­‰ä¹Ÿæ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½è¢«å®žä¾‹åŒ–ã€‚ ä½†æ˜¯ByteBufferç±»æä¾›äº†4ä¸ªé™æ€å·¥åŽ‚æ–¹æ³•æ¥èŽ·å¾—ByteBufferçš„å®žä¾‹ï¼š æ–¹æ³• æè¿° allocate(int capacity) ä»Žå †ç©ºé—´ä¸­åˆ†é…ä¸€ä¸ªå®¹é‡å¤§å°ä¸ºcapacityçš„byteæ•°ç»„ä½œä¸ºç¼“å†²åŒºçš„byteæ•°æ®å­˜å‚¨å™¨ allocateDirect(int capacity) æ˜¯ä¸ä½¿ç”¨JVMå †æ ˆè€Œæ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿæ¥åˆ›å»ºå†…å­˜å—ç”¨ä½œç¼“å†²åŒºï¼Œå®ƒä¸Žå½“å‰æ“ä½œç³»ç»Ÿèƒ½å¤Ÿæ›´å¥½çš„è€¦åˆï¼Œå› æ­¤èƒ½è¿›ä¸€æ­¥æé«˜I/Oæ“ä½œé€Ÿåº¦ã€‚ä½†æ˜¯åˆ†é…ç›´æŽ¥ç¼“å†²åŒºçš„ç³»ç»Ÿå¼€é”€å¾ˆå¤§ï¼Œå› æ­¤åªæœ‰åœ¨ç¼“å†²åŒºè¾ƒå¤§å¹¶é•¿æœŸå­˜åœ¨ï¼Œæˆ–è€…éœ€è¦ç»å¸¸é‡ç”¨æ—¶ï¼Œæ‰ä½¿ç”¨è¿™ç§ç¼“å†²åŒº wrap(byte[] array) è¿™ä¸ªç¼“å†²åŒºçš„æ•°æ®ä¼šå­˜æ”¾åœ¨byteæ•°ç»„ä¸­ï¼Œbytesæ•°ç»„æˆ–buffç¼“å†²åŒºä»»ä½•ä¸€æ–¹ä¸­æ•°æ®çš„æ”¹åŠ¨éƒ½ä¼šå½±å“å¦ä¸€æ–¹ã€‚å…¶å®žByteBufferåº•å±‚æœ¬æ¥å°±æœ‰ä¸€ä¸ªbytesæ•°ç»„è´Ÿè´£æ¥ä¿å­˜bufferç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œé€šè¿‡allocateæ–¹æ³•ç³»ç»Ÿä¼šå¸®ä½ æž„é€ ä¸€ä¸ªbyteæ•°ç»„ wrap(byte[] array, int offset, int length) åœ¨ä¸Šä¸€ä¸ªæ–¹æ³•çš„åŸºç¡€ä¸Šå¯ä»¥æŒ‡å®šåç§»é‡å’Œé•¿åº¦ï¼Œè¿™ä¸ªoffsetä¹Ÿå°±æ˜¯åŒ…è£…åŽbyteBufferçš„positionï¼Œè€Œlengthå‘¢å°±æ˜¯limit-positionçš„å¤§å°ï¼Œä»Žè€Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°limitçš„ä½ç½®ä¸ºlength+position(offset) 2ã€å¦å¤–ä¸€äº›å¸¸ç”¨çš„æ–¹æ³• æ–¹æ³• æè¿° limit(), limit(10)ç­‰ å…¶ä¸­è¯»å–å’Œè®¾ç½®è¿™4ä¸ªå±žæ€§çš„æ–¹æ³•çš„å‘½åå’ŒjQueryä¸­çš„val(),val(10)ç±»ä¼¼ï¼Œä¸€ä¸ªè´Ÿè´£getï¼Œä¸€ä¸ªè´Ÿè´£set reset() æŠŠpositionè®¾ç½®æˆmarkçš„å€¼ï¼Œç›¸å½“äºŽä¹‹å‰åšè¿‡ä¸€ä¸ªæ ‡è®°ï¼ŒçŽ°åœ¨è¦é€€å›žåˆ°ä¹‹å‰æ ‡è®°çš„åœ°æ–¹ clear() position = 0;limit = capacity;mark = -1; æœ‰ç‚¹åˆå§‹åŒ–çš„å‘³é“ï¼Œä½†æ˜¯å¹¶ä¸å½±å“åº•å±‚byteæ•°ç»„çš„å†…å®¹ flip() limit = position;position = 0;mark = -1; ç¿»è½¬ï¼Œä¹Ÿå°±æ˜¯è®©flipä¹‹åŽçš„positionåˆ°limitè¿™å—åŒºåŸŸå˜æˆä¹‹å‰çš„0åˆ°positionè¿™å—ï¼Œç¿»è½¬å°±æ˜¯å°†ä¸€ä¸ªå¤„äºŽå­˜æ•°æ®çŠ¶æ€çš„ç¼“å†²åŒºå˜ä¸ºä¸€ä¸ªå¤„äºŽå‡†å¤‡å–æ•°æ®çš„çŠ¶æ€ rewind() æŠŠpositionè®¾ä¸º0ï¼Œmarkè®¾ä¸º-1ï¼Œä¸æ”¹å˜limitçš„å€¼ remaining() return limit - position; è¿”å›žlimitå’Œpositionä¹‹é—´ç›¸å¯¹ä½ç½®å·® hasRemaining() return position &lt; limitè¿”å›žæ˜¯å¦è¿˜æœ‰æœªè¯»å†…å®¹ compact() æŠŠä»Žpositionåˆ°limitä¸­çš„å†…å®¹ç§»åˆ°0åˆ°limit-positionçš„åŒºåŸŸå†…ï¼Œpositionå’Œlimitçš„å–å€¼ä¹Ÿåˆ†åˆ«å˜æˆlimit-positionã€capacityã€‚å¦‚æžœå…ˆå°†positonè®¾ç½®åˆ°limitï¼Œå†compactï¼Œé‚£ä¹ˆç›¸å½“äºŽclear() get() ç›¸å¯¹è¯»ï¼Œä»Žpositionä½ç½®è¯»å–ä¸€ä¸ªbyteï¼Œå¹¶å°†position+1ï¼Œä¸ºä¸‹æ¬¡è¯»å†™ä½œå‡†å¤‡ get(int index) ç»å¯¹è¯»ï¼Œè¯»å–byteBufferåº•å±‚çš„bytesä¸­ä¸‹æ ‡ä¸ºindexçš„byteï¼Œä¸æ”¹å˜position get(byte[] dst, int offset, int length) ä»Žpositionä½ç½®å¼€å§‹ç›¸å¯¹è¯»ï¼Œè¯»lengthä¸ªbyteï¼Œå¹¶å†™å…¥dstä¸‹æ ‡ä»Žoffsetåˆ°offset+lengthçš„åŒºåŸŸ put(byte b) ç›¸å¯¹å†™ï¼Œå‘positionçš„ä½ç½®å†™å…¥ä¸€ä¸ªbyteï¼Œå¹¶å°†postion+1ï¼Œä¸ºä¸‹æ¬¡è¯»å†™ä½œå‡†å¤‡ put(int index, byte b) ç»å¯¹å†™ï¼Œå‘byteBufferåº•å±‚çš„bytesä¸­ä¸‹æ ‡ä¸ºindexçš„ä½ç½®æ’å…¥byte bï¼Œä¸æ”¹å˜position put(ByteBuffer src) ç”¨ç›¸å¯¹å†™ï¼ŒæŠŠsrcä¸­å¯è¯»çš„éƒ¨åˆ†ï¼ˆä¹Ÿå°±æ˜¯positionåˆ°limitï¼‰å†™å…¥æ­¤byteBuffer put(byte[] src, int offset, int length) ä»Žsrcæ•°ç»„ä¸­çš„offsetåˆ°offset+lengthåŒºåŸŸè¯»å–æ•°æ®å¹¶ä½¿ç”¨ç›¸å¯¹å†™å†™å…¥æ­¤byteBuffer ä»£ç å‚è€ƒhttps://github.com/Frankenjoy123/nettystudy java.nio.charset.Charsetencode(java.nio.CharBuffer)FileChanneljava.nio.file.Paths##get(java.lang.String, java.lang.Stringâ€¦) â€‹]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>nio</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLå¸¸ç”¨å‡½æ•°]]></title>
    <url>%2F2019%2F02%2F21%2FMySQL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%2F</url>
    <content type="text"><![CDATA[å­—ç¬¦ä¸²æˆªå–1. å­—ç¬¦ä¸²æˆªå–ï¼šleft(str, length)123456mysql&gt; select left('sqlstudy.com', 3);+-------------------------+| left('sqlstudy.com', 3) |+-------------------------+| sql |+-------------------------+ 2. å­—ç¬¦ä¸²æˆªå–ï¼šright(str, length)123456mysql&gt; select right('sqlstudy.com', 3);+--------------------------+| right('sqlstudy.com', 3) |+--------------------------+| com |+--------------------------+ 3. å­—ç¬¦ä¸²æˆªå–ï¼šsubstring(str, pos); substring(str, pos, len)3.1 ä»Žå­—ç¬¦ä¸²çš„ç¬¬ 4 ä¸ªå­—ç¬¦ä½ç½®å¼€å§‹å–ï¼Œç›´åˆ°ç»“æŸã€‚ 123456mysql&gt; select substring('sqlstudy.com', 4);+------------------------------+| substring('sqlstudy.com', 4) |+------------------------------+| study.com |+------------------------------+ 3.2 ä»Žå­—ç¬¦ä¸²çš„ç¬¬ 4 ä¸ªå­—ç¬¦ä½ç½®å¼€å§‹å–ï¼Œåªå– 2 ä¸ªå­—ç¬¦ã€‚ 123456mysql&gt; select substring('sqlstudy.com', 4, 2);+---------------------------------+| substring('sqlstudy.com', 4, 2) |+---------------------------------+| st |+---------------------------------+ 3.3 ä»Žå­—ç¬¦ä¸²çš„ç¬¬ 4 ä¸ªå­—ç¬¦ä½ç½®ï¼ˆå€’æ•°ï¼‰å¼€å§‹å–ï¼Œç›´åˆ°ç»“æŸã€‚ 123456mysql&gt; select substring('sqlstudy.com', -4);+-------------------------------+| substring('sqlstudy.com', -4) |+-------------------------------+| .com |+-------------------------------+ 3.4 ä»Žå­—ç¬¦ä¸²çš„ç¬¬ 4 ä¸ªå­—ç¬¦ä½ç½®ï¼ˆå€’æ•°ï¼‰å¼€å§‹å–ï¼Œåªå– 2 ä¸ªå­—ç¬¦ã€‚ 123456mysql&gt; select substring('sqlstudy.com', -4, 2);+----------------------------------+| substring('sqlstudy.com', -4, 2) |+----------------------------------+| .c |+----------------------------------+ æˆ‘ä»¬æ³¨æ„åˆ°åœ¨å‡½æ•° substring(str,pos, len)ä¸­ï¼Œ pos å¯ä»¥æ˜¯è´Ÿå€¼ï¼Œä½† len ä¸èƒ½å–è´Ÿå€¼ã€‚ 4. å­—ç¬¦ä¸²æˆªå–ï¼šsubstring_index(str,delim,count)4.1 æˆªå–ç¬¬äºŒä¸ª â€˜.â€™ ä¹‹å‰çš„æ‰€æœ‰å­—ç¬¦ã€‚ 123456mysql&gt; select substring_index('www.sqlstudy.com.cn', '.', 2);+------------------------------------------------+| substring_index('www.sqlstudy.com.cn', '.', 2) |+------------------------------------------------+| www.sqlstudy |+------------------------------------------------+ 4.2 æˆªå–ç¬¬äºŒä¸ª â€˜.â€™ ï¼ˆå€’æ•°ï¼‰ä¹‹åŽçš„æ‰€æœ‰å­—ç¬¦ã€‚ 123456mysql&gt; select substring_index('www.sqlstudy.com.cn', '.', -2);+-------------------------------------------------+| substring_index('www.sqlstudy.com.cn', '.', -2) |+-------------------------------------------------+| com.cn |+-------------------------------------------------+ 4.3 å¦‚æžœåœ¨å­—ç¬¦ä¸²ä¸­æ‰¾ä¸åˆ° delim å‚æ•°æŒ‡å®šçš„å€¼ï¼Œå°±è¿”å›žæ•´ä¸ªå­—ç¬¦ä¸² 123456mysql&gt; select substring_index('www.sqlstudy.com.cn', '.coc', 1);+---------------------------------------------------+| substring_index('www.sqlstudy.com.cn', '.coc', 1) |+---------------------------------------------------+| www.sqlstudy.com.cn |+---------------------------------------------------+]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆ]]></title>
    <url>%2F2019%2F02%2F17%2F%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆæ•°æ®ä¸€è‡´æ€§ï¼ˆzkï¼‰ ä¸ºä»€ä¹ˆä¼šæœ‰åˆ†å¸ƒå¼äº‹åŠ¡æˆ‘ä»¬å‡è®¾æœ‰å¦‚ä¸‹ä¸€ä¸ªæž¶æž„ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç”µå•†æž¶æž„å¹³å°ï¼Œä¸¤ä¸ªåº”ç”¨èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ•°æ®åº“ï¼Œä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ã€‚è¿™ä¸ªæž¶æž„ä¸‹ï¼Œæ¯å¤©ä¼šäº§ç”Ÿå°†è¿‘100Wçš„è®¢å•é‡ã€‚é‚£ä¹ˆä¸€ä¸ªæœˆçš„æ•°æ®é‡å°±ä¼šè¶…è¿‡3000Wã€‚è€Œéšç€æ•°æ®é‡çš„ä¸æ–­æ‰©å¤§ï¼Œå¯¹äºŽè®¢å•è¡¨çš„ç›¸å…³æŸ¥è¯¢æ“ä½œçš„æ€§èƒ½å¼€é”€å°±è¶Šæ¥è¶Šå¤§ã€‚å¹¶ä¸”å“åº”è€—æ—¶ä¹Ÿè¶Šæ¥è¶Šé•¿ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°æ•°æ®åº“çš„ä¼˜åŒ–é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯å¯¹æ•°æ®åº“è¿›è¡Œåˆ†è¡¨åˆ†åº“ï¼Œè¾¾åˆ°åˆ†æ‘Šæ•°æ®åº“åŽ‹åŠ›ä»¥åŠå‡å°‘æ•°æ®åº“å•è¡¨æ•°æ®é‡çš„ç›®çš„ã€‚ åˆ†åº“åˆ†è¡¨ä»¥åŽå¸¦æ¥çš„é—®é¢˜åˆ†åº“åˆ†è¡¨ä»¥åŽï¼Œä¸€æ–¹é¢åˆ†æ‹…äº†å•åº“å¸¦æ¥çš„æ€§èƒ½åŽ‹åŠ›ï¼›å¦ä¸€æ–¹é¢ï¼Œå‡å°‘äº†å•è¡¨çš„æ•°æ®é‡ã€‚å®Œç¾Žçš„è§£å†³äº†æˆ‘ä»¬é‡åˆ°çš„æ€§èƒ½é—®é¢˜ã€‚ä½†æ˜¯ï¼Œéšç€è€Œæ¥çš„åˆæœ‰å¦å¤–çš„é—®é¢˜ã€‚ æ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œè®¢å•æ”¯ä»˜æˆåŠŸä»¥åŽéœ€è¦æ‰£å‡åº“å­˜ã€‚åœ¨æ•°æ®åº“åˆ†åº“åˆ†è¡¨ä¹‹å‰ï¼Œæ‰€æœ‰æ•°æ®éƒ½åœ¨åŒä¸€ä¸ªåº“é‡Œé¢ï¼Œå¯ä»¥é€šè¿‡äº‹åŠ¡æ“ä½œå°±å¾ˆå®¹æ˜“è¾¾åˆ°æ•°æ®ä¸€è‡´æ€§çš„ç›®çš„ã€‚ä½†æ˜¯åœ¨æ•°æ®åº“åšäº†æ‹†åˆ†åŽï¼Œè®¢å•çŠ¶æ€æ›´æ–°æ˜¯å±žäºŽè®¢å•çš„æ•°æ®åº“ï¼Œè€Œåº“å­˜æ‰£å‡æ˜¯å±žäºŽåº“å­˜çš„æ•°æ®åº“ã€‚åŽŸæœ¬å•åº“çš„äº‹åŠ¡æ“ä½œå°±å˜æˆäº†å¤šåº“çš„äº‹åŠ¡æ“ä½œã€‚ ä½†æ˜¯æ¯ä¸ªåº“çš„äº‹åŠ¡åªæœ‰è‡ªå·±çŸ¥é“ï¼Œè®¢å•åº“å¹¶ä¸çŸ¥é“åº“å­˜åº“çš„äº‹åŠ¡æ‰§è¡Œç»“æžœï¼Œåº“å­˜åº“ä¹Ÿä¸çŸ¥é“è®¢å•åº“çš„ä¿®æ”¹ç»“æžœã€‚æ‰€ä»¥å°±é€ æˆäº†åˆ†å¸ƒå¼äº‹åŠ¡çš„é—®é¢˜ã€‚å…¶å®žä¹Ÿå«åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§ã€‚ è®¤è¯†åˆ†å¸ƒå¼äº‹åŠ¡æ—¢ç„¶å­˜åœ¨åˆ†å¸ƒå¼äº‹åŠ¡çš„é—®é¢˜ï¼Œé‚£å°±ä¸€å®šæœ‰æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆæŽ¥ä¸‹æ¥æˆ‘ä»¬äº†è§£ä¸‹ä¸šå†…çš„å¸¸ç”¨è§£å†³æ–¹æ³•åŠåŽŸç† ç»å…¸çš„X/OpenDTPäº‹åŠ¡æ¨¡åž‹ X/Open DTP(X/Open Distributed Transaction Processing Reference Model) æ˜¯X/Openè¿™ä¸ªç»„ç»‡å®šä¹‰çš„ä¸€å¥—åˆ†å¸ƒå¼äº‹åŠ¡çš„æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰äº†è§„èŒƒå’ŒAPIæŽ¥å£ï¼Œç”±å„ä¸ªåŽ‚å•†è¿›è¡Œå…·ä½“çš„å®žçŽ°ã€‚ è¿™ä¸ªæ ‡å‡†æå‡ºäº†ä½¿ç”¨äºŒé˜¶æ®µæäº¤(2PC â€“ Two-Phase-Commit)æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„å®Œæ•´æ€§ã€‚åŽæ¥J2EEä¹Ÿéµå¾ªäº†X/OpenDTPè§„èŒƒï¼Œè®¾è®¡å¹¶å®žçŽ°äº†javaé‡Œçš„åˆ†å¸ƒå¼äº‹åŠ¡ç¼–ç¨‹æŽ¥å£è§„èŒƒ-JTA X/OpenDTPè§’è‰² åœ¨X/OpenDTPäº‹åŠ¡æ¨¡åž‹ä¸­ï¼Œå®šä¹‰äº†ä¸‰ä¸ªè§’è‰² AP: application, åº”ç”¨ç¨‹åºï¼Œä¹Ÿå°±æ˜¯ä¸šåŠ¡å±‚ã€‚å“ªäº›æ“ä½œå±žäºŽä¸€ä¸ªäº‹åŠ¡ï¼Œå°±æ˜¯APå®šä¹‰çš„ RMï¼š Resource Managerï¼Œèµ„æºç®¡ç†å™¨ã€‚ä¸€èˆ¬æ˜¯æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–èµ„æºç®¡ç†å™¨ï¼Œæ¯”å¦‚æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ–‡ä»¶ç³»ç»Ÿ TMï¼š Transaction Manager ï¼Œäº‹åŠ¡ç®¡ç†å™¨ã€äº‹åŠ¡åè°ƒè€…ï¼Œè´Ÿè´£æŽ¥æ”¶æ¥è‡ªç”¨æˆ·ç¨‹åºï¼ˆAPï¼‰å‘èµ·çš„XAäº‹åŠ¡æŒ‡ä»¤ï¼Œå¹¶è°ƒåº¦å’Œåè°ƒå‚ä¸Žäº‹åŠ¡çš„æ‰€æœ‰RMï¼ˆæ•°æ®åº“ï¼‰ï¼Œç¡®ä¿äº‹åŠ¡æ­£ç¡®å®Œæˆ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ªæœºå™¨èŠ‚ç‚¹è™½ç„¶éƒ½èƒ½å¤Ÿæ˜Žç¡®çŸ¥é“è‡ªå·±åœ¨è¿›è¡Œäº‹åŠ¡æ“ä½œè¿‡ç¨‹ä¸­çš„ç»“æžœæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œä½†å´æ— æ³•ç›´æŽ¥èŽ·å–åˆ°å…¶ä»–åˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ“ä½œç»“æžœã€‚å› æ­¤å½“ä¸€ä¸ªäº‹åŠ¡æ“ä½œéœ€è¦è·¨è¶Šå¤šä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¸ºäº†ä¿æŒäº‹åŠ¡å¤„ç†çš„ACIDç‰¹æ€§ï¼Œå°±éœ€è¦å¼•å…¥ä¸€ä¸ªâ€œåè°ƒè€…â€ï¼ˆTMï¼‰æ¥ç»Ÿä¸€è°ƒåº¦æ‰€æœ‰åˆ†å¸ƒå¼èŠ‚ç‚¹çš„æ‰§è¡Œé€»è¾‘ï¼Œè¿™äº›è¢«è°ƒåº¦çš„åˆ†å¸ƒå¼èŠ‚ç‚¹è¢«ç§°ä¸ºAPã€‚TMè´Ÿè´£è°ƒåº¦APçš„è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå†³å®šè¿™äº›APæ˜¯å¦è¦æŠŠäº‹åŠ¡çœŸæ­£è¿›è¡Œæäº¤åˆ°ï¼ˆRMï¼‰ å‚ä¸Žåˆ†å¸ƒå¼äº‹åŠ¡çš„åº”ç”¨ç¨‹åº(AP)å…ˆåˆ°TMä¸Šæ³¨å†Œå…¨å±€äº‹åŠ¡ ç„¶åŽå„ä¸ªAPç›´æŽ¥åœ¨ç›¸åº”çš„èµ„æºç®¡ç†å™¨(RM)ä¸Šè¿›è¡Œäº‹åŠ¡æ“ä½œ æ“ä½œå®Œæˆä»¥åŽï¼Œå„ä¸ªAPåé¦ˆäº‹åŠ¡çš„å¤„ç†ç»“æžœç»™åˆ°TM TMæ”¶åˆ°æ‰€æœ‰APçš„åé¦ˆä»¥åŽï¼Œé€šè¿‡æ•°æ®åº“æä¾›çš„XAæŽ¥å£è¿›è¡Œæ•°æ®æäº¤æˆ–è€…å›žæ»šæ“ä½œ 2pcæäº¤ï¼ˆtwo -phaseCommitï¼‰åœ¨X/OpenDTPæ¨¡åž‹ä¸­ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ‰€æ¶‰åŠçš„SQLé€»è¾‘éƒ½æ‰§è¡Œå®Œæˆï¼Œå¹¶åˆ°äº†ï¼ˆRMï¼‰è¦æœ€åŽæäº¤äº‹åŠ¡çš„å…³é”®æ—¶åˆ»ï¼Œä¸ºäº†é¿å…åˆ†å¸ƒå¼ç³»ç»Ÿæ‰€å›ºæœ‰çš„ä¸å¯é æ€§å¯¼è‡´æäº¤äº‹åŠ¡æ„å¤–å¤±è´¥ï¼ŒTM æžœæ–­å†³å®šå®žæ–½ä¸¤æ­¥èµ°çš„æ–¹æ¡ˆï¼Œè¿™ä¸ªå°±ç§°ä¸ºäºŒé˜¶æäº¤ äºŒé˜¶æ®µæäº¤ï¼Œæ˜¯è®¡ç®—æœºç½‘ç»œå°¤å…¶æ˜¯åœ¨æ•°æ®åº“é¢†åŸŸå†…ï¼Œä¸ºäº†ä½¿åŸºäºŽåˆ†å¸ƒå¼ç³»ç»Ÿæž¶æž„ä¸‹çš„æ‰€æœ‰èŠ‚ç‚¹åœ¨è¿›è¡Œäº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­èƒ½å¤Ÿä¿æŒåŽŸå­æ€§å’Œä¸€è‡´æ€§è€Œè®¾è®¡çš„ä¸€ç§ç®—æ³•ã€‚ é€šå¸¸ï¼ŒäºŒé˜¶æ®µæäº¤åè®®ä¹Ÿè¢«è®¤ä¸ºæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œç”¨æ¥ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®çš„ä¸€è‡´æ€§ã€‚ç›®å‰ï¼Œç»å¤§éƒ¨åˆ†çš„å…³ç³»åž‹æ•°æ®åº“éƒ½æ˜¯é‡‡ç”¨äºŒé˜¶æ®µæäº¤åè®®æ¥å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†çš„ï¼Œåˆ©ç”¨è¯¥åè®®èƒ½å¤Ÿéžå¸¸æ–¹ä¾¿åœ°å®Œæˆæ‰€æœ‰åˆ†å¸ƒå¼äº‹åŠ¡APçš„åè°ƒï¼Œç»Ÿä¸€å†³å®šäº‹åŠ¡çš„æäº¤æˆ–å›žæ»šï¼Œä»Žè€Œèƒ½å¤Ÿæœ‰æ•ˆä¿è¯åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§ï¼Œå› æ­¤2pcä¹Ÿè¢«å¹¿æ³›è¿ç”¨åœ¨è®¸å¤šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ ç¬¬ä¸€é˜¶æ®µ äº‹åŠ¡è¯¢é—® TMå‘æ‰€æœ‰çš„APå‘é€äº‹åŠ¡å†…å®¹ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶å¼€å§‹ç­‰å¾…å„APçš„å“åº” æ‰§è¡Œäº‹åŠ¡ å„ä¸ªAPèŠ‚ç‚¹æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†Undoå’ŒRedoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ï¼Œå°½é‡æŠŠæäº¤è¿‡ç¨‹ä¸­æ‰€æœ‰æ¶ˆè€—æ—¶é—´çš„æ“ä½œå’Œå‡†å¤‡éƒ½æå‰å®Œæˆç¡®ä¿åŽé¢100%æˆåŠŸæäº¤äº‹åŠ¡ å„ä¸ªAPå‘TMåé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº” å¦‚æžœå„ä¸ªAPæˆåŠŸæ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œé‚£ä¹ˆå°±åé¦ˆç»™AP yesçš„å“åº”ï¼Œè¡¨ç¤ºäº‹åŠ¡å¯ä»¥æ‰§è¡Œï¼›å¦‚æžœAPæ²¡æœ‰æˆåŠŸæ‰§è¡Œäº‹åŠ¡ï¼Œå°±åé¦ˆç»™TM noçš„å“åº”ï¼Œè¡¨ç¤ºäº‹åŠ¡ä¸å¯ä»¥æ‰§è¡Œ ä¸Šé¢è¿™ä¸ªé˜¶æ®µæœ‰ç‚¹ç±»ä¼¼TMç»„ç»‡å„ä¸ªAPå¯¹ä¸€æ¬¡äº‹åŠ¡æ“ä½œçš„æŠ•ç¥¨è¡¨æ€è¿‡ç¨‹ï¼Œå› æ­¤2pcåè®®çš„ç¬¬ä¸€ä¸ªé˜¶æ®µç§°ä¸ºâ€œæŠ•ç¥¨é˜¶æ®µâ€ï¼Œå³å„APæŠ•ç¥¨è¡¨åæ˜¯å¦éœ€è¦ç»§ç»­æ‰§è¡ŒæŽ¥ä¸‹åŽ»çš„äº‹åŠ¡æäº¤æ“ä½œã€‚ ç¬¬äºŒé˜¶æ®µäº‹åŠ¡æäº¤åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒTMä¼šæ ¹æ®å„APçš„åé¦ˆæƒ…å†µæ¥å†³å®šæœ€ç»ˆæ˜¯å¦å¯ä»¥è¿›è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œæ­£å¸¸æƒ…å†µä¸‹åŒ…å«ä¸¤ç§å¯èƒ½ å‡å¦‚TMä»Žæ‰€æœ‰å‚ä¸Žè€…èŽ·å¾—çš„åé¦ˆéƒ½æ˜¯yeså“åº”ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œäº‹åŠ¡æäº¤ å‘é€æäº¤è¯·æ±‚ TMå‘æ‰€æœ‰APèŠ‚ç‚¹å‘å‡ºcommitè¯·æ±‚ äº‹åŠ¡æäº¤ APæŽ¥æ”¶åˆ°Commitè¯·æ±‚åŽï¼Œä¼šæ­£å¼æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶åœ¨å®Œæˆæäº¤ä¹‹åŽé‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´å ç”¨çš„äº‹åŠ¡èµ„æº åé¦ˆäº‹åŠ¡æäº¤ç»“æžœ APåœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åŽï¼Œå‘TMå‘é€Ackæ¶ˆæ¯ å®Œæˆäº‹åŠ¡ TMæŽ¥æ”¶åˆ°æ‰€æœ‰APåé¦ˆçš„ackæ¶ˆæ¯åŽï¼Œå®Œæˆäº‹åŠ¡ äº‹åŠ¡å›žæ»šå¦‚æžœç¬¬ä¸€ä¸ªé˜¶æ®µä¸­çš„æŸä¸€ä¸ªèµ„æºé¢„æäº¤å¤±è´¥ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªé˜¶æ®µå°±å›žæ»šç¬¬ä¸€é˜¶æ®µå·²ç»é¢„æäº¤æˆåŠŸçš„èµ„æº å‡è®¾ä»»ä½•ä¸€ä¸ªAPå‘TMåé¦ˆäº†NOçš„å“åº”ï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åŽï¼ŒTMæ— æ³•æŽ¥æ”¶åˆ°æ‰€æœ‰APçš„åé¦ˆå“åº”ï¼Œé‚£ä¹ˆå°±ä¼šä¸­æ–­äº‹åŠ¡ å‘é€å›žæ»šè¯·æ±‚ TMå‘æ‰€æœ‰APå‘å‡ºabortè¯·æ±‚ äº‹åŠ¡å›žæ»š APæ”¶åˆ°abortè¯·æ±‚åŽï¼Œä¼šåˆ©ç”¨åœ¨ç¬¬ä¸€é˜¶æ®µè®°å½•çš„Undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡å›žæ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›žæ»šä¹‹åŽé‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´å ç”¨çš„èµ„æº åé¦ˆäº‹åŠ¡å›žæ»šç»“æžœ å„APåœ¨å®Œæˆäº‹åŠ¡å›žæ»šä¹‹åŽï¼Œå‘TMå‘é€Ackæ¶ˆæ¯ ä¸­ç«¯äº‹åŠ¡ TM æŽ¥æ”¶åˆ°æ‰€æœ‰APåé¦ˆçš„ackæ¶ˆæ¯åŽï¼Œå®Œæˆäº‹åŠ¡ä¸­æ–­ äºŒé˜¶æ®µæäº¤å°†ä¸€ä¸ªäº‹åŠ¡çš„å¤„ç†è¿‡ç¨‹åˆ†ä¸ºæŠ•ç¥¨å’Œæ‰§è¡Œä¸¤ä¸ªé˜¶æ®µ. äºŒé˜¶æ®µæäº¤çš„ä¼˜ç‚¹åœ¨äºŽï¼Œå®ƒå……åˆ†è€ƒè™‘åˆ°äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸å¯é å› ç´ ï¼Œå¹¶ä¸”é‡‡ç”¨éžå¸¸ç®€å•çš„æ–¹å¼ï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰å°±æŠŠç”±äºŽç³»ç»Ÿä¸å¯é ä»Žè€Œå¯¼è‡´äº‹åŠ¡æäº¤å¤±è´¥çš„æ¦‚çŽ‡é™åˆ°æœ€å° å‡å¦‚ä¸€ä¸ªäº‹åŠ¡çš„æäº¤è¿‡ç¨‹æ€»å…±éœ€è¦30ç§’çš„æ“ä½œï¼Œå…¶ä¸­prepareé˜¶æ®µéœ€è¦28ç§’ï¼ˆä¸»è¦æ˜¯ç¡®ä¿äº‹åŠ¡æ—¥å¿—è½åœ°ç£ç›˜ç­‰å„ç§è€—æ—¶çš„I/Oæ“ä½œï¼‰ï¼ŒçœŸæ­£çš„commité˜¶æ®µåªéœ€è¦èŠ±è´¹ä¸¤ç§’ï¼Œé‚£ä¹ˆCommité˜¶æ®µå‘ç”Ÿé”™è¯¯çš„æ¦‚çŽ‡ä¸ŽPrepareé˜¶æ®µç›¸æ¯”ï¼Œåªæ˜¯å®ƒçš„2/28(&lt;10%)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœPrepareé˜¶æ®µæˆåŠŸäº†ï¼Œåˆ™Commité˜¶æ®µç”±äºŽæ—¶é—´éžå¸¸ç«¯ï¼Œå¤±è´¥æ¦‚çŽ‡å°ï¼Œä¼šå¤§å¤§å¢žåŠ åˆ†å¸ƒå¼äº‹åŠ¡æˆåŠŸçš„æ¦‚çŽ‡ã€‚ 2pcåè®®çš„ä¼˜ç¼ºç‚¹ åŽŸç†ç®€å•ï¼Œå®žçŽ°å¾ˆæ–¹ä¾¿ æ¯ä¸€ä¸ªé˜¶æ®µéƒ½æ˜¯åŒæ­¥é˜»å¡žï¼Œä¼šé€ æˆæ€§èƒ½æŸè€—ã€‚ åè°ƒè€…å­˜åœ¨å•ç‚¹é—®é¢˜ï¼Œå¦‚æžœåè°ƒè€…åœ¨ç¬¬äºŒé˜¶æ®µå‡ºçŽ°æ•…éšœï¼Œé‚£ä¹ˆå…¶ä»–å‚ä¸Žè€…ä¼šä¸€ç›´å¤„äºŽé”å®šçŠ¶æ€ã€‚ å¤ªè¿‡ä¿å®ˆï¼Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¤±è´¥éƒ½ä¼šå¯¼è‡´æ•°æ®å›žæ»š æ•°æ®ä¸ä¸€è‡´é—®é¢˜: åœ¨é˜¶æ®µäºŒä¸­ï¼Œå½“åè°ƒè€…å‘æ‰€æœ‰çš„å‚ä¸Žè€…å‘é€commitè¯·æ±‚åŽï¼Œå‘ç”Ÿäº†ç½‘ç»œå¼‚å¸¸å¯¼è‡´åè°ƒè€…åœ¨å°šæœªå‘å®Œcommitè¯·æ±‚ä¹‹å‰å´©æºƒï¼Œå¯èƒ½ä¼šå¯¼è‡´åªæœ‰éƒ¨åˆ†çš„å‚ä¸Žè€…æŽ¥æ”¶åˆ°commitè¯·æ±‚ï¼Œå‰©ä¸‹æ²¡æ”¶åˆ°commitè¯·æ±‚çš„å‚ä¸Žè€…å°†æ— æ³•æäº¤äº‹åŠ¡ï¼Œä¹Ÿå°±å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ 3PC3PCåè®®ä¸»è¦ç”¨æ¥è§£å†³2PCçš„åŒæ­¥é˜»å¡žé—®é¢˜çš„ä¸€ç§ä¼˜åŒ–æ–¹æ¡ˆï¼Œ3pcåˆ†ä¸º3ä¸ªé˜¶æ®µåˆ†åˆ«ä¸ºï¼šcancommitã€Precommitã€doCommitã€‚ å’Œ2é˜¶æ®µæäº¤çš„åŒºåˆ«åœ¨äºŽï¼š (1) åœ¨åè°ƒè€…å’Œå‚ä¸Žè€…ä¸­å¼•å…¥äº†è¶…æ—¶æœºåˆ¶ï¼Œ2pcåªæœ‰åœ¨åè°ƒè€…æ‹¥æœ‰è¶…æ—¶æœºåˆ¶,åè°ƒè€…åœ¨ä¸€å®šæ—¶é—´å†…æ²¡å—åˆ°å‚ä¸Žè€…çš„ä¿¡æ¯åˆ™é»˜è®¤ä¸ºå¤±è´¥ï¼› (2) æŠŠ2é˜¶æ®µæäº¤çš„ç¬¬ä¸€ä¸ªé˜¶æ®µæ‹†åˆ†æˆäº†ä¸¤ä¸ªæ­¥éª¤ã€‚ cancommité˜¶æ®µåè°ƒè€…å‘å‚ä¸Žè€…å‘é€commitè¯·æ±‚ï¼Œå‚ä¸Žè€…å¦‚æžœå¯ä»¥æäº¤å°±è¿”å›žyesçš„å“åº”ï¼Œå¦åˆ™è¿”å›žNoçš„å“åº”ã€‚è¿™ä¸€é˜¶æ®µä¸»è¦æ˜¯ç¡®å®šåˆ†å¸ƒå¼äº‹åŠ¡çš„å‚ä¸Žè€…æ˜¯å¦å…·å¤‡äº†å®Œæˆcommitçš„æ¡ä»¶ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œã€‚ è¯¢é—®å‚ä¸Žè€…æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œ æ­£å¸¸æƒ…å†µä¸‹åªè¦èƒ½å¤Ÿé¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼Œå°±è¿”å›žyesçš„å“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ã€‚ precommité˜¶æ®µäº‹åŠ¡åè°ƒè€…æ ¹æ®å‚ä¸Žè€…çš„åé¦ˆæƒ…å†µæ¥å†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œäº‹åŠ¡çš„precommitæ“ä½œï¼Œåœ¨è¿™ä¸€ä¸ªé˜¶æ®µï¼Œä¼šæœ‰ä¸¤ç§å¯èƒ½æ€§ï¼Œç¬¬ä¸€ç§æ˜¯ï¼Œåœ¨cancommité˜¶æ®µæ‰€æœ‰å‚ä¸Žè€…éƒ½åé¦ˆçš„æ˜¯yesï¼Œåˆ™ä¼šè¿›è¡Œäº‹åŠ¡é¢„æ‰§è¡Œ åè°ƒè€…TMå‘å‚ä¸Žè€…APå‘é€precommitè¯·æ±‚ å‚ä¸Žè€…æ”¶åˆ°precommitè¯·æ±‚åŽï¼Œæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶æŠŠäº‹åŠ¡çš„undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ è¿”å›žäº‹åŠ¡çš„æ‰§è¡Œç»“æžœç»™åˆ°åè°ƒè€…ï¼Œå¹¶ç­‰å¾…æœ€ç»ˆçš„æäº¤æŒ‡ä»¤ å¦‚æžœä»»æ„ä¸€ä¸ªäº‹åŠ¡å‚ä¸Žè€…åœ¨ç¬¬ä¸€é˜¶æ®µè¿”å›žäº†noï¼Œåˆ™æ‰§è¡Œäº‹åŠ¡ä¸­æ–­è¯·æ±‚ å‘æ‰€æœ‰äº‹åŠ¡å‚ä¸Žè€…å‘é€äº‹åŠ¡ä¸­æ–­è¯·æ±‚ å¯¹äºŽäº‹åŠ¡å‚ä¸Žè€…æ¥è¯´ï¼Œæ— è®ºæ˜¯æ”¶åˆ°åè°ƒè€…çš„ä¸­æ–­è¯·æ±‚ï¼Œè¿˜æ˜¯ç­‰å¾…åè°ƒè€…æŒ‡ä»¤ä¹‹å‰å‡ºçŽ°è¶…æ—¶ï¼Œå‚ä¸Žè€…éƒ½ä¼šä¸­æ–­äº‹åŠ¡ doCommité˜¶æ®µè¿™ä¸ªé˜¶æ®µåŒæ ·å­˜åœ¨ä¸¤ç§æƒ…å†µï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œprecommitéƒ½å“åº”äº†ackç»™åˆ°åè°ƒè€…ï¼Œé‚£ä¹ˆåè°ƒè€…ä¼šå‘èµ·äº‹åŠ¡æäº¤è¯·æ±‚ã€‚ åè°ƒè€…å‘æ‰€æœ‰å‚ä¸Žè€…å‘é€docommitè¯·æ±‚ å‚ä¸Žè€…æ”¶åˆ°docommitè¯·æ±‚åŽï¼Œæ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶é‡Šæ”¾æ‰€æœ‰äº‹åŠ¡èµ„æº äº‹åŠ¡æäº¤ä»¥åŽè¿”å›žackç»™åˆ°åè°ƒè€… åè°ƒè€…æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…çš„å“åº”åŽï¼Œå®Œæˆäº‹åŠ¡ å¦‚æžœåœ¨precommité˜¶æ®µï¼Œæœ‰å‚ä¸Žè€…æ²¡æœ‰å‘é€ackç»™åˆ°åè°ƒè€…ï¼Œé‚£ä¹ˆåˆ™æ‰§è¡Œäº‹åŠ¡ä¸­æ–­æŒ‡ä»¤ åè°ƒè€…å‘æ‰€æœ‰å‚ä¸Žè€…å‘é€ä¸­æ–­äº‹åŠ¡çš„è¯·æ±‚ å‚ä¸Žè€…æ”¶åˆ°è¯·æ±‚ä»¥åŽï¼Œåˆ©ç”¨åœ¨ç¬¬äºŒä¸ªé˜¶æ®µè®°å½•çš„undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡å›žæ»šæ“ä½œ å‘åè°ƒè€…å‘é€ackæ¶ˆæ¯ï¼Œåè°ƒè€…æ”¶åˆ°æ¶ˆæ¯ä»¥åŽï¼Œæ‰§è¡Œäº‹åŠ¡ä¸­æ–­æ“ä½œ åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§åœ¨javaä¸­ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸»è¦çš„è§„èŒƒæ˜¯JTA/XA . JTAæ˜¯javaçš„äº‹åŠ¡ç®¡ç†å™¨è§„èŒƒï¼ŒJTAå…¨ç§°ä¸ºJava Transaction API, JTAå®šä¹‰äº†ä¸€ç»„ç»Ÿä¸€çš„äº‹åŠ¡ç¼–ç¨‹çš„æŽ¥å£ï¼ŒåŸºäºŽX/OpenDTPè§„èŒƒè®¾è®¡çš„åˆ†å¸ƒå¼äº‹åŠ¡ç¼–ç¨‹æŽ¥å£è§„èŒƒã€‚XAæ˜¯å·¥ä¸šæ ‡å‡†çš„X/Open DTPè§„èŒƒ åŸºäºŽJTAè§„èŒƒçš„ç¬¬ä¸‰æ–¹åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æž¶æœ‰Jotmå’ŒAtomikos JOTMJOTM ï¼ˆjava open transaction managerï¼‰æ˜¯ObjectWebçš„ä¸€ä¸ªå¼€æºJTAå®žçŽ°ï¼Œæä¾›JTAåˆ†å¸ƒå¼äº‹åŠ¡çš„åŠŸèƒ½ ä½†æ˜¯JOTMå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ä½¿ç”¨ä¸­ä¸èƒ½è‡ªåŠ¨rollbackï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µéƒ½commitã€‚ Atomikosä¸ŽJOTMç›¸æ¯”ï¼ŒAtomikos æ›´åŠ ç¨³å®šï¼ŒåŽŸæœ¬Atomikosæ˜¯å•†ä¸šé¡¹ç›®ï¼ŒåŽæ¥å¼€æºã€‚è®ºå›æ¯”è¾ƒæ´»è·ƒï¼Œæœ‰é—®é¢˜å¯ä»¥éšæ—¶è§£å†³ äº’è”ç½‘è¡Œä¸šçš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜è§£å†³æ–¹æ¡ˆç›®å‰äº’è”ç½‘é¢†åŸŸé‡Œæœ‰å‡ ç§æµè¡Œçš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œä½†éƒ½æ²¡æœ‰åƒä¹‹å‰æ‰€è¯´çš„XAäº‹åŠ¡ä¸€æ ·å½¢æˆX/OpenDTPé‚£æ ·çš„å·¥ä¸šè§„èŒƒï¼Œè€Œæ˜¯ä»…ä»…åœ¨å…·ä½“çš„è¡Œä¸šé‡ŒèŽ·å¾—è¾ƒå¤šçš„è®¤å¯ï¼› æˆ‘ä»¬æœ€æ—©çš„æ—¶å€™è®²è¿‡CAPå’ŒBASEç†è®ºï¼Œå¯¹äºŽCAPæ¥è¯´ï¼Œå¯¹äºŽå…±äº«æ•°æ®çš„ç³»ç»Ÿï¼Œç”±äºŽç½‘ç»œåˆ†åŒºé—®é¢˜çš„å­˜åœ¨ï¼Œæˆ‘ä»¬åªèƒ½æ»¡è¶³APæˆ–è€…CPï¼›å¯¹äºŽBASEç†è®ºï¼Œæ»¡è¶³åŸºæœ¬å¯ç”¨ã€‚æ‰€ä»¥å…¶å®žæˆ‘ä»¬åœ¨è½åœ°æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆæ˜¯ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šé€‰æ‹©ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œä¹Ÿå°±æ˜¯é…¸ç¢±å¹³è¡¡ç†è®ºï¼ŒACIDæ˜¯é…¸ã€ BASEæ˜¯ç¢±ï¼›ACIDæ˜¯å¼ºä¸€è‡´æ€§ã€BASEæ˜¯å¼±ä¸€è‡´æ€§ã€‚å¼ºä¸€è‡´æ€§ä»£è¡¨æ•°æ®åº“æœ¬èº«ä¸ä¼šå‡ºçŽ°ä¸ä¸€è‡´ï¼Œæ¯ä¸ªäº‹åŠ¡æ˜¯åŽŸå­çš„ï¼Œæˆ–è€…æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œäº‹ç‰©é—´æ˜¯éš”ç¦»çš„ï¼Œäº’ç›¸å®Œå…¨ä¸å½±å“ï¼Œè€Œä¸”æœ€ç»ˆçŠ¶æ€æ˜¯æŒä¹…è½ç›˜çš„ï¼Œå› æ­¤ï¼Œæ•°æ®åº“ä¼šä»Žä¸€ä¸ªæ˜Žç¡®çš„çŠ¶æ€åˆ°å¦å¤–ä¸€ä¸ªæ˜Žç¡®çš„çŠ¶æ€.; è€ŒBASEä½“çŽ°çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œå…è®¸å‡ºçŽ°ä¸­é—´çŠ¶æ€ã€‚ æ‰€ä»¥å¯¹äºŽå¯¹äºŽæœåŠ¡æ¥è¯´ï¼Œæœ‰å¾ˆå¤šçš„æ–¹æ¡ˆåŽ»é€‰æ‹©ï¼š æä¾›æŸ¥è¯¢æœåŠ¡ç¡®è®¤æ•°æ®çŠ¶æ€ã€ å¹‚ç­‰æ“ä½œå¯¹äºŽé‡å‘ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€ TCCäº‹åŠ¡æ“ä½œã€ è¡¥å¿æ“ä½œã€ å®šæœŸæ ¡å¯¹ã€‚ ä¸šåŠ¡æŽ¥å£æ•´åˆï¼Œé¿å…åˆ†å¸ƒå¼äº‹åŠ¡è¿™ä¸ªæ–¹æ¡ˆå°±æ˜¯æŠŠä¸€ä¸ªä¸šåŠ¡æµç¨‹ä¸­éœ€è¦åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œæ‰§è¡Œçš„å¤šä¸ªç›¸å…³ä¸šåŠ¡æŽ¥å£åŒ…è£…æ•´åˆåˆ°ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è®²A/B/Cæ•´åˆä¸ºä¸€ä¸ªæœåŠ¡Dæ¥å®žçŽ°å•ä¸€äº‹åŠ¡çš„ä¸šåŠ¡æµç¨‹æœåŠ¡ æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆeBayåœ¨2008å¹´å…¬å¸ƒäº†ä¸€ä¸ªå…³äºŽBASEå‡†åˆ™æåˆ°ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚eBayçš„æ–¹æ¡ˆå…¶å®žæ˜¯ä¸€ä¸ªæœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆï¼Œå®ƒä¸»è¦é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥è¾…åŠ©å®žçŽ°äº‹åŠ¡æŽ§åˆ¶æµç¨‹ï¼Œæ–¹æ¡ˆçš„æ ¸å¿ƒæ˜¯å°†éœ€è¦åˆ†å¸ƒå¼å¤„ç†çš„ä»»åŠ¡é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼æ¥å¼‚æ­¥æ‰§è¡Œï¼Œå¦‚æžœäº‹åŠ¡å¤±è´¥ï¼Œåˆ™å¯ä»¥å‘èµ·äººå·¥é‡è¯•çš„çº æ­£æµç¨‹ã€‚äººå·¥é‡è¯•è¢«æ›´å¤šçš„åº”ç”¨äºŽæ”¯ä»˜åœºæ™¯ï¼Œé€šè¿‡å¯¹è´¦ç³»ç»Ÿå¯¹äº‹åŽé—®é¢˜è¿›è¡Œå¤„ç† æ¯”å¦‚ä¸€ä¸ªå¾ˆå¸¸è§çš„åœºæ™¯ï¼šæŸä¸ªç”¨æˆ·äº§ç”Ÿäº†ä¸€ç¬”äº¤æ˜“ï¼Œé‚£ä¹ˆéœ€è¦åœ¨äº¤æ˜“è¡¨ä¸­å¢žåŠ è®°å½•ï¼ŒåŒæ—¶éœ€è¦ä¿®æ”¹ç”¨æˆ·è¡¨çš„é‡‘é¢ï¼ˆä½™é¢ï¼‰ï¼Œç”±äºŽè¿™ä¸¤ä¸ªè¡¨å±žäºŽä¸åŒçš„è¿œç¨‹æœåŠ¡ï¼Œæ‰€ä»¥å°±ä¼šæ¶‰åŠåˆ°åˆ†å¸ƒå¼äº‹åŠ¡ä¸Žæ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ å…³äºŽçŠ¶æ€æœºåœ¨ä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§çš„æ–¹æ¡ˆæ—¶ï¼Œä¸€å®šè¦æåˆ°çš„ä¸€ä¸ªæ¦‚å¿µæ˜¯çŠ¶æ€æœºã€‚ ä»€ä¹ˆæ˜¯çŠ¶æ€æœºï¼Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç»„ç»‡ä»£ç çš„æ–¹å¼ï¼Œç”¨è¿™ç§æ–¹å¼èƒ½å¤Ÿç¡®ä¿ä½ çš„å¯¹è±¡éšæ—¶éƒ½çŸ¥é“è‡ªå·±æ‰€å¤„çš„çŠ¶æ€ä»¥åŠæ‰€èƒ½åšçš„æ“ä½œã€‚å®ƒä¹Ÿæ˜¯ä¸€ç§ç”¨æ¥è¿›è¡Œå¯¹è±¡è¡Œä¸ºå»ºæ¨¡çš„å·¥å…·ï¼Œç”¨äºŽæè¿°å¯¹è±¡åœ¨å®ƒçš„ç”Ÿå‘½å‘¨æœŸå†…æ‰€ç»åŽ†çš„çŠ¶æ€åºåˆ—ï¼Œä»¥åŠå¦‚ä½•å“åº”æ¥è‡ªå¤–ç•Œçš„å„ç§äº‹ä»¶ã€‚ çŠ¶æ€æœºè¿™ä¸ªæ¦‚å¿µå¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œæ¯”å¦‚TCPåè®®çš„çŠ¶æ€æœºã€‚åŒæ—¶æˆ‘ä»¬åœ¨ç¼–å†™ç›¸å…³ä¸šåŠ¡é€»è¾‘çš„æ—¶å€™ç»å¸¸ä¹Ÿä¼šéœ€è¦å¤„ç†å„ç§äº‹ä»¶å’ŒçŠ¶æ€çš„åˆ‡æ¢ï¼Œæ¯”å¦‚switchã€if/elseã€‚æ‰€ä»¥æˆ‘ä»¬å…¶å®žä¸€ç›´åœ¨è·ŸçŠ¶æ€æœºæ‰“äº¤é“ï¼Œåªæ˜¯å¯èƒ½æ²¡æœ‰æ„è¯†åˆ°è€Œå·²ã€‚åœ¨å¤„ç†ä¸€äº›ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚çš„éœ€æ±‚æ—¶ï¼Œå¯ä»¥å…ˆçœ‹çœ‹æ˜¯å¦é€‚åˆç”¨ä¸€ä¸ªæœ‰é™çŠ¶æ€æœºæ¥æè¿°ï¼Œå¦‚æžœå¯ä»¥æŠŠä¸šåŠ¡æ¨¡åž‹æŠ½è±¡æˆä¸€ä¸ªæœ‰é™çŠ¶æ€æœºï¼Œé‚£ä¹ˆä»£ç å°±ä¼šé€»è¾‘ç‰¹åˆ«æ¸…æ™°ï¼Œç»“æž„ç‰¹åˆ«è§„æ•´ã€‚ æ¯”å¦‚æˆ‘ä»¬æ¥ç®€å•æè¿°ä¸€ä¸ªè®¢å• æˆ‘ä»¬ä»¥æ”¯ä»˜ä¸ºä¾‹ï¼Œä¸€ç¬”è®¢å•å¯èƒ½ä¼šæœ‰ç­‰å¾…æ”¯ä»˜ã€æ”¯ä»˜ä¸­ã€å·²æ”¯ä»˜ç­‰çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å…ˆåŽ»æŠŠå¯èƒ½å‡ºçŽ°çš„çŠ¶æ€ä»¥åŠçŠ¶æ€çš„æµç¨‹ç”»å‡ºæ¥ã€‚ çŠ¶æ€æœºçš„ä¸¤ä¸ªä½œç”¨ å®žçŽ°å¹‚ç­‰ é€šè¿‡çŠ¶æ€é©±åŠ¨æ•°æ®çš„å˜åŒ– ä¸šåŠ¡æµç¨‹ä»¥åŠé€»è¾‘æ›´åŠ æ¸…æ™°ï¼Œç‰¹åˆ«æ˜¯åº”å¯¹å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ ä»€ä¹ˆæ˜¯å¹‚ç­‰ç®€å•æ¥è¯´ï¼šé‡å¤è°ƒç”¨å¤šæ¬¡äº§ç”Ÿçš„ä¸šåŠ¡ç»“æžœä¸Žè°ƒç”¨ä¸€æ¬¡äº§ç”Ÿçš„ä¸šåŠ¡ç»“æžœç›¸åŒï¼› åœ¨åˆ†å¸ƒå¼æž¶æž„ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªè¿œç¨‹æœåŠ¡åŽ»å®Œæˆä¸€ä¸ªæ“ä½œï¼Œé™¤äº†æˆåŠŸå’Œå¤±è´¥ä»¥å¤–ï¼Œè¿˜æœ‰æœªçŸ¥çŠ¶æ€ï¼Œé‚£ä¹ˆé’ˆå¯¹è¿™ä¸ªæœªçŸ¥çŠ¶æ€ï¼Œæˆ‘ä»¬ä¼šé‡‡å–ä¸€äº›é‡è¯•çš„è¡Œä¸ºï¼› æˆ–è€…åœ¨æ¶ˆæ¯ä¸­é—´ä»¶çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¼šé‡å¤æ”¶åˆ°æ¶ˆæ¯ã€‚å¯¹äºŽè¿™ä¸¤ç§æƒ…å†µï¼Œæ¶ˆè´¹ç«¯æˆ–è€…æœåŠ¡ç«¯éœ€è¦é‡‡å–ä¸€å®šçš„æ‰‹æ®µï¼Œä¹Ÿå°±æ˜¯è€ƒè™‘åˆ°é‡å‘çš„æƒ…å†µä¸‹ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚ä¸€èˆ¬æˆ‘ä»¬å¸¸ç”¨çš„æ‰‹æ®µ çŠ¶æ€æœºå®žçŽ°å¹‚ç­‰ æ•°æ®åº“å”¯ä¸€çº¦æŸå®žçŽ°å¹‚ç­‰ é€šè¿‡tokenidçš„æ–¹å¼åŽ»è¯†åˆ«æ¯æ¬¡è¯·æ±‚åˆ¤æ–­æ˜¯å¦é‡å¤ åŸºäºŽæ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆå®žè·µåœ¨æœ€ç»ˆä¸€è‡´æ€§è¿™ä¸ªæ–¹æ¡ˆä¸Šï¼Œä¹Ÿæœ‰ä¸¤ç§é€‰æ‹©æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯åŸºäºŽå¯é æ¶ˆæ¯ä¸­é—´ä»¶æ¥å®žçŽ°å¼‚æ­¥çš„æœ€ç»ˆä¸€è‡´æ€§ã€å¦ä¸€ç§å°±æ˜¯é€šè¿‡MQæ¥å®žçŽ°æœ€å¤§åŠªåŠ›é€šçŸ¥åž‹ã€‚è¿™ä¸¤ç§éƒ½æ¯”è¾ƒå¸¸è§ï¼Œæ¯”å¦‚å¤§å®¶å¦‚æžœå¯¹æŽ¥è¿‡æ”¯ä»˜å®æ”¯ä»˜çš„apiï¼Œå°±åº”è¯¥èƒ½çŸ¥é“ï¼Œå½“ä½ è°ƒç”¨æ”¯ä»˜æ”¯ä»˜ æˆåŠŸä»¥åŽï¼Œæ”¯ä»˜å®ä¼šæä¾›ä¸€ä¸ªå¼‚æ­¥å›žè°ƒï¼Œè°ƒç”¨é…ç½®å¥½çš„æŒ‡å®šçš„æŽ¥å£åœ°å€ã€‚åœ¨è¿™ä¸ªæŽ¥å£ä¸­ï¼Œä½ å¯ä»¥èŽ·å¾—æ”¯ä»˜å®çš„æ”¯ä»˜ç»“æžœå¹¶æ ¹æ®ç»“æžœåšç›¸åº”çš„å¤„ç†ã€‚æœ€åŽå¿…é¡»è¦è¿”å›žä¸€ä¸ªackç»™åˆ°æ”¯ä»˜å®çš„å›žè°ƒapiï¼Œå‘Šè¯‰ä»–è¿™è¾¹å·²ç»å¤„ç†æˆåŠŸäº†ã€‚å¦åˆ™ï¼Œæ”¯ä»˜å®çš„å¼‚æ­¥å›žè°ƒä¼šä¸æ–­é‡è¯•ï¼Œå½“ç„¶æœ‰é‡è¯•æ¬¡æ•°ï¼Œä»¥åŠé‡è¯•çš„é—´éš”æ—¶é—´ã€‚é‚£æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ç¬¬ä¸€ç§æ–¹æ¡ˆæ¥å®žçŽ°æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ é€šè¿‡å¼‚æ­¥æ¶ˆæ¯æ‰§è¡Œæ–¹æ¡ˆçš„æœ¬è´¨æ˜¯ï¼ŒæŠŠä¸¤ä¸ªäº‹ç‰©è½¬åŒ–æˆä¸¤ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œç„¶åŽä¾é æ¶ˆæ¯æœ¬èº«çš„å¯é æ€§ï¼Œä»¥åŠæ¶ˆæ¯çš„é‡è¯•æœºåˆ¶è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>äº‹åŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring session ä¸ŽJWTã€OAuth2]]></title>
    <url>%2F2019%2F02%2F17%2FSpring-session-%E4%B8%8EJWT%E3%80%81OAtuh2%2F</url>
    <content type="text"><![CDATA[spring-session-data-redissesssionå­˜çš„å€¼åŠå±žæ€§get spring:session:sessions:expires:381be901-f399-443d-baf7-a274a98ac019 å¾—åˆ°maxInactiveIntervallastAccessedTimecreationTimesessionAttr:Mic 1request.getSession().setAttribute("Mic","value"); 123456789127.0.0.1:6379&gt; hgetall spring:session:sessions:e8b7c9a1-8c4a-4f03-996f-619cfba91ea11) "maxInactiveInterval"2) "\xac\xed\x00\x05sr\x00\x11java.lang.Integer\x12\xe2\xa0\xa4\xf7\x81\x878\x02\x00\x01I\x00\x05valuexr\x00\x10java.lang.Number\x86\xac\x95\x1d\x0b\x94\xe0\x8b\x02\x00\x00xp\x00\x00\x02X"3) "lastAccessedTime"4) "\xac\xed\x00\x05sr\x00\x0ejava.lang.Long;\x8b\xe4\x90\xcc\x8f#\xdf\x02\x00\x01J\x00\x05valuexr\x00\x10java.lang.Number\x86\xac\x95\x1d\x0b\x94\xe0\x8b\x02\x00\x00xp\x00\x00\x01h\xf9\xbb\xcc\xff"5) "sessionAttr:Mic"6) "\xac\xed\x00\x05t\x00\x05value"7) "creationTime"8) "\xac\xed\x00\x05sr\x00\x0ejava.lang.Long;\x8b\xe4\x90\xcc\x8f#\xdf\x02\x00\x01J\x00\x05valuexr\x00\x10java.lang.Number\x86\xac\x95\x1d\x0b\x94\xe0\x8b\x02\x00\x00xp\x00\x00\x01h\xf9\xb6\xd0\xf5" è¿‡æœŸæ—¶é—´get spring:session:sessions:expires:e8b7c9a1-8c4a-4f03-996f-619cfba91ea1 1127.0.0.1:6379&gt; get spring:session:sessions:expires:e8b7c9a1-8c4a-4f03-996f-619cfba91ea1 JWT https://jwt.io éªŒè¯ç­¾åè§„èŒƒ header1234&#123; "alg": "HS256", "typ": "JWT"&#125; payload12345&#123; "sub": "1234567890", "name": "John Doe", "iat": 1516239022&#125; ç­¾åç®—æ³• verify signature12345HMACSHA256( base64UrlEncode(header) + "." + base64UrlEncode(payload),"your-256-bit-secret") your-256-bit-secret ç±»ä¼¼ç§˜é’¥ 12345HMACSHA256( base64UrlEncode(header) + "." + base64UrlEncode(payload), secret) ä»£ç å‚è€ƒ https://gitee.com/Joey_z/vip-project-space/blob/master/user-service/user-provider/src/main/java/com/gupaoedu/user/utils/JwtTokenUtils.java 1234567891011121314151617181920212223242526272829303132333435363738394041public class JwtTokenUtils &#123; public static void main(String[] args) &#123; System.out.println(UUID.randomUUID(). toString().replace("-","")); &#125; //å®šä¹‰your-256-bit-secret private static Key generatorKey()&#123; SignatureAlgorithm saa=SignatureAlgorithm.HS256; byte[] bin=DatatypeConverter.parseBase64Binary ("f3973b64918e4324ad85acea1b6cbec5"); Key key=new SecretKeySpec(bin,saa.getJcaName()); return key; &#125; public static String generatorToken(Map&lt;String,Object&gt; payLoad)&#123; ObjectMapper objectMapper=new ObjectMapper(); try &#123; //å®šä¹‰payload return Jwts.builder().setPayload(objectMapper.writeValueAsString(payLoad)) //Jwt SignatureAlgorithm.HS256å®šä¹‰äº†header .signWith(SignatureAlgorithm.HS256,generatorKey()).compact(); &#125; catch (JsonProcessingException e) &#123; e.printStackTrace(); &#125; return null; &#125; public static Claims phaseToken(String token)&#123; Jws&lt;Claims&gt; claimsJwt=Jwts.parser().setSigningKey(generatorKey()).parseClaimsJws(token); return claimsJwt.getBody(); &#125;&#125; OAuth2]]></content>
      <categories>
        <category>Spring</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spring-MVC DispatchServlet HanderInteceptoråˆ†æž]]></title>
    <url>%2F2019%2F02%2F17%2FSpring-MVC-DispatchServlet-HanderInteceptor%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[DispatchServlet #doDispatchæ–¹æ³•12345678910111213if (!mappedHandler.applyPreHandle(processedRequest, response)) &#123; return;&#125;// Actually invoke the handler.mv = ha.handle(processedRequest, response, mappedHandler.getHandler());if (asyncManager.isConcurrentHandlingStarted()) &#123; return;&#125;applyDefaultViewName(processedRequest, mv);mappedHandler.applyPostHandle(processedRequest, response, mv); HandlerExecutionChain#applyPreHandleå®žé™…ä¸Šè´£ä»»é“¾æ¨¡å¼ï¼Œåˆ†åˆ«æ‰§è¡Œæ¯ä¸ªHandlerInterceptorçš„preHandleæ–¹æ³• 1private HandlerInterceptor[] interceptors; 1234567891011121314boolean applyPreHandle(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; HandlerInterceptor[] interceptors = getInterceptors(); if (!ObjectUtils.isEmpty(interceptors)) &#123; for (int i = 0; i &lt; interceptors.length; i++) &#123; HandlerInterceptor interceptor = interceptors[i]; if (!interceptor.preHandle(request, response, this.handler)) &#123; triggerAfterCompletion(request, response, null); return false; &#125; this.interceptorIndex = i; &#125; &#125; return true;&#125; HandlerExecutionChain#applyPostHandle123456789void applyPostHandle(HttpServletRequest request, HttpServletResponse response, ModelAndView mv) throws Exception &#123; HandlerInterceptor[] interceptors = getInterceptors(); if (!ObjectUtils.isEmpty(interceptors)) &#123; for (int i = interceptors.length - 1; i &gt;= 0; i--) &#123; HandlerInterceptor interceptor = interceptors[i]; interceptor.postHandle(request, response, this.handler, mv); &#125; &#125;&#125;]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring-MVC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç²¾å°½ Dubbo æºç åˆ†æž â€”â€” 01API é…ç½®ï¼ˆä¸€ï¼‰ä¹‹åº”ç”¨]]></title>
    <url>%2F2019%2F02%2F11%2F%E7%B2%BE%E5%B0%BD-Dubbo-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E2%80%94%E2%80%94-01API-%E9%85%8D%E7%BD%AE%EF%BC%88%E4%B8%80%EF%BC%89%E4%B9%8B%E5%BA%94%E7%94%A8%2F</url>
    <content type="text"><![CDATA[&gt; å‹æƒ…æç¤ºï¼Œã€é…ç½®ã€‘è¿™å—çš„å†…å®¹ï¼Œä¼šç›¸å¯¹æ¯”è¾ƒæž¯ç‡¥ã€‚æ‰€ä»¥ï¼Œå¦‚æžœçœ‹åˆ°ä¸€äº›å¾ˆéš¾æ‡‚çš„åœ°æ–¹ï¼Œå»ºè®®å…ˆè·³è¿‡ã€‚ å¯¹äºŽ Dubbo ï¼Œé‡ç‚¹æ˜¯è¦åŽ»ç†è§£ï¼Œå¤šåè®®ã€RPCã€å®¹é”™ç­‰ç­‰æ¨¡å—ï¼Œè€Œä¸æ˜¯ã€é…ç½®ã€‘ã€‚ 1. æ¦‚è¿°æˆ‘ä»¬éƒ½â€œçŸ¥é“â€ï¼ŒDubbo çš„é…ç½®æ˜¯éžå¸¸â€œçµæ´»â€çš„ã€‚ ä¾‹å¦‚ï¼Œç›®å‰æä¾›äº†å››ç§é…ç½®æ–¹å¼ï¼š API é…ç½® å±žæ€§é…ç½® XML é…ç½® æ³¨è§£é…ç½® psï¼šðŸ™‚ åŽç»­çš„å‡ ç¯‡æ–‡ç« ä¹Ÿæ˜¯æŒ‰ç…§è¿™æ ·çš„é¡ºåºï¼Œè§£æž Dubbo é…ç½®çš„æºç ã€‚ å†ä¾‹å¦‚ï¼Œå¯çµæ´»è®¾ç½®çš„é…ç½®é¡¹ï¼š FROM ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” schema é…ç½®å‚è€ƒæ‰‹å†Œã€‹ æ‰€æœ‰é…ç½®é¡¹åˆ†ä¸ºä¸‰å¤§ç±»ï¼Œå‚è§ä¸‹è¡¨ä¸­çš„â€ä½œç”¨â€ä¸€åˆ—ã€‚ æœåŠ¡å‘çŽ°ï¼šè¡¨ç¤ºè¯¥é…ç½®é¡¹ç”¨äºŽæœåŠ¡çš„æ³¨å†Œä¸Žå‘çŽ°ï¼Œç›®çš„æ˜¯è®©æ¶ˆè´¹æ–¹æ‰¾åˆ°æä¾›æ–¹ã€‚ æœåŠ¡æ²»ç†ï¼šè¡¨ç¤ºè¯¥é…ç½®é¡¹ç”¨äºŽæ²»ç†æœåŠ¡é—´çš„å…³ç³»ï¼Œæˆ–ä¸ºå¼€å‘æµ‹è¯•æä¾›ä¾¿åˆ©æ¡ä»¶ã€‚ æ€§èƒ½è°ƒä¼˜ï¼šè¡¨ç¤ºè¯¥é…ç½®é¡¹ç”¨äºŽè°ƒä¼˜æ€§èƒ½ï¼Œä¸åŒçš„é€‰é¡¹å¯¹æ€§èƒ½ä¼šäº§ç”Ÿå½±å“ã€‚ æ‰€æœ‰é…ç½®æœ€ç»ˆéƒ½å°†è½¬æ¢ä¸º Dubbo URL è¡¨ç¤ºï¼Œå¹¶ç”±æœåŠ¡æä¾›æ–¹ç”Ÿæˆï¼Œç»æ³¨å†Œä¸­å¿ƒä¼ é€’ç»™æ¶ˆè´¹æ–¹ï¼Œå„å±žæ€§å¯¹åº” URL çš„å‚æ•°ï¼Œå‚è§é…ç½®é¡¹ä¸€è§ˆè¡¨ä¸­çš„ â€œå¯¹åº”URLå‚æ•°â€ åˆ—ã€‚ psï¼šðŸ™‚ å¯èƒ½è½¬æ¢æˆ Dubbo URL ä¸å¤ªå¥½ç†è§£ã€‚è‰¯å¿ƒå¦‚ç¬”è€…ï¼ŒåŽç»­æœ‰æ–‡ç« ä¼šè´¯ä¸²å®ƒã€‚ å½“ç„¶ï¼Œå‡¡äº‹éƒ½æœ‰ä¸¤é¢æ€§ï¼Œåœ¨ç¤¾åŒºé‡Œä¹Ÿå­˜åœ¨å»ºè®®çš„å£°éŸ³ï¼Œä¾‹å¦‚ï¼šã€ŠISSUE#738ï¼šXMLé…ç½®é¡¹é‡æ–°æ¢³ç†ã€‹ ï¼š ç›®å‰æœ‰ä¸€äº›é…ç½®é¡¹å­˜åœ¨æš´éœ²çš„ä½ç½®ä¸æ­£ç¡®ã€æš´éœ²ä¸å…¨é¢ã€æ–‡æ¡£å’Œå«ä¹‰ä¸åŒ¹é…ç­‰é—®é¢˜ï¼ŒæœŸæœ›åœ¨2.5.7ç‰ˆæœ¬å°†å·²çŸ¥é—®é¢˜äºˆä»¥æ•´ç†ä¿®å¤ å¦‚æžœä½¿ç”¨ä¸­æœ‰é‡åˆ°çš„é…ç½®é—®é¢˜ï¼Œè¯·åœ¨è¯„è®ºä¸­åˆ—å‡ºä»¥ä¾¿æ”¹è¿› 2. é…ç½®ä¸€è§ˆæˆ‘ä»¬æ¥çœ‹çœ‹ dubbo-config-api çš„é¡¹ç›®ç»“æž„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸€è„¸æ‡µé€¼ï¼Œå¥½å¤šå•Šã€‚ä¸‹é¢æˆ‘ä»¬æ¥æ•´ç†ä¸‹é…ç½®ä¹‹é—´çš„å…³ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š FROM ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” XML é…ç½®ã€‹ ä»Žè¿™å¼ å›¾ä¸­ï¼Œå¯ä»¥çœ‹å‡ºåˆ†æˆå››ä¸ªéƒ¨åˆ†ï¼š application-shared provider-side consumer-side sub-config å®žé™…ä¸Šï¼Œä¸Šå›¾å’Œç›®å‰ç‰ˆæœ¬çš„ä»£ç ä¼šå­˜åœ¨ä¸€ç‚¹ç‚¹å‡ºå…¥ï¼Œæˆ‘ä»¬åœ¨çœ‹çœ‹å®žé™…çš„ç±»å…³ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š çº¢å‹¾éƒ¨åˆ†ï¼Œapplication-shared ï¼Œåœ¨æœ¬æ–‡è¿›è¡Œåˆ†äº«ã€‚ é»„æ¡†éƒ¨åˆ†ï¼Œprovider-side ï¼Œåœ¨ ã€ŠAPI é…ç½®ï¼ˆäºŒï¼‰ä¹‹æœåŠ¡æä¾›è€…ã€‹ åˆ†äº«ã€‚ çº¢æ¡†éƒ¨åˆ†ï¼Œconsumer-side ï¼Œåœ¨ ã€ŠAPI é…ç½®ï¼ˆä¸‰ï¼‰ä¹‹æœåŠ¡æ¶ˆè´¹è€…ã€‹ åˆ†äº«ã€‚ å…¶ä»–éƒ¨åˆ†ï¼Œsub-config ï¼Œåœ¨ ã€ŠAPI é…ç½®ï¼ˆäºŒï¼‰ä¹‹æœåŠ¡æä¾›è€…ã€‹ åˆ†äº«ã€‚ 3. Configæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” API é…ç½®ã€‹ ï¼Œæä¾›çš„æ¶ˆè´¹è€…çš„åˆå§‹åŒ–ä»£ç ï¼š 123456789101112131415161718192021// å½“å‰åº”ç”¨é…ç½®ApplicationConfig application = new ApplicationConfig();application.setName("yyy");// è¿žæŽ¥æ³¨å†Œä¸­å¿ƒé…ç½®RegistryConfig registry = new RegistryConfig();registry.setAddress("10.20.130.230:9090");registry.setUsername("aaa");registry.setPassword("bbb");// æ³¨æ„ï¼šReferenceConfigä¸ºé‡å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†ä¸Žæ³¨å†Œä¸­å¿ƒçš„è¿žæŽ¥ï¼Œä»¥åŠä¸ŽæœåŠ¡æä¾›æ–¹çš„è¿žæŽ¥// å¼•ç”¨è¿œç¨‹æœåŠ¡ReferenceConfig&lt;XxxService&gt; reference = new ReferenceConfig&lt;XxxService&gt;(); // æ­¤å®žä¾‹å¾ˆé‡ï¼Œå°è£…äº†ä¸Žæ³¨å†Œä¸­å¿ƒçš„è¿žæŽ¥ä»¥åŠä¸Žæä¾›è€…çš„è¿žæŽ¥ï¼Œè¯·è‡ªè¡Œç¼“å­˜ï¼Œå¦åˆ™å¯èƒ½é€ æˆå†…å­˜å’Œè¿žæŽ¥æ³„æ¼reference.setApplication(application);reference.setRegistry(registry); // å¤šä¸ªæ³¨å†Œä¸­å¿ƒå¯ä»¥ç”¨setRegistries()reference.setInterface(XxxService.class);reference.setVersion("1.0.0");// å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨xxxServiceXxxService xxxService = reference.get(); // æ³¨æ„ï¼šæ­¤ä»£ç†å¯¹è±¡å†…éƒ¨å°è£…äº†æ‰€æœ‰é€šè®¯ç»†èŠ‚ï¼Œå¯¹è±¡è¾ƒé‡ï¼Œè¯·ç¼“å­˜å¤ç”¨ å¯ä»¥çœ‹åˆ°ï¼Œåˆ›å»ºäº† ApplicationConfig å’Œ RegistryConfig å¯¹è±¡ï¼Œè®¾ç½®åˆ° ReferenceConfig å¯¹è±¡ã€‚ å¦‚æžœåˆ›å»º ModuleConfig æˆ– MonitorConfig å¯¹è±¡ï¼Œä¹Ÿæ˜¯å¯ä»¥è®¾ç½®åˆ° ReferenceConfig å¯¹è±¡ä¸­ã€‚ 3.1 AbstractConfigcom.alibaba.dubbo.config.AbstractConfig ï¼ŒæŠ½è±¡é…ç½®ç±»ï¼Œé™¤äº† ArgumentConfig ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„é…ç½®ç±»éƒ½ç»§æ‰¿è¯¥ç±»ã€‚ AbstractConfig ä¸»è¦æä¾›é…ç½®è§£æžä¸Žæ ¡éªŒç›¸å…³çš„å·¥å…·æ–¹æ³•ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹çœ‹çœ‹å®ƒçš„ä»£ç ã€‚ id å±žæ€§ï¼Œé…ç½®å¯¹è±¡çš„ç¼–å·ï¼Œé€‚ç”¨äºŽé™¤äº† API é…ç½®ä¹‹å¤–çš„ä¸‰ç§é…ç½®æ–¹å¼ï¼Œæ ‡è®°ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œå¯ç”¨äºŽå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨ã€‚ä¾‹å¦‚ XML çš„ &lt;dubbo:service provider=&quot;${PROVIDER_ID}&quot;&gt; ï¼Œå…¶ä¸­ provider ä¸º &lt;dubbo:provider&gt; çš„ ID å±žæ€§ã€‚ é‚£ä¸ºä»€ä¹ˆè¯´ä¸é€‚ç”¨ API é…ç½®å‘¢ï¼Ÿç›´æŽ¥ #setXXX(config) å¯¹è±¡å³å¯ã€‚ é…ç½®é¡¹æ ¡éªŒçš„å·¥å…·æ–¹æ³•ï¼Œä¾‹å¦‚å±žæ€§å€¼é•¿åº¦é™åˆ¶ã€æ ¼å¼é™åˆ¶ç­‰ç­‰ï¼Œæ¯”è¾ƒç®€å•ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š é™æ€å±žæ€§ é™æ€æ–¹æ³• #appendParameters(parameters, config, prefix) æ–¹æ³•ï¼Œå°†é…ç½®å¯¹è±¡çš„å±žæ€§ï¼Œæ·»åŠ åˆ°å‚æ•°é›†åˆã€‚ä»£ç å¦‚ä¸‹ ï¼š åœ¨çœ‹å…·ä½“ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ ã€Œ4. URLã€ å’Œ ã€Œ5. @Parameterã€ ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970 1: protected static void appendParameters(Map&lt;String, String&gt; parameters, Object config, String prefix) &#123; 2: if (config == null) &#123; 3: return; 4: &#125; 5: Method[] methods = config.getClass().getMethods(); 6: for (Method method : methods) &#123; 7: try &#123; 8: String name = method.getName(); 9: if ((name.startsWith("get") || name.startsWith("is"))10: &amp;&amp; !"getClass".equals(name)11: &amp;&amp; Modifier.isPublic(method.getModifiers())12: &amp;&amp; method.getParameterTypes().length == 013: &amp;&amp; isPrimitive(method.getReturnType())) &#123; // æ–¹æ³•ä¸ºèŽ·å–åŸºæœ¬ç±»åž‹ï¼Œpublic çš„ getting æ–¹æ³•ã€‚14: Parameter parameter = method.getAnnotation(Parameter.class);15: if (method.getReturnType() == Object.class || parameter != null &amp;&amp; parameter.excluded()) &#123;16: continue;17: &#125;18: // èŽ·å¾—å±žæ€§å19: int i = name.startsWith("get") ? 3 : 2;20: String prop = StringUtils.camelToSplitName(name.substring(i, i + 1).toLowerCase() + name.substring(i + 1), ".");21: String key;22: if (parameter != null &amp;&amp; parameter.key() != null &amp;&amp; parameter.key().length() &gt; 0) &#123;23: key = parameter.key();24: &#125; else &#123;25: key = prop;26: &#125;27: // èŽ·å¾—å±žæ€§å€¼28: Object value = method.invoke(config, new Object[0]);29: String str = String.valueOf(value).trim();30: if (value != null &amp;&amp; str.length() &gt; 0) &#123;31: // è½¬ä¹‰32: if (parameter != null &amp;&amp; parameter.escaped()) &#123;33: str = URL.encode(str);34: &#125;35: // æ‹¼æŽ¥ï¼Œè¯¦ç»†è¯´æ˜Žå‚è§ `Parameter#append()` æ–¹æ³•çš„è¯´æ˜Žã€‚36: if (parameter != null &amp;&amp; parameter.append()) &#123;37: String pre = parameters.get(Constants.DEFAULT_KEY + "." + key); // default. é‡ŒèŽ·å–ï¼Œé€‚ç”¨äºŽ ServiceConfig =ã€‹ProviderConfig ã€ReferenceConfig =ã€‹ConsumerConfig ã€‚38: if (pre != null &amp;&amp; pre.length() &gt; 0) &#123;39: str = pre + "," + str;40: &#125;41: pre = parameters.get(key); // é€šè¿‡ `parameters` å±žæ€§é…ç½®ï¼Œä¾‹å¦‚ `AbstractMethodConfig.parameters` ã€‚42: if (pre != null &amp;&amp; pre.length() &gt; 0) &#123;43: str = pre + "," + str;44: &#125;45: &#125;46: if (prefix != null &amp;&amp; prefix.length() &gt; 0) &#123;47: key = prefix + "." + key;48: &#125;49: parameters.put(key, str);50: // System.out.println("kv:" + key + "\t" + str);51: &#125; else if (parameter != null &amp;&amp; parameter.required()) &#123;52: throw new IllegalStateException(config.getClass().getSimpleName() + "." + key + " == null");53: &#125;54: &#125; else if ("getParameters".equals(name)55: &amp;&amp; Modifier.isPublic(method.getModifiers())56: &amp;&amp; method.getParameterTypes().length == 057: &amp;&amp; method.getReturnType() == Map.class) &#123; // `#getParameters()` æ–¹æ³•58: Map&lt;String, String&gt; map = (Map&lt;String, String&gt;) method.invoke(config, new Object[0]);59: if (map != null &amp;&amp; map.size() &gt; 0) &#123;60: String pre = (prefix != null &amp;&amp; prefix.length() &gt; 0 ? prefix + "." : "");61: for (Map.Entry&lt;String, String&gt; entry : map.entrySet()) &#123;62: parameters.put(pre + entry.getKey().replace('-', '.'), entry.getValue());63: &#125;64: &#125;65: &#125;66: &#125; catch (Exception e) &#123;67: throw new IllegalStateException(e.getMessage(), e);68: &#125;69: &#125;70: &#125; parameters ï¼Œå‚æ•°é›†åˆã€‚å®žé™…ä¸Šï¼Œè¯¥é›†åˆä¼šç”¨äºŽ URL.parameters ã€‚ config ï¼Œé…ç½®å¯¹è±¡ã€‚ prefix ï¼Œå±žæ€§å‰ç¼€ã€‚ç”¨äºŽé…ç½®é¡¹æ·»åŠ åˆ° parameters ä¸­æ—¶çš„å‰ç¼€ã€‚ ç¬¬ 5 è¡Œï¼šèŽ·å¾—æ‰€æœ‰æ–¹æ³•çš„æ•°ç»„ï¼Œä¸ºä¸‹é¢é€šè¿‡åå°„èŽ·å¾—é…ç½®é¡¹çš„å€¼åšå‡†å¤‡ã€‚ ç¬¬ 6 è¡Œï¼šå¾ªçŽ¯æ¯ä¸ªæ–¹æ³•ã€‚ ç¬¬ 9 è‡³ 13 è¡Œï¼šæ–¹æ³•ä¸ºèŽ·å¾— åŸºæœ¬ç±»åž‹ + 1public çš„ getting æ–¹æ³•ã€‚ ç¬¬ 14 è‡³ 17 è¡Œï¼šè¿”å›žå€¼ç±»åž‹ä¸º Object æˆ–æŽ’é™¤( `@Parameter.exclue=true` )çš„é…ç½®é¡¹ï¼Œè·³è¿‡ã€‚ ç¬¬ 19 è‡³ 26 è¡Œï¼šèŽ·å¾—é…ç½®é¡¹åã€‚ ç¬¬ 28 è‡³ 48 è¡Œï¼šèŽ·å¾—é…ç½®é¡¹å€¼ã€‚ä¸­é—´æœ‰ä¸€äº›é€»è¾‘å¤„ç†ï¼Œèƒ–å‹çœ‹ä¸‹ä»£ç çš„æ³¨é‡Šã€‚ ç¬¬ 49 è¡Œï¼šæ·»åŠ é…ç½®é¡¹åˆ° parameters ã€‚ ç¬¬ 51 è‡³ 53 è¡Œï¼šå½“ `@Parameter.required = true` æ—¶ï¼Œæ ¡éªŒé…ç½®é¡¹éžç©ºã€‚ ç¬¬ 54 è‡³ 57 è¡Œï¼šå½“æ–¹æ³•ä¸º 1#getParameters() æ—¶ï¼Œ ä¾‹å¦‚ ã€‚ ç¬¬ 58 è¡Œï¼šé€šè¿‡åå°„ï¼ŒèŽ·å¾— #getParameters() çš„è¿”å›žå€¼ä¸º map ã€‚ ç¬¬ 59 è‡³ 64 è¡Œï¼šå°† map æ·»åŠ åˆ° parameters ï¼Œkv æ ¼å¼ä¸º prefix:entry.key entry.value ã€‚ å› æ­¤ï¼Œé€šè¿‡ #getParameters() å¯¹åº”çš„å±žæ€§ï¼ŒåŠ¨æ€è®¾ç½®é…ç½®é¡¹ï¼Œæ‹“å±•å‡ºéž Dubbo å†…ç½®å¥½çš„é€»è¾‘ã€‚ #appendAttributes(parameters, config, prefix) æ–¹æ³•ï¼Œå°† @Parameter(attribute = true) é…ç½®å¯¹è±¡çš„å±žæ€§ï¼Œæ·»åŠ åˆ°å‚æ•°é›†åˆã€‚ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738 1: protected static void appendAttributes(Map&lt;Object, Object&gt; parameters, Object config, String prefix) &#123; 2: if (config == null) &#123; 3: return; 4: &#125; 5: Method[] methods = config.getClass().getMethods(); 6: for (Method method : methods) &#123; 7: try &#123; 8: String name = method.getName(); 9: if ((name.startsWith("get") || name.startsWith("is"))10: &amp;&amp; !"getClass".equals(name)11: &amp;&amp; Modifier.isPublic(method.getModifiers())12: &amp;&amp; method.getParameterTypes().length == 013: &amp;&amp; isPrimitive(method.getReturnType())) &#123; // æ–¹æ³•ä¸ºèŽ·å–åŸºæœ¬ç±»åž‹ï¼Œpublic çš„ getting æ–¹æ³•ã€‚14: Parameter parameter = method.getAnnotation(Parameter.class);15: if (parameter == null || !parameter.attribute())16: continue;17: // èŽ·å¾—å±žæ€§å18: String key;19: if (parameter != null &amp;&amp; parameter.key() != null &amp;&amp; parameter.key().length() &gt; 0) &#123;20: key = parameter.key();21: &#125; else &#123;22: int i = name.startsWith("get") ? 3 : 2;23: key = name.substring(i, i + 1).toLowerCase() + name.substring(i + 1);24: &#125;25: // èŽ·å¾—å±žæ€§å€¼ï¼Œå­˜åœ¨åˆ™æ·»åŠ åˆ° `parameters` é›†åˆ26: Object value = method.invoke(config, new Object[0]);27: if (value != null) &#123;28: if (prefix != null &amp;&amp; prefix.length() &gt; 0) &#123;29: key = prefix + "." + key;30: &#125;31: parameters.put(key, value);32: &#125;33: &#125;34: &#125; catch (Exception e) &#123;35: throw new IllegalStateException(e.getMessage(), e);36: &#125;37: &#125;38: &#125; ä¸åŒäºŽ #appendAttributes(parameters, config, prefix) æ–¹æ³•ï¼Œä¸»è¦ç”¨äºŽ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” äº‹ä»¶é€šçŸ¥ã€‹ ï¼Œæ³¨è§£ @Parameter(attribute = true) çš„å±žæ€§å¦‚ä¸‹å›¾ï¼š ç¬¬ 9 è‡³ 13 è¡Œï¼šæ–¹æ³•ä¸ºèŽ·å¾—åŸºæœ¬ç±»åž‹ + public çš„ getting æ–¹æ³•ã€‚ ç¬¬ 14 è‡³ 16 è¡Œï¼šéœ€è¦( `@Parameter.exclue=true` )çš„é…ç½®é¡¹ã€‚ ç¬¬ 17 è‡³ 24 è¡Œï¼šèŽ·å¾—é…ç½®é¡¹åã€‚ ç¬¬ 26 è‡³ 30 è¡Œï¼šèŽ·å¾—é…ç½®é¡¹å€¼ã€‚ ç¬¬ 31 è¡Œï¼šæ·»åŠ é…ç½®é¡¹åˆ° parameters ã€‚ #appendProperties(config) æ–¹æ³•ï¼Œè¯»å–çŽ¯å¢ƒå˜é‡å’Œ properties é…ç½®åˆ°é…ç½®å¯¹è±¡ã€‚åœ¨ ã€Šç²¾è¿› Dubbo æºç è§£æž â€”â€” å±žæ€§é…ç½®ã€‹ è¯¦ç»†è§£æžã€‚ #appendAnnotation(annotationClass, annotation) æ–¹æ³•ï¼Œè¯»å–æ³¨è§£é…ç½®åˆ°é…ç½®å¯¹è±¡ã€‚åœ¨ ã€Šç²¾è¿› Dubbo æºç è§£æž â€”â€” æ³¨è§£é…ç½®ã€‹ è¯¦ç»†è§£æžã€‚ 3.2 ApplicationConfigcom.alibaba.dubbo.config.ApplicationConfig ï¼Œåº”ç”¨é…ç½®ã€‚ å…·ä½“å±žæ€§çš„è§£é‡Šï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” dubbo:applicationã€‹ æ–‡æ¡£ã€‚ 3.3 RegistryConfigcom.alibaba.dubbo.config.RegistryConfig ï¼Œæ³¨å†Œä¸­å¿ƒé…ç½®ã€‚ å…·ä½“å±žæ€§çš„è§£é‡Šï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” dubbo:registryã€‹ æ–‡æ¡£ã€‚ 3.4 ModuleConfigcom.alibaba.dubbo.config.ModuleConfig ï¼Œæ¨¡å—ä¿¡æ¯é…ç½®ã€‚ å…·ä½“å±žæ€§çš„è§£é‡Šï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” dubbo:moduleã€‹ æ–‡æ¡£ã€‚ 3.5 MonitorConfigcom.alibaba.dubbo.config.MonitorConfig ï¼Œç›‘æŽ§ä¸­å¿ƒé…ç½®ã€‚ å…·ä½“å±žæ€§çš„è§£é‡Šï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” dubbo:monitorã€‹ æ–‡æ¡£ã€‚ 3.6 ArgumentConfigcom.alibaba.dubbo.config.ArgumentConfig ï¼Œæ–¹æ³•å‚æ•°é…ç½®ã€‚ å…·ä½“å±žæ€§çš„è§£é‡Šï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” dubbo:argumentã€‹ æ–‡æ¡£ã€‚ è¯¥é…ç½®ç±»è®¾ç½®åˆ° MethodConfig å¯¹è±¡ä¸­ï¼Œåœ¨ ã€ŠAPI é…ç½®ï¼ˆäºŒï¼‰ä¹‹æœåŠ¡æä¾›è€…ã€‹ æˆ‘ä»¬ä¼šçœ‹åˆ°ã€‚ åœ¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” å‚æ•°å›žè°ƒã€‹ ç‰¹æ€§ä¸­ä½¿ç”¨ã€‚ 4. URLcom.alibaba.dubbo.common.URL ï¼ŒDubbo URL ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536public final class URL implements Serializable &#123; /** * åè®®å */ private final String protocol; /** * ç”¨æˆ·å */ private final String username; /** * å¯†ç  */ private final String password; /** * by default, host to registry * åœ°å€ */ private final String host; /** * by default, port to registry * ç«¯å£ */ private final int port; /** * è·¯å¾„ï¼ˆæœåŠ¡åï¼‰ */ private final String path; /** * å‚æ•°é›†åˆ */ private final Map&lt;String, String&gt; parameters; // ... çœç•¥å…¶ä»–ä»£ç &#125; ä¸Šæ–‡æˆ‘ä»¬æåˆ°æ‰€æœ‰é…ç½®æœ€ç»ˆéƒ½å°†è½¬æ¢ä¸º Dubbo URL è¡¨ç¤ºï¼Œå¹¶ç”±æœåŠ¡æä¾›æ–¹ç”Ÿæˆï¼Œç»æ³¨å†Œä¸­å¿ƒä¼ é€’ç»™æ¶ˆè´¹æ–¹ï¼Œå„å±žæ€§å¯¹åº” URL çš„å‚æ•°ï¼Œå‚è§é…ç½®é¡¹ä¸€è§ˆè¡¨ä¸­çš„ â€œå¯¹åº”URLå‚æ•°â€ åˆ—ã€‚é‚£ä¹ˆä¸€ä¸ª Service æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„æ ¼å¼å¦‚ä¸‹ï¼š 1dubbo://192.168.3.17:20880/com.alibaba.dubbo.demo.DemoService?anyhost=true&amp;application=demo-provider&amp;default.delay=-1&amp;default.retries=0&amp;default.service.filter=demoFilter&amp;delay=-1&amp;dubbo=2.0.0&amp;generic=false&amp;interface=com.alibaba.dubbo.demo.DemoService&amp;methods=sayHello&amp;pid=19031&amp;side=provider&amp;timestamp=1519651641799 æ ¼å¼ä¸º protocol://username:password@host:port/path?key=value&amp;key=value ï¼Œé€šè¿‡ URL#buildString(...) æ–¹æ³•ç”Ÿæˆã€‚ parameters å±žæ€§ï¼Œå‚æ•°é›†åˆã€‚ä»Žä¸Šé¢çš„ Service URL ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé‡Œé¢çš„ key=value ï¼Œå®žé™…ä¸Šå°±æ˜¯ Service å¯¹åº”çš„é…ç½®é¡¹ã€‚è¯¥å±žæ€§ï¼Œé€šè¿‡ AbstractConfig#appendParameters(parameters, config, prefix) æ–¹æ³•ç”Ÿæˆã€‚ ðŸ™‚ åœ¨åŽç»­çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šå‘çŽ° URL ä½œä¸ºä¸€ä¸ªé€šç”¨æ¨¡åž‹ï¼Œè´¯ç©¿æ•´ä¸ª RPC æµç¨‹ã€‚ 5. @Parametercom.alibaba.dubbo.config.support.@Parameter ï¼ŒParameter å‚æ•°æ³¨è§£ï¼Œç”¨äºŽ Dubbo URL çš„ parameters æ‹¼æŽ¥ã€‚ åœ¨é…ç½®å¯¹è±¡çš„ getting æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥æ³¨è§£çš„ä½¿ç”¨ï¼Œä¾‹å¦‚ä¸‹å›¾ï¼š @Parameter ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253@Documented@Retention(RetentionPolicy.RUNTIME)@Target(&#123;ElementType.METHOD&#125;)public @interface Parameter &#123; /** * é”®ï¼ˆåˆ«åï¼‰ */ String key() default ""; /** * æ˜¯å¦å¿…å¡« */ boolean required() default false; /** * æ˜¯å¦å¿½ç•¥ */ boolean excluded() default false; /** * æ˜¯å¦è½¬ä¹‰ */ boolean escaped() default false; /** * æ˜¯å¦ä¸ºå±žæ€§ * * ç›®å‰ç”¨äºŽã€Šäº‹ä»¶é€šçŸ¥ã€‹http://dubbo.apache.org/zh-cn/docs/user/demos/events-notify.html */ boolean attribute() default false; /** * æ˜¯å¦æ‹¼æŽ¥é»˜è®¤å±žæ€§ï¼Œå‚è§ &#123;@link com.alibaba.dubbo.config.AbstractConfig#appendParameters(Map, Object, String)&#125; æ–¹æ³•ã€‚ * * æˆ‘ä»¬æ¥çœ‹çœ‹ `#append() = true` çš„å±žæ€§ï¼Œæœ‰å¦‚ä¸‹å››ä¸ªï¼š * + &#123;@link AbstractInterfaceConfig#getFilter()&#125; * + &#123;@link AbstractInterfaceConfig#getListener()&#125; * + &#123;@link AbstractReferenceConfig#getFilter()&#125; * + &#123;@link AbstractReferenceConfig#getListener()&#125; * + &#123;@link AbstractServiceConfig#getFilter()&#125; * + &#123;@link AbstractServiceConfig#getListener()&#125; * é‚£ä¹ˆï¼Œä»¥ AbstractServiceConfig ä¸¾ä¾‹å­ã€‚ * * æˆ‘ä»¬çŸ¥é“ ProviderConfig å’Œ ServiceConfig ç»§æ‰¿ AbstractServiceConfig ç±»ï¼Œé‚£ä¹ˆ `filter` , `listener` å¯¹åº”çš„ç›¸åŒçš„é”®ã€‚ * ä¸‹é¢æˆ‘ä»¬ä»¥ `filter` ä¸¾ä¾‹å­ã€‚ * * åœ¨ ServiceConfig ä¸­ï¼Œé»˜è®¤ä¼š&lt;b&gt;ç»§æ‰¿&lt;/b&gt; ProviderConfig é…ç½®çš„ `filter` å’Œ `listener` ã€‚ * æ‰€ä»¥è¿™ä¸ªå±žæ€§ï¼Œå°±æ˜¯ç”¨äºŽï¼Œåƒ ServiceConfig çš„è¿™ç§æƒ…å†µï¼Œä»Ž ProviderConfig è¯»å–çˆ¶å±žæ€§ã€‚ * * ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœ `ProviderConfig.filter=aaaFilter` ï¼Œ`ServiceConfig.filter=bbbFilter` ï¼Œæœ€ç»ˆæš´éœ²åˆ° Dubbo URL æ—¶ï¼Œå‚æ•°ä¸º `service.filter=aaaFilter,bbbFilter` ã€‚ */ boolean append() default false; èƒ–å‹å¯ä»¥ç®€å•çœ‹ä¸‹ä»£ç ä¸­çš„æ³¨é‡Šï¼Œç»“åˆå…·ä½“ä½¿ç”¨çš„æ–¹æ³•ï¼Œåœ¨ç»†ç»†ç†è§£ã€‚]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç²¾å°½ Dubbo æºç åˆ†æž â€”â€” é¡¹ç›®ç»“æž„ä¸€è§ˆ]]></title>
    <url>%2F2019%2F02%2F11%2F%E7%B2%BE%E5%B0%BD-Dubbo-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E2%80%94%E2%80%94-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E4%B8%80%E8%A7%88%2F</url>
    <content type="text"><![CDATA[1. æ¦‚è¿°æœ¬æ–‡ä¸»è¦åˆ†äº« Dubbo çš„é¡¹ç›®ç»“æž„ã€‚å¸Œæœ›é€šè¿‡æœ¬æ–‡èƒ½è®©èƒ–å‹å¯¹ Dubbo çš„æ•´ä½“é¡¹ç›®æœ‰ä¸ªç®€å•çš„äº†è§£ã€‚ å¦å¤–ï¼Œç¬”è€…ä¼šç›¸å¯¹å¤§é‡å¼•ç”¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å—ã€‹ å’Œ ã€ŠDubbo å¼€å‘æŒ‡å—ã€‹ ï¼Œå†™çš„çœŸçš„æŒºå¥½çš„ã€‚ðŸ™‚psï¼šé™äºŽæŽ’ç‰ˆï¼Œéƒ¨åˆ†åœ°æ–¹å¼•ç”¨ä¼šå­˜åœ¨æœªæ ‡æ˜Žçš„æƒ…å†µã€‚ åœ¨æ‹‰å– Dubbo é¡¹ç›®åŽï¼Œæˆ‘ä»¬ä¼šå‘çŽ°æ‹†åˆ†äº†å¥½å¤š Maven é¡¹ç›®ã€‚æ˜¯ä¸æ˜¯å†…å¿ƒä¸€ç´§ï¼Œäº§ç”Ÿäº†ææƒ§æ„Ÿï¼Ÿä¸è¦æ–¹ï¼Œæˆ‘ä»¬å°±æ˜¯ç»§ç»­æ€¼ã€‚ 2. ä»£ç ç»Ÿè®¡è¿™é‡Œå…ˆåˆ†äº«ä¸€ä¸ªå°æŠ€å·§ã€‚ç¬”è€…åœ¨å¼€å§‹æºç å­¦ä¹ æ—¶ï¼Œä¼šé¦–å…ˆäº†è§£é¡¹ç›®çš„ä»£ç é‡ã€‚ ç¬¬ä¸€ç§æ–¹å¼ï¼Œä½¿ç”¨ IDEA Statistic æ’ä»¶ï¼Œç»Ÿè®¡æ•´ä½“ä»£ç é‡ã€‚ æˆ‘ä»¬å¯ä»¥ç²—ç•¥çš„çœ‹åˆ°ï¼Œæ€»çš„ä»£ç é‡åœ¨ 98210 è¡Œã€‚è¿™å…¶ä¸­è¿˜åŒ…æ‹¬å•å…ƒæµ‹è¯•ï¼Œç¤ºä¾‹ç­‰ç­‰ä»£ç ã€‚æ‰€ä»¥ï¼Œä¸æ…Œã€‚ ç¬¬äºŒç§æ–¹å¼ï¼Œä½¿ç”¨ Shell è„šæœ¬å‘½ä»¤é€ä¸ª Maven æ¨¡å—ç»Ÿè®¡ ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¬”è€…ä½¿ç”¨ find . -name &quot;*.java&quot;|xargs cat|grep -v -e ^$ -e ^\s*\/\/.*$|wc -l ã€‚è¿™ä¸ªå‘½ä»¤åªè¿‡æ»¤äº†éƒ¨åˆ†æ³¨é‡Šï¼Œæ‰€ä»¥ç›¸æ¯” IDEA Statistic ä¼šåå¤šã€‚ å½“ç„¶ï¼Œè€ƒè™‘åˆ°å‡†ç¡®æ€§ï¼Œèƒ–å‹éœ€è¦æ‰‹åŠ¨ cd åˆ°æ¯ä¸ª Maven é¡¹ç›®çš„ src/main/java ç›®å½•ä¸‹ï¼Œä»¥è¾¾åˆ°æŽ’é™¤å•å…ƒæµ‹è¯•çš„ä»£ç é‡ã€‚ 3. é¡¹ç›®ä¸€è§ˆå¦‚æžœèƒ–å‹çœ‹è¿‡ ã€ŠDubbo æ¡†æž¶è®¾è®¡ã€‹ ï¼Œå°±ä¼šå‘çŽ°æœ‰ä¸‹é¢è¿™å¼ å›¾ã€‚ é€šè¿‡è¿™å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çš„çŸ¥é“å‡ ä¸ª Maven æ¨¡å—çš„ä¾èµ–å…³ç³»ã€‚ 3.1 dubbo-common dubbo-common å…¬å…±é€»è¾‘æ¨¡å—ï¼šæä¾›å·¥å…·ç±»å’Œé€šç”¨æ¨¡åž‹ã€‚ å·¥å…·ç±»æ¯”è¾ƒå¥½ç†è§£ï¼Œé€šç”¨æ¨¡åž‹æ˜¯ä»€ä¹ˆï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œcom.alibaba.dubbo.common.URL ï¼š FROM ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” å…¬å…±å¥‘çº¦ã€‹ æ‰€æœ‰æ‰©å±•ç‚¹å‚æ•°éƒ½åŒ…å« URL å‚æ•°ï¼ŒURL ä½œä¸ºä¸Šä¸‹æ–‡ä¿¡æ¯è´¯ç©¿æ•´ä¸ªæ‰©å±•ç‚¹è®¾è®¡ä½“ç³»ã€‚ URL é‡‡ç”¨æ ‡å‡†æ ¼å¼ï¼šprotocol://username:password@host:port/path?key=value&amp;key=value ã€‚ é‚£ä¹ˆ URL æœ‰ä»€ä¹ˆç”¨å‘¢ï¼ŸðŸ˜ˆ è¯·è§åŽç»­æ–‡ç« ã€‚ 3.2 dubbo-remoting dubbo-remoting è¿œç¨‹é€šä¿¡æ¨¡å—ï¼šæä¾›é€šç”¨çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šè®¯åŠŸèƒ½ã€‚ dubbo-remoting-zookeeper ï¼Œç›¸å½“äºŽ Zookeeper Client ï¼Œå’Œ Zookeeper Server é€šä¿¡ã€‚ dubbo-remoting-api ï¼Œ å®šä¹‰äº† Dubbo Client å’Œ Dubbo Server çš„æŽ¥å£ã€‚ å®žçŽ° 1dubbo-remoting-api dubbo-remoting-grizzly ï¼ŒåŸºäºŽ Grizzly å®žçŽ°ã€‚ dubbo-remoting-http ï¼ŒåŸºäºŽ Jetty æˆ– Tomcat å®žçŽ°ã€‚ dubbo-remoting-mina ï¼ŒåŸºäºŽ Mina å®žçŽ°ã€‚ dubbo-remoting-netty ï¼ŒåŸºäºŽ Netty 3 å®žçŽ°ã€‚ dubbo-remoting-netty4 ï¼ŒåŸºäºŽ Netty 4 å®žçŽ°ã€‚ dubbo-remoting-p2p ï¼ŒP2P æœåŠ¡å™¨ã€‚æ³¨å†Œä¸­å¿ƒ dubbo-registry-multicast é¡¹ç›®çš„ä½¿ç”¨è¯¥é¡¹ç›®ã€‚ ä»Žæœ€å°åŒ–çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬åªéœ€è¦çœ‹ï¼š dubbo-remoting-api + dubbo-remoting-netty4 dubbo-remoting-zookeeper 3.3 dubbo-rpc dubbo-rpc è¿œç¨‹è°ƒç”¨æ¨¡å—ï¼šæŠ½è±¡å„ç§åè®®ï¼Œä»¥åŠåŠ¨æ€ä»£ç†ï¼ŒåªåŒ…å«ä¸€å¯¹ä¸€çš„è°ƒç”¨ï¼Œä¸å…³å¿ƒé›†ç¾¤çš„ç®¡ç†ã€‚ é›†ç¾¤ç›¸å…³çš„ç®¡ç†ï¼Œç”± dubbo-cluster æä¾›ç‰¹æ€§ã€‚ åœ¨å›žè¿‡å¤´çœ‹ä¸Šé¢çš„å›¾ï¼Œæˆ‘ä»¬ä¼šå‘çŽ°ï¼Œdubbo-rpc æ˜¯æ•´ä¸ª Dubbo çš„ä¸­å¿ƒã€‚ dubbo-rpc-api ï¼ŒæŠ½è±¡å„ç§åè®®ä»¥åŠåŠ¨æ€ä»£ç†ï¼Œå®žçŽ°äº†ä¸€å¯¹ä¸€çš„è°ƒç”¨ã€‚ å…¶ä»–æ¨¡å—ï¼Œå®žçŽ° dubbo-rpc-api ï¼Œæä¾›å¯¹åº”çš„åè®®å®žçŽ°ã€‚åœ¨ ã€Šç”¨æˆ·æŒ‡å— â€”â€” åè®®å‚è€ƒæ‰‹å†Œã€‹ ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ¯ç§åè®®çš„ä»‹ç»ã€‚ å¦å¤–ï¼Œdubbo-rpc-default å¯¹åº” dubbo:// åè®®ã€‚ æ‹“å±•å‚è§ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” åè®®æ‰©å±•ã€‹ æ–‡æ¡£ã€‚ è¿›ä¸€æ­¥çš„æ‹†è§£ï¼Œè§ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æ ¸å¿ƒæµç¨‹ä¸€è§ˆã€‹ æ–‡ç« ã€‚ 3.4 dubbo-cluster dubbo-cluster é›†ç¾¤æ¨¡å—ï¼šå°†å¤šä¸ªæœåŠ¡æä¾›æ–¹ä¼ªè£…ä¸ºä¸€ä¸ªæä¾›æ–¹ï¼ŒåŒ…æ‹¬ï¼šè´Ÿè½½å‡è¡¡, é›†ç¾¤å®¹é”™ï¼Œè·¯ç”±ï¼Œåˆ†ç»„èšåˆç­‰ã€‚é›†ç¾¤çš„åœ°å€åˆ—è¡¨å¯ä»¥æ˜¯é™æ€é…ç½®çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”±æ³¨å†Œä¸­å¿ƒä¸‹å‘ã€‚ æ³¨å†Œä¸­å¿ƒä¸‹å‘ï¼Œç”± dubbo-registry æä¾›ç‰¹æ€§ã€‚ å®¹é”™ com.alibaba.dubbo.rpc.cluster.Cluster æŽ¥å£ + com.alibaba.dubbo.rpc.cluster.support åŒ…ã€‚ Cluster å°† Directory ä¸­çš„å¤šä¸ª Invoker ä¼ªè£…æˆä¸€ä¸ª Invokerï¼Œå¯¹ä¸Šå±‚é€æ˜Žï¼Œä¼ªè£…è¿‡ç¨‹åŒ…å«äº†å®¹é”™é€»è¾‘ï¼Œè°ƒç”¨å¤±è´¥åŽï¼Œé‡è¯•å¦ä¸€ä¸ªã€‚ æ‹“å±•å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” é›†ç¾¤å®¹é”™ã€‹ å’Œ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” é›†ç¾¤æ‰©å±•ã€‹ æ–‡æ¡£ã€‚ ç›®å½• com.alibaba.dubbo.rpc.cluster.Directory æŽ¥å£ + com.alibaba.dubbo.rpc.cluster.directory åŒ…ã€‚ Directory ä»£è¡¨äº†å¤šä¸ª Invoker ï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆ List ï¼Œä½†ä¸Ž List ä¸åŒçš„æ˜¯ï¼Œå®ƒçš„å€¼å¯èƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ¯”å¦‚æ³¨å†Œä¸­å¿ƒæŽ¨é€å˜æ›´ã€‚ è·¯ç”± com.alibaba.dubbo.rpc.cluster.Router æŽ¥å£ + com.alibaba.dubbo.rpc.cluster.router åŒ…ã€‚ è´Ÿè´£ä»Žå¤šä¸ª Invoker ä¸­æŒ‰è·¯ç”±è§„åˆ™é€‰å‡ºå­é›†ï¼Œæ¯”å¦‚è¯»å†™åˆ†ç¦»ï¼Œåº”ç”¨éš”ç¦»ç­‰ã€‚ æ‹“å±•å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” è·¯ç”±è§„åˆ™ã€‹ å’Œ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” è·¯ç”±æ‹“å±•ã€‹ æ–‡æ¡£ã€‚ é…ç½® com.alibaba.dubbo.rpc.cluster.Configurator æŽ¥å£ + com.alibaba.dubbo.rpc.cluster.configurator åŒ…ã€‚ æ‹“å±•å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” é…ç½®è§„åˆ™ã€‹ æ–‡æ¡£ã€‚ è´Ÿè½½å‡è¡¡ com.alibaba.dubbo.rpc.cluster.LoadBalance æŽ¥å£ + com.alibaba.dubbo.rpc.cluster.loadbalance åŒ…ã€‚ LoadBalance è´Ÿè´£ä»Žå¤šä¸ª Invoker ä¸­é€‰å‡ºå…·ä½“çš„ä¸€ä¸ªç”¨äºŽæœ¬æ¬¡è°ƒç”¨ï¼Œé€‰çš„è¿‡ç¨‹åŒ…å«äº†è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œè°ƒç”¨å¤±è´¥åŽï¼Œéœ€è¦é‡é€‰ã€‚ æ‹“å±•å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” è´Ÿè½½å‡è¡¡ã€‹ å’Œ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” è´Ÿè½½å‡è¡¡æ‹“å±•ã€‹ æ–‡æ¡£ã€‚ åˆå¹¶ç»“æžœ com.alibaba.dubbo.rpc.cluster.Merger æŽ¥å£ + com.alibaba.dubbo.rpc.cluster.merger åŒ…ã€‚ åˆå¹¶è¿”å›žç»“æžœï¼Œç”¨äºŽåˆ†ç»„èšåˆã€‚ æ‹“å±•å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” åˆ†ç»„èšåˆã€‹ å’Œ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” åˆå¹¶ç»“æžœæ‰©å±•ã€‹ æ–‡æ¡£ã€‚ æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š 3.5 dubbo-registry dubbo-registry æ³¨å†Œä¸­å¿ƒæ¨¡å—ï¼šåŸºäºŽæ³¨å†Œä¸­å¿ƒä¸‹å‘åœ°å€çš„é›†ç¾¤æ–¹å¼ï¼Œä»¥åŠå¯¹å„ç§æ³¨å†Œä¸­å¿ƒçš„æŠ½è±¡ã€‚ dubbo-registry-api ï¼ŒæŠ½è±¡æ³¨å†Œä¸­å¿ƒçš„æ³¨å†Œä¸Žå‘çŽ°æŽ¥å£ã€‚ å…¶ä»–æ¨¡å—ï¼Œå®žçŽ° dubbo-registry-api ï¼Œæä¾›å¯¹åº”çš„æ³¨å†Œä¸­å¿ƒå®žçŽ°ã€‚åœ¨ ã€Šç”¨æˆ·æŒ‡å— â€”â€” æ³¨å†Œä¸­å¿ƒå‚è€ƒæ‰‹å†Œã€‹ ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ¯ç§æ³¨å†Œä¸­å¿ƒçš„ä»‹ç»ã€‚ å¦å¤–ï¼Œdubbo-registry-default å¯¹åº” Simple æ³¨å†Œä¸­å¿ƒã€‚ æ‹“å±•å‚è§ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ³¨å†Œä¸­å¿ƒæ‰©å±•ã€‹ æ–‡æ¡£ã€‚ 3.6 dubbo-monitor dubbo-monitor ç›‘æŽ§æ¨¡å—ï¼šç»Ÿè®¡æœåŠ¡è°ƒç”¨æ¬¡æ•°ï¼Œè°ƒç”¨æ—¶é—´çš„ï¼Œè°ƒç”¨é“¾è·Ÿè¸ªçš„æœåŠ¡ã€‚ æ‹“å±•å‚è§ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” ç›‘æŽ§ä¸­å¿ƒæ‰©å±•ã€‹ ã€‚ ç›®å‰ç¤¾åŒºé‡Œï¼Œæœ‰å¯¹ Dubbo ç›‘æŽ§ä¸­å¿ƒè¿›è¡Œé‡æž„çš„é¡¹ç›®ï¼Œä¾‹å¦‚ ï¼š https://github.com/handuyishe/dubbo-monitor https://github.com/zhongxig/dubbo-d-monitor 3.7 dubbo-config dubbo-config é…ç½®æ¨¡å—ï¼šæ˜¯ Dubbo å¯¹å¤–çš„ APIï¼Œç”¨æˆ·é€šè¿‡ Config ä½¿ç”¨Dubboï¼Œéšè— Dubbo æ‰€æœ‰ç»†èŠ‚ã€‚ dubbo-config-api ï¼Œå®žçŽ°äº† API é…ç½® å’Œ å±žæ€§é…ç½® åŠŸèƒ½ã€‚ dubbo-config-spring ï¼Œå®žçŽ°äº† XML é…ç½® å’Œ æ³¨è§£é…ç½® åŠŸèƒ½ã€‚ æŽ¨èé˜…è¯» ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” é…ç½®è®¾è®¡ã€‹ ã€‚ 3.8 dubbo-container dubbo-container å®¹å™¨æ¨¡å—ï¼šæ˜¯ä¸€ä¸ª Standlone çš„å®¹å™¨ï¼Œä»¥ç®€å•çš„ Main åŠ è½½ Spring å¯åŠ¨ï¼Œå› ä¸ºæœåŠ¡é€šå¸¸ä¸éœ€è¦ Tomcat/JBoss ç­‰ Web å®¹å™¨çš„ç‰¹æ€§ï¼Œæ²¡å¿…è¦ç”¨ Web å®¹å™¨åŽ»åŠ è½½æœåŠ¡ã€‚ dubbo-container-api ï¼šå®šä¹‰äº† com.alibaba.dubbo.container.Container æŽ¥å£ï¼Œå¹¶æä¾› åŠ è½½æ‰€æœ‰å®¹å™¨å¯åŠ¨çš„ Main ç±»ã€‚ å®žçŽ° 1dubbo-container-api dubbo-container-spring ï¼Œæä¾›äº† com.alibaba.dubbo.container.spring.SpringContainer ã€‚ dubbo-container-log4j ï¼Œæä¾›äº† com.alibaba.dubbo.container.log4j.Log4jContainer ã€‚ dubbo-container-logback ï¼Œæä¾›äº† com.alibaba.dubbo.container.logback.LogbackContainer ã€‚ æ‹“å±•å‚è€ƒ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æœåŠ¡å®¹å™¨ã€‹ å’Œ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” å®¹å™¨æ‰©å±•ã€‹ æ–‡æ¡£ã€‚ 3.9 dubbo-filterdubbo-filter è¿‡æ»¤å™¨æ¨¡å—ï¼šæä¾›äº†å†…ç½®çš„è¿‡æ»¤å™¨ã€‚ 1dubbo-filter-cache ï¼Œç¼“å­˜è¿‡æ»¤å™¨ã€‚ æ‹“å±•å‚è€ƒ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” ç»“æžœç¼“å­˜ã€‹ å’Œ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” ç¼“å­˜æ‹“å±•ã€‹ æ–‡æ¡£ã€‚ 1dubbo-filter-validation ï¼Œå‚æ•°éªŒè¯è¿‡æ»¤å™¨ã€‚ æ‹“å±•å‚è€ƒ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” å‚æ•°éªŒè¯ã€‹ å’Œ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” éªŒè¯æ‰©å±•ã€‹ æ–‡æ¡£ã€‚ 3.10 dubbo-plugindubbo-plugin æ’ä»¶æ¨¡å—ï¼šæä¾›äº†å†…ç½®çš„æ’ä»¶ã€‚ 1dubbo-qos ï¼Œæä¾›åœ¨çº¿è¿ç»´å‘½ä»¤ã€‚ æ‹“å±•å‚è€ƒ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æ–°ç‰ˆæœ¬ telnet å‘½ä»¤ä½¿ç”¨è¯´æ˜Žã€‹ å’Œ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” Telnet å‘½ä»¤æ‰©å±•ã€‹ æ–‡æ¡£ã€‚ 3.11 hessian-litehessian-lite ï¼šDubbo å¯¹ Hessian 2 çš„ åºåˆ—åŒ– éƒ¨åˆ†çš„ç²¾ç®€ã€æ”¹è¿›ã€BugFix ã€‚ æäº¤åŽ†å²å¦‚ä¸‹ï¼š 3.12 dubbo-demodubbo-demo å¿«é€Ÿå¯åŠ¨ç¤ºä¾‹ã€‚ å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” å¿«é€Ÿå¯åŠ¨ã€‹ æ–‡æ¡£ã€‚ 3.13 dubbo-testdubbo-test æµ‹è¯•æ¨¡å—ã€‚ 1dubbo-test-benchmark ï¼Œæ€§èƒ½æµ‹è¯•ã€‚ å‚è€ƒ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æ€§èƒ½æµ‹è¯•æŠ¥å‘Šã€‹ æ–‡æ¡£ã€‚ 1dubbo-test-compatibility ï¼Œå…¼å®¹æ€§æµ‹è¯•ã€‚ dubbo-test-spring3 ï¼Œæµ‹è¯•å¯¹ Spring 3 çš„å…¼å®¹æ€§ã€‚ dubbo-test-example ï¼Œä½¿ç”¨ç¤ºä¾‹ã€‚ 3.14 Maven POM3.14.1 dubbo-dependencies-bomdubbo-dependencies-bom/pom.xml ï¼ŒMaven BOM(Bill Of Materials) ï¼Œç»Ÿä¸€å®šä¹‰äº† Dubbo ä¾èµ–çš„ä¸‰æ–¹åº“çš„ç‰ˆæœ¬å·ï¼š dubbo-parent ä¼šå¼•å…¥è¯¥ BOM ï¼š æ›´å¤š Maven BOM çš„çŸ¥è¯†ï¼Œå¯ä»¥çœ‹ä¸‹ ã€ŠMaven ä¸ŽSpring BOM(Bill Of Materials)ç®€åŒ–Springç‰ˆæœ¬æŽ§åˆ¶ã€‹ æ–‡æ¡£ï¼š é€šä¿—è§£è¯´ï¼šä¸ºäº†é˜²æ­¢ç”¨ Maven ç®¡ç† Spring é¡¹ç›®æ—¶ï¼Œä¸åŒçš„é¡¹ç›®ä¾èµ–äº†ä¸åŒç‰ˆæœ¬çš„ Spring ï¼Œå¯ä»¥ä½¿ç”¨ Maven BOM æ¥è§£å†³è€…ä¸€é—®é¢˜ã€‚ 3.14.2 dubbo-bomdubbo-bom/pom.xml ï¼ŒMaven BOM(Bill Of Materials) ï¼Œç»Ÿä¸€å®šä¹‰äº† Dubbo çš„ç‰ˆæœ¬å·ï¼š dubbo-demo å’Œ dubbo-test ä¼šå¼•å…¥è¯¥ BOM ã€‚ä»¥ dubbo-demo ä¸¾ä¾‹å­ï¼š 3.14.3 dubbo-parentdubbo/pom.xml ï¼ŒDubbo Parent Pom ã€‚ Dubbo çš„ Maven æ¨¡å—ï¼Œéƒ½ä¼šå¼•å…¥è¯¥ pom æ–‡ä»¶ã€‚ä»¥ dubbo-cluster ä¸¾ä¾‹å­ï¼š æˆ‘ä»¬æ•´ç†ä¸‹ä¸Šé¢çš„ pom æ–‡ä»¶ï¼š 3.14.4 dubbo-alldubbo/all/pom.xml ï¼ŒDubbo All Pom ï¼Œå®šä¹‰äº† Dubbo çš„æ‰“åŒ…è„šæœ¬ã€‚ æˆ‘ä»¬åœ¨ä½¿ç”¨ Dubbo åº“æ—¶ï¼Œå¼•å…¥è¯¥ pom æ–‡ä»¶ã€‚]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç²¾å°½ Dubbo é¢è¯•é¢˜]]></title>
    <url>%2F2019%2F02%2F11%2F%E7%B2%BE%E5%B0%BD-Dubbo-%E9%9D%A2%E8%AF%95%E9%A2%98%2F</url>
    <content type="text"><![CDATA[ä»¥ä¸‹é¢è¯•é¢˜ï¼ŒåŸºäºŽç½‘ç»œæ•´ç†ï¼Œå’Œè‡ªå·±ç¼–è¾‘ã€‚å…·ä½“å‚è€ƒçš„æ–‡ç« ï¼Œä¼šåœ¨æ–‡æœ«ç»™å‡ºæ‰€æœ‰çš„é“¾æŽ¥ã€‚ å¦‚æžœèƒ–å‹æœ‰è‡ªå·±çš„ç–‘é—®ï¼Œæ¬¢è¿Žåœ¨æ˜Ÿçƒæé—®ï¼Œæˆ‘ä»¬ä¸€èµ·æ•´ç†åŠåŠçš„ Dubbo é¢è¯•é¢˜çš„å¤§ä¿å¥ã€‚ è€Œé¢˜ç›®çš„éš¾åº¦ï¼Œè‰¿è‰¿å°½é‡æŒ‰ç…§ä»Žå®¹æ˜“åˆ°å›°éš¾çš„é¡ºåºï¼Œé€æ­¥ä¸‹åŽ»ã€‚ Dubbo æœ‰å‡ ç§é…ç½®æ–¹å¼ï¼Ÿæ­£å¦‚åœ¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” é…ç½®ã€‹ ä¸­æ‰€è§ï¼Œä¸€å…±æœ‰å››ç§é…ç½®æ–¹å¼ï¼š XML é…ç½® æ³¨è§£é…ç½® å±žæ€§é…ç½® Java API é…ç½® å®žé™…ä¸Šï¼Œè¿˜æœ‰ç¬¬äº”ç§æ–¹å¼ï¼Œå¤–éƒ¨åŒ–é…ç½®ã€‚å‚è§ ã€ŠDubbo æ–°ç¼–ç¨‹æ¨¡åž‹ä¹‹å¤–éƒ¨åŒ–é…ç½®ã€‹ ã€‚ ç›®å‰ï¼Œä¸»è¦ä½¿ç”¨çš„æ˜¯ XML é…ç½®å’Œæ³¨è§£é…ç½®ã€‚å…·ä½“ä½¿ç”¨å“ªä¸€ç§ï¼Œå°±çœ‹å¤§å®¶å„è‡ªçš„å–œå¥½ã€‚ç›®å‰ï¼Œè‰¿è‰¿åå¥½ XML é…ç½®ï¼Œæ›´åŠ æ¸…æ™°å¥½ç®¡ç†ã€‚ Dubbo å¦‚ä½•å’Œ Spring Boot è¿›è¡Œé›†æˆï¼Ÿå®˜æ–¹æä¾›æä¾›äº†é›†æˆåº“ dubbo-spring-boot ï¼Œå¯¹åº”ä»“åº“ä¸º https://github.com/apache/incubator-dubbo-spring-boot-project ã€‚ Dubbo æ¡†æž¶çš„åˆ†å±‚è®¾è®¡åœ¨ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æ ¸å¿ƒæµç¨‹ä¸€è§ˆã€‹ ä¸€æ–‡ä¸­ï¼Œå¯¹ Dubbo æ¡†æž¶çš„åˆ†å±‚å·²ç»æœ‰è¿‡ä»‹ç»ï¼Œè¿™é‡Œå†æ¥ä¸€æ¬¡ã€‚ ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œä¸€å…±åˆ†æˆ 10 å±‚ï¼Œå½“ç„¶ç†è§£åŽæ˜¯éžå¸¸æ¸…æ™°çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å›¾ä¾‹è¯´æ˜Ž æœ€é¡¶ä¸Šä¹ä¸ªå›¾æ ‡ï¼Œä»£è¡¨æœ¬å›¾ä¸­çš„å¯¹è±¡ä¸Žæµç¨‹ã€‚ å›¾ä¸­å·¦è¾¹ æ·¡è“èƒŒæ™¯( Consumer ) çš„ä¸ºæœåŠ¡æ¶ˆè´¹æ–¹ä½¿ç”¨çš„æŽ¥å£ï¼Œå³è¾¹ æ·¡ç»¿è‰²èƒŒæ™¯( Provider ) çš„ä¸ºæœåŠ¡æä¾›æ–¹ä½¿ç”¨çš„æŽ¥å£ï¼Œä½äºŽä¸­è½´çº¿ä¸Šçš„ä¸ºåŒæ–¹éƒ½ç”¨åˆ°çš„æŽ¥å£ã€‚ å›¾ä¸­ä»Žä¸‹è‡³ä¸Šåˆ†ä¸ºåå±‚ï¼Œå„å±‚å‡ä¸ºå•å‘ä¾èµ–ï¼Œå³è¾¹çš„ é»‘è‰²ç®­å¤´( Depend ) ä»£è¡¨å±‚ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ¯ä¸€å±‚éƒ½å¯ä»¥å‰¥ç¦»ä¸Šå±‚è¢«å¤ç”¨ã€‚å…¶ä¸­ï¼ŒService å’Œ Config å±‚ä¸º APIï¼Œå…¶å®ƒå„å±‚å‡ä¸º SPI ã€‚ æ³¨æ„ï¼ŒDubbo å¹¶æœªä½¿ç”¨ JDK SPI æœºåˆ¶ï¼Œè€Œæ˜¯è‡ªå·±å®žçŽ°äº†ä¸€å¥— Dubbo SPI æœºåˆ¶ã€‚ å›¾ä¸­ ç»¿è‰²å°å—( Interface ) çš„ä¸ºæ‰©å±•æŽ¥å£ï¼Œè“è‰²å°å—( Class ) ä¸ºå®žçŽ°ç±»ï¼Œå›¾ä¸­åªæ˜¾ç¤ºç”¨äºŽå…³è”å„å±‚çš„å®žçŽ°ç±»ã€‚ å›¾ä¸­ è“è‰²è™šçº¿( Init ) ä¸ºåˆå§‹åŒ–è¿‡ç¨‹ï¼Œå³å¯åŠ¨æ—¶ç»„è£…é“¾ã€‚çº¢è‰²å®žçº¿( Call )ä¸ºæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ï¼Œå³è¿è¡Œæ—¶è°ƒæ—¶é“¾ã€‚ç´«è‰²ä¸‰è§’ç®­å¤´( Inherit )ä¸ºç»§æ‰¿ï¼Œå¯ä»¥æŠŠå­ç±»çœ‹ä½œçˆ¶ç±»çš„åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œçº¿ä¸Šçš„æ–‡å­—ä¸ºè°ƒç”¨çš„æ–¹æ³•ã€‚ å„å±‚è¯´æ˜Ž è™½ç„¶ï¼Œæœ‰ 10 å±‚è¿™ä¹ˆå¤šï¼Œä½†æ˜¯æ€»ä½“æ˜¯åˆ†å±‚ Businessã€RPCã€Remoting ä¸‰å¤§å±‚ã€‚å¦‚ä¸‹ï¼š ==================== Business ==================== Service ä¸šåŠ¡å±‚ï¼šä¸šåŠ¡ä»£ç çš„æŽ¥å£ä¸Žå®žçŽ°ã€‚æˆ‘ä»¬å®žé™…ä½¿ç”¨ Dubbo çš„ä¸šåŠ¡å±‚çº§ã€‚ æŽ¥å£å±‚ï¼Œç»™æœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…æ¥å®žçŽ°çš„ã€‚ ==================== RPC ==================== config é…ç½®å±‚ï¼šå¯¹å¤–é…ç½®æŽ¥å£ï¼Œä»¥ ServiceConfig, ReferenceConfig ä¸ºä¸­å¿ƒï¼Œå¯ä»¥ç›´æŽ¥åˆå§‹åŒ–é…ç½®ç±»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Spring è§£æžé…ç½®ç”Ÿæˆé…ç½®ç±»ã€‚ é…ç½®å±‚ï¼Œä¸»è¦æ˜¯å¯¹ Dubbo è¿›è¡Œå„ç§é…ç½®çš„ã€‚ proxy æœåŠ¡ä»£ç†å±‚ï¼šæœåŠ¡æŽ¥å£é€æ˜Žä»£ç†ï¼Œç”ŸæˆæœåŠ¡çš„å®¢æˆ·ç«¯ Stub å’ŒæœåŠ¡å™¨ç«¯ Skeleton, æ‰©å±•æŽ¥å£ä¸º ProxyFactory ã€‚ æœåŠ¡ä»£ç†å±‚ï¼Œæ— è®ºæ˜¯ consumer è¿˜æ˜¯ providerï¼ŒDubbo éƒ½ä¼šç»™ä½ ç”Ÿæˆä»£ç†ï¼Œä»£ç†ä¹‹é—´è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚ å¦‚æžœèƒ–å‹äº†è§£ Spring Cloud ä½“ç³»ï¼Œå¯ä»¥ç±»æ¯”æˆ Feign å¯¹äºŽ consumer ï¼ŒSpring MVC å¯¹äºŽ provider ã€‚ registry æ³¨å†Œä¸­å¿ƒå±‚ï¼šå°è£…æœåŠ¡åœ°å€çš„æ³¨å†Œä¸Žå‘çŽ°ï¼Œä»¥æœåŠ¡ URL ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æŽ¥å£ä¸º RegistryFactory, Registry, RegistryService ã€‚ æœåŠ¡æ³¨å†Œå±‚ï¼Œè´Ÿè´£æœåŠ¡çš„æ³¨å†Œä¸Žå‘çŽ°ã€‚ å¦‚æžœèƒ–å‹äº†è§£ Spring Cloud ä½“ç³»ï¼Œå¯ä»¥ç±»æ¯”æˆ Eureka Client ã€‚ cluster è·¯ç”±å±‚ï¼šå°è£…å¤šä¸ªæä¾›è€…çš„è·¯ç”±åŠè´Ÿè½½å‡è¡¡ï¼Œå¹¶æ¡¥æŽ¥æ³¨å†Œä¸­å¿ƒï¼Œä»¥ Invoker ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æŽ¥å£ä¸º Cluster, Directory, Router, LoadBalance ã€‚ é›†ç¾¤å±‚ï¼Œå°è£…å¤šä¸ªæœåŠ¡æä¾›è€…çš„è·¯ç”±ä»¥åŠè´Ÿè½½å‡è¡¡ï¼Œå°†å¤šä¸ªå®žä¾‹ç»„åˆæˆä¸€ä¸ªæœåŠ¡ã€‚ å¦‚æžœèƒ–å‹äº†è§£ Spring Cloud ä½“ç³»ï¼Œå¯ä»¥ç±»æ¯”åŸŽ Ribbon ã€‚ monitor ç›‘æŽ§å±‚ï¼šRPC è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ç›‘æŽ§ï¼Œä»¥ Statistics ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æŽ¥å£ä¸º MonitorFactory, Monitor, MonitorService ã€‚ ç›‘æŽ§å±‚ï¼Œå¯¹ rpc æŽ¥å£çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´è¿›è¡Œç›‘æŽ§ã€‚ å¦‚æžœèƒ–å‹äº†è§£ SkyWalking é“¾è·¯è¿½è¸ªï¼Œä½ ä¼šå‘çŽ°ï¼ŒSkyWalking åŸºäºŽ MonitorFilter å®žçŽ°å¢žå¼ºï¼Œä»Žè€Œé€æ˜ŽåŒ–åŸ‹ç‚¹ç›‘æŽ§ã€‚ ==================== Remoting ==================== protocol è¿œç¨‹è°ƒç”¨å±‚ï¼šå°å°† RPC è°ƒç”¨ï¼Œä»¥ Invocation, Result ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æŽ¥å£ä¸º Protocol, Invoker, Exporter ã€‚ è¿œç¨‹è°ƒç”¨å±‚ï¼Œå°è£… rpc è°ƒç”¨ã€‚ exchange ä¿¡æ¯äº¤æ¢å±‚ï¼šå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥ï¼Œä»¥ Request, Response ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æŽ¥å£ä¸º Exchanger, ExchangeChannel, ExchangeClient, ExchangeServer ã€‚ ä¿¡æ¯äº¤æ¢å±‚ï¼Œå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥ã€‚ transport ç½‘ç»œä¼ è¾“å±‚ï¼šæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æŽ¥å£ï¼Œä»¥ Message ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æŽ¥å£ä¸º Channel, Transporter, Client, Server, Codec ã€‚ ç½‘ç»œä¼ è¾“å±‚ï¼ŒæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æŽ¥å£ã€‚ serialize æ•°æ®åºåˆ—åŒ–å±‚ï¼šå¯å¤ç”¨çš„ä¸€äº›å·¥å…·ï¼Œæ‰©å±•æŽ¥å£ä¸º Serialization, ObjectInput, ObjectOutput, ThreadPool ã€‚ æ•°æ®åºåˆ—åŒ–å±‚ã€‚ Dubbo è°ƒç”¨æµç¨‹ Provider ç¬¬ 0 æ­¥ï¼Œstart å¯åŠ¨æœåŠ¡ã€‚ ç¬¬ 1 æ­¥ï¼Œregister æ³¨å†ŒæœåŠ¡åˆ°æ³¨å†Œä¸­å¿ƒã€‚ Consumer ç¬¬ 2 æ­¥ï¼Œsubscribe å‘æ³¨å†Œä¸­å¿ƒè®¢é˜…æœåŠ¡ã€‚ æ³¨æ„ï¼Œåªè®¢é˜…ä½¿ç”¨åˆ°çš„æœåŠ¡ã€‚ å†æ³¨æ„ï¼Œé¦–æ¬¡ä¼šæ‹‰å–è®¢é˜…çš„æœåŠ¡åˆ—è¡¨ï¼Œç¼“å­˜åœ¨æœ¬åœ°ã€‚ ã€å¼‚æ­¥ã€‘ç¬¬ 3 æ­¥ï¼Œnotify å½“æœåŠ¡å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒèŽ·å–æœ€æ–°çš„æœåŠ¡åˆ—è¡¨ï¼Œæ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚ invoke è°ƒç”¨ Consumer ç›´æŽ¥å‘èµ·å¯¹ Provider çš„è°ƒç”¨ï¼Œæ— éœ€ç»è¿‡æ³¨å†Œä¸­å¿ƒã€‚è€Œå¯¹å¤šä¸ª Provider çš„è´Ÿè½½å‡è¡¡ï¼ŒConsumer é€šè¿‡ cluster ç»„ä»¶å®žçŽ°ã€‚ count ç›‘æŽ§ ã€å¼‚æ­¥ã€‘Consumer å’Œ Provider éƒ½å¼‚æ­¥é€šçŸ¥ç›‘æŽ§ä¸­å¿ƒã€‚ è¿™é‡Œè‰¿è‰¿åœ¨å¼•ç”¨ä¸€å¼ åœ¨ç½‘ä¸Šçœ‹åˆ°çš„å›¾ï¼Œæ›´ç«‹ä½“çš„å±•ç¤º Dubbo çš„è°ƒç”¨æµç¨‹ï¼š æ³¨æ„ï¼Œå›¾ä¸­çš„ã€ä»£ç†ã€‘æŒ‡çš„æ˜¯ proxy ä»£ç†æœåŠ¡å±‚ï¼Œå’Œ Consumer æˆ– Provider åœ¨åŒä¸€è¿›åŸŽä¸­ã€‚ æ³¨æ„ï¼Œå›¾ä¸­çš„ã€è´Ÿè½½å‡è¡¡ã€‘æŒ‡çš„æ˜¯ cluster è·¯ç”±å±‚ï¼Œå’Œ Consumer æˆ– Provider åœ¨åŒä¸€è¿›ç¨‹ä¸­ã€‚ Dubbo è°ƒç”¨æ˜¯åŒæ­¥çš„å—ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ˜¯åŒæ­¥çš„æ–¹å¼ã€‚ å¯ä»¥å‚è€ƒ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” å¼‚æ­¥è°ƒç”¨ã€‹ æ–‡æ¡£ï¼Œé…ç½®å¼‚æ­¥è°ƒç”¨çš„æ–¹å¼ã€‚å½“ç„¶ï¼Œä½¿ç”¨ä¸Šï¼Œæ„Ÿè§‰è›®ä¸ä¼˜é›…çš„ã€‚æ‰€ä»¥ï¼Œåœ¨ Dubbo 2.7 ç‰ˆæœ¬åŽï¼Œåˆæä¾›äº†æ–°çš„ä¸¤ç§æ–¹å¼ï¼Œå…·ä½“å…ˆå‚è§ ã€ŠDubboä¸‹ä¸€ç«™ï¼šApacheé¡¶çº§é¡¹ç›®ã€‹ æ–‡ç« ã€‚ä¼°è®¡ï¼ŒåŽç»­æ‰ä¼šæ›´æ–°å®˜æ–¹æ–‡æ¡£ã€‚ è°ˆè°ˆå¯¹ Dubbo çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼ŸDubbo å¼‚å¸¸å¤„ç†æœºåˆ¶æ¶‰åŠçš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæ ¸å¿ƒåœ¨äºŽ Provider çš„ å¼‚å¸¸è¿‡æ»¤å™¨ ExceptionFilter å¯¹è°ƒç”¨ç»“æžœçš„å„ç§æƒ…å†µçš„å¤„ç†ã€‚æ‰€ä»¥å»ºè®®èƒ–å‹çœ‹å¦‚ä¸‹ä¸‰ç¯‡æ–‡ç« ï¼š å¢™è£‚æŽ¨è ã€ŠDubbo(å››) å¼‚å¸¸å¤„ç†ã€‹ ã€Šæµ…è°ˆ Dubbo çš„ ExceptionFilter å¼‚å¸¸å¤„ç†ã€‹ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” è¿‡æ»¤å™¨ï¼ˆä¸ƒï¼‰ä¹‹ ExceptionFilterã€‹ Dubbo å¦‚ä½•åšå‚æ•°æ ¡éªŒï¼Ÿåœ¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” å‚æ•°éªŒè¯ã€‹ ä¸­ï¼Œä»‹ç»å¦‚ä¸‹ï¼š å‚æ•°éªŒè¯åŠŸèƒ½æ˜¯åŸºäºŽ JSR303 å®žçŽ°çš„ï¼Œç”¨æˆ·åªéœ€æ ‡è¯† JSR303 æ ‡å‡†çš„éªŒè¯ annotationï¼Œå¹¶é€šè¿‡å£°æ˜Ž filter æ¥å®žçŽ°éªŒè¯ã€‚ å‚æ•°æ ¡éªŒåŠŸèƒ½ï¼Œé€šè¿‡å‚æ•°æ ¡éªŒè¿‡æ»¤å™¨ ValidationFilter æ¥å®žçŽ°ã€‚ ValidationFilter åœ¨ Dubbo Provider å’Œ Consumer éƒ½å¯ç”Ÿæ•ˆã€‚ å¦‚æžœæˆ‘ä»¬å°†æ ¡éªŒæ³¨è§£å†™åœ¨ Service æŽ¥å£çš„æ–¹æ³•ä¸Šï¼Œé‚£ä¹ˆ Consumer åœ¨æœ¬åœ°å°±ä¼šæ ¡éªŒã€‚å¦‚æžœæ ¡éªŒä¸é€šè¿‡ï¼Œç›´æŽ¥æŠ›å‡ºæ ¡éªŒå¤±è´¥çš„å¼‚å¸¸ï¼Œä¸ä¼šå‘èµ· Dubbo è°ƒç”¨ã€‚ å¦‚æžœæˆ‘ä»¬å°†æ ¡éªŒæ³¨è§£å†™åœ¨ Service å®žçŽ°çš„æ–¹æ³•ä¸Šï¼Œé‚£ä¹ˆ Consumer åœ¨æœ¬åœ°ä¸ä¼šæ ¡éªŒï¼Œè€Œæ˜¯ç”± Provider æ ¡éªŒã€‚ Dubbo å¯ä»¥å¯¹è°ƒç”¨ç»“æžœè¿›è¡Œç¼“å­˜å—?Dubbo é€šè¿‡ CacheFilter è¿‡æ»¤å™¨ï¼Œæä¾›ç»“æžœç¼“å­˜çš„åŠŸèƒ½ï¼Œä¸”æ—¢å¯ä»¥é€‚ç”¨äºŽ Consumer ä¹Ÿå¯ä»¥é€‚ç”¨äºŽ Provider ã€‚ é€šè¿‡ç»“æžœç¼“å­˜ï¼Œç”¨äºŽåŠ é€Ÿçƒ­é—¨æ•°æ®çš„è®¿é—®é€Ÿåº¦ï¼ŒDubbo æä¾›å£°æ˜Žå¼ç¼“å­˜ï¼Œä»¥å‡å°‘ç”¨æˆ·åŠ ç¼“å­˜çš„å·¥ä½œé‡ã€‚ Dubbo ç›®å‰æä¾›ä¸‰ç§å®žçŽ°ï¼š lru ï¼šåŸºäºŽæœ€è¿‘æœ€å°‘ä½¿ç”¨åŽŸåˆ™åˆ é™¤å¤šä½™ç¼“å­˜ï¼Œä¿æŒæœ€çƒ­çš„æ•°æ®è¢«ç¼“å­˜ã€‚ threadlocal ï¼šå½“å‰çº¿ç¨‹ç¼“å­˜ï¼Œæ¯”å¦‚ä¸€ä¸ªé¡µé¢æ¸²æŸ“ï¼Œç”¨åˆ°å¾ˆå¤š portalï¼Œæ¯ä¸ª portal éƒ½è¦åŽ»æŸ¥ç”¨æˆ·ä¿¡æ¯ï¼Œé€šè¿‡çº¿ç¨‹ç¼“å­˜ï¼Œå¯ä»¥å‡å°‘è¿™ç§å¤šä½™è®¿é—®ã€‚ jcache ï¼šä¸Ž JSR107 é›†æˆï¼Œå¯ä»¥æ¡¥æŽ¥å„ç§ç¼“å­˜å®žçŽ°ã€‚ è¯¦ç»†çš„æºç è§£æžï¼Œå¯è§ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” è¿‡æ»¤å™¨ï¼ˆåï¼‰ä¹‹ CacheFilterã€‹ ã€‚ æ³¨å†Œä¸­å¿ƒæŒ‚äº†è¿˜å¯ä»¥é€šä¿¡å—ï¼Ÿå¯ä»¥ã€‚å¯¹äºŽæ­£åœ¨è¿è¡Œçš„ Consumer è°ƒç”¨ Provider æ˜¯ä¸éœ€è¦ç»è¿‡æ³¨å†Œä¸­å¿ƒï¼Œæ‰€ä»¥ä¸å—å½±å“ã€‚å¹¶ä¸”ï¼ŒConsumer è¿›ç¨‹ä¸­ï¼Œå†…å­˜å·²ç»ç¼“å­˜äº† Provider åˆ—è¡¨ã€‚ é‚£ä¹ˆï¼Œæ­¤æ—¶ Provider å¦‚æžœä¸‹çº¿å‘¢ï¼Ÿå¦‚æžœ Provider æ˜¯æ­£å¸¸å…³é—­ï¼Œå®ƒä¼šä¸»åŠ¨ä¸”ç›´æŽ¥å¯¹å’Œå…¶å¤„äºŽè¿žæŽ¥ä¸­çš„ Consumer ä»¬ï¼Œå‘é€ä¸€æ¡â€œæˆ‘è¦å…³é—­â€äº†çš„æ¶ˆæ¯ã€‚é‚£ä¹ˆï¼ŒConsumer ä»¬å°±ä¸ä¼šè°ƒç”¨è¯¥ Provider ï¼Œè€Œè°ƒç”¨å…¶å®ƒçš„ Provider ã€‚ å¦å¤–ï¼Œå› ä¸º Consumer ä¹Ÿä¼šæŒä¹…åŒ– Provider åˆ—è¡¨åˆ°æœ¬åœ°æ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œæ­¤å¤„å¦‚æžœ Consumer é‡å¯ï¼Œä¾ç„¶èƒ½å¤Ÿé€šè¿‡æœ¬åœ°ç¼“å­˜çš„æ–‡ä»¶ï¼ŒèŽ·å¾—åˆ° Provider åˆ—è¡¨ã€‚ å†å¦å¤–ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ³¨å†Œä¸­å¿ƒæ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œå¦‚æžœä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼ŒDubbo Consumer å’Œ Provider å°†è‡ªåŠ¨åˆ‡æ¢åˆ°é›†ç¾¤çš„å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ Dubbo åœ¨ Zookeeper å­˜å‚¨äº†å“ªäº›ä¿¡æ¯ï¼Ÿä¸‹é¢ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” zookeeper æ³¨å†Œä¸­å¿ƒã€‹ æ–‡æ¡£ï¼Œå†…å®¹å¦‚ä¸‹ï¼š æµç¨‹è¯´æ˜Žï¼š æœåŠ¡æä¾›è€…å¯åŠ¨æ—¶: å‘ /dubbo/com.foo.BarService/providers ç›®å½•ä¸‹å†™å…¥è‡ªå·±çš„ URL åœ°å€ æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨æ—¶: è®¢é˜… /dubbo/com.foo.BarService/providers ç›®å½•ä¸‹çš„æä¾›è€… URL åœ°å€ã€‚å¹¶å‘ /dubbo/com.foo.BarService/consumers ç›®å½•ä¸‹å†™å…¥è‡ªå·±çš„ URL åœ°å€ ç›‘æŽ§ä¸­å¿ƒå¯åŠ¨æ—¶: è®¢é˜… /dubbo/com.foo.BarService ç›®å½•ä¸‹çš„æ‰€æœ‰æä¾›è€…å’Œæ¶ˆè´¹è€… URL åœ°å€ã€‚ åœ¨å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Zookeeper çš„èŠ‚ç‚¹å±‚çº§ï¼Œè‡ªä¸Šè€Œä¸‹æ˜¯ï¼š Root å±‚ï¼šæ ¹ç›®å½•ï¼Œå¯é€šè¿‡ &lt;dubbo:registry group=&quot;dubbo&quot; /&gt; çš„ &quot;group&quot; è®¾ç½® Zookeeper çš„æ ¹èŠ‚ç‚¹ï¼Œç¼ºçœä½¿ç”¨ &quot;dubbo&quot; ã€‚ Service å±‚ï¼šæœåŠ¡æŽ¥å£å…¨åã€‚ Type å±‚ï¼šåˆ†ç±»ã€‚ç›®å‰é™¤äº†æˆ‘ä»¬åœ¨å›¾ä¸­çœ‹åˆ°çš„ &quot;providers&quot;( æœåŠ¡æä¾›è€…åˆ—è¡¨ ) &quot;consumers&quot;( æœåŠ¡æ¶ˆè´¹è€…åˆ—è¡¨ ) å¤–ï¼Œè¿˜æœ‰ &quot;routes&quot;( è·¯ç”±è§„åˆ™åˆ—è¡¨ ) å’Œ &quot;configurations&quot;( é…ç½®è§„åˆ™åˆ—è¡¨ )ã€‚ URL å±‚ï¼šURL ï¼Œæ ¹æ®ä¸åŒ Type ç›®å½•ï¼Œä¸‹é¢å¯ä»¥æ˜¯æœåŠ¡æä¾›è€… URL ã€æœåŠ¡æ¶ˆè´¹è€… URL ã€è·¯ç”±è§„åˆ™ URL ã€é…ç½®è§„åˆ™ URL ã€‚ å®žé™…ä¸Š URL ä¸Šå¸¦æœ‰ &quot;category&quot; å‚æ•°ï¼Œå·²ç»èƒ½åˆ¤æ–­æ¯ä¸ª URL çš„åˆ†ç±»ï¼Œä½†æ˜¯ Zookeeper æ˜¯åŸºäºŽèŠ‚ç‚¹ç›®å½•è®¢é˜…çš„ï¼Œæ‰€ä»¥å¢žåŠ äº† Typeå±‚ã€‚ å®žé™…ä¸Šï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨åŽï¼Œä¸ä»…ä»…è®¢é˜…äº† &quot;providers&quot; åˆ†ç±»ï¼Œä¹Ÿè®¢é˜…äº† &quot;routes&quot; &quot;configurations&quot; åˆ†ç±»ã€‚ Dubbo Provider å¦‚ä½•å®žçŽ°ä¼˜é›…åœæœºï¼Ÿåœ¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” ä¼˜é›…åœæœºã€‹ ä¸­ï¼Œå·²ç»å¯¹è¿™å—è¿›è¡Œäº†è¯¦ç»†çš„è¯´æ˜Žã€‚ ä¼˜é›…åœæœº Dubbo æ˜¯é€šè¿‡ JDK çš„ ShutdownHook æ¥å®Œæˆä¼˜é›…åœæœºçš„ï¼Œæ‰€ä»¥å¦‚æžœç”¨æˆ·ä½¿ç”¨ kill -9 PID ç­‰å¼ºåˆ¶å…³é—­æŒ‡ä»¤ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œä¼˜é›…åœæœºçš„ï¼Œåªæœ‰é€šè¿‡ kill PID æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œã€‚ å› ä¸ºå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒDubbo çš„å£°æ˜Žå‘¨æœŸæ˜¯äº¤ç»™ Spring è¿›è¡Œç®¡ç†ï¼Œæ‰€ä»¥åœ¨æœ€æ–°çš„ Dubbo ç‰ˆæœ¬ä¸­ï¼Œå¢žåŠ äº†å¯¹ Spring å…³é—­äº‹ä»¶çš„ç›‘å¬ï¼Œä»Žè€Œå…³é—­ Dubbo æœåŠ¡ã€‚å¯¹åº”å¯è§ https://github.com/apache/incubator-dubbo/issues/2865 ã€‚ æœåŠ¡æä¾›æ–¹çš„ä¼˜é›…åœæœºè¿‡ç¨‹ é¦–å…ˆï¼Œä»Žæ³¨å†Œä¸­å¿ƒä¸­å–æ¶ˆæ³¨å†Œè‡ªå·±ï¼Œä»Žè€Œä½¿æ¶ˆè´¹è€…ä¸è¦å†æ‹‰å–åˆ°å®ƒã€‚ ç„¶åŽï¼Œsleep 10 ç§’( å¯é… )ï¼Œç­‰åˆ°æœåŠ¡æ¶ˆè´¹ï¼ŒæŽ¥æ”¶åˆ°æ³¨å†Œä¸­å¿ƒé€šçŸ¥åˆ°è¯¥æœåŠ¡æä¾›è€…å·²ç»ä¸‹çº¿ï¼ŒåŠ å¤§äº†åœ¨ä¸é‡è¯•æƒ…å†µä¸‹ä¼˜é›…åœæœºçš„æˆåŠŸçŽ‡ã€‚ðŸ˜ˆ æ­¤å¤„æ˜¯ä¸ªæ¦‚çŽ‡å­¦ï¼Œå˜»å˜»ã€‚ ä¹‹åŽï¼Œå¹¿æ’­ READONLY äº‹ä»¶ç»™æ‰€æœ‰ Consumer ä»¬ï¼Œå‘Šè¯‰å®ƒä»¬ä¸è¦åœ¨è°ƒç”¨æˆ‘äº†ï¼ï¼ï¼ã€å¾ˆæœ‰è¶£çš„ä¸€ä¸ªæ­¥éª¤ã€‘å¹¶ä¸”ï¼Œå¦‚æžœæ­¤å¤„æ³¨å†Œä¸­å¿ƒæŒ‚æŽ‰çš„æƒ…å†µï¼Œä¾ç„¶èƒ½è¾¾åˆ°å‘Šè¯‰ Consumer ï¼Œæˆ‘è¦ä¸‹çº¿äº†çš„åŠŸèƒ½ã€‚ å†ä¹‹åŽï¼Œsleep 10 æ¯«ç§’ï¼Œä¿è¯ Consumer ä»¬ï¼Œå°½å¯èƒ½æŽ¥æ”¶åˆ°è¯¥æ¶ˆæ¯ã€‚ å†å†ä¹‹åŽï¼Œå…ˆæ ‡è®°ä¸ºä¸æŽ¥æ”¶æ–°è¯·æ±‚ï¼Œæ–°è¯·æ±‚è¿‡æ¥æ—¶ç›´æŽ¥æŠ¥é”™ï¼Œè®©å®¢æˆ·ç«¯é‡è¯•å…¶å®ƒæœºå™¨ã€‚ å†å†å†ä¹‹åŽï¼Œå…³é—­å¿ƒè·³çº¿ç¨‹ã€‚ æœ€åŽï¼Œæ£€æµ‹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œå¦‚æžœæœ‰ï¼Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œé™¤éžè¶…æ—¶ï¼Œåˆ™å¼ºåˆ¶å…³é—­ã€‚ æœ€æœ€åŽï¼Œå…³é—­æœåŠ¡å™¨ã€‚ æ•´ä¸ªè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥è¯¦ç»†æ¥çœ‹çœ‹ ã€Šç²¾å°½ Dubbo æºç è§£æž â€”â€” ä¼˜é›…åœæœºã€‹ ã€‚ æœåŠ¡æ¶ˆè´¹æ–¹çš„ä¼˜é›…åœæœºè¿‡ç¨‹ åœæ­¢æ—¶ï¼Œä¸å†å‘èµ·æ–°çš„è°ƒç”¨è¯·æ±‚ï¼Œæ‰€æœ‰æ–°çš„è°ƒç”¨åœ¨å®¢æˆ·ç«¯å³æŠ¥é”™ã€‚ ç„¶åŽï¼Œæ£€æµ‹æœ‰æ²¡æœ‰è¯·æ±‚çš„å“åº”è¿˜æ²¡æœ‰è¿”å›žï¼Œç­‰å¾…å“åº”è¿”å›žï¼Œé™¤éžè¶…æ—¶ï¼Œåˆ™å¼ºåˆ¶å…³é—­ã€‚ Dubbo Provider å¼‚æ­¥å…³é—­æ—¶ï¼Œå¦‚ä½•ä»Žæ³¨å†Œä¸­å¿ƒä¸‹çº¿ï¼Ÿâ‘  Zookeeper æ³¨å†Œä¸­å¿ƒçš„æƒ…å†µä¸‹ æœåŠ¡æä¾›è€…ï¼Œæ³¨å†Œåˆ° Zookeeper ä¸Šæ—¶ï¼Œåˆ›å»ºçš„æ˜¯ EPHEMERAL ä¸´æ—¶èŠ‚ç‚¹ã€‚æ‰€ä»¥åœ¨æœåŠ¡æä¾›è€…å¼‚å¸¸å…³é—­æ—¶ï¼Œç­‰å¾… Zookeeper ä¼šè¯è¶…æ—¶ï¼Œé‚£ä¹ˆè¯¥ä¸´æ—¶èŠ‚ç‚¹å°±ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ â‘¡ Redis æ³¨å†Œä¸­å¿ƒçš„æƒ…å†µä¸‹ ä½¿ç”¨ Redis ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œæ˜¯æœ‰ç‚¹å°ä¼—çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å°±ä¸åœ¨æœ¬æ–‡è¯¦ç»†è¯´äº†ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æ³¨å†Œä¸­å¿ƒï¼ˆä¸‰ï¼‰ä¹‹ Redisã€‹ ä¸€æ–‡ã€‚æ€»çš„æ¥è¯´ï¼Œå®žçŽ°ä¸Šï¼Œè¿˜æ˜¯è›®æœ‰è¶£çš„ã€‚å› ä¸ºï¼Œéœ€è¦é€šçŸ¥åˆ°æ¶ˆè´¹è€…ï¼ŒæœåŠ¡åˆ—è¡¨å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å°±æ— æ³•ä½¿ç”¨ Redis Key è‡ªåŠ¨è¿‡æœŸã€‚æ‰€ä»¥â€¦ è¿˜æ˜¯çœ‹æ–‡ç« å§ã€‚å“ˆå“ˆå“ˆå“ˆã€‚ Dubbo Consumer åªèƒ½è°ƒç”¨ä»Žæ³¨å†Œä¸­å¿ƒèŽ·å–çš„ Provider ä¹ˆï¼Ÿä¸æ˜¯ï¼ŒConsumer å¯ä»¥å¼ºåˆ¶ç›´è¿ž Provider ã€‚ åœ¨å¼€å‘åŠæµ‹è¯•çŽ¯å¢ƒä¸‹ï¼Œç»å¸¸éœ€è¦ç»•è¿‡æ³¨å†Œä¸­å¿ƒï¼Œåªæµ‹è¯•æŒ‡å®šæœåŠ¡æä¾›è€…ï¼Œè¿™æ—¶å€™å¯èƒ½éœ€è¦ç‚¹å¯¹ç‚¹ç›´è¿žï¼Œç‚¹å¯¹ç‚¹ç›´è¿žæ–¹å¼ï¼Œå°†ä»¥æœåŠ¡æŽ¥å£ä¸ºå•ä½ï¼Œå¿½ç•¥æ³¨å†Œä¸­å¿ƒçš„æä¾›è€…åˆ—è¡¨ï¼ŒA æŽ¥å£é…ç½®ç‚¹å¯¹ç‚¹ï¼Œä¸å½±å“ B æŽ¥å£ä»Žæ³¨å†Œä¸­å¿ƒèŽ·å–åˆ—è¡¨ã€‚ ç›¸å…³æ–‡æ¡£ï¼Œå¯è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” ç›´è¿žæä¾›è€…ã€‹ ã€‚ å¦å¤–ï¼Œç›´è¿ž Dubbo Provider æ—¶ï¼Œå¦‚æžœè¦ Debug è°ƒè¯• Dubbo Provider ï¼Œå¯ä»¥é€šè¿‡é…ç½®ï¼Œç¦ç”¨è¯¥ Provider æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒã€‚å¦åˆ™ï¼Œä¼šè¢«å…¶å®ƒ Consumer è°ƒç”¨åˆ°ã€‚å…·ä½“çš„é…ç½®æ–¹å¼ï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” åªè®¢é˜…ã€‹ ã€‚ Dubbo æ”¯æŒå“ªäº›é€šä¿¡åè®®ï¼Ÿ å¯¹åº”ã€protocol è¿œç¨‹è°ƒç”¨å±‚ã€‘ã€‚ Dubbo ç›®å‰æ”¯æŒå¦‚ä¸‹ 9 ç§é€šä¿¡åè®®ï¼š ã€é‡è¦ã€‘dubbo:// ï¼Œé»˜è®¤åè®®ã€‚å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” dubbo://ã€‹ ã€‚ ã€é‡è¦ã€‘rest:// ï¼Œè´¡çŒ®è‡ª Dubbox ï¼Œç›®å‰æœ€åˆé€‚çš„ HTTP Restful API åè®®ã€‚å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” rest://ã€‹ ã€‚ rmi:// ï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” rmi://ã€‹ ã€‚ webservice:// ï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” webservice://ã€‹ ã€‚ hessian:// ï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” hessian://ã€‹ ã€‚ thrift:// ï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” thrift://ã€‹ ã€‚ memcached:// ï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” memcached://ã€‹ ã€‚ redis:// ï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” redis://ã€‹ ã€‚ http:// ï¼Œå‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” http://ã€‹ ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ç†è§£çš„ HTTP åè®®æœ‰å·®å¼‚ï¼Œè€Œæ˜¯ Spring çš„ HttpInvoker å®žçŽ°ã€‚ å®žé™…ä¸Šï¼Œç¤¾åŒºé‡Œè¿˜æœ‰å…¶ä»–é€šä¿¡åè®®æ­£å¤„äºŽå­µåŒ–ï¼š jsonrpc:// ï¼Œå¯¹åº” Github ä»“åº“ä¸º https://github.com/apache/incubator-dubbo-rpc-jsonrpc ï¼Œæ¥è‡ªåƒç±³ç½‘çš„è´¡çŒ®ã€‚ ðŸ˜ˆ æ¯ä¸€ç§é€šä¿¡åè®®çš„å®žçŽ°ï¼Œåœ¨ ã€Šç²¾å°½ Dubbo æºç è§£æžã€‹ ä¸­ï¼Œéƒ½æœ‰è¯¦ç»†è§£æžã€‚ å¦å¤–ï¼Œåœ¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æ€§èƒ½æµ‹è¯•æŠ¥å‘Šã€‹ ä¸­ï¼Œå®˜æ–¹æä¾›äº†ä¸Šè¿°åè®®çš„æ€§èƒ½æµ‹è¯•å¯¹æ¯”ã€‚ ä»€ä¹ˆæ˜¯æœ¬åœ°æš´éœ²å’Œè¿œç¨‹æš´éœ²ï¼Œä»–ä»¬çš„åŒºåˆ«ï¼Ÿè¿œç¨‹æš´éœ²ï¼Œæ¯”è¾ƒå¥½ç†è§£ã€‚åœ¨ ã€ŒDubbo æ”¯æŒå“ªäº›é€šä¿¡åè®®ï¼Ÿã€ é—®é¢˜æ±‡æ€»ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ï¼Œéƒ½æ˜¯è¿œç¨‹æš´éœ²ã€‚æ¯æ¬¡ Consumer è°ƒç”¨ Provider éƒ½æ˜¯è·¨è¿›ç¨‹ï¼Œéœ€è¦è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚ æœ¬åœ°æš´éœ²ï¼Œåœ¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æœ¬åœ°è°ƒç”¨ã€‹ ä¸€æ–‡ä¸­ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š æœ¬åœ°è°ƒç”¨ä½¿ç”¨äº† injvm:// åè®®ï¼Œæ˜¯ä¸€ä¸ªä¼ªåè®®ï¼Œå®ƒä¸å¼€å¯ç«¯å£ï¼Œä¸å‘èµ·è¿œç¨‹è°ƒç”¨ï¼Œåªåœ¨ JVM å†…ç›´æŽ¥å…³è”ï¼Œä½†æ‰§è¡Œ Dubbo çš„ Filter é“¾ã€‚ æ€Žä¹ˆç†è§£å‘¢ï¼Ÿæœ¬åœ°çš„ Dubbo Service Proxy å¯¹è±¡ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶ï¼Œä¼šèµ° Dubbo Filter é“¾ã€‚ ä¸¾ä¸ªä¾‹å­ï¼ŒSpring Boot Controller è°ƒç”¨ Service é€»è¾‘ï¼Œå°±å˜æˆäº†è°ƒç”¨ Dubbo Service Proxy å¯¹è±¡ã€‚è¿™æ ·ï¼Œå¦‚æžœæœªæ¥æœ‰ä¸€å¤©ï¼Œæœ¬åœ° Dubbo Service è¿ç§»æˆè¿œç¨‹çš„ Dubbo Service ï¼Œåªéœ€è¦è¿›è¡Œé…ç½®çš„ä¿®æ”¹ï¼Œè€Œå¯¹ Controller æ˜¯é€æ˜Žçš„ã€‚ Dubbo ä½¿ç”¨ä»€ä¹ˆé€šä¿¡æ¡†æž¶ï¼Ÿ å¯¹åº”ã€transport ç½‘ç»œä¼ è¾“å±‚ã€‘ã€‚ åœ¨é€šä¿¡æ¡†æž¶çš„é€‰æ‹©ä¸Šï¼Œå¼ºå¤§çš„æŠ€æœ¯ç¤¾åŒºæœ‰éžå¸¸å¤šçš„é€‰æ‹©ï¼Œå¦‚ä¸‹åˆ—è¡¨ï¼š Netty3 Netty4 Mina Grizzly é‚£ä¹ˆ Dubbo æ˜¯å¦‚ä½•åšæŠ€æœ¯é€‰åž‹å’Œå®žçŽ°çš„å‘¢ï¼ŸDubbo åœ¨é€šä¿¡å±‚æ‹†åˆ†æˆäº† API å±‚ã€å®žçŽ°å±‚ã€‚é¡¹ç›®ç»“æž„å¦‚ä¸‹ï¼š API å±‚ï¼š dubbo-remoting-api å®žçŽ°å±‚ï¼š dubbo-remoting-netty3 dubbo-remoting-netty4 dubbo-remoting-mina dubbo-remoting-grizzly å†é…åˆä¸Š Dubbo SPI çš„æœºåˆ¶ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªå®šä¹‰ä½¿ç”¨å“ªä¸€ç§å…·ä½“çš„å®žçŽ°ã€‚ç¾Žæ»‹æ»‹ã€‚ åœ¨ Dubbo çš„æœ€æ–°ç‰ˆæœ¬ï¼Œé»˜è®¤ä½¿ç”¨ Netty4 çš„ç‰ˆæœ¬ã€‚ðŸ˜ˆ è¿™å°±æ˜¯ç»“è®ºã€‚å˜»å˜»ã€‚ Dubbo æ”¯æŒå“ªäº›åºåˆ—åŒ–æ–¹å¼ï¼Ÿ å¯¹åº”ã€serialize æ•°æ®åºåˆ—åŒ–å±‚ã€‘ã€‚ Dubbo ç›®å‰æ”¯ä»˜å¦‚ä¸‹ 7 ç§åºåˆ—åŒ–æ–¹å¼ï¼š ã€é‡è¦ã€‘Hessian2 ï¼šåŸºäºŽ Hessian å®žçŽ°çš„åºåˆ—åŒ–æ‹“å±•ã€‚ 1dubbo:// åè®®çš„é»˜è®¤åºåˆ—åŒ–æ–¹æ¡ˆã€‚ Hessian é™¤äº†æ˜¯ Web æœåŠ¡ï¼Œä¹Ÿæä¾›äº†å…¶åºåˆ—åŒ–å®žçŽ°ï¼Œå› æ­¤ Dubbo åŸºäºŽå®ƒå®žçŽ°äº†åºåˆ—åŒ–æ‹“å±•ã€‚ å¦å¤–ï¼ŒDubbo ç»´æŠ¤äº†è‡ªå·±çš„ hessian-lite ï¼Œå¯¹ Hessian 2 çš„ åºåˆ—åŒ– éƒ¨åˆ†çš„ç²¾ç®€ã€æ”¹è¿›ã€BugFix ã€‚ Dubbo ï¼šDubbo è‡ªå·±å®žçŽ°çš„åºåˆ—åŒ–æ‹“å±•ã€‚ å…·ä½“å¯å‚è§ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” åºåˆ—åŒ–ï¼ˆäºŒï¼‰ä¹‹ Dubbo å®žçŽ°ã€‹ ã€‚ Kryo ï¼šåŸºäºŽ Kryo å®žçŽ°çš„åºåˆ—åŒ–æ‹“å±•ã€‚ å…·ä½“å¯å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” Kryo åºåˆ—åŒ–ã€‹ FST ï¼šåŸºäºŽ FST å®žçŽ°çš„åºåˆ—åŒ–æ‹“å±•ã€‚ å…·ä½“å¯å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” FST åºåˆ—åŒ–ã€‹ JSON ï¼šåŸºäºŽ Fastjson å®žçŽ°çš„åºåˆ—åŒ–æ‹“å±•ã€‚ NativeJava ï¼šåŸºäºŽ Java åŽŸç”Ÿçš„åºåˆ—åŒ–æ‹“å±•ã€‚ CompactedJava ï¼šåœ¨ NativeJava çš„åŸºç¡€ä¸Šï¼Œå®žçŽ°äº†å¯¹ ClassDescriptor çš„å¤„ç†ã€‚ å¯èƒ½èƒ–å‹ä¼šä¸€è„¸æ‡µé€¼ï¼Œæœ‰è¿™ä¹ˆå¤šï¼Ÿå…¶å®žè¿˜å¥½ï¼Œä¸Šè¿°åŸºæœ¬æ˜¯å¸‚é¢ä¸Šä¸»æµçš„é›†ä¸­åºåˆ—åŒ–å·¥å…·ï¼ŒDubbo åŸºäºŽå®ƒä»¬ä¹‹ä¸Šæä¾›åºåˆ—åŒ–æ‹“å±•ã€‚ ç„¶åŽï¼Œèƒ–å‹å¯èƒ½ä¼šè¯´ï¼ŒProtobuf ä¹Ÿæ˜¯éžå¸¸ä¼˜ç§€çš„åºåˆ—åŒ–æ–¹æ¡ˆï¼Œä¸ºä»€ä¹ˆ Dubbo æ²¡æœ‰åŸºäºŽå®ƒçš„åºåˆ—åŒ–æ‹“å±•ï¼Ÿä»Ž Dubbo åŽç»­çš„å¼€å‘è®¡åˆ’ä¸Šï¼Œåº”è¯¥ä¼šå¢žåŠ è¯¥åºåˆ—åŒ–çš„æ”¯æŒã€‚å¦å¤–ï¼Œå¾®åšçš„ Motan æœ‰å®žçŽ°å¯¹ Protobuf åºåˆ—åŒ–çš„æ”¯æŒï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ ã€Šæ·±å…¥ç†è§£RPCä¹‹åºåˆ—åŒ–ç¯‡ â€”â€” æ€»ç»“ç¯‡ã€‹ çš„ ã€ŒProtostuffå®žçŽ°ã€ å°èŠ‚ã€‚ Dubbo æœ‰å“ªäº›è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Ÿ å¯¹åº”ã€cluster è·¯ç”±å±‚ã€‘çš„ LoadBalance ç»„ä»¶ã€‚ åœ¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” è´Ÿè½½å‡è¡¡ã€‹ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Dubbo å†…ç½® 4 ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚å…¶ä¸­ï¼Œé»˜è®¤ä½¿ç”¨ random éšæœºè°ƒç”¨ç­–ç•¥ã€‚ Random LoadBalance éšæœºï¼ŒæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚çŽ‡ã€‚ åœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’žçš„æ¦‚çŽ‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚çŽ‡ä½¿ç”¨æƒé‡åŽä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºŽåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚ RoundRobin LoadBalance è½®è¯¢ï¼ŒæŒ‰å…¬çº¦åŽçš„æƒé‡è®¾ç½®è½®è¯¢æ¯”çŽ‡ã€‚ å­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šã€‚ ä¸¾ä¸ªæ —å­ã€‚ è·Ÿè¿ç»´åŒå­¦ç”³è¯·æœºå™¨ï¼Œæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿æ°”å¥½ï¼Œæ­£å¥½å…¬å¸èµ„æºæ¯”è¾ƒå……è¶³ï¼Œåˆšåˆšæœ‰ä¸€æ‰¹çƒ­æ°”è…¾è…¾ã€åˆšåˆšåšå¥½çš„ä¸€æ‰¹è™šæ‹Ÿæœºæ–°é²œå‡ºç‚‰ï¼Œé…ç½®éƒ½æ¯”è¾ƒé«˜ã€‚8æ ¸+16gï¼Œæœºå™¨ï¼Œ2 å°ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘æ„Ÿè§‰ 2 å°æœºå™¨æœ‰ç‚¹ä¸å¤ªå¤Ÿï¼Œæˆ‘åŽ»æ‰¾è¿ç»´åŒå­¦ï¼Œå“¥å„¿ä»¬ï¼Œä½ èƒ½ä¸èƒ½å†ç»™æˆ‘ 1 å°æœºå™¨ï¼Œ4æ ¸+8Gçš„æœºå™¨ã€‚æˆ‘è¿˜æ˜¯å¾—è¦ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥ç»™ä¸¤å° 8æ ¸16g çš„æœºå™¨è®¾ç½®æƒé‡ 4ï¼Œç»™å‰©ä½™ 1 å° 4æ ¸8G çš„æœºå™¨è®¾ç½®æƒé‡ 2ã€‚ LeastActive LoadBalance æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åŽè®¡æ•°å·®ã€‚ ä½¿æ…¢çš„æä¾›è€…æ”¶åˆ°æ›´å°‘è¯·æ±‚ï¼Œå› ä¸ºè¶Šæ…¢çš„æä¾›è€…çš„è°ƒç”¨å‰åŽè®¡æ•°å·®ä¼šè¶Šå¤§ã€‚ è¿™ä¸ªå°±æ˜¯è‡ªåŠ¨æ„ŸçŸ¥ä¸€ä¸‹ï¼Œå¦‚æžœæŸä¸ªæœºå™¨æ€§èƒ½è¶Šå·®ï¼Œé‚£ä¹ˆæŽ¥æ”¶çš„è¯·æ±‚è¶Šå°‘ï¼Œè¶Šä¸æ´»è·ƒï¼Œæ­¤æ—¶å°±ä¼šç»™ä¸æ´»è·ƒçš„æ€§èƒ½å·®çš„æœºå™¨æ›´å°‘çš„è¯·æ±‚ã€‚ ConsistentHash LoadBalance ä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚ å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŽŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºŽè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚ Dubbo æœ‰å“ªäº›é›†ç¾¤å®¹é”™ç­–ç•¥ï¼Ÿ å¯¹åº”ã€cluster è·¯ç”±å±‚ã€‘çš„ Cluster ç»„ä»¶ã€‚ åœ¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” é›†ç¾¤å®¹é”™ã€‹ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Dubbo å†…ç½® 6 ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚å…¶ä¸­ï¼Œé»˜è®¤ä½¿ç”¨ failover å¤±è´¥è‡ªåŠ¨é‡è¯•å…¶ä»–æœåŠ¡çš„ç­–ç•¥ã€‚ Failover Cluster å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºçŽ°å¤±è´¥ï¼Œé‡è¯•å…¶å®ƒæœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºŽè¯»æ“ä½œï¼Œä½†é‡è¯•ä¼šå¸¦æ¥æ›´é•¿å»¶è¿Ÿã€‚å¯é€šè¿‡ retries=&quot;2&quot; æ¥è®¾ç½®é‡è¯•æ¬¡æ•°(ä¸å«ç¬¬ä¸€æ¬¡)ã€‚ Failfast Cluster å¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºŽéžå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢žè®°å½•ã€‚ Failsafe Cluster å¤±è´¥å®‰å…¨ï¼Œå‡ºçŽ°å¼‚å¸¸æ—¶ï¼Œç›´æŽ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºŽå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œã€‚ Failback Cluster å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼ŒåŽå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºŽæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚ Forking Cluster å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›žã€‚é€šå¸¸ç”¨äºŽå®žæ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ forks=&quot;2&quot; æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚ Broadcast Cluster å¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ã€‚é€šå¸¸ç”¨äºŽé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚ Dubbo æœ‰å“ªäº›åŠ¨æ€ä»£ç†ç­–ç•¥ï¼Ÿ å¯¹åº”ã€proxy æœåŠ¡ä»£ç†å±‚ã€‘ã€‚ å¯èƒ½æœ‰èƒ–å‹å¯¹åŠ¨æ€ä»£ç†ä¸æ˜¯å¾ˆäº†è§£ã€‚å› ä¸ºï¼ŒConsumer ä»…ä»…å¼•ç”¨æœåŠ¡ ***-api.jar åŒ…ï¼Œé‚£ä¹ˆå¯ä»¥èŽ·å¾—åˆ°éœ€è¦æœåŠ¡çš„ XXXService æŽ¥å£ã€‚é‚£ä¹ˆï¼Œé€šè¿‡åŠ¨æ€åˆ›å»ºå¯¹åº”è°ƒç”¨ Dubbo æœåŠ¡çš„å®žçŽ°ç±»ã€‚ç®€åŒ–ä»£ç å¦‚ä¸‹ï¼š 123456789101112// ProxyFactory.java/** * create proxy. * * åˆ›å»º Proxy ï¼Œåœ¨å¼•ç”¨æœåŠ¡è°ƒç”¨ã€‚ * * @param invoker Invoker å¯¹è±¡ * @return proxy */@Adaptive(&#123;Constants.PROXY_KEY&#125;)&lt;T&gt; T getProxy(Invoker&lt;T&gt; invoker) throws RpcException; æ–¹æ³•å‚æ•° invoker ï¼Œå®žçŽ°äº†è°ƒç”¨ Dubbo æœåŠ¡çš„é€»è¾‘ã€‚ è¿”å›žçš„ &lt;T&gt; ç»“æžœï¼Œå°±æ˜¯ XXXService çš„å®žçŽ°ç±»ï¼Œè€Œè¿™ä¸ªå®žçŽ°ç±»ï¼Œå°±æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†çš„å·¥å…·ç±»è¿›è¡Œç”Ÿæˆã€‚ é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼ï¼Œå®žçŽ°äº†å¯¹äºŽæˆ‘ä»¬å¼€å‘ä½¿ç”¨ Dubbo æ—¶ï¼Œé€æ˜Žçš„æ•ˆæžœã€‚å½“ç„¶ï¼Œå› ä¸ºå®žé™…åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬æ˜¯ç»“åˆ Spring åœºæ™¯åœ¨ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸ä¼šç›´æŽ¥ä½¿ç”¨è¯¥ API ã€‚ ç›®å‰å®žçŽ°åŠ¨æ€ä»£ç†çš„å·¥å…·ç±»è¿˜æ˜¯è›®å¤šçš„ï¼Œå¦‚ä¸‹ï¼š Javassist JDK åŽŸç”Ÿè‡ªå¸¦ CGLIB ASM å…¶ä¸­ï¼ŒDubbo åŠ¨æ€ä»£ç†ä½¿ç”¨äº† Javassist å’Œ JDK ä¸¤ç§æ–¹å¼ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Javassist ã€‚ å¯é€šè¿‡ SPI æœºåˆ¶ï¼Œåˆ‡æ¢ä½¿ç”¨ JDK çš„æ–¹å¼ã€‚ ä¸ºä»€ä¹ˆé»˜è®¤ä½¿ç”¨ Javassistï¼Ÿ åœ¨ Dubbo å¼€å‘è€…ã€æ¢é£žã€‘çš„åšå®¢ ã€ŠåŠ¨æ€ä»£ç†æ–¹æ¡ˆæ€§èƒ½å¯¹æ¯”ã€‹ ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™å‡ ç§æ–¹å¼çš„æ€§èƒ½å·®å¼‚ï¼Œè€Œ Javassit æŽ’åœ¨ç¬¬ä¸€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå› ä¸ºæ€§èƒ½çš„åŽŸå› ã€‚ æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒJavassit æä¾›å­—èŠ‚ç  bytecode ç”Ÿæˆæ–¹å¼å’ŒåŠ¨æ€ä»£ç†æŽ¥å£ä¸¤ç§æ–¹å¼ã€‚åŽè€…çš„æ€§èƒ½æ¯” JDK è‡ªå¸¦çš„è¿˜æ…¢ï¼Œæ‰€ä»¥ Dubbo ä½¿ç”¨çš„æ˜¯å‰è€…å­—èŠ‚ç  bytecode ç”Ÿæˆæ–¹å¼ã€‚ é‚£ä¹ˆæ˜¯ä¸æ˜¯ JDK ä»£ç†å°±æ²¡æ„ä¹‰ï¼Ÿ å®žé™…ä¸Šï¼ŒJDK ä»£ç†åœ¨ JDK 1.8 ç‰ˆæœ¬ä¸‹ï¼Œæ€§èƒ½å·²ç»æœ‰å¾ˆå¤§çš„æå‡ï¼Œå¹¶ä¸”æ— éœ€å¼•å…¥ä¸‰æ–¹å·¥å…·çš„ä¾èµ–ï¼Œä¹Ÿæ˜¯éžå¸¸æ£’çš„é€‰æ‹©ã€‚æ‰€ä»¥ï¼ŒSpring å’Œ Motan åœ¨åŠ¨æ€ä»£ç†ç”Ÿæˆä¸Šï¼Œä¼˜å…ˆé€‰æ‹© JDK ä»£ç†ã€‚ æ³¨æ„ï¼ŒSpring åŒæ—¶ä¹Ÿé€‰æ‹©äº† CGLIB ä½œä¸ºç”ŸæˆåŠ¨æ€ä»£ç†çš„å·¥å…·ä¹‹ä¸€ã€‚ æ›´å¤šçš„å†…å®¹ï¼Œéžå¸¸æŽ¨èé˜…è¯»å¾å¦ˆçš„ ã€Šæ·±å…¥ç†è§£ RPC ä¹‹åŠ¨æ€ä»£ç†ç¯‡ã€‹ ã€‚å¾ˆæ£’ï¼ Dubbo SPI çš„è®¾è®¡æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿé¦–å…ˆçš„é¦–å…ˆï¼Œæˆ‘ä»¬å¾—æ¥ç†è§£ Java SPI æ˜¯ä»€ä¹ˆï¼Ÿå› ä¸ºå¾å¦ˆåœ¨è¿™å—å·²ç»å†™äº†éžå¸¸éžå¸¸éžå¸¸ä¸é”™çš„æ–‡ç« ï¼Œæˆ‘ä»¬ç›´æŽ¥è®¤çœŸï¼Œä¸€å®šè¦è®¤çœŸçœ‹ ã€ŠJAVA æ‹¾é— â€”â€” å…³äºŽ SPI æœºåˆ¶ã€‹ ã€‚ é‚£ä¹ˆæ—¢ç„¶ Java SPI æœºåˆ¶å·²ç»è¿™ä¹ˆç‰›é€¼ï¼Œä¸ºä»€ä¹ˆ Dubbo è¿˜è¦è‡ªå·±å®žçŽ° Dubbo SPI æœºåˆ¶å‘¢ï¼Ÿè‰¯å¿ƒçš„ Dubbo åœ¨ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ‰©å±•ç‚¹åŠ è½½ã€‹ ä¸­ï¼Œç»™å‡ºäº†ç­”æ¡ˆï¼š 1ã€JDK æ ‡å‡†çš„ SPI ä¼šä¸€æ¬¡æ€§å®žä¾‹åŒ–æ‰©å±•ç‚¹æ‰€æœ‰å®žçŽ°ï¼Œå¦‚æžœæœ‰æ‰©å±•å®žçŽ°åˆå§‹åŒ–å¾ˆè€—æ—¶ï¼Œä½†å¦‚æžœæ²¡ç”¨ä¸Šä¹ŸåŠ è½½ï¼Œä¼šå¾ˆæµªè´¹èµ„æºã€‚ 2ã€å¦‚æžœæ‰©å±•ç‚¹åŠ è½½å¤±è´¥ï¼Œè¿žæ‰©å±•ç‚¹çš„åç§°éƒ½æ‹¿ä¸åˆ°äº†ã€‚æ¯”å¦‚ï¼šJDK æ ‡å‡†çš„ ScriptEngineï¼Œé€šè¿‡ getName() èŽ·å–è„šæœ¬ç±»åž‹çš„åç§°ï¼Œä½†å¦‚æžœ RubyScriptEngine å› ä¸ºæ‰€ä¾èµ–çš„ jruby.jar ä¸å­˜åœ¨ï¼Œå¯¼è‡´ RubyScriptEngine ç±»åŠ è½½å¤±è´¥ï¼Œè¿™ä¸ªå¤±è´¥åŽŸå› è¢«åƒæŽ‰äº†ï¼Œå’Œ ruby å¯¹åº”ä¸èµ·æ¥ï¼Œå½“ç”¨æˆ·æ‰§è¡Œ ruby è„šæœ¬æ—¶ï¼Œä¼šæŠ¥ä¸æ”¯æŒ rubyï¼Œè€Œä¸æ˜¯çœŸæ­£å¤±è´¥çš„åŽŸå› ã€‚ 3ã€å¢žåŠ äº†å¯¹æ‰©å±•ç‚¹ IoC å’Œ AOP çš„æ”¯æŒï¼Œä¸€ä¸ªæ‰©å±•ç‚¹å¯ä»¥ç›´æŽ¥ setter æ³¨å…¥å…¶å®ƒæ‰©å±•ç‚¹ã€‚ ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ ç¬¬ä¸€ç‚¹é—®é¢˜ï¼ŒDubbo æœ‰å¾ˆå¤šçš„æ‹“å±•ç‚¹ï¼Œä¾‹å¦‚ Protocolã€Filter ç­‰ç­‰ã€‚å¹¶ä¸”æ¯ä¸ªæ‹“å±•ç‚¹æœ‰å¤šç§çš„å®žçŽ°ï¼Œä¾‹å¦‚ Protocol æœ‰ DubboProtocolã€InjvmProtocolã€RestProtocol ç­‰ç­‰ã€‚é‚£ä¹ˆä½¿ç”¨ JDK SPI æœºåˆ¶ï¼Œä¼šåˆå§‹åŒ–æ— ç”¨çš„æ‹“å±•ç‚¹åŠå…¶å®žçŽ°ï¼Œé€ æˆä¸å¿…è¦çš„è€—æ—¶ä¸Žèµ„æºæµªè´¹ã€‚ ç¬¬äºŒç‚¹é—®é¢˜ï¼Œå› ä¸ºæ²¡ç”¨è¿‡ ScriptEngine ï¼Œæ‰€ä»¥çœ‹ä¸æ‡‚ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚ ç¬¬ä¸‰ç‚¹é—®é¢˜ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸ç®—é—®é¢˜ï¼Œè€Œæ˜¯å¢žåŠ äº†åŠŸèƒ½ç‰¹æ€§ï¼Œæ›´å¤šçš„æçŽ°æ˜¯ï¼ŒDubbo SPI æä¾›ç±»ä¼¼ Spring IoC å’Œ AOP çš„åŠŸèƒ½ã€‚ å¦‚æžœå¦‚æžœå¦‚æžœæƒ³è¦æ·±å…¥ç†è§£ Dubbo SPI ä½“ç³»ï¼Œèƒ–å‹å¯ä»¥é˜…è¯» ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æ‹“å±•æœºåˆ¶ SPIã€‹ ã€‚è‰¿è¯è¯´çš„å¥½ï¼Œè¯»æ‡‚ Dubbo SPI çš„æºç ï¼Œä½ å°±è¯»æ‡‚äº†ä¸€åŠ Dubbo çš„æºç ã€‚ å¦‚æžœè¯´ï¼Œèƒ–å‹æƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ª Dubbo SPI æŸä¸ªæ‹“å±•ç‚¹çš„å®žçŽ°ï¼Œå¯ä»¥é˜…è¯» ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ‰©å±•ç‚¹åŠ è½½ã€‹ ã€‚å½“ç„¶ï¼Œå¦‚æžœä½ æ˜¯é¦–æ¬¡å†™ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸¢ä¸¢å¤æ‚ã€‚å®žé™…åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å†™çš„æœ€å¤šçš„æ˜¯ Filter è°ƒç”¨æ‹¦æˆªæ‰©å±• ã€‚æ‰€ä»¥ï¼Œæ’¸èµ·è¢–å­ï¼Œæ¥ä¸€å‘ï¼ å½“ç„¶ï¼Œè™½ç„¶ Dubbo å®žçŽ°äº† Dubbo SPI ï¼Œè¿™å¹¶æ„å‘³ç€ Java SPI ä¸å¥½ç”¨ã€‚å®žé™…ä¸Šï¼ŒJava SPI è¢«å¤§é‡ä¸­é—´ä»¶æ‰€é‡‡ç”¨ï¼Œä¾‹å¦‚ Tomcatã€SkyWalkingã€JDBC ç­‰ç­‰ã€‚ å†å¼•ç”³ä¸‹ï¼Œæœ‰äº›åˆé’»çš„é¢è¯•å®˜ï¼Œå¯èƒ½ä¼šè®©ä½ å…ˆè®²è®² Spring IoC æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼ŒDubbo SPI æ˜¯æ€Žä¹ˆæä¾› IoC åŠŸèƒ½çš„ï¼Œé‚£ä¹ˆä½ å¯ä»¥çœ‹çœ‹å¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« æ¥å‡†å¤‡ï¼š Spring IoC ï¼Œã€Šé¢è¯•é—®çƒ‚çš„ Spring IoC è¿‡ç¨‹ã€‹ ã€‚ Dubbo SPI IoC ï¼Œã€ŠDubbo SPI æœºåˆ¶å’Œ IoCã€‹ çš„ ã€ŒIOC æ³¨å…¥ã€ã€‚ å†å†å¼•ç”³ä¸‹ï¼Œæœ‰äº›åˆé’»çš„é¢è¯•å®˜ï¼Œå¯èƒ½ä¼šè®©ä½ å…ˆè®²è®² Spring AOP æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼ŒDubbo SPI æ˜¯æ€Žä¹ˆæä¾› AOP åŠŸèƒ½çš„ï¼Œé‚£ä¹ˆä½ å¯ä»¥çœ‹çœ‹å¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« æ¥å‡†å¤‡ï¼š Spring AOP ï¼Œã€Šé¢è¯•é—®çƒ‚çš„ Spring AOP åŽŸç†ã€‹ ã€‚ Dubbo SPI AOP ï¼Œè¯¦ç»†è§ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æ‹“å±•æœºåˆ¶ SPIã€‹ æ–‡ç« ã€‚æ ¸å¿ƒæºç æ˜¯ï¼š 123456789101112131415161718192021222324252627282930313233private static final ConcurrentMap&lt;Class&lt;?&gt;, Object&gt; EXTENSION_INSTANCES = new ConcurrentHashMap&lt;Class&lt;?&gt;, Object&gt;(); 1: 7: @SuppressWarnings("unchecked") 8: private T createExtension(String name) &#123; 9: // èŽ·å¾—æ‹“å±•åå¯¹åº”çš„æ‹“å±•å®žçŽ°ç±» 10: Class&lt;?&gt; clazz = getExtensionClasses().get(name); 11: if (clazz == null) &#123; 12: throw findException(name); // æŠ›å‡ºå¼‚å¸¸ 13: &#125; 14: try &#123; 15: // ä»Žç¼“å­˜ä¸­ï¼ŒèŽ·å¾—æ‹“å±•å¯¹è±¡ã€‚ 16: T instance = (T) EXTENSION_INSTANCES.get(clazz); 17: if (instance == null) &#123; 18: // å½“ç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºæ‹“å±•å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚ 19: EXTENSION_INSTANCES.putIfAbsent(clazz, clazz.newInstance()); 20: instance = (T) EXTENSION_INSTANCES.get(clazz); 21: &#125; 22: // æ³¨å…¥ä¾èµ–çš„å±žæ€§ 23: injectExtension(instance); 24: // åˆ›å»º Wrapper æ‹“å±•å¯¹è±¡ 25: Set&lt;Class&lt;?&gt;&gt; wrapperClasses = cachedWrapperClasses; 26: if (wrapperClasses != null &amp;&amp; !wrapperClasses.isEmpty()) &#123; 27: for (Class&lt;?&gt; wrapperClass : wrapperClasses) &#123; 28: instance = injectExtension((T) wrapperClass.getConstructor(type).newInstance(instance)); 29: &#125; 30: &#125; 31: return instance; 32: &#125; catch (Throwable t) &#123; 33: throw new IllegalStateException("Extension instance(name: " + name + ", class: " + 34: type + ") could not be instantiated: " + t.getMessage(), t); 35: &#125; 36: &#125; ç¬¬ 24 è‡³ 30 è¡Œï¼šåˆ›å»º Wrapper æ‹“å±•å¯¹è±¡ï¼Œå°† instance åŒ…è£…åœ¨å…¶ä¸­ã€‚åœ¨ ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ‰©å±•ç‚¹åŠ è½½ã€‹ æ–‡ç« ä¸­ï¼Œå¦‚æ­¤ä»‹ç» Wrapper ç±»ï¼š Wrapper ç±»åŒæ ·å®žçŽ°äº†æ‰©å±•ç‚¹æŽ¥å£ï¼Œä½†æ˜¯ Wrapper ä¸æ˜¯æ‰©å±•ç‚¹çš„çœŸæ­£å®žçŽ°ã€‚å®ƒçš„ç”¨é€”ä¸»è¦æ˜¯ç”¨äºŽä»Ž ExtensionLoader è¿”å›žæ‰©å±•ç‚¹æ—¶ï¼ŒåŒ…è£…åœ¨çœŸæ­£çš„æ‰©å±•ç‚¹å®žçŽ°å¤–ã€‚å³ä»Ž ExtensionLoader ä¸­è¿”å›žçš„å®žé™…ä¸Šæ˜¯ Wrapper ç±»çš„å®žä¾‹ï¼ŒWrapper æŒæœ‰äº†å®žé™…çš„æ‰©å±•ç‚¹å®žçŽ°ç±»ã€‚ æ‰©å±•ç‚¹çš„ Wrapper ç±»å¯ä»¥æœ‰å¤šä¸ªï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦æ–°å¢žã€‚ é€šè¿‡ Wrapper ç±»å¯ä»¥æŠŠæ‰€æœ‰æ‰©å±•ç‚¹å…¬å…±é€»è¾‘ç§»è‡³ Wrapper ä¸­ã€‚æ–°åŠ çš„ Wrapper åœ¨æ‰€æœ‰çš„æ‰©å±•ç‚¹ä¸Šæ·»åŠ äº†é€»è¾‘ï¼Œæœ‰äº›ç±»ä¼¼ AOPï¼Œå³ Wrapper ä»£ç†äº†æ‰©å±•ç‚¹ã€‚ ä¾‹å¦‚ï¼šListenerExporterWrapperã€ProtocolFilterWrapper ã€‚ Dubbo æœåŠ¡å¦‚ä½•ç›‘æŽ§å’Œç®¡ç†ï¼Ÿä¸€æ—¦ä½¿ç”¨ Dubbo åšäº†æœåŠ¡åŒ–åŽï¼Œå¿…é¡»å¿…é¡»å¿…é¡»è¦åšçš„æœåŠ¡æ²»ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦åšæœåŠ¡çš„ç®¡ç†ä¸Žç›‘æŽ§ã€‚å½“ç„¶ï¼Œè¿˜æœ‰æœåŠ¡çš„é™çº§å’Œé™æµã€‚è¿™å—ï¼Œæ”¾åœ¨ä¸‹é¢çš„é¢è¯•é¢˜ï¼Œåœ¨è¯¦ç»†è§£æžã€‚ Dubbo ç®¡ç†å¹³å° + ç›‘æŽ§å¹³å° dubbo-monitor ç›‘æŽ§å¹³å°ï¼ŒåŸºäºŽ Dubbo çš„ã€monitor ç›‘æŽ§å±‚ã€‘ï¼Œå®žçŽ°ç›¸åº”çš„ç›‘æŽ§æ•°æ®çš„æ”¶é›†åˆ°ç›‘æŽ§å¹³å°ã€‚ dubbo-admin ç®¡ç†å¹³å°ï¼ŒåŸºäºŽæ³¨å†Œä¸­å¿ƒï¼Œå¯ä»¥èŽ·å–åˆ°æœåŠ¡ç›¸å…³çš„ä¿¡æ¯ã€‚ å…³äºŽè¿™å—çš„é€‰æ‹©ï¼Œèƒ–å‹ç›´æŽ¥çœ‹çœ‹ ã€ŠDubboç›‘æŽ§å’Œç®¡ç†ï¼ˆdubbokeeperï¼‰ã€‹ ã€‚ å¦å¤–ï¼Œç›®å‰ Dubbo æ­£åœ¨é‡åš dubbo-admin ç®¡ç†å¹³å°ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥è·Ÿè¿› https://github.com/apache/incubator-dubbo-ops ã€‚ é“¾è·¯è¿½è¸ª å…³é“¾è·¯è¿½è¸ªçš„æ¦‚å¿µï¼Œå°±ä¸é‡å¤ä»‹ç»äº†ï¼ŒðŸ˜ˆ å¦‚æžœä¸æ‡‚ï¼Œè¯·è‡ªè¡Œ Google ä¸‹ã€‚ ç›®å‰èƒ½å¤Ÿå®žçŽ°é“¾è·¯è¿½è¸ªçš„ç»„ä»¶è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå¦‚ä¸‹ï¼š Apache SkyWalking ã€æŽ¨èã€‘ Zipkin Cat PinPoint å…·ä½“é›†æˆçš„æ–¹å¼ï¼ŒDubbo å®˜æ–¹æŽ¨èäº†ä¸¤ç¯‡åšæ–‡ï¼š ã€Šä½¿ç”¨ Apache SkyWalking (Incubator) åšåˆ†å¸ƒå¼è·Ÿè¸ªã€‹ ã€Šåœ¨ Dubbo ä¸­ä½¿ç”¨ Zipkinã€‹ Dubbo æœåŠ¡å¦‚ä½•åšé™çº§ï¼Ÿæ¯”å¦‚è¯´æœåŠ¡ A è°ƒç”¨æœåŠ¡ Bï¼Œç»“æžœæœåŠ¡ B æŒ‚æŽ‰äº†ã€‚æœåŠ¡ A å†é‡è¯•å‡ æ¬¡è°ƒç”¨æœåŠ¡ Bï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œé‚£ä¹ˆç›´æŽ¥é™çº§ï¼Œèµ°ä¸€ä¸ªå¤‡ç”¨çš„é€»è¾‘ï¼Œç»™ç”¨æˆ·è¿”å›žå“åº”ã€‚ åœ¨ Dubbo ä¸­ï¼Œå®žçŽ°æœåŠ¡é™çº§çš„åŠŸèƒ½ï¼Œä¸€å…±æœ‰ä¸¤å¤§ç§æ–¹å¼ã€‚ â‘  Dubbo åŽŸç”Ÿè‡ªå¸¦çš„æœåŠ¡é™çº§åŠŸèƒ½ å…·ä½“å¯ä»¥çœ‹çœ‹ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æœåŠ¡é™çº§ã€‹ ã€‚ å½“ç„¶ï¼Œè¿™ä¸ªåŠŸèƒ½ï¼Œå¹¶ä¸èƒ½å®žçŽ°çŽ°ä»£å¾®æœåŠ¡çš„ç†”æ–­å™¨çš„åŠŸèƒ½ã€‚æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å¤ªæŽ¨èè¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚ â‘¡ å¼•å…¥æ”¯æŒæœåŠ¡é™çº§çš„ç»„ä»¶ ç›®å‰å¼€æºç¤¾åŒºå¸¸ç”¨çš„æœ‰ä¸¤ç§ç»„ä»¶æ”¯æŒæœåŠ¡é™çº§çš„åŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯ï¼š Alibaba Sentinel Netflix Hystrix å› ä¸ºç›®å‰ Hystrix å·²ç»åœæ­¢ç»´æŠ¤ï¼Œå¹¶ä¸”å’Œ Dubbo çš„é›†æˆåº¦ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œéœ€è¦åšäºŒæ¬¡å¼€å‘ï¼Œæ‰€ä»¥æŽ¨èä½¿ç”¨ Sentinel ã€‚å…·ä½“çš„ä»‹ç»ï¼Œèƒ–å‹å¯ä»¥çœ‹çœ‹ ã€ŠSentinel ä»‹ç»ã€‹ ã€‚ å…³äºŽ Dubbo å¦‚ä½•é›†æˆ Sentinel ï¼Œèƒ–å‹å¯ä»¥é˜…è¯» ã€ŠSentinel ä¸º Dubbo æœåŠ¡ä¿é©¾æŠ¤èˆªã€‹ ä¸€æ–‡ã€‚ å…³äºŽ Sentinel å’Œ Hystrix å¯¹æ¯”ï¼Œèƒ–å‹å¯ä»¥é˜…è¯» ã€ŠSentinel ä¸Ž Hystrix çš„å¯¹æ¯”ã€‹ ä¸€æ–‡ã€‚ Dubbo å¦‚ä½•åšé™æµï¼Ÿåœ¨åšæœåŠ¡ç¨³å®šæ€§æ—¶ï¼Œæœ‰ä¸€å¥éžå¸¸ç»å…¸çš„è¯ï¼š æ€€ç–‘ç¬¬ä¸‰æ–¹ é˜²å¤‡ä½¿ç”¨æ–¹ åšå¥½è‡ªå·± é‚£ä¹ˆï¼Œä¸Šé¢çœ‹åˆ°çš„æœåŠ¡é™çº§ï¼Œå°±å±žäºŽæ€€ç–‘ç¬¬ä¸‰æ–¹ã€‚è€Œæœ¬å°èŠ‚çš„é™æµç›®çš„ï¼Œå°±æ˜¯é˜²å¤‡ä½¿ç”¨æ–¹ã€‚ æ­¤å¤„ï¼Œè‰¿è‰¿è¦å†æŽ¨èä¸€ç¯‡æ–‡ç« ï¼šã€Šä½ åº”è¯¥å¦‚ä½•æ­£ç¡®å¥å£®åŽç«¯æœåŠ¡ï¼Ÿã€‹ ã€‚ ç›®å‰ï¼Œåœ¨ Dubbo ä¸­ï¼Œå®žçŽ°æœåŠ¡é™çº§çš„åŠŸèƒ½ï¼Œä¸€å…±æœ‰ä¸¤å¤§ç§æ–¹å¼ã€‚ â‘  Dubbo åŽŸç”Ÿè‡ªå¸¦çš„é™æµåŠŸèƒ½ é€šè¿‡ TpsLimitFilter å®žçŽ°ï¼Œä»…é€‚ç”¨äºŽæœåŠ¡æä¾›è€…ã€‚å…·ä½“çš„ä½¿ç”¨æ–¹å¼ï¼Œæºç å®žçŽ°ï¼Œçœ‹çœ‹ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” è¿‡æ»¤å™¨ï¼ˆä¹ï¼‰ä¹‹ TpsLimitFilterã€‹ ã€‚ ðŸ˜ˆ å‚ç…§ TpsLimitFilter çš„æ€è·¯ï¼Œå¯ä»¥å®žçŽ°è‡ªå®šä¹‰é™æµçš„ Filter ï¼Œå¹¶ä¸”ä½¿ç”¨ Guava RateLimiter å·¥å…·ç±»ï¼Œè¾¾åˆ° ä»¤ç‰Œæ¡¶ç®—æ³•é™æµçš„åŠŸèƒ½ã€‚ â‘¡ å¼•å…¥æ”¯æŒé™æµçš„ç»„ä»¶ å…³äºŽè¿™ä¸ªåŠŸèƒ½ï¼Œè¿˜æ˜¯æŽ¨èé›†æˆ Sentinel ç»„ä»¶ã€‚ Dubbo çš„å¤±è´¥é‡è¯•æ˜¯ä»€ä¹ˆï¼Ÿæ‰€è°“å¤±è´¥é‡è¯•ï¼Œå°±æ˜¯ consumer è°ƒç”¨ provider è¦æ˜¯å¤±è´¥äº†ï¼Œæ¯”å¦‚æŠ›å¼‚å¸¸äº†ï¼Œæ­¤æ—¶åº”è¯¥æ˜¯å¯ä»¥é‡è¯•çš„ï¼Œæˆ–è€…è°ƒç”¨è¶…æ—¶äº†ä¹Ÿå¯ä»¥é‡è¯•ã€‚ å®žé™…åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç¦ç”¨æŽ‰é‡è¯•ã€‚å› ä¸ºï¼Œå› ä¸ºè¶…æ—¶åŽé‡è¯•ä¼šæœ‰é—®é¢˜ï¼Œè¶…æ—¶ä½ ä¸çŸ¥é“æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¤æ¬¡æ‰£æ¬¾çš„é—®é¢˜ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ failfast é›†ç¾¤å®¹é”™ç­–ç•¥ï¼Œè€Œä¸æ˜¯ failover ç­–ç•¥ã€‚é…ç½®å¦‚ä¸‹ï¼š 1&lt;dubbo:service cluster="failfast" timeout="2000" /&gt; å¦å¤–ï¼Œä¸€å®šä¸€å®šä¸€å®šè¦é…ç½®é€‚åˆè‡ªå·±ä¸šåŠ¡çš„è¶…æ—¶æ—¶é—´ã€‚ å½“ç„¶ï¼Œå¯ä»¥å°†æ“ä½œåˆ†æˆè¯»å’Œå†™ä¸¤ç§ï¼Œå‰è€…æ”¯æŒé‡è¯•ï¼ŒåŽè€…ä¸æ”¯æŒé‡è¯•ã€‚å› ä¸ºï¼Œè¯»æ“ä½œå¤©ç„¶å…·æœ‰å¹‚ç­‰æ€§ã€‚ Dubbo æ”¯æŒå“ªäº›æ³¨å†Œä¸­å¿ƒï¼ŸDubbo æ”¯æŒå¤šç§ä¸»æµæ³¨å†Œä¸­å¿ƒï¼Œå¦‚ä¸‹ï¼š ã€é»˜è®¤ã€‘Zookeeper ï¼Œå‚è§ ã€Šç”¨æˆ·æŒ‡å— â€”â€” Zookeeper æ³¨å†Œä¸­å¿ƒã€‹ ã€‚ Redis ï¼Œå‚è§ ã€Šç”¨æˆ·æŒ‡å— â€”â€” Redis æ³¨å†Œä¸­å¿ƒã€‹ ã€‚ Multicast æ³¨å†Œä¸­å¿ƒï¼Œå‚è§ ã€Šç”¨æˆ·æŒ‡å— â€”â€” Multicast æ³¨å†Œä¸­å¿ƒã€‹ ã€‚ Simple æ³¨å†Œä¸­å¿ƒï¼Œå‚è§ ã€Šç”¨æˆ·æŒ‡å— â€”â€” Simple æ³¨å†Œä¸­å¿ƒã€‹ ã€‚ ç›®å‰ Alibaba æ­£åœ¨å¼€æºæ–°çš„æ³¨å†Œä¸­å¿ƒ Nacos ï¼Œä¹Ÿæ˜¯æœªæ¥çš„é€‰æ‹©ä¹‹ä¸€ã€‚ å½“ç„¶ï¼ŒNetflix Eureka ä¹Ÿæ˜¯æ³¨å†Œä¸­å¿ƒçš„ä¸€ä¸ªé€‰æ‹©ï¼Œä¸è¿‡ Dubbo æš‚æœªé›†æˆå®žçŽ°ã€‚ å¦å¤–ï¼Œæ­¤å¤„ä¼šå¼•ç”³ä¸€ä¸ªç»å…¸çš„é—®é¢˜ï¼Œè§ ã€Šä¸ºä»€ä¹ˆä¸åº”è¯¥ä½¿ç”¨ ZooKeeper åšæœåŠ¡å‘çŽ°ã€‹ æ–‡ç« ã€‚ ## Dubbo æŽ¥å£å¦‚ä½•å®žçŽ°å¹‚ç­‰æ€§ï¼Ÿ æ‰€è°“å¹‚ç­‰ï¼Œç®€å•åœ°è¯´ï¼Œå°±æ˜¯å¯¹æŽ¥å£çš„å¤šæ¬¡è°ƒç”¨æ‰€äº§ç”Ÿçš„ç»“æžœå’Œè°ƒç”¨ä¸€æ¬¡æ˜¯ä¸€è‡´çš„ã€‚æ‰©å±•ä¸€ä¸‹ï¼Œè¿™é‡Œçš„æŽ¥å£ï¼Œå¯ä»¥ç†è§£ä¸ºå¯¹å¤–å‘å¸ƒçš„ HTTP æŽ¥å£æˆ–è€… Thrift æŽ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŽ¥æ”¶æ¶ˆæ¯çš„å†…éƒ¨æŽ¥å£ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªå†…éƒ¨æ–¹æ³•æˆ–æ“ä½œã€‚ é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦æŽ¥å£å…·æœ‰å¹‚ç­‰æ€§å‘¢ï¼Ÿè®¾æƒ³ä¸€ä¸‹ä»¥ä¸‹æƒ…å½¢ï¼š åœ¨ App ä¸­ä¸‹è®¢å•çš„æ—¶å€™ï¼Œç‚¹å‡»ç¡®è®¤ä¹‹åŽï¼Œæ²¡ååº”ï¼Œå°±åˆç‚¹å‡»äº†å‡ æ¬¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æžœæ— æ³•ä¿è¯è¯¥æŽ¥å£çš„å¹‚ç­‰æ€§ï¼Œé‚£ä¹ˆå°†ä¼šå‡ºçŽ°é‡å¤ä¸‹å•é—®é¢˜ã€‚ åœ¨æŽ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ¶ˆæ¯æŽ¨é€é‡å¤ã€‚å¦‚æžœå¤„ç†æ¶ˆæ¯çš„æŽ¥å£æ— æ³•ä¿è¯å¹‚ç­‰ï¼Œé‚£ä¹ˆé‡å¤æ¶ˆè´¹æ¶ˆæ¯äº§ç”Ÿçš„å½±å“å¯èƒ½ä¼šéžå¸¸å¤§ã€‚ æ‰€ä»¥ï¼Œä»Žè¿™æ®µæè¿°ä¸­ï¼Œå¹‚ç­‰æ€§ä¸ä»…ä»…æ˜¯ Dubbo æŽ¥å£çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ HTTP æŽ¥å£ã€Thrift æŽ¥å£éƒ½å­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œç”šè‡³è¯´ MQ æ¶ˆæ¯ã€å®šæ—¶ä»»åŠ¡ï¼Œéƒ½ä¼šç¢°åˆ°è¿™æ ·çš„åœºæ™¯ã€‚é‚£ä¹ˆåº”è¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿ è¿™ä¸ªä¸æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œè¿™ä¸ªæ²¡æœ‰é€šç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªåº”è¯¥ç»“åˆä¸šåŠ¡æ¥ä¿è¯å¹‚ç­‰æ€§ã€‚ æ‰€è°“å¹‚ç­‰æ€§ï¼Œå°±æ˜¯è¯´ä¸€ä¸ªæŽ¥å£ï¼Œå¤šæ¬¡å‘èµ·åŒä¸€ä¸ªè¯·æ±‚ï¼Œä½ è¿™ä¸ªæŽ¥å£å¾—ä¿è¯ç»“æžœæ˜¯å‡†ç¡®çš„ï¼Œæ¯”å¦‚ä¸èƒ½å¤šæ‰£æ¬¾ã€ä¸èƒ½å¤šæ’å…¥ä¸€æ¡æ•°æ®ã€ä¸èƒ½å°†ç»Ÿè®¡å€¼å¤šåŠ äº† 1ã€‚è¿™å°±æ˜¯å¹‚ç­‰æ€§ã€‚ å…¶å®žä¿è¯å¹‚ç­‰æ€§ä¸»è¦æ˜¯ä¸‰ç‚¹ï¼š å¯¹äºŽæ¯ä¸ªè¯·æ±‚å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ï¼Œä¸¾ä¸ªæ —å­ï¼šè®¢å•æ”¯ä»˜è¯·æ±‚ï¼Œè‚¯å®šå¾—åŒ…å«è®¢å• idï¼Œä¸€ä¸ªè®¢å• id æœ€å¤šæ”¯ä»˜ä¸€æ¬¡ï¼Œå¯¹å§ã€‚ æ¯æ¬¡å¤„ç†å®Œè¯·æ±‚ä¹‹åŽï¼Œå¿…é¡»æœ‰ä¸€ä¸ªè®°å½•æ ‡è¯†è¿™ä¸ªè¯·æ±‚å¤„ç†è¿‡äº†ã€‚å¸¸è§çš„æ–¹æ¡ˆæ˜¯åœ¨ mysql ä¸­è®°å½•ä¸ªçŠ¶æ€å•¥çš„ï¼Œæ¯”å¦‚æ”¯ä»˜ä¹‹å‰è®°å½•ä¸€æ¡è¿™ä¸ªè®¢å•çš„æ”¯ä»˜æµæ°´ã€‚ æ¯æ¬¡æŽ¥æ”¶è¯·æ±‚éœ€è¦è¿›è¡Œåˆ¤æ–­ï¼Œåˆ¤æ–­ä¹‹å‰æ˜¯å¦å¤„ç†è¿‡ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æžœæœ‰ä¸€ä¸ªè®¢å•å·²ç»æ”¯ä»˜äº†ï¼Œå°±å·²ç»æœ‰äº†ä¸€æ¡æ”¯ä»˜æµæ°´ï¼Œé‚£ä¹ˆå¦‚æžœé‡å¤å‘é€è¿™ä¸ªè¯·æ±‚ï¼Œåˆ™æ­¤æ—¶å…ˆæ’å…¥æ”¯ä»˜æµæ°´ï¼ŒorderId å·²ç»å­˜åœ¨äº†ï¼Œå”¯ä¸€é”®çº¦æŸç”Ÿæ•ˆï¼ŒæŠ¥é”™æ’å…¥ä¸è¿›åŽ»çš„ã€‚ç„¶åŽä½ å°±ä¸ç”¨å†æ‰£æ¬¾äº†ã€‚ å®žé™…è¿ä½œè¿‡ç¨‹ä¸­ï¼Œä½ è¦ç»“åˆè‡ªå·±çš„ä¸šåŠ¡æ¥ï¼Œæ¯”å¦‚è¯´åˆ©ç”¨ redisï¼Œç”¨ orderId ä½œä¸ºå”¯ä¸€é”®ã€‚åªæœ‰æˆåŠŸæ’å…¥è¿™ä¸ªæ”¯ä»˜æµæ°´ï¼Œæ‰å¯ä»¥æ‰§è¡Œå®žé™…çš„æ”¯ä»˜æ‰£æ¬¾ã€‚ è¦æ±‚æ˜¯æ”¯ä»˜ä¸€ä¸ªè®¢å•ï¼Œå¿…é¡»æ’å…¥ä¸€æ¡æ”¯ä»˜æµæ°´ï¼Œorder_id å»ºä¸€ä¸ªå”¯ä¸€é”® unique keyã€‚ä½ åœ¨æ”¯ä»˜ä¸€ä¸ªè®¢å•ä¹‹å‰ï¼Œå…ˆæ’å…¥ä¸€æ¡æ”¯ä»˜æµæ°´ï¼Œorder_id å°±å·²ç»è¿›åŽ»äº†ã€‚ä½ å°±å¯ä»¥å†™ä¸€ä¸ªæ ‡è¯†åˆ° redis é‡Œé¢åŽ»ï¼Œset order_id payedï¼Œä¸‹ä¸€æ¬¡é‡å¤è¯·æ±‚è¿‡æ¥äº†ï¼Œå…ˆæŸ¥ redis çš„ order_id å¯¹åº”çš„ valueï¼Œå¦‚æžœæ˜¯ payed å°±è¯´æ˜Žå·²ç»æ”¯ä»˜è¿‡äº†ï¼Œä½ å°±åˆ«é‡å¤æ”¯ä»˜äº†ã€‚ Dubbo å¦‚ä½•å‡çº§æŽ¥å£ï¼Ÿå‚è€ƒ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” å¤šç‰ˆæœ¬ã€‹ ã€‚ å½“ä¸€ä¸ªæŽ¥å£å®žçŽ°ï¼Œå‡ºçŽ°ä¸å…¼å®¹å‡çº§æ—¶ï¼Œå¯ä»¥ç”¨ç‰ˆæœ¬å·è¿‡æ¸¡ï¼Œç‰ˆæœ¬å·ä¸åŒçš„æœåŠ¡ç›¸äº’é—´ä¸å¼•ç”¨ã€‚ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹çš„æ­¥éª¤è¿›è¡Œç‰ˆæœ¬è¿ç§»ï¼š åœ¨ä½ŽåŽ‹åŠ›æ—¶é—´æ®µï¼Œå…ˆå‡çº§ä¸€åŠæä¾›è€…ä¸ºæ–°ç‰ˆæœ¬ã€‚ å†å°†æ‰€æœ‰æ¶ˆè´¹è€…å‡çº§ä¸ºæ–°ç‰ˆæœ¬ã€‚ ç„¶åŽå°†å‰©ä¸‹çš„ä¸€åŠæä¾›è€…å‡çº§ä¸ºæ–°ç‰ˆæœ¬ã€‚ åˆ©ç”¨å¤šç‰ˆæœ¬çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å®žçŽ°ç°åº¦çš„åŠŸèƒ½ã€‚å¯¹äºŽç¬¬ 2 æ­¥ï¼Œä¸è¦å‡çº§æ‰€æœ‰æ¶ˆè´¹è€…ä¸ºæ–°ç‰ˆæœ¬ï¼Œè€Œæ˜¯ä¸€åŠã€‚ Dubbo åœ¨å®‰å…¨æœºåˆ¶æ–¹é¢æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿé€šè¿‡ä»¤ç‰ŒéªŒè¯åœ¨æ³¨å†Œä¸­å¿ƒæŽ§åˆ¶æƒé™ï¼Œä»¥å†³å®šè¦ä¸è¦ä¸‹å‘ä»¤ç‰Œç»™æ¶ˆè´¹è€…ï¼Œå¯ä»¥é˜²æ­¢æ¶ˆè´¹è€…ç»•è¿‡æ³¨å†Œä¸­å¿ƒè®¿é—®æä¾›è€…ã€‚ å¦å¤–é€šè¿‡æ³¨å†Œä¸­å¿ƒå¯çµæ´»æ”¹å˜æŽˆæƒæ–¹å¼ï¼Œè€Œä¸éœ€ä¿®æ”¹æˆ–å‡çº§æä¾›è€…ã€‚ ç›¸å…³æ–‡æ¡£ï¼Œå¯ä»¥å‚è§ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” ä»¤ç‰ŒéªŒè¯ã€‹ ã€‚ æºç è§£æžï¼Œå¯ä»¥å‚è§ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” è¿‡æ»¤å™¨ï¼ˆå…«ï¼‰ä¹‹ TokenFilterã€‹ ã€‚ Dubbo éœ€è¦ Web å®¹å™¨å—ï¼Ÿè¿™ä¸ªé—®é¢˜ï¼Œä»”ç»†å›žç­”ï¼Œéœ€è¦æ€è€ƒ Web å®¹å™¨çš„å®šä¹‰ã€‚ç„¶è€Œå®žé™…ä¸Šï¼ŒçœŸæ­£æƒ³é—®çš„æ˜¯ï¼ŒDubbo æœåŠ¡å¯åŠ¨æ˜¯å¦éœ€è¦å¯åŠ¨ç±»ä¼¼ Tomcatã€Jetty ç­‰æœåŠ¡å™¨ã€‚ è¿™ä¸ªç­”æ¡ˆå¯ä»¥æ˜¯ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸æ˜¯ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ ¹æ®åè®®çš„ä¸åŒï¼ŒProvider ä¼šå¯åŠ¨ä¸åŒçš„æœåŠ¡å™¨ã€‚ åœ¨ä½¿ç”¨ dubbo:// åè®®æ—¶ï¼Œç­”æ¡ˆæ˜¯å¦ï¼Œå› ä¸º Provider å¯åŠ¨ Nettyã€Mina ç­‰ NIO Server ã€‚ åœ¨ä½¿ç”¨ rest:// åè®®æ—¶ï¼Œç­”æ¡ˆæ˜¯æ˜¯ï¼ŒProvider å¯åŠ¨ Tomcatã€Jetty ç­‰ HTTP æœåŠ¡å™¨ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ Netty å°è£…çš„ HTTP æœåŠ¡å™¨ã€‚ åœ¨ä½¿ç”¨ hessian:// åè®®æ—¶ï¼Œç­”æ¡ˆæ˜¯æ˜¯ï¼ŒProvider å¯åŠ¨ Jettyã€Tomcat ç­‰ HTTP æœåŠ¡å™¨ã€‚ ä¸ºä»€ä¹ˆè¦å°†ç³»ç»Ÿè¿›è¡Œæ‹†åˆ†ï¼Ÿè¿™ä¸ªé—®é¢˜ï¼Œä¸æ˜¯ä»…ä»…é€‚ç”¨äºŽ Dubbo çš„åœºæ™¯ï¼Œè€Œæ˜¯ SOAã€å¾®æœåŠ¡ã€‚ ç½‘ä¸ŠæŸ¥æŸ¥ï¼Œç­”æ¡ˆæžåº¦é›¶æ•£å’Œå¤æ‚ï¼Œå¾ˆçç¢Žï¼ŒåŽŸå› ä¸€å¤§å¨ã€‚ä½†æ˜¯æˆ‘è¿™é‡Œç»™å¤§å®¶ç›´è§‚çš„æ„Ÿå—ï¼š è¦æ˜¯ä¸æ‹†åˆ†ï¼Œä¸€ä¸ªå¤§ç³»ç»Ÿå‡ åä¸‡è¡Œä»£ç ï¼Œ20 ä¸ªäººç»´æŠ¤ä¸€ä»½ä»£ç ï¼Œç®€ç›´æ˜¯æ‚²å‰§å•Šã€‚ä»£ç ç»å¸¸æ”¹ç€æ”¹ç€å°±å†²çªäº†ï¼Œå„ç§ä»£ç å†²çªå’Œåˆå¹¶è¦å¤„ç†ï¼Œéžå¸¸è€—è´¹æ—¶é—´ï¼›ç»å¸¸æˆ‘æ”¹åŠ¨äº†æˆ‘çš„ä»£ç ï¼Œä½ è°ƒç”¨äº†æˆ‘çš„ï¼Œå¯¼è‡´ä½ çš„ä»£ç ä¹Ÿå¾—é‡æ–°æµ‹è¯•ï¼Œéº»çƒ¦çš„è¦æ­»ï¼›ç„¶åŽæ¯æ¬¡å‘å¸ƒéƒ½æ˜¯å‡ åä¸‡è¡Œä»£ç çš„ç³»ç»Ÿä¸€èµ·å‘å¸ƒï¼Œå¤§å®¶å¾—ä¸€èµ·æå¿ƒåŠèƒ†å‡†å¤‡ä¸Šçº¿ï¼Œå‡ åä¸‡è¡Œä»£ç çš„ä¸Šçº¿ï¼Œå¯èƒ½æ¯æ¬¡ä¸Šçº¿éƒ½è¦åšå¾ˆå¤šçš„æ£€æŸ¥ï¼Œå¾ˆå¤šå¼‚å¸¸é—®é¢˜çš„å¤„ç†ï¼Œç®€ç›´æ˜¯åˆéº»çƒ¦åˆç—›è‹¦ï¼›è€Œä¸”å¦‚æžœæˆ‘çŽ°åœ¨æ‰“ç®—æŠŠæŠ€æœ¯å‡çº§åˆ°æœ€æ–°çš„ spring ç‰ˆæœ¬ï¼Œè¿˜ä¸è¡Œï¼Œå› ä¸ºè¿™å¯èƒ½å¯¼è‡´ä½ çš„ä»£ç æŠ¥é”™ï¼Œæˆ‘ä¸æ•¢éšæ„ä¹±æ”¹æŠ€æœ¯ã€‚ å‡è®¾ä¸€ä¸ªç³»ç»Ÿæ˜¯ 20 ä¸‡è¡Œä»£ç ï¼Œå…¶ä¸­ å°A åœ¨é‡Œé¢æ”¹äº† 1000 è¡Œä»£ç ï¼Œä½†æ˜¯æ­¤æ—¶å‘å¸ƒçš„æ—¶å€™æ˜¯è¿™ä¸ª 20 ä¸‡è¡Œä»£ç çš„å¤§ç³»ç»Ÿä¸€å—å„¿å‘å¸ƒã€‚å°±æ„å‘³ç€ 20 ä¸‡ä¸Šä»£ç åœ¨çº¿ä¸Šå°±å¯èƒ½å‡ºçŽ°å„ç§å˜åŒ–ï¼Œ20 ä¸ªäººï¼Œæ¯ä¸ªäººéƒ½è¦ç´§å¼ åœ°ç­‰åœ¨ç”µè„‘é¢å‰ï¼Œä¸Šçº¿ä¹‹åŽï¼Œæ£€æŸ¥æ—¥å¿—ï¼Œçœ‹è‡ªå·±è´Ÿè´£çš„é‚£ä¸€å—å„¿æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ å°A å°±æ£€æŸ¥äº†è‡ªå·±è´Ÿè´£çš„ 1 ä¸‡è¡Œä»£ç å¯¹åº”çš„åŠŸèƒ½ï¼Œç¡®ä¿okå°±é—ªäººäº†ï¼›ç»“æžœä¸å·§çš„æ˜¯ï¼Œå°A ä¸Šçº¿çš„æ—¶å€™ä¸å°å¿ƒä¿®æ”¹äº†çº¿ä¸Šæœºå™¨çš„æŸä¸ªé…ç½®ï¼Œå¯¼è‡´å¦å¤– å°B å’Œ å°C è´Ÿè´£çš„ 2 ä¸‡è¡Œä»£ç å¯¹åº”çš„ä¸€äº›åŠŸèƒ½ï¼Œå‡ºé”™äº†ã€‚ å‡ åä¸ªäººè´Ÿè´£ç»´æŠ¤ä¸€ä¸ªå‡ åä¸‡è¡Œä»£ç çš„å•å—åº”ç”¨ï¼Œæ¯æ¬¡ä¸Šçº¿ï¼Œå‡†å¤‡å‡ ä¸ªç¤¼æ‹œï¼Œä¸Šçº¿ -&gt; éƒ¨ç½² -&gt; æ£€æŸ¥è‡ªå·±è´Ÿè´£çš„åŠŸèƒ½ã€‚ æ‹†åˆ†äº†ä»¥åŽï¼Œæ•´ä¸ªä¸–ç•Œæ¸…çˆ½äº†ï¼Œå‡ åä¸‡è¡Œä»£ç çš„ç³»ç»Ÿï¼Œæ‹†åˆ†æˆ 20 ä¸ªæœåŠ¡ï¼Œå¹³å‡æ¯ä¸ªæœåŠ¡å°± 1~2 ä¸‡è¡Œä»£ç ï¼Œæ¯ä¸ªæœåŠ¡éƒ¨ç½²åˆ°å•ç‹¬çš„æœºå™¨ä¸Šã€‚20 ä¸ªå·¥ç¨‹ï¼Œ20 ä¸ª git ä»£ç ä»“åº“é‡Œï¼Œ20 ä¸ªç å†œï¼Œæ¯ä¸ªäººç»´æŠ¤è‡ªå·±çš„é‚£ä¸ªæœåŠ¡å°±å¯ä»¥äº†ï¼Œæ˜¯è‡ªå·±ç‹¬ç«‹çš„ä»£ç ï¼Œè·Ÿåˆ«äººæ²¡å…³ç³»ã€‚å†ä¹Ÿæ²¡æœ‰ä»£ç å†²çªäº†ï¼Œçˆ½ã€‚æ¯æ¬¡å°±æµ‹è¯•æˆ‘è‡ªå·±çš„ä»£ç å°±å¯ä»¥äº†ï¼Œçˆ½ã€‚æ¯æ¬¡å°±å‘å¸ƒæˆ‘è‡ªå·±çš„ä¸€ä¸ªå°æœåŠ¡å°±å¯ä»¥äº†ï¼Œçˆ½ã€‚æŠ€æœ¯ä¸Šæƒ³æ€Žä¹ˆå‡çº§å°±æ€Žä¹ˆå‡çº§ï¼Œä¿æŒæŽ¥å£ä¸å˜å°±å¯ä»¥äº†ï¼Œçˆ½ã€‚ æ‰€ä»¥ç®€å•æ¥è¯´ï¼Œä¸€å¥è¯æ€»ç»“ï¼Œå¦‚æžœæ˜¯é‚£ç§ä»£ç é‡å¤šè¾¾å‡ åä¸‡è¡Œçš„ä¸­å¤§åž‹é¡¹ç›®ï¼Œå›¢é˜Ÿé‡Œæœ‰å‡ åä¸ªäººï¼Œé‚£ä¹ˆå¦‚æžœä¸æ‹†åˆ†ç³»ç»Ÿï¼Œå¼€å‘æ•ˆçŽ‡æžå…¶ä½Žä¸‹ï¼Œé—®é¢˜å¾ˆå¤šã€‚ä½†æ˜¯æ‹†åˆ†ç³»ç»Ÿä¹‹åŽï¼Œæ¯ä¸ªäººå°±è´Ÿè´£è‡ªå·±çš„ä¸€å°éƒ¨åˆ†å°±å¥½äº†ï¼Œå¯ä»¥éšä¾¿çŽ©å„¿éšä¾¿å¼„ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿæ‹†åˆ†ä¹‹åŽï¼Œå¯ä»¥å¤§å¹…åº¦æå‡å¤æ‚ç³»ç»Ÿå¤§åž‹å›¢é˜Ÿçš„å¼€å‘æ•ˆçŽ‡ã€‚ ä½†æ˜¯åŒæ—¶ï¼Œä¹Ÿè¦æé†’çš„ä¸€ç‚¹æ˜¯ï¼Œç³»ç»Ÿæ‹†åˆ†æˆåˆ†å¸ƒå¼ç³»ç»Ÿä¹‹åŽï¼Œå¤§é‡çš„åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜ä¹Ÿæ˜¯æŽ¥è¸µè€Œæ¥ï¼Œæ‰€ä»¥åŽé¢çš„é—®é¢˜éƒ½æ˜¯åœ¨å›´ç»•åˆ†å¸ƒå¼ç³»ç»Ÿå¸¦æ¥çš„å¤æ‚æŠ€æœ¯æŒ‘æˆ˜åœ¨è¯´ã€‚ è‰¿è‰¿æ›¾ç»ç»´æŠ¤è¿‡ä¸€ä¸ªå‡ åä¸‡è¡Œçš„å•ä½“é¡¹ç›®ï¼Œå¹¶ä¸”åŸºæœ¬æ˜¯ä¸€å¤©å‘å¸ƒ 2-3 æ¬¡ï¼ŒæœŸé—´çš„ç—›è‹¦ï¼Œç®€ç›´äº†ã€‚ Dubbo å¦‚ä½•é›†æˆé…ç½®ä¸­å¿ƒï¼Ÿå¯¹äºŽä½¿ç”¨äº† Dubbo çš„ç³»ç»Ÿï¼Œé…ç½®åˆ†æˆä¸¤ç±»ï¼š â‘  Dubbo è‡ªèº«é…ç½®ã€‚ ä¾‹å¦‚ï¼šDubbo è¯·æ±‚è¶…æ—¶ï¼ŒDubbo é‡è¯•æ¬¡æ•°ç­‰ç­‰ã€‚ â‘¡ éž Dubbo è‡ªèº«é…ç½® åŸºå»ºé…ç½®ï¼Œä¾‹å¦‚ï¼šæ•°æ®åº“ã€Redis ç­‰é…ç½®ã€‚ ä¸šåŠ¡é…ç½®ï¼Œä¾‹å¦‚ï¼šè®¢å•è¶…æ—¶æ—¶é—´ï¼Œä¸‹å•é¢‘çŽ‡ç­‰ç­‰é…ç½®ã€‚ å¯¹äºŽ â‘  ï¼Œå¦‚æžœæˆ‘ä»¬åœ¨ Provider é…ç½® Dubbo è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œå½“ Consumer æœªé…ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œä¼šç»§æ‰¿è¯¥é…ç½®ï¼Œä½¿ç”¨è¯¥è¯·æ±‚è¶…æ—¶æ—¶é—´ã€‚ å®žçŽ°åŽŸç†ï¼š Provider å¯åŠ¨æ—¶ï¼Œä¼šæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸­ï¼ŒåŒ…æ‹¬æˆ‘ä»¬åœ¨ `` ä¸­çš„é…ç½®ã€‚ Consumer å¯åŠ¨æ—¶ï¼Œä»Žæ³¨å†Œä¸­å¿ƒèŽ·å–åˆ° Provider åˆ—è¡¨åŽï¼Œä¼šåˆå¹¶å®ƒä»¬åœ¨ &lt;dubbo:service /&gt; çš„é…ç½®æ¥ä½¿ç”¨ã€‚å½“ç„¶ï¼Œå¦‚æžœ Consumer è‡ªå·±é…ç½®äº†è¯¥é…ç½®é¡¹ï¼Œåˆ™ä½¿ç”¨è‡ªèº«çš„ã€‚ä¾‹å¦‚è¯´ï¼ŒProvider é…ç½®äº†è¯·æ±‚è¶…æ—¶æ—¶é—´æ˜¯ 10s ï¼Œè€Œ Consumer é…ç½®äº†è¯·æ±‚è¶…æ—¶è¶…æ—¶æ˜¯ 5s ï¼Œé‚£ä¹ˆæœ€ç»ˆ Consumer è¯·æ±‚è¶…æ—¶çš„æ—¶é—´æ˜¯ 5s ã€‚ ç»å¤§æ•°é…ç½®å¯ä»¥è¢«ç»§æ‰¿ï¼Œåˆå¹¶çš„æ ¸å¿ƒé€»è¾‘ï¼Œè§ ClusterUtils#mergeUrl(URL remoteUrl, Map localMap)æ–¹æ³•ã€‚ å®žçŽ°ä»£ç ï¼Œè§ ã€Šç²¾å°½ Dubbo æºç è§£æž â€”â€” é›†ç¾¤å®¹é”™ï¼ˆå…­ï¼‰ä¹‹ Configurator å®žçŽ°ã€‹ ã€‚ å¯¹äºŽ â‘¡ ï¼Œå¸‚é¢ä¸Šæœ‰éžå¸¸å¤šçš„é…ç½®ä¸­å¿ƒå¯ä¾›é€‰æ‹©ï¼š Apollo Nacos Disconf è¿™ä¸ªé—®é¢˜ä¸å¤§ã€‚å¯¹äºŽé…ç½®ä¸­å¿ƒçš„é€‰æ‹©ï¼Œæˆ‘ä»¬è€ƒè™‘çš„ä¸æ˜¯å®ƒå’Œ Dubbo çš„é›†æˆï¼Œè€Œæ˜¯å®ƒå’Œ Spring çš„é›†æˆã€‚å› ä¸ºï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ Spring ä½œä¸ºæ¡†æž¶çš„æ•´åˆåŸºç¡€ã€‚ç›®å‰ï¼ŒApollo å’Œ Nacos å¯¹ Spring çš„æ”¯æŒæ˜¯æ¯”è¾ƒä¸é”™çš„ã€‚ Dubbo å¦‚ä½•å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿé¦–å…ˆï¼Œå…³äºŽåˆ†å¸ƒå¼äº‹åŠ¡çš„åŠŸèƒ½ï¼Œä¸æ˜¯ Dubbo ä½œä¸ºæœåŠ¡æ²»ç†æ¡†æž¶éœ€è¦åŽ»å®žçŽ°çš„ï¼Œæ‰€ä»¥ Dubbo æœ¬èº«å¹¶æ²¡æœ‰å®žçŽ°ã€‚æ‰€ä»¥åœ¨ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” åˆ†å¸ƒå¼äº‹åŠ¡ã€‹ ä¹Ÿæåˆ°ï¼Œç›®å‰å¹¶æœªå®žçŽ°ã€‚ è¯´èµ·åˆ†å¸ƒå¼ï¼Œç†è®ºçš„æ–‡ç« å¾ˆå¤šï¼Œè½åœ°çš„å®žè·µå¾ˆå°‘ã€‚ç¬”è€…ç¿»é˜…äº†å„ç§åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶çš„é€‰åž‹ï¼Œå¤§ä½“å¦‚ä¸‹ï¼š TCC æ¨¡åž‹ï¼šTCC-Transactionã€Hmily XA æ¨¡åž‹ï¼šSharding Sphereã€MyCAT 2PC æ¨¡åž‹ï¼šraincatã€lcn MQ æ¨¡åž‹ï¼šRocketMQ BED æ¨¡åž‹ï¼šSharding Sphere Saga æ¨¡åž‹ï¼šServiceComb Saga é‚£æ€Žä¹ˆé€‰æ‹©å‘¢ï¼Ÿç›®å‰ç¤¾åŒºå¯¹äºŽåˆ†å¸ƒå¼äº‹åŠ¡çš„é€‰æ‹©ï¼Œæš‚æ—¶æ²¡æœ‰å®šè®ºï¼Œè‡³å°‘ç¬”è€…æ²¡æœ‰çœ‹åˆ°ã€‚ç¬”è€…çš„æƒ³æ³•å¦‚ä¸‹ï¼š ä»Žè¦†ç›–åœºæ™¯æ¥è¯´ï¼ŒTCC æ— ç–‘æ˜¯æœ€ä¼˜ç§€çš„ï¼Œä½†æ˜¯å¤§å®¶è§‰å¾—ç›¸å¯¹å¤æ‚ã€‚å®žé™…ä¸Šï¼Œå¤æ‚åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ TCC æ¥å®žçŽ°ï¼Œåå€’ä¼šå®¹æ˜“å¾ˆå¤šã€‚å¦å¤–ï¼ŒTCC æ¨¡åž‹ï¼Œä¸€ç›´æ²¡æœ‰å¤§åŽ‚å¼€æºï¼Œä¹Ÿæ˜¯ä¸€å¤§ç—›ç‚¹ã€‚ ä»Žä½¿ç”¨å»ºè®®æ¥è¯´ï¼ŒMQ å¯èƒ½æ˜¯ç›¸å¯¹åˆé€‚çš„( ä¸è¯´ XA çš„åŽŸå› è¿˜æ˜¯æ€§èƒ½é—®é¢˜ )ï¼Œå¹¶ä¸”åŸºæœ¬è½®è¯¢äº†ä¸€åœˆæœ‹å‹ï¼Œå‘çŽ°å¤§å¤šéƒ½æ˜¯ä½¿ç”¨ MQ å®žçŽ°æœ€ç»ˆä¸€è‡´æ€§å±…å¤šã€‚ 2PC æ¨¡åž‹çš„å®žçŽ°ï¼Œç¬”è€…è§‰å¾—éžå¸¸æ–°å¥‡ï¼Œå¥ˆä½•éš”ç¦»æ€§æ˜¯ä¸€ä¸ªç¡¬ä¼¤ã€‚ Saga æ¨¡åž‹ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ TCC æ¨¡åž‹çš„ç®€åŒ–ç‰ˆï¼Œæ‰€ä»¥åœ¨ç†è§£å’Œç¼–å†™çš„éš¾åº¦ä¸Šï¼Œç®€å•éžå¸¸å¤šã€‚ æ‰€ä»¥ç»“è®ºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ TCC æ¨¡åž‹ï¼šTCC-Transactionã€Hmily ã€‚ å·²ç»æä¾›äº†å’Œ Dubbo é›†æˆçš„æ–¹æ¡ˆï¼Œèƒ–å‹å¯ä»¥è‡ªå·±åŽ»è¯•è¯•ã€‚ XA æ¨¡åž‹ï¼šSharding Sphereã€MyCAT ã€‚ æ— éœ€å’Œ Dubbo è¿›è¡Œé›†æˆã€‚ 2PC æ¨¡åž‹ï¼šraincatã€lcn ã€‚ å·²ç»æä¾›äº†å’Œ Dubbo é›†æˆçš„æ–¹æ¡ˆï¼Œèƒ–å‹å¯ä»¥è‡ªå·±åŽ»è¯•è¯•ã€‚ MQ æ¨¡åž‹ï¼šRocketMQ ã€‚ æ— éœ€å’Œ Dubbo è¿›è¡Œé›†æˆã€‚ BED æ¨¡åž‹ï¼šSharding Sphere ã€‚ æ— éœ€å’Œ Dubbo è¿›è¡Œé›†æˆã€‚ Saga æ¨¡åž‹ï¼šServiceComb Saga ã€‚ å¥½åƒå·²ç»æä¾›äº†å’Œ Dubbo é›†æˆçš„æ–¹æ¡ˆï¼Œå‚è§ ã€ŠSaga-dubbo-demoã€‹ æ–‡æ¡£ã€‚ ðŸ˜ˆ æš‚æ—¶æ²¡åŽ»æ·±å…¥ç ”ç©¶ã€‚ å¦å¤–ï¼Œèƒ–å‹åœ¨ç†è§£åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œä¸€å®šè¦è®°ä½ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦ç”±å¤šä¸ªæœ¬åœ°äº‹åŠ¡ç»„æˆã€‚æ— è®ºæ˜¯ä¸Šè¿°çš„é‚£ç§äº‹åŠ¡ç»„ä»¶æ¨¡åž‹ï¼Œå®ƒä»¬éƒ½æ˜¯æ‰®æ¼”ä¸€ä¸ªåè°ƒè€…ï¼Œä½¿å¤šä¸ªæœ¬åœ°äº‹åŠ¡è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚è€Œåè°ƒçš„è¿‡ç¨‹ä¸­ï¼Œå°±éžå¸¸ä¾èµ–æ¯ä¸ªæ–¹æ³•æ“ä½œå¯ä»¥è¢«é‡å¤æ‰§è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ï¼š å¹‚ç­‰æ€§ï¼å› ä¸ºå¯èƒ½ä¼šè¢«é‡å¤è°ƒç”¨ã€‚å¦‚æžœè°ƒç”¨ä¸¤æ¬¡é€€æ¬¾ï¼Œç»“æžœé€€äº†ä¸¤æ¬¡é’±ï¼Œé‚£å°±éº»çƒ¦å¤§äº†ã€‚ æœ¬åœ°äº‹åŠ¡ï¼å› ä¸ºæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºé”™ï¼Œéœ€è¦å›žæ»šã€‚ Dubbo å¦‚ä½•é›†æˆç½‘å…³æœåŠ¡ï¼ŸDubbo å¦‚ä½•é›†æˆåˆ°ç½‘å…³æœåŠ¡ï¼Œéœ€è¦æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š ç½‘å…³å¦‚ä½•è°ƒç”¨ Dubbo æœåŠ¡ã€‚ ç½‘å…³å¦‚ä½•å‘çŽ° Dubbo æœåŠ¡ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œå¸‚é¢ä¸Šæœ‰å“ªäº›ç½‘å…³æœåŠ¡ï¼š Zuul Spring Cloud Gateway Kong å¦‚ä¸Šä¸‰ä¸ªè§£å†³æ–¹æ¡ˆï¼Œéƒ½æ˜¯åŸºäºŽ HTTP è°ƒç”¨åŽç«¯çš„æœåŠ¡ã€‚é‚£ä¹ˆï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼ŒDubbo åªèƒ½é€šè¿‡æš´éœ² rest:// åè®®çš„æœåŠ¡ï¼Œæ‰èƒ½è¢«å®ƒä»¬è°ƒç”¨ã€‚ é‚£ä¹ˆ Dubbo çš„ rest:// åè®®çš„æœåŠ¡ï¼Œæ€Žä¹ˆèƒ½å¤Ÿè¢«å¦‚ä¸Šä¸‰ä¸ªè§£å†³æ–¹æ¡ˆæ³¨å†Œå‘çŽ°å‘¢ï¼Ÿ å› ä¸º Dubbo å¯ç”¨çš„æ³¨å†Œä¸­å¿ƒæœ‰ Zookeeper ï¼Œå¦‚æžœè¦è¢« Zuul æˆ– Spring Cloud Gateway æ³¨å†Œå‘çŽ°ï¼Œå¯ä»¥ä½¿ç”¨ spring-cloud-starter-zookeeper-discovery åº“ã€‚å…·ä½“å¯å‚è§ ã€ŠService Discovery with Zookeeperã€‹ æ–‡ç« ã€‚ Dubbo ä¸Ž Kong çš„é›†æˆï¼Œç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦é€šè¿‡ Kong çš„ API æ·»åŠ ç›¸åº”çš„è·¯ç”±è§„åˆ™ã€‚å…·ä½“å¯å‚è§ ã€Šé€‰æ‹© Kong ä½œä¸ºä½ çš„ API ç½‘å…³ã€‹ æ–‡ç« ã€‚ å¯èƒ½ä¼šæœ‰èƒ–å‹é—®ï¼Œæœ‰æ²¡æ”¯æŒ dubbo:// åè®®çš„ç½‘å…³æœåŠ¡å‘¢ï¼Ÿç›®å‰æœ‰æ–°çš„ç½‘å…³å¼€æº Soul ï¼ŒåŸºäºŽ Dubbo æ³›åŒ–è°ƒç”¨çš„ç‰¹æ€§ï¼Œå®žçŽ°å¯¹ dubbo:// åè®®çš„ Dubbo æœåŠ¡çš„è°ƒç”¨ã€‚ æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥åŽ»ç ”ç©¶ä¸‹ã€‚ å…³äºŽ Dubbo æ³›åŒ–è°ƒç”¨çš„ç‰¹æ€§ï¼Œèƒ–å‹å¯ä»¥çœ‹çœ‹ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” ä½¿ç”¨æ³›åŒ–è°ƒç”¨ã€‹ ã€‚ å®žé™…åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬çœŸçš„éœ€è¦ Dubbo é›†æˆåˆ°ç½‘å…³å—ï¼Ÿå…·è‰¿è‰¿äº†è§£åˆ°ï¼Œå¾ˆå¤šå…¬å¸ï¼Œå¹¶æœªä½¿ç”¨ç½‘å…³ï¼Œè€Œæ˜¯ä½¿ç”¨ Spring Boot æ­å»ºä¸€ä¸ª Web é¡¹ç›®ï¼Œå¼•å…¥ *-api.jar åŒ…ï¼Œç„¶åŽè¿›è¡Œè°ƒç”¨ï¼Œä»Žè€Œå¯¹å¤–æš´éœ² HTTP API ã€‚ å¦‚ä½•è¿›è¡Œç³»ç»Ÿæ‹†åˆ†ï¼Ÿè¿™ä¸ªé—®é¢˜ï¼Œä¸æ˜¯ä»…ä»…é€‚ç”¨äºŽ Dubbo çš„åœºæ™¯ï¼Œè€Œæ˜¯ SOAã€å¾®æœåŠ¡ã€‚æŽ¥ä¸Šé¢ ã€Œä¸ºä»€ä¹ˆè¦å°†ç³»ç»Ÿè¿›è¡Œæ‹†åˆ†ï¼Ÿã€ ã€‚ è¿™ä¸ªé—®é¢˜è¯´å¤§å¯ä»¥å¾ˆå¤§ï¼Œå¯ä»¥æ‰¯åˆ°é¢†åŸŸé©±åŠ¨æ¨¡åž‹è®¾è®¡ä¸ŠåŽ»ï¼Œè¯´å°äº†ä¹Ÿå¾ˆå°ï¼Œæˆ‘ä¸å¤ªæƒ³ç»™å¤§å®¶å¤ªè¿‡äºŽå­¦æœ¯çš„è¯´æ³•ï¼Œå› ä¸ºä½ ä¹Ÿä¸å¯èƒ½èƒŒè¿™ä¸ªç­”æ¡ˆï¼Œè¿‡åŽ»äº†ç›´æŽ¥è¯´å§ã€‚è¿˜æ˜¯è¯´çš„ç®€å•ä¸€ç‚¹ï¼Œå¤§å®¶è‡ªå·±åˆ°æ—¶å€™çŸ¥é“æ€Žä¹ˆå›žç­”å°±è¡Œäº†ã€‚ ç³»ç»Ÿæ‹†åˆ†ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ‹†æˆå¤šä¸ªæœåŠ¡ï¼Œæ‹†æˆå¾®æœåŠ¡çš„æž¶æž„ï¼Œæ˜¯éœ€è¦æ‹†å¾ˆå¤šè½®çš„ã€‚å¹¶ä¸æ˜¯è¯´ä¸Šæ¥ä¸€ä¸ªæž¶æž„å¸ˆä¸€æ¬¡å°±ç»™æ‹†å¥½äº†ï¼Œè€Œä»¥åŽéƒ½ä¸ç”¨æ‹†ã€‚ ç¬¬ä¸€è½®ï¼›å›¢é˜Ÿç»§ç»­æ‰©å¤§ï¼Œæ‹†å¥½çš„æŸä¸ªæœåŠ¡ï¼Œåˆšå¼€å§‹æ˜¯ 1 ä¸ªäººç»´æŠ¤ 1 ä¸‡è¡Œä»£ç ï¼ŒåŽæ¥ä¸šåŠ¡ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œè¿™ä¸ªæœåŠ¡æ˜¯ 10 ä¸‡è¡Œä»£ç ï¼Œ5 ä¸ªäººï¼›ç¬¬äºŒè½®ï¼Œ1ä¸ªæœåŠ¡ -&gt; 5ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ 2 ä¸‡è¡Œä»£ç ï¼Œæ¯äººè´Ÿè´£ä¸€ä¸ªæœåŠ¡ã€‚ å¦‚æžœæ˜¯å¤šäººç»´æŠ¤ä¸€ä¸ªæœåŠ¡ï¼Œæœ€ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå‡ åä¸ªäººï¼Œ1 ä¸ªäººè´Ÿè´£ 1 ä¸ªæˆ– 2~3 ä¸ªæœåŠ¡ï¼›æŸä¸ªæœåŠ¡å·¥ä½œé‡å˜å¤§äº†ï¼Œä»£ç é‡è¶Šæ¥è¶Šå¤šï¼ŒæŸä¸ªåŒå­¦ï¼Œè´Ÿè´£ä¸€ä¸ªæœåŠ¡ï¼Œä»£ç é‡å˜æˆäº† 10 ä¸‡è¡Œäº†ï¼Œä»–è‡ªå·±ä¸å ªé‡è´Ÿï¼Œä»–çŽ°åœ¨ä¸€ä¸ªäººæ‹†å¼€ï¼Œ5 ä¸ªæœåŠ¡ï¼Œ1 ä¸ªäººé¡¶ç€ï¼Œè´Ÿè´£ 5 ä¸ªäººï¼ŒæŽ¥ç€æ‹›äººï¼Œ2 ä¸ªäººï¼Œç»™é‚£ä¸ªåŒå­¦å¸¦ç€ï¼Œ3 ä¸ªäººè´Ÿè´£ 5 ä¸ªæœåŠ¡ï¼Œå…¶ä¸­ 2 ä¸ªäººæ¯ä¸ªäººè´Ÿè´£ 2 ä¸ªæœåŠ¡ï¼Œ1 ä¸ªäººè´Ÿè´£ 1 ä¸ªæœåŠ¡ã€‚ ä¸ªäººå»ºè®®ï¼Œä¸€ä¸ªæœåŠ¡çš„ä»£ç ä¸è¦å¤ªå¤šï¼Œ1ä¸‡è¡Œå·¦å³ï¼Œä¸¤ä¸‰ä¸‡æ’‘æ­»äº†å§ã€‚ å¤§éƒ¨åˆ†çš„ç³»ç»Ÿï¼Œæ˜¯è¦è¿›è¡Œå¤šè½®æ‹†åˆ†çš„ï¼Œç¬¬ä¸€æ¬¡æ‹†åˆ†ï¼Œå¯èƒ½å°±æ˜¯å°†ä»¥å‰çš„å¤šä¸ªæ¨¡å—è¯¥æ‹†åˆ†å¼€æ¥äº†ï¼Œæ¯”å¦‚è¯´å°†ç”µå•†ç³»ç»Ÿæ‹†åˆ†æˆè®¢å•ç³»ç»Ÿã€å•†å“ç³»ç»Ÿã€é‡‡è´­ç³»ç»Ÿã€ä»“å‚¨ç³»ç»Ÿã€ç”¨æˆ·ç³»ç»Ÿï¼Œç­‰ç­‰å§ã€‚ ä½†æ˜¯åŽé¢å¯èƒ½æ¯ä¸ªç³»ç»Ÿåˆå˜å¾—è¶Šæ¥è¶Šå¤æ‚äº†ï¼Œæ¯”å¦‚è¯´é‡‡è´­ç³»ç»Ÿé‡Œé¢åˆåˆ†æˆäº†ä¾›åº”å•†ç®¡ç†ç³»ç»Ÿã€é‡‡è´­å•ç®¡ç†ç³»ç»Ÿï¼Œè®¢å•ç³»ç»Ÿåˆæ‹†åˆ†æˆäº†è´­ç‰©è½¦ç³»ç»Ÿã€ä»·æ ¼ç³»ç»Ÿã€è®¢å•ç®¡ç†ç³»ç»Ÿã€‚ æ‰¯æ·±äº†å®žåœ¨å¾ˆæ·±ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆç»™å¤§å®¶ä¸¾ä¸ªä¾‹å­ï¼Œä½ è‡ªå·±æ„Ÿå—ä¸€ä¸‹ï¼Œæ ¸å¿ƒæ„æ€å°±æ˜¯æ ¹æ®æƒ…å†µï¼Œå…ˆæ‹†åˆ†ä¸€è½®ï¼ŒåŽé¢å¦‚æžœç³»ç»Ÿæ›´å¤æ‚äº†ï¼Œå¯ä»¥ç»§ç»­åˆ†æ‹†ã€‚ä½ æ ¹æ®è‡ªå·±è´Ÿè´£ç³»ç»Ÿçš„ä¾‹å­ï¼Œæ¥è€ƒè™‘ä¸€ä¸‹å°±å¥½äº†ã€‚ æ‹†åˆ†åŽä¸ç”¨ Dubbo å¯ä»¥å—ï¼Ÿå½“ç„¶æ˜¯å¯ä»¥ï¼Œæ–¹å¼è¿˜æœ‰å¾ˆå¤šï¼š ç¬¬ä¸€ç§ï¼Œä½¿ç”¨ Spring Cloud æŠ€æœ¯ä½“ç³»ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ç›®å‰å¯èƒ½æœ€ä¸»æµçš„ä¹‹ä¸€ã€‚ ç¬¬äºŒç§ï¼ŒDubbo æ¢æˆ gRPC æˆ–è€… Thrift ã€‚å½“ç„¶ï¼Œæ­¤æ—¶è¦è‡ªå·±å®žçŽ°æ³¨å†Œå‘çŽ°ã€è´Ÿè½½å‡è¡¡ã€é›†ç¾¤å®¹é”™ç­‰ç­‰åŠŸèƒ½ã€‚ ç¬¬ä¸‰ç§ï¼ŒDubbo æ¢æˆåŒç­‰å®šä½çš„æœåŠ¡åŒ–æ¡†æž¶ï¼Œä¾‹å¦‚å¾®åšçš„ Motan ã€èš‚èšé‡‘æœçš„ SofaRPC ã€‚ ç¬¬å››ç§ï¼ŒSpring MVC + Nginx ã€‚ ç¬¬äº”ç§ï¼Œæ¯ä¸ªæœåŠ¡æ‹†æˆä¸€ä¸ª Maven é¡¹ç›®ï¼Œæ‰“æˆ Jar åŒ…ï¼Œç»™å…¶å®ƒæœåŠ¡ä½¿ç”¨ã€‚ðŸ˜ˆ å½“ç„¶ï¼Œè¿™ä¸ªä¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„æ–¹æ¡ˆã€‚ å½“ç„¶å¯ä»¥äº†ï¼Œå¤§ä¸äº†æœ€æ¬¡ï¼Œå°±æ˜¯å„ä¸ªç³»ç»Ÿä¹‹é—´ï¼Œç›´æŽ¥åŸºäºŽ spring mvcï¼Œå°±çº¯ http æŽ¥å£äº’ç›¸é€šä¿¡å‘—ï¼Œè¿˜èƒ½å’‹æ ·ã€‚ä½†æ˜¯è¿™ä¸ªè‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸º http æŽ¥å£é€šä¿¡ç»´æŠ¤èµ·æ¥æˆæœ¬å¾ˆé«˜ï¼Œä½ è¦è€ƒè™‘è¶…æ—¶é‡è¯•ã€è´Ÿè½½å‡è¡¡ç­‰ç­‰å„ç§ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ä½ çš„è®¢å•ç³»ç»Ÿè°ƒç”¨å•†å“ç³»ç»Ÿï¼Œå•†å“ç³»ç»Ÿéƒ¨ç½²äº† 5 å°æœºå™¨ï¼Œä½ æ€Žä¹ˆæŠŠè¯·æ±‚å‡åŒ€åœ°ç”©ç»™é‚£ 5 å°æœºå™¨ï¼Ÿè¿™ä¸å°±æ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿä½ è¦æ˜¯éƒ½è‡ªå·±æžé‚£æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ç¡®å®žå¾ˆç—›è‹¦ã€‚ æ‰€ä»¥ dubbo è¯´ç™½äº†ï¼Œæ˜¯ä¸€ç§ rpc æ¡†æž¶ï¼Œå°±æ˜¯è¯´æœ¬åœ°å°±æ˜¯è¿›è¡ŒæŽ¥å£è°ƒç”¨ï¼Œä½†æ˜¯ dubbo ä¼šä»£ç†è¿™ä¸ªè°ƒç”¨è¯·æ±‚ï¼Œè·Ÿè¿œç¨‹æœºå™¨ç½‘ç»œé€šä¿¡ï¼Œç»™ä½ å¤„ç†æŽ‰è´Ÿè½½å‡è¡¡äº†ã€æœåŠ¡å®žä¾‹ä¸Šä¸‹çº¿è‡ªåŠ¨æ„ŸçŸ¥äº†ã€è¶…æ—¶é‡è¯•äº†ï¼Œç­‰ç­‰ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜ã€‚é‚£ä½ å°±ä¸ç”¨è‡ªå·±åšäº†ï¼Œç”¨ dubbo å°±å¯ä»¥äº†ã€‚ Spring Cloud ä¸Ž Dubbo æ€Žä¹ˆé€‰æ‹©ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªæŠ€æœ¯æ ˆåœ¨å›½å†…çš„æµè¡Œç¨‹åº¦ï¼Œæ®è‰¿è‰¿äº†è§£åˆ°ï¼š å¯¹äºŽå›½å¤–ï¼ŒSpring Cloud åŸºæœ¬å·²ç»ç»Ÿä¸€å›½å¤–çš„å¾®æœåŠ¡ä½“ç³»ã€‚ å¯¹äºŽå›½å†…ï¼Œè€çš„ç³»ç»Ÿä½¿ç”¨ Dubbo è¾ƒå¤šï¼Œæ–°çš„ç³»ç»Ÿä½¿ç”¨ Spring Cloud è¾ƒå¤šã€‚ è¿™æ ·è¯´èµ·æ¥ï¼Œä»¿ä½› Spring Cloud å’Œ Dubbo æ˜¯å†²çªçš„å…³ç³»ï¼Ÿï¼ å®žé™…ä¸Šï¼Œå¹¶ä¸ç„¶ã€‚æˆ‘ä»¬çŽ°åœ¨æ‰€ä½¿ç”¨çš„ Spring Cloud æŠ€æœ¯ä½“ç³»ï¼Œå®žé™…ä¸Šæ˜¯ Spring Cloud Netflix ä¸ºä¸»ï¼Œä¾‹å¦‚è¯´ï¼š Netflix Eureka æ³¨å†Œä¸­å¿ƒ Netflix Hystrix ç†”æ–­ç»„ä»¶ Netflix Ribbon è´Ÿè½½å‡è¡¡ Netflix Zuul ç½‘å…³æœåŠ¡ ä½†æ˜¯ï¼Œå¼€æºçš„ä¸–ç•Œï¼Œæ€»æ˜¯è¿™ä¹ˆæœ‰è¶£ã€‚ç›®å‰ Alibaba åŸºäºŽ Spring Cloud çš„æŽ¥å£ï¼Œå¯¹çš„æ˜¯æŽ¥å£ï¼Œå®žçŽ°äº†ä¸€å¥— Spring Cloud Alibaba æŠ€æœ¯ä½“ç³»ï¼Œå¹¶ä¸”å·²ç»èŽ·å¾— Spring Cloud çš„è®¤å¯ï¼Œå¤„äºŽå­µåŒ–çŠ¶æ€ã€‚ç»„ä»¶å¦‚ä¸‹ï¼š Nacos æ³¨å†Œä¸­å¿ƒï¼Œå¯¹æ ‡ Eureka ã€‚ Nacos é…ç½®ä¸­å¿ƒï¼Œé›†æˆåˆ° Spring Cloud Config ã€‚ Sentinel æœåŠ¡ä¿éšœï¼Œå¯¹æ ‡ Hystrix ã€‚ Dubbo æœåŠ¡è°ƒç”¨( åŒ…æ‹¬è´Ÿè½½å‡è¡¡ )ï¼Œå¯¹æ ‡ Ribbon + Feign ã€‚ ç¼ºå¤± ç½‘å…³æœåŠ¡ã€‚ RocketMQ é˜Ÿåˆ—æœåŠ¡ï¼Œé›†æˆåˆ° Spring Cloud Stream ã€‚ æ›´å¤šçš„è®¨è®ºï¼Œèƒ–å‹å¯ä»¥å°¾éšçŸ¥ä¹Žä¸Šçš„ ã€Šè¯·é—®å“ªä½å¤§ç¥žæ¯”è¾ƒè¿‡ spring cloud å’Œ dubbo ï¼Œå„è‡ªçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆ?ã€‹ ã€‚ è‰¿è‰¿çš„ä¸ªäººæ€åº¦ä¸Šï¼Œè¿˜æ˜¯éžå¸¸çœ‹å¥½ Spring Cloud Alibaba æŠ€æœ¯ä½“ç³»çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º Alibaba èƒŒåŽæœ‰é˜¿é‡Œäº‘çš„å­˜åœ¨ï¼Œæä¾›å¼€æºé¡¹ç›®å’Œå•†ä¸šæœåŠ¡çš„ç»Ÿä¸€ã€‚ðŸ˜ˆ è¿™ä¸ªï¼Œæ˜¯ Netflix æ‰€æ— æ³•æ¯”æ‹Ÿçš„ã€‚ä¾‹å¦‚è¯´ï¼š å¼€æºé¡¹ç›® é˜¿é‡Œäº‘æœåŠ¡ Tengine LBS Dubbo EDAS RocketMQ ONS è¿™é‡Œåœ¨æŠ›å‡ºä¸€ä¸ªè¯é¢˜ã€‚ç›®å‰ä¼ è¯´ Dubbo åœ¨å›½å¤–çš„æŽ¥å—åº¦æ¯”è¾ƒä½Žï¼Œé‚£ä¹ˆåœ¨ Spring Cloud Alibaba æˆåŠŸå­µåŒ–å®ŒåŽï¼Œæ˜¯å¦èƒ½å¤Ÿæ€å…¥å›½å¤–çš„å¸‚åœºå‘¢ï¼Ÿè®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…ã€‚ åœ¨èŠä¸€ä¸¢ä¸¢æœ‰æ„æ€çš„äº‹æƒ…ã€‚ äº‹å®žä¸Šï¼ŒNetflix å·²ç»åŸºæœ¬ä¸å†ç»´æŠ¤ Eurekaã€Hystrix ï¼Œæ›´æœ‰è¶£çš„æ˜¯ï¼Œå› ä¸ºç½‘å…³çš„äº‹æƒ…ï¼ŒZuul å’Œ Spring Cloud å›¢é˜Ÿæœ‰ç‚¹é—¹æŽ°äº†ï¼Œå› è€ŒåŽæ¥æœ‰äº† Spring Cloud Gateway ã€‚å› è€Œï¼ŒZuul2 åŽç»­åœ¨ Spring Cloud ä½“ç³»ä¸­çš„æƒ…å†µï¼Œä¼šéžå¸¸æœ‰è¶£~ å¦å¤–ï¼ŒSpring Cloud è²Œä¼¼ä¹Ÿå®žçŽ°äº†ä¸€ä¸ª LoadBalance è´Ÿè½½å‡è¡¡ç»„ä»¶å“Ÿã€‚ å¦‚ä½•è‡ªå·±è®¾è®¡ä¸€ä¸ªç±»ä¼¼ Dubbo çš„ RPC æ¡†æž¶ï¼Ÿé¢è¯•å®˜å¿ƒç†åˆ†æž è¯´å®žè¯ï¼Œå°±è¿™é—®é¢˜ï¼Œå…¶å®žå°±è·Ÿé—®ä½ å¦‚ä½•è‡ªå·±è®¾è®¡ä¸€ä¸ª MQ ä¸€æ ·çš„é“ç†ï¼Œå°±è€ƒä¸¤ä¸ªï¼š ä½ æœ‰æ²¡æœ‰å¯¹æŸä¸ª rpc æ¡†æž¶åŽŸç†æœ‰éžå¸¸æ·±å…¥çš„ç†è§£ã€‚ ä½ èƒ½ä¸èƒ½ä»Žæ•´ä½“ä¸Šæ¥æ€è€ƒä¸€ä¸‹ï¼Œå¦‚ä½•è®¾è®¡ä¸€ä¸ª rpc æ¡†æž¶ï¼Œè€ƒè€ƒä½ çš„ç³»ç»Ÿè®¾è®¡èƒ½åŠ›ã€‚ é¢è¯•é¢˜å‰–æž å…¶å®žé—®åˆ°ä½ è¿™é—®é¢˜ï¼Œä½ èµ·ç ä¸èƒ½è®¤æ€‚ï¼Œå› ä¸ºæ˜¯çŸ¥è¯†çš„æ‰«ç›²ï¼Œé‚£æˆ‘ä¸å¯èƒ½ç»™ä½ æ·±å…¥è®²è§£ä»€ä¹ˆ kafka æºç å‰–æžï¼Œdubbo æºç å‰–æžï¼Œä½•å†µæˆ‘å°±ç®—è®²äº†ï¼Œä½ è¦çœŸçš„æ¶ˆåŒ–ç†è§£å’Œå¸æ”¶ï¼Œèµ·ç ä¸ªæŠŠæœˆä»¥åŽäº†ã€‚ æ‰€ä»¥æˆ‘ç»™å¤§å®¶ä¸€ä¸ªå»ºè®®ï¼Œé‡åˆ°è¿™ç±»é—®é¢˜ï¼Œèµ·ç ä»Žä½ äº†è§£çš„ç±»ä¼¼æ¡†æž¶çš„åŽŸç†å…¥æ‰‹ï¼Œè‡ªå·±è¯´è¯´å‚ç…§ dubbo çš„åŽŸç†ï¼Œä½ æ¥è®¾è®¡ä¸€ä¸‹ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œdubbo ä¸æ˜¯æœ‰é‚£ä¹ˆå¤šåˆ†å±‚ä¹ˆï¼Ÿè€Œä¸”æ¯ä¸ªåˆ†å±‚æ˜¯å¹²å•¥çš„ï¼Œä½ å¤§æ¦‚æ˜¯ä¸æ˜¯çŸ¥é“ï¼Ÿé‚£å°±æŒ‰ç…§è¿™ä¸ªæ€è·¯å¤§è‡´è¯´ä¸€ä¸‹å§ï¼Œèµ·ç ä½ ä¸èƒ½æ‡µé€¼ï¼Œè¦æ¯”é‚£äº›ä¸Šæ¥å°±æ‡µï¼Œå•¥ä¹Ÿè¯´ä¸å‡ºæ¥çš„äººè¦å¥½ä¸€äº›ã€‚ ä¸¾ä¸ªæ —å­ï¼Œæˆ‘ç»™å¤§å®¶è¯´ä¸ªæœ€ç®€å•çš„å›žç­”æ€è·¯ï¼š ä¸Šæ¥ä½ çš„æœåŠ¡å°±å¾—åŽ»æ³¨å†Œä¸­å¿ƒæ³¨å†Œå§ï¼Œä½ æ˜¯ä¸æ˜¯å¾—æœ‰ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œä¿ç•™å„ä¸ªæœåŠ¡çš„ä¿¡å¿ƒï¼Œå¯ä»¥ç”¨ zookeeper æ¥åšï¼Œå¯¹å§ã€‚ ç„¶åŽä½ çš„æ¶ˆè´¹è€…éœ€è¦åŽ»æ³¨å†Œä¸­å¿ƒæ‹¿å¯¹åº”çš„æœåŠ¡ä¿¡æ¯å§ï¼Œå¯¹å§ï¼Œè€Œä¸”æ¯ä¸ªæœåŠ¡å¯èƒ½ä¼šå­˜åœ¨äºŽå¤šå°æœºå™¨ä¸Šã€‚ æŽ¥ç€ä½ å°±è¯¥å‘èµ·ä¸€æ¬¡è¯·æ±‚äº†ï¼Œå’‹å‘èµ·ï¼Ÿå½“ç„¶æ˜¯åŸºäºŽåŠ¨æ€ä»£ç†äº†ï¼Œä½ é¢å‘æŽ¥å£èŽ·å–åˆ°ä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œè¿™ä¸ªåŠ¨æ€ä»£ç†å°±æ˜¯æŽ¥å£åœ¨æœ¬åœ°çš„ä¸€ä¸ªä»£ç†ï¼Œç„¶åŽè¿™ä¸ªä»£ç†ä¼šæ‰¾åˆ°æœåŠ¡å¯¹åº”çš„æœºå™¨åœ°å€ã€‚ ç„¶åŽæ‰¾å“ªä¸ªæœºå™¨å‘é€è¯·æ±‚ï¼Ÿé‚£è‚¯å®šå¾—æœ‰ä¸ªè´Ÿè½½å‡è¡¡ç®—æ³•äº†ï¼Œæ¯”å¦‚æœ€ç®€å•çš„å¯ä»¥éšæœºè½®è¯¢æ˜¯ä¸æ˜¯ã€‚ æŽ¥ç€æ‰¾åˆ°ä¸€å°æœºå™¨ï¼Œå°±å¯ä»¥è·Ÿå®ƒå‘é€è¯·æ±‚äº†ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å’‹å‘é€ï¼Ÿä½ å¯ä»¥è¯´ç”¨ netty äº†ï¼Œnio æ–¹å¼ï¼›ç¬¬äºŒä¸ªé—®é¢˜å‘é€å•¥æ ¼å¼æ•°æ®ï¼Ÿä½ å¯ä»¥è¯´ç”¨ hessian åºåˆ—åŒ–åè®®äº†ï¼Œæˆ–è€…æ˜¯åˆ«çš„ï¼Œå¯¹å§ã€‚ç„¶åŽè¯·æ±‚è¿‡åŽ»äº†ã€‚ æœåŠ¡å™¨é‚£è¾¹ä¸€æ ·çš„ï¼Œéœ€è¦é’ˆå¯¹ä½ è‡ªå·±çš„æœåŠ¡ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œç›‘å¬æŸä¸ªç½‘ç»œç«¯å£äº†ï¼Œç„¶åŽä»£ç†ä½ æœ¬åœ°çš„æœåŠ¡ä»£ç ã€‚æŽ¥æ”¶åˆ°è¯·æ±‚çš„æ—¶å€™ï¼Œå°±è°ƒç”¨å¯¹åº”çš„æœåŠ¡ä»£ç ï¼Œå¯¹å§ã€‚ è¿™å°±æ˜¯ä¸€ä¸ªæœ€æœ€åŸºæœ¬çš„ rpc æ¡†æž¶çš„æ€è·¯ï¼Œå…ˆä¸è¯´ä½ æœ‰å¤šç‰›é€¼çš„æŠ€æœ¯åŠŸåº•ï¼Œå“ªæ€•è¿™ä¸ªæœ€ç®€å•çš„æ€è·¯ä½ å…ˆç»™å‡ºæ¥è¡Œä¸è¡Œï¼Ÿ å¦‚æžœä¸Šè¿°æè¿°ï¼Œèƒ–å‹çœ‹çš„æ¯”è¾ƒé—·é€¼ï¼Œå¯ä»¥é˜…è¯»ä¸‹å¾å¦ˆå†™çš„ ã€Šç®€å•äº†è§£ RPC å®žçŽ°åŽŸç†ã€‹ ï¼Œè‡ªå·±åŠ¨æ‰‹æ’¸ä¸€ä¸ªæœ€æœ€æœ€åŸºç¡€çš„ RPC é€šä¿¡çš„è¿‡ç¨‹ã€‚ å› ä¸º Dubbo å®žçŽ°äº†å¤§é‡çš„æŠ½è±¡ï¼Œå¹¶ä¸”æä¾›äº†å¤šç§ä»£ç å®žçŽ°ï¼Œä»¥åŠå¤§é‡çš„ RPC ç‰¹æ€§ï¼Œæ‰€ä»¥ä»£ç é‡ä¼šç›¸å¯¹è¾ƒå¤šã€‚ å¦‚æžœèƒ–å‹æ˜¯è‡ªå·±å®žçŽ°ä¸€ä¸ªæœ€å°åŒ–çš„ PRC æ¡†æž¶ï¼Œå¯èƒ½ä»£ç é‡ä¼šæ¯”æƒ³è±¡ä¸­çš„å°‘å¾ˆå¤šï¼Œå¯èƒ½å‡ åƒè¡Œä»£ç å°±å¤Ÿäº†ã€‚å¼ºçƒˆæŽ¨èï¼Œèƒ–å‹è‡ªå·±æ’¸èµ·è¢–å­ï¼ŒåŠ¨èµ·æ‰‹æ¥ã€‚ä»Žæ­¤ä¹‹åŽï¼Œä½ ä¼šå¯¹ RPC æ¡†æž¶ï¼Œæœ‰æ›´æ·±å…¥çš„ç†è§£ã€‚ å…¶ä»–é—®é¢˜å½“ç„¶ï¼ŒDubbo è¿˜æœ‰å¾ˆå¤šéžå¸¸ç»†èŠ‚ï¼Œç”šè‡³ç‰µæ‰¯åˆ°æºç çš„é—®é¢˜ï¼Œè‰¿è‰¿å¹¶æœªå…¨éƒ¨åˆ—åˆ—ä¸¾ã€‚å¦‚ä¸‹çš„é—®é¢˜ï¼Œéœ€è¦èƒ–å‹è‡ªå·±åŽ»è€å¿ƒçœ‹æºç ï¼Œæ€è€ƒç­”æ¡ˆã€‚ Dubbo æœåŠ¡å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œåšäº†å“ªäº›äº‹ï¼Ÿ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æœåŠ¡æš´éœ²ï¼ˆä¸€ï¼‰ä¹‹æœ¬åœ°æš´éœ²ï¼ˆInjvmï¼‰ã€‹ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æœåŠ¡æš´éœ²ï¼ˆäºŒï¼‰ä¹‹è¿œç¨‹æš´éœ²ï¼ˆDubboï¼‰ã€‹ Dubbo æœåŠ¡å¼•ç”¨è¿‡ç¨‹ä¸­ï¼Œåšäº†å“ªäº›äº‹ï¼Ÿ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æœåŠ¡å¼•ç”¨ï¼ˆä¸€ï¼‰ä¹‹æœ¬åœ°å¼•ç”¨ï¼ˆInjvmï¼‰ã€‹ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æœåŠ¡å¼•ç”¨ï¼ˆäºŒï¼‰ä¹‹è¿œç¨‹å¼•ç”¨ï¼ˆDubboï¼‰ã€‹ Dubbo ç®¡ç†å¹³å°èƒ½å¤ŸåŠ¨æ€æ”¹å˜æŽ¥å£çš„ä¸€äº›é…ç½®ï¼Œå…¶åŽŸç†æ˜¯æ€Žæ ·çš„? è·¯ç”±è§„åˆ™ ã€Šç²¾å°½ Dubbo æºç è§£æž â€”â€” é›†ç¾¤å®¹é”™ï¼ˆä¸ƒï¼‰ä¹‹ Router å®žçŽ°ã€‹ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” è·¯ç”±è§„åˆ™ã€‹ é…ç½®è§„åˆ™ ã€Šç²¾å°½ Dubbo æºç è§£æž â€”â€” é›†ç¾¤å®¹é”™ï¼ˆå…­ï¼‰ä¹‹ Configurator å®žçŽ°ã€‹ ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” é…ç½®è§„åˆ™ã€‹ åœ¨ Dubbo ä¸­ï¼Œä»€ä¹ˆæ—¶å€™æ›´æ–°æœ¬åœ°çš„ Zookeeper ä¿¡æ¯ç¼“å­˜æ–‡ä»¶ï¼Ÿè®¢é˜…Zookeeper ä¿¡æ¯çš„æ•´ä½“è¿‡ç¨‹æ˜¯æ€Žä¹ˆæ ·çš„? ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æ³¨å†Œä¸­å¿ƒï¼ˆä¸€ï¼‰ä¹‹æŠ½è±¡ APIã€‹ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” æ³¨å†Œä¸­å¿ƒï¼ˆäºŒï¼‰ä¹‹ Zookeeperã€‹ æœ€å°æ´»è·ƒæ•°ç®—æ³•ä¸­æ˜¯å¦‚ä½•ç»Ÿè®¡è¿™ä¸ªæ´»è·ƒæ•°çš„ï¼Ÿ ã€Šç²¾å°½ Dubbo æºç åˆ†æž â€”â€” è¿‡æ»¤å™¨ï¼ˆå››ï¼‰ä¹‹ ActiveLimitFilter &amp;&amp; ExecuteLimitFilterã€‹ ï¼Œä¸»è¦ ã€Œ2. 2. RpcStatusã€ å’Œ ã€Œ3. ActiveLimitFilterã€ éƒ¨åˆ†ã€‚ ã€Šç²¾å°½ Dubbo æºç è§£æž â€”â€” é›†ç¾¤å®¹é”™ï¼ˆå››ï¼‰ä¹‹ LoadBalance å®žçŽ°ã€‹ ï¼Œä¸»è¦ ã€Œ6. LeastActiveLoadBalanceã€ éƒ¨åˆ†ã€‚ ç®€å•è°ˆè°ˆä½ å¯¹ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„è®¤è¯†ï¼Ÿ ã€Šç²¾å°½ Dubbo æºç è§£æž â€”â€” é›†ç¾¤å®¹é”™ï¼ˆå››ï¼‰ä¹‹ LoadBalance å®žçŽ°ã€‹ ï¼Œä¸»è¦ ã€Œ7. ConsistentHashSelectorã€ éƒ¨åˆ†ã€‚ å…³äºŽä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨ç¼“å­˜ä¸­çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¼šå•ç‹¬åœ¨ç¼“å­˜ç›¸å…³çš„é¢è¯•é¢˜ä¸­åˆ†äº«ã€‚ 666. å½©è›‹åœ¨çœ‹åˆ°æ­¤å¤„ï¼Œèƒ–å‹æœ‰æ²¡å‘çŽ°ï¼Œåœ¨å®žé™…é¢è¯•çš„ Dubbo é—®é¢˜ä¸­ï¼ŒDubbo å®˜æ–¹æ–‡æ¡£å·²ç»ç»™äº†æˆ‘ä»¬å¾ˆå¤šç­”æ¡ˆã€‚è¿™è¯´æ˜Žä»€ä¹ˆå‘¢ï¼Ÿä¸€å®šä¸€å®šä¸€å®šè¦è®¤çœŸç ”è¯»å®˜æ–¹æä¾›çš„çŸ¥è¯†ï¼Œæ¯•ç«Ÿï¼Œè¿™æ˜¯æœ€ç³»ç»Ÿï¼Œä¸”ç¬¬ä¸€æ‰‹çš„èµ„æ–™ã€‚ å¦‚æžœèƒ–å‹æƒ³å¯¹ RPC æœ‰ä¸€ä¸ªæ•´ä½“çš„ç†è§£ï¼ŒæŽ¨èçœ‹çœ‹å¾å¦ˆçš„è¿™å¥—æ–‡ç« ã€Šæ·±å…¥ç†è§£ RPC ç³»åˆ—ã€‹ï¼š ã€Šç®€å•äº†è§£ RPC å®žçŽ°åŽŸç†ã€‹ ã€Šæ·±å…¥ç†è§£ RPC ä¹‹åºåˆ—åŒ–ç¯‡ â€“ Kryoã€‹ ã€Šæ·±å…¥ç†è§£ RPC ä¹‹åºåˆ—åŒ–ç¯‡ â€“ æ€»ç»“ç¯‡ã€‹ ã€Šæ·±å…¥ç†è§£ RPC ä¹‹åŠ¨æ€ä»£ç†ç¯‡ã€‹ ã€Šæ·±å…¥ç†è§£ RPC ä¹‹ä¼ è¾“ç¯‡ã€‹ ã€ŠMotan ä¸­ä½¿ç”¨å¼‚æ­¥ RPC æŽ¥å£ã€‹ ã€Šæ·±å…¥ç†è§£ RPC ä¹‹åè®®ç¯‡ã€‹ ã€Šæ·±å…¥ç†è§£RPCä¹‹æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°ç¯‡ã€‹ ã€Šæ·±å…¥ç†è§£ RPC ä¹‹é›†ç¾¤ç¯‡ã€‹ ã€Šã€åƒç±³ç½‘ã€‘ä»Žè·¨è¯­è¨€è°ƒç”¨åˆ° dubbo2.jsã€‹ ã€Šå¤©æ± ä¸­é—´ä»¶å¤§èµ› Dubbo Mesh ä¼˜åŒ–æ€»ç»“ï¼ˆQPS ä»Ž 1000 åˆ° 6850ï¼‰ã€‹ å‚è€ƒä¸ŽæŽ¨èå¦‚ä¸‹æ–‡ç« ï¼š ã€ŠDubbo ç”¨æˆ·æŒ‡å—ã€‹ å¿…é€‰ã€‚ ã€ŠDubbo å¼€å‘æŒ‡å—ã€‹ è¿›é˜¶ã€‚ ã€ŠDubbo è¿ç»´ç®¡ç†ã€‹ å¯é€‰ã€‚ ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿäº’æ–¥æ€§ä¸Žå¹‚ç­‰æ€§é—®é¢˜çš„åˆ†æžä¸Žè§£å†³ã€‹ é»‘é©¬ç¨‹åºå‘˜ ã€Šã€ä¸Šæµ·æ ¡åŒºã€‘æ•´ç†çš„ Dubbo é¢è¯•é¢˜ã€‹ ç¾Žå›¢ ã€Šè¯´ä¸€ä¸‹ Dubbo çš„å·¥ä½œåŽŸç†ï¼Ÿæ³¨å†Œä¸­å¿ƒæŒ‚äº†å¯ä»¥ç»§ç»­é€šä¿¡å—ï¼Ÿã€‹ lijiaccy ã€ŠJava é¢è¯•ä¹‹ Dubboã€‹ Java çŸ¥éŸ³ Dubbo é¢è¯•é¢˜ ã€ŠDubbo æ”¯æŒå“ªäº›åºåˆ—åŒ–åè®®ï¼Ÿè¯´ä¸€ä¸‹ Hessian çš„æ•°æ®ç»“æž„ï¼ŸPB çŸ¥é“å—ï¼Ÿä¸ºä»€ä¹ˆ PB çš„æ•ˆçŽ‡æ˜¯æœ€é«˜çš„ï¼Ÿã€‹ ã€ŠDubbo çš„ SPI æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿã€‹ ã€Šå¦‚ä½•åŸºäºŽ Dubbo è¿›è¡ŒæœåŠ¡æ²»ç†ã€æœåŠ¡é™çº§ã€å¤±è´¥é‡è¯•ä»¥åŠè¶…æ—¶é‡è¯•ï¼Ÿã€‹ ã€Šåˆ†å¸ƒå¼æœåŠ¡æŽ¥å£çš„å¹‚ç­‰æ€§å¦‚ä½•è®¾è®¡ï¼ˆæ¯”å¦‚ä¸èƒ½é‡å¤æ‰£æ¬¾ï¼‰ï¼Ÿã€‹ ã€Šä¸ºä»€ä¹ˆè¦è¿›è¡Œç³»ç»Ÿæ‹†åˆ†ï¼Ÿå¦‚ä½•è¿›è¡Œç³»ç»Ÿæ‹†åˆ†ï¼Ÿæ‹†åˆ†åŽä¸ç”¨ Dubbo å¯ä»¥å—ï¼Ÿã€‹ ã€Šå¦‚ä½•è‡ªå·±è®¾è®¡ä¸€ä¸ªç±»ä¼¼ Dubbo çš„ rpc æ¡†æž¶ï¼Ÿã€‹]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç²¾å°½ Dubbo å­¦ä¹ æŒ‡å—]]></title>
    <url>%2F2019%2F02%2F11%2F%E7%B2%BE%E5%B0%BD-Dubbo-%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97%2F</url>
    <content type="text"><![CDATA[è§†é¢‘ å°šç¡…è°· ã€Šå°šç¡…è°· Java è§†é¢‘æ•™ç¨‹_Dubboã€‹ ä¸€å…±æœ‰ 30P ã€‚ åŠ¨åŠ›èŠ‚ç‚¹ ã€ŠJava è§†é¢‘æ•™ç¨‹ä¹‹ Dubbo è§†é¢‘æ•™ç¨‹ã€‹ ä¹¦ç±æš‚æ— ä¹¦ç± TODO èŠ‹è‰¿ï¼Œç­‰å¾…è¶…å“¥çš„ä¹¦å‡ºç‰ˆ æ–‡ç« éžå¸¸é‡è¦ï¼Œä¸€å®šä¸€å®šä¸€å®šè®¤çœŸçœ‹å®˜æ–¹æ–‡æ¡£ ã€ŠDubbo ç”¨æˆ·æŒ‡å—ã€‹ å¿…é€‰ã€‚ ã€ŠDubbo å¼€å‘æŒ‡å—ã€‹ è¿›é˜¶ã€‚ ã€ŠDubbo è¿ç»´ç®¡ç†ã€‹ å¯é€‰ã€‚ åœ¨æ•´ç†ä¸€äº›ï¼Œdubbo å®žæˆ˜çš„æ–‡ç«  ä½¿ç”¨ SkyWalking ä½œä¸º Dubbo çš„é“¾è·¯è¿½è¸ªï¼Œæ˜¯éžå¸¸æŽ¨èçš„ï¼Œå…·ä½“å¯ä»¥å‚è€ƒï¼š å¼ é‘« ã€Šä½¿ç”¨ Apache Skywalking (Incubator) åšåˆ†å¸ƒå¼è·Ÿè¸ªã€‹ å¦‚æžœä½ æƒ³å‚ä¸Žåˆ° Dubbo çš„å¼€å‘ä¹‹ä¸­ï¼Œå¦‚ä¸‹ä¸¤ç¯‡æ–‡ç« ç»™äº†æˆ‘ä»¬å¾ˆä¸é”™çš„æŒ‡å¼•ï¼š å¾å¦ˆ ã€Šä»¥ Dubbo ä¸ºä¾‹ï¼ŒèŠèŠå¦‚ä½•å‘å¼€æºé¡¹ç›®åšè´¡çŒ®ã€‹ jerrick ã€Šå¦‚ä½•å‚ä¸Žè´¡çŒ® Dubbo ç¤¾åŒºã€‹ å¦‚æžœä½ å¯¹ Dubbo æ˜¯æ€Žä¹ˆåšä¸€æ¬¡ç‰ˆæœ¬çš„å‘å¸ƒ Release ï¼Œå¯ä»¥å‚è§ï¼š Jun Liu ã€Šå¦‚ä½•å‡†å¤‡ Apache Releaseã€‹]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€æ­»ç£• Springã€‘â€”â€” IoC ä¹‹ Spring ç»Ÿä¸€èµ„æºåŠ è½½ç­–ç•¥]]></title>
    <url>%2F2019%2F02%2F11%2F%E3%80%90%E6%AD%BB%E7%A3%95-Spring%E3%80%91%E2%80%94%E2%80%94-IoC-%E4%B9%8B-Spring-%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è¦åŸºäºŽ Spring 5.0.6.RELEASE æ‘˜è¦: åŽŸåˆ›å‡ºå¤„ http://cmsblogs.com/?p=2656 ã€Œå°æ˜Žå“¥ã€ï¼Œè°¢è°¢ï¼ ä½œä¸ºã€Œå°æ˜Žå“¥ã€çš„å¿ å®žè¯»è€…ï¼Œã€Œè€è‰¿è‰¿ã€ç•¥ä½œä¿®æ”¹ï¼Œè®°å½•åœ¨ç†è§£è¿‡ç¨‹ä¸­ï¼Œå‚è€ƒçš„èµ„æ–™ã€‚ åœ¨å­¦ Java SE çš„æ—¶å€™ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä¸€ä¸ªæ ‡å‡†ç±» java.net.URLï¼Œè¯¥ç±»åœ¨ Java SE ä¸­çš„å®šä½ä¸ºç»Ÿä¸€èµ„æºå®šä½å™¨ï¼ˆUniform Resource Locatorï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å®ƒçš„å®žçŽ°åŸºæœ¬åªé™äºŽç½‘ç»œå½¢å¼å‘å¸ƒçš„èµ„æºçš„æŸ¥æ‰¾å’Œå®šä½ã€‚ç„¶è€Œï¼Œå®žé™…ä¸Šèµ„æºçš„å®šä¹‰æ¯”è¾ƒå¹¿æ³›ï¼Œé™¤äº†ç½‘ç»œå½¢å¼çš„èµ„æºï¼Œè¿˜æœ‰ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜åœ¨çš„ã€ä»¥æ–‡ä»¶å½¢å¼å­˜åœ¨çš„ã€ä»¥å­—èŠ‚æµå½¢å¼å­˜åœ¨çš„ç­‰ç­‰ã€‚è€Œä¸”å®ƒå¯ä»¥å­˜åœ¨äºŽä»»ä½•åœºæ‰€ï¼Œæ¯”å¦‚ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿã€åº”ç”¨ç¨‹åºä¸­ã€‚æ‰€ä»¥ java.net.URL çš„å±€é™æ€§è¿«ä½¿ Spring å¿…é¡»å®žçŽ°è‡ªå·±çš„èµ„æºåŠ è½½ç­–ç•¥ï¼Œè¯¥èµ„æºåŠ è½½ç­–ç•¥éœ€è¦æ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼š èŒèƒ½åˆ’åˆ†æ¸…æ¥šã€‚èµ„æºçš„å®šä¹‰å’Œèµ„æºçš„åŠ è½½åº”è¯¥è¦æœ‰ä¸€ä¸ªæ¸…æ™°çš„ç•Œé™ï¼› ç»Ÿä¸€çš„æŠ½è±¡ã€‚ç»Ÿä¸€çš„èµ„æºå®šä¹‰å’Œèµ„æºåŠ è½½ç­–ç•¥ã€‚èµ„æºåŠ è½½åŽè¦è¿”å›žç»Ÿä¸€çš„æŠ½è±¡ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¦å¯¹èµ„æºè¿›è¡Œæ€Žæ ·çš„å¤„ç†ï¼Œåº”è¯¥ç”±æŠ½è±¡èµ„æºæŽ¥å£æ¥ç•Œå®šã€‚ 1. ç»Ÿä¸€èµ„æºï¼šResourceorg.springframework.core.io.Resource ä¸º Spring æ¡†æž¶æ‰€æœ‰èµ„æºçš„æŠ½è±¡å’Œè®¿é—®æŽ¥å£ï¼Œå®ƒç»§æ‰¿ org.springframework.core.io.InputStreamSourceæŽ¥å£ã€‚ä½œä¸ºæ‰€æœ‰èµ„æºçš„ç»Ÿä¸€æŠ½è±¡ï¼ŒResource å®šä¹‰äº†ä¸€äº›é€šç”¨çš„æ–¹æ³•ï¼Œç”±å­ç±» AbstractResource æä¾›ç»Ÿä¸€çš„é»˜è®¤å®žçŽ°ã€‚å®šä¹‰å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677public interface Resource extends InputStreamSource &#123; /** * èµ„æºæ˜¯å¦å­˜åœ¨ */ boolean exists(); /** * èµ„æºæ˜¯å¦å¯è¯» */ default boolean isReadable() &#123; return true; &#125; /** * èµ„æºæ‰€ä»£è¡¨çš„å¥æŸ„æ˜¯å¦è¢«ä¸€ä¸ª stream æ‰“å¼€äº† */ default boolean isOpen() &#123; return false; &#125; /** * æ˜¯å¦ä¸º File */ default boolean isFile() &#123; return false; &#125; /** * è¿”å›žèµ„æºçš„ URL çš„å¥æŸ„ */ URL getURL() throws IOException; /** * è¿”å›žèµ„æºçš„ URI çš„å¥æŸ„ */ URI getURI() throws IOException; /** * è¿”å›žèµ„æºçš„ File çš„å¥æŸ„ */ File getFile() throws IOException; /** * è¿”å›ž ReadableByteChannel */ default ReadableByteChannel readableChannel() throws IOException &#123; return java.nio.channels.Channels.newChannel(getInputStream()); &#125; /** * èµ„æºå†…å®¹çš„é•¿åº¦ */ long contentLength() throws IOException; /** * èµ„æºæœ€åŽçš„ä¿®æ”¹æ—¶é—´ */ long lastModified() throws IOException; /** * æ ¹æ®èµ„æºçš„ç›¸å¯¹è·¯å¾„åˆ›å»ºæ–°èµ„æº */ Resource createRelative(String relativePath) throws IOException; /** * èµ„æºçš„æ–‡ä»¶å */ @Nullable String getFilename(); /** * èµ„æºçš„æè¿° */ String getDescription();&#125; 1.1 å­ç±»ç»“æž„ç±»ç»“æž„å›¾å¦‚ä¸‹ï¼š ä»Žä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒResource æ ¹æ®èµ„æºçš„ä¸åŒç±»åž‹æä¾›ä¸åŒçš„å…·ä½“å®žçŽ°ï¼Œå¦‚ä¸‹ï¼š FileSystemResource ï¼šå¯¹ java.io.File ç±»åž‹èµ„æºçš„å°è£…ï¼Œåªè¦æ˜¯è·Ÿ File æ‰“äº¤é“çš„ï¼ŒåŸºæœ¬ä¸Šä¸Ž FileSystemResource ä¹Ÿå¯ä»¥æ‰“äº¤é“ã€‚æ”¯æŒæ–‡ä»¶å’Œ URL çš„å½¢å¼ï¼Œå®žçŽ° WritableResource æŽ¥å£ï¼Œä¸”ä»Ž Spring Framework 5.0 å¼€å§‹ï¼ŒFileSystemResource ä½¿ç”¨ NIO2 APIè¿›è¡Œè¯»/å†™äº¤äº’ã€‚ ByteArrayResource ï¼šå¯¹å­—èŠ‚æ•°ç»„æä¾›çš„æ•°æ®çš„å°è£…ã€‚å¦‚æžœé€šè¿‡ InputStream å½¢å¼è®¿é—®è¯¥ç±»åž‹çš„èµ„æºï¼Œè¯¥å®žçŽ°ä¼šæ ¹æ®å­—èŠ‚æ•°ç»„çš„æ•°æ®æž„é€ ä¸€ä¸ªç›¸åº”çš„ ByteArrayInputStreamã€‚ UrlResource ï¼šå¯¹ java.net.URLç±»åž‹èµ„æºçš„å°è£…ã€‚å†…éƒ¨å§”æ´¾ URL è¿›è¡Œå…·ä½“çš„èµ„æºæ“ä½œã€‚ ClassPathResource ï¼šclass path ç±»åž‹èµ„æºçš„å®žçŽ°ã€‚ä½¿ç”¨ç»™å®šçš„ ClassLoader æˆ–è€…ç»™å®šçš„ Class æ¥åŠ è½½èµ„æºã€‚ InputStreamResource ï¼šå°†ç»™å®šçš„ InputStream ä½œä¸ºä¸€ç§èµ„æºçš„ Resource çš„å®žçŽ°ç±»ã€‚ 1.2 AbstractResourceorg.springframework.core.io.AbstractResource ï¼Œä¸º Resource æŽ¥å£çš„é»˜è®¤æŠ½è±¡å®žçŽ°ã€‚å®ƒå®žçŽ°äº† Resource æŽ¥å£çš„å¤§éƒ¨åˆ†çš„å…¬å…±å®žçŽ°ï¼Œä½œä¸º Resource æŽ¥å£ä¸­çš„é‡ä¸­ä¹‹é‡ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164public abstract class AbstractResource implements Resource &#123; /** * åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥åˆ¤æ–­è¿‡ç¨‹äº§ç”Ÿå¼‚å¸¸ï¼ˆå› ä¸ºä¼šè°ƒç”¨SecurityManageræ¥åˆ¤æ–­ï¼‰ï¼Œå°±å…³é—­å¯¹åº”çš„æµ */ @Override public boolean exists() &#123; try &#123; // åŸºäºŽ File è¿›è¡Œåˆ¤æ–­ return getFile().exists(); &#125; catch (IOException ex) &#123; // Fall back to stream existence: can we open the stream? // åŸºäºŽ InputStream è¿›è¡Œåˆ¤æ–­ try &#123; InputStream is = getInputStream(); is.close(); return true; &#125; catch (Throwable isEx) &#123; return false; &#125; &#125; &#125; /** * ç›´æŽ¥è¿”å›žtrueï¼Œè¡¨ç¤ºå¯è¯» */ @Override public boolean isReadable() &#123; return true; &#125; /** * ç›´æŽ¥è¿”å›ž falseï¼Œè¡¨ç¤ºæœªè¢«æ‰“å¼€ */ @Override public boolean isOpen() &#123; return false; &#125; /** * ç›´æŽ¥è¿”å›žfalseï¼Œè¡¨ç¤ºä¸ä¸º File */ @Override public boolean isFile() &#123; return false; &#125; /** * æŠ›å‡º FileNotFoundException å¼‚å¸¸ï¼Œäº¤ç»™å­ç±»å®žçŽ° */ @Override public URL getURL() throws IOException &#123; throw new FileNotFoundException(getDescription() + " cannot be resolved to URL"); &#125; /** * åŸºäºŽ getURL() è¿”å›žçš„ URL æž„å»º URI */ @Override public URI getURI() throws IOException &#123; URL url = getURL(); try &#123; return ResourceUtils.toURI(url); &#125; catch (URISyntaxException ex) &#123; throw new NestedIOException("Invalid URI [" + url + "]", ex); &#125; &#125; /** * æŠ›å‡º FileNotFoundException å¼‚å¸¸ï¼Œäº¤ç»™å­ç±»å®žçŽ° */ @Override public File getFile() throws IOException &#123; throw new FileNotFoundException(getDescription() + " cannot be resolved to absolute file path"); &#125; /** * æ ¹æ® getInputStream() çš„è¿”å›žç»“æžœæž„å»º ReadableByteChannel */ @Override public ReadableByteChannel readableChannel() throws IOException &#123; return Channels.newChannel(getInputStream()); &#125; /** * èŽ·å–èµ„æºçš„é•¿åº¦ * * è¿™ä¸ªèµ„æºå†…å®¹é•¿åº¦å®žé™…å°±æ˜¯èµ„æºçš„å­—èŠ‚é•¿åº¦ï¼Œé€šè¿‡å…¨éƒ¨è¯»å–ä¸€éæ¥åˆ¤æ–­ */ @Override public long contentLength() throws IOException &#123; InputStream is = getInputStream(); try &#123; long size = 0; byte[] buf = new byte[255]; // æ¯æ¬¡æœ€å¤šè¯»å– 255 å­—èŠ‚ int read; while ((read = is.read(buf)) != -1) &#123; size += read; &#125; return size; &#125; finally &#123; try &#123; is.close(); &#125; catch (IOException ex) &#123; &#125; &#125; &#125; /** * è¿”å›žèµ„æºæœ€åŽçš„ä¿®æ”¹æ—¶é—´ */ @Override public long lastModified() throws IOException &#123; long lastModified = getFileForLastModifiedCheck().lastModified(); if (lastModified == 0L) &#123; throw new FileNotFoundException(getDescription() + " cannot be resolved in the file system for resolving its last-modified timestamp"); &#125; return lastModified; &#125; protected File getFileForLastModifiedCheck() throws IOException &#123; return getFile(); &#125; /** * æŠ›å‡º FileNotFoundException å¼‚å¸¸ï¼Œäº¤ç»™å­ç±»å®žçŽ° */ @Override public Resource createRelative(String relativePath) throws IOException &#123; throw new FileNotFoundException("Cannot create a relative resource for " + getDescription()); &#125; /** * èŽ·å–èµ„æºåç§°ï¼Œé»˜è®¤è¿”å›ž null ï¼Œäº¤ç»™å­ç±»å®žçŽ° */ @Override @Nullable public String getFilename() &#123; return null; &#125; /** * è¿”å›žèµ„æºçš„æè¿° */ @Override public String toString() &#123; return getDescription(); &#125; @Override public boolean equals(Object obj) &#123; return (obj == this || (obj instanceof Resource &amp;&amp; ((Resource) obj).getDescription().equals(getDescription()))); &#125; @Override public int hashCode() &#123; return getDescription().hashCode(); &#125;&#125; å¦‚æžœæˆ‘ä»¬æƒ³è¦å®žçŽ°è‡ªå®šä¹‰çš„ Resource ï¼Œè®°ä½ä¸è¦å®žçŽ° Resource æŽ¥å£ï¼Œè€Œåº”è¯¥ç»§æ‰¿ AbstractResource æŠ½è±¡ç±»ï¼Œç„¶åŽæ ¹æ®å½“å‰çš„å…·ä½“èµ„æºç‰¹æ€§è¦†ç›–ç›¸åº”çš„æ–¹æ³•å³å¯ã€‚ 1.3 å…¶ä»–å­ç±» æ¥è‡ªè‰¿è‰¿ Resource çš„å­ç±»ï¼Œä¾‹å¦‚ FileSystemResourceã€ByteArrayResource ç­‰ç­‰çš„ä»£ç éžå¸¸ç®€å•ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œè‡ªå·±åŽ»ç ”ç©¶ã€‚ 2. ç»Ÿä¸€èµ„æºå®šä½ï¼šResourceLoaderä¸€å¼€å§‹å°±è¯´äº† Spring å°†èµ„æºçš„å®šä¹‰å’Œèµ„æºçš„åŠ è½½åŒºåˆ†å¼€äº†ï¼ŒResource å®šä¹‰äº†ç»Ÿä¸€çš„èµ„æºï¼Œé‚£èµ„æºçš„åŠ è½½åˆ™ç”± ResourceLoader æ¥ç»Ÿä¸€å®šä¹‰ã€‚ org.springframework.core.io.ResourceLoader ä¸º Spring èµ„æºåŠ è½½çš„ç»Ÿä¸€æŠ½è±¡ï¼Œå…·ä½“çš„èµ„æºåŠ è½½åˆ™ç”±ç›¸åº”çš„å®žçŽ°ç±»æ¥å®Œæˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°† ResourceLoader ç§°ä½œä¸ºç»Ÿä¸€èµ„æºå®šä½å™¨ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š FROM ã€ŠSpring æºç æ·±åº¦è§£æžã€‹P16 é¡µ ResourceLoaderï¼Œå®šä¹‰èµ„æºåŠ è½½å™¨ï¼Œä¸»è¦åº”ç”¨äºŽæ ¹æ®ç»™å®šçš„èµ„æºæ–‡ä»¶åœ°å€ï¼Œè¿”å›žå¯¹åº”çš„ Resource ã€‚ 123456789public interface ResourceLoader &#123; String CLASSPATH_URL_PREFIX = ResourceUtils.CLASSPATH_URL_PREFIX; // CLASSPATH URL å‰ç¼€ã€‚é»˜è®¤ä¸ºï¼š"classpath:" Resource getResource(String location); ClassLoader getClassLoader();&#125; 1#getResource(String location) æ–¹æ³•ï¼Œæ ¹æ®æ‰€æä¾›èµ„æºçš„è·¯å¾„ location è¿”å›ž Resource å®žä¾‹ï¼Œä½†æ˜¯å®ƒä¸ç¡®ä¿è¯¥ Resource ä¸€å®šå­˜åœ¨ï¼Œéœ€è¦è°ƒç”¨ 1Resource#exist() æ–¹æ³•æ¥åˆ¤æ–­ã€‚ è¯¥æ–¹æ³•æ”¯æŒä»¥ä¸‹æ¨¡å¼çš„èµ„æºåŠ è½½ï¼š URLä½ç½®èµ„æºï¼Œå¦‚ &quot;file:C:/test.dat&quot; ã€‚ ClassPathä½ç½®èµ„æºï¼Œå¦‚ &quot;classpath:test.dat ã€‚ ç›¸å¯¹è·¯å¾„èµ„æºï¼Œå¦‚ &quot;WEB-INF/test.dat&quot; ï¼Œæ­¤æ—¶è¿”å›žçš„Resource å®žä¾‹ï¼Œæ ¹æ®å®žçŽ°ä¸åŒè€Œä¸åŒã€‚ è¯¥æ–¹æ³•çš„ä¸»è¦å®žçŽ°æ˜¯åœ¨å…¶å­ç±» DefaultResourceLoader ä¸­å®žçŽ°ï¼Œå…·ä½“è¿‡ç¨‹æˆ‘ä»¬åœ¨åˆ†æž DefaultResourceLoader æ—¶åšè¯¦ç»†è¯´æ˜Žã€‚ #getClassLoader() æ–¹æ³•ï¼Œè¿”å›ž ClassLoader å®žä¾‹ï¼Œå¯¹äºŽæƒ³è¦èŽ·å– ResourceLoader ä½¿ç”¨çš„ ClassLoader ç”¨æˆ·æ¥è¯´ï¼Œå¯ä»¥ç›´æŽ¥è°ƒç”¨è¯¥æ–¹æ³•æ¥èŽ·å–ã€‚åœ¨åˆ†æž Resource æ—¶ï¼Œæåˆ°äº†ä¸€ä¸ªç±» ClassPathResource ï¼Œè¿™ä¸ªç±»æ˜¯å¯ä»¥æ ¹æ®æŒ‡å®šçš„ ClassLoader æ¥åŠ è½½èµ„æºçš„ã€‚ 2.1 å­ç±»ç»“æž„ä½œä¸º Spring ç»Ÿä¸€çš„èµ„æºåŠ è½½å™¨ï¼Œå®ƒæä¾›äº†ç»Ÿä¸€çš„æŠ½è±¡ï¼Œå…·ä½“çš„å®žçŽ°åˆ™ç”±ç›¸åº”çš„å­ç±»æ¥è´Ÿè´£å®žçŽ°ï¼Œå…¶ç±»çš„ç±»ç»“æž„å›¾å¦‚ä¸‹ï¼š 2.1 DefaultResourceLoaderä¸Ž DefaultResource ç›¸ä¼¼ï¼Œorg.springframework.core.io.DefaultResourceLoader æ˜¯ ResourceLoader çš„é»˜è®¤å®žçŽ°ã€‚ 2.1.1 æž„é€ å‡½æ•°å®ƒæŽ¥æ”¶ ClassLoader ä½œä¸ºæž„é€ å‡½æ•°çš„å‚æ•°ï¼Œæˆ–è€…ä½¿ç”¨ä¸å¸¦å‚æ•°çš„æž„é€ å‡½æ•°ã€‚ åœ¨ä½¿ç”¨ä¸å¸¦å‚æ•°çš„æž„é€ å‡½æ•°æ—¶ï¼Œä½¿ç”¨çš„ ClassLoader ä¸ºé»˜è®¤çš„ ClassLoaderï¼ˆä¸€èˆ¬ Thread.currentThread()#getContextClassLoader() ï¼‰ã€‚ åœ¨ä½¿ç”¨å¸¦å‚æ•°çš„æž„é€ å‡½æ•°æ—¶ï¼Œå¯ä»¥é€šè¿‡ ClassUtils#getDefaultClassLoader()èŽ·å–ã€‚ ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920@Nullableprivate ClassLoader classLoader;public DefaultResourceLoader() &#123; // æ— å‚æž„é€ å‡½æ•° this.classLoader = ClassUtils.getDefaultClassLoader();&#125;public DefaultResourceLoader(@Nullable ClassLoader classLoader) &#123; // å¸¦ ClassLoader å‚æ•°çš„æž„é€ å‡½æ•° this.classLoader = classLoader;&#125;public void setClassLoader(@Nullable ClassLoader classLoader) &#123; this.classLoader = classLoader;&#125;@Override@Nullablepublic ClassLoader getClassLoader() &#123; return (this.classLoader != null ? this.classLoader : ClassUtils.getDefaultClassLoader());&#125; å¦å¤–ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ #setClassLoader() æ–¹æ³•è¿›è¡ŒåŽç»­è®¾ç½®ã€‚ 2.1.2 getResource æ–¹æ³•ResourceLoader ä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•ä¸º #getResource(String location) ï¼Œå®ƒæ ¹æ®æä¾›çš„ location è¿”å›žç›¸åº”çš„ Resource ã€‚è€Œ DefaultResourceLoader å¯¹è¯¥æ–¹æ³•æä¾›äº†æ ¸å¿ƒå®žçŽ°ï¼ˆå› ä¸ºï¼Œå®ƒçš„ä¸¤ä¸ªå­ç±»éƒ½æ²¡æœ‰æä¾›è¦†ç›–è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥æ–­å®š ResourceLoader çš„èµ„æºåŠ è½½ç­–ç•¥å°±å°è£…åœ¨ DefaultResourceLoader ä¸­)ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132// DefaultResourceLoader.java@Overridepublic Resource getResource(String location) &#123; Assert.notNull(location, "Location must not be null"); // é¦–å…ˆï¼Œé€šè¿‡ ProtocolResolver æ¥åŠ è½½èµ„æº for (ProtocolResolver protocolResolver : this.protocolResolvers) &#123; Resource resource = protocolResolver.resolve(location, this); if (resource != null) &#123; return resource; &#125; &#125; // å…¶æ¬¡ï¼Œä»¥ / å¼€å¤´ï¼Œè¿”å›ž ClassPathContextResource ç±»åž‹çš„èµ„æº if (location.startsWith("/")) &#123; return getResourceByPath(location); // å†æ¬¡ï¼Œä»¥ classpath: å¼€å¤´ï¼Œè¿”å›ž ClassPathResource ç±»åž‹çš„èµ„æº &#125; else if (location.startsWith(CLASSPATH_URL_PREFIX)) &#123; return new ClassPathResource(location.substring(CLASSPATH_URL_PREFIX.length()), getClassLoader()); // ç„¶åŽï¼Œæ ¹æ®æ˜¯å¦ä¸ºæ–‡ä»¶ URL ï¼Œæ˜¯åˆ™è¿”å›ž FileUrlResource ç±»åž‹çš„èµ„æºï¼Œå¦åˆ™è¿”å›ž UrlResource ç±»åž‹çš„èµ„æº &#125; else &#123; try &#123; // Try to parse the location as a URL... URL url = new URL(location); return (ResourceUtils.isFileURL(url) ? new FileUrlResource(url) : new UrlResource(url)); &#125; catch (MalformedURLException ex) &#123; // æœ€åŽï¼Œè¿”å›ž ClassPathContextResource ç±»åž‹çš„èµ„æº // No URL -&gt; resolve as resource path. return getResourceByPath(location); &#125; &#125;&#125; é¦–å…ˆï¼Œé€šè¿‡ ProtocolResolver æ¥åŠ è½½èµ„æºï¼ŒæˆåŠŸè¿”å›ž Resource ã€‚ å…¶æ¬¡ï¼Œè‹¥ location ä»¥ &quot;/&quot; å¼€å¤´ï¼Œåˆ™è°ƒç”¨ #getResourceByPath() æ–¹æ³•ï¼Œæž„é€  ClassPathContextResource ç±»åž‹èµ„æºå¹¶è¿”å›žã€‚ä»£ç å¦‚ä¸‹ï¼š 123protected Resource getResourceByPath(String path) &#123; return new ClassPathContextResource(path, getClassLoader());&#125; å†æ¬¡ï¼Œè‹¥ location ä»¥ &quot;classpath:&quot; å¼€å¤´ï¼Œåˆ™æž„é€  ClassPathResource ç±»åž‹èµ„æºå¹¶è¿”å›žã€‚åœ¨æž„é€ è¯¥èµ„æºæ—¶ï¼Œé€šè¿‡ #getClassLoader() èŽ·å–å½“å‰çš„ ClassLoaderã€‚ ç„¶åŽï¼Œæž„é€  URL ï¼Œå°è¯•é€šè¿‡å®ƒè¿›è¡Œèµ„æºå®šä½ï¼Œè‹¥æ²¡æœ‰æŠ›å‡º MalformedURLException å¼‚å¸¸ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦ä¸º FileURL , å¦‚æžœæ˜¯åˆ™æž„é€  FileUrlResource ç±»åž‹çš„èµ„æºï¼Œå¦åˆ™æž„é€  UrlResource ç±»åž‹çš„èµ„æºã€‚ æœ€åŽï¼Œè‹¥åœ¨åŠ è½½è¿‡ç¨‹ä¸­æŠ›å‡º MalformedURLException å¼‚å¸¸ï¼Œåˆ™å§”æ´¾ #getResourceByPath() æ–¹æ³•ï¼Œå®žçŽ°èµ„æºå®šä½åŠ è½½ã€‚ðŸ˜ˆ å®žé™…ä¸Šï¼Œå’Œã€å…¶æ¬¡ã€‘ç›¸åŒè½ã€‚ 2.1.3 ProtocolResolverorg.springframework.core.io.ProtocolResolver ï¼Œç”¨æˆ·è‡ªå®šä¹‰åè®®èµ„æºè§£å†³ç­–ç•¥ï¼Œä½œä¸º DefaultResourceLoader çš„ SPIï¼šå®ƒå…è®¸ç”¨æˆ·è‡ªå®šä¹‰èµ„æºåŠ è½½åè®®ï¼Œè€Œä¸éœ€è¦ç»§æ‰¿ ResourceLoader çš„å­ç±»ã€‚åœ¨ä»‹ç» Resource æ—¶ï¼Œæåˆ°å¦‚æžœè¦å®žçŽ°è‡ªå®šä¹‰ Resourceï¼Œæˆ‘ä»¬åªéœ€è¦ç»§æ‰¿ DefaultResource å³å¯ï¼Œä½†æ˜¯æœ‰äº† ProtocolResolver åŽï¼Œæˆ‘ä»¬ä¸éœ€è¦ç›´æŽ¥ç»§æ‰¿ DefaultResourceLoaderï¼Œæ”¹ä¸ºå®žçŽ° ProtocolResolver æŽ¥å£ä¹Ÿå¯ä»¥å®žçŽ°è‡ªå®šä¹‰çš„ ResourceLoaderã€‚ ProtocolResolver æŽ¥å£ï¼Œä»…æœ‰ä¸€ä¸ªæ–¹æ³• Resource resolve(String location, ResourceLoader resourceLoader) ã€‚ä»£ç å¦‚ä¸‹ï¼š 12345678910111213/** * ä½¿ç”¨æŒ‡å®šçš„ ResourceLoader ï¼Œè§£æžæŒ‡å®šçš„ location ã€‚ * è‹¥æˆåŠŸï¼Œåˆ™è¿”å›žå¯¹åº”çš„ Resource ã€‚ * * Resolve the given location against the given resource loader * if this implementation's protocol matches. * @param location the user-specified resource location èµ„æºè·¯å¾„ * @param resourceLoader the associated resource loader æŒ‡å®šçš„åŠ è½½å™¨ ResourceLoader * @return a corresponding &#123;@code Resource&#125; handle if the given location * matches this resolver's protocol, or &#123;@code null&#125; otherwise è¿”å›žä¸ºç›¸åº”çš„ Resource */@NullableResource resolve(String location, ResourceLoader resourceLoader); åœ¨ Spring ä¸­ä½ ä¼šå‘çŽ°è¯¥æŽ¥å£å¹¶æ²¡æœ‰å®žçŽ°ç±»ï¼Œå®ƒéœ€è¦ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè‡ªå®šä¹‰çš„ Resolver å¦‚ä½•åŠ å…¥ Spring ä½“ç³»å‘¢ï¼Ÿè°ƒç”¨ DefaultResourceLoader#addProtocolResolver(ProtocolResolver) æ–¹æ³•å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789/** * ProtocolResolver é›†åˆ */private final Set&lt;ProtocolResolver&gt; protocolResolvers = new LinkedHashSet&lt;&gt;(4);public void addProtocolResolver(ProtocolResolver resolver) &#123; Assert.notNull(resolver, "ProtocolResolver must not be null"); this.protocolResolvers.add(resolver);&#125; 2.1.4 ç¤ºä¾‹ä¸‹é¢ç¤ºä¾‹æ˜¯æ¼”ç¤º DefaultResourceLoader åŠ è½½èµ„æºçš„å…·ä½“ç­–ç•¥ï¼Œä»£ç å¦‚ä¸‹ï¼ˆè¯¥ç¤ºä¾‹å‚è€ƒã€ŠSpring æ­ç§˜ã€‹ P89ï¼‰ï¼š 12345678910111213ResourceLoader resourceLoader = new DefaultResourceLoader();Resource fileResource1 = resourceLoader.getResource("D:/Users/chenming673/Documents/spark.txt");System.out.println("fileResource1 is FileSystemResource:" + (fileResource1 instanceof FileSystemResource));Resource fileResource2 = resourceLoader.getResource("/Users/chenming673/Documents/spark.txt");System.out.println("fileResource2 is ClassPathResource:" + (fileResource2 instanceof ClassPathResource));Resource urlResource1 = resourceLoader.getResource("file:/Users/chenming673/Documents/spark.txt");System.out.println("urlResource1 is UrlResource:" + (urlResource1 instanceof UrlResource));Resource urlResource2 = resourceLoader.getResource("http://www.baidu.com");System.out.println("urlResource1 is urlResource:" + (urlResource2 instanceof UrlResource)); è¿è¡Œç»“æžœï¼š 1234fileResource1 is FileSystemResource:falsefileResource2 is ClassPathResource:trueurlResource1 is UrlResource:trueurlResource1 is urlResource:true å…¶å®žå¯¹äºŽ fileResource1 ï¼Œæˆ‘ä»¬æ›´åŠ å¸Œæœ›æ˜¯ FileSystemResource èµ„æºç±»åž‹ã€‚ä½†æ˜¯ï¼Œäº‹ä¸Žæ„¿è¿ï¼Œå®ƒæ˜¯ ClassPathResource ç±»åž‹ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåœ¨ DefaultResourceLoader#getResource() æ–¹æ³•çš„èµ„æºåŠ è½½ç­–ç•¥ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ &quot;D:/Users/chenming673/Documents/spark.txt&quot; åœ°å€ï¼Œå…¶å®žåœ¨è¯¥æ–¹æ³•ä¸­æ²¡æœ‰ç›¸åº”çš„èµ„æºç±»åž‹ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šåœ¨æŠ›å‡º MalformedURLException å¼‚å¸¸æ—¶ï¼Œé€šè¿‡ DefaultResourceLoader#getResourceByPath(...) æ–¹æ³•ï¼Œæž„é€ ä¸€ä¸ª ClassPathResource ç±»åž‹çš„èµ„æºã€‚ è€Œ urlResource1 å’Œ urlResource2 ï¼ŒæŒ‡å®šæœ‰åè®®å‰ç¼€çš„èµ„æºè·¯å¾„ï¼Œåˆ™é€šè¿‡ URL å°±å¯ä»¥å®šä¹‰ï¼Œæ‰€ä»¥è¿”å›žçš„éƒ½æ˜¯ UrlResource ç±»åž‹ã€‚ 2.2 FileSystemResourceLoaderä»Žä¸Šé¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œå…¶å®ž DefaultResourceLoader å¯¹#getResourceByPath(String) æ–¹æ³•å¤„ç†å…¶å®žä¸æ˜¯å¾ˆæ°å½“ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ org.springframework.core.io.FileSystemResourceLoader ã€‚å®ƒç»§æ‰¿ DefaultResourceLoader ï¼Œä¸”è¦†å†™äº† #getResourceByPath(String) æ–¹æ³•ï¼Œä½¿ä¹‹ä»Žæ–‡ä»¶ç³»ç»ŸåŠ è½½èµ„æºå¹¶ä»¥ FileSystemResource ç±»åž‹è¿”å›žï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„èµ„æºç±»åž‹ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789@Overrideprotected Resource getResourceByPath(String path) &#123; // æˆªå–é¦– / if (path.startsWith("/")) &#123; path = path.substring(1); &#125; // åˆ›å»º FileSystemContextResource ç±»åž‹çš„èµ„æº return new FileSystemContextResource(path);&#125; 2.2.1 FileSystemContextResourceFileSystemContextResource ï¼Œä¸º FileSystemResourceLoader çš„å†…éƒ¨ç±»ï¼Œå®ƒç»§æ‰¿ FileSystemResource ç±»ï¼Œå®žçŽ° ContextResource æŽ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415/** * FileSystemResource that explicitly expresses a context-relative path * through implementing the ContextResource interface. */private static class FileSystemContextResource extends FileSystemResource implements ContextResource &#123; public FileSystemContextResource(String path) &#123; super(path); &#125; @Override public String getPathWithinContext() &#123; return getPath(); &#125;&#125; åœ¨æž„é€ å™¨ä¸­ï¼Œä¹Ÿæ˜¯è°ƒç”¨ FileSystemResource çš„æž„é€ å‡½æ•°æ¥æž„é€  FileSystemResource çš„ã€‚ ä¸ºä»€ä¹ˆè¦æœ‰ FileSystemContextResource ç±»çš„åŽŸå› æ˜¯ï¼Œå®žçŽ° ContextResource æŽ¥å£ï¼Œå¹¶å®žçŽ°å¯¹åº”çš„ #getPathWithinContext() æŽ¥å£æ–¹æ³•ã€‚ 2.2.2 ç¤ºä¾‹ðŸ˜ˆ åœ¨å›žè¿‡å¤´çœ‹ ã€Œ2.1.4 ç¤ºä¾‹ã€ ï¼Œå¦‚æžœå°† DefaultResourceLoader æ”¹ä¸º FileSystemContextResource ï¼Œåˆ™ fileResource1åˆ™ä¸º FileSystemResource ç±»åž‹çš„èµ„æºã€‚ 2.3 ClassRelativeResourceLoaderorg.springframework.core.io.ClassRelativeResourceLoader ï¼Œæ˜¯ DefaultResourceLoader çš„å¦ä¸€ä¸ªå­ç±»çš„å®žçŽ°ã€‚å’Œ FileSystemResourceLoader ç±»ä¼¼ï¼Œåœ¨å®žçŽ°ä»£ç çš„ç»“æž„ä¸Šç±»ä¼¼ï¼Œä¹Ÿæ˜¯è¦†å†™ #getResourceByPath(String path) æ–¹æ³•ï¼Œå¹¶è¿”å›žå…¶å¯¹åº”çš„ ClassRelativeContextResource çš„èµ„æºç±»åž‹ã€‚ æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ ã€ŠSpring5ï¼šå°±è¿™ä¸€æ¬¡ï¼Œæžå®šèµ„æºåŠ è½½å™¨ä¹‹ClassRelativeResourceLoaderã€‹ æ–‡ç« ã€‚ ClassRelativeResourceLoader æ‰©å±•çš„åŠŸèƒ½æ˜¯ï¼Œå¯ä»¥æ ¹æ®ç»™å®šçš„class æ‰€åœ¨åŒ…æˆ–è€…æ‰€åœ¨åŒ…çš„å­åŒ…ä¸‹åŠ è½½èµ„æºã€‚ 2.4 ResourcePatternResolverResourceLoader çš„ Resource getResource(String location) æ–¹æ³•ï¼Œæ¯æ¬¡åªèƒ½æ ¹æ® location è¿”å›žä¸€ä¸ª Resource ã€‚å½“éœ€è¦åŠ è½½å¤šä¸ªèµ„æºæ—¶ï¼Œæˆ‘ä»¬é™¤äº†å¤šæ¬¡è°ƒç”¨ #getResource(String location) æ–¹æ³•å¤–ï¼Œåˆ«æ— ä»–æ³•ã€‚org.springframework.core.io.support.ResourcePatternResolver æ˜¯ ResourceLoader çš„æ‰©å±•ï¼Œå®ƒæ”¯æŒæ ¹æ®æŒ‡å®šçš„èµ„æºè·¯å¾„åŒ¹é…æ¨¡å¼æ¯æ¬¡è¿”å›žå¤šä¸ª Resource å®žä¾‹ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š 1234567public interface ResourcePatternResolver extends ResourceLoader &#123; String CLASSPATH_ALL_URL_PREFIX = "classpath*:"; Resource[] getResources(String locationPattern) throws IOException;&#125; ResourcePatternResolver åœ¨ ResourceLoader çš„åŸºç¡€ä¸Šå¢žåŠ äº† #getResources(String locationPattern) æ–¹æ³•ï¼Œä»¥æ”¯æŒæ ¹æ®è·¯å¾„åŒ¹é…æ¨¡å¼è¿”å›žå¤šä¸ª Resource å®žä¾‹ã€‚ åŒæ—¶ï¼Œä¹Ÿæ–°å¢žäº†ä¸€ç§æ–°çš„åè®®å‰ç¼€ &quot;classpath*:&quot;ï¼Œè¯¥åè®®å‰ç¼€ç”±å…¶å­ç±»è´Ÿè´£å®žçŽ°ã€‚ 2.5 PathMatchingResourcePatternResolverorg.springframework.core.io.support.PathMatchingResourcePatternResolver ï¼Œä¸º ResourcePatternResolver æœ€å¸¸ç”¨çš„å­ç±»ï¼Œå®ƒé™¤äº†æ”¯æŒ ResourceLoader å’Œ ResourcePatternResolver æ–°å¢žçš„ &quot;classpath*:&quot; å‰ç¼€å¤–ï¼Œè¿˜æ”¯æŒ Ant é£Žæ ¼çš„è·¯å¾„åŒ¹é…æ¨¡å¼ï¼ˆç±»ä¼¼äºŽ &quot;**/*.xml&quot;ï¼‰ã€‚ 2.5.1 æž„é€ å‡½æ•°PathMatchingResourcePatternResolver æä¾›äº†ä¸‰ä¸ªæž„é€ å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021/** * å†…ç½®çš„ ResourceLoader èµ„æºå®šä½å™¨ */private final ResourceLoader resourceLoader;/** * Ant è·¯å¾„åŒ¹é…å™¨ */private PathMatcher pathMatcher = new AntPathMatcher();public PathMatchingResourcePatternResolver() &#123; this.resourceLoader = new DefaultResourceLoader();&#125;public PathMatchingResourcePatternResolver(ResourceLoader resourceLoader) &#123; Assert.notNull(resourceLoader, "ResourceLoader must not be null"); this.resourceLoader = resourceLoader;&#125;public PathMatchingResourcePatternResolver(@Nullable ClassLoader classLoader) &#123; this.resourceLoader = new DefaultResourceLoader(classLoader);&#125; PathMatchingResourcePatternResolver åœ¨å®žä¾‹åŒ–çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ª ResourceLoaderï¼Œå¦‚æžœä¸æŒ‡å®šçš„è¯ï¼Œå®ƒä¼šåœ¨å†…éƒ¨æž„é€ ä¸€ä¸ª DefaultResourceLoader ã€‚ pathMatcher å±žæ€§ï¼Œé»˜è®¤ä¸º AntPathMatcher å¯¹è±¡ï¼Œç”¨äºŽæ”¯æŒ Ant ç±»åž‹çš„è·¯å¾„åŒ¹é…ã€‚ 2.5.2 getResource12345678@Overridepublic Resource getResource(String location) &#123; return getResourceLoader().getResource(location);&#125;public ResourceLoader getResourceLoader() &#123; return this.resourceLoader;&#125; è¯¥æ–¹æ³•ï¼Œç›´æŽ¥å§”æ‰˜ç»™ç›¸åº”çš„ ResourceLoader æ¥å®žçŽ°ã€‚æ‰€ä»¥ï¼Œå¦‚æžœæˆ‘ä»¬åœ¨å®žä¾‹åŒ–çš„ PathMatchingResourcePatternResolver çš„æ—¶å€™ï¼Œå¦‚æžœæœªæŒ‡å®š ResourceLoader å‚æ•°çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆåœ¨åŠ è½½èµ„æºæ—¶ï¼Œå…¶å®žå°±æ˜¯ DefaultResourceLoader çš„è¿‡ç¨‹ã€‚ å…¶å®žåœ¨ä¸‹é¢ä»‹ç»çš„ Resource[] getResources(String locationPattern) æ–¹æ³•ä¹Ÿç›¸åŒï¼Œåªä¸è¿‡è¿”å›žçš„èµ„æºæ˜¯å¤šä¸ªè€Œå·²ã€‚ 2.5.3 getResources1234567891011121314151617181920212223242526272829303132@Overridepublic Resource[] getResources(String locationPattern) throws IOException &#123; Assert.notNull(locationPattern, "Location pattern must not be null"); // ä»¥ "classpath*:" å¼€å¤´ if (locationPattern.startsWith(CLASSPATH_ALL_URL_PREFIX)) &#123; // è·¯å¾„åŒ…å«é€šé…ç¬¦ // a class path resource (multiple resources for same name possible) if (getPathMatcher().isPattern(locationPattern.substring(CLASSPATH_ALL_URL_PREFIX.length()))) &#123; // a class path resource pattern return findPathMatchingResources(locationPattern); // è·¯å¾„ä¸åŒ…å«é€šé…ç¬¦ &#125; else &#123; // all class path resources with the given name return findAllClassPathResources(locationPattern.substring(CLASSPATH_ALL_URL_PREFIX.length())); &#125; // ä¸ä»¥ "classpath*:" å¼€å¤´ &#125; else &#123; // Generally only look for a pattern after a prefix here, // é€šå¸¸åªåœ¨è¿™é‡Œçš„å‰ç¼€åŽé¢æŸ¥æ‰¾æ¨¡å¼ // and on Tomcat only after the "*/" separator for its "war:" protocol. è€Œåœ¨ Tomcat ä¸Šåªæœ‰åœ¨ â€œ*/ â€åˆ†éš”ç¬¦ä¹‹åŽæ‰ä¸ºå…¶ â€œwar:â€ åè®® int prefixEnd = (locationPattern.startsWith("war:") ? locationPattern.indexOf("*/") + 1 : locationPattern.indexOf(':') + 1); // è·¯å¾„åŒ…å«é€šé…ç¬¦ if (getPathMatcher().isPattern(locationPattern.substring(prefixEnd))) &#123; // a file pattern return findPathMatchingResources(locationPattern); // è·¯å¾„ä¸åŒ…å«é€šé…ç¬¦ &#125; else &#123; // a single resource with the given name return new Resource[] &#123;getResourceLoader().getResource(locationPattern)&#125;; &#125; &#125;&#125; å¤„ç†é€»è¾‘å¦‚ä¸‹å›¾ï¼š éž &quot;classpath*:&quot; å¼€å¤´ï¼Œä¸”è·¯å¾„ä¸åŒ…å«é€šé…ç¬¦ï¼Œç›´æŽ¥å§”æ‰˜ç»™ç›¸åº”çš„ ResourceLoader æ¥å®žçŽ°ã€‚ å…¶ä»–æƒ…å†µï¼Œè°ƒç”¨ #findAllClassPathResources(...)ã€æˆ– #findPathMatchingResources(...) æ–¹æ³•ï¼Œè¿”å›žå¤šä¸ª Resource ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†åˆ†æžã€‚ 2.5.4 findAllClassPathResourceså½“ locationPattern ä»¥ &quot;classpath*:&quot; å¼€å¤´ä½†æ˜¯ä¸åŒ…å«é€šé…ç¬¦ï¼Œåˆ™è°ƒç”¨ #findAllClassPathResources(...) æ–¹æ³•åŠ è½½èµ„æºã€‚è¯¥æ–¹æ³•è¿”å›ž classes è·¯å¾„ä¸‹å’Œæ‰€æœ‰ jar åŒ…ä¸­çš„æ‰€æœ‰ç›¸åŒ¹é…çš„èµ„æºã€‚ 1234567891011121314protected Resource[] findAllClassPathResources(String location) throws IOException &#123; String path = location; // åŽ»é™¤é¦–ä¸ª / if (path.startsWith("/")) &#123; path = path.substring(1); &#125; // çœŸæ­£æ‰§è¡ŒåŠ è½½æ‰€æœ‰ classpath èµ„æº Set&lt;Resource&gt; result = doFindAllClassPathResources(path); if (logger.isTraceEnabled()) &#123; logger.trace("Resolved classpath location [" + location + "] to resources " + result); &#125; // è½¬æ¢æˆ Resource æ•°ç»„è¿”å›ž return result.toArray(new Resource[0]);&#125; çœŸæ­£æ‰§è¡ŒåŠ è½½çš„æ˜¯åœ¨ #doFindAllClassPathResources(...) æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819protected Set&lt;Resource&gt; doFindAllClassPathResources(String path) throws IOException &#123; Set&lt;Resource&gt; result = new LinkedHashSet&lt;&gt;(16); ClassLoader cl = getClassLoader(); // &lt;1&gt; æ ¹æ® ClassLoader åŠ è½½è·¯å¾„ä¸‹çš„æ‰€æœ‰èµ„æº Enumeration&lt;URL&gt; resourceUrls = (cl != null ? cl.getResources(path) : ClassLoader.getSystemResources(path)); // &lt;2&gt; while (resourceUrls.hasMoreElements()) &#123; URL url = resourceUrls.nextElement(); // å°† URL è½¬æ¢æˆ UrlResource result.add(convertClassLoaderURL(url)); &#125; // &lt;3&gt; åŠ è½½è·¯å¾„ä¸‹å¾—æ‰€æœ‰ jar åŒ… if ("".equals(path)) &#123; // The above result is likely to be incomplete, i.e. only containing file system references. // We need to have pointers to each of the jar files on the classpath as well... addAllClassLoaderJarRoots(cl, result); &#125; return result;&#125; &lt;1&gt; å¤„ï¼Œæ ¹æ® ClassLoader åŠ è½½è·¯å¾„ä¸‹çš„æ‰€æœ‰èµ„æºã€‚åœ¨åŠ è½½èµ„æºè¿‡ç¨‹æ—¶ï¼Œå¦‚æžœåœ¨æž„é€  PathMatchingResourcePatternResolver å®žä¾‹çš„æ—¶å€™å¦‚æžœä¼ å…¥äº† ClassLoaderï¼Œåˆ™è°ƒç”¨è¯¥ ClassLoader çš„ #getResources() æ–¹æ³•ï¼Œå¦åˆ™è°ƒç”¨ ClassLoader#getSystemResources(path)æ–¹æ³•ã€‚å¦å¤–ï¼ŒClassLoader#getResources() æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹: 12345678910111213// java.lang.ClassLoader.javapublic Enumeration&lt;URL&gt; getResources(String name) throws IOException &#123; @SuppressWarnings("unchecked") Enumeration&lt;URL&gt;[] tmp = (Enumeration&lt;URL&gt;[]) new Enumeration&lt;?&gt;[2]; if (parent != null) &#123; tmp[0] = parent.getResources(name); &#125; else &#123; tmp[0] = getBootstrapResources(name); &#125; tmp[1] = findResources(name); return new CompoundEnumeration&lt;&gt;(tmp);&#125; çœ‹åˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å°±å·²ç»ä¸€ç›®äº†ç„¶äº†ï¼Ÿå¦‚æžœå½“å‰çˆ¶ç±»åŠ è½½å™¨ä¸ä¸º null ï¼Œåˆ™é€šè¿‡çˆ¶ç±»å‘ä¸Šè¿­ä»£èŽ·å–èµ„æºï¼Œå¦åˆ™è°ƒç”¨ #getBootstrapResources() ã€‚è¿™é‡Œæ˜¯ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œ(^â–½^)ã€‚ &lt;2&gt; å¤„ï¼ŒéåŽ† URL é›†åˆï¼Œè°ƒç”¨ #convertClassLoaderURL(URL url) æ–¹æ³•ï¼Œå°† URL è½¬æ¢æˆ UrlResource å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š 123protected Resource convertClassLoaderURL(URL url) &#123; return new UrlResource(url);&#125; &lt;3&gt; å¤„ï¼Œè‹¥ path ä¸ºç©ºï¼ˆâ€œâ€ï¼‰æ—¶ï¼Œåˆ™è°ƒç”¨ #addAllClassLoaderJarRoots(...)æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¸»è¦æ˜¯åŠ è½½è·¯å¾„ä¸‹å¾—æ‰€æœ‰ jar åŒ…ï¼Œæ–¹æ³•è¾ƒé•¿ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå®žé™…æ„ä¹‰å°±ä¸è´´å‡ºæ¥äº†ã€‚æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œè‡ªå·±å¯ä»¥åŽ»çœ‹çœ‹ã€‚ðŸ˜ˆ å½“ç„¶ï¼Œå¯èƒ½ä»£ç ä¹Ÿæ¯”è¾ƒé•¿å“ˆã€‚ é€šè¿‡ä¸Šé¢çš„åˆ†æžï¼Œæˆ‘ä»¬çŸ¥é“ #findAllClassPathResources(...) æ–¹æ³•ï¼Œå…¶å®žå°±æ˜¯åˆ©ç”¨ ClassLoader æ¥åŠ è½½æŒ‡å®šè·¯å¾„ä¸‹çš„èµ„æºï¼Œä¸è®ºå®ƒæ˜¯åœ¨ class è·¯å¾„ä¸‹è¿˜æ˜¯åœ¨ jar åŒ…ä¸­ã€‚å¦‚æžœæˆ‘ä»¬ä¼ å…¥çš„è·¯å¾„ä¸ºç©ºæˆ–è€… /ï¼Œåˆ™ä¼šè°ƒç”¨ #addAllClassLoaderJarRoots(...) æ–¹æ³•ï¼ŒåŠ è½½æ‰€æœ‰çš„ jar åŒ…ã€‚ 2.5.5 findPathMatchingResourceså½“ locationPattern ä¸­åŒ…å«äº†é€šé…ç¬¦ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•è¿›è¡Œèµ„æºåŠ è½½ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536protected Resource[] findPathMatchingResources(String locationPattern) throws IOException &#123; // ç¡®å®šæ ¹è·¯å¾„ã€å­è·¯å¾„ String rootDirPath = determineRootDir(locationPattern); String subPattern = locationPattern.substring(rootDirPath.length()); // èŽ·å–æ ¹æ®è·¯å¾„ä¸‹çš„èµ„æº Resource[] rootDirResources = getResources(rootDirPath); // éåŽ†ï¼Œè¿­ä»£ Set&lt;Resource&gt; result = new LinkedHashSet&lt;&gt;(16); for (Resource rootDirResource : rootDirResources) &#123; rootDirResource = resolveRootDirResource(rootDirResource); URL rootDirUrl = rootDirResource.getURL(); // bundle èµ„æºç±»åž‹ if (equinoxResolveMethod != null &amp;&amp; rootDirUrl.getProtocol().startsWith("bundle")) &#123; URL resolvedUrl = (URL) ReflectionUtils.invokeMethod(equinoxResolveMethod, null, rootDirUrl); if (resolvedUrl != null) &#123; rootDirUrl = resolvedUrl; &#125; rootDirResource = new UrlResource(rootDirUrl); &#125; // vfs èµ„æºç±»åž‹ if (rootDirUrl.getProtocol().startsWith(ResourceUtils.URL_PROTOCOL_VFS)) &#123; result.addAll(VfsResourceMatchingDelegate.findMatchingResources(rootDirUrl, subPattern, getPathMatcher())); // jar èµ„æºç±»åž‹ &#125; else if (ResourceUtils.isJarURL(rootDirUrl) || isJarResource(rootDirResource)) &#123; result.addAll(doFindPathMatchingJarResources(rootDirResource, rootDirUrl, subPattern)); // å…¶å®ƒèµ„æºç±»åž‹ &#125; else &#123; result.addAll(doFindPathMatchingFileResources(rootDirResource, subPattern)); &#125; &#125; if (logger.isTraceEnabled()) &#123; logger.trace("Resolved location pattern [" + locationPattern + "] to resources " + result); &#125; // è½¬æ¢æˆ Resource æ•°ç»„è¿”å›ž return result.toArray(new Resource[0]);&#125; æ–¹æ³•æœ‰ç‚¹å„¿é•¿ï¼Œä½†æ˜¯æ€è·¯è¿˜æ˜¯å¾ˆæ¸…æ™°çš„ï¼Œä¸»è¦åˆ†ä¸¤æ­¥ï¼š ç¡®å®šç›®å½•ï¼ŒèŽ·å–è¯¥ç›®å½•ä¸‹å¾—æ‰€æœ‰èµ„æºã€‚ åœ¨æ‰€èŽ·å¾—çš„æ‰€æœ‰èµ„æºåŽï¼Œè¿›è¡Œè¿­ä»£åŒ¹é…èŽ·å–æˆ‘ä»¬æƒ³è¦çš„èµ„æºã€‚ åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œæˆ‘ä»¬è¦å…³æ³¨ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ #determineRootDir(String location) æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ #doFindPathMatchingXXXResources(...) ç­‰æ–¹æ³•ã€‚ 2.5.5.1 determineRootDirdetermineRootDir(String location) æ–¹æ³•ï¼Œä¸»è¦æ˜¯ç”¨äºŽç¡®å®šæ ¹è·¯å¾„ã€‚ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829/** * Determine the root directory for the given location. * &lt;p&gt;Used for determining the starting point for file matching, * resolving the root directory location to a &#123;@code java.io.File&#125; * and passing it into &#123;@code retrieveMatchingFiles&#125;, with the * remainder of the location as pattern. * &lt;p&gt;Will return "/WEB-INF/" for the pattern "/WEB-INF/*.xml", * for example. * @param location the location to check * @return the part of the location that denotes the root directory * @see #retrieveMatchingFiles */protected String determineRootDir(String location) &#123; // æ‰¾åˆ°å†’å·çš„åŽä¸€ä½ int prefixEnd = location.indexOf(':') + 1; // æ ¹ç›®å½•ç»“æŸä½ç½® int rootDirEnd = location.length(); // åœ¨ä»Žå†’å·å¼€å§‹åˆ°æœ€åŽçš„å­—ç¬¦ä¸²ä¸­ï¼Œå¾ªçŽ¯åˆ¤æ–­æ˜¯å¦åŒ…å«é€šé…ç¬¦ï¼Œå¦‚æžœåŒ…å«ï¼Œåˆ™æˆªæ–­æœ€åŽä¸€ä¸ªç”±â€/â€åˆ†å‰²çš„éƒ¨åˆ†ã€‚ // ä¾‹å¦‚ï¼šåœ¨æˆ‘ä»¬è·¯å¾„ä¸­ï¼Œå°±æ˜¯æœ€åŽçš„ap?-context.xmlè¿™ä¸€æ®µã€‚å†å¾ªçŽ¯åˆ¤æ–­å‰©ä¸‹çš„éƒ¨åˆ†ï¼Œç›´åˆ°å‰©ä¸‹çš„è·¯å¾„ä¸­éƒ½ä¸åŒ…å«é€šé…ç¬¦ã€‚ while (rootDirEnd &gt; prefixEnd &amp;&amp; getPathMatcher().isPattern(location.substring(prefixEnd, rootDirEnd))) &#123; rootDirEnd = location.lastIndexOf('/', rootDirEnd - 2) + 1; &#125; // å¦‚æžœæŸ¥æ‰¾å®ŒæˆåŽï¼ŒrootDirEnd = 0 äº†ï¼Œåˆ™å°†ä¹‹å‰èµ‹å€¼çš„ prefixEnd çš„å€¼èµ‹ç»™ rootDirEnd ï¼Œä¹Ÿå°±æ˜¯å†’å·çš„åŽä¸€ä½ if (rootDirEnd == 0) &#123; rootDirEnd = prefixEnd; &#125; // æˆªå–æ ¹ç›®å½• return location.substring(0, rootDirEnd);&#125; æ–¹æ³•æ¯”è¾ƒç»•ï¼Œæ•ˆæžœå¦‚ä¸‹ç¤ºä¾‹ï¼š åŽŸè·¯å¾„ ç¡®å®šæ ¹è·¯å¾„ classpath*:test/cc*/spring-*.xml classpath*:test/ classpath*:test/aa/spring-*.xml classpath*:test/aa/ 2.5.5.2 doFindPathMatchingXXXResources æ¥è‡ªè‰¿è‰¿ #doFindPathMatchingXXXResources(...) æ–¹æ³•ï¼Œæ˜¯ä¸ªæ³›æŒ‡ï¼Œä¸€å…±å¯¹åº”ä¸‰ä¸ªæ–¹æ³•ï¼š #doFindPathMatchingJarResources(rootDirResource, rootDirUrl, subPatter) æ–¹æ³• #doFindPathMatchingFileResources(rootDirResource, subPattern) æ–¹æ³• VfsResourceMatchingDelegate#findMatchingResources(rootDirUrl, subPattern, pathMatcher) æ–¹æ³• å› ä¸ºæœ¬æ–‡é‡åœ¨åˆ†æž Spring ç»Ÿä¸€èµ„æºåŠ è½½ç­–ç•¥çš„æ•´ä½“æµç¨‹ã€‚ç›¸å¯¹æ¥è¯´ï¼Œä¸Šé¢å‡ ä¸ªæ–¹æ³•çš„ä»£ç é‡ä¼šæ¯”è¾ƒå¤šã€‚æ‰€ä»¥æœ¬æ–‡ä¸å†è¿½æº¯ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹ï¼ŒæŽ¨èé˜…è¯»å¦‚ä¸‹æ–‡ç« ï¼š ã€ŠSpringæºç æƒ…æ“é™¶å†¶-PathMatchingResourcePatternResolverè·¯å¾„èµ„æºåŒ¹é…æº¶è§£å™¨ã€‹ ï¼Œä¸»è¦é’ˆå¯¹ #doFindPathMatchingJarResources(rootDirResource, rootDirUrl, subPatter) æ–¹æ³•ã€‚ ã€Šæ·±å…¥ Spring IoC æºç ä¹‹ ResourceLoaderã€‹ ï¼Œä¸»è¦é’ˆå¯¹ #doFindPathMatchingFileResources(rootDirResource, subPattern) æ–¹æ³•ã€‚ ã€ŠSpring æºç å­¦ä¹  â€”â€” å«æœ‰é€šé…ç¬¦è·¯å¾„è§£æžï¼ˆä¸Šï¼‰ã€‹ ðŸ˜ˆ è²Œä¼¼æ²¡æœ‰ä¸‹ 3. å°ç»“è‡³æ­¤ Spring æ•´ä¸ªèµ„æºè®°è½½è¿‡ç¨‹å·²ç»åˆ†æžå®Œæ¯•ã€‚ä¸‹é¢ç®€è¦æ€»ç»“ä¸‹ï¼š Spring æä¾›äº† Resource å’Œ ResourceLoader æ¥ç»Ÿä¸€æŠ½è±¡æ•´ä¸ªèµ„æºåŠå…¶å®šä½ã€‚ä½¿å¾—èµ„æºä¸Žèµ„æºçš„å®šä½æœ‰äº†ä¸€ä¸ªæ›´åŠ æ¸…æ™°çš„ç•Œé™ï¼Œå¹¶ä¸”æä¾›äº†åˆé€‚çš„ Default ç±»ï¼Œä½¿å¾—è‡ªå®šä¹‰å®žçŽ°æ›´åŠ æ–¹ä¾¿å’Œæ¸…æ™°ã€‚ DefaultResource ä¸º Resource çš„é»˜è®¤å®žçŽ°ï¼Œå®ƒå¯¹ Resource æŽ¥å£åšäº†ä¸€ä¸ªç»Ÿä¸€çš„å®žçŽ°ï¼Œå­ç±»ç»§æ‰¿è¯¥ç±»åŽåªéœ€è¦è¦†ç›–ç›¸åº”çš„æ–¹æ³•å³å¯ï¼ŒåŒæ—¶å¯¹äºŽè‡ªå®šä¹‰çš„ Resource æˆ‘ä»¬ä¹Ÿæ˜¯ç»§æ‰¿è¯¥ç±»ã€‚ DefaultResourceLoader åŒæ ·ä¹Ÿæ˜¯ ResourceLoader çš„é»˜è®¤å®žçŽ°ï¼Œåœ¨è‡ªå®š ResourceLoader çš„æ—¶å€™æˆ‘ä»¬é™¤äº†å¯ä»¥ç»§æ‰¿è¯¥ç±»å¤–è¿˜å¯ä»¥å®žçŽ° ProtocolResolver æŽ¥å£æ¥å®žçŽ°è‡ªå®šèµ„æºåŠ è½½åè®®ã€‚ DefaultResourceLoader æ¯æ¬¡åªèƒ½è¿”å›žå•ä¸€çš„èµ„æºï¼Œæ‰€ä»¥ Spring é’ˆå¯¹è¿™ä¸ªæä¾›äº†å¦å¤–ä¸€ä¸ªæŽ¥å£ ResourcePatternResolver ï¼Œè¯¥æŽ¥å£æä¾›äº†æ ¹æ®æŒ‡å®šçš„ locationPattern è¿”å›žå¤šä¸ªèµ„æºçš„ç­–ç•¥ã€‚å…¶å­ç±» PathMatchingResourcePatternResolver æ˜¯ä¸€ä¸ªé›†å¤§æˆè€…çš„ ResourceLoader ï¼Œå› ä¸ºå®ƒå³å®žçŽ°äº† Resource getResource(String location) æ–¹æ³•ï¼Œä¹Ÿå®žçŽ°äº† Resource[] getResources(String locationPattern)æ–¹æ³•ã€‚ å¦å¤–ï¼Œå¦‚æžœèƒ–å‹è®¤çœŸçš„çœ‹äº†æœ¬æ–‡çš„åŒ…ç»“æž„ï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼ŒResource å’Œ ResourceLoader æ ¸å¿ƒæ˜¯åœ¨ï¼Œspring-core é¡¹ç›®ä¸­ã€‚ å¦‚æžœæƒ³è¦è°ƒè¯•æœ¬å°èŠ‚çš„ç›¸å…³å†…å®¹ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨ Resource å’Œ ResourceLoader ç›¸å…³çš„ API ï¼Œè¿›è¡Œæ“ä½œè°ƒè¯•ã€‚]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RxJava]]></title>
    <url>%2F2019%2F02%2F09%2FRxJava%2F</url>
    <content type="text"><![CDATA[RxJavaæ˜¯ä»€ä¹ˆa library for composing asynchronous and event-based programs using observable sequences for the Java VMï¼ˆä¸€ä¸ªå¯¹äºŽæž„æˆä½¿ç”¨çš„Javaè™šæ‹Ÿæœºè§‚å¯Ÿåºåˆ—å¼‚æ­¥å’ŒåŸºäºŽäº‹ä»¶çš„ç¨‹åºåº“ï¼‰ã€‚githubï¼šhttps://github.com/ReactiveX/RxJava è§‚å¯Ÿè€…æ¨¡å¼RxJavaçš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬æœ‰å››ç§è§’è‰²ï¼šObservable(è¢«è§‚å¯Ÿè€…)ã€Observer(è§‚å¯Ÿè€…)Subscriber(è®¢é˜…è€…)ã€SubjectObservableå’ŒSubjectæ˜¯ä¸¤ä¸ªâ€œç”Ÿäº§â€å®žä½“ï¼ŒObserverå’ŒSubscriberæ˜¯ä¸¤ä¸ªâ€œæ¶ˆè´¹â€å®žä½“ã€‚Observable å’Œ Observer é€šè¿‡ subscribe() æ–¹æ³•å®žçŽ°è®¢é˜…å…³ç³»ï¼Œä»Žè€Œ Observable å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™å‘å‡ºäº‹ä»¶æ¥é€šçŸ¥ Observerã€‚ å›žè°ƒæ–¹æ³•Subscribeæ–¹æ³•ç”¨äºŽå°†è§‚å¯Ÿè€…è¿žæŽ¥åˆ°Observableï¼Œä½ çš„è§‚å¯Ÿè€…éœ€è¦å®žçŽ°ä»¥ä¸‹æ–¹æ³•ï¼š onNext(T item)Observableè°ƒç”¨è¿™ä¸ªæ–¹æ³•å‘å°„æ•°æ®ï¼Œæ–¹æ³•çš„å‚æ•°å°±æ˜¯Observableå‘å°„çš„æ•°æ®ï¼Œè¿™ä¸ªæ–¹æ³•å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œå–å†³äºŽä½ çš„å®žçŽ°ã€‚ onError(Exception ex)å½“Observableé‡åˆ°é”™è¯¯æˆ–è€…æ— æ³•è¿”å›žæœŸæœ›çš„æ•°æ®æ—¶ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªè°ƒç”¨ä¼šç»ˆæ­¢Observableï¼ŒåŽç»­ä¸ä¼šå†è°ƒç”¨onNextå’ŒonCompletedï¼ŒonErroræ–¹æ³•çš„å‚æ•°æ˜¯æŠ›å‡ºçš„å¼‚å¸¸ã€‚ onCompleteæ­£å¸¸ç»ˆæ­¢ï¼Œå¦‚æžœæ²¡æœ‰é‡åˆ°é”™è¯¯ï¼ŒObservableåœ¨æœ€åŽä¸€æ¬¡è°ƒç”¨onNextä¹‹åŽè°ƒç”¨æ­¤æ–¹æ³•ã€‚ æ·»åŠ ä¾èµ–12compile 'io.reactivex:rxandroid:1.1.0'compile 'io.reactivex:rxjava:1.1.0' åˆ›å»ºæ“ä½œcreate123456789101112131415161718192021222324Observable.create(new Observable.OnSubscribe&lt;String&gt;() &#123; @Override public void call(Subscriber&lt;? super String&gt; subscriber) &#123; subscriber.onNext("Hello"); subscriber.onNext("RxJava"); subscriber.onCompleted(); &#125; &#125;) .subscribe(new Observer&lt;String&gt;() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(String s) &#123; Log.i("wxl", "onNext=" + s); &#125; &#125;); é™¤äº† Observer æŽ¥å£ä¹‹å¤–ï¼ŒRxJava è¿˜å†…ç½®äº†ä¸€ä¸ªå®žçŽ°äº† Observer çš„æŠ½è±¡ç±»ï¼šSubscriberã€‚ Subscriber å¯¹ Observer æŽ¥å£è¿›è¡Œäº†ä¸€äº›æ‰©å±•ï¼Œä½†ä»–ä»¬çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼š 12345678910111213141516.subscribe(new Subscriber() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(Object o) &#123; Log.i("wxl", "onNext=" + o); &#125; &#125;); fromæŽ¥å—æ•°ç»„ï¼Œè¿”å›žä¸€ä¸ªæŒ‰å‚æ•°åˆ—è¡¨é¡ºåºå‘å°„è¿™äº›æ•°æ®çš„Observableã€‚ 123456789101112131415161718String[] froms=&#123;"Hello","RxJava"&#125;;Observable.from(froms).subscribe(new Observer&lt;String&gt;() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(String s) &#123; Log.i("wxl", "onNext=" + s); &#125;&#125;); justjustå‡½æ•°ï¼Œå®ƒæŽ¥å—ä¸€è‡³ä¹ä¸ªå‚æ•°ï¼Œè¿”å›žä¸€ä¸ªæŒ‰å‚æ•°åˆ—è¡¨é¡ºåºå‘å°„è¿™äº›æ•°æ®çš„Observableã€‚ 1234567891011121314151617Observable.just("Hello","RxJava") .subscribe(new Observer&lt;String&gt;() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(String s) &#123; Log.i("wxl", "onNext=" + s); &#125; &#125;); ä»¥ä¸Šæ‰“å°ç»“æžœéƒ½æ˜¯ï¼š 123com.wuxiaolong.apksample I/wxl: onNext=Hellocom.wuxiaolong.apksample I/wxl: onNext=RxJavacom.wuxiaolong.apksample I/wxl: onCompleted å˜æ¢æ“ä½œMapæ“ä½œç¬¦å¯¹åŽŸå§‹Observableå‘å°„çš„æ¯ä¸€é¡¹æ•°æ®åº”ç”¨ä¸€ä¸ªä½ é€‰æ‹©çš„å‡½æ•°ï¼Œç„¶åŽè¿”å›žä¸€ä¸ªå‘å°„è¿™äº›ç»“æžœã€‚å¦‚ä¸‹ï¼Œå°†åŽŸå§‹Observableæ•°æ®è½¬åŒ–æˆå¤§å†™ï¼Œå†å‘å°„ï¼š 1234567891011121314151617181920212223Observable.just("Hello", "RxJava") .map(new Func1&lt;String, String&gt;() &#123; @Override public String call(String s) &#123; return s.toUpperCase(); &#125; &#125;) .subscribe(new Observer&lt;String&gt;() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(String s) &#123; Log.i("wxl", "onNext=" + s); &#125; &#125;); æ‰“å°ç»“æžœï¼š 123com.wuxiaolong.apksample I/wxl: onNext=HELLOcom.wuxiaolong.apksample I/wxl: onNext=RXJAVAcom.wuxiaolong.apksample I/wxl: onCompleted flatMapflatMap()æŽ¥æ”¶ä¸€ä¸ªObservableçš„è¾“å‡ºä½œä¸ºè¾“å…¥ï¼Œç„¶åŽä½œä¸ºä¸€ä¸ªæ–°çš„Observableå†å‘å°„ã€‚ç†è§£flatMapçš„å…³é”®ç‚¹åœ¨äºŽï¼ŒflatMapè¾“å‡ºçš„æ–°çš„Observableæ­£æ˜¯æˆ‘ä»¬åœ¨Subscriberæƒ³è¦æŽ¥æ”¶çš„ï¼Œæ¯”å¦‚è¿™é‡Œè¾“å‡ºå•ä¸ªçš„å­—ç¬¦ä¸²ã€‚ 1234567891011121314151617181920212223242526List&lt;String&gt; list = new ArrayList&lt;&gt;(); list.add("Hello"); list.add("RxJava");Observable.from(list) .flatMap(new Func1&lt;String, Observable&lt;String&gt;&gt;() &#123; @Override public Observable&lt;String&gt; call(String s) &#123; return Observable.just(s.toUpperCase()); &#125; &#125;) .subscribe(new Observer&lt;String&gt;() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(String s) &#123; Log.i("wxl", "onNext=" + s); &#125; &#125;); æ‰“å°ç»“æžœï¼š 123com.wuxiaolong.apksample I/wxl: onNext=HELLOcom.wuxiaolong.apksample I/wxl: onNext=RXJAVAcom.wuxiaolong.apksample I/wxl: onCompleted Scanä¸€ä¸ªç´¯åŠ å™¨å‡½æ•°ï¼Œæ“ä½œç¬¦å¯¹åŽŸå§‹Observableå‘å°„çš„ç¬¬ä¸€é¡¹æ•°æ®åº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åŽå°†é‚£ä¸ªå‡½æ•°çš„ç»“æžœä½œä¸ºè‡ªå·±çš„ç¬¬ä¸€é¡¹æ•°æ®å‘å°„ã€‚ 1234567891011121314151617181920Observable.just(1, 2, 3, 4, 5) .scan(new Func2&lt;Integer, Integer, Integer&gt;() &#123; @Override public Integer call(Integer integer, Integer integer2) &#123; return integer + integer2; &#125; &#125;) .subscribe(new Observer&lt;Integer&gt;() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(Integer integer) &#123; Log.i("wxl", "onNext=" + integer); &#125; &#125;); ç¬¬ä¸€æ¬¡å‘å°„å¾—åˆ°1ï¼Œä½œä¸ºç»“æžœä¸Ž2ç›¸åŠ ï¼›å‘å°„å¾—åˆ°3ï¼Œä½œä¸ºç»“æžœä¸Ž3ç›¸åŠ ï¼Œä»¥æ­¤ç±»æŽ¨ï¼Œæ‰“å°ç»“æžœï¼š 123456I/wxl: onNext=1I/wxl: onNext=3I/wxl: onNext=6I/wxl: onNext=10I/wxl: onNext=15I/wxl: onCompleted GroupByæŒ‰ç…§æŒ‡å®šçš„è§„åˆ™æ¥åˆ†ç»„å…ƒç´ ã€‚ è¿‡æ»¤æ“ä½œFilterè§‚æµ‹åºåˆ—ä¸­åªæœ‰é€šè¿‡çš„æ•°æ®æ‰ä¼šè¢«å‘å°„ã€‚ 1234567891011121314151617181920Observable.just(4, 2, 1, 7, 5) .filter(new Func1&lt;Integer, Boolean&gt;() &#123; @Override public Boolean call(Integer integer) &#123; return integer &gt; 3; &#125; &#125;) .subscribe(new Observer&lt;Integer&gt;() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(Integer integer) &#123; Log.i("wxl", "onNext=" + integer); &#125; &#125;); è¿‡æ»¤å°äºŽ3çš„ï¼Œæ‰“å°ç»“æžœï¼š 1234I/wxl: onNext=4I/wxl: onNext=7I/wxl: onNext=5I/wxl: onCompleted take()ã€takeLast()1.take(3) åªå‘å°„å‰Nä¸ªå…ƒç´  1.takeLast(3) åªå‘å°„æœ€åŽNä¸ªå…ƒç´  Firstã€laståªå‘å°„ç¬¬ä¸€ä¸ªå…ƒç´ æˆ–è€…æœ€åŽä¸€ä¸ªå…ƒç´  Skipã€SkipLast1.skip(2) æ¥åˆ›å»ºä¸€ä¸ªä¸å‘å°„å‰ä¸¤ä¸ªå…ƒç´ è€Œæ˜¯å‘å°„å®ƒåŽé¢çš„é‚£äº›æ•°æ®çš„åºåˆ— distinctä»…å¤„ç†ä¸€æ¬¡ï¼Œå¯ä»¥å¤„ç†åŽ»é™¤é‡å¤çš„æ•°æ® ElementAtä»…ä»Žä¸€ä¸ªåºåˆ—ä¸­å‘å°„ç¬¬nä¸ªå…ƒç´ ç„¶åŽå°±å®Œæˆäº†ï¼Œè¿™é‡Œæ˜¯ä»Ž0å¼€å§‹è®¡çš„ã€‚ 123Observable.just(1, 2, 3, 4, 5, 6) .elementAt(3) .subscribe(â€¦â€¦); æ‰“å°ç»“æžœï¼š4 Sampleå®šæœŸå‘å°„Observableæœ€è¿‘å‘å°„çš„æ•°æ®é¡¹ 1.sample(1000, TimeUnit.MILLISECONDS) åˆå¹¶æ“ä½œMergeåˆå¹¶å¤šä¸ªObservablesçš„å‘å°„ç‰©ï¼Œå¤šè¾“å…¥ï¼Œå•è¾“å‡º 12345678910111213141516Observable&lt;Integer&gt; observable1 = Observable.just(1, 3, 5);Observable&lt;Integer&gt; observable2 = Observable.just(2, 4, 6);Observable.merge(observable1,observable2) .subscribe(new Observer&lt;Integer&gt;() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(Integer integer) &#123; Log.i("wxl", "onNext=" + integer); &#125; &#125;); æ‰“å°ç»“æžœï¼š 1234567I/wxl: onNext=1I/wxl: onNext=3I/wxl: onNext=5I/wxl: onNext=2I/wxl: onNext=4I/wxl: onNext=6I/wxl: onCompleted zipåˆå¹¶ä¸¤ä¸ªæˆ–è€…å¤šä¸ªObservableså‘å°„å‡ºçš„æ•°æ®é¡¹ï¼Œæ ¹æ®æŒ‡å®šçš„å‡½æ•°Func2å˜æ¢å®ƒä»¬ï¼Œå¹¶å‘å°„ä¸€ä¸ªæ–°å€¼ã€‚ 123456789101112131415161718192021Observable&lt;Integer&gt; observable1 = Observable.just(1, 3, 5);Observable&lt;Integer&gt; observable2 = Observable.just(2, 4, 6, 9);Observable.zip(observable1, observable2, new Func2&lt;Integer, Integer, Integer&gt; @Override public Integer call(Integer integer, Integer integer2) &#123; return integer + integer2; &#125;&#125;) .subscribe(new Observer&lt;Integer&gt;() &#123; @Override public void onCompleted() &#123; Log.i("wxl", "onCompleted"); &#125; @Override public void onError(Throwable e) &#123; &#125; @Override public void onNext(Integer integer) &#123; Log.i("wxl", "onNext=" + integer); &#125; &#125;); æ‰“å°ç»“æžœï¼š 1234I/wxl: onNext=3I/wxl: onNext=7I/wxl: onNext=11I/wxl: onCompleted joinstartWith1.startWith(1) åœ¨æ•°æ®åºåˆ—çš„å¼€å¤´æ’å…¥ä¸€æ¡æŒ‡å®šçš„é¡¹1 Schedulersè°ƒåº¦å™¨ï¼Œè§£å†³Androidä¸»çº¿ç¨‹é—®é¢˜ï¼Œæœ‰5ç§ï¼š Schedulers.io()è¿™ä¸ªè°ƒåº¦å™¨æ—¶ç”¨äºŽI/Oæ“ä½œï¼ˆè¯»å†™æ–‡ä»¶ã€è¯»å†™æ•°æ®åº“ã€ç½‘ç»œä¿¡æ¯äº¤äº’ç­‰ï¼‰ Schedulers.computation()è¿™ä¸ªæ˜¯è®¡ç®—å·¥ä½œé»˜è®¤çš„è°ƒåº¦å™¨ï¼Œå®ƒä¸ŽI/Oæ“ä½œæ— å…³ã€‚å®ƒä¹Ÿæ˜¯è®¸å¤šRxJavaæ–¹æ³•çš„é»˜è®¤è°ƒåº¦å™¨ï¼šbuffer()ï¼Œdebounce()ï¼Œdelay()ï¼Œinterval()ï¼Œsample()ï¼Œskip() Schedulers.immediate()è¿™ä¸ªè°ƒåº¦å™¨å…è®¸ä½ ç«‹å³åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œä½ æŒ‡å®šçš„å·¥ä½œã€‚å®ƒæ˜¯timeout()ï¼ŒtimeInterval()ï¼Œä»¥åŠtimestamp()æ–¹æ³•é»˜è®¤çš„è°ƒåº¦å™¨ã€‚ Schedulers.newThread()å®ƒä¸ºæŒ‡å®šä»»åŠ¡å¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚ Schedulers.trampoline()å½“æˆ‘ä»¬æƒ³åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå¹¶ä¸æ˜¯ç«‹å³ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨.trampoline()å°†å®ƒå…¥é˜Ÿã€‚è¿™ä¸ªè°ƒåº¦å™¨å°†ä¼šå¤„ç†å®ƒçš„é˜Ÿåˆ—å¹¶ä¸”æŒ‰åºè¿è¡Œé˜Ÿåˆ—ä¸­æ¯ä¸€ä¸ªä»»åŠ¡ã€‚å®ƒæ˜¯repeat()å’Œretry()æ–¹æ³•é»˜è®¤çš„è°ƒåº¦å™¨ã€‚ SubscribeOnã€ObserveOnsubscribeOn()ï¼šäº‹ä»¶äº§ç”Ÿçš„çº¿ç¨‹observeOn()ï¼šäº‹ä»¶æ¶ˆè´¹çš„çº¿ç¨‹ï¼ŒAndroidSchedulers.mainThread()ï¼Œå®ƒæŒ‡å®šçš„æ“ä½œå°†åœ¨ Android ä¸»çº¿ç¨‹è¿è¡Œã€‚ 1.subscribeOn(Schedulers.io()) // æŒ‡å®š subscribe() å‘ç”Ÿåœ¨ IO çº¿ç¨‹]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>RxJava</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Tomcatæ€§èƒ½ä¼˜åŒ–]]></title>
    <url>%2F2019%2F01%2F28%2FTomcat%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[é…ç½®ä¼˜åŒ–å‡å°‘é…ç½®ä¼˜åŒ– åœºæ™¯ä¸€ï¼šå‡è®¾å½“å‰ REST åº”ç”¨ï¼ˆå¾®æœåŠ¡ï¼‰ åˆ†æžï¼šå®ƒä¸éœ€è¦é™æ€èµ„æºï¼ŒTomcat å®¹å™¨é™æ€å’ŒåŠ¨æ€ é™æ€å¤„ç†ï¼šDefaultServlet ä¼˜åŒ–æ–¹æ¡ˆï¼šé€šè¿‡ç§»é™¤conf/web.xml ä¸­ org.apache.catalina.servlets.DefaultServletã€‚ åŠ¨æ€ï¼šJspServlet ä¼˜åŒ–æ–¹æ¡ˆï¼šé€šè¿‡ç§»é™¤conf/web.xml ä¸­ org.apache.jasper.servlet.JspServletã€‚ DispatcherServletï¼šSpring Web MVC åº”ç”¨ Servlet JspServletï¼šç¼–è¯‘å¹¶ä¸”æ‰§è¡Œ Jsp é¡µé¢ DefaultServletï¼šTomcat å¤„ç†é™æ€èµ„æºçš„ Servlet ç§»é™¤ welcome-file-list 12345&lt;welcome-file-list&gt; &lt;welcome-file&gt;index.html&lt;/welcome-file&gt; &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt; &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;&lt;/welcome-file-list&gt; å¦‚æžœç¨‹åºæ˜¯REST JSON Content-Type æˆ–è€… MIME Typeï¼š application/json ç§»é™¤ Session è®¾ç½® å¯¹äºŽå¾®æœåŠ¡/REST åº”ç”¨ï¼Œä¸éœ€è¦ Sessionï¼Œå› ä¸ºä¸éœ€è¦çŠ¶æ€ã€‚ Spring Security OAuth 2.0ã€JWT Session é€šè¿‡ jsessionId è¿›è¡Œç”¨æˆ·è·Ÿè¸ªï¼ŒHTTP æ— çŠ¶æ€ï¼Œéœ€è¦ä¸€ä¸ªID ä¸Žå½“å‰ç”¨æˆ·ä¼šè¯è”ç³»ã€‚Spring Session HttpSession jessionId ä½œä¸º Redisï¼Œå®žçŽ°å¤šä¸ªæœºå™¨ç™»å½•ï¼Œç”¨æˆ·ä¼šè¯ä¸ä¸¢å¤±ã€‚ å­˜å‚¨æ–¹æ³•ï¼šCookieã€URL é‡å†™ã€ SSL ç§»é™¤ Valve Valve ç±»ä¼¼äºŽ Filter ç§»é™¤ AccessLogValveï¼Œå¯ä»¥é€šè¿‡ Nginx çš„ Access Log æ›¿ä»£ï¼ŒValve å®žçŽ°éƒ½éœ€è¦æ¶ˆè€— Java åº”ç”¨çš„è®¡ç®—æ—¶é—´ã€‚ åœºæ™¯äºŒï¼šéœ€è¦ JSP çš„æƒ…å†µ åˆ†æžï¼šäº†è§£ JspServlet å¤„ç†åŽŸç† Servlet å‘¨æœŸï¼š å®žä¾‹åŒ–ï¼šServlet å’Œ Filter å®žçŽ°ç±»å¿…é¡»åŒ…å«é»˜è®¤æž„é€ å™¨ã€‚åå°„çš„æ–¹å¼è¿›è¡Œå®žä¾‹åŒ–ã€‚ åˆå§‹åŒ–ï¼šServlet å®¹å™¨è°ƒç”¨ Servlet æˆ– Filter init() æ–¹æ³• é”€æ¯ï¼šServlet å®¹å™¨å…³é—­æ—¶ï¼ŒServlet æˆ–è€… Filter destroy() æ–¹æ³•è¢«è°ƒç”¨ â€‹ Servlet æˆ–è€… Filter åœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œæ˜¯ä¸€èˆ¬æƒ…å†µåœ¨ä¸€ä¸ª Web App ä¸­æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œä¸æŽ’é™¤åº”ç”¨å®šä¹‰å¤šä¸ªã€‚ JspServlet ç›¸å…³çš„ä¼˜åŒ– ServletConfig å‚æ•°: éœ€è¦ç¼–è¯‘ compiler modificationTestInterval ä¸éœ€è¦ç¼–è¯‘ development è®¾ç½® false development = false ï¼Œé‚£ä¹ˆï¼Œè¿™äº› JSP è¦å¦‚ä½•ç¼–è¯‘ã€‚ä¼˜åŒ–æ–¹æ³•ï¼š Ant Task æ‰§è¡Œ JSP ç¼–è¯‘ Maven æ’ä»¶ï¼šorg.codehaus.mojo:jspc-maven-plugin 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.sling&lt;/groupId&gt; &lt;artifactId&gt;jspc-maven-plugin&lt;/artifactId&gt; &lt;version&gt;2.1.0&lt;/version&gt;&lt;/dependency&gt; JSP -&gt; ç¿»è¯‘.jsp æˆ–è€….jspx æ–‡ä»¶æˆ .java -&gt; ç¼–è¯‘ .class æ€»ç»“ï¼Œconf/web.xml ä½œä¸º Servlet åº”ç”¨çš„é»˜è®¤web.xml,å®žé™…ä¸Šï¼Œåº”ç”¨ç¨‹åºå­˜åœ¨ä¸¤ä»½web.xmlï¼Œå…¶ä¸­åŒ…æ‹¬Tomcat conf/web.xml å’Œ åº”ç”¨çš„web.xmlï¼Œæœ€ç»ˆå°†ä¸¤è€…åˆå¹¶ã€‚ JspServlet å¦‚æžœ development å‚æ•°ä¸º trueï¼Œå®ƒä¼šè‡ªå®šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¿®æ”¹ï¼Œå¦‚æžœä¿®æ”¹é‡æ–°ç¿»è¯‘ï¼Œå†ç¼–è¯‘ï¼ˆåŠ è½½å’Œæ‰§è¡Œï¼‰ã€‚è¨€å¤–ä¹‹æ„ï¼ŒJspServlet å¼€å‘æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚å¸è½½ Classä¸åŠæ—¶ä¼šå¯¼è‡´ Perm åŒºåŸŸä¸å¤Ÿã€‚ ParentClassLoader -&gt; 1.class 2.class 3.class ChildClassLoader -&gt; 4.class , 5.class ChildClassLoader load 1 - 5 .class 1.class éœ€è¦å¸è½½ï¼Œéœ€è¦å°† ParentClassLoader è®¾ç½®ä¸º nullï¼Œå½“ ClassLoader è¢« GC åŽï¼Œ1-3 class å…¨éƒ¨ä¼šè¢«å¸è½½ã€‚ 1.class å®ƒæ˜¯æ–‡ä»¶ï¼Œæ–‡ä»¶è¢« JVM åŠ è½½ï¼ŒäºŒè¿›åˆ¶-&gt; Verify -&gt; è§£æž é…ç½®è°ƒæ•´å…³é—­è‡ªåŠ¨é‡è½½context.xml 12&lt;Context docBase="E:/Downloads/tomcat/target/tomcat-1.0-SNAPSHOT" reloadable="false" &gt;&lt;/Context&gt; ä¿®æ”¹è¿žæŽ¥çº¿ç¨‹æ± æ•°é‡é€šè¿‡ server.xml1234567&lt;Executor name="tomcatThreadPool" namePrefix="catalina-exec-" maxThreads="99" minSpareThreads="9"/&gt;&lt;Connector executor="tomcatThreadPool" port="8080" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443" /&gt; é€šè¿‡ç¨‹åºæ¥ç†è§£ï¼Œ&lt;Executor&gt; å®žé™…çš„Tomcat æŽ¥å£ï¼š org.apache.catalina.Executor æ‰©å±•ï¼š J.U.C æ ‡å‡†æŽ¥å£ java.util.concurrent.Executor å®žçŽ°ï¼šorg.apache.catalina.core.StandardThreadExecutor çº¿ç¨‹æ•°é‡ 1234567891011121314151617181920212223 /** * max number of threads */ protected int maxThreads = 200; /** * min number of threads */ protected int minSpareThreads = 25;public void setMinSpareThreads(int minSpareThreads) &#123; this.minSpareThreads = minSpareThreads; if (executor != null) &#123; executor.setCorePoolSize(minSpareThreads); &#125; &#125; public void setMaxThreads(int maxThreads) &#123; this.maxThreads = maxThreads; if (executor != null) &#123; executor.setMaximumPoolSize(maxThreads); &#125; &#125; çº¿ç¨‹æ± ï¼šorg.apache.tomcat.util.threads.ThreadPoolExecutor(java.util.concurrent.ThreadPoolExecutor) æ€»ç»“ï¼šTomcat IO è¿žæŽ¥å™¨ä½¿ç”¨çš„çº¿ç¨‹æ± å®žé™…æ ‡å‡†çš„ Java çº¿ç¨‹æ± çš„æ‰©å±•ï¼Œæœ€å¤§çº¿ç¨‹æ•°é‡å’Œæœ€å°çº¿ç¨‹æ•°é‡å®žé™…ä¸Šåˆ†åˆ«æ˜¯ MaximumPoolSize å’Œ CorePoolSizeã€‚ é€šè¿‡ JMX jconsoleå‘½ä»¤ï¼Œæˆ–è€…jvisualvm ï¼Œè¿›å…¥JMXï¼Œé€‰æ‹©è¿›ç¨‹ è°ƒæ•´tomatçº¿ç¨‹æ± å¤§å° 123## çº¿ç¨‹æ± å¤§å°server.tomcat.maxThreads=99server.tomcat.minSpareThreads=9 JMXæŸ¥çœ‹çº¿ç¨‹ jmeter.shå¯åŠ¨ï¼Œå®šä¹‰100ä¸ªçº¿ç¨‹ï¼Œå‘èµ·apiè¯·æ±‚ jconsole æˆ–è€… jvisualvm æŸ¥çœ‹çº¿ç¨‹æ•°å˜åŒ– è§‚å¯ŸStandardThreadExecutoræ˜¯å¦å­˜åœ¨è°ƒæ•´çº¿ç¨‹æ± æ•°é‡çš„ API è¯„ä¼°ä¸€äº›å‚è€ƒï¼š æ­£ç¡®çŽ‡ Loadï¼ˆCPU -&gt; JVM GCï¼‰ TPS / QPS (è¶Šå¤§è¶Šå¥½) CPU å¯†é›†åž‹ï¼ˆåŠ å¯†/è§£å¯†ã€ç®—æ³•ï¼‰ I/O å¯†é›†åž‹ï¼Œç½‘ç»œã€æ–‡ä»¶è¯»å†™ç­‰ é—®é¢˜ï¼šåˆ°åº•è®¾ç½®å¤šå°‘çš„çº¿ç¨‹æ•°é‡æ‰æ˜¯æœ€ä¼˜ï¼Ÿ é¦–å…ˆï¼Œè¯„ä¼°æ•´ä½“çš„æƒ…å†µé‡ï¼Œå‡è®¾ 100W QPSï¼Œæœ‰æœºå™¨æ•°é‡ 100 å°ï¼Œæ¯å°æ”¯æ’‘ 1w QPSã€‚ ç¬¬äºŒï¼Œè¿›è¡ŒåŽ‹åŠ›æµ‹è¯•ï¼Œéœ€è¦ä¸€äº›æµ‹è¯•æ ·æœ¬ï¼ŒJMeter æ¥å®žçŽ°ï¼Œå‡è®¾ä¸€æ¬¡è¯·æ±‚éœ€è¦RT 10msï¼Œ1ç§’å¯ä»¥åŒæ—¶å®Œæˆ 100ä¸ªè¯·æ±‚ã€‚10000 / 100 = 100 çº¿ç¨‹ã€‚ JMeterçš„çº¿ç¨‹æ•°ã€‚ ç¡®ä¿ï¼ŒLoad ä¸è¦å¤ªé«˜ã€‚å‡å°‘ Full GCï¼ŒGC å–å†³äºŽ JVM å †çš„å¤§å°ã€‚ æ‰§è¡Œä¸€æ¬¡æ“ä½œéœ€è¦ 5 MB å†…å­˜ï¼Œ 50 GBã€‚ 20 GB å†…å­˜ï¼Œå¿…ç„¶æ‰§è¡Œ GCã€‚è¦ä¸è°ƒä¼˜ç¨‹åºï¼Œæœ€å¥½å¯¹è±¡å­˜å‚¨å¤–åŒ–ï¼Œæ¯”å¦‚ Redisï¼ŒåŒæ—¶åˆéœ€è¦è¯„ä¼° Redis ç½‘ç»œå¼€é”€ã€‚åˆè¦è¯„ä¼°ç½‘å¡çš„æŽ¥å—èƒ½åŠ›ã€‚ ç¬¬ä¸‰ï¼Œå¸¸è§„æ€§åŽ‹æµ‹ï¼Œç”±äºŽä¸šåŠ¡å˜æ›´ï¼Œä¼šå¯¼è‡´åº•å±‚æ€§èƒ½å˜åŒ–ã€‚ JVM ä¼˜åŒ–è°ƒæ•´ GC ç®—æ³•å¦‚æžœ Java ç‰ˆæœ¬å°äºŽ 9ï¼Œé»˜è®¤PS MarkSweepï¼Œå¯é€‰è®¾ç½® CMSã€G1ã€‚ å¦‚æžœ Java 9 çš„è¯ï¼Œé»˜è®¤ G1 é»˜è®¤ç®—æ³•1java -jar -server -XX:-PrintGCDetails -Xloggc:./1g/gc.log -XX:+HeapDumpOnOutOfMemoryError -Xms1g -Xmx1g -XX:MaxGCPauseMillis=250 -Djava.awt.headless=true stress-test-demo-0.0.1-SNAPSHOT.jar G1 ç®—æ³•1java -jar -server -XX:-PrintGCDetails -Xloggc:./1g/g1-gc.log -XX:+HeapDumpOnOutOfMemoryError -Xms1g -Xmx1g -XX:+UseG1GC -XX:+UseNUMA -XX:MaxGCPauseMillis=250 -Djava.awt.headless=true stress-test-demo-0.0.1-SNAPSHOT.jar -server ä¸»è¦æé«˜åžåé‡ï¼Œåœ¨æœ‰é™çš„èµ„æºï¼Œå®žçŽ°æœ€å¤§åŒ–åˆ©ç”¨ã€‚-client ä¸»è¦æé«˜å“åº”æ—¶é—´ï¼Œä¸»è¦æ˜¯æé«˜ç”¨æˆ·ä½“éªŒã€‚ Spring Boot é…ç½®è°ƒæ•´Maven ä¾èµ– 1234&lt;dependency&gt; &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt; &lt;artifactId&gt;tomcat-embed-jasper&lt;/artifactId&gt;&lt;/dependency&gt; application.properties 1234567891011# &lt;Executor name=&quot;tomcatThreadPool&quot; namePrefix=&quot;catalina-exec-&quot;# maxThreads=&quot;9&quot; minSpareThreads=&quot;9&quot;/&gt;## çº¿ç¨‹æ± å¤§å°server.tomcat.maxThreads = 99server.tomcat.minSpareThreads = 9## å–æ¶ˆ Tomcat AccessLogValveserver.tomcat.accesslog.enabled = false## å–æ¶ˆ JspServletserver.jspServlet.registered=false tomcat.getServer().await()å’ŒObject.wait()æœ‰ä»€ä¹ˆåŒºåˆ« Tomcat tomcat.getServer().await() åˆ©ç”¨ Thread.sleep(long) å®žçŽ°ï¼š 123456789101112131415if( port==-1 ) &#123; try &#123; awaitThread = Thread.currentThread(); while(!stopAwait) &#123; try &#123; Thread.sleep( 10000 ); &#125; catch( InterruptedException ex ) &#123; // continue and check the flag &#125; &#125; &#125; finally &#123; awaitThread = null; &#125; return; &#125; Object#wait() æ–¹æ³•ä¹Ÿæ˜¯ Native æ–¹æ³•ã€‚]]></content>
      <categories>
        <category>tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åµŒå…¥å¼ Tomcat]]></title>
    <url>%2F2019%2F01%2F26%2F%E5%B5%8C%E5%85%A5%E5%BC%8FTomcat%2F</url>
    <content type="text"><![CDATA[Tomcat æž¶æž„ Web æŠ€æœ¯æ ˆServlet æŠ€æœ¯æ ˆWeb Fluxï¼ˆNettyï¼‰BIO NIO Web è‡ªåŠ¨è£…é…API è§’åº¦åˆ†æžServlet 3.0 + API å®žçŽ° ServletContainerInitializer å®¹å™¨è§’åº¦åˆ†æžä¼ ç»Ÿçš„ Web åº”ç”¨ï¼Œå°† webapp éƒ¨ç½²åˆ° Servlet å®¹å™¨ä¸­ã€‚ åµŒå…¥å¼ Web åº”ç”¨ï¼Œçµæ´»éƒ¨ç½²ï¼Œä»»æ„æŒ‡å®šä½ç½®ï¼ˆæˆ–è€…é€šè¿‡å¤æ‚çš„æ¡ä»¶åˆ¤æ–­ï¼‰ Tomcat 7 æ˜¯ Servlet 3.0 çš„å®žçŽ°ï¼ŒServletContainerInitializer Tomcat 8 æ˜¯ Servlet 3.1 çš„å®žçŽ°ï¼ŒNIO HttpServletRequestã€HttpServletResponse NIO å¹¶éžä¸€å®šèƒ½å¤Ÿæé«˜æ€§èƒ½ï¼Œæ¯”å¦‚è¯·æ±‚æ•°æ®é‡è¾ƒå¤§ï¼ŒNIO æ€§èƒ½æ¯” BIO è¿˜è¦å·® NIO å¤šå·¥ï¼Œè¯»ã€å†™ï¼ŒåŒæ­¥çš„ jar å¯åŠ¨java -jar æˆ–è€… jar è¯»å– .jar META-INF/MANIFEST.MF ï¼Œå…¶ä¸­å±žæ€§ Main-Class å°±æ˜¯å¼•å¯¼ç±»æ‰€åœ¨ã€‚ å‚è€ƒ JDK API ï¼š java.util.jar.Manifest Tomcat Maven æ’ä»¶Tomcat 7 Maven æ’ä»¶123&lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;&lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;&lt;version&gt;2.1&lt;/version&gt; 12Manifest-Version: 1.0Main-Class: org.apache.tomcat.maven.runner.Tomcat7RunnerCli å¾—å‡º Tomcat 7 å¯æ‰§è¡Œ jar å¼•å¯¼ç±»æ˜¯org.apache.tomcat.maven.runner.Tomcat7RunnerCli Tomcat 7 API ç¼–ç¨‹ä»£ç å‚è€ƒï¼š https://github.com/Frankenjoy123/embeded-tomcat ç¡®å®š Classpath ç›®å½•classes ç»å¯¹è·¯å¾„ï¼šE:\Downloads\tomcat\target\classes 12String classesPath = System.getProperty("user.dir") + File.separator + "target" + File.separator + "classes"; åˆ›å»º Tomcat å®žä¾‹org.apache.catalina.startup.Tomcat Maven åæ ‡ï¼šorg.apache.tomcat.embed:tomcat-embed-core:7.0.37 è®¾ç½® Hostå¯¹è±¡1234// è®¾ç½® HostHost host = tomcat.getHost();host.setName("localhost");host.setAppBase("webapps"); è®¾ç½® ClasspathClasspath è¯»å–èµ„æºï¼šé…ç½®ã€ç±»æ–‡ä»¶ conf/web.xml ä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”æ”¾ç½® Classpath ç›®å½•ä¸‹ï¼ˆç»å¯¹è·¯å¾„ï¼‰ è®¾ç½® DemoServlet 123 // æ·»åŠ  DemoServlet åˆ° Tomcat å®¹å™¨Wrapper wrapper = tomcat.addServlet(contextPath, "DemoServlet", new DemoServlet());wrapper.addMapping("/demo"); Spring Boot åµŒå…¥å¼ Tomcat ç¼–ç¨‹å®žçŽ° EmbeddedServletContainerCustomer123456789101112131415161718192021222324252627282930@Configurationpublic class TomcatConfiguration implements EmbeddedServletContainerCustomizer &#123; @Override public void customize(ConfigurableEmbeddedServletContainer container) &#123; System.err.println(container.getClass()); if (container instanceof TomcatEmbeddedServletContainerFactory) &#123; TomcatEmbeddedServletContainerFactory factory = (TomcatEmbeddedServletContainerFactory) container; // ç›¸å½“äºŽ new TomcatContextCustomizer()&#123;&#125; factory.addContextCustomizers((context) -&gt; &#123; // Lambda if (context instanceof StandardContext) &#123; StandardContext standardContext = (StandardContext) context; // standardContext.setDefaultWebXml(); // è®¾ç½® standardContext.setReloadable(true); &#125; &#125;); // ç›¸å½“äºŽ new TomcatConnectorCustomizer() &#123;&#125; factory.addConnectorCustomizers(connector -&gt; &#123; connector.setPort(12345); &#125;); &#125; &#125;&#125; è‡ªå®šä¹‰ Contextå®žçŽ°TomcatContextCustomizer 1234567// ç›¸å½“äºŽ new TomcatContextCustomizer()&#123;&#125;factory.addContextCustomizers((context) -&gt; &#123; // Lambda if (context instanceof StandardContext) &#123; StandardContext standardContext = (StandardContext) context; // standardContext.setDefaultWebXml(); // è®¾ç½® &#125;&#125;); è‡ªå®šä¹‰ Connectorå®žçŽ° TomcatConnectorCustomizer 1234// ç›¸å½“äºŽ new TomcatConnectorCustomizer() &#123;&#125;factory.addConnectorCustomizers(connector -&gt; &#123; connector.setPort(12345);&#125;); é—®ç­” å†…åµŒtomcatæ˜¯ä¸æ˜¯æ¯”å•ç‹¬çš„tomcatä¸æ˜¯åœ¨æŸæ–¹é¢å…·æœ‰ä¸€äº›ä¼˜åŠ¿ï¼Ÿ åµŒå…¥å¼ Tomcat æˆ–è€…åµŒå…¥å¼ Web å®¹å™¨å¯ä»¥ä¸ä¾èµ–æ–‡ä»¶ç›®å½•ï¼Œæ¯”å¦‚åœ¨ Docker åœºæ™¯ä½¿ç”¨æ–¹ä¾¿ã€‚ å†…ç½®çš„tomcat å’Œ å¤–éƒ¨çš„tomcat æ€§èƒ½æœ‰å¤šå¤§å·®åˆ«?ç”Ÿäº§çº¿ä¸Šå»ºè®®ç”¨å“ªä¸ª? åµŒå…¥å¼ Tomcat å’Œ ä¼ ç»Ÿ Tomcat æ€§èƒ½å¯ä»¥è¯´ä¸€æ ·ï¼ŒçŽ°åœ¨éžå¸¸å¤šçš„ç”Ÿäº§çŽ¯å¢ƒ Spring Boot åµŒå…¥å¼ - åµŒå…¥å¼ Tomcat Springä¸­preå®žä¾‹åŒ–å’Œpreåˆå§‹åŒ–åŒºåˆ«(åˆšåˆšæœ‰æåˆ°) åœ¨ Spring æ—©èµ·ç‰ˆæœ¬ä¸­ï¼Œå…ˆæœ‰åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸ - org.springframework.beans.factory.config.BeanPostProcessor åŽæ¥ Spring 1.2 ï¼Œæä¾›æ–°çš„æ‰©å±•æŽ¥å£ï¼ˆBeanPostProcessorï¼‰ï¼š org.springframework.beans.factory.config.InstantiationAwareBeanPostProcessor â€‹ Tomcat API ä¸»è¦æ˜¯è®²tomcatè¿è¡ŒåŽŸç†å—ï¼Ÿç”Ÿäº§çŽ¯å¢ƒç”¨å“ªç§æ¯”è¾ƒå¤šï¼Ÿ ä¼ ç»Ÿ Tomcat å’Œ åµŒå…¥å¼ Tomcat éƒ½æœ‰åœ¨ç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨ã€‚ â€‹ Tomcat çƒ­éƒ¨ç½²åŽŸç†èƒ½ç»™è®²ä¸‹å—ï¼Ÿ org.apache.catalina.Lifecycle â€‹ ç›‘æŽ§èµ„æºå˜åŒ–ï¼ŒClass å˜åŒ–ã€é…ç½®å˜åŒ–äº†ã€‚ Tomcat å†³å®šé‡å¯ Context â€‹ org.apache.catalina.Context â€‹ Tomcat è‡ªåŠ¨åŠ è½½ 1public void setReloadable(boolean reloadable)]]></content>
      <categories>
        <category>tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç­–ç•¥æ¨¡å¼ä¸ŽSpringç»“åˆä½¿ç”¨]]></title>
    <url>%2F2019%2F01%2F17%2F%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E4%B8%8ESpring%E7%BB%93%E5%90%88%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[IOCæ˜¯Springçš„æ ¸å¿ƒä¹‹ä¸€ï¼Œåˆ©ç”¨Springä½¿ç”¨è®¾è®¡æ¨¡å¼ä¸­çš„ç­–ç•¥æ¨¡å¼ï¼Œå¯ä»¥æŠŠå…·ä½“ç­–ç•¥çš„åˆ›å»ºäº¤ç»™Springå®¹å™¨æ¥ç®¡ç†ã€‚ ç­–ç•¥æ¨¡å¼æŽ¥å£çš„å®šä¹‰ éœ€æ±‚ï¼šè®¾è®¡ä¸€ä¸ªç»Ÿè®¡æŠ¥è¡¨æŽ¥å£ï¼Œæš‚å®šæœ‰ä¸¤ç§ç»Ÿè®¡æ–¹å¼ï¼šç»Ÿè®¡è®¢å•æ€»æ•°,ç»Ÿè®¡æ–°å¢žç”¨æˆ·æ•°ã€‚ é¦–å…ˆå®šä¹‰ç»Ÿè®¡æŽ¥å£ã€‚ 12345678/**- ç­–ç•¥æ¨¡å¼çš„ä½¿ç”¨:é€‰æ‹©ç»Ÿè®¡ç®—æ³•,åˆ†ç¦»å®žçŽ°- ç»Ÿè®¡ç­–ç•¥æŽ¥å£:å®šä¹‰ç»Ÿä¸€çš„è°ƒç”¨æ–¹æ³•*/public interface StatStrategy &#123; void getStatData();&#125; å…·ä½“çš„ç»Ÿè®¡ç®—æ³•ï¼š 1234567@Componentpublic class OrderStrategyImpl implements StatStrategy &#123; @Override public void getStatData() &#123; System.out.println("ç»Ÿè®¡è®¢å•æ€»æ•°"); &#125;&#125; 1234567@Componentpublic class UserStrategyImpl implements StatStrategy &#123; @Override public void getStatData() &#123; System.out.println("ç»Ÿè®¡æ–°å¢žç”¨æˆ·æ•°"); &#125;&#125; åˆ©ç”¨@Component æ³¨è§£å°†ç®—æ³•çš„å®žçŽ°äº¤ç”±Springå®¹å™¨ç®¡ç†ã€‚ 123456789101112131415161718192021222324/** * ç»Ÿè®¡ç­–ç•¥çš„ä¸Šä¸‹æ–‡ */public class StatContext &#123; //è£…è½½ç­–ç•¥å¯¹è±¡çš„é›†åˆ,å…¶ä¸­key:Statisticsç±»åž‹ä¸ºè‡ªå®šä¹‰çš„æžšä¸¾ç±»åž‹ private Map&lt;Statistics, StatStrategy&gt; statStrategy = new HashMap&lt;&gt;(); //æä¾›ç»™å®¢æˆ·ç«¯ä½¿ç”¨çš„æ–¹æ³• public void loadDetailData(Integer strategyId) &#123; for (Map.Entry&lt;Statistics,StatStrategy&gt; entry : statStrategy.entrySet()) &#123; if (entry.getKey().getId()==strategyId.intValue()) &#123; statStrategy.get(entry.getKey()).getStatData(); &#125; &#125; &#125; public Map&lt;Statistics, StatStrategy&gt; getStatStrategy() &#123; return statStrategy; &#125; public void setStatStrategy(Map&lt;Statistics, StatStrategy&gt; statStrategy) &#123; this.statStrategy = statStrategy; &#125;&#125; è‡ªå®šä¹‰çš„æžšä¸¾ç±»åž‹Statistics ï¼š 123456789101112131415161718192021public enum Statistics &#123; è®¢å•_æ€»æ•°ç»Ÿè®¡(101, "ã€è®¢å•ã€‘æ€»æ•°ç»Ÿè®¡"), ç”¨æˆ·_æ–°å¢žç”¨æˆ·æ•°ç»Ÿè®¡(201, "ã€ç”¨æˆ·ã€‘æ–°å¢žç”¨æˆ·æ•°ç»Ÿè®¡"); private int id; private String name; public int getId() &#123; return id; &#125; public String getName() &#123; return name; &#125; Statistics(int id, String name) &#123; this.id = id; this.name = name; &#125;&#125; ç­–ç•¥æ¨¡å¼ç»“åˆSpringæ¥ä½¿ç”¨æŽ¥ä¸‹æ¥ï¼Œå°±æ˜¯æŠŠäº¤ç”±Springç®¡ç†çš„å…·ä½“ç®—æ³•æ³¨å…¥åˆ°StatContext ä¸­ï¼Œç”¨xmlæ–‡ä»¶çš„å½¢å¼æ¥å®žçŽ°ï¼ŒBeançš„å®šä¹‰å†™åœ¨applicationContext.xmlä¸­ï¼š ç­–ç•¥æ”¾åˆ°mapä¸­ 1234567891011121314151617&lt;bean id="statContext" class="StatContext"&gt; &lt;property name="statStrategy"&gt; &lt;map&gt; &lt;entry key-ref="statOrder" value-ref="orderStrategyImpl "&gt;&lt;/entry&gt; &lt;entry key-ref="statUser" value-ref="userStrategyImpl "&gt;&lt;/entry&gt; &lt;/map&gt; &lt;/property&gt;&lt;/bean&gt;&lt;!--æžšä¸¾ç±»åž‹è¦æƒ³æ³¨å…¥åˆ°ç±»ä¸­ï¼Œä¸€å®šè¦å…ˆä½¿ç”¨org.springframework.beans.factory.config.FieldRetrievingFactoryBeanç±»å°†æžšä¸¾ç±»åž‹è¿›è¡Œè½¬æ¢--&gt;&lt;bean id="statOrder" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"&gt; &lt;property name="staticField" value="Statistics.è®¢å•_æ€»æ•°ç»Ÿè®¡" /&gt;&lt;/bean&gt;&lt;bean id="statUser" class="org.springframework.beans.factory.config.FieldRetrievingFactoryBean"&gt; &lt;property name="staticField" value="Statistics.ç”¨æˆ·_æ–°å¢žç”¨æˆ·æ•°ç»Ÿè®¡" /&gt;&lt;/bean&gt; ç­–ç•¥æ¨¡å¼çš„ç›¸å…³å®šä¹‰å·²ç»å†™å¥½ï¼ŒæŽ¥ä¸‹æ¥ä½¿ç”¨å°±å¾ˆç®€å•äº†ï¼ŒæŒ‰ç…§MVCçš„æž¶æž„ï¼Œæˆ‘ä»¬æ˜¯åœ¨Serviceå±‚æ¥è°ƒç”¨ç›¸å…³çš„ç­–ç•¥ç®—æ³•ï¼Œé¦–å…ˆå®šä¹‰ServiceæŽ¥å£ã€‚ 123public interface StatService &#123; void loadDetailData(Integer strategyId);&#125; æŽ¥å£å®žçŽ°ã€‚ 1234567891011@Servicepublic class StatServiceImpl implements StatService &#123; @Autowired private StatContext statContext; @Override public void loadDetailData(Integer strategyId) &#123; //ç­–ç•¥æ¨¡å¼ç»“åˆSpringä½¿ç”¨,ä½¿ä»£ç ç»“æž„æ›´æ¸…æ™°,é¿å…å¤šé‡if-elseåˆ¤æ–­ statContext.loadDetailData(strategyId); &#125;&#125; ç­–ç•¥æ¨¡å¼ç»“åˆSpringä½¿ç”¨å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå…·ä½“ç»†èŠ‚å†ç»“åˆé¡¹ç›®çš„ä½¿ç”¨æ¥ä¿®æ”¹ï¼Œå®Œæ¯•ã€‚]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Tomcatæž¶æž„è§£æžåŠéƒ¨ç½²æ–¹å¼]]></title>
    <url>%2F2019%2F01%2F17%2Ftomcat%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%2F</url>
    <content type="text"><![CDATA[ç›®å½•ç»“æž„conf ç›®å½•catalina.policy : Tomcat å®‰å…¨ç­–ç•¥æ–‡ä»¶ï¼ŒæŽ§åˆ¶ JVM ç›¸å…³æƒé™ï¼Œå…·ä½“å¯ä»¥å‚è€ƒjava.security.Permission catalina.properties : Tomcat Catalina è¡Œä¸ºæŽ§åˆ¶é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ Common ClassLoader logging.properties : Tomcat æ—¥å¿—é…ç½®æ–‡ä»¶ï¼ŒJDK Logging server.xml : Tomcat Server é…ç½®æ–‡ä»¶ GlobalNamingResources : å…¨å±€ JNDI èµ„æº context.xml : å…¨å±€ Context é…ç½®æ–‡ä»¶ tomcat-users.xml : Tomcat è§’è‰²é…ç½®æ–‡ä»¶ï¼Œï¼ˆRealm æ–‡ä»¶å®žçŽ°æ–¹å¼ï¼‰ã€ web.xml : Servlet æ ‡å‡†çš„ web.xml éƒ¨ç½²æ–‡ä»¶ï¼ŒTomcat é»˜è®¤å®žçŽ°éƒ¨åˆ†é…ç½®å…¥å†…ï¼š org.apache.catalina.servlets.DefaultServlet org.apache.jasper.servlet.JspServlet lib ç›®å½•Tomcat å­˜æ”¾å…¬ç”¨ç±»åº“ ecj-*.jar : Eclipse Java ç¼–è¯‘å™¨ jasper.jar : JSP ç¼–è¯‘å™¨ logs ç›®å½•localhost.${date}.log : å½“ Tomcat åº”ç”¨èµ·ä¸æ¥çš„æ—¶å€™ï¼Œå¤šçœ‹è¯¥æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šç±»å†²çª NoClassDefFoundError ClassNotFoundException catalina.${date}.log : æŽ§åˆ¶å°è¾“å‡ºï¼ŒSystem.out å¤–ç½® webapps ç›®å½•ç®€åŒ– web åº”ç”¨éƒ¨ç½²çš„æ–¹å¼ éƒ¨ç½² Web åº”ç”¨æ–¹æ³•ä¸€ï¼šæ”¾ç½®åœ¨ webappsç›®å½•demo ä»£ç  ï¼š https://github.com/Frankenjoy123/tomcat-deploy-example mvn clean package cp target xx.war tomcat/webapps/helloworld unzip xx.war bin/startup.sh è®¿é—® http://localhost:8080/helloworld/hello?message=abc å³å¯æˆåŠŸ æ–¹æ³•äºŒï¼š ä¿®æ”¹ confi/server.xml åœ¨HostèŠ‚ç‚¹ä¸‹é…ç½®Contextå…ƒç´  docBaseé…ç½®ä¸ºé¡¹ç›®çš„è§£åŽ‹åŽçš„ç›®æ ‡åœ°å€ 12345&lt;Host name="localhost" appBase="webapps" unpackWARs="true" autoDeploy="true"&gt; &lt;Context path="" docBase="/Users/zhouxiaowu/install/tomcat/demo-tomcat-8080/webapps/helloworld" debug="0" reloadable="true" crossContext="true"/&gt;&lt;/Host&gt; è®¿é—® http://localhost:8080/hello?message=abc å³å¯æˆåŠŸ EngineèŠ‚ç‚¹çš„åç§°ä¹Ÿå¯ä»¥ä¿®æ”¹ï¼Œåœ¨confç›®å½•ä¸‹ï¼Œç”Ÿäº§å’ŒCatatlinaä¸€æ ·çš„æ–‡ä»¶ç›®å½•ågupao æ·»åŠ Context å…ƒç´ ï¼š 12&lt;Context docBase="$&#123;webAppAbsolutePath&#125;" path="/" reloadable="true" /&gt;&lt;Context docBase="$&#123;webAppAbsolutePath&#125;" path="/tomcat" reloadable="true" /&gt; ç†Ÿæ‚‰é…ç½®å…ƒç´ å¯ä»¥å‚è€ƒorg.apache.catalina.core.StandardContext setter æ–¹æ³• Container Context è¯¥æ–¹å¼ä¸æ”¯æŒåŠ¨æ€éƒ¨ç½²ï¼Œå»ºè®®è€ƒè™‘åœ¨ç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨ã€‚ æ–¹æ³•ä¸‰ï¼šç‹¬ç«‹ conf/Catalina/localhost é…ç½®æ–‡ä»¶ /Users/zhouxiaowu/install/tomcat/demo-tomcat-8080/conf/Catalina/localhostæ–°å»ºROOT.xml 123&lt;?xml version='1.0' encoding='utf-8'?&gt;&lt;Context crossContext="true" docBase="/Users/zhouxiaowu/IdeaProject-tongdun/Example/target/Example-1.0-SNAPSHOT" path="/" reloadable="true"&gt;&lt;/Context&gt; ä¸»ç›®å½•æ–‡ä»¶åå¿…é¡»æ˜¯ROOT.XML(rootå¤§å†™)ï¼Œè€Œè™šæ‹Ÿç›®å½•çš„æ–‡ä»¶åç§°å’Œè™šæ‹Ÿç›®å½•çš„åç§°ä¸€è‡´å¹¶ä¸”ä¸ºå°å†™ conf/Catalina/localhostæ–°å»ºhelloworld.xml conf/Catalina/localhostä¸‹å»ºç«‹ä¸€ä¸ªxmlæ–‡ä»¶ï¼Œç”¨äºŽä¸»ç›®å½•æˆ–è€…è™šæ‹Ÿç›®å½•ï¼Œè€Œä¸éœ€è¦åŽ»ä¿®æ”¹server.xmlå°±å¯ä»¥è¾¾åˆ°é…ç½®ä¸»ç›®å½•å’Œè™šæ‹Ÿç›®å½•çš„ç›®çš„ 123&lt;?xml version='1.0' encoding='utf-8'?&gt;&lt;Context crossContext="true" docBase="/Users/zhouxiaowu/IdeaProject-tongdun/Example/target/Example-1.0-SNAPSHOT" path="helloworld" reloadable="true"&gt;&lt;/Context&gt; æ³¨æ„ï¼šè¯¥æ–¹å¼å¯ä»¥å®žçŽ°çƒ­éƒ¨ç½²ï¼Œå› æ­¤å»ºè®®åœ¨å¼€å‘çŽ¯å¢ƒä½¿ç”¨ã€‚ æ–¹æ³•å››ï¼š å¤šå®žä¾‹tomcatéƒ¨ç½² é…ç½®CATALINA_BASE çŽ¯å¢ƒå˜é‡ 1export CATALINA_BASE=$APP_DEPLOY_HOME/tomcat confç›®å½•é…ç½®ï¼Œå‚è€ƒ https://github.com/Frankenjoy123/tomcat-deploy-example çº¿ä¸Šç¤ºä¾‹1/home/admin/asdemo/deploy/tomcat/conf/Catalina/localhost/ROOT.xml 12345678&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;Context path="" docBase="/home/admin/asdemo/deploy/target/asdemo.war" workDir="/home/admin/asdemo/deploy" debug="0" reloadable="true"&gt;&lt;/Context&gt; I/O è¿žæŽ¥å™¨å‚è€ƒæ–‡ä»¶ï¼šhttps://tomcat.apache.org/tomcat-7.0-doc/config/http.html å®žçŽ°ç±»ï¼šorg.apache.catalina.connector.Connector æ³¨æ„å®žçŽ°ï¼š 12345678910111213141516171819202122232425262728public void setProtocol(String protocol) &#123; if (AprLifecycleListener.isAprAvailable()) &#123; if ("HTTP/1.1".equals(protocol)) &#123; setProtocolHandlerClassName ("org.apache.coyote.http11.Http11AprProtocol"); &#125; else if ("AJP/1.3".equals(protocol)) &#123; setProtocolHandlerClassName ("org.apache.coyote.ajp.AjpAprProtocol"); &#125; else if (protocol != null) &#123; setProtocolHandlerClassName(protocol); &#125; else &#123; setProtocolHandlerClassName ("org.apache.coyote.http11.Http11AprProtocol"); &#125; &#125; else &#123; if ("HTTP/1.1".equals(protocol)) &#123; setProtocolHandlerClassName ("org.apache.coyote.http11.Http11Protocol"); &#125; else if ("AJP/1.3".equals(protocol)) &#123; setProtocolHandlerClassName ("org.apache.coyote.ajp.AjpProtocol"); &#125; else if (protocol != null) &#123; setProtocolHandlerClassName(protocol); &#125; &#125;&#125; é—®ç­”äº’åŠ¨é—®é¢˜ä¸€ï¼šå¦‚æžœé…ç½®pathçš„è¯ æ˜¯ä»¥æ–‡ä»¶åä¸ºä¸» è¿˜æ˜¯ ä»¥é…ç½®çš„ä¸ºä¸»ç‹¬ç«‹ context XML é…ç½®æ–‡ä»¶æ—¶ï¼Œè®¾ç½® path å±žæ€§æ˜¯æ— æ•ˆçš„ã€‚ é—®é¢˜äºŒï¼šæ ¹ç‹¬ç«‹ context XML é…ç½®æ–‡ä»¶è·¯å¾„${TOMCAT_HOME}/conf/${Engine.name}/${HOST.name}/ROOT.xml é—®é¢˜ä¸‰ï¼šå¦‚æžœå®žçŽ°çƒ­éƒ¨ç½²è°ƒæ•´ &lt;context&gt; å…ƒç´ ä¸­çš„å±žæ€§reloadable=&quot;true&quot; é—®é¢˜å››ï¼šè¿žæŽ¥å™¨é‡Œé¢çš„çº¿ç¨‹æ±  æ˜¯ç”¨çš„å“ªä¸ªçº¿ç¨‹æ± æ³¨æ„conf/server.xml æ–‡ä»¶ä¸­çš„ä¸€æ®µæ³¨é‡Šï¼š 1234&lt;Connector executor="tomcatThreadPool" port="8080" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443" /&gt; org.apache.catalina.Executor: 123456789101112131415161718public interface Executor extends java.util.concurrent.Executor, Lifecycle &#123; public String getName(); /** * Executes the given command at some time in the future. The command * may execute in a new thread, in a pooled thread, or in the calling * thread, at the discretion of the &lt;tt&gt;Executor&lt;/tt&gt; implementation. * If no threads are available, it will be added to the work queue. * If the work queue is full, the system will wait for the specified * time until it throws a RejectedExecutionException * * @param command the runnable task * @throws java.util.concurrent.RejectedExecutionException if this task * cannot be accepted for execution - the queue is full * @throws NullPointerException if command or unit is null */ void execute(Runnable command, long timeout, TimeUnit unit);&#125; æ ‡å‡†å®žçŽ°ï¼šorg.apache.catalina.core.StandardThreadExecutor å°†è¿žæŽ¥å¤„ç†äº¤ä»˜ç»™ Java æ ‡å‡†çº¿ç¨‹æ± ï¼š org.apache.tomcat.util.threads.ThreadPoolExecutorã€‚ é—®é¢˜äº”ï¼šJNDI èƒ½ä¸èƒ½ç¨å¾®è¯´ä¸‹ ä¹‹å‰åªæ˜¯åœ¨æ•°æ®æºçš„æ—¶å€™ç”¨è¿‡ï¼Œä½†æ˜¯ä¸æ˜¯å¤ªç†è§£1234567&lt;Context ...&gt; ... &lt;Resource name="mail/Session" auth="Container" type="javax.mail.Session" mail.smtp.host="localhost"/&gt; ...&lt;/Context&gt; 123456789101112Context initCtx = new InitialContext();Context envCtx = (Context) initCtx.lookup("java:comp/env");Session session = (Session) envCtx.lookup("mail/Session");Message message = new MimeMessage(session);message.setFrom(new InternetAddress(request.getParameter("from")));InternetAddress to[] = new InternetAddress[1];to[0] = new InternetAddress(request.getParameter("to"));message.setRecipients(Message.RecipientType.TO, to);message.setSubject(request.getParameter("subject"));message.setContent(request.getParameter("content"), "text/plain");Transport.send(message);]]></content>
      <categories>
        <category>tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Expiresã€Last-Modifiedã€Etagç¼“å­˜æŽ§åˆ¶]]></title>
    <url>%2F2019%2F01%2F08%2FExpires%E3%80%81Last-Modified%E3%80%81Etag%E7%BC%93%E5%AD%98%E6%8E%A7%E5%88%B6%2F</url>
    <content type="text"><![CDATA[å½“è¯·æ±‚ä¸€ä¸ªé¡µé¢æ—¶ï¼Œå¦‚æžœæµè§ˆå™¨ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œå› æ­¤æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°ä¸€ä¸ªHTTPè¯·æ±‚ä¸º304çŠ¶æ€ã€‚æˆ–è€…æ˜¾ç¤º200çŠ¶æ€ï¼Œåœ¨chromeä¸‹æ ‡æ³¨æ˜¯from cacheï¼Œåœ¨ç«ç‹ä¸‹ä¼šæ ‡æ³¨BFCacheï¼› æˆ‘ä»¬å¸Œæœ›åœ¨æœåŠ¡å™¨ç«¯æ›´æ–°äº†é™æ€æ–‡ä»¶ï¼ˆå¦‚cssã€jsã€å›¾ç‰‡ï¼‰ï¼Œèƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯å¾—åˆ°åŠæ—¶çš„æ›´æ–°ï¼Œä½†åˆä¸æƒ³è®©æµè§ˆå™¨æ¯æ¬¡è¯·æ±‚éƒ½ä»ŽæœåŠ¡å™¨ç«¯èŽ·å–é™æ€èµ„æºã€‚é‚£ä¹ˆå°±éœ€è¦äº†è§£ä¸€äº›ä¸‹é¢çš„çŸ¥è¯†ï¼š Last-Modified / If-Modified-Sinceå½“æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸€ä¸ªurlæ—¶ï¼ŒæœåŠ¡å™¨ç«¯çš„è¿”å›žçŠ¶æ€ç ä¸º200ï¼ŒåŒæ—¶HTTPå“åº”å¤´ä¼šæœ‰ä¸€ä¸ªLast-Modifiedæ ‡è®°ç€æ–‡ä»¶åœ¨æœåŠ¡å™¨ç«¯æœ€åŽè¢«ä¿®æ”¹çš„æ—¶é—´ã€‚ æµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚ä¸Šæ¬¡è¯·æ±‚è¿‡çš„urlæ—¶ï¼Œæµè§ˆå™¨ä¼šåœ¨HTTPè¯·æ±‚å¤´æ·»åŠ ä¸€ä¸ªIf-Modified-Sinceçš„æ ‡è®°ï¼Œç”¨æ¥è¯¢é—®æœåŠ¡å™¨è¯¥æ—¶é—´ä¹‹åŽæ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚ å¦‚æžœæœåŠ¡å™¨ç«¯çš„èµ„æºæ²¡æœ‰å˜åŒ–ï¼Œåˆ™è‡ªåŠ¨è¿”å›ž304çŠ¶æ€ï¼Œä½¿ç”¨æµè§ˆå™¨ç¼“å­˜ï¼Œä»Žè€Œä¿è¯äº†æµè§ˆå™¨ä¸ä¼šé‡å¤ä»ŽæœåŠ¡å™¨ç«¯èŽ·å–èµ„æºï¼Œä¹Ÿä¿è¯äº†æœåŠ¡å™¨æœ‰å˜åŒ–æ˜¯ï¼Œå®¢æˆ·ç«¯èƒ½å¤ŸåŠæ—¶å¾—åˆ°æœ€æ–°çš„èµ„æºã€‚ Etag / If-None-Matchå½“æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸€ä¸ªurlæ—¶ï¼ŒæœåŠ¡å™¨ç«¯çš„è¿”å›žçŠ¶æ€ç ä¸º200ï¼ŒåŒæ—¶HTTPå“åº”å¤´ä¼šæœ‰ä¸€ä¸ªEtagï¼Œå­˜æ”¾ç€æœåŠ¡å™¨ç«¯ç”Ÿæˆçš„ä¸€ä¸ªåºåˆ—å€¼ã€‚ æµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚ä¸Šæ¬¡è¯·æ±‚è¿‡çš„urlæ—¶ï¼Œæµè§ˆå™¨ä¼šåœ¨HTTPè¯·æ±‚å¤´æ·»åŠ ä¸€ä¸ªIf-None-Matchçš„æ ‡è®°ï¼Œç”¨æ¥è¯¢é—®æœåŠ¡å™¨è¯¥æ–‡ä»¶æœ‰æ²¡æœ‰è¢«ä¿®æ”¹ã€‚ Etag ä¸»è¦ä¸ºäº†è§£å†³ Last-Modified æ— æ³•è§£å†³çš„ä¸€äº›é—®é¢˜: 1ã€ä¸€äº›æ–‡ä»¶ä¹Ÿè®¸ä¼šå‘¨æœŸæ€§çš„æ›´æ”¹ï¼Œä½†æ˜¯ä»–çš„å†…å®¹å¹¶ä¸æ”¹å˜(ä»…ä»…æ”¹å˜çš„ä¿®æ”¹æ—¶é—´)ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å®¢æˆ·ç«¯è®¤ä¸ºè¿™ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œè€Œé‡æ–°GET; 2ã€æŸäº›æ–‡ä»¶ä¿®æ”¹éžå¸¸é¢‘ç¹ï¼Œæ¯”å¦‚åœ¨ç§’ä»¥ä¸‹çš„æ—¶é—´å†…è¿›è¡Œä¿®æ”¹ï¼Œ(æ¯”æ–¹è¯´1så†…ä¿®æ”¹äº†Næ¬¡)ï¼ŒIf-Modified-Sinceèƒ½æ£€æŸ¥åˆ°çš„ç²’åº¦æ˜¯sçº§çš„ï¼Œè¿™ç§ä¿®æ”¹æ— æ³•åˆ¤æ–­(æˆ–è€…è¯´UNIXè®°å½•MTIMEåªèƒ½ç²¾ç¡®åˆ°ç§’) 3ã€æŸäº›æœåŠ¡å™¨ä¸èƒ½ç²¾ç¡®çš„å¾—åˆ°æ–‡ä»¶çš„æœ€åŽä¿®æ”¹æ—¶é—´ï¼› Expires1&lt;meta http-equiv="expires" content="Fri, 22 Aug 2014 00:52:49 GMT" /&gt; HTTP 1.0ï¼Œè®¾ç½®ç¼“å­˜çš„æˆªæ­¢æ—¶é—´ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæµè§ˆå™¨å¯¹ç¼“å­˜çš„æ•°æ®ä¸é‡æ–°å‘è¯·æ±‚ã€‚å®ƒä¸ŽLast-Modified/Etagç»“åˆä½¿ç”¨ï¼Œç”¨æ¥æŽ§åˆ¶è¯·æ±‚æ–‡ä»¶çš„æœ‰æ•ˆæ—¶é—´ï¼Œå½“è¯·æ±‚æ•°æ®åœ¨æœ‰æ•ˆæœŸå†…ï¼Œæµè§ˆå™¨ä»Žç¼“å­˜èŽ·å¾—æ•°æ®ã€‚Last-Modifed/Etagèƒ½å¤ŸèŠ‚çœä¸€ç‚¹å®½å¸¦ï¼Œä½†æ˜¯è¿˜ä¼šå‘ä¸€ä¸ªHTTPè¯·æ±‚ã€‚ Catch-Control12&lt;!--Cache-Control: max-age=ç§’ --&gt;&lt;meta http-equiv="Cache-Control" content="max-age=120"/&gt; HTTP 1.1ï¼Œè®¾ç½®èµ„æºåœ¨æœ¬åœ°ç¼“å­˜å¤šé•¿æ—¶é—´ã€‚ å¦‚æžœCache-Controlä¸ŽexpiresåŒæ—¶å­˜åœ¨ï¼ŒCache-Controlç”Ÿæ•ˆã€‚expires çš„ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ï¼Œè¿”å›žçš„åˆ°æœŸæ—¶é—´æ˜¯æœåŠ¡å™¨ç«¯çš„æ—¶é—´ï¼Œè¿™æ ·å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æžœå®¢æˆ·ç«¯çš„æ—¶é—´ä¸ŽæœåŠ¡å™¨çš„æ—¶é—´ç›¸å·®å¾ˆå¤§ï¼Œé‚£ä¹ˆè¯¯å·®å°±å¾ˆå¤§ï¼Œæ‰€ä»¥åœ¨HTTP 1.1ç‰ˆå¼€å§‹ï¼Œä½¿ç”¨Cache-Control: max-age=ç§’æ›¿ä»£ã€‚ ç”¨æˆ·æ“ä½œä¸Žç¼“å­˜ ç¦æ­¢ç¼“å­˜12345&lt;!--ç¦æ­¢æµè§ˆå™¨æœ¬åœ°ç¼“å­˜ --&gt;&lt;meta http-equiv="Cache-Control" content="no-cache"/&gt;&lt;!-- æˆ–è€… --&gt;&lt;meta http-equiv="Cache-Control" content="max-age=0"/&gt; è¿˜æœ‰POSTè¯·æ±‚ä¸ä½¿ç”¨ç¼“å­˜ï¼ŒHTTPå“åº”å¤´ä¸åŒ…å«Last-Modified/Etagï¼Œä¹Ÿä¸åŒ…å«Cache-Control/Expiresä¸ä¼šä½¿ç”¨ç¼“å­˜ã€‚ é™¤éžæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œæœ€å¥½è¿˜æ˜¯ä¸è¦ç¦ç”¨ç¼“å­˜ï¼Œæ¯•ç«Ÿæ˜¯ç”¨ç¼“å­˜èƒ½èŠ‚çœå®½å¸¦ï¼ŒèŠ‚çœæœåŠ¡å™¨èµ„æºï¼ŒèŠ‚çœmoneyâ€¦ æµè§ˆå™¨ç¬¬ä¸€æ¬¡è¯·æ±‚è¿‡ç¨‹ æµè§ˆå™¨ç¬¬äºŒæ¬¡è¯·æ±‚è¿‡ç¨‹ æˆ‘ä»¬å¸Œæœ›æœåŠ¡å™¨ç«¯æ›´æ–°äº†æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŠæ—¶çš„æ›´æ–°æ–‡ä»¶ï¼Œæ ¹å…·ä¸Šé¢æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹é™æ€æ–‡ä»¶çš„å“åº”å¤´æ·»åŠ expiresï¼Œè®¾ç½®ä¸ºæ°¸ä¹…è¿‡æœŸï¼Œæµè§ˆå™¨æ¯æ¬¡è¯·æ±‚é™æ€æ–‡ä»¶ï¼Œå°±ä¼šè¯¢é—®æœåŠ¡å™¨æ–‡ä»¶æœ‰æ²¡æœ‰åšè¿‡æ›´æ”¹ï¼Œå¦‚æžœæ›´æ”¹äº†å°±ä»ŽæœåŠ¡å™¨ç«¯èŽ·å–èµ„æºï¼Œå¦åˆ™ç›´æŽ¥ä½¿ç”¨ç¼“å­˜ã€‚ apacheçš„é…ç½®ï¼š;) 1234567891011121314#å¼€å¯mod_expiresæ¨¡å—LoadModule expires_module modules/mod_expires.soExpiresActive OnExpiresDefault "access plus 0 seconds" #é»˜è®¤ç¼“å­˜0s&lt;Directory "æ ¹ç›®å½•"&gt; #Options FollowSymLinks #AllowOverride all Order deny,allow Allow from all #ExpiresByType application/* "access plus 0 seconds" #ExpiresByType image/* "access plus 0 seconds" #ExpiresByType text/css "access plus 0 seconds"&lt;/Directory&gt; ;) è¿™æ ·çš„åšæ³•æœ‰ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šè¯¢é—®æœåŠ¡å™¨ç«¯èµ„æºæ˜¯å¦è¿‡æœŸï¼Œå½“ç„¶è¿˜æœ‰æ›´å¥½çš„åŠžæ³•ã€‚ å‚è€ƒé“¾æŽ¥Expiresã€Last-Modifiedã€Etagç¼“å­˜æŽ§åˆ¶ æµè§ˆå™¨ç¼“å­˜ä¹‹Expires Etag Last-Modified max-ageè¯¦è§£]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åºåˆ—åŒ–ä¹‹serialVersionUID]]></title>
    <url>%2F2018%2F12%2F25%2F%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BserialVersionUID%2F</url>
    <content type="text"><![CDATA[serialVersionUIDserialVersionUIDæ˜¯ç”¨æ¥éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ã€‚æ‰€ä»¥åœ¨åšå…¼å®¹æ€§å‡çº§çš„æ—¶å€™ï¼Œä¸è¦æ”¹å˜ç±»ä¸­serialVersionUIDçš„å€¼ã€‚ å¼ºè°ƒä¸€ä¸‹ï¼šserialVersionUID æ—¢ç„¶æ˜¯éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ï¼Œåœ¨åšç‰ˆæœ¬å‡çº§çš„æ—¶å€™ï¼ˆéžå…¼å®¹æ€§å‡çº§ï¼‰ï¼Œè®°å¾—è¦ä¿®æ”¹è¿™ä¸ªå­—æ®µçš„å€¼å“¦ï¼Œè¿™æ ·å¯ä»¥é¿å…åºåˆ—åŒ–æ··ä¹±ã€‚ å¦‚æžœä¸€ä¸ªç±»å®žçŽ°äº†SerializableæŽ¥å£ï¼Œä¸€å®šè¦è®°å¾—å®šä¹‰serialVersionUIDï¼Œå¦åˆ™ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚å¯ä»¥åœ¨IDEä¸­é€šè¿‡è®¾ç½®ï¼Œè®©ä»–å¸®å¿™æç¤ºï¼Œå¹¶ä¸”å¯ä»¥ä¸€é”®å¿«é€Ÿç”Ÿæˆä¸€ä¸ª serialVersionUIDã€‚ ä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œæ˜¯å› ä¸ºååºåˆ—åŒ–è¿‡ç¨‹ä¸­åšäº†æ ¡éªŒï¼Œå¹¶ä¸”å¦‚æžœæ²¡æœ‰æ˜Žç¡®å®šä¹‰çš„è¯ï¼Œä¼šæ ¹æ®ç±»ååŠå±žæ€§ç­‰è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªã€‚ ExternalizableJavaä¸­è¿˜æä¾›äº†ExternalizableæŽ¥å£ï¼Œä¹Ÿå¯ä»¥å®žçŽ°å®ƒæ¥æä¾›åºåˆ—åŒ–èƒ½åŠ›ã€‚ Externalizableç»§æ‰¿è‡ªSerializableï¼Œè¯¥æŽ¥å£ä¸­å®šä¹‰äº†ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼š writeExternal()ä¸ŽreadExternal()ã€‚ å½“ä½¿ç”¨ExternalizableæŽ¥å£æ¥è¿›è¡Œåºåˆ—åŒ–ä¸Žååºåˆ—åŒ–çš„æ—¶å€™éœ€è¦å¼€å‘äººå‘˜é‡å†™ writeExternal()ä¸ŽreadExternal()æ–¹æ³•ã€‚å¦åˆ™æ‰€æœ‰å˜é‡çš„å€¼éƒ½ä¼šå˜æˆé»˜è®¤å€¼ã€‚ transienttransient å…³é”®å­—çš„ä½œç”¨æ˜¯æŽ§åˆ¶å˜é‡çš„åºåˆ—åŒ–ï¼Œåœ¨å˜é‡å£°æ˜Žå‰åŠ ä¸Šè¯¥å…³é”®å­—ï¼Œå¯ä»¥é˜»æ­¢è¯¥å˜é‡è¢«åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œåœ¨è¢«ååºåˆ—åŒ–åŽï¼Œ transient å˜é‡çš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œå¦‚ int åž‹çš„æ˜¯ 0ï¼Œå¯¹è±¡åž‹çš„æ˜¯ nullã€‚ å‚è€ƒä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´è¦æ±‚ç¨‹åºå‘˜è°¨æ…Žä¿®æ”¹serialVersionUID Javaå¯¹è±¡çš„åºåˆ—åŒ–ä¸Žååºåˆ—åŒ– ä½ çœŸçš„ä»¥ä¸ºä½ äº†è§£Javaçš„åºåˆ—åŒ–äº†å—ï¼Ÿ]]></content>
      <tags>
        <tag>java</tag>
        <tag>åºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLæ€§èƒ½ä¼˜åŒ–å¸¸ç”¨æ–¹æ³•]]></title>
    <url>%2F2018%2F12%2F17%2FMySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[é—®é¢˜å®šä½1234show process_list;-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’show sql -&gt; explain; æŸ¥çœ‹é”çŠ¶æ€1234-- è¡¨çº§é”çš„äº‰ç”¨çŠ¶æ€å˜é‡show status like 'table%';-- è¡Œçº§é”äº‰ç”¨çŠ¶æ€å˜é‡show status like 'innodb_row_lock%'; é”è¡¨ readé”ï¼Œå³å…±äº«é” 1234lock table user use read;-- è§£é”unlock tables; writeé”ï¼ŒæŽ’ä»–é” 1234lock table user use write;-- è§£é”unlock tables; Innodb æ”¯æŒè¡¨é”å’Œè¡Œé” * Myisam åªæ”¯æŒè¡¨é” è¡Œé”ç¼ºç‚¹: è¡Œçº§é”å®¹æ˜“é€ æˆæ­»é” è¡¨é”ç¼ºç‚¹ï¼š é”çš„ç²’åº¦å¤ªå¤§ï¼Œå¹¶å‘åº¦ä¸é«˜ Profiling12345set profiling=1;select nick_name ,count(*) from user group by nick_name;show profiles;-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’çš„å„ä¸ªçŽ¯èŠ‚è€—æ—¶show profile cpu,block io for query 75; join_buffer_sizeå­˜åœ¨2å¼ è¡¨ä»¥ä¸Šçš„æ—¶å€™ï¼Œå­˜åœ¨ä¸€ä¸ªjoin_bufferåŒº 1show variables like 'join_%'; sort_bufferæ ¹æ®sort_buffer sizeå¤§å°ï¼Œbufferå¯ä»¥é€‰æ‹©æ”¾selectçš„å…¨éƒ¨å­—æ®µï¼Œç©ºé—´æ¢æ—¶é—´ï¼ŒæŸ¥è¯¢æ›´å¿«ã€‚å¦å¤–ä¸€ç§ï¼Œåªå­˜order byçš„å­—æ®µå’ŒæŒ‡é’ˆã€‚ 1show variables like '%sort%'; å‚è€ƒç¾Žå›¢ç´¢å¼•ä¼˜åŒ– https://blog.csdn.net/zhanghongzheng3213/article/details/51722506 MySQLå®˜æ–¹explainæ–‡æ¡£https://dev.mysql.com/doc/refman/5.5/en/explain-output.html gupao-æ€§èƒ½ä¼˜åŒ–Mysqlç¯‡.pdf]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è·¨åŸŸèµ„æºå…±äº«CORSè¯¦è§£]]></title>
    <url>%2F2018%2F11%2F30%2F%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%ABCORS%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[CORSæ˜¯ä¸€ä¸ªW3Cæ ‡å‡†ï¼Œå…¨ç§°æ˜¯â€è·¨åŸŸèµ„æºå…±äº«â€ï¼ˆCross-origin resource sharingï¼‰ã€‚ å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨ï¼Œå‘å‡ºXMLHttpRequestè¯·æ±‚ï¼Œä»Žè€Œå…‹æœäº†AJAXåªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚ æœ¬æ–‡è¯¦ç»†ä»‹ç»CORSçš„å†…éƒ¨æœºåˆ¶ã€‚ ä¸€ã€ç®€ä»‹CORSéœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIEæµè§ˆå™¨ä¸èƒ½ä½ŽäºŽIE10ã€‚ æ•´ä¸ªCORSé€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸Žã€‚å¯¹äºŽå¼€å‘è€…æ¥è¯´ï¼ŒCORSé€šä¿¡ä¸ŽåŒæºçš„AJAXé€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘çŽ°AJAXè¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚ å› æ­¤ï¼Œå®žçŽ°CORSé€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®žçŽ°äº†CORSæŽ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚ äºŒã€ä¸¤ç§è¯·æ±‚æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéžç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚ åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±žäºŽç®€å•è¯·æ±‚ã€‚ ï¼ˆ1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š HEAD GET POST ï¼ˆ2ï¼‰HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š Accept Accept-Language Content-Language Last-Event-ID Content-Typeï¼šåªé™äºŽä¸‰ä¸ªå€¼application/x-www-form-urlencodedã€multipart/form-dataã€text/plain å‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±žäºŽéžç®€å•è¯·æ±‚ã€‚ æµè§ˆå™¨å¯¹è¿™ä¸¤ç§è¯·æ±‚çš„å¤„ç†ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚ ä¸‰ã€ç®€å•è¯·æ±‚3.1 åŸºæœ¬æµç¨‹å¯¹äºŽç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æŽ¥å‘å‡ºCORSè¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œå¢žåŠ ä¸€ä¸ªOriginå­—æ®µã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæµè§ˆå™¨å‘çŽ°è¿™æ¬¡è·¨æºAJAXè¯·æ±‚æ˜¯ç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªOriginå­—æ®µã€‚ 1234567&gt; GET /cors HTTP/1.1&gt; Origin: http://api.bob.com&gt; Host: api.alice.com&gt; Accept-Language: en-US&gt; Connection: keep-alive&gt; User-Agent: Mozilla/5.0...&gt; ä¸Šé¢çš„å¤´ä¿¡æ¯ä¸­ï¼ŒOriginå­—æ®µç”¨æ¥è¯´æ˜Žï¼Œæœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªæºï¼ˆåè®® + åŸŸå + ç«¯å£ï¼‰ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå€¼ï¼Œå†³å®šæ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚ã€‚ å¦‚æžœOriginæŒ‡å®šçš„æºï¼Œä¸åœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›žä¸€ä¸ªæ­£å¸¸çš„HTTPå›žåº”ã€‚æµè§ˆå™¨å‘çŽ°ï¼Œè¿™ä¸ªå›žåº”çš„å¤´ä¿¡æ¯æ²¡æœ‰åŒ…å«Access-Control-Allow-Originå­—æ®µï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå°±çŸ¥é“å‡ºé”™äº†ï¼Œä»Žè€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¢«XMLHttpRequestçš„onerrorå›žè°ƒå‡½æ•°æ•èŽ·ã€‚æ³¨æ„ï¼Œè¿™ç§é”™è¯¯æ— æ³•é€šè¿‡çŠ¶æ€ç è¯†åˆ«ï¼Œå› ä¸ºHTTPå›žåº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯200ã€‚ å¦‚æžœOriginæŒ‡å®šçš„åŸŸååœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨è¿”å›žçš„å“åº”ï¼Œä¼šå¤šå‡ºå‡ ä¸ªå¤´ä¿¡æ¯å­—æ®µã€‚ 12345&gt; Access-Control-Allow-Origin: http://api.bob.com&gt; Access-Control-Allow-Credentials: true&gt; Access-Control-Expose-Headers: FooBar&gt; Content-Type: text/html; charset=utf-8&gt; ä¸Šé¢çš„å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸ŽCORSè¯·æ±‚ç›¸å…³çš„å­—æ®µï¼Œéƒ½ä»¥Access-Control-å¼€å¤´ã€‚ ï¼ˆ1ï¼‰Access-Control-Allow-Origin è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ã€‚å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶Originå­—æ®µçš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª*ï¼Œè¡¨ç¤ºæŽ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ã€‚ ï¼ˆ2ï¼‰Access-Control-Allow-Credentials è¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieä¸åŒ…æ‹¬åœ¨CORSè¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸ºtrueï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜Žç¡®è®¸å¯ï¼ŒCookieå¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸ºtrueï¼Œå¦‚æžœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚ ï¼ˆ3ï¼‰Access-Control-Expose-Headers è¯¥å­—æ®µå¯é€‰ã€‚CORSè¯·æ±‚æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°6ä¸ªåŸºæœ¬å­—æ®µï¼šCache-Controlã€Content-Languageã€Content-Typeã€Expiresã€Last-Modifiedã€Pragmaã€‚å¦‚æžœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨Access-Control-Expose-Headersé‡Œé¢æŒ‡å®šã€‚ä¸Šé¢çš„ä¾‹å­æŒ‡å®šï¼ŒgetResponseHeader(&#39;FooBar&#39;)å¯ä»¥è¿”å›žFooBarå­—æ®µçš„å€¼ã€‚ 3.2 withCredentials å±žæ€§ä¸Šé¢è¯´åˆ°ï¼ŒCORSè¯·æ±‚é»˜è®¤ä¸å‘é€Cookieå’ŒHTTPè®¤è¯ä¿¡æ¯ã€‚å¦‚æžœè¦æŠŠCookieå‘åˆ°æœåŠ¡å™¨ï¼Œä¸€æ–¹é¢è¦æœåŠ¡å™¨åŒæ„ï¼ŒæŒ‡å®šAccess-Control-Allow-Credentialså­—æ®µã€‚ 12&gt; Access-Control-Allow-Credentials: true&gt; å¦ä¸€æ–¹é¢ï¼Œå¼€å‘è€…å¿…é¡»åœ¨AJAXè¯·æ±‚ä¸­æ‰“å¼€withCredentialså±žæ€§ã€‚ 123&gt; var xhr = new XMLHttpRequest();&gt; xhr.withCredentials = true;&gt; å¦åˆ™ï¼Œå³ä½¿æœåŠ¡å™¨åŒæ„å‘é€Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå‘é€ã€‚æˆ–è€…ï¼ŒæœåŠ¡å™¨è¦æ±‚è®¾ç½®Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå¤„ç†ã€‚ ä½†æ˜¯ï¼Œå¦‚æžœçœç•¥withCredentialsè®¾ç½®ï¼Œæœ‰çš„æµè§ˆå™¨è¿˜æ˜¯ä¼šä¸€èµ·å‘é€Cookieã€‚è¿™æ—¶ï¼Œå¯ä»¥æ˜¾å¼å…³é—­withCredentialsã€‚ 12&gt; xhr.withCredentials = false;&gt; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœè¦å‘é€Cookieï¼ŒAccess-Control-Allow-Originå°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·ï¼Œå¿…é¡»æŒ‡å®šæ˜Žç¡®çš„ã€ä¸Žè¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåã€‚åŒæ—¶ï¼ŒCookieä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„Cookieæ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„Cookieå¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”ï¼ˆè·¨æºï¼‰åŽŸç½‘é¡µä»£ç ä¸­çš„document.cookieä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„Cookieã€‚ å››ã€éžç®€å•è¯·æ±‚4.1 é¢„æ£€è¯·æ±‚éžç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯PUTæˆ–DELETEï¼Œæˆ–è€…Content-Typeå­—æ®µçš„ç±»åž‹æ˜¯application/jsonã€‚ éžç®€å•è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢žåŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚ æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„XMLHttpRequestè¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚ ä¸‹é¢æ˜¯ä¸€æ®µæµè§ˆå™¨çš„JavaScriptè„šæœ¬ã€‚ 123456&gt; var url = 'http://api.alice.com/cors';&gt; var xhr = new XMLHttpRequest();&gt; xhr.open('PUT', url, true);&gt; xhr.setRequestHeader('X-Custom-Header', 'value');&gt; xhr.send();&gt; ä¸Šé¢ä»£ç ä¸­ï¼ŒHTTPè¯·æ±‚çš„æ–¹æ³•æ˜¯PUTï¼Œå¹¶ä¸”å‘é€ä¸€ä¸ªè‡ªå®šä¹‰å¤´ä¿¡æ¯X-Custom-Headerã€‚ æµè§ˆå™¨å‘çŽ°ï¼Œè¿™æ˜¯ä¸€ä¸ªéžç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨å‘å‡ºä¸€ä¸ªâ€é¢„æ£€â€è¯·æ±‚ï¼Œè¦æ±‚æœåŠ¡å™¨ç¡®è®¤å¯ä»¥è¿™æ ·è¯·æ±‚ã€‚ä¸‹é¢æ˜¯è¿™ä¸ªâ€é¢„æ£€â€è¯·æ±‚çš„HTTPå¤´ä¿¡æ¯ã€‚ 123456789&gt; OPTIONS /cors HTTP/1.1&gt; Origin: http://api.bob.com&gt; Access-Control-Request-Method: PUT&gt; Access-Control-Request-Headers: X-Custom-Header&gt; Host: api.alice.com&gt; Accept-Language: en-US&gt; Connection: keep-alive&gt; User-Agent: Mozilla/5.0...&gt; â€œé¢„æ£€â€è¯·æ±‚ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯OPTIONSï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ã€‚å¤´ä¿¡æ¯é‡Œé¢ï¼Œå…³é”®å­—æ®µæ˜¯Originï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚ é™¤äº†Originå­—æ®µï¼Œâ€é¢„æ£€â€è¯·æ±‚çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µã€‚ ï¼ˆ1ï¼‰Access-Control-Request-Method è¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„CORSè¯·æ±‚ä¼šç”¨åˆ°å“ªäº›HTTPæ–¹æ³•ï¼Œä¸Šä¾‹æ˜¯PUTã€‚ ï¼ˆ2ï¼‰Access-Control-Request-Headers è¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨CORSè¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œä¸Šä¾‹æ˜¯X-Custom-Headerã€‚ 4.2 é¢„æ£€è¯·æ±‚çš„å›žåº”æœåŠ¡å™¨æ”¶åˆ°â€é¢„æ£€â€è¯·æ±‚ä»¥åŽï¼Œæ£€æŸ¥äº†Originã€Access-Control-Request-Methodå’ŒAccess-Control-Request-Headerså­—æ®µä»¥åŽï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›žåº”ã€‚ 12345678910111213&gt; HTTP/1.1 200 OK&gt; Date: Mon, 01 Dec 2008 01:15:39 GMT&gt; Server: Apache/2.0.61 (Unix)&gt; Access-Control-Allow-Origin: http://api.bob.com&gt; Access-Control-Allow-Methods: GET, POST, PUT&gt; Access-Control-Allow-Headers: X-Custom-Header&gt; Content-Type: text/html; charset=utf-8&gt; Content-Encoding: gzip&gt; Content-Length: 0&gt; Keep-Alive: timeout=2, max=100&gt; Connection: Keep-Alive&gt; Content-Type: text/plain&gt; ä¸Šé¢çš„HTTPå›žåº”ä¸­ï¼Œå…³é”®çš„æ˜¯Access-Control-Allow-Originå­—æ®µï¼Œè¡¨ç¤ºhttp://api.bob.comå¯ä»¥è¯·æ±‚æ•°æ®ã€‚è¯¥å­—æ®µä¹Ÿå¯ä»¥è®¾ä¸ºæ˜Ÿå·ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„è·¨æºè¯·æ±‚ã€‚ 12&gt; Access-Control-Allow-Origin: *&gt; å¦‚æžœæµè§ˆå™¨å¦å®šäº†â€é¢„æ£€â€è¯·æ±‚ï¼Œä¼šè¿”å›žä¸€ä¸ªæ­£å¸¸çš„HTTPå›žåº”ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•CORSç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µã€‚è¿™æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè®¤å®šï¼ŒæœåŠ¡å™¨ä¸åŒæ„é¢„æ£€è¯·æ±‚ï¼Œå› æ­¤è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¢«XMLHttpRequestå¯¹è±¡çš„onerrorå›žè°ƒå‡½æ•°æ•èŽ·ã€‚æŽ§åˆ¶å°ä¼šæ‰“å°å‡ºå¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ã€‚ 123&gt; XMLHttpRequest cannot load http://api.alice.com.&gt; Origin http://api.bob.com is not allowed by Access-Control-Allow-Origin.&gt; æœåŠ¡å™¨å›žåº”çš„å…¶ä»–CORSç›¸å…³å­—æ®µå¦‚ä¸‹ã€‚ 12345&gt; Access-Control-Allow-Methods: GET, POST, PUT&gt; Access-Control-Allow-Headers: X-Custom-Header&gt; Access-Control-Allow-Credentials: true&gt; Access-Control-Max-Age: 1728000&gt; ï¼ˆ1ï¼‰Access-Control-Allow-Methods è¯¥å­—æ®µå¿…éœ€ï¼Œå®ƒçš„å€¼æ˜¯é€—å·åˆ†éš”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜ŽæœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿”å›žçš„æ˜¯æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼Œè€Œä¸å•æ˜¯æµè§ˆå™¨è¯·æ±‚çš„é‚£ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡â€é¢„æ£€â€è¯·æ±‚ã€‚ ï¼ˆ2ï¼‰Access-Control-Allow-Headers å¦‚æžœæµè§ˆå™¨è¯·æ±‚åŒ…æ‹¬Access-Control-Request-Headerså­—æ®µï¼Œåˆ™Access-Control-Allow-Headerså­—æ®µæ˜¯å¿…éœ€çš„ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜ŽæœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µï¼Œä¸é™äºŽæµè§ˆå™¨åœ¨â€é¢„æ£€â€ä¸­è¯·æ±‚çš„å­—æ®µã€‚ ï¼ˆ3ï¼‰Access-Control-Allow-Credentials è¯¥å­—æ®µä¸Žç®€å•è¯·æ±‚æ—¶çš„å«ä¹‰ç›¸åŒã€‚ ï¼ˆ4ï¼‰Access-Control-Max-Age è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚ä¸Šé¢ç»“æžœä¸­ï¼Œæœ‰æ•ˆæœŸæ˜¯20å¤©ï¼ˆ1728000ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›žåº”1728000ç§’ï¼ˆå³20å¤©ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚ 4.3 æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›žåº”ä¸€æ—¦æœåŠ¡å™¨é€šè¿‡äº†â€é¢„æ£€â€è¯·æ±‚ï¼Œä»¥åŽæ¯æ¬¡æµè§ˆå™¨æ­£å¸¸çš„CORSè¯·æ±‚ï¼Œå°±éƒ½è·Ÿç®€å•è¯·æ±‚ä¸€æ ·ï¼Œä¼šæœ‰ä¸€ä¸ªOriginå¤´ä¿¡æ¯å­—æ®µã€‚æœåŠ¡å™¨çš„å›žåº”ï¼Œä¹Ÿéƒ½ä¼šæœ‰ä¸€ä¸ªAccess-Control-Allow-Originå¤´ä¿¡æ¯å­—æ®µã€‚ ä¸‹é¢æ˜¯â€é¢„æ£€â€è¯·æ±‚ä¹‹åŽï¼Œæµè§ˆå™¨çš„æ­£å¸¸CORSè¯·æ±‚ã€‚ 12345678&gt; PUT /cors HTTP/1.1&gt; Origin: http://api.bob.com&gt; Host: api.alice.com&gt; X-Custom-Header: value&gt; Accept-Language: en-US&gt; Connection: keep-alive&gt; User-Agent: Mozilla/5.0...&gt; ä¸Šé¢å¤´ä¿¡æ¯çš„Originå­—æ®µæ˜¯æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ çš„ã€‚ ä¸‹é¢æ˜¯æœåŠ¡å™¨æ­£å¸¸çš„å›žåº”ã€‚ 123&gt; Access-Control-Allow-Origin: http://api.bob.com&gt; Content-Type: text/html; charset=utf-8&gt; ä¸Šé¢å¤´ä¿¡æ¯ä¸­ï¼ŒAccess-Control-Allow-Originå­—æ®µæ˜¯æ¯æ¬¡å›žåº”éƒ½å¿…å®šåŒ…å«çš„ã€‚ äº”ã€ä¸ŽJSONPçš„æ¯”è¾ƒCORSä¸ŽJSONPçš„ä½¿ç”¨ç›®çš„ç›¸åŒï¼Œä½†æ˜¯æ¯”JSONPæ›´å¼ºå¤§ã€‚ JSONPåªæ”¯æŒGETè¯·æ±‚ï¼ŒCORSæ”¯æŒæ‰€æœ‰ç±»åž‹çš„HTTPè¯·æ±‚ã€‚JSONPçš„ä¼˜åŠ¿åœ¨äºŽæ”¯æŒè€å¼æµè§ˆå™¨ï¼Œä»¥åŠå¯ä»¥å‘ä¸æ”¯æŒCORSçš„ç½‘ç«™è¯·æ±‚æ•°æ®ã€‚]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>å‰ç«¯è·¨åŸŸ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Boot AbstractMessageConverterMethodProcessor]]></title>
    <url>%2F2018%2F11%2F16%2FSpring-Boot-AbstractMessageConverterMethodProcessor%2F</url>
    <content type="text"><![CDATA[writeWithMessageConvertersorg.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor#writeWithMessageConverters(T, org.springframework.core.MethodParameter, org.springframework.http.server.ServletServerHttpRequest, org.springframework.http.server.ServletServerHttpResponse) getAcceptableMediaTypesèŽ·å–çš„æ˜¯ è¯·æ±‚å¤´Acceptä¸­çš„MediaType getProducibleMediaTypesèŽ·å–çš„æ˜¯controllerä¸­@Produceræ³¨è§£çš„MediaTypeï¼Œå¦‚æžœä¸¤è€…ä¸ä¸€è‡´ï¼ŒæŠ¥415é”™è¯¯ 12List&lt;MediaType&gt; requestedMediaTypes = getAcceptableMediaTypes(request);List&lt;MediaType&gt; producibleMediaTypes = getProducibleMediaTypes(request, valueType, declaredType); 123456RequestResponseBodyMethodProcessor extends AbstractMessageConverterMethodProcessorAbstractMessageConverterMethodProcessor extends AbstractMessageConverterMethodArgumentResolver implements HandlerMethodReturnValueHandlerAbstractMessageConverterMethodArgumentResolver implements HandlerMethodArgumentResolver]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[MySQLæŸ¥çœ‹å’Œä¿®æ”¹å­—ç¬¦é›†çš„æ–¹æ³•]]></title>
    <url>%2F2018%2F11%2F15%2FMySQL%E6%9F%A5%E7%9C%8B%E5%92%8C%E4%BF%AE%E6%94%B9%E5%AD%97%E7%AC%A6%E9%9B%86%E7%9A%84%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[ä¸€ã€æŸ¥çœ‹å­—ç¬¦é›†1.æŸ¥çœ‹MYSQLæ•°æ®åº“æœåŠ¡å™¨å’Œæ•°æ®åº“å­—ç¬¦é›†12æ–¹æ³•ä¸€ï¼šshow variables like '%character%';æ–¹æ³•äºŒï¼šshow variables like 'collation%'; 123456789mysql&gt; show variables like 'collation%';+----------------------+-----------------+| Variable_name | Value |+----------------------+-----------------+| collation_connection | utf8_general_ci || collation_database | utf8_general_ci || collation_server | utf8_general_ci |+----------------------+-----------------+rows in set (0.00 sec) 123456789mysql&gt; show variables like 'collation%';+----------------------+-----------------+| Variable_name | Value |+----------------------+-----------------+| collation_connection | utf8_general_ci || collation_database | utf8_general_ci || collation_server | utf8_general_ci |+----------------------+-----------------+3 rows in set (0.00 sec) 2.æŸ¥çœ‹MYSQLæ‰€æ”¯æŒçš„å­—ç¬¦é›†1show charset; 123456789101112131415161718192021222324252627282930313233343536373839404142434445mysql&gt; show charset;+----------+-----------------------------+---------------------+--------+| Charset | Description | Default collation | Maxlen |+----------+-----------------------------+---------------------+--------+| big5 | Big5 Traditional Chinese | big5_chinese_ci | 2 || dec8 | DEC West European | dec8_swedish_ci | 1 || cp850 | DOS West European | cp850_general_ci | 1 || hp8 | HP West European | hp8_english_ci | 1 || koi8r | KOI8-R Relcom Russian | koi8r_general_ci | 1 || latin1 | cp1252 West European | latin1_swedish_ci | 1 || latin2 | ISO 8859-2 Central European | latin2_general_ci | 1 || swe7 | 7bit Swedish | swe7_swedish_ci | 1 || ascii | US ASCII | ascii_general_ci | 1 || ujis | EUC-JP Japanese | ujis_japanese_ci | 3 || sjis | Shift-JIS Japanese | sjis_japanese_ci | 2 || hebrew | ISO 8859-8 Hebrew | hebrew_general_ci | 1 || tis620 | TIS620 Thai | tis620_thai_ci | 1 || euckr | EUC-KR Korean | euckr_korean_ci | 2 || koi8u | KOI8-U Ukrainian | koi8u_general_ci | 1 || gb2312 | GB2312 Simplified Chinese | gb2312_chinese_ci | 2 || greek | ISO 8859-7 Greek | greek_general_ci | 1 || cp1250 | Windows Central European | cp1250_general_ci | 1 || gbk | GBK Simplified Chinese | gbk_chinese_ci | 2 || latin5 | ISO 8859-9 Turkish | latin5_turkish_ci | 1 || armscii8 | ARMSCII-8 Armenian | armscii8_general_ci | 1 || utf8 | UTF-8 Unicode | utf8_general_ci | 3 || ucs2 | UCS-2 Unicode | ucs2_general_ci | 2 || cp866 | DOS Russian | cp866_general_ci | 1 || keybcs2 | DOS Kamenicky Czech-Slovak | keybcs2_general_ci | 1 || macce | Mac Central European | macce_general_ci | 1 || macroman | Mac West European | macroman_general_ci | 1 || cp852 | DOS Central European | cp852_general_ci | 1 || latin7 | ISO 8859-13 Baltic | latin7_general_ci | 1 || utf8mb4 | UTF-8 Unicode | utf8mb4_general_ci | 4 || cp1251 | Windows Cyrillic | cp1251_general_ci | 1 || utf16 | UTF-16 Unicode | utf16_general_ci | 4 || cp1256 | Windows Arabic | cp1256_general_ci | 1 || cp1257 | Windows Baltic | cp1257_general_ci | 1 || utf32 | UTF-32 Unicode | utf32_general_ci | 4 || binary | Binary pseudo charset | binary | 1 || geostd8 | GEOSTD8 Georgian | geostd8_general_ci | 1 || cp932 | SJIS for Windows Japanese | cp932_japanese_ci | 2 || eucjpms | UJIS for Windows Japanese | eucjpms_japanese_ci | 3 |+----------+-----------------------------+---------------------+--------+39 rows in set (0.00 sec) 3.æŸ¥çœ‹åº“çš„å­—ç¬¦é›†è¯­æ³•ï¼šshow database status from åº“å like è¡¨å; 12345mysql&gt; show create database shiyan\G*************************** 1. row *************************** Database: shiyanCreate Database: CREATE DATABASE `shiyan` /*!40100 DEFAULT CHARACTER SET gbk */1 row in set (0.00 sec) 4.æŸ¥çœ‹è¡¨çš„å­—ç¬¦é›†è¯­æ³•ï¼šshow table status from åº“å like è¡¨å; 1mysql&gt; show table status from class_7 like 'test_info'; 1234567mysql&gt; show table status from class_7 like 'test_info';+-----------+--------+---------+------------+------+----------------+-------------------------+-------------+------------+-----------------+----------+-| Name | Engine | Version | Row_format | Rows | Avg_row_length | Data_leate_time | Update_time | Check_time | Collation | Checksum |+-----------+--------+---------+------------+------+----------------+-------------------------+-------------+------------+-----------------+----------+-| test_info | InnoDB | 10 | Compact | 10 | 1638 | 17-12-05 19:01:55 | NULL | NULL | utf8_general_ci | NULL |+-----------+--------+---------+------------+------+----------------+-------------------------+-------------+------------+-----------------+----------+-1 row in set (0.00 sec) 5.æŸ¥çœ‹è¡¨ä¸­æ‰€æœ‰åˆ—çš„å­—ç¬¦é›†è¯­æ³•ï¼šshow full columns from è¡¨å; 1mysql&gt; show full columns from test_info; 1234567891011mysql&gt; show full columns from test_info;+-------+----------+-----------------+------+-----+---------+-------+---------------------------------+---------+| Field | Type | Collation | Null | Key | Default | Extra | Privileges | Comment |+-------+----------+-----------------+------+-----+---------+-------+---------------------------------+---------+| id | int(3) | NULL | NO | PRI | NULL | | select,insert,update,references | || name | char(12) | utf8_general_ci | YES | | NULL | | select,insert,update,references | || dorm | char(10) | utf8_general_ci | YES | | NULL | | select,insert,update,references | || addr | char(12) | utf8_general_ci | YES | | æœªçŸ¥ | | select,insert,update,references | || score | int(3) | NULL | YES | | NULL | | select,insert,update,references | |+-------+----------+-----------------+------+-----+---------+-------+---------------------------------+---------+5 rows in set (0.00 sec) äºŒã€è®¾ç½®å­—ç¬¦é›†è®¾ç½®å­—ç¬¦é›†ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™è®¾ç½®å­—ç¬¦é›†ï¼Œå¦ä¸€ç§æ˜¯è¡¨å»ºæˆä¹‹åŽä¿®æ”¹å­—ç¬¦é›†ã€‚ 1.åˆ›å»ºæ—¶æŒ‡å®šå­—ç¬¦é›†åˆ›å»ºåº“çš„æ—¶å€™æŒ‡å®šå­—ç¬¦é›†ï¼š è¯­æ³•ï¼šcreate database åº“å default character set=å­—ç¬¦é›†ï¼› 1create database db2 default character set=utf8 åˆ›å»ºè¡¨çš„æ—¶å€™æŒ‡å®šå­—ç¬¦é›†ï¼š è¯­æ³•ï¼šcreate table è¡¨åï¼ˆå±žæ€§ï¼‰default character set = å­—ç¬¦é›†ï¼› 12mysql&gt; create table test1(id int(6),name char(10)) default character set = 'gbk';Query OK, 0 rows affected (0.39 sec) 2.ä¿®æ”¹å­—ç¬¦é›†ä¿®æ”¹å…¨å±€å­—ç¬¦é›†123456789101112131415161718/*å»ºç«‹è¿žæŽ¥ä½¿ç”¨çš„ç¼–ç */set character_set_connection=utf8;/*æ•°æ®åº“çš„ç¼–ç */set character_set_database=utf8;/*ç»“æžœé›†çš„ç¼–ç */set character_set_results=utf8;/*æ•°æ®åº“æœåŠ¡å™¨çš„ç¼–ç */set character_set_server=utf8;set character_set_system=utf8;set collation_connection=utf8;set collation_database=utf8;set collation_server=utf8;ä¿®æ”¹å…¨å±€å­—ç¬¦é›† ä¿®æ”¹åº“çš„å­—ç¬¦é›†è¯­æ³•ï¼šalter database åº“å default character set å­—ç¬¦é›†; 1alter database shiyan default character set gbk; ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†è¯­æ³•ï¼šalter table è¡¨å convert to character set å­—ç¬¦é›†; 1alter table test1 convert to character set utf8; ä¿®æ”¹å­—æ®µçš„å­—ç¬¦é›†è¯­æ³•ï¼šalter table è¡¨å modify å­—æ®µå å­—æ®µå±žæ€§ character set gbkï¼› 1alter table test1 modify name char(10) character set gbk; 123456789101112131415161718192021mysql&gt; show full columns from test1;+-------+----------+-----------------+------+-----+---------+-------+---------------------------------+---------+| Field | Type | Collation | Null | Key | Default | Extra | Privileges | Comment |+-------+----------+-----------------+------+-----+---------+-------+---------------------------------+---------+| id | int(6) | NULL | YES | | NULL | | select,insert,update,references | || name | char(10) | utf8_general_ci | YES | | NULL | | select,insert,update,references | |+-------+----------+-----------------+------+-----+---------+-------+---------------------------------+---------+2 rows in set (0.01 sec)mysql&gt; alter table test1 modify name char(10) character set gbk;Query OK, 0 rows affected (0.58 sec)Records: 0 Duplicates: 0 Warnings: 0mysql&gt; show full columns from test1;+-------+----------+----------------+------+-----+---------+-------+---------------------------------+---------+| Field | Type | Collation | Null | Key | Default | Extra | Privileges | Comment |+-------+----------+----------------+------+-----+---------+-------+---------------------------------+---------+| id | int(6) | NULL | YES | | NULL | | select,insert,update,references | || name | char(10) | gbk_chinese_ci | YES | | NULL | | select,insert,update,references | |+-------+----------+----------------+------+-----+---------+-------+---------------------------------+---------+2 rows in set (0.01 sec) character setå³å­—ç¬¦é›† æˆ‘ä»¬å¸¸çœ‹åˆ°çš„UTF-8ã€GB2312ã€GB18030éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„character setã€‚å³å¯¹Unicodeçš„ä¸€å¥—ç¼–ç ã€‚ collationå³æ¯”å¯¹æ–¹æ³• ç”¨äºŽæŒ‡å®šæ•°æ®é›†å¦‚ä½•æŽ’åºï¼Œä»¥åŠå­—ç¬¦ä¸²çš„æ¯”å¯¹è§„åˆ™ã€‚ collationåå­—çš„è§„åˆ™å¯ä»¥å½’çº³ä¸ºè¿™ä¸¤ç±»ï¼š _bin ä¾‹å¦‚ï¼š utf8_danish_ci ciæ˜¯case insensitiveçš„ç¼©å†™ï¼Œcsæ˜¯case sensitiveçš„ç¼©å†™ã€‚å³ï¼ŒæŒ‡å®šå¤§å°å†™æ˜¯å¦æ•æ„Ÿã€‚ utf8_binæ˜¯å°†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ç”¨äºŒè¿›åˆ¶æ•°æ®å­˜å‚¨ï¼ŒåŒºåˆ†å¤§å°å†™ã€‚ å¥‡æ€ªçš„æ˜¯utf8å­—ç¬¦é›†å¯¹åº”çš„collationå±…ç„¶æ²¡æœ‰ä¸€ä¸ªæ˜¯csçš„ã€‚]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æµ…è°ˆspringMVCä¸­çš„è®¾è®¡æ¨¡å¼â€”â€”ç»„åˆæ¨¡å¼]]></title>
    <url>%2F2018%2F11%2F09%2F%E6%B5%85%E8%B0%88springMVC%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[å®šä¹‰æƒ¯ä¾‹æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€çœ‹ç»„åˆæ¨¡å¼çš„å®šä¹‰ï¼šç»„åˆæ¨¡å¼ï¼Œå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æž„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æž„ï¼Œç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚é€šä¿—çš„æ¥è¯´ï¼Œå°±æ˜¯è®²ä¸€ç³»åˆ—çš„å¯¹è±¡ç»„åˆåœ¨ä¸€ä¸ªæ•´ä½“çš„å¯¹è±¡ä¸­ï¼Œç”¨æˆ·åœ¨å¯¹è¿™ä¸ªç»„åˆå¯¹è±¡æ“ä½œä½¿ç”¨æ—¶å°±èƒ½è·Ÿæ“ä½œä¸€ä¸ªå¯¹è±¡ä¸€æ ·ã€‚ WebMvcConfigurerComposite1. component -&gt; WebMvcConfigureræŠ½è±¡æŽ¥å£12345678public interface WebMvcConfigurer &#123;... default void addInterceptors(InterceptorRegistry registry) &#123; &#125;...&#125; 2. leaf å…·ä½“å®žçŽ° -&gt; è‡ªå®šä¹‰å®žçŽ°1234567891011121314151617@Beanpublic WebMvcConfigurer webMvcConfigurer()&#123; WebMvcConfigurer configurer = new WebMvcConfigurer() &#123; @Override public void addInterceptors(InterceptorRegistry registry) &#123; registry.addInterceptor(new HandlerInterceptor() &#123; @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; System.out.println("handleræ‰§è¡Œå‰"); return true; &#125; &#125;); &#125; &#125;; return configurer;&#125; 3. compositeå®¹å™¨ -&gt; WebMvcConfigurerComposite@EnableWebMvc â€‹ @Import(DelegatingWebMvcConfiguration.class) â€‹ WebMvcConfigurerComposite æœ¬èº«ä¹Ÿå®žçŽ°component WebMvcConfigureræŽ¥å£ï¼Œå¹¶å­˜åœ¨List&lt;WebMvcConfigurer&gt; delegatesï¼Œå¯¹æ‰€æœ‰çš„leafè¿›è¡Œç»Ÿä¸€é…ç½® 1234567891011121314151617181920class WebMvcConfigurerComposite implements WebMvcConfigurer &#123; private final List&lt;WebMvcConfigurer&gt; delegates = new ArrayList&lt;&gt;(); public void addWebMvcConfigurers(List&lt;WebMvcConfigurer&gt; configurers) &#123; if (!CollectionUtils.isEmpty(configurers)) &#123; this.delegates.addAll(configurers); &#125; &#125; @Override public void configurePathMatch(PathMatchConfigurer configurer) &#123; for (WebMvcConfigurer delegate : this.delegates) &#123; delegate.configurePathMatch(configurer); &#125; &#125; ...&#125;]]></content>
      <categories>
        <category>Spring</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•ä¿è¯å¾®æœåŠ¡æŽ¥å£çš„å¹‚ç­‰æ€§]]></title>
    <url>%2F2018%2F10%2F16%2F%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%B9%82%E7%AD%89%E6%80%A7%2F</url>
    <content type="text"><![CDATA[åœ¨å¾®æœåŠ¡æž¶æž„ä¸‹ï¼Œæˆ‘ä»¬åœ¨å®Œæˆä¸€ä¸ªè®¢å•æµç¨‹æ—¶ç»å¸¸é‡åˆ°ä¸‹é¢çš„åœºæ™¯ï¼š ä¸€ä¸ªè®¢å•åˆ›å»ºæŽ¥å£ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨è¶…æ—¶äº†ï¼Œç„¶åŽè°ƒç”¨æ–¹é‡è¯•äº†ä¸€æ¬¡ åœ¨è®¢å•åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬éœ€è¦åŽ»æ‰£å‡åº“å­˜ï¼Œè¿™æ—¶æŽ¥å£å‘ç”Ÿäº†è¶…æ—¶ï¼Œè°ƒç”¨æ–¹é‡è¯•äº†ä¸€æ¬¡ å½“è¿™ç¬”è®¢å•å¼€å§‹æ”¯ä»˜ï¼Œåœ¨æ”¯ä»˜è¯·æ±‚å‘å‡ºä¹‹åŽï¼Œåœ¨æœåŠ¡ç«¯å‘ç”Ÿäº†æ‰£é’±æ“ä½œï¼ŒæŽ¥å£å“åº”è¶…æ—¶äº†ï¼Œè°ƒç”¨æ–¹é‡è¯•äº†ä¸€æ¬¡ ä¸€ä¸ªè®¢å•çŠ¶æ€æ›´æ–°æŽ¥å£ï¼Œè°ƒç”¨æ–¹è¿žç»­å‘é€äº†ä¸¤ä¸ªæ¶ˆæ¯ï¼Œä¸€ä¸ªæ˜¯å·²åˆ›å»ºï¼Œä¸€ä¸ªæ˜¯å·²ä»˜æ¬¾ã€‚ä½†æ˜¯ä½ å…ˆæŽ¥æ”¶åˆ°å·²ä»˜æ¬¾ï¼Œç„¶åŽåˆæŽ¥æ”¶åˆ°äº†å·²åˆ›å»º åœ¨æ”¯ä»˜å®Œæˆè®¢å•ä¹‹åŽï¼Œéœ€è¦å‘é€ä¸€æ¡çŸ­ä¿¡ï¼Œå½“ä¸€å°æœºå™¨æŽ¥æ”¶åˆ°çŸ­ä¿¡å‘é€çš„æ¶ˆæ¯ä¹‹åŽï¼Œå¤„ç†è¾ƒæ…¢ã€‚æ¶ˆæ¯ä¸­é—´ä»¶åˆæŠŠæ¶ˆæ¯æŠ•é€’ç»™å¦å¤–ä¸€å°æœºå™¨å¤„ç† ä»¥ä¸Šé—®é¢˜ï¼Œå°±æ˜¯åœ¨å•ä½“æž¶æž„è½¬æˆå¾®æœåŠ¡æž¶æž„ä¹‹åŽï¼Œå¸¦æ¥çš„é—®é¢˜ã€‚å½“ç„¶ä¸æ˜¯è¯´å•ä½“æž¶æž„ä¸‹æ²¡æœ‰è¿™äº›é—®é¢˜ï¼Œåœ¨å•ä½“æž¶æž„ä¸‹åŒæ ·è¦é¿å…é‡å¤è¯·æ±‚ã€‚ä½†æ˜¯å‡ºçŽ°çš„é—®é¢˜è¦æ¯”è¿™å°‘å¾—å¤šã€‚ ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œå°±éœ€è¦ä¿è¯æŽ¥å£çš„å¹‚ç­‰æ€§ï¼ŒæŽ¥å£çš„å¹‚ç­‰æ€§å®žé™…ä¸Šå°±æ˜¯æŽ¥å£å¯é‡å¤è°ƒç”¨ï¼Œåœ¨è°ƒç”¨æ–¹å¤šæ¬¡è°ƒç”¨çš„æƒ…å†µä¸‹ï¼ŒæŽ¥å£æœ€ç»ˆå¾—åˆ°çš„ç»“æžœæ˜¯ä¸€è‡´çš„ã€‚æœ‰äº›æŽ¥å£å¯ä»¥å¤©ç„¶çš„å®žçŽ°å¹‚ç­‰æ€§ï¼Œæ¯”å¦‚æŸ¥è¯¢æŽ¥å£ï¼Œå¯¹äºŽæŸ¥è¯¢æ¥è¯´ï¼Œä½ æŸ¥è¯¢ä¸€æ¬¡å’Œä¸¤æ¬¡ï¼Œå¯¹äºŽç³»ç»Ÿæ¥è¯´ï¼Œæ²¡æœ‰ä»»ä½•å½±å“ï¼ŒæŸ¥å‡ºçš„ç»“æžœä¹Ÿæ˜¯ä¸€æ ·ã€‚ é™¤äº†æŸ¥è¯¢åŠŸèƒ½å…·æœ‰å¤©ç„¶çš„å¹‚ç­‰æ€§ä¹‹å¤–ï¼Œå¢žåŠ ã€æ›´æ–°ã€åˆ é™¤éƒ½è¦ä¿è¯å¹‚ç­‰æ€§ã€‚é‚£ä¹ˆå¦‚ä½•æ¥ä¿è¯å¹‚ç­‰æ€§å‘¢ï¼Ÿ å…¨å±€å”¯ä¸€IDå¦‚æžœä½¿ç”¨å…¨å±€å”¯ä¸€IDï¼Œå°±æ˜¯æ ¹æ®ä¸šåŠ¡çš„æ“ä½œå’Œå†…å®¹ç”Ÿæˆä¸€ä¸ªå…¨å±€IDï¼Œåœ¨æ‰§è¡Œæ“ä½œå‰å…ˆæ ¹æ®è¿™ä¸ªå…¨å±€å”¯ä¸€IDæ˜¯å¦å­˜åœ¨ï¼Œæ¥åˆ¤æ–­è¿™ä¸ªæ“ä½œæ˜¯å¦å·²ç»æ‰§è¡Œã€‚å¦‚æžœä¸å­˜åœ¨åˆ™æŠŠå…¨å±€IDï¼Œå­˜å‚¨åˆ°å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚æ•°æ®åº“ã€redisç­‰ã€‚å¦‚æžœå­˜åœ¨åˆ™è¡¨ç¤ºè¯¥æ–¹æ³•å·²ç»æ‰§è¡Œã€‚ ä»Žå·¥ç¨‹çš„è§’åº¦æ¥è¯´ï¼Œä½¿ç”¨å…¨å±€IDåšå¹‚ç­‰å¯ä»¥ä½œä¸ºä¸€ä¸ªä¸šåŠ¡çš„åŸºç¡€çš„å¾®æœåŠ¡å­˜åœ¨ï¼Œåœ¨å¾ˆå¤šçš„å¾®æœåŠ¡ä¸­éƒ½ä¼šç”¨åˆ°è¿™æ ·çš„æœåŠ¡ï¼Œåœ¨æ¯ä¸ªå¾®æœåŠ¡ä¸­éƒ½å®Œæˆè¿™æ ·çš„åŠŸèƒ½ï¼Œä¼šå­˜åœ¨å·¥ä½œé‡é‡å¤ã€‚å¦å¤–æ‰“é€ ä¸€ä¸ªé«˜å¯é çš„å¹‚ç­‰æœåŠ¡è¿˜éœ€è¦è€ƒè™‘å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚ä¸€å°æœºå™¨è™½ç„¶æŠŠå…¨å±€IDå…ˆå†™å…¥äº†å­˜å‚¨ï¼Œä½†æ˜¯åœ¨å†™å…¥ä¹‹åŽæŒ‚äº†ï¼Œè¿™å°±éœ€è¦å¼•å…¥å…¨å±€IDçš„è¶…æ—¶æœºåˆ¶ã€‚ ä½¿ç”¨å…¨å±€å”¯ä¸€IDæ˜¯ä¸€ä¸ªé€šç”¨æ–¹æ¡ˆï¼Œå¯ä»¥æ”¯æŒæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ä¸šåŠ¡æ“ä½œã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆçœ‹èµ·æ¥å¾ˆç¾Žä½†æ˜¯å®žçŽ°èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä¸‹é¢çš„æ–¹æ¡ˆé€‚ç”¨äºŽç‰¹å®šçš„åœºæ™¯ï¼Œä½†æ˜¯å®žçŽ°èµ·æ¥æ¯”è¾ƒç®€å•ã€‚ åŽ»é‡è¡¨è¿™ç§æ–¹æ³•é€‚ç”¨äºŽåœ¨ä¸šåŠ¡ä¸­æœ‰å”¯ä¸€æ ‡çš„æ’å…¥åœºæ™¯ä¸­ï¼Œæ¯”å¦‚åœ¨ä»¥ä¸Šçš„æ”¯ä»˜åœºæ™¯ä¸­ï¼Œå¦‚æžœä¸€ä¸ªè®¢å•åªä¼šæ”¯ä»˜ä¸€æ¬¡ï¼Œæ‰€ä»¥è®¢å•IDå¯ä»¥ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å»ºä¸€å¼ åŽ»é‡è¡¨ï¼Œå¹¶ä¸”æŠŠå”¯ä¸€æ ‡è¯†ä½œä¸ºå”¯ä¸€ç´¢å¼•ï¼Œåœ¨æˆ‘ä»¬å®žçŽ°æ—¶ï¼ŒæŠŠåˆ›å»ºæ”¯ä»˜å•æ®å’Œå†™å…¥åŽ»åŽ»é‡è¡¨ï¼Œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¦‚æžœé‡å¤åˆ›å»ºï¼Œæ•°æ®åº“ä¼šæŠ›å‡ºå”¯ä¸€çº¦æŸå¼‚å¸¸ï¼Œæ“ä½œå°±ä¼šå›žæ»šã€‚ æ’å…¥æˆ–æ›´æ–°è¿™ç§æ–¹æ³•æ’å…¥å¹¶ä¸”æœ‰å”¯ä¸€ç´¢å¼•çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬è¦å…³è”å•†å“å“ç±»ï¼Œå…¶ä¸­å•†å“çš„IDå’Œå“ç±»çš„IDå¯ä»¥æž„æˆå”¯ä¸€ç´¢å¼•ï¼Œå¹¶ä¸”åœ¨æ•°æ®è¡¨ä¸­ä¹Ÿå¢žåŠ äº†å”¯ä¸€ç´¢å¼•ã€‚è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨InsertOrUpdateæ“ä½œã€‚åœ¨mysqlæ•°æ®åº“ä¸­å¦‚ä¸‹ï¼š 1234insert into goods_category (goods_id,category_id,create_time,update_time) values(#&#123;goodsId&#125;,#&#123;categoryId&#125;,now(),now()) on DUPLICATE KEY UPDATE update_time=now() å¤šç‰ˆæœ¬æŽ§åˆ¶è¿™ç§æ–¹æ³•é€‚åˆåœ¨æ›´æ–°çš„åœºæ™¯ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦æ›´æ–°å•†å“çš„åå­—ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥åœ¨æ›´æ–°çš„æŽ¥å£ä¸­å¢žåŠ ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¥åšå¹‚ç­‰ 1boolean updateGoodsName(int id,String newName,int version); åœ¨å®žçŽ°æ—¶å¯ä»¥å¦‚ä¸‹ 1update goods set name=#&#123;newName&#125;,version=#&#123;version&#125; where id=#&#123;id&#125; and version&lt;$&#123;version&#125; çŠ¶æ€æœºæŽ§åˆ¶è¿™ç§æ–¹æ³•é€‚åˆåœ¨æœ‰çŠ¶æ€æœºæµè½¬çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚å°±ä¼šè®¢å•çš„åˆ›å»ºå’Œä»˜æ¬¾ï¼Œè®¢å•çš„ä»˜æ¬¾è‚¯å®šæ˜¯åœ¨ä¹‹å‰ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è®¾è®¡çŠ¶æ€å­—æ®µæ—¶ï¼Œä½¿ç”¨intç±»åž‹ï¼Œå¹¶ä¸”é€šè¿‡å€¼ç±»åž‹çš„å¤§å°æ¥åšå¹‚ç­‰ï¼Œæ¯”å¦‚è®¢å•çš„åˆ›å»ºä¸º0ï¼Œä»˜æ¬¾æˆåŠŸä¸º100ã€‚ä»˜æ¬¾å¤±è´¥ä¸º99 åœ¨åšçŠ¶æ€æœºæ›´æ–°æ—¶ï¼Œæˆ‘ä»¬å°±è¿™å¯ä»¥è¿™æ ·æŽ§åˆ¶ 1update order set status=#&#123;status&#125; where id=#&#123;id&#125; and status&lt;#&#123;status&#125;]]></content>
      <categories>
        <category>å¾®æœåŠ¡</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[2PCåˆ°3PCåˆ°Paxosåˆ°Raftåˆ°ISR]]></title>
    <url>%2F2018%2F10%2F15%2F2PC%E5%88%B03PC%E5%88%B0Paxos%E5%88%B0Raft%E5%88%B0ISR%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼ç†è®ºç³»åˆ— ä»ŽACIDåˆ°CAPåˆ°BASE 2PCåˆ°3PCåˆ°Paxosåˆ°Raftåˆ°ISR å¤åˆ¶ã€åˆ†ç‰‡å’Œè·¯ç”± å‰¯æœ¬æ›´æ–°ç­–ç•¥ è´Ÿè½½å‡è¡¡ç®—æ³•åŠæ‰‹æ®µ RWNåŠQuorumä¸Žå¼ºä¸€è‡´æ€§ åºæœ¬æ–‡ä¸»è¦è®²è¿°2PCåŠ3PCï¼Œä»¥åŠPaxosä»¥åŠRaftåè®®ã€‚ ä¸¤ç±»ä¸€è‡´æ€§(æ“ä½œåŽŸå­æ€§ä¸Žå‰¯æœ¬ä¸€è‡´æ€§) 2PCåè®®ç”¨äºŽä¿è¯å±žäºŽå¤šä¸ªæ•°æ®åˆ†ç‰‡ä¸Šçš„æ“ä½œçš„åŽŸå­æ€§ã€‚è¿™äº›æ•°æ®åˆ†ç‰‡å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œ2PCåè®®ä¿è¯å¤šå°æœåŠ¡å™¨ä¸Šçš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ Paxosåè®®ç”¨äºŽä¿è¯åŒä¸€ä¸ªæ•°æ®åˆ†ç‰‡çš„å¤šä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚å½“è¿™äº›å‰¯æœ¬åˆ†å¸ƒåˆ°ä¸åŒçš„æ•°æ®ä¸­å¿ƒæ—¶ï¼Œè¿™ä¸ªéœ€æ±‚å°¤å…¶å¼ºçƒˆã€‚ ä¸€ã€2PCï¼ˆé˜»å¡žã€æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€å•ç‚¹é—®é¢˜ï¼‰1Two-Phase Commitï¼Œä¸¤é˜¶æ®µæäº¤ 1ã€é˜¶æ®µä¸€ï¼šæäº¤äº‹åŠ¡è¯·æ±‚ï¼ˆæŠ•ç¥¨é˜¶æ®µï¼‰ï¼ˆ1ï¼‰äº‹åŠ¡è¯¢é—® 1åè°ƒè€…å‘æ‰€æœ‰çš„å‚ä¸Žè€…å‘é€äº‹åŠ¡å†…å®¹ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸Žè€…çš„å“åº” ï¼ˆ2ï¼‰æ‰§è¡Œäº‹åŠ¡ 1å„å‚ä¸Žè€…èŠ‚ç‚¹æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†Undoå’ŒRedoä¿¡æ¯è®¡å…¥äº‹åŠ¡æ—¥å¿—ä¸­ ï¼ˆ3ï¼‰å„å‚ä¸Žè€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡è¯¢é—®çš„å“åº” 1å¦‚æžœå‚ä¸Žè€…æˆåŠŸæ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œé‚£ä¹ˆå°±åé¦ˆç»™åè°ƒè€…Yeså“åº”ï¼Œè¡¨ç¤ºäº‹åŠ¡å¯ä»¥æ‰§è¡Œï¼›å¦‚æžœå‚ä¸Žè€…æ²¡æœ‰æˆåŠŸæ‰§è¡Œäº‹åŠ¡ï¼Œé‚£ä¹ˆå°±åé¦ˆç»™åè°ƒè€…Noå“åº”ï¼Œè¡¨ç¤ºäº‹åŠ¡ä¸å¯ä»¥æ‰§è¡Œã€‚ 2ã€é˜¶æ®µäºŒï¼šæ‰§è¡Œäº‹åŠ¡æäº¤ï¼ˆæ‰§è¡Œé˜¶æ®µï¼‰ï¼ˆ1ï¼‰æ‰§è¡Œäº‹åŠ¡æäº¤ 1å¦‚æžœæ‰€æœ‰å‚ä¸Žè€…çš„åé¦ˆéƒ½æ˜¯Yeså“åº”ï¼Œé‚£ä¹ˆ Aã€å‘é€æäº¤è¯·æ±‚ 1åè°ƒè€…å‘æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹å‘å‡ºCommitè¯·æ±‚ Bã€äº‹åŠ¡æäº¤ 1å‚ä¸Žè€…æŽ¥æ”¶åˆ°Commitè¯·æ±‚åŽï¼Œä¼šæ­£å¼æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶åœ¨å®Œæˆæäº¤ä¹‹åŽé‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´å ç”¨çš„äº‹åŠ¡èµ„æº Cã€åé¦ˆäº‹åŠ¡æäº¤ç»“æžœ 1å‚ä¸Žè€…åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åŽï¼Œå‘åè°ƒè€…å‘é€ACKä¿¡æ¯ Dã€å®Œæˆäº‹åŠ¡ 1åè°ƒè€…æŽ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…åé¦ˆçš„ACKæ¶ˆæ¯åŽï¼Œå®Œæˆäº‹åŠ¡ ï¼ˆ2ï¼‰ä¸­æ–­äº‹åŠ¡ 1ä»»ä½•ä¸€ä¸ªå‚ä¸Žè€…åé¦ˆäº†Noå“åº”ï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åŽï¼Œåè°ƒè€…å°šæ— æ³•æŽ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…çš„åé¦ˆå“åº”ï¼Œé‚£ä¹ˆå°±ä¼šä¸­æ–­äº‹åŠ¡ã€‚ Aã€å‘é€å›žæ»šè¯·æ±‚ 1åè°ƒè€…å‘æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹å‘å‡ºRollbackè¯·æ±‚ Bã€äº‹åŠ¡å›žæ»š 1å‚ä¸Žè€…æŽ¥æ”¶åˆ°rollbackè¯·æ±‚åŽï¼Œä¼šåˆ©ç”¨å…¶åœ¨é˜¶æ®µä¸€ä¸­è®°å½•çš„Undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡å›žæ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›žæ»šä¹‹åŽé‡Šæ”¾æ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´å ç”¨çš„èµ„æº Cã€åé¦ˆäº‹åŠ¡å›žæ»šç»“æžœ 1å‚ä¸Žè€…åœ¨å®Œæˆäº‹åŠ¡å›žæ»šä¹‹åŽï¼Œå‘åè°ƒè€…å‘é€ACKä¿¡æ¯ Dã€ä¸­æ–­äº‹åŠ¡ 1åè°ƒè€…æŽ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…åé¦ˆçš„ACKä¿¡æ¯åŽï¼Œå®Œæˆäº‹åŠ¡ä¸­æ–­ ä¼˜ç¼ºç‚¹ä¼˜ç‚¹ï¼šåŽŸç†ç®€å•ã€å®žçŽ°æ–¹ä¾¿ç¼ºç‚¹ï¼šåŒæ­¥é˜»å¡žã€å•ç‚¹é—®é¢˜ã€æ•°æ®ä¸ä¸€è‡´ã€å¤ªè¿‡ä¿å®ˆ ï¼ˆ1ï¼‰åŒæ­¥é˜»å¡žåŒæ­¥é˜»å¡žä¼šæžå¤§åœ°é™åˆ¶åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ€§èƒ½ã€‚åœ¨äºŒé˜¶æ®µæäº¤çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å‚ä¸Žè¯¥äº‹åŠ¡æ“ä½œçš„é€»è¾‘éƒ½å¤„äºŽé˜»å¡žçŠ¶æ€ï¼Œå„ä¸ªå‚ä¸Žè€…åœ¨ç­‰å¾…å…¶ä»–å‚ä¸Žè€…å“åº”çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ— æ³•è¿›è¡Œå…¶ä»–ä»»ä½•æ“ä½œã€‚ ï¼ˆ2ï¼‰å•ç‚¹é—®é¢˜ä¸€æ—¦åè°ƒè€…å‡ºçŽ°é—®é¢˜ï¼Œé‚£ä¹ˆæ•´ä¸ªäºŒé˜¶æ®µæäº¤æµç¨‹å°†æ— æ³•è¿è½¬ï¼Œæ›´ä¸ºä¸¥é‡çš„æ˜¯ï¼Œå¦‚æžœæ˜¯åœ¨é˜¶æ®µäºŒä¸­å‡ºçŽ°é—®é¢˜ï¼Œé‚£ä¹ˆå…¶ä»–å‚ä¸Žè€…å°†ä¼šä¸€ç›´å¤„äºŽé”å®šäº‹åŠ¡èµ„æºçš„çŠ¶æ€ä¸­ï¼Œæ— æ³•ç»§ç»­å®Œæˆäº‹åŠ¡æ“ä½œã€‚ ï¼ˆ3ï¼‰æ•°æ®ä¸ä¸€è‡´åœ¨é˜¶æ®µäºŒï¼Œå½“åè°ƒè€…å‘æ‰€æœ‰å‚ä¸Žè€…å‘é€commitè¯·æ±‚ä¹‹åŽï¼Œå‘ç”Ÿäº†å±€éƒ¨ç½‘ç»œå¼‚å¸¸æˆ–åè°ƒè€…åœ¨å°šæœªå‘å®Œcommitè¯·æ±‚ä¹‹å‰è‡ªèº«å‘ç”Ÿäº†å´©æºƒï¼Œå¯¼è‡´æœ€ç»ˆåªæœ‰éƒ¨åˆ†å‚ä¸Žè€…æŽ¥æ”¶åˆ°äº†commitè¯·æ±‚ï¼ŒäºŽæ˜¯è¿™éƒ¨åˆ†å‚ä¸Žè€…æ‰§è¡Œäº‹åŠ¡æäº¤ï¼Œè€Œæ²¡æ”¶åˆ°commitè¯·æ±‚çš„å‚ä¸Žè€…åˆ™æ— æ³•è¿›è¡Œäº‹åŠ¡æäº¤ï¼ŒäºŽæ˜¯æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå‡ºçŽ°äº†æ•°æ®ä¸ä¸€è‡´æ€§çŽ°è±¡ã€‚ ï¼ˆ4ï¼‰å¤ªè¿‡ä¿å®ˆå¦‚æžœå‚ä¸Žè€…åœ¨ä¸Žåè°ƒè€…é€šä¿¡æœŸé—´å‡ºçŽ°æ•…éšœï¼Œåè°ƒè€…åªèƒ½é è¶…æ—¶æœºåˆ¶æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸­æ–­äº‹åŠ¡ï¼Œè¿™ä¸ªç­–ç•¥æ¯”è¾ƒä¿å®ˆï¼Œéœ€è¦æ›´ä¸ºå®Œå–„çš„å®¹é”™æœºåˆ¶ï¼Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„å¤±è´¥éƒ½ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡çš„å¤±è´¥ã€‚ äºŒã€3PCï¼ˆè§£å†³2PCçš„é˜»å¡žï¼Œä½†è¿˜æ˜¯å¯èƒ½é€ æˆæ•°æ®ä¸ä¸€è‡´ï¼‰Three-Phase Commitï¼Œä¸‰é˜¶æ®µæäº¤ï¼Œåˆ†ä¸ºCanCommitã€PreCommitã€do Commitä¸‰ä¸ªé˜¶æ®µã€‚ ä¸ºäº†é¿å…åœ¨é€šçŸ¥æ‰€æœ‰å‚ä¸Žè€…æäº¤äº‹åŠ¡æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªå‚ä¸Žè€…crashä¸ä¸€è‡´æ—¶ï¼Œå°±å‡ºçŽ°äº†ä¸‰é˜¶æ®µæäº¤çš„æ–¹å¼ã€‚ä¸‰é˜¶æ®µæäº¤åœ¨ä¸¤é˜¶æ®µæäº¤çš„åŸºç¡€ä¸Šå¢žåŠ äº†ä¸€ä¸ªpreCommitçš„è¿‡ç¨‹ï¼Œå½“æ‰€æœ‰å‚ä¸Žè€…æ”¶åˆ°preCommitåŽï¼Œå¹¶ä¸æ‰§è¡ŒåŠ¨ä½œï¼Œç›´åˆ°æ”¶åˆ°commitæˆ–è¶…è¿‡ä¸€å®šæ—¶é—´åŽæ‰å®Œæˆæ“ä½œã€‚ 1ã€é˜¶æ®µä¸€CanCommit ï¼ˆ1ï¼‰äº‹åŠ¡è¯¢é—®åè°ƒè€…å‘å„å‚ä¸Žè€…å‘é€CanCommitçš„è¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸Žè€…çš„å“åº” ï¼ˆ2ï¼‰å‚ä¸Žè€…å‘åè°ƒè€…åé¦ˆè¯¢é—®çš„å“åº”å‚ä¸Žè€…æ”¶åˆ°CanCommitè¯·æ±‚åŽï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æžœè‡ªèº«è®¤ä¸ºå¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼Œé‚£ä¹ˆä¼šåé¦ˆYeså“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ï¼Œå¦åˆ™åé¦ˆNoã€‚ 2ã€é˜¶æ®µäºŒPreCommitï¼ˆ1ï¼‰æ‰§è¡Œäº‹åŠ¡é¢„æäº¤1å¦‚æžœåè°ƒè€…æŽ¥æ”¶åˆ°å„å‚ä¸Žè€…åé¦ˆéƒ½æ˜¯Yesï¼Œé‚£ä¹ˆæ‰§è¡Œäº‹åŠ¡é¢„æäº¤ Aã€å‘é€é¢„æäº¤è¯·æ±‚åè°ƒè€…å‘å„å‚ä¸Žè€…å‘é€preCommitè¯·æ±‚ï¼Œå¹¶è¿›å…¥preparedé˜¶æ®µ Bã€äº‹åŠ¡é¢„æäº¤å‚ä¸Žè€…æŽ¥æ”¶åˆ°preCommitè¯·æ±‚åŽï¼Œä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†Undoå’ŒRedoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥è®°ä¸­ Cã€å„å‚ä¸Žè€…å‘åè°ƒè€…åé¦ˆäº‹åŠ¡æ‰§è¡Œçš„å“åº”å¦‚æžœå„å‚ä¸Žè€…éƒ½æˆåŠŸæ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œé‚£ä¹ˆåé¦ˆç»™åè°ƒè€…Ackå“åº”ï¼ŒåŒæ—¶ç­‰å¾…æœ€ç»ˆæŒ‡ä»¤ï¼Œæäº¤commitæˆ–è€…ç»ˆæ­¢abort ï¼ˆ2ï¼‰ä¸­æ–­äº‹åŠ¡å¦‚æžœä»»ä½•ä¸€ä¸ªå‚ä¸Žè€…å‘åè°ƒè€…åé¦ˆäº†Noå“åº”ï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶åŽï¼Œåè°ƒè€…æ— æ³•æŽ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…çš„åé¦ˆï¼Œé‚£ä¹ˆå°±ä¼šä¸­æ–­äº‹åŠ¡ã€‚ Aã€å‘é€ä¸­æ–­è¯·æ±‚ 1åè°ƒè€…å‘æ‰€æœ‰å‚ä¸Žè€…å‘é€abortè¯·æ±‚ Bã€ä¸­æ–­äº‹åŠ¡ 1æ— è®ºæ˜¯æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„abortè¯·æ±‚ï¼Œè¿˜æ˜¯ç­‰å¾…è¶…æ—¶ï¼Œå‚ä¸Žè€…éƒ½ä¸­æ–­äº‹åŠ¡ 3ã€é˜¶æ®µä¸‰doCommitï¼ˆ1ï¼‰æ‰§è¡Œæäº¤ Aã€å‘é€æäº¤è¯·æ±‚å‡è®¾åè°ƒè€…æ­£å¸¸å·¥ä½œï¼ŒæŽ¥æ”¶åˆ°äº†æ‰€æœ‰å‚ä¸Žè€…çš„ackå“åº”ï¼Œé‚£ä¹ˆå®ƒå°†ä»Žé¢„æäº¤é˜¶æ®µè¿›å…¥æäº¤çŠ¶æ€ï¼Œå¹¶å‘æ‰€æœ‰å‚ä¸Žè€…å‘é€doCommitè¯·æ±‚ Bã€äº‹åŠ¡æäº¤å‚ä¸Žè€…æ”¶åˆ°doCommitè¯·æ±‚åŽï¼Œæ­£å¼æäº¤äº‹åŠ¡ï¼Œå¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤åŽé‡Šæ”¾å ç”¨çš„èµ„æº Cã€åé¦ˆäº‹åŠ¡æäº¤ç»“æžœå‚ä¸Žè€…å®Œæˆäº‹åŠ¡æäº¤åŽï¼Œå‘åè°ƒè€…å‘é€ACKä¿¡æ¯ Dã€å®Œæˆäº‹åŠ¡åè°ƒè€…æŽ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…ackä¿¡æ¯ï¼Œå®Œæˆäº‹åŠ¡ ï¼ˆ2ï¼‰ä¸­æ–­äº‹åŠ¡å‡è®¾åè°ƒè€…æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”æœ‰ä»»ä¸€å‚ä¸Žè€…åé¦ˆNoï¼Œæˆ–è€…åœ¨ç­‰å¾…è¶…æ—¶åŽæ— æ³•æŽ¥æ”¶æ‰€æœ‰å‚ä¸Žè€…çš„åé¦ˆï¼Œéƒ½ä¼šä¸­æ–­äº‹åŠ¡ Aã€å‘é€ä¸­æ–­è¯·æ±‚åè°ƒè€…å‘æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹å‘é€abortè¯·æ±‚ Bã€äº‹åŠ¡å›žæ»šå‚ä¸Žè€…æŽ¥æ”¶åˆ°abortè¯·æ±‚åŽï¼Œåˆ©ç”¨undoæ—¥å¿—æ‰§è¡Œäº‹åŠ¡å›žæ»šï¼Œå¹¶åœ¨å®Œæˆäº‹åŠ¡å›žæ»šåŽé‡Šæ”¾å ç”¨çš„èµ„æº Cã€åé¦ˆäº‹åŠ¡å›žæ»šç»“æžœå‚ä¸Žè€…åœ¨å®Œæˆäº‹åŠ¡å›žæ»šä¹‹åŽï¼Œå‘åè°ƒè€…å‘é€ackä¿¡æ¯ Dã€ä¸­æ–­äº‹åŠ¡åè°ƒè€…æŽ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…åé¦ˆçš„ackä¿¡æ¯åŽï¼Œä¸­æ–­äº‹åŠ¡ã€‚ é˜¶æ®µä¸‰å¯èƒ½å‡ºçŽ°çš„é—®é¢˜ï¼šåè°ƒè€…å‡ºçŽ°é—®é¢˜ã€åè°ƒè€…ä¸Žå‚ä¸Žè€…ä¹‹é—´ç½‘ç»œå‡ºçŽ°æ•…éšœã€‚ä¸è®ºå‡ºçŽ°å“ªç§æƒ…å†µï¼Œæœ€ç»ˆéƒ½ä¼šå¯¼è‡´å‚ä¸Žè€…æ— æ³•åŠæ—¶æŽ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„doCommitæˆ–æ˜¯abortè¯·æ±‚ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå‚ä¸Žè€…éƒ½ä¼šåœ¨ç­‰å¾…è¶…æ—¶åŽï¼Œç»§ç»­è¿›è¡Œäº‹åŠ¡æäº¤ï¼ˆtimeoutåŽä¸­æ–­äº‹åŠ¡ï¼‰ã€‚ ä¼˜ç‚¹ï¼šé™ä½Žå‚ä¸Žè€…é˜»å¡žèŒƒå›´ï¼Œå¹¶èƒ½å¤Ÿåœ¨å‡ºçŽ°å•ç‚¹æ•…éšœåŽç»§ç»­è¾¾æˆä¸€è‡´ç¼ºç‚¹ï¼šå¼•å…¥preCommité˜¶æ®µï¼Œåœ¨è¿™ä¸ªé˜¶æ®µå¦‚æžœå‡ºçŽ°ç½‘ç»œåˆ†åŒºï¼Œåè°ƒè€…æ— æ³•ä¸Žå‚ä¸Žè€…æ­£å¸¸é€šä¿¡ï¼Œå‚ä¸Žè€…ä¾ç„¶ä¼šè¿›è¡Œäº‹åŠ¡æäº¤ï¼Œé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚ ä¸‰ã€Paxosï¼ˆè§£å†³å•ç‚¹é—®é¢˜ï¼‰åŸºäºŽæ¶ˆæ¯ä¼ é€’ä¸”å…·æœ‰é«˜åº¦å®¹é”™æ€§çš„ä¸€è‡´æ€§ç®—æ³•ã€‚Paxosç®—æ³•è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•åœ¨å¯èƒ½å‘ç”Ÿå‡ èµ·å®•æœºæˆ–ç½‘ç»œå¼‚å¸¸çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¿«é€Ÿä¸”æ­£ç¡®åœ°åœ¨é›†ç¾¤å†…éƒ¨å¯¹æŸä¸ªæ•°æ®çš„å€¼è¾¾æˆä¸€è‡´ï¼Œå¹¶ä¸”ä¿è¯ä¸è®ºå‘ç”Ÿä»¥ä¸Šä»»ä½•å¼‚å¸¸ï¼Œéƒ½ä¸ä¼šç ´åæ•´ä¸ªç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚ æ‹œå åº­é—®é¢˜ï¼šæ¶ˆæ¯ä¸å®Œæ•´æˆ–è€…è¢«ç¯¡æ”¹ã€‚Paxosåœ¨ç»´æŒé¢†å¯¼è€…é€‰ä¸¾æˆ–è€…å˜é‡ä¿®æ”¹ä¸€è‡´æ€§ä¸Šï¼Œé‡‡å–ä¸€ç§ç±»ä¼¼è®®ä¼šæŠ•ç¥¨çš„è¿‡åŠåŒæ„æœºåˆ¶ï¼Œæ¯”å¦‚è®¾å®šä¸€ä¸ªé¢†å¯¼è€…ï¼Œéœ€è¦å°†æ­¤çœ‹åšä¸€ä¸ªè®®æ¡ˆï¼Œå¾æ±‚è¿‡åŠåŒæ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹é€šè¿‡ä¸€ä¸ªè®®æ¡ˆä¼šæœ‰ç¼–å·è®°å½•ï¼Œå†æ¬¡æ”¶åˆ°æ­¤é¢†å¯¼è€…çš„ä¸åŒäººé€‰ï¼Œå‘çŽ°å·²ç»æœ‰ç¼–å·è®°å½•ä¾¿é©³å›žï¼Œæœ€åŽä»¥å¤šæ•°é€šè¿‡çš„ç»“æžœä¸ºå‡†ã€‚ æˆ‘ä»¬ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¥é˜è¿°ä¸€ä¸‹Paxosçš„åŸºæœ¬æ€æƒ³ï¼šå‡è®¾æˆ‘ä»¬æœ‰5å°è®¡ç®—æœºAã€Bã€Cã€Dã€Eï¼Œæ¯å°è®¡ç®—æœºä¿å­˜ç€å…¬å¸CEOçš„ä¿¡æ¯ï¼ŒçŽ°åœ¨CEOä»»æœŸåˆ°äº†ï¼Œéœ€è¦è¿›è¡Œæ–°ä¸€ç•Œé€‰ä¸¾äº†ã€‚ Aè®¡ç®—æœºå‘èµ·ä¸€ä¸ªé€‰ä¸¾è®®æ¡ˆï¼Œæè®®CEOä¸ºâ€œå¼ ä¸‰â€ï¼Œå¦‚æžœæ²¡æœ‰å…¶ä»–å€™é€‰äººè®®æ¡ˆï¼Œä¹Ÿæ²¡æœ‰ç½‘ç»œé—®é¢˜ï¼Œåªè¦å…¶ä¸­åŠæ•°ä»¥ä¸Šè®¡ç®—æœºæ”¶åˆ°å¹¶é€šè¿‡è®®æ¡ˆï¼Œé‚£ä¹ˆæœ€ç»ˆâ€œå¼ ä¸‰â€å½“é€‰CEOã€‚ç”±äºŽæ˜¯åˆ†å¸ƒå¼çŽ¯å¢ƒï¼Œå¹¶å‘è¯·æ±‚ã€æœºå™¨æ•…éšœã€ç½‘ç»œæ•…éšœç­‰é—®é¢˜æ˜¯å¸¸æ€ï¼Œå¦‚æžœAå’ŒEåŒæ—¶æäº¤é€‰ä¸¾è®®æ¡ˆï¼ŒAæåâ€œå¼ ä¸‰â€ï¼ŒEæåâ€œæŽå››â€ï¼Œé‚£ä¹ˆè‚¯å®šä¼šæ¶‰åŠå¤šè®¡ç®—æœºçš„ä¸€è‡´æ€§é—®é¢˜äº†ï¼šå‡è®¾Aã€Bã€Cå…ˆæ”¶åˆ°Açš„è®®æ¡ˆï¼ŒDã€Eå…ˆæ”¶åˆ°Eçš„è®®æ¡ˆï¼Œé‚£ä¹ˆAç»§ç»­æäº¤ç»™Dæ—¶ï¼ŒDå‘Šè¯‰å®ƒå·²ç»å…ˆæ”¶åˆ°Eçš„è®®æ¡ˆäº†ï¼Œå› æ­¤é©³å›žäº†Açš„è¯·æ±‚ã€‚åŒæ ·Eç»§ç»­æäº¤ç»™Aã€Bã€Cæ—¶ä¹Ÿç¢°åˆ°ç›¸åŒçš„é—®é¢˜ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡â€œåœ¨æ¯å°è®¡ç®—æœºåŒæ—¶æŽ¥å—è®®æ¡ˆæäº¤æ—¶è®¾ç½®ä¸€ä¸ªç¼–å·ï¼Œç¼–å·å…ˆçš„é€šè¿‡ï¼Œç¼–å·åŽçš„é©³å›žâ€çš„æ–¹å¼æ¥å®žçŽ°ã€‚è®®æ¡ˆæäº¤ä¸ŠåŽ»åŽï¼Œå‘çŽ°Aã€Bã€CæŠ•ç¥¨â€œå¼ ä¸‰â€ä¸ºCEOï¼ŒDã€EæŠ•ç¥¨â€œæŽå››â€ä¸ºCEOï¼Œå°‘æ•°æœä»Žå¤šæ•°ï¼Œå› æ­¤æœ€åŽç»“æžœä¸ºâ€œå¼ ä¸‰â€å½“é€‰CEOã€‚ å¦‚æžœæ˜¯Cè®¡ç®—æœºå‘ç”Ÿäº†ç½‘ç»œé—®é¢˜æˆ–è€…æ•…éšœï¼ŒåŒæ–¹æŠ•ç¥¨ç›¸åŒï¼Œé‚£ä¹ˆé€‰ä¸¾æ— æ³•å®Œæˆã€‚ å¦‚æžœCè®¡ç®—æœºå‘ç”Ÿäº†ç½‘ç»œé—®é¢˜æˆ–è€…æ•…éšœï¼ŒAã€Bã€DæŠ•ç¥¨â€œå¼ ä¸‰â€ï¼ŒEæŠ•ç¥¨â€œæŽå››â€ï¼Œé‚£ä¹ˆç»“æžœä¸ºâ€œå¼ ä¸‰â€å½“é€‰ï¼Œè€ŒCå¯¹äºŽè¿™äº›æƒ…å†µä¸€æ— æ‰€çŸ¥ï¼Œä½†æ˜¯å½“Cè®¡ç®—æœºæ¢å¤æ­£å¸¸æ—¶ï¼Œä»–ä¼šå‘èµ·ä¸€ä¸ªâ€œè¯¢é—®è°æ˜¯CEOâ€çš„è®®æ¡ˆèŽ·å–æœ€æ–°ä¿¡æ¯ã€‚ç®€è¨€ä¹‹ï¼ŒPaxoså¯¹æ¯ä¸ªèŠ‚ç‚¹çš„å¹¶å‘ä¿®æ”¹é‡‡å–ç¼–å·è®°å½•çš„æ–¹å¼ä¿æŒä¸€è‡´æ€§ï¼Œå¯¹å¤šä¸ªèŠ‚ç‚¹çš„å¹¶å‘ä¿®æ”¹é‡‡å–å°‘æ•°æœä»Žå¤šæ•°çš„æ–¹å¼ä¿æŒä¸€è‡´æ€§ã€‚Paxosæœ‰ç‚¹ç±»ä¼¼åˆ†å¸ƒå¼äºŒé˜¶æ®µæäº¤æ–¹å¼ï¼Œä½†æ˜¯åˆä¸åŒï¼ŒäºŒé˜¶æ®µæäº¤ä¸èƒ½æ˜¯å¤šæ•°èŠ‚ç‚¹åŒæ„ï¼Œå¿…é¡»æ˜¯å…¨éƒ¨åŒæ„ã€‚ä¸ºäº†éµå®ˆè¿‡åŠèŠ‚ç‚¹åŒæ„çš„çº¦æŸï¼ŒPaxosç®—æ³•å¾€å¾€è¦æ±‚èŠ‚ç‚¹æ€»æ•°ä¸ºå¥‡æ•°ã€‚ Paxos ç®—æ³•è§£å†³çš„é—®é¢˜æ˜¯åœ¨ä¸€ä¸ªå¯èƒ½å‘ç”Ÿä¸Šè¿°å¼‚å¸¸çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¦‚ä½•å°±æŸä¸ªå€¼è¾¾æˆä¸€è‡´ï¼Œä¿è¯ä¸è®ºå‘ç”Ÿä»¥ä¸Šä»»ä½•å¼‚å¸¸ï¼Œéƒ½ä¸ä¼šç ´åå†³è®®çš„ä¸€è‡´æ€§ã€‚ä¸€ä¸ªå…¸åž‹çš„åœºæ™¯æ˜¯ï¼Œåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¦‚æžœå„èŠ‚ç‚¹çš„åˆå§‹çŠ¶æ€ä¸€è‡´ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œç›¸åŒçš„æ“ä½œåºåˆ—ï¼Œé‚£ä¹ˆä»–ä»¬æœ€åŽèƒ½å¾—åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚ä¸ºä¿è¯æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œç›¸åŒçš„å‘½ä»¤åºåˆ—ï¼Œéœ€è¦åœ¨æ¯ä¸€æ¡æŒ‡ä»¤ä¸Šæ‰§è¡Œä¸€ä¸ªã€Œä¸€è‡´æ€§ç®—æ³•ã€ä»¥ä¿è¯æ¯ä¸ªèŠ‚ç‚¹çœ‹åˆ°çš„æŒ‡ä»¤ä¸€è‡´ã€‚ä¸€ä¸ªé€šç”¨çš„ä¸€è‡´æ€§ç®—æ³•å¯ä»¥åº”ç”¨åœ¨è®¸å¤šåœºæ™¯ä¸­ï¼Œæ˜¯åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„é‡è¦é—®é¢˜ã€‚ä»Ž20ä¸–çºª80å¹´ä»£èµ·å¯¹äºŽä¸€è‡´æ€§ç®—æ³•çš„ç ”ç©¶å°±æ²¡æœ‰åœæ­¢è¿‡ã€‚ ç®€å•è¯´æ¥ï¼ŒPaxosçš„ç›®çš„æ˜¯è®©æ•´ä¸ªé›†ç¾¤çš„ç»“ç‚¹å¯¹æŸä¸ªå€¼çš„å˜æ›´è¾¾æˆä¸€è‡´ã€‚Paxosç®—æ³•åŸºæœ¬ä¸Šæ¥è¯´æ˜¯ä¸ªæ°‘ä¸»é€‰ä¸¾çš„ç®—æ³•â€”â€”å¤§å¤šæ•°çš„å†³å®šä¼šæˆä¸ªæ•´ä¸ªé›†ç¾¤çš„ç»Ÿä¸€å†³å®šã€‚ä»»ä½•ä¸€ä¸ªç‚¹éƒ½å¯ä»¥æå‡ºè¦ä¿®æ”¹æŸä¸ªæ•°æ®çš„ææ¡ˆï¼Œæ˜¯å¦é€šè¿‡è¿™ä¸ªææ¡ˆå–å†³äºŽè¿™ä¸ªé›†ç¾¤ä¸­æ˜¯å¦æœ‰è¶…è¿‡åŠæ•°çš„ç»“ç‚¹åŒæ„ï¼ˆæ‰€ä»¥Paxosç®—æ³•éœ€è¦é›†ç¾¤ä¸­çš„ç»“ç‚¹æ˜¯å•æ•°ï¼‰ã€‚ è¿™ä¸ªç®—æ³•æœ‰ä¸¤ä¸ªé˜¶æ®µï¼ˆå‡è®¾è¿™ä¸ªæœ‰ä¸‰ä¸ªç»“ç‚¹ï¼šAï¼ŒBï¼ŒCï¼‰ï¼š ç¬¬ä¸€é˜¶æ®µï¼šPrepareé˜¶æ®µAæŠŠç”³è¯·ä¿®æ”¹çš„è¯·æ±‚Prepare Requestå‘ç»™æ‰€æœ‰çš„ç»“ç‚¹Aï¼ŒBï¼ŒCã€‚æ³¨æ„ï¼ŒPaxosç®—æ³•ä¼šæœ‰ä¸€ä¸ªSequence Numberï¼ˆä½ å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªææ¡ˆå·ï¼Œè¿™ä¸ªæ•°ä¸æ–­é€’å¢žï¼Œè€Œä¸”æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´Aå’ŒBä¸å¯èƒ½æœ‰ç›¸åŒçš„ææ¡ˆå·ï¼‰ï¼Œè¿™ä¸ªææ¡ˆå·ä¼šå’Œä¿®æ”¹è¯·æ±‚ä¸€åŒå‘å‡ºï¼Œä»»ä½•ç»“ç‚¹åœ¨â€œPrepareé˜¶æ®µâ€æ—¶éƒ½ä¼šæ‹’ç»å…¶å€¼å°äºŽå½“å‰ææ¡ˆå·çš„è¯·æ±‚ã€‚æ‰€ä»¥ï¼Œç»“ç‚¹Aåœ¨å‘æ‰€æœ‰ç»“ç‚¹ç”³è¯·ä¿®æ”¹è¯·æ±‚çš„æ—¶å€™ï¼Œéœ€è¦å¸¦ä¸€ä¸ªææ¡ˆå·ï¼Œè¶Šæ–°çš„ææ¡ˆï¼Œè¿™ä¸ªææ¡ˆå·å°±è¶Šæ˜¯æ˜¯æœ€å¤§çš„ã€‚ å¦‚æžœæŽ¥æ”¶ç»“ç‚¹æ”¶åˆ°çš„ææ¡ˆå·nå¤§äºŽå…¶å®ƒç»“ç‚¹å‘è¿‡æ¥çš„ææ¡ˆå·ï¼Œè¿™ä¸ªç»“ç‚¹ä¼šå›žåº”Yesï¼ˆæœ¬ç»“ç‚¹ä¸Šæœ€æ–°çš„è¢«æ‰¹å‡†ææ¡ˆå·ï¼‰ï¼Œå¹¶ä¿è¯ä¸æŽ¥æ”¶å…¶å®ƒ&lt;nçš„ææ¡ˆã€‚è¿™æ ·ä¸€æ¥ï¼Œç»“ç‚¹ä¸Šåœ¨Prepareé˜¶æ®µé‡Œæ€»æ˜¯ä¼šå¯¹æœ€æ–°çš„ææ¡ˆåšæ‰¿è¯ºã€‚ ä¼˜åŒ–ï¼šåœ¨ä¸Šè¿° prepare è¿‡ç¨‹ä¸­ï¼Œå¦‚æžœä»»ä½•ä¸€ä¸ªç»“ç‚¹å‘çŽ°å­˜åœ¨ä¸€ä¸ªæ›´é«˜ç¼–å·çš„ææ¡ˆï¼Œåˆ™éœ€è¦é€šçŸ¥ ææ¡ˆäººï¼Œæé†’å…¶ä¸­æ–­è¿™æ¬¡ææ¡ˆã€‚ ç¬¬äºŒé˜¶æ®µï¼šAccepté˜¶æ®µå¦‚æžœææ¡ˆè€…Aæ”¶åˆ°äº†è¶…è¿‡åŠæ•°çš„ç»“ç‚¹è¿”å›žçš„Yesï¼Œç„¶åŽä»–å°±ä¼šå‘æ‰€æœ‰çš„ç»“ç‚¹å‘å¸ƒAccept Requestï¼ˆåŒæ ·ï¼Œéœ€è¦å¸¦ä¸Šææ¡ˆå·nï¼‰ï¼Œå¦‚æžœæ²¡æœ‰è¶…è¿‡åŠæ•°çš„è¯ï¼Œé‚£å°±è¿”å›žå¤±è´¥ã€‚ å½“ç»“ç‚¹ä»¬æ”¶åˆ°äº†Accept RequeståŽï¼Œå¦‚æžœå¯¹äºŽæŽ¥æ”¶çš„ç»“ç‚¹æ¥è¯´ï¼Œnæ˜¯æœ€å¤§çš„äº†ï¼Œé‚£ä¹ˆï¼Œå®ƒå°±ä¼šé€šè¿‡requestï¼ˆä¿®æ”¹è¿™ä¸ªå€¼ï¼‰ï¼Œå¦‚æžœå‘çŽ°è‡ªå·±æœ‰ä¸€ä¸ªæ›´å¤§çš„ææ¡ˆå·ï¼Œé‚£ä¹ˆï¼Œç»“ç‚¹å°±ä¼šæ‹’ç»requestï¼ˆæ‹’ç»ä¿®æ”¹ï¼‰ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹ä»¥ï¼Œè¿™ä¼¼ä¹Žå°±æ˜¯ä¸€ä¸ªâ€œä¸¤æ®µæäº¤â€çš„ä¼˜åŒ–ã€‚å…¶å®žï¼Œ2PC/3PCéƒ½æ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•çš„æ®‹æ¬¡ç‰ˆæœ¬ï¼ŒGoogle Chubbyçš„ä½œè€…Mike Burrowsè¯´è¿‡è¿™ä¸ªä¸–ç•Œä¸Šåªæœ‰ä¸€ç§ä¸€è‡´æ€§ç®—æ³•ï¼Œé‚£å°±æ˜¯Paxosï¼Œå…¶å®ƒçš„ç®—æ³•éƒ½æ˜¯æ®‹æ¬¡å“ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼šå¯¹äºŽåŒä¸€ä¸ªå€¼çš„åœ¨ä¸åŒç»“ç‚¹çš„ä¿®æ”¹ææ¡ˆå°±ç®—æ˜¯åœ¨æŽ¥æ”¶æ–¹è¢«ä¹±åºæ”¶åˆ°ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ å››ã€Raftåè®®(è§£å†³paxosçš„å®žçŽ°éš¾åº¦)Paxos ç›¸æ¯” Raft æ¯”è¾ƒå¤æ‚å’Œéš¾ä»¥ç†è§£ã€‚è§’è‰²æ‰®æ¼”å’Œæµç¨‹æ¯” Raft éƒ½è¦å•°å—¦ã€‚æ¯”å¦‚ Agreement è¿™ä¸ªæµç¨‹ï¼Œåœ¨ Paxos é‡Œè¾¹ï¼šClient å‘èµ·è¯·æ±‚ä¸¾è Proposer æˆä¸º Leaderï¼ŒProposer ç„¶åŽå‘å…¨å±€ Acceptors å¯»æ±‚ç¡®è®¤ï¼ŒAcceptors å…¨éƒ¨åŒæ„ Proposer åŽï¼ŒProposer çš„ Leader åœ°ä½å¾—å·²æ‰¿è®¤ï¼ŒAcceptors è¿˜å¾—å†å‘Learners è¿›è¡Œå…¨å±€å¹¿æ’­æ¥åŒæ­¥ã€‚è€Œåœ¨ Raft é‡Œè¾¹ï¼Œåªæœ‰ Follower/Candidate/Leader ä¸‰ç§è§’è‰²ï¼Œè§’è‰²æœ¬èº«ä»£è¡¨çŠ¶æ€ï¼Œè§’è‰²ä¹‹é—´è¿›è¡ŒçŠ¶æ€è½¬ç§»æ˜¯ä¸€ä»¶éžå¸¸è‡ªç”±æ°‘ä¸»çš„äº‹æƒ…ã€‚Raftè™½ç„¶æœ‰è§’è‰²ä¹‹åˆ†ä½†æ˜¯æ˜¯å…¨æ°‘å‚ä¸Žè¿›è¡Œé€‰ä¸¾çš„æ¨¡å¼ï¼›ä½†æ˜¯åœ¨Paxosé‡Œè¾¹ï¼Œæ„Ÿè§‰æ›´åƒè®®å‘˜å‚æ”¿æ¨¡å¼ã€‚ ä¸‰ä¸ªè§’è‰²followerã€candidateã€leaderã€‚æœ€å¼€å§‹å¤§å®¶éƒ½æ˜¯followerï¼Œå½“followerç›‘å¬ä¸åˆ°leaderï¼Œå°±å¯ä»¥è‡ªå·±æˆä¸ºcandidateï¼Œå‘èµ·æŠ•ç¥¨ leaderé€‰ä¸¾ï¼štimeouté™åˆ¶é€‰ä¸¾çš„timeoutfolloweræˆä¸ºcandidateçš„è¶…æ—¶æ—¶é—´ï¼Œæ¯ä¸ªfolloweréƒ½åœ¨150ms and 300msä¹‹é—´éšæœºï¼Œä¹‹åŽçœ‹è°å…ˆtimeoutï¼Œè°å°±å…ˆæˆä¸ºcandidateï¼Œç„¶åŽå®ƒä¼šå…ˆæŠ•è‡ªå·±ä¸€ç¥¨ï¼Œå†å‘å…¶ä»–èŠ‚ç‚¹å‘èµ·æŠ•ç¥¨é‚€è¯·ã€‚å¦‚æžœå…¶ä»–èŠ‚ç‚¹åœ¨è¿™è½®é€‰ä¸¾è¿˜æ²¡æœ‰æŠ•è¿‡ç¥¨ï¼Œé‚£ä¹ˆå°±ç»™candidateæŠ•ç¥¨ï¼Œç„¶åŽé‡ç½®è‡ªå·±çš„é€‰ä¸¾timeoutã€‚å¦‚æžœå¾—åˆ°å¤§å¤šæ•°çš„æŠ•ç¥¨å°±æˆä¸ºleaderï¼Œä¹‹åŽå®šæœŸå¼€å§‹å‘followerå‘é€å¿ƒè·³ã€‚ å¦‚æžœä¸¤ä¸ªfolloweråŒæ—¶æˆä¸ºcandidateçš„è¯ï¼Œå¦‚æžœæœ€åŽå¾—åˆ°çš„ç¥¨æ•°ç›¸åŒï¼Œåˆ™ç­‰å¾…å…¶ä»–followerçš„é€‰æ‹©timeoutä¹‹åŽæˆä¸ºcandidateï¼Œç»§ç»­å¼€å§‹æ–°ä¸€è½®çš„é€‰ä¸¾ã€‚ logå¤åˆ¶leaderæŠŠå˜åŠ¨çš„logå€ŸåŠ©å¿ƒè·³åŒæ­¥ç»™followerï¼Œè¿‡åŠå›žå¤ä¹‹åŽæ‰æˆåŠŸæäº¤ï¼Œä¹‹åŽå†ä¸‹ä¸€æ¬¡å¿ƒè·³ä¹‹åŽï¼Œfollowerä¹Ÿcommitå˜åŠ¨ï¼Œåœ¨è‡ªå·±çš„nodeä¸Šç”Ÿæ•ˆã€‚ åˆ†è£‚ä¹‹åŽï¼Œå¦ä¸€ä¸ªåˆ†åŒºçš„followeræŽ¥å—ä¸åˆ°leaderçš„timeoutï¼Œç„¶åŽä¼šæœ‰ä¸€ä¸ªå…ˆtimeoutï¼Œæˆä¸ºcandidateï¼Œæœ€åŽæˆä¸ºleaderã€‚äºŽæ˜¯ä¸¤ä¸ªåˆ†åŒºå°±æœ‰äº†ä¸¤ä¸ªleaderã€‚ å½“å®¢æˆ·ç«¯æœ‰å˜åŠ¨æ—¶ï¼Œå…¶ä¸­çš„leaderç”±äºŽæ— æ³•æ”¶åˆ°è¿‡åŠçš„æäº¤ï¼Œåˆ™ä¿æŒæœªæäº¤çŠ¶æ€ã€‚æœ‰çš„leaderçš„ä¿®æ”¹ï¼Œå¯ä»¥å¾—åˆ°è¿‡åŠçš„æäº¤ï¼Œåˆ™å¯ä»¥ä¿®æ”¹ç”Ÿæ•ˆã€‚ å½“åˆ†è£‚æ¢å¤ä¹‹åŽï¼Œleaderå¼€å§‹å¯¹æ¯”é€‰ä¸¾çš„termï¼Œå‘çŽ°æœ‰æ›´é«˜çš„termå­˜åœ¨æ—¶ï¼Œä»–ä»¬ä¼šæ’¤é”€æœªæäº¤çš„ä¿®æ”¹ï¼Œç„¶åŽä»¥æœ€æ–°çš„ä¸ºå‡†ã€‚ äº”ã€ISRçš„æœºåˆ¶(è§£å†³få®¹é”™çš„2f+1æˆæœ¬é—®é¢˜)Kafkaå¹¶æ²¡æœ‰ä½¿ç”¨Zabæˆ–Paxosåè®®çš„å¤šæ•°æŠ•ç¥¨æœºåˆ¶æ¥ä¿è¯ä¸»å¤‡æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè€Œæ˜¯æå‡ºäº†ISRçš„æœºåˆ¶ï¼ˆIn-Sync Replicasï¼‰çš„æœºåˆ¶æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚ ISRè®¤ä¸ºå¯¹äºŽ2f+1ä¸ªå‰¯æœ¬æ¥è¯´ï¼Œå¤šæ•°æŠ•ç¥¨æœºåˆ¶è¦æ±‚æœ€å¤šåªèƒ½å…è®¸fä¸ªå‰¯æœ¬å‘ç”Ÿæ•…éšœï¼Œå¦‚æžœè¦æ”¯æŒ2ä¸ªå‰¯æœ¬çš„å®¹é”™ï¼Œåˆ™éœ€è¦è‡³å°‘ç»´æŒ5ä¸ªå‰¯æœ¬ï¼Œå¯¹äºŽæ¶ˆæ¯ç³»ç»Ÿçš„åœºæ™¯æ¥è¯´ï¼Œæ•ˆçŽ‡å¤ªä½Žã€‚ ISRçš„è¿è¡Œæœºåˆ¶å¦‚ä¸‹ï¼šå°†æ‰€æœ‰æ¬¡çº§å‰¯æœ¬æ•°æ®åˆ†åˆ°ä¸¤ä¸ªé›†åˆï¼Œå…¶ä¸­ä¸€ä¸ªè¢«ç§°ä¸ºISRé›†åˆï¼Œè¿™ä¸ªé›†åˆå¤‡ä»½æ•°æ®çš„ç‰¹ç‚¹æ˜¯å³æ—¶å’Œä¸»å‰¯æœ¬æ•°æ®ä¿æŒä¸€è‡´ï¼Œè€Œå¦å¤–ä¸€ä¸ªé›†åˆçš„å¤‡ä»½æ•°æ®å…è®¸å…¶æ¶ˆæ¯é˜Ÿåˆ—è½åŽäºŽä¸»å‰¯æœ¬çš„æ•°æ®ã€‚åœ¨åšä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œåªå…è®¸ä»ŽISRé›†åˆä¸­é€‰æ‹©ä¸»å‰¯æœ¬ï¼Œåªæœ‰ISRé›†åˆå†…æ‰€æœ‰å¤‡ä»½éƒ½å†™æˆåŠŸæ‰èƒ½è®¤ä¸ºè¿™æ¬¡å†™å…¥æ“ä½œæˆåŠŸã€‚åœ¨å…·ä½“å®žçŽ°æ—¶ï¼Œkafkaåˆ©ç”¨zookeeperæ¥ä¿æŒæ¯ä¸ªISRé›†åˆçš„ä¿¡æ¯ï¼Œå½“ISRé›†åˆå†…æˆå‘˜å˜åŒ–æ—¶ï¼Œç›¸å…³æž„ä»¶ä¹Ÿä¾¿äºŽé€šçŸ¥ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¦‚æžœè®¾å®šISRé›†åˆå¤§å°ä¸ºf+1ï¼Œé‚£ä¹ˆå¯ä»¥æœ€å¤šå…è®¸fä¸ªå‰¯æœ¬æ•…éšœï¼Œè€Œå¯¹äºŽå¤šæ•°æŠ•ç¥¨æœºåˆ¶æ¥è¯´ï¼Œåˆ™éœ€è¦2f+1ä¸ªå‰¯æœ¬æ‰èƒ½è¾¾åˆ°ç›¸åŒçš„å®¹é”™æ€§ã€‚ å‚è€ƒ åˆ†å¸ƒå¼ç³»ç»Ÿçš„Raftç®—æ³• è‹±æ–‡åŠ¨ç”»æ¼”ç¤ºRaft(æŽ¨è) paxos-by-example ä¸ºå•¥CoreOSæ²¡ç”¨Paxosï¼Œé‡æ–°æžäº†Raftï¼Ÿ]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å¾®æœåŠ¡æž¶æž„ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹å¼-GTS]]></title>
    <url>%2F2018%2F10%2F10%2F%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E4%B8%8B%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E5%BC%8F-GTS%2F</url>
    <content type="text"><![CDATA[1 å¾®æœåŠ¡çš„å‘å±•å¾®æœåŠ¡å€¡å¯¼å°†å¤æ‚çš„å•ä½“åº”ç”¨æ‹†åˆ†ä¸ºè‹¥å¹²ä¸ªåŠŸèƒ½ç®€å•ã€æ¾è€¦åˆçš„æœåŠ¡ï¼Œè¿™æ ·å¯ä»¥é™ä½Žå¼€å‘éš¾åº¦ã€å¢žå¼ºæ‰©å±•æ€§ã€ä¾¿äºŽæ•æ·å¼€å‘ã€‚å½“å‰è¢«è¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…æŽ¨å´‡ï¼Œå¾ˆå¤šäº’è”ç½‘è¡Œä¸šå·¨å¤´ã€å¼€æºç¤¾åŒºç­‰éƒ½å¼€å§‹äº†å¾®æœåŠ¡çš„è®¨è®ºå’Œå®žè·µã€‚Hailoæœ‰160ä¸ªä¸åŒæœåŠ¡æž„æˆï¼ŒNetFlixæœ‰å¤§çº¦600ä¸ªæœåŠ¡ã€‚å›½å†…æ–¹é¢ï¼Œé˜¿é‡Œå·´å·´ã€è…¾è®¯ã€360ã€äº¬ä¸œã€58åŒåŸŽç­‰å¾ˆå¤šäº’è”ç½‘å…¬å¸éƒ½è¿›è¡Œäº†å¾®æœåŠ¡åŒ–å®žè·µã€‚å½“å‰å¾®æœåŠ¡çš„å¼€å‘æ¡†æž¶ä¹Ÿéžå¸¸å¤šï¼Œæ¯”è¾ƒè‘—åçš„æœ‰Dubboã€SpringCloudã€thrift ã€grpcç­‰ã€‚ 2 å¾®æœåŠ¡è½åœ°å­˜åœ¨çš„é—®é¢˜è™½ç„¶å¾®æœåŠ¡çŽ°åœ¨å¦‚ç«å¦‚è¼ï¼Œä½†å¯¹å…¶å®žè·µå…¶å®žä»å¤„äºŽæŽ¢ç´¢é˜¶æ®µã€‚å¾ˆå¤šä¸­å°åž‹äº’è”ç½‘å…¬å¸ï¼Œé‰´äºŽç»éªŒã€æŠ€æœ¯å®žåŠ›ç­‰é—®é¢˜ï¼Œå¾®æœåŠ¡è½åœ°æ¯”è¾ƒå›°éš¾ã€‚å¦‚è‘—åæž¶æž„å¸ˆChris Richardsonæ‰€è¨€ï¼Œç›®å‰å­˜åœ¨çš„ä¸»è¦å›°éš¾æœ‰å¦‚ä¸‹å‡ æ–¹é¢ï¼š 1ï¼‰å•ä½“åº”ç”¨æ‹†åˆ†ä¸ºåˆ†å¸ƒå¼ç³»ç»ŸåŽï¼Œè¿›ç¨‹é—´çš„é€šè®¯æœºåˆ¶å’Œæ•…éšœå¤„ç†æŽªæ–½å˜çš„æ›´åŠ å¤æ‚ã€‚ 2ï¼‰ç³»ç»Ÿå¾®æœåŠ¡åŒ–åŽï¼Œä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„åŠŸèƒ½ï¼Œå†…éƒ¨å¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡å¹¶æ“ä½œå¤šä¸ªæ•°æ®åº“å®žçŽ°ï¼ŒæœåŠ¡è°ƒç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜å˜çš„éžå¸¸çªå‡ºã€‚ 3ï¼‰å¾®æœåŠ¡æ•°é‡ä¼—å¤šï¼Œå…¶æµ‹è¯•ã€éƒ¨ç½²ã€ç›‘æŽ§ç­‰éƒ½å˜çš„æ›´åŠ å›°éš¾ã€‚ éšç€RPCæ¡†æž¶çš„æˆç†Ÿï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å·²ç»é€æ¸å¾—åˆ°è§£å†³ã€‚ä¾‹å¦‚dubboå¯ä»¥æ”¯æŒå¤šç§é€šè®¯åè®®ï¼Œspringcloudå¯ä»¥éžå¸¸å¥½çš„æ”¯æŒrestfulè°ƒç”¨ã€‚å¯¹äºŽç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œéšç€dockerã€devopsæŠ€æœ¯çš„å‘å±•ä»¥åŠå„å…¬æœ‰äº‘paaså¹³å°è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·çš„æŽ¨å‡ºï¼Œå¾®æœåŠ¡çš„æµ‹è¯•ã€éƒ¨ç½²ä¸Žè¿ç»´ä¼šå˜å¾—è¶Šæ¥è¶Šå®¹æ˜“ã€‚ è€Œå¯¹äºŽç¬¬äºŒä¸ªé—®é¢˜ï¼ŒçŽ°åœ¨è¿˜æ²¡æœ‰é€šç”¨æ–¹æ¡ˆå¾ˆå¥½çš„è§£å†³å¾®æœåŠ¡äº§ç”Ÿçš„äº‹åŠ¡é—®é¢˜ã€‚åˆ†å¸ƒå¼äº‹åŠ¡å·²ç»æˆä¸ºå¾®æœåŠ¡è½åœ°æœ€å¤§çš„é˜»ç¢ï¼Œä¹Ÿæ˜¯æœ€å…·æŒ‘æˆ˜æ€§çš„ä¸€ä¸ªæŠ€æœ¯éš¾é¢˜ã€‚ ä¸ºæ­¤ï¼Œæœ¬æ–‡å°†æ·±å…¥å’Œå¤§å®¶æŽ¢è®¨å¾®æœåŠ¡æž¶æž„ä¸‹ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„å„ç§è§£å†³æ–¹æ¡ˆï¼Œå¹¶é‡ç‚¹ä¸ºå¤§å®¶è§£è¯»é˜¿é‡Œå·´å·´æå‡ºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆâ€”-GTSã€‚è¯¥æ–¹æ¡ˆä¸­æåˆ°çš„GTSæ˜¯å…¨æ–°ä¸€ä»£è§£å†³å¾®æœåŠ¡é—®é¢˜çš„åˆ†å¸ƒå¼äº‹åŠ¡äº’è”ç½‘ä¸­é—´ä»¶ã€‚ 3 SOAåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ3.1 åŸºäºŽXAåè®®çš„ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆäº¤æ˜“ä¸­é—´ä»¶ä¸Žæ•°æ®åº“é€šè¿‡ XA æŽ¥å£è§„èŒƒï¼Œä½¿ç”¨ä¸¤é˜¶æ®µæäº¤æ¥å®Œæˆä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œ XA è§„èŒƒçš„åŸºç¡€æ˜¯ä¸¤é˜¶æ®µæäº¤åè®®ã€‚ç¬¬ä¸€é˜¶æ®µæ˜¯è¡¨å†³é˜¶æ®µï¼Œæ‰€æœ‰å‚ä¸Žè€…éƒ½å°†æœ¬äº‹åŠ¡èƒ½å¦æˆåŠŸçš„ä¿¡æ¯åé¦ˆå‘ç»™åè°ƒè€…ï¼›ç¬¬äºŒé˜¶æ®µæ˜¯æ‰§è¡Œé˜¶æ®µï¼Œåè°ƒè€…æ ¹æ®æ‰€æœ‰å‚ä¸Žè€…çš„åé¦ˆï¼Œé€šçŸ¥æ‰€æœ‰å‚ä¸Žè€…ï¼Œæ­¥è°ƒä¸€è‡´åœ°åœ¨æ‰€æœ‰åˆ†æ”¯ä¸Šæäº¤æˆ–è€…å›žæ»šã€‚ ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆåº”ç”¨éžå¸¸å¹¿æ³›ï¼Œå‡ ä¹Žæ‰€æœ‰å•†ä¸šOLTPæ•°æ®åº“éƒ½æ”¯æŒXAåè®®ã€‚ä½†æ˜¯ä¸¤é˜¶æ®µæäº¤æ–¹æ¡ˆé”å®šèµ„æºæ—¶é—´é•¿ï¼Œå¯¹æ€§èƒ½å½±å“å¾ˆå¤§ï¼ŒåŸºæœ¬ä¸é€‚åˆè§£å†³å¾®æœåŠ¡äº‹åŠ¡é—®é¢˜ã€‚ 3.2 TCCæ–¹æ¡ˆTCCæ–¹æ¡ˆåœ¨ç”µå•†ã€é‡‘èžé¢†åŸŸè½åœ°è¾ƒå¤šã€‚TCCæ–¹æ¡ˆå…¶å®žæ˜¯ä¸¤é˜¶æ®µæäº¤çš„ä¸€ç§æ”¹è¿›ã€‚å…¶å°†æ•´ä¸ªä¸šåŠ¡é€»è¾‘çš„æ¯ä¸ªåˆ†æ”¯æ˜¾å¼çš„åˆ†æˆäº†Tryã€Confirmã€Cancelä¸‰ä¸ªæ“ä½œã€‚Tryéƒ¨åˆ†å®Œæˆä¸šåŠ¡çš„å‡†å¤‡å·¥ä½œï¼Œconfirméƒ¨åˆ†å®Œæˆä¸šåŠ¡çš„æäº¤ï¼Œcanceléƒ¨åˆ†å®Œæˆäº‹åŠ¡çš„å›žæ»šã€‚åŸºæœ¬åŽŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ äº‹åŠ¡å¼€å§‹æ—¶ï¼Œä¸šåŠ¡åº”ç”¨ä¼šå‘äº‹åŠ¡åè°ƒå™¨æ³¨å†Œå¯åŠ¨äº‹åŠ¡ã€‚ä¹‹åŽä¸šåŠ¡åº”ç”¨ä¼šè°ƒç”¨æ‰€æœ‰æœåŠ¡çš„tryæŽ¥å£ï¼Œå®Œæˆä¸€é˜¶æ®µå‡†å¤‡ã€‚ä¹‹åŽäº‹åŠ¡åè°ƒå™¨ä¼šæ ¹æ®tryæŽ¥å£è¿”å›žæƒ…å†µï¼Œå†³å®šè°ƒç”¨confirmæŽ¥å£æˆ–è€…cancelæŽ¥å£ã€‚å¦‚æžœæŽ¥å£è°ƒç”¨å¤±è´¥ï¼Œä¼šè¿›è¡Œé‡è¯•ã€‚ TCCæ–¹æ¡ˆè®©åº”ç”¨è‡ªå·±å®šä¹‰æ•°æ®åº“æ“ä½œçš„ç²’åº¦ï¼Œä½¿å¾—é™ä½Žé”å†²çªã€æé«˜åžåé‡æˆä¸ºå¯èƒ½ã€‚ å½“ç„¶TCCæ–¹æ¡ˆä¹Ÿæœ‰ä¸è¶³ä¹‹å¤„ï¼Œé›†ä¸­è¡¨çŽ°åœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š å¯¹åº”ç”¨çš„ä¾µå…¥æ€§å¼ºã€‚ä¸šåŠ¡é€»è¾‘çš„æ¯ä¸ªåˆ†æ”¯éƒ½éœ€è¦å®žçŽ°tryã€confirmã€cancelä¸‰ä¸ªæ“ä½œï¼Œåº”ç”¨ä¾µå…¥æ€§è¾ƒå¼ºï¼Œæ”¹é€ æˆæœ¬é«˜ã€‚ å®žçŽ°éš¾åº¦è¾ƒå¤§ã€‚éœ€è¦æŒ‰ç…§ç½‘ç»œçŠ¶æ€ã€ç³»ç»Ÿæ•…éšœç­‰ä¸åŒçš„å¤±è´¥åŽŸå› å®žçŽ°ä¸åŒçš„å›žæ»šç­–ç•¥ã€‚ä¸ºäº†æ»¡è¶³ä¸€è‡´æ€§çš„è¦æ±‚ï¼Œconfirmå’ŒcancelæŽ¥å£å¿…é¡»å®žçŽ°å¹‚ç­‰ã€‚ ä¸Šè¿°åŽŸå› å¯¼è‡´TCCæ–¹æ¡ˆå¤§å¤šè¢«ç ”å‘å®žåŠ›è¾ƒå¼ºã€æœ‰è¿«åˆ‡éœ€æ±‚çš„å¤§å…¬å¸æ‰€é‡‡ç”¨ã€‚å¾®æœåŠ¡å€¡å¯¼æœåŠ¡çš„è½»é‡åŒ–ã€æ˜“éƒ¨ç½²ï¼Œè€ŒTCCæ–¹æ¡ˆä¸­å¾ˆå¤šäº‹åŠ¡çš„å¤„ç†é€»è¾‘éœ€è¦åº”ç”¨è‡ªå·±ç¼–ç å®žçŽ°ï¼Œå¤æ‚ä¸”å¼€å‘é‡å¤§ã€‚ 3.3 åŸºäºŽæ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆæ¶ˆæ¯ä¸€è‡´æ€§æ–¹æ¡ˆæ˜¯é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶ä¿è¯ä¸Šã€ä¸‹æ¸¸åº”ç”¨æ•°æ®æ“ä½œçš„ä¸€è‡´æ€§ã€‚åŸºæœ¬æ€è·¯æ˜¯å°†æœ¬åœ°æ“ä½œå’Œå‘é€æ¶ˆæ¯æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¿è¯æœ¬åœ°æ“ä½œå’Œæ¶ˆæ¯å‘é€è¦ä¹ˆä¸¤è€…éƒ½æˆåŠŸæˆ–è€…éƒ½å¤±è´¥ã€‚ä¸‹æ¸¸åº”ç”¨å‘æ¶ˆæ¯ç³»ç»Ÿè®¢é˜…è¯¥æ¶ˆæ¯ï¼Œæ”¶åˆ°æ¶ˆæ¯åŽæ‰§è¡Œç›¸åº”æ“ä½œã€‚ æ¶ˆæ¯æ–¹æ¡ˆä»Žæœ¬è´¨ä¸Šè®²æ˜¯å°†åˆ†å¸ƒå¼äº‹åŠ¡è½¬æ¢ä¸ºä¸¤ä¸ªæœ¬åœ°äº‹åŠ¡ï¼Œç„¶åŽä¾é ä¸‹æ¸¸ä¸šåŠ¡çš„é‡è¯•æœºåˆ¶è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚åŸºäºŽæ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆå¯¹åº”ç”¨ä¾µå…¥æ€§ä¹Ÿå¾ˆé«˜ï¼Œåº”ç”¨éœ€è¦è¿›è¡Œå¤§é‡ä¸šåŠ¡æ”¹é€ ï¼Œæˆæœ¬è¾ƒé«˜ã€‚ 4 GTSâ€“åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆGTSæ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶ï¼Œç”±é˜¿é‡Œå·´å·´ä¸­é—´ä»¶éƒ¨é—¨ç ”å‘ï¼Œå¯ä»¥ä¸ºå¾®æœåŠ¡æž¶æž„ä¸­çš„åˆ†å¸ƒå¼äº‹åŠ¡æä¾›ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚ æ›´å¤šGTSèµ„æ–™è¯·è®¿é—®åˆ›å§‹äººå¾®åšã€‚ 4.1 GTSçš„æ ¸å¿ƒä¼˜åŠ¿ æ€§èƒ½è¶…å¼º GTSé€šè¿‡å¤§é‡åˆ›æ–°ï¼Œè§£å†³äº†äº‹åŠ¡ACIDç‰¹æ€§ä¸Žé«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€ä½Žä¾µå…¥ä¸å¯å…¼å¾—çš„é—®é¢˜ã€‚å•äº‹åŠ¡åˆ†æ”¯çš„å¹³å‡å“åº”æ—¶é—´åœ¨2mså·¦å³ï¼Œ3å°æœåŠ¡å™¨ç»„æˆçš„é›†ç¾¤å¯ä»¥æ”¯æ’‘3ä¸‡TPSä»¥ä¸Šçš„åˆ†å¸ƒå¼äº‹åŠ¡è¯·æ±‚ã€‚ åº”ç”¨ä¾µå…¥æ€§æžä½Ž GTSå¯¹ä¸šåŠ¡ä½Žä¾µå…¥ï¼Œä¸šåŠ¡ä»£ç æœ€å°‘åªéœ€è¦æ·»åŠ ä¸€è¡Œæ³¨è§£ï¼ˆ@TxcTransactionï¼‰å£°æ˜Žäº‹åŠ¡å³å¯ã€‚ä¸šåŠ¡ä¸Žäº‹åŠ¡åˆ†ç¦»ï¼Œå°†å¾®æœåŠ¡ä»Žäº‹åŠ¡ä¸­è§£æ”¾å‡ºæ¥ï¼Œå¾®æœåŠ¡å…³æ³¨äºŽä¸šåŠ¡æœ¬èº«ï¼Œä¸å†éœ€è¦è€ƒè™‘åå‘æŽ¥å£ã€å¹‚ç­‰ã€å›žæ»šç­–ç•¥ç­‰å¤æ‚é—®é¢˜ï¼Œæžå¤§é™ä½Žäº†å¾®æœåŠ¡å¼€å‘çš„éš¾åº¦ä¸Žå·¥ä½œé‡ã€‚ å®Œæ•´è§£å†³æ–¹æ¡ˆ GTSæ”¯æŒå¤šç§ä¸»æµçš„æœåŠ¡æ¡†æž¶ï¼ŒåŒ…æ‹¬EDASï¼ŒDubboï¼ŒSpring Cloudç­‰ã€‚æœ‰äº›æƒ…å†µä¸‹ï¼Œåº”ç”¨éœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„æŽ¥å£ï¼Œè€Œç¬¬ä¸‰æ–¹ç³»ç»Ÿæ²¡æœ‰æŽ¥å…¥GTSã€‚æ­¤æ—¶éœ€è¦ç”¨åˆ°GTSçš„MTæ¨¡å¼ã€‚GTSçš„MTæ¨¡å¼å¯ä»¥ç­‰ä»·äºŽTCCæ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰æ¯ä¸ªäº‹åŠ¡é˜¶æ®µçš„å…·ä½“è¡Œä¸ºã€‚MTæ¨¡å¼æä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå¯èƒ½æ€§ï¼Œä»¥è¾¾åˆ°ç‰¹æ®Šåœºæ™¯ä¸‹çš„è‡ªå®šä¹‰ä¼˜åŒ–åŠç‰¹æ®ŠåŠŸèƒ½çš„å®žçŽ°ã€‚ å®¹é”™èƒ½åŠ›å¼º GTSè§£å†³äº†XAäº‹åŠ¡åè°ƒå™¨å•ç‚¹é—®é¢˜ï¼Œå®žçŽ°çœŸæ­£çš„é«˜å¯ç”¨ï¼Œå¯ä»¥ä¿è¯å„ç§å¼‚å¸¸æƒ…å†µä¸‹çš„ä¸¥æ ¼æ•°æ®ä¸€è‡´ã€‚ 4.2 GTSçš„åº”ç”¨åœºæ™¯GTSå¯åº”ç”¨åœ¨æ¶‰åŠæœåŠ¡è°ƒç”¨çš„å¤šä¸ªé¢†åŸŸï¼ŒåŒ…æ‹¬ä½†ä¸é™äºŽé‡‘èžæ”¯ä»˜ã€ç”µä¿¡ã€ç”µå­å•†åŠ¡ã€å¿«é€’ç‰©æµã€å¹¿å‘Šè¥é”€ã€ç¤¾äº¤ã€å³æ—¶é€šä¿¡ã€æ‰‹æ¸¸ã€è§†é¢‘ã€ç‰©è”ç½‘ã€è½¦è”ç½‘ç­‰ï¼Œè¯¦ç»†ä»‹ç»å¯ä»¥é˜…è¯» ã€ŠGTSâ€“é˜¿é‡Œå·´å·´åˆ†å¸ƒå¼äº‹åŠ¡å…¨æ–°è§£å†³æ–¹æ¡ˆã€‹ä¸€æ–‡ã€‚ 4.3 GTSä¸Žå¾®æœåŠ¡çš„é›†æˆGTSåŒ…æ‹¬å®¢æˆ·ç«¯ï¼ˆGTS Clientï¼‰ã€èµ„æºç®¡ç†å™¨ï¼ˆGTS RMï¼‰å’Œäº‹åŠ¡åè°ƒå™¨ï¼ˆGTS Serverï¼‰ä¸‰ä¸ªéƒ¨åˆ†ã€‚GTS Clientä¸»è¦ç”¨æ¥ç•Œå®šäº‹åŠ¡è¾¹ç•Œï¼Œå®Œæˆäº‹åŠ¡çš„å‘èµ·ä¸Žç»“æŸã€‚GTS RMå®Œæˆäº‹åŠ¡åˆ†æ”¯çš„åˆ›å»ºã€æäº¤ã€å›žæ»šç­‰æ“ä½œã€‚GTS Serverä¸»è¦è´Ÿè´£åˆ†å¸ƒå¼äº‹åŠ¡çš„æ•´ä½“æŽ¨è¿›ï¼Œäº‹åŠ¡ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ã€‚GTSå’Œå¾®æœåŠ¡é›†æˆçš„ç»“æž„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼ŒGTS Clientéœ€è¦å’Œä¸šåŠ¡åº”ç”¨é›†æˆéƒ¨ç½²ï¼ŒRMä¸Žå¾®æœåŠ¡é›†æˆéƒ¨ç½²ã€‚ 4.4 GTSçš„è¾“å‡ºå½¢å¼GTSç›®å‰æœ‰ä¸‰ç§è¾“å‡ºå½¢å¼ï¼šå…¬æœ‰äº‘è¾“å‡ºã€å…¬ç½‘è¾“å‡ºã€ä¸“æœ‰äº‘è¾“å‡ºã€‚ 4.4.1 å…¬æœ‰äº‘è¾“å‡ºè¿™ç§è¾“å‡ºå½¢å¼é¢å‘é˜¿é‡Œäº‘ç”¨æˆ·ã€‚å¦‚æžœç”¨æˆ·çš„ä¸šåŠ¡ç³»ç»Ÿå·²ç»éƒ¨ç½²åˆ°é˜¿é‡Œäº‘ä¸Šï¼Œå¯ä»¥ç”³è¯·å¼€é€šå…¬æœ‰äº‘GTSã€‚å¼€é€šåŽä¸šåŠ¡åº”ç”¨å³å¯é€šè¿‡GTSä¿è¯æœåŠ¡è°ƒç”¨çš„ä¸€è‡´æ€§ã€‚è¿™ç§ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œä¸šåŠ¡ç³»ç»Ÿå’ŒGTSé—´çš„ç½‘ç»œçŽ¯å¢ƒæ¯”è¾ƒç†æƒ³ï¼Œè¾¾åˆ°å¾ˆå¥½æ€§èƒ½ã€‚ 4.4.2 å…¬ç½‘è¾“å‡ºè¿™ç§è¾“å‡ºå½¢å¼é¢å‘äºŽéžé˜¿é‡Œäº‘çš„ç”¨æˆ·ï¼Œä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€çµæ´»ï¼Œä¸šåŠ¡ç³»ç»Ÿåªè¦èƒ½è¿žæŽ¥äº’è”ç½‘å³å¯äº«å—GTSæä¾›çš„äº‘æœåŠ¡ï¼ˆä¸Žå…¬æœ‰äº‘è¾“å‡ºçš„å·®åˆ«åœ¨äºŽå®¢æˆ·ç«¯éƒ¨ç½²äºŽç”¨æˆ·æœ¬åœ°ï¼Œè€Œä¸åœ¨äº‘ä¸Šï¼‰ã€‚ åœ¨æ­£å¸¸ç½‘ç»œçŽ¯å¢ƒä¸‹ï¼Œä»¥åŒ…å«ä¸¤ä¸ªæœ¬åœ°äº‹åŠ¡çš„å…¨å±€äº‹åŠ¡ä¸ºä¾‹ï¼Œäº‹åŠ¡å®Œæˆæ—¶é—´åœ¨20mså·¦å³ï¼Œ50ä¸ªå¹¶å‘å°±å¯ä»¥è½»æ¾å®žçŽ°1000TPSä»¥ä¸Šåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¯¹ç»å¤§å¤šæ•°ä¸šåŠ¡æ¥è¯´æ€§èƒ½æ˜¯è¶³å¤Ÿçš„ã€‚åœ¨å…¬ç½‘çŽ¯å¢ƒï¼Œç½‘ç»œé—ªæ–­å¾ˆéš¾å®Œå…¨é¿å…ï¼Œè¿™ç§æƒ…å†µä¸‹GTSä»èƒ½ä¿è¯æœåŠ¡è°ƒç”¨çš„æ•°æ®ä¸€è‡´æ€§ã€‚ å…·ä½“ä½¿ç”¨æ ·ä¾‹ä½¿ç”¨å‚è§4.7èŠ‚GTSçš„å·¥ç¨‹æ ·ä¾‹ã€‚ 4.4.3 ä¸“æœ‰äº‘è¾“å‡ºè¿™ç§å½¢å¼ä¸»è¦é¢å‘äºŽå·²å»ºè®¾äº†è‡ªå·±ä¸“æœ‰äº‘å¹³å°çš„å¤§ç”¨æˆ·ï¼ŒGTSå¯ä»¥ç›´æŽ¥éƒ¨ç½²åˆ°ç”¨æˆ·çš„ä¸“æœ‰äº‘ä¸Šï¼Œä¸ºä¸“æœ‰äº‘æä¾›åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚ç›®å‰å·²ç»æœ‰10å¤šä¸ªç‰¹å¤§åž‹ä¼ä¸šçš„ä¸“æœ‰äº‘ä½¿ç”¨GTSè§£å†³åˆ†å¸ƒå¼äº‹åŠ¡éš¾é¢˜ï¼Œæ€§èƒ½ä¸Žç¨³å®šæ€§ç»è¿‡äº†ç”¨æˆ·çš„ä¸¥æ ¼æ£€æµ‹ã€‚ 4.5 GTSçš„ä½¿ç”¨æ–¹å¼GTSå¯¹åº”ç”¨çš„ä¾µå…¥æ€§éžå¸¸ä½Žï¼Œä½¿ç”¨ä¹Ÿå¾ˆç®€å•ã€‚ä¸‹é¢ä»¥è®¢å•å­˜å‚¨åº”ç”¨ä¸ºä¾‹è¯´æ˜Žã€‚è®¢å•ä¸šåŠ¡åº”ç”¨é€šè¿‡è°ƒç”¨è®¢å•æœåŠ¡å’Œåº“å­˜æœåŠ¡å®Œæˆè®¢å•ä¸šåŠ¡ï¼ŒæœåŠ¡å¼€å‘æ¡†æž¶ä¸ºDubboã€‚ 4.5.1 è®¢å•ä¸šåŠ¡åº”ç”¨åœ¨ä¸šåŠ¡å‡½æ•°å¤–å›´ä½¿ç”¨@TxcTransactionæ³¨è§£å³å¯å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡ã€‚Dubboåº”ç”¨é€šè¿‡éšè—å‚æ•°å°†GTSçš„äº‹åŠ¡xidä¼ æ’­åˆ°æœåŠ¡ç«¯ã€‚ 1234567891011121314151617 @TxcTransaction(timeout = 1000 * 10)public void Bussiness(OrderService orderService, StockService stockService, String userId) &#123; //èŽ·å–äº‹åŠ¡ä¸Šä¸‹æ–‡ String xid = TxcContext.getCurrentXid(); //é€šè¿‡RpcContextå°†xidä¼ åˆ°ä¸€ä¸ªæœåŠ¡ç«¯ RpcContext.getContext().setAttachment("xid", xid); //æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ int productId = new Random().nextInt(100); int productNum = new Random().nextInt(100); OrderDO orderDO = new OrderDO(userId, productId, productNum, new Timestamp(new Date().getTime())); orderService.createOrder(orderDO); //é€šè¿‡RpcContextå°†xidä¼ åˆ°å¦ä¸€ä¸ªæœåŠ¡ç«¯ RpcContext.getContext().setAttachment("xid",xid); stockService.updateStock(orderDO);&#125; 4.5.2 æœåŠ¡æä¾›è€…æ›´æ–°åº“å­˜æ–¹æ³• 1234567891011121314151617public int updateStock(OrderDO orderDO) &#123;//èŽ·å–å…¨å±€äº‹åŠ¡IDï¼Œå¹¶ç»‘å®šåˆ°ä¸Šä¸‹æ–‡String xid = RpcContext.getContext().getAttachment("xid");TxcContext.bind(xid,null);//æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘int ret = jdbcTemplate.update("update stock set amount = amount - ? where product_id = ?",new Object[]&#123;orderDO.getNumber(), orderDO.getProductId()&#125;);TxcContext.unbind();return ret;&#125; 4.6 GTSçš„åº”ç”¨æƒ…å†µGTSç›®å‰å·²ç»åœ¨æ·˜å®ã€å¤©çŒ«ã€é˜¿é‡Œå½±ä¸šã€æ·˜ç¥¨ç¥¨ã€é˜¿é‡Œå¦ˆå¦ˆã€1688ç­‰é˜¿é‡Œå„ä¸šåŠ¡ç³»ç»Ÿå¹¿æ³›ä½¿ç”¨ï¼Œç»å—äº†16å¹´å’Œ17å¹´ä¸¤å¹´åŒåä¸€æµ·é‡è¯·æ±‚çš„è€ƒéªŒã€‚æŸçº¿ä¸Šä¸šåŠ¡ç³»ç»Ÿæœ€é«˜æµé‡å·²è¾¾åä¸‡TPSï¼ˆæ¯ç§’é’Ÿ10ä¸‡ç¬”äº‹åŠ¡ï¼‰ã€‚ GTSåœ¨å…¬æœ‰äº‘å’Œä¸“æœ‰äº‘è¾“å‡ºåŽï¼Œå·²ç»æœ‰äº†100å¤šä¸ªçº¿ä¸Šç”¨æˆ·ï¼Œå¾ˆå¤šç”¨æˆ·é€šè¿‡GTSè§£å†³SpringCloudã€Dubboã€Edasç­‰æœåŠ¡æ¡†æž¶çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ä¸šåŠ¡é¢†åŸŸæ¶‰åŠç”µåŠ›ã€ç‰©æµã€ETCã€çƒŸè‰ã€é‡‘èžã€é›¶å”®ã€ç”µå•†ã€å…±äº«å‡ºè¡Œç­‰åå‡ ä¸ªè¡Œä¸šï¼Œå¾—åˆ°ç”¨æˆ·çš„ä¸€è‡´è®¤å¯ã€‚ ä¸Šå›¾æ˜¯GTSä¸ŽSpringCloudé›†æˆï¼Œåº”ç”¨äºŽæŸå…±äº«å‡ºè¡Œç³»ç»Ÿã€‚ä¸šåŠ¡å…±äº«å‡ºè¡Œåœºæ™¯ä¸‹ï¼Œé€šè¿‡GTSæ”¯æ’‘ç‰©è”ç½‘ç³»ç»Ÿã€è®¢å•ç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€è¿ç»´ç³»ç»Ÿã€åˆ†æžç³»ç»Ÿç­‰ç³»å„ç»Ÿåº”ç”¨çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¿è¯æµ·é‡è®¢å•å’Œæ•°åƒä¸‡æµæ°´çš„äº¤æ˜“ã€‚ 4.7 GTSçš„å·¥ç¨‹æ ·ä¾‹GTSçš„å…¬æœ‰äº‘æ ·ä¾‹å¯å‚è€ƒé˜¿é‡Œäº‘ç½‘ç«™ã€‚åœ¨å…¬ç½‘çŽ¯å¢ƒä¸‹æä¾›sample-txc-simpleå’Œsample-txc-dubboä¸¤ä¸ªæ ·ä¾‹å·¥ç¨‹ã€‚ 4.7.1 sample-txc-simpleæ ·ä¾‹4.7.1.1 æ ·ä¾‹ä¸šåŠ¡é€»è¾‘è¯¥æ ·ä¾‹æ˜¯GTSçš„å…¥é—¨sampleï¼Œæ¡ˆä¾‹çš„ä¸šåŠ¡é€»è¾‘æ˜¯ä»ŽAè´¦æˆ·è½¬è´¦ç»™Bè´¦æˆ·ï¼Œå…¶ä¸­Aå’ŒBåˆ†åˆ«ä½äºŽä¸¤ä¸ªMySQLæ•°æ®åº“ä¸­ï¼Œä½¿ç”¨GTSäº‹åŠ¡ä¿è¯Aå’ŒBè´¦æˆ·é’±çš„æ€»æ•°å§‹ç»ˆä¸å˜ã€‚ 4.7.1.2 æ ·ä¾‹æ­å»ºæ–¹æ³•1) å‡†å¤‡æ•°æ®åº“çŽ¯å¢ƒ å®‰è£…MySQLï¼Œåˆ›å»ºä¸¤ä¸ªæ•°æ®åº“db1å’Œdb2ã€‚åœ¨db1å’Œdb2ä¸­åˆ†åˆ«åˆ›å»ºtxc_undo_logè¡¨ï¼ˆSQLè„šæœ¬è§4.7.3ï¼‰ã€‚åœ¨db1åº“ä¸­åˆ›å»ºuser_money_aè¡¨ï¼Œåœ¨db2åº“ä¸­åˆ›å»ºuser_money_bè¡¨ã€‚ 2) ä¸‹è½½æ ·ä¾‹ å°†sample-txc-simpleæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œæ ·ä¾‹ä¸­å·²ç»åŒ…å«äº†GTSçš„SDKã€‚ 3) ä¿®æ”¹é…ç½® æ‰“å¼€sample-txc-simple/src/main/resourcesç›®å½•ä¸‹çš„txc-client-context.xmlï¼Œå°†æ•°æ®æºçš„urlã€usernameã€passwordä¿®æ”¹ä¸ºå®žé™…å€¼ã€‚ 4) è¿è¡Œæ ·ä¾‹ åœ¨sample-txc-simpleç›®å½•ä¸‹æ‰§è¡Œbuild.shç¼–è¯‘æœ¬å·¥ç¨‹ã€‚ç¼–è¯‘å®ŒæˆåŽæ‰§è¡Œrun.shã€‚ 4.7.2 sample-txc-dubbo æ ·ä¾‹4.7.2.1 æ ·ä¾‹ä¸šåŠ¡é€»è¾‘æœ¬æ¡ˆä¾‹æ¨¡æ‹Ÿäº†ç”¨æˆ·ä¸‹è®¢å•ã€å‡åº“å­˜çš„ä¸šåŠ¡é€»è¾‘ã€‚å®¢æˆ·ç«¯ï¼ˆClientï¼‰é€šè¿‡è°ƒç”¨è®¢å•æœåŠ¡ï¼ˆOrderServiceï¼‰åˆ›å»ºè®¢å•ï¼Œä¹‹åŽé€šè¿‡è°ƒç”¨åº“å­˜æœåŠ¡ï¼ˆStockServiceï¼‰æ‰£åº“å­˜ã€‚å…¶ä¸­è®¢å•æœåŠ¡è¯»å†™è®¢å•æ•°æ®åº“ï¼Œåº“å­˜æœåŠ¡è¯»å†™åº“å­˜æ•°æ®åº“ã€‚ç”± GTS ä¿è¯è·¨æœåŠ¡äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚ 4.7.2.2 æ ·ä¾‹æ­å»ºæ–¹æ³•1) å‡†å¤‡æ•°æ®åº“çŽ¯å¢ƒ å®‰è£…MySQLï¼Œåˆ›å»ºä¸¤ä¸ªæ•°æ®åº“db1å’Œdb2ã€‚åœ¨db1å’Œdb2ä¸­åˆ†åˆ«åˆ›å»ºtxc_undo_logè¡¨ã€‚åœ¨db1åº“ä¸­åˆ›å»ºordersè¡¨ï¼Œåœ¨db2åº“ä¸­åˆ›å»ºstockè¡¨ã€‚ 2) ä¸‹è½½æ ·ä¾‹ å°†æ ·ä¾‹æ–‡ä»¶sample-txc-dubboä¸‹è½½åˆ°æœ¬åœ°æœºå™¨ï¼Œæ ·ä¾‹ä¸­å·²ç»åŒ…å«äº†GTSçš„SDKã€‚ 3) ä¿®æ”¹é…ç½® æ‰“å¼€sample-txc-dubbo/src/main/resourcesç›®å½•ï¼Œå°†dubbo-order-service.xmlã€dubbo-stock-service.xmlä¸¤ä¸ªæ–‡ä»¶ä¸­æ•°æ®æºçš„urlã€usernameã€passwordä¿®æ”¹ä¸ºå®žé™…å€¼ã€‚ 4) è¿è¡Œæ ·ä¾‹ a. ç¼–è¯‘ç¨‹åº åœ¨å·¥ç¨‹æ ¹ç›®å½•æ‰§è¡Œ build.sh å‘½ä»¤ï¼Œç¼–è¯‘å·¥ç¨‹ã€‚ç¼–è¯‘åŽä¼šåœ¨ sample-txc-dubbo/client/bin ç›®å½•ä¸‹ç”Ÿæˆ order_run.shã€stock_run.shã€client_run.sh ä¸‰ä¸ªè¿è¡Œè„šæœ¬å¯¹åº”è®¢å•æœåŠ¡ã€åº“å­˜æœåŠ¡ä»¥åŠå®¢æˆ·ç«¯ã€‚ b. è¿è¡Œç¨‹åº åœ¨æ ¹ç›®å½•æ‰§è¡Œrun.shï¼Œè¯¥è„šæœ¬ä¼šä¾æ¬¡å¯åŠ¨order_run.sh(è®¢å•æœåŠ¡)ã€stock_run.sh(åº“å­˜æœåŠ¡)å’Œclient_run.sh(å®¢æˆ·ç«¯ç¨‹åº)ã€‚ 4.7.2.3 å…¶ä»–è¯´æ˜Žæ ·ä¾‹ä½¿ç”¨Multicastæ³¨å†Œä¸­å¿ƒçš„å£°æ˜Žæ–¹å¼ã€‚å¦‚æžœæœ¬æœºä½¿ç”¨æ— çº¿ç½‘ç»œï¼ŒdubboæœåŠ¡åœ¨ç»‘å®šåœ°å€æ—¶æœ‰å¯èƒ½èŽ·å–ipv6åœ°å€ï¼Œå¯ä»¥é€šè¿‡jvmå¯åŠ¨å‚æ•°ç¦ç”¨ã€‚æ–¹æ³•æ˜¯é…ç½®jvmå¯åŠ¨å‚æ•° -Djava.net.preferIPv4Stack=trueã€‚ 4.7.3 SQL4.7.3.1 å»ºè¡¨ txc_undo_logCREATE TABLE txc_undo_log ( id bigint(20) NOT NULL AUTO_INCREMENT COMMENT â€˜ä¸»é”®â€™, gmt_create datetime NOT NULL COMMENT â€˜åˆ›å»ºæ—¶é—´â€™, gmt_modified datetime NOT NULL COMMENT â€˜ä¿®æ”¹æ—¶é—´â€™, xid varchar(100) NOT NULL COMMENT â€˜å…¨å±€äº‹åŠ¡IDâ€™, branch_id bigint(20) NOT NULL COMMENT â€˜åˆ†æ”¯äº‹åŠ¡IDâ€™, rollback_info longblob NOT NULL COMMENT â€˜LOGâ€™, status int(11) NOT NULL COMMENT â€˜çŠ¶æ€â€™, server varchar(32) NOT NULL COMMENT â€˜åˆ†æ”¯æ‰€åœ¨DB IPâ€™, PRIMARY KEY (id), KEY unionkey (xid,branch_id) ) ENGINE=InnoDB AUTO_INCREMENT=211225994 DEFAULT CHARSET=utf8 COMMENT=â€™äº‹åŠ¡æ—¥å¿—è¡¨â€™; 4.7.3.2 å»ºè¡¨ user_money_aCREATE TABLE user_money_a ( id int(11) NOT NULL AUTO_INCREMENT, money int(11) DEFAULT NULL, PRIMARY KEY (id) ) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; 4.7.3.3 å»ºè¡¨ user_money_bCREATE TABLE user_money_b ( id int(11) NOT NULL AUTO_INCREMENT, money int(11) DEFAULT NULL, PRIMARY KEY (id) ) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8; 4.7.3.4 å»ºè¡¨ ordersCREATE TABLE orders ( id bigint(20) NOT NULL AUTO_INCREMENT, user_id varchar(255) NOT NULL, product_id int(11) NOT NULL, number int(11) NOT NULL, gmt_create timestamp NOT NULL, PRIMARY KEY (id) ) ENGINE=MyISAM AUTO_INCREMENT=351 DEFAULT CHARSET=utf8 4.7.3.5 å»ºè¡¨ stockCREATE TABLE stock ( product_id int(11) NOT NULL, price float NOT NULL, amount int(11) NOT NULL, PRIMARY KEY (product_id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8 https://www.cnblogs.com/jiangyu666/p/8522547.html]]></content>
      <categories>
        <category>å¾®æœåŠ¡</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spring AutowireCapableBeanFactory æ•´åˆ quartz]]></title>
    <url>%2F2018%2F09%2F27%2FSpring-AutowireCapableBeanFactory-%E6%95%B4%E5%90%88-quartz%2F</url>
    <content type="text"><![CDATA[èƒŒæ™¯æœ€è¿‘åšspringä¸Žquartzæ•´åˆã€‚ä¸šåŠ¡å®žçŽ°æ—¶ï¼Œéœ€è¦åœ¨jobé‡Œå¼•å…¥springçš„beanï¼Œä½†æ˜¯jobçš„åˆå§‹åŒ–æ—¶quartzåœ¨æ‰§è¡Œæ—¶newå‡ºæ¥çš„ã€‚ä¸å—springçš„ç®¡ç†ï¼Œæ— æ³•æ³¨å…¥ç›¸å…³çš„ä¾èµ–beanã€‚å¤šæ–¹æŸ¥é˜…èµ„æ–™åŽï¼Œå‘çŽ°AutowireCapableBeanFactoryå¯ä»¥å®žçŽ°ç±»ä¼¼åŠŸèƒ½ã€‚ä¸‹é¢å°±é€šè¿‡èµ°è¯»ä»£ç çš„æ–¹å¼æ¥å­¦ä¹ ä¸‹è¿™ä¸ªç±»çš„ç”¨æ³•ã€‚ è¿›å…¥æ­£é¢˜é¦–å…ˆæ¥çœ‹ä¸‹AutowireCapableBeanFactoryçš„å®šä¹‰ï¼š 1234567891011121314151617181920public interface AutowireCapableBeanFactory extends BeanFactory &#123; &lt;T&gt; T createBean(Class&lt;T&gt; beanClass) throws BeansException; void autowireBean(Object existingBean) throws BeansException; Object configureBean(Object existingBean, String beanName) throws BeansException; Object createBean(Class&lt;?&gt; beanClass, int autowireMode, boolean dependencyCheck) throws BeansException; Object autowire(Class&lt;?&gt; beanClass, int autowireMode, boolean dependencyCheck) throws BeansException; void autowireBeanProperties(Object existingBean, int autowireMode, boolean dependencyCheck) throws BeansException; void applyBeanPropertyValues(Object existingBean, String beanName) throws BeansException; Object initializeBean(Object existingBean, String beanName) throws BeansException; Object applyBeanPostProcessorsBeforeInitialization(Object existingBean, String beanName) throws BeansException; Object applyBeanPostProcessorsAfterInitialization(Object existingBean, String beanName) throws BeansException; void destroyBean(Object existingBean); &lt;T&gt; NamedBeanHolder&lt;T&gt; resolveNamedBean(Class&lt;T&gt; requiredType) throws BeansException; Object resolveDependency(DependencyDescriptor descriptor, String requestingBeanName) throws BeansException; Object resolveDependency(DependencyDescriptor descriptor, String requestingBeanName, Set&lt;String&gt; autowiredBeanNames, TypeConverter typeConverter) throws BeansException;&#125; è¯¥ç±»çš„æ³¨é‡Šä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯Integration code for other frameworks can leverage this interface to wire and populate existing bean instances that Spring does not control the lifecycle ofï¼Œæ„æ€æ˜¯è¯´è¯¥ç±»å¯ä»¥å¡«å……é‚£äº›ä¸å—springå®¹å™¨æŽ§åˆ¶çš„beanã€‚ springå’Œquartzåœ¨é›†æˆçš„æ—¶å€™ç”¨äº†autowireBeanæ–¹æ³•ã€‚ä¸‹é¢èµ°è¯»è¿™ä¸ªæ–¹æ³•çš„ä»£ç æ¥çœ‹å¤„ç†é€»è¾‘ã€‚ autowireBeançš„å®žçŽ°åœ¨ç±»AbstractAutowireCapableBeanFactoryä¸­ã€‚ ä»£ç å¦‚ä¸‹ 123456789public void autowireBean(Object existingBean) &#123; // Use non-singleton bean definition, to avoid registering bean as dependent bean. RootBeanDefinition bd = new RootBeanDefinition(ClassUtils.getUserClass(existingBean)); bd.setScope(BeanDefinition.SCOPE_PROTOTYPE); bd.allowCaching = ClassUtils.isCacheSafe(bd.getBeanClass(), getBeanClassLoader()); BeanWrapper bw = new BeanWrapperImpl(existingBean); initBeanWrapper(bw); populateBean(bd.getBeanClass().getName(), bd, bw); &#125; è¯¥æ–¹æ³•çš„é€»è¾‘ä¸»è¦åœ¨populateBeanä¸­ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯springé‡Œå¾ˆé‡è¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºŽè£…é…beanã€‚è¿™é‡Œé€»è¾‘å¾ˆå¤æ‚ï¼Œä¸»è¦æ˜¯é€šè¿‡åå°„èŽ·å–æˆ‘ä»¬newå‡ºæ¥çš„å¯¹è±¡çš„å±žæ€§åŠæ³¨è§£ã€‚è‹¥æ³¨è§£æ˜¯Autowired,Value,Injectæ—¶ï¼Œè¿›è¡Œbeançš„ç»„è£…ã€‚æ­¤æ–¹æ³•æ‰§è¡Œå®Œæˆä¹‹åŽã€‚æˆ‘ä»¬newå‡ºæ¥çš„å¯¹è±¡é‡Œé€šè¿‡æ³¨è§£æ³¨å…¥çš„beanå°±å¯ä»¥ä½¿ç”¨äº†ã€‚ å…³é”®ä»£ç å±•ç¤ºï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041protected void populateBean(String beanName, RootBeanDefinition mbd, BeanWrapper bw) &#123; ...... if (hasInstAwareBpps || needsDepCheck) &#123; PropertyDescriptor[] filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching); if (hasInstAwareBpps) &#123; for (BeanPostProcessor bp : getBeanPostProcessors()) &#123; if (bp instanceof InstantiationAwareBeanPostProcessor) &#123; InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp; //ä¾èµ–çš„beanæ³¨å…¥åœ¨è¿™é‡Œå®žçŽ° pvs = ibp.postProcessPropertyValues(pvs, filteredPds, bw.getWrappedInstance(), beanName); //end if (pvs == null) &#123; return; &#125; &#125; &#125; &#125; if (needsDepCheck) &#123; checkDependencies(beanName, mbd, filteredPds, pvs); &#125; &#125; applyPropertyValues(beanName, mbd, bw, pvs); &#125;public PropertyValues postProcessPropertyValues( PropertyValues pvs, PropertyDescriptor[] pds, Object bean, String beanName) throws BeanCreationException &#123; //èŽ·å–æ³¨å…¥çš„å±žæ€§ InjectionMetadata metadata = findAutowiringMetadata(beanName, bean.getClass(), pvs); try &#123; //æ³¨å…¥ metadata.inject(bean, beanName, pvs); &#125; catch (BeanCreationException ex) &#123; throw ex; &#125; catch (Throwable ex) &#123; throw new BeanCreationException(beanName, "Injection of autowired dependencies failed", ex); &#125; return pvs; &#125; ä¾‹å­quartz çš„jobé‡Œæ³¨å…¥beanï¼š job å·¥åŽ‚ï¼š 123456789101112131415public class JobFactory extends AdaptableJobFactory &#123; @Autowired private AutowireCapableBeanFactory capableBeanFactory; @Override protected Object createJobInstance(TriggerFiredBundle bundle) throws Exception &#123; //è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³• Object jobInstance = super.createJobInstance(bundle); //è¿›è¡Œæ³¨å…¥ capableBeanFactory.autowireBean(jobInstance); return jobInstance; &#125;&#125; jobçš„å…·ä½“å¤„ç†é€»è¾‘ 12345678public final class InternalJob implements Job &#123; private static final Logger logger = LoggerFactory.getLogger(InternalJob .class); @Autowired private CuratorFramework client; @Autowired private JobAlarmEventService jobAlarmEventService; jobçš„springé…ç½®ï¼š 123456&lt;bean id="jobFactory" class="com.test.scheduler.JobFactory"&gt;&lt;/bean&gt; &lt;bean id="schedulerFactoryBean" class="org.springframework.scheduling.quartz.SchedulerFactoryBean"&gt; &lt;property name="jobFactory" ref="jobFactory"&gt;&lt;/property&gt; &lt;property name="schedulerName" value="scheduler"&gt;&lt;/property&gt; &lt;property name="configLocation" value="classpath:META-INF/spring/quartz.properties"&gt;&lt;/property&gt; &lt;/bean&gt;]]></content>
      <categories>
        <category>Spring</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[vmware ç½‘ç»œè®¾ç½®]]></title>
    <url>%2F2018%2F09%2F25%2Fvmware-%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[NATè®¾ç½® åˆ é™¤åŽŸæœ‰çš„NAT æ–°å»ºä¸€ä¸ªæ–°çš„NATé“¾æŽ¥ï¼Œç”ŸæˆMACç½‘å¡åœ°å€ æ£€æŸ¥LANç½‘æ®µ æ¡¥æŽ¥è®¾ç½® åˆ é™¤åŽŸæœ‰çš„æ¡¥æŽ¥ æ–°å»ºä¸€ä¸ªæ–°çš„æ¡¥æŽ¥ï¼Œç”ŸæˆMACç½‘å¡åœ°å€ ï¼Œ è·¯ç”±adminç»‘å®šé™æ€IP æ£€æŸ¥LANç½‘æ®µ ip addr æŸ¥çœ‹IPå’Œç½‘å¡ è·¯ç”±è®¾ç½® DHCPæœåŠ¡å™¨ -&gt; é™æ€åœ°å€ä¿ç•™ ï¼Œ ç”Ÿæ•ˆæ‰€æœ‰ IPä¸ŽMACç»‘å®š -&gt; é™æ€ARPç»‘å®šè®¾ç½® ï¼Œç”Ÿæ•ˆæ‰€æœ‰ å…³é—­è™šæ‹Ÿæœºï¼Œé‡å¯è·¯ç”±å™¨]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Mysqlå¤šè¡¨è¿žæŽ¥åˆ é™¤]]></title>
    <url>%2F2018%2F09%2F21%2FMysql%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E5%88%A0%E9%99%A4%2F</url>
    <content type="text"><![CDATA[è”è¡¨åˆ é™¤ï¼š1ã€ä»Žæ•°æ®è¡¨t1 ä¸­æŠŠé‚£äº›idå€¼åœ¨æ•°æ®è¡¨t2 é‡Œæœ‰åŒ¹é…çš„è®°å½•å…¨åˆ é™¤æŽ‰ 12345DELETE t1 FROM t1,t2 WHERE t1.id=t2.idæˆ–DELETE FROM t1 USING t1,t2 WHERE t1.id=t2.id 2ã€ä»Žæ•°æ®è¡¨t1é‡Œåœ¨æ•°æ®è¡¨t2é‡Œæ²¡æœ‰åŒ¹é…çš„è®°å½•æŸ¥æ‰¾å‡ºæ¥å¹¶åˆ é™¤æŽ‰ 12345DELETE t1 FROM t1 LEFT JOIN T2 ON t1.id=t2.id WHERE t2.id IS NULLæˆ–DELETE FROM t1,USING t1 LEFT JOIN T2 ON t1.id=t2.id WHERE t2.id IS NULL 3ã€ä»Žä¸¤ä¸ªè¡¨ä¸­æ‰¾å‡ºç›¸åŒè®°å½•çš„æ•°æ®å¹¶æŠŠä¸¤ä¸ªè¡¨ä¸­çš„æ•°æ®éƒ½åˆ é™¤æŽ‰ 1DELETE t1,t2 from t1 LEFT JOIN t2 ON t1.id=t2.id WHERE t1.id=25 æ³¨æ„æ­¤å¤„çš„delete t1,t2 from ä¸­çš„t1,t2ä¸èƒ½æ˜¯åˆ«å å¦‚ï¼š1delete t1,t2 from table_name as t1 left join table2_name as t2 on t1.id=t2.id where table_name.id=25 è¦æ±‚ï¼šMYSQL ç‰ˆæœ¬ä¸å°äºŽ5.0]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[RedisåŽŸç†è¯¦è§£]]></title>
    <url>%2F2018%2F09%2F15%2FRedis%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[expire https://redis.io/commands/expire æ¶ˆæžæ–¹å¼ï¼Œè®¿é—®Keyï¼Œå·²è¿‡æœŸåˆ é™¤ ç§¯æžæ–¹å¼ï¼Œ1ç§’10æ¬¡ã€‚1. é€‰å–20ä¸ªéšæœºçš„key 2.åˆ é™¤è¿‡æœŸkey 3.è¶…è¿‡20%è¿‡æœŸï¼Œæ‰§è¡Œ1æ­¥éª¤ã€‚ How Redis expires keysRedis keys are expired in two ways: a passive way, and an active way. A key is passively expired simply when some client tries to access it, and the key is found to be timed out. Of course this is not enough as there are expired keys that will never be accessed again. These keys should be expired anyway, so periodically Redis tests a few keys at random among keys with an expire set. All the keys that are already expired are deleted from the keyspace. Specifically this is what Redis does 10 times per second: Test 20 random keys from the set of keys with an associated expire. Delete all the keys found expired. If more than 25% of keys were expired, start again from step 1. This is a trivial probabilistic algorithm, basically the assumption is that our sample is representative of the whole key space, and we continue to expire until the percentage of keys that are likely to be expired is under 25% This means that at any given moment the maximum amount of keys already expired that are using memory is at max equal to max amount of write operations per second divided by 4. æ•°æ®æŒä¹…åŒ–rdb ï¼ˆé»˜è®¤ï¼‰ æ¡ä»¶æ»¡è¶³ä¸€ä¸ªæ‰§è¡Œï¼Œæ¯æ¡è§„åˆ™ä¹‹é—´æ˜¯â€œæˆ–â€çš„å…³ç³» In the example below the behaviour will be to save: after 900 sec (15 min) if at least 1 key changed after 300 sec (5 min) if at least 10 keys changed after 60 sec if at least 10000 keys changed 123save 900 1save 300 10save 60 10000 aof é»˜è®¤çš„rdbèƒ½å¤Ÿæ»¡è¶³æŒä¹…åŒ–çš„éœ€æ±‚ï¼Œä½†æ˜¯å­˜åœ¨ç¼ºé™·å°±æ˜¯ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œå¯èƒ½ä¼šä¸¢å¤±æ•°æ®ã€‚ By default Redis asynchronously dumps the dataset on disk. This mode isgood enough in many applications, but an issue with the Redis process ora power outage may result into a few minutes of writes lost (depending onthe configured save points). 12appendonly yesappendfilename "appendonly.aof" luaè„šæœ¬ä¿è¯åŽŸå­æ€§ redis-cli â€“eval example.lua æ¯”è¾ƒæš´åŠ› é™æµdemo 10ç§’å†…é™æµ10æ¬¡demo script load å¯¼å…¥è„šæœ¬ï¼Œç”Ÿæˆsha evalsha â€œ{sha}â€ luaæ‰§è¡Œæ­»çŽ¯å¢ƒè„šæœ¬ï¼Œä¼šæœ‰é˜»å¡žé—®é¢˜ redis-cli â€“eval example.lua å•çº¿ç¨‹å¦‚ä½•ä¿è¯é«˜æ€§èƒ½åŒæ­¥é˜»å¡žåŒæ­¥éžé˜»å¡žå¼‚æ­¥é˜»å¡ž(rediså®žçŽ°ï¼Œå¤šè·¯å¤ç”¨)å¼‚æ­¥ä¸ä¸€å®šæ˜¯å¤šçº¿ç¨‹ å¼‚æ­¥éžé˜»å¡žåˆ†å¸ƒå¼é…ç½®12# æ— ç£ç›˜å¤åˆ¶repl-diskless-sync å‘½ä»¤12345678#æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯info replication#å‘Šè¯‰masterèŠ‚ç‚¹ slaveçš„ç«¯å£replconf listening-port 6379#æŠ“å–masterçš„åŒæ­¥ä¿¡æ¯sync ä¸»ä»Žå¤åˆ¶å…¨é‡å¤åˆ¶ å¢žé‡å¤åˆ¶ é“¾æŽ¥åˆ°é›†ç¾¤ 12redis-cli -c -p 7000ä¼šæœ‰redirect to slotæç¤º è¿žæŽ¥åˆ°æŸå°æœºå™¨ 12redis-cli -p 7001æç¤ºMOVED error cluster slots æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ æ§½ä¿¡æ¯ 13ä¸»6ä»Ž cluster nodes æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ å“¨å…µæ¨¡å¼ 1è¿žæŽ¥å“¨å…µèŠ‚ç‚¹ï¼Œç„¶åŽæŸ¥è¯¢masterçš„èŠ‚ç‚¹ å®¢æˆ·ç«¯jedis sentinel cluster cluster jedis.watch æ ‡å¿—é‡Šæ”¾é”ä¸ä¼šå¤±è´¥ redission single sentinel 12redissionClinet.getBucket("") èŽ·å–å­—ç¬¦ä¸²å…¶ä»–ç±»åž‹ç›¸åŒ cluster åˆ†å¸ƒå¼é” setNX redission lock unlock æºç è§£è¯»]]></content>
      <categories>
        <category>ç¼“å­˜</category>
        <category>redis</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[springboot staterè‡ªå®šä¹‰å¼€å‘]]></title>
    <url>%2F2018%2F09%2F14%2Fspringboot-stater%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%80%E5%8F%91%2F</url>
    <content type="text"><![CDATA[ä¸€ springboot-starterç”Ÿæˆ1. pomå¼•å…¥12345678910111213141516171819202122232425262728293031323334353637383940&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.joey.segmentment&lt;/groupId&gt; &lt;artifactId&gt;lessson-20-starter&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;name&gt;lessson-20-starter&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.5.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ç”¨äºŽç”Ÿæˆç¼–è¾‘æç¤º--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; 2. autoconfigure123456789101112@Configuration@ConditionalOnProperty(prefix = "person",name = "enable", havingValue = "true",matchIfMissing = true)public class PersonAutoConfigure &#123; @Bean @ConfigurationProperties(prefix = "person") public Person person()&#123; return new Person(); &#125;&#125; 1234567public class Person &#123; private Long id; private String name; private Integer age;... getter setter&#125; @Configuration,è¢«è¯¥æ³¨è§£æ³¨é‡Šçš„ç±»ä¼šæä¾›ä¸€ä¸ªæˆ–åˆ™å¤šä¸ª@beanä¿®é¥°çš„æ–¹æ³•å¹¶ä¸”ä¼šè¢«springå®¹å™¨å¤„ç†æ¥ç”Ÿæˆbean definitionsã€‚ @beanæ³¨è§£æ˜¯å¿…é¡»ä¿®é¥°å‡½æ•°çš„ï¼Œè¯¥å‡½æ•°å¯ä»¥æä¾›ä¸€ä¸ªbeanã€‚è€Œä¸”è¯¥å‡½æ•°çš„å‡½æ•°åå¿…é¡»å’Œbeançš„åç§°ä¸€è‡´ï¼Œé™¤äº†é¦–å­—æ¯ä¸éœ€è¦å¤§å†™ã€‚ @ConditionalOnClassæ³¨è§£æ˜¯æ¡ä»¶åˆ¤æ–­çš„æ³¨è§£ï¼Œè¡¨ç¤ºå¯¹åº”çš„ç±»åœ¨classpathç›®å½•ä¸‹å­˜åœ¨æ—¶ï¼Œæ‰ä¼šåŽ»è§£æžå¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚ ConditionalOnPropertyæ³¨è§£æ˜¯æ¡ä»¶åˆ¤æ–­çš„æ³¨è§£ï¼Œè¡¨ç¤ºå¦‚æžœé…ç½®æ–‡ä»¶ä¸­çš„å“åº”é…ç½®é¡¹æ•°å€¼ä¸ºtrue,æ‰ä¼šå¯¹è¯¥beanè¿›è¡Œåˆå§‹åŒ–ã€‚ æ›´å¤šæ³¨è§£å‚è€ƒ https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html 3. META-INF/spring.factoriesåœ¨æ–‡ä»¶ä¸­æ·»åŠ  12org.springframework.boot.autoconfigure.EnableAutoConfiguration=\ com.joey.segmentment.starter.autoconfigure.PersonAutoConfigure 4. mvn clean installäºŒ projectå¼•å…¥starterjaråŒ…1. å¼•å…¥jaråŒ…12345&lt;dependency&gt; &lt;groupId&gt;com.joey.segmentment&lt;/groupId&gt; &lt;artifactId&gt;lessson-20-starter&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; 2. application.propertieså¡«å†™é…ç½®12345person.enable=trueperson.id=1person.name=joeyperson.age=18 3. ä»£ç ä½¿ç”¨123456789101112@RestControllerpublic class TestController &#123; @Autowired private Person person; @GetMapping(value = "/person") public Person get()&#123; return person; &#125;&#125; æ–‡çŒ®å‚è€ƒ https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-auto-configuration.html]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[kafkaåŽŸç†è¯¦è§£]]></title>
    <url>%2F2018%2F09%2F06%2Fkafka%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[kafkaæä¾›çš„åŸºæœ¬è„šæœ¬å¯åŠ¨broker server1bin/kafka-server-start.sh config/server.properties åˆ›å»ºtopic1bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 2 --partitions 3 -- topic testReplicaTopic å½“brokerèŠ‚ç‚¹æœ¬èº«åªæœ‰1ä¸ªï¼Œå°‘äºŽå‰¯æœ¬æ•°2æ—¶ï¼ŒæŠ¥é”™ 12[2018-09-06 23:13:38,288] ERROR org.apache.kafka.common.errors.InvalidReplicationFactorException: Replication factor: 2 larger than available brokers: 1. (kafka.admin.TopicCommand$) æŸ¥çœ‹æŸä¸ªtopicçš„ä¿¡æ¯1bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic xiaowu-topic ç”Ÿäº§è€…å‘é€æ¶ˆæ¯1bin/kafka-console-producer.sh --broker-list localhost:9092 --topic xiaowu-topic æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯1bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic xiaowu-topic --from-beginning æŸ¥çœ‹æ¶ˆæ¯æ—¥å¿—æ–‡ä»¶1bin/kafka-run-class.sh kafka.tools.DumpLogSegments --files /Users/zhouxiaowu/install/kafka/kafka-data/xiaowu-topic-0/00000000000000000000.log --print-data-log æŸ¥çœ‹ç´¢å¼•æ–‡ä»¶å†…å®¹1bin/kafka-run-class.sh kafka.tools.DumpLogSegments --files /Users/zhouxiaowu/install/kafka/kafka-data/xiaowu-topic-0/00000000000000000000.index --print-data-log zookeeperçŠ¶æ€æŸ¥çœ‹æŸä¸ªtopicçš„æŸä¸ªåˆ†åŒºçš„çŠ¶æ€12[zk: localhost:2181(CONNECTED) 16] get /brokers/topics/xiaowu-topic/partitions/0/state&#123;"controller_epoch":4,"leader":0,"version":1,"leader_epoch":0,"isr":[0]&#125;]]></content>
      <categories>
        <category>æ¶ˆæ¯ä¸­é—´ä»¶</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spring Boot Webç¯‡]]></title>
    <url>%2F2018%2F08%2F13%2FSpring-Boot-Web%E7%AF%87%2F</url>
    <content type="text"><![CDATA[æ ‡å‡†ä¼˜åŒ–æŠ€æœ¯ èµ„æºå˜åŒ– å“åº”å¤´ï¼šLast-Modified è¯·æ±‚å¤´ï¼šIf-Modified-Since èµ„æºç¼“å­˜ å“åº”å¤´ï¼šETag è¯·æ±‚å¤´ï¼šIf-None-Match Spring Boot Actuatorå¼•ç”¨åŒ… 1234&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&lt;/dependency&gt; /beans æŸ¥çœ‹beançš„æƒ…å†µ ManagementServerPropertiesç±»æŸ¥çœ‹é…ç½®å†…å®¹ å¦‚ï¼š management.security.enabled = falseå…³é—­å®‰å…¨æ£€æŸ¥ localhost:8080/autoconfig æŸ¥çœ‹åŒ¹é…æ–¹å¼ï¼ŒnegtiveåŒ¹é…ä¸æˆåŠŸ Spring Framwork Transaction @EnableTransactionManagementæ³¨è§£å¯ç”¨äº‹åŠ¡ç®¡ç† proxyTargetClass = trueé€‰æ‹©ä½¿ç”¨cglibåŠ¨æ€ä»£ç†ï¼Œè¿™æ ·serviceç±»å¯ä»¥ä¸ç”¨å®žçŽ°æŽ¥å£ã€‚ 1@EnableTransactionManagement(proxyTargetClass = true)]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«æµ‹è¯•]]></title>
    <url>%2F2018%2F08%2F10%2FMySQL%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E6%B5%8B%E8%AF%95%2F</url>
    <content type="text"><![CDATA[ä¸€ã€äº‹åŠ¡çš„åŸºæœ¬è¦ç´ ï¼ˆACIDï¼‰ 1ã€åŽŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡å¼€å§‹åŽæ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨åšå®Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸åšï¼Œä¸å¯èƒ½åœæ»žåœ¨ä¸­é—´çŽ¯èŠ‚ã€‚äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™ï¼Œä¼šå›žæ»šåˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œæ‰€æœ‰çš„æ“ä½œå°±åƒæ²¡æœ‰å‘ç”Ÿä¸€æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼Œå°±åƒåŒ–å­¦ä¸­å­¦è¿‡çš„åŽŸå­ï¼Œæ˜¯ç‰©è´¨æž„æˆçš„åŸºæœ¬å•ä½ã€‚ 2ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å¼€å§‹å‰å’Œç»“æŸåŽï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´å ã€‚æ¯”å¦‚Aå‘Bè½¬è´¦ï¼Œä¸å¯èƒ½Aæ‰£äº†é’±ï¼ŒBå´æ²¡æ”¶åˆ°ã€‚ 3ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šåŒä¸€æ—¶é—´ï¼Œåªå…è®¸ä¸€ä¸ªäº‹åŠ¡è¯·æ±‚åŒä¸€æ•°æ®ï¼Œä¸åŒçš„äº‹åŠ¡ä¹‹é—´å½¼æ­¤æ²¡æœ‰ä»»ä½•å¹²æ‰°ã€‚æ¯”å¦‚Aæ­£åœ¨ä»Žä¸€å¼ é“¶è¡Œå¡ä¸­å–é’±ï¼Œåœ¨Aå–é’±çš„è¿‡ç¨‹ç»“æŸå‰ï¼ŒBä¸èƒ½å‘è¿™å¼ å¡è½¬è´¦ã€‚ 4ã€æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡å®ŒæˆåŽï¼Œäº‹åŠ¡å¯¹æ•°æ®åº“çš„æ‰€æœ‰æ›´æ–°å°†è¢«ä¿å­˜åˆ°æ•°æ®åº“ï¼Œä¸èƒ½å›žæ»šã€‚ äºŒã€äº‹åŠ¡çš„å¹¶å‘é—®é¢˜1ã€è„è¯»ï¼šäº‹åŠ¡Aè¯»å–äº†äº‹åŠ¡Bæ›´æ–°çš„æ•°æ®ï¼Œç„¶åŽBå›žæ»šæ“ä½œï¼Œé‚£ä¹ˆAè¯»å–åˆ°çš„æ•°æ®æ˜¯è„æ•°æ® 2ã€ä¸å¯é‡å¤è¯»ï¼šäº‹åŠ¡ A å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œäº‹åŠ¡ B åœ¨äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ•°æ®ä½œäº†æ›´æ–°å¹¶æäº¤ï¼Œå¯¼è‡´äº‹åŠ¡Aå¤šæ¬¡è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œç»“æžœ ä¸ä¸€è‡´ã€‚ 3ã€å¹»è¯»ï¼šç³»ç»Ÿç®¡ç†å‘˜Aå°†æ•°æ®åº“ä¸­æ‰€æœ‰å­¦ç”Ÿçš„æˆç»©ä»Žå…·ä½“åˆ†æ•°æ”¹ä¸ºABCDEç­‰çº§ï¼Œä½†æ˜¯ç³»ç»Ÿç®¡ç†å‘˜Bå°±åœ¨è¿™ä¸ªæ—¶å€™æ’å…¥äº†ä¸€æ¡å…·ä½“åˆ†æ•°çš„è®°å½•ï¼Œå½“ç³»ç»Ÿç®¡ç†å‘˜Aæ”¹ç»“æŸåŽå‘çŽ°è¿˜æœ‰ä¸€æ¡è®°å½•æ²¡æœ‰æ”¹è¿‡æ¥ï¼Œå°±å¥½åƒå‘ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œè¿™å°±å«å¹»è¯»ã€‚ å°ç»“ï¼šä¸å¯é‡å¤è¯»çš„å’Œå¹»è¯»å¾ˆå®¹æ˜“æ··æ·†ï¼Œä¸å¯é‡å¤è¯»ä¾§é‡äºŽä¿®æ”¹ï¼Œå¹»è¯»ä¾§é‡äºŽæ–°å¢žæˆ–åˆ é™¤ã€‚è§£å†³ä¸å¯é‡å¤è¯»çš„é—®é¢˜åªéœ€é”ä½æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Œè§£å†³å¹»è¯»éœ€è¦é”è¡¨ ä¸‰ã€MySQLäº‹åŠ¡éš”ç¦»çº§åˆ« äº‹åŠ¡éš”ç¦»çº§åˆ« è„è¯» ä¸å¯é‡å¤è¯» å¹»è¯» è¯»æœªæäº¤ï¼ˆread-uncommittedï¼‰ æ˜¯ æ˜¯ æ˜¯ ä¸å¯é‡å¤è¯»ï¼ˆread-committedï¼‰ å¦ æ˜¯ æ˜¯ å¯é‡å¤è¯»ï¼ˆrepeatable-readï¼‰ å¦ å¦ æ˜¯ ä¸²è¡ŒåŒ–ï¼ˆserializableï¼‰ å¦ å¦ å¦ clientA1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586set session transaction isolation level read COMMITTED ;SELECT @@tx_isolation;CREATE TABLE person_test( id INT UNSIGNED AUTO_INCREMENT COMMENT 'id' PRIMARY KEY , age INT DEFAULT 0 COMMENT 'ç»„ç»‡ç¼–å·ï¼ˆéƒ¨é—¨ç¼–å·ï¼‰', name VARCHAR(20) DEFAULT '' COMMENT 'ç»„ç»‡åç§°', gmt_create timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', gmt_modify timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ä¿®æ”¹æ—¶é—´')ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT 'person test';BEGIN ;INSERT INTO person_test(age, name) VALUE (18,'xiaoming');SELECT * FROM person_test;COMMIT ;BEGIN ;INSERT INTO person_test(age,name) VALUE (18,'jim');SELECT * FROM person_test;ROLLBACK ;SELECT * FROM person_test WHERE id=10;-- éš”ç¦»çº§åˆ«ï¼ˆread COMMITTEDï¼‰ set session transaction isolation level read COMMITTED ;SELECT @@tx_isolation;BEGIN ;SELECT * FROM person_test;SELECT * FROM person_test;COMMIT ;-- éš”ç¦»çº§åˆ«ï¼ˆREPEATABLE READï¼‰set session transaction isolation level REPEATABLE READ ;SELECT @@tx_isolation;BEGIN ;SELECT * FROM person_test;SELECT * FROM person_test;COMMIT ;SELECT * FROM person_test;BEGIN ;SELECT * FROM person_test WHERE age=18;-- è¿™é‡Œæµ‹è¯•å¹¶æ²¡æœ‰å‡ºçŽ°å¹»è¯»æƒ…å†µSELECT * FROM person_test WHERE age=18;COMMIT ;-- éš”ç¦»çº§åˆ«ï¼ˆSERIALIZABLEï¼‰set session transaction isolation level SERIALIZABLE ;SELECT @@tx_isolation;BEGIN ;SELECT * FROM person_test;SELECT * FROM person_test;-- è¿™é‡Œæ’å…¥ä¼šdead lock-- INSERT INTO person_test (age, name) VALUE (18,'he');COMMIT ;SELECT * FROM person_test; clientB12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485set session transaction isolation level read COMMITTED ;SELECT @@tx_isolation;CREATE TABLE person_test( id INT UNSIGNED AUTO_INCREMENT COMMENT 'id' PRIMARY KEY , age INT DEFAULT 0 COMMENT 'ç»„ç»‡ç¼–å·ï¼ˆéƒ¨é—¨ç¼–å·ï¼‰', name VARCHAR(20) DEFAULT '' COMMENT 'ç»„ç»‡åç§°', gmt_create timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´', gmt_modify timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ä¿®æ”¹æ—¶é—´')ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT 'person test';BEGIN ;INSERT INTO person_test(age, name) VALUE (18,'lily');SELECT * FROM person_test;COMMIT ;BEGIN ;INSERT INTO person_test(age,name) VALUE (18,'jim');SELECT * FROM person_test;ROLLBACK ;BEGIN ;UPDATE person_test SET name= 'zhangsan' WHERE id=10;SELECT * FROM person_test;ROLLBACK ;-- éš”ç¦»çº§åˆ«ï¼ˆread COMMITTEDï¼‰ set session transaction isolation level read COMMITTED ;SELECT @@tx_isolation;BEGIN ;UPDATE person_test SET name = 'zhangsan' WHERE id=10;SELECT * FROM person_test;DELETE FROM person_test WHERE id=2;SELECT * FROM person_test;COMMIT ;-- éš”ç¦»çº§åˆ«ï¼ˆREPEATABLE READï¼‰set session transaction isolation level REPEATABLE READ ;SELECT @@tx_isolation;BEGIN ;SELECT * FROM person_test;UPDATE person_test SET name = 'zhangsanfeng' WHERE id=10;SELECT * FROM person_test;COMMIT ;BEGIN ;SELECT * FROM person_test WHERE age=18;INSERT INTO person_test (age,name) VALUE (18,'qiang');SELECT * FROM person_test WHERE age=18;COMMIT ;-- éš”ç¦»çº§åˆ«ï¼ˆSERIALIZABLEï¼‰set session transaction isolation level SERIALIZABLE ;SELECT @@tx_isolation;BEGIN ;SELECT * FROM person_test;-- SERIALIZABLEæƒ…å†µï¼Œä¸èƒ½å¢žåŠ ï¼Œç­‰å¾…Aå®¢æˆ·ç«¯commitåŽ ä¼šå¸®åŠ©è¿™è¾¹commitINSERT INTO person_test (age,name) VALUE (18,'fen');INSERT INTO person_test (age , name) VALUE (18,'fang');SELECT * FROM person_test;COMMIT ;]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spring cloud è´Ÿè½½å‡è¡¡]]></title>
    <url>%2F2018%2F08%2F05%2FSpring-cloud-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%2F</url>
    <content type="text"><![CDATA[123&gt; JSR 305 meta-annotations&gt; æ³¨è§£åšç¼–è¯‘çº¦æŸ&gt; ä¸»è¦å†…å®¹RestTemplate åŽŸç†ä¸Žæ‰©å±•Spring æ ¸å¿ƒ HTTP æ¶ˆæ¯è½¬æ¢å™¨ HttpMessageConverter REST è‡ªæè¿°æ¶ˆæ¯ï¼šåª’ä½“ç±»åž‹ï¼ˆMediaTypeï¼‰ï¼Œ text/html;text/xml;application/json HTTP åè®®ç‰¹ç‚¹ï¼šçº¯æ–‡æœ¬åè®®ï¼Œè‡ªæˆ‘æè¿° REST æœåŠ¡ç«¯ REST å®¢æˆ·ç«¯ ååºåˆ—åŒ–ï¼šæ–‡æœ¬ï¼ˆé€šè®¯ï¼‰ -&gt; å¯¹è±¡ï¼ˆç¨‹åºä½¿ç”¨ï¼‰ åºåˆ—åŒ–ï¼šå¯¹è±¡ -&gt; æ–‡æœ¬ HttpMessageConverter åˆ†æžåˆ¤æ–­æ˜¯å¦å¯è¯»å¯å†™1234567public interface HttpMessageConverter&lt;T&gt; &#123; boolean canRead(Class&lt;?&gt; clazz, @Nullable MediaType mediaType); boolean canWrite(Class&lt;?&gt; clazz, @Nullable MediaType mediaType);&#125; clazz = Person.class å½“å‰æ”¯æŒçš„åª’ä½“ç±»åž‹123public interface HttpMessageConverter&lt;T&gt; &#123; List&lt;MediaType&gt; getSupportedMediaTypes();&#125; MappingJackson2HttpMessageConverter ååºåˆ—åŒ–1234public interface HttpMessageConverter&lt;T&gt; &#123; T read(Class&lt;? extends T&gt; clazz, HttpInputMessage inputMessage) throws IOException, HttpMessageNotReadableException;&#125; ç‰¹åˆ«æé†’ï¼šSpring Web MVC ä¾èµ– Servletï¼ŒSpring åœ¨æ—©æœŸè®¾è®¡æ—¶ï¼Œå®ƒå°±è€ƒè™‘åˆ°äº†åŽ» Servlet åŒ–ã€‚ HttpInputMessage ç±»ä¼¼äºŽ HttpServletRequest 12345678public interface HttpInputMessage extends HttpMessage &#123; InputStream getBody() throws IOException; // æ¥è‡ªäºŽ HttpMessage HttpHeaders getHeaders();&#125; ç±»æ¯” HttpServletRequest 123456789public interface HttpServletRequest &#123; // æ¥è‡ªäºŽ ServletRequest public ServletInputStream getInputStream() throws IOException; public Enumeration&lt;String&gt; getHeaders(String name); public Enumeration&lt;String&gt; getHeaderNames();&#125; RestTemplateåˆ©ç”¨ HttpMessageConverter å¯¹ä¸€å®šåª’ä½“ç±»åž‹åºåˆ—åŒ–å’Œååºåˆ—åŒ– JSON XML TEXT å®ƒä¸ä¾èµ–äºŽ Servlet APIï¼Œå®ƒè‡ªå®šä¹‰å®žçŽ° å¯¹äºŽæœåŠ¡ç«¯è€Œè¨€ï¼Œå°† Servlet API é€‚é…æˆ HttpInputMessage ä»¥åŠ HttpOutputMessage RestTemplate å¯¹åº”å¤šä¸ª HttpMessageConverterï¼Œé‚£ä¹ˆå¦‚ä½•å†³ç­–æ­£ç¡®åª’ä½“ç±»åž‹ã€‚ RestTemplate åœ¨ HttpMessageConverter è®¾è®¡123456789101112131415161718192021222324252627282930313233343536373839404142public class RestTemplate extends InterceptingHttpAccessor implements RestOperations &#123; ... // List å½¢å¼ private final List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters = new ArrayList&lt;&gt;(); ... public RestTemplate() &#123; this.messageConverters.add(new ByteArrayHttpMessageConverter()); this.messageConverters.add(new StringHttpMessageConverter()); this.messageConverters.add(new ResourceHttpMessageConverter(false)); this.messageConverters.add(new SourceHttpMessageConverter&lt;&gt;()); this.messageConverters.add(new AllEncompassingFormHttpMessageConverter()); if (romePresent) &#123; this.messageConverters.add(new AtomFeedHttpMessageConverter()); this.messageConverters.add(new RssChannelHttpMessageConverter()); &#125; if (jackson2XmlPresent) &#123; this.messageConverters.add(new MappingJackson2XmlHttpMessageConverter()); &#125; else if (jaxb2Present) &#123; this.messageConverters.add(new Jaxb2RootElementHttpMessageConverter()); &#125; if (jackson2Present) &#123; this.messageConverters.add(new MappingJackson2HttpMessageConverter()); &#125; else if (gsonPresent) &#123; this.messageConverters.add(new GsonHttpMessageConverter()); &#125; else if (jsonbPresent) &#123; this.messageConverters.add(new JsonbHttpMessageConverter()); &#125; if (jackson2SmilePresent) &#123; this.messageConverters.add(new MappingJackson2SmileHttpMessageConverter()); &#125; if (jackson2CborPresent) &#123; this.messageConverters.add(new MappingJackson2CborHttpMessageConverter()); &#125; &#125;&#125; æ·»åŠ å†…å»º HttpMessageConvertor å®žçŽ° æœ‰æ¡ä»¶åœ°æ·»åŠ ç¬¬ä¸‰æ–¹åº“HttpMessageConvertor æ•´åˆå®žçŽ° é—®é¢˜åœºæ™¯ä¸€ï¼š http://localhost:8080/person -&gt; XML è€Œä¸æ˜¯ Jackson Postman ã€curl åœºæ™¯æœ€ä¸ºæ˜Žæ˜¾ æ²¡æœ‰ä¼ é€’è¯·æ±‚å¤´ï¼Œæ— ä»Žé€‰æ‹©åª’ä½“ç±»åž‹ å‡è®¾ Person æ—¢èƒ½è¢« XML è¯»å–ï¼Œæœ‰èƒ½è¢« JSON è¯»å– Content-Type: text/html; charset=utf-8 RestTemplate æ‰©å±•æ‰©å±• HTTP å®¢æˆ·ç«¯ ClientHttpRequestFactory Spring å®žçŽ° SimpleClientHttpRequestFactory HttpClient HttpComponentsClientHttpRequestFactory OkHttp OkHttp3ClientHttpRequestFactory OkHttpClientHttpRequestFactory å¾®æœåŠ¡è¦ä½¿ç”¨è½»é‡çº§çš„åè®®ï¼Œæ¯”å¦‚ REST Spring Cloud RestTemplate æ ¸å¿ƒçš„è°ƒç”¨å™¨ RestTemplate æ•´åˆ ZookeeperNetflix Ribbon@LoadBalanced åˆ©ç”¨æ³¨è§£æ¥è¿‡æ»¤ï¼Œæ³¨å…¥æ–¹å’Œå£°æ˜Žæ–¹åŒæ—¶ä½¿ç”¨ è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ServiceInstanceChooser LoadBalancerClient è´Ÿè½½å‡è¡¡ä¸Šä¸‹æ–‡LoadBalancerContext è´Ÿè½½å‡è¡¡è§„åˆ™ILoadBalancer @Qualifier â€œçˆ¶â€æ³¨è§£ï¼Œ@Qualifier , @LoadBalanced]]></content>
      <categories>
        <category>SpringCloud</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spring cloudæœåŠ¡å‘çŽ°]]></title>
    <url>%2F2018%2F08%2F05%2FSpring-cloud%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[ç®€å•å¯¹æ¯” Eureka æ¯”è¾ƒç‚¹ Eureka Zookeeper Consul è¿ç»´ç†Ÿæ‚‰åº¦ ç›¸å¯¹é™Œç”Ÿ ç†Ÿæ‚‰ æ›´é™Œç”Ÿ ä¸€è‡´æ€§ï¼ˆCAPï¼‰ APï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ CPï¼ˆä¸€è‡´æ€§å¼ºï¼‰ APï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ ä¸€è‡´æ€§åè®® HTTP å®šæ—¶è½®è®­ ZAB RAFT é€šè®¯æ–¹å¼ HTTP REST è‡ªå®šä¹‰åè®® HTTP REST æ›´æ–°æœºåˆ¶ Peer 2 Peerï¼ˆæœåŠ¡å™¨ä¹‹é—´ï¼‰ + Schedulerï¼ˆæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼‰ ZK Watch Agent ç›‘å¬çš„æ–¹å¼ é€‚ç”¨è§„æ¨¡ 20 K ~ 30 K å®žä¾‹ï¼ˆèŠ‚ç‚¹ï¼‰ 10K ~ 20K å®žä¾‹ï¼ˆèŠ‚ç‚¹ï¼‰ &lt; 3K å®žä¾‹ï¼ˆèŠ‚ç‚¹ï¼‰ æ€§èƒ½é—®é¢˜ ç®€å•çš„æ›´æ–°æœºåˆ¶ã€å¤æ‚è®¾è®¡ã€è§„æ¨¡è¾ƒå¤§æ—¶ GC é¢‘ç¹ æ‰©å®¹éº»çƒ¦ã€è§„æ¨¡è¾ƒå¤§æ—¶ GC é¢‘ç¹ 3K èŠ‚ç‚¹ä»¥ä¸Šï¼Œæ›´æ–°åˆ—è¡¨ç¼“æ…¢ ä¸ºä»€ä¹ˆæŽ¨èä½¿ç”¨ ZK ä½œä¸º Spring Cloud çš„åŸºç¡€è®¾æ–½ä¸€è‡´æ€§æ¨¡åž‹ç»´æŠ¤ç›¸å¯¹ç†Ÿæ‚‰é…ç½®ä¸­å¿ƒå’ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒå•ä¸€åŒ–ä¼ ç»Ÿçš„é—®é¢˜Spring Cloud é»˜è®¤é…ç½® Eureka åšæ³¨å†Œä¸­å¿ƒ Git/JDBC åšé…ç½®ä¸­å¿ƒ ä¸»è¦å†…å®¹Spring Cloud Discovery å®¢æˆ·ç«¯Spring Cloud Discovery ZK æœåŠ¡å™¨Spring Cloud å¢žåŠ  ZK ä¾èµ– é”™è¯¯é…ç½®ï¼ˆé«˜ ZK Client ç‰ˆæœ¬ 3.5ï¼Œä½ŽæœåŠ¡å™¨ç‰ˆæœ¬ 3.4ï¼‰ 123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zookeeper-discovery&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; æ­£ç¡®é…ç½® 123456789101112131415161718192021&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zookeeper-all&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.4.12&lt;/version&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt; æ³¨å†Œå‘çŽ° é…ç½®ç®¡ç† å¯åŠ¨ ZKï¼ˆ3.4.11ï¼‰ç¼–å†™å¼•å¯¼ç±»12345678@SpringBootApplication@EnableDiscoveryClient // å°½å¯èƒ½ä½¿ç”¨ @EnableDiscoveryClientpublic class ZkDSClientApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(ZkDSClientApplication.class, args); &#125;&#125; å®žä¾‹ä¸€ï¼šç«¯å£ 56517 ZK ID : fff20552-b4a0-43d8-a9ce-c82096f2005e å®žä¾‹äºŒï¼šç«¯å£ 56577 ZK ID : 9f4e2c91-4765-4f39-9d4b-2036e8e6c4d4 ZK èŠ‚ç‚¹è·¯å¾„ï¼ˆ/services/spring-cloud-service-discovery-clientï¼‰ ZK æœåŠ¡å‘çŽ°èŠ‚ç‚¹è§„åˆ™ï¼ˆ/services/{spring.application.name}/{serviceId_UUID}/) æ³¨å†Œå¢žåŠ  service Id è®¡ç®— èŽ·å–åº”è¯¥åŽ»é‡ Eureka 2.0 ä¸å¼€æºï¼ŒEureka 1.x è¿˜å¯ä»¥ç”¨çš„ ä»£ç demohttps://github.com/Frankenjoy123/microservices-joey-project æ‰¾åˆ°spring-cloud-service-discoveryå…¥å£å¯åŠ¨]]></content>
      <categories>
        <category>SpringCloud</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spring cloud é…ç½®ç®¡ç†]]></title>
    <url>%2F2018%2F08%2F01%2FSpring-cloud-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[Spring cloudé…ç½®ç®¡ç†å®¢æˆ·ç«¯ç¬¬ä¸‰æ–¹é…ç½®commonsåŒ…commons-configuration Configuration : æä¾›å¤§å¤šæ•°å¸¸è§ç±»åž‹çš„ Value è½¬æ¢ PropertiesConfiguration: å°† Properties ä½œä¸º Configuration é…ç½® MapConfiguration EnvironmentConfiguration ï¼š OS çŽ¯å¢ƒå˜é‡ SystemConfiguration : Java ç³»ç»Ÿå±žæ€§ CompositeConfiguration ApplicationContext ä¸Ž Environmentå…³ç³»1ConfigurableEnvironment extends Environment ApplicationContext ä¸ŽEnvironment ä¸€ä¸€å¯¹åº”ï¼Œä½†æ˜¯ä¼šmerge Parentçš„Environmentã€‚ ConfigurableEnvironment â€”&gt; MutablePropertySourcesï¼Œä¸€ä¸ªEnvironmentå¯¹åº”ä¸€ä¸ªPropertySources MutablePropertySources -&gt; List PropertySource : åŒ…å«å¤šä¸ª 123Environment -&gt; ConfigurableEnvironment: çˆ¶å­å±‚æ¬¡ConfigurableEnvironment -&gt; MutablePropertySources: èŽ·å–å¯å˜å¤šä¸ªé…ç½®æºMutablePropertySources -&gt; List PropertySource : åŒ…å«å¤šä¸ª PropertySource PropertySource : é…ç½®æº MapPropertySource PropertiesPropertySource CompositePropertySource : ç»„åˆ SystemEnvironmentPropertySource çŽ¯å¢ƒå˜é‡ Spring Cloud å®¢æˆ·ç«¯é…ç½®å®šä½æ‰©å±• : PropertySourceLocator org.springframework.core.envåŒ… PropertySource SystemEnvironmentPropertySource 12http://localhost:9095/config/devhttp://localhost:9095/config/default æœåŠ¡ç«¯åŸºäºŽ Git å®žçŽ° ç‰ˆæœ¬åŒ–é…ç½® /åº”ç”¨å/profile/${label} /åº”ç”¨å/profile/ = /åº”ç”¨å/profile/master /åº”ç”¨å/ = /åº”ç”¨å.properties ${label} : åˆ†æ”¯ Spring Cloud Config å®žçŽ°ä¸€å¥—å®Œæ•´çš„é…ç½®ç®¡ç† API è®¾è®¡ Git å®žçŽ°ç¼ºé™·ï¼š å¤æ‚çš„ç‰ˆæœ¬æ›´æ–°æœºåˆ¶ï¼ˆ Git ä»“åº“ï¼‰ ç‰ˆæœ¬ åˆ†æ”¯ æäº¤ é…ç½® æ†‹è¶³çš„å†…å®¹æ›´æ–°ï¼ˆå®žæ—¶æ€§ä¸é«˜ï¼‰ å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å¯åŠ¨æ‹‰å– éœ€è¦æ•´åˆ BUS åšæ›´æ–°é€šçŸ¥ è®¾è®¡åŽŸç†åˆ†æž@EnableConfigServer123456@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Import(&#123;ConfigServerConfiguration.class&#125;)public @interface EnableConfigServer &#123;&#125; org.springframework.cloud.config.server.config.ConfigServerAutoConfiguration 1234567JdbcRepositoryConfiguration.class,VaultRepositoryConfiguration.class,SvnRepositoryConfiguration.class,NativeRepositoryConfiguration.class,GitRepositoryConfiguration.class, gitçš„å®žçŽ°DefaultRepositoryConfiguration.classä»Žä»£ç ä¸­çœ‹ï¼Œæ‰æ˜¯æœ€çœŸå®žçš„ã€‚ 12345678@Configuration@ConditionalOnBean(ConfigServerConfiguration.Marker.class)@EnableConfigurationProperties(ConfigServerProperties.class)@Import(&#123; EnvironmentRepositoryConfiguration.class, CompositeConfiguration.class, ResourceRepositoryConfiguration.class, ConfigServerEncryptionConfiguration.class, ConfigServerMvcConfiguration.class &#125;)public class ConfigServerAutoConfiguration &#123;&#125; å½“åº”ç”¨é…ç½®ç±»æ ‡æ³¨äº† @EnableConfigSever å¯¼å…¥ ConfigServerConfiguration æ³¨å†Œ Marker Bean ä½œä¸º ConfigServerAutoConfiguration æ¡ä»¶ä¹‹ä¸€ jdbcå®žçŽ° æ ¸å¿ƒæŽ¥å£ EnvironmentRepository 1Environment findOne(String application, String profile, String label) 12jdbc.query(this.sql, new Object[] &#123; app, env, label &#125; JdbcTemplate Bean æ¥æº JdbcTemplateAutoConfiguration SQL æ¥æº JdbcEnvironmentProperties spring.cloud.config.server.jdbc.sql ä¸é…ç½®ï¼Œé»˜è®¤ï¼šDEFAULT_SQL 1SELECT KEY, VALUE from PROPERTIES where APPLICATION=? and PROFILE=? and LABEL=? KEY VALUE APPLICATION PROFILE LABEL name mercyblitz config default master name xiaomage config test master æœ¬è´¨è¯´æ˜Žï¼š JDBC è¿žæŽ¥æŠ€æœ¯ DB å­˜å‚¨ä»‹è´¨ EnvironmentRepository æ ¸å¿ƒæŽ¥å£ ConfigServerAutoConfiguration EnvironmentRepositoryConfiguration é»˜è®¤æ˜¯ Git ä½œä¸ºé…ç½®ä»“åº“çš„åŽŸå›  æ‰¾åˆ°äº†ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯ Git ä½œä¸ºé…ç½®ä»“åº“çš„åŽŸå› ï¼š 123@Configuration@ConditionalOnMissingBean(value = EnvironmentRepository.class, search = SearchStrategy.CURRENT)class DefaultRepositoryConfiguration git æ˜¯é»˜è®¤å®žçŽ°ï¼Œæ¡ä»¶æ˜¯åœ¨EnvironmentRepositoryçš„beanæ²¡æœ‰åŠ è½½ã€‚ æ‰€ä»¥è‡ªå·±å®žçŽ°è‡ªå®šä¹‰çš„é…ç½®ï¼Œåªéœ€è¦åŠ è½½ä¸€ä¸ªEnvironmentRepositoryçš„beanå³å¯ã€‚ HTTP è¯·æ±‚æ¨¡å¼/${application}/$${profile}/$${label} @Controller æˆ–è€… @RestController @RequestMapping(â€œ/{application}/{profile}/{label}â€) /config/test/master config : application test : profile master : label å®¢æˆ·ç«¯å®žçŽ°Spring Cloud Config Clienté€šè¿‡spring.cloud.config.uriæœç´¢ï¼Œæ‰¾åˆ°spring-configuration-metadata.json æ‰¾åˆ°classConfigClientPropertiesï¼Œå‘çŽ°private String[] uri = { &quot;http://localhost:8888&quot; }ï¼Œå‘çŽ°urlé»˜è®¤ç«¯å£8888ã€‚ ä»£ç demohttps://github.com/Frankenjoy123/microservices-joey-project å¯åŠ¨spring-cloud-config-serverä¸­çš„mainå…¥å£ï¼Œè®¿é—®å¦‚ä¸‹åœ°å€ï¼š http://localhost:9095/config/dev Jconsole@RefreshScopeactuator/loggersactuator/envEnvironmentRepository æŽ¥å£Properties å®žçŽ°HashTable hashmap]]></content>
      <categories>
        <category>SpringCloud</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Springåº”ç”¨ä¸Šä¸‹æ–‡åŠäº‹ä»¶ç›‘å¬æºç åˆ†æž]]></title>
    <url>%2F2018%2F08%2F01%2FSpring%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8F%8A%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[##å…³é—­spring-cloud bootstrapåº”ç”¨ä¸Šä¸‹æ–‡ åº”ç”¨å¯åŠ¨å‚æ•°æ·»åŠ  1--spring.cloud.bootstrap.enabled=false http://localhost:9091/actuator/beans 123456&#123;"contexts": &#123;"Joey": &#123;&#125;,"first-boot-app": &#123;&#125;&#125;&#125; 12BootstrapApplicationListeneronApplicationEvent çŽ¯å¢ƒå˜é‡http://localhost:9091/actuator/env 123456789101112131415161718192021222324252627282930313233&#123;"activeProfiles": [],"propertySources": [&#123;"name": "server.ports","properties": &#123;&#125;&#125;,&#123;"name": "commandLineArgs","properties": &#123;&#125;&#125;,&#123;"name": "servletContextInitParams","properties": &#123;&#125;&#125;,&#123;"name": "systemProperties","properties": &#123;&#125;&#125;,&#123;"name": "systemEnvironment","properties": &#123;&#125;&#125;,&#123;"name": "springCloudClientHostInfo","properties": &#123;&#125;&#125;,&#123;"name": "applicationConfig: [classpath:/application.properties]","properties": &#123;&#125;&#125;]&#125; é€è¿‡çŽ°è±¡æ‰¾æºç  commandLineArgs -&gt; findInPath -&gt; scope : project and library CommandLinePropertySource.COMMAND_LINE_PROPERTY_SOURCE_NAME find usage spring bootçš„å¼•ç”¨-&gt; org.springframework.boot.SpringApplication#configurePropertySources è¿™æ ·å°±å¯ä»¥ç»§ç»­åˆ†æžæºç  sources.addFirst(new SimpleCommandLinePropertySource(args)) 12345678910111213141516171819202122protected void configurePropertySources(ConfigurableEnvironment environment, String[] args) &#123; MutablePropertySources sources = environment.getPropertySources(); if (this.defaultProperties != null &amp;&amp; !this.defaultProperties.isEmpty()) &#123; sources.addLast( new MapPropertySource("defaultProperties", this.defaultProperties)); &#125; if (this.addCommandLineProperties &amp;&amp; args.length &gt; 0) &#123; String name = CommandLinePropertySource.COMMAND_LINE_PROPERTY_SOURCE_NAME; if (sources.contains(name)) &#123; PropertySource&lt;?&gt; source = sources.get(name); CompositePropertySource composite = new CompositePropertySource(name); composite.addPropertySource(new SimpleCommandLinePropertySource( "springApplicationCommandLineArgs", args)); composite.addPropertySource(source); sources.replace(name, composite); &#125; else &#123; sources.addFirst(new SimpleCommandLinePropertySource(args)); &#125; &#125;&#125; ä»Žè¿™æ®µä»£ç ï¼Œå¯ä»¥çœ‹å‡ºï¼ŒdefaultPropertiesä¼˜å…ˆçº§æœ€ä½Žï¼Œæ”¾åœ¨æœ€åŽã€‚commandLineä¼˜å…ˆçº§å¾ˆé«˜ï¼Œæ”¾åœ¨æœ€å‰é¢ï¼ŒaddFirstã€‚ ä»£ç demohttps://github.com/Frankenjoy123/microservices-joey-project æ‰¾åˆ°spring-cloud-native-applicationé¡¹ç›®å…¥å£å¯åŠ¨]]></content>
      <categories>
        <category>Spring</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spring-framework 5.0.2æºç å¯¼å…¥ideaæ­¥éª¤åŠdemoå¼€å‘]]></title>
    <url>%2F2018%2F07%2F21%2FSpring-framework-5-0-2%E6%BA%90%E7%A0%81%E5%AF%BC%E5%85%A5idea%E6%AD%A5%E9%AA%A4%E5%8F%8Ademo%E5%BC%80%E5%8F%91%2F</url>
    <content type="text"><![CDATA[1.æºç çš„ä¸‹è½½Springçš„æºç å¯ä»¥ä»ŽGitHubä¸Šä¸‹è½½ï¼šhttps://github.com/spring-projects/spring-framework é€‰æ‹©tag5.0.2ï¼Œä¸‹è½½zipæ–‡ä»¶ 2. æºç ç¼–è¯‘å¯ä»¥å‚è€ƒimport-into-idea.mdæ–‡æ¡£ æ‰§è¡Œ./gradlew :spring-oxm:compileTestJava å…ˆå¯¹ Spring-oxm æ¨¡å—è¿›è¡Œé¢„ç¼–è¯‘ã€‚ åœ¨IDEAä¸­ File -&gt; New -&gt; Project from Existing Sources -&gt; Navigate to directoryé€‰æ‹©build.graleæ–‡ä»¶æ‰“å¼€ åœ¨spring-aspectsä¸­å³é”®æ¨¡å—load/upload modulesï¼Œuploadspring-aspectsçš„ä¸‰ä¸ªå­ç›®å½• Spring-frameworkè·³è¿‡å•æµ‹ï¼Œå¯ä»¥æ‰§è¡Œ./gradlew build -x test 3.demoæ­å»º1.demoé…ç½®maven quick startå¿«é€Ÿæ­å»ºè¿™é‡Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„Demoï¼Œè¯¥Demoä¾èµ–äºŽSpringçš„æºç ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥ä»Žå¤–éƒ¨ï¼Œè¿è¡ŒDemoï¼Œè·Ÿè¸ªåˆ°Springçš„å†…éƒ¨æºç äº†ã€‚ä¸ºä¸å¤±ä¸€èˆ¬æ€§ï¼Œè¿™é‡Œçš„Demoé‡‡ç”¨MVNè¿›è¡Œæž„å»ºï¼Œåªä¸è¿‡ï¼Œç›¸å…³çš„Springçš„æºç ä¾èµ–éœ€è¦åœ¨IDEAä¸­è®¾ç½®æˆæœ¬åœ°æºç  â‘ ä½¿ç”¨IDEA åœ¨Springçš„æºç çš„Projectç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªDemoï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨MVNçš„éª¨æž¶ è®¾ç½®ä¾èµ–Aã€è®¾ç½®ä¸€ä¸‹pom.xml ä¸­çš„ junit ä¾èµ–ç‰ˆæœ¬ï¼Œä¿®æ”¹ä¸º 4.12 å¦åˆ™Springçš„å•å…ƒæµ‹è¯•ï¼Œç¼–è¯‘ä¸é€šè¿‡ Bã€åœ¨IDEAè®¾ç½®Springçš„é¡¹ç›®ä¾èµ–ï¼ˆè®¾ç½®Spring-coreã€Spring-beansã€Spring-contextã€Spring-expressionè¿™å‡ ä¸ªmoduleå°±å¯ä»¥äº†ï¼‰ï¼š Cã€pom.xmlä¸­éœ€è¦å¼•å…¥commons-loggingçš„ä¾èµ–,å¦åˆ™ç¼–è¯‘æŠ¥æ‰¾ä¸åˆ°LogginFactoryçš„é”™è¯¯.é…ç½®é™æ€èµ„æºè·¯å¾„(å¦åˆ™è¯»å–xmlçš„æ—¶å€™,æ‰¾ä¸åˆ°è·¯å¾„) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.joey.demo&lt;/groupId&gt; &lt;artifactId&gt;demo-start&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;name&gt;demo-start&lt;/name&gt; &lt;!-- FIXME change it to the project's website --&gt; &lt;url&gt;http://www.example.com&lt;/url&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;commons-logging&lt;/groupId&gt; &lt;artifactId&gt;commons-logging&lt;/artifactId&gt; &lt;version&gt;1.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;pluginManagement&gt;&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.0&lt;/version&gt; &lt;/plugin&gt; &lt;!-- see http://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_jar_packaging --&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.2&lt;/version&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;version&gt;3.7.0&lt;/version&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt; &lt;version&gt;2.20.1&lt;/version&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt; &lt;version&gt;3.0.2&lt;/version&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt; &lt;version&gt;2.5.2&lt;/version&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt; &lt;version&gt;2.8.2&lt;/version&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/pluginManagement&gt; &lt;/build&gt;&lt;/project&gt; Dã€è®¾ç½®Springçš„é…ç½®å’Œç¼–å†™ç®€å•çš„Springä»£ç  åˆ›å»ºä¸€ä¸ªç®€å•çš„ ç™»å½•æŽ¥å£ ILoginï¼š 123public interface ILogin &#123; String loginCheck(String userName,String password);&#125; å®ƒæœ‰ä¸ªå®žçŽ°ç±»ï¼š 12345678910111213141516public class LoginServiceImpl implements ILogin &#123; String id = ""; @Autowired(required = false) public void setId(String id) &#123; this.id = id; &#125; @Override public String loginCheck(String userName, String password) &#123; System.out.println("boyç™»å½•..."); return "success"; &#125;&#125; ç„¶åŽï¼ŒæŠŠè¯¥bean æ³¨å†Œåˆ°é…ç½®ä¸­(è·¯å¾„spring-debug/src/spring-config.xml)ï¼š 1234567&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt; &lt;bean id="loginService" class="com.joey.demo.service.impl.LoginServiceImpl"/&gt;&lt;/beans&gt; æœ€åŽï¼Œç¼–å†™è°ƒç”¨çš„ä»£ç ï¼š 1234567891011121314151617public class App&#123; public static void main( String[] args ) &#123; ApplicationContext applicationContext = new ClassPathXmlApplicationContext("classpath:applicationContext.xml");// String XMLPath = "//Users/sky/Java/spring-framework/spring-debug/src/spring-config.xml";// ApplicationContext applicationContext = new FileSystemXmlApplicationContext(XMLPath); ILogin login = (ILogin) applicationContext.getBean("loginService"); login.loginCheck("boy", "123"); &#125;&#125; ç„¶åŽå°±å¯ä»¥ è¿›è¡ŒDebugäº†ï¼Œå¹¶ä¸”å¯ä»¥Debugåˆ°Springæºç å†…éƒ¨ã€‚]]></content>
      <categories>
        <category>Spring</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[XMindå¿«æ·é”®æŒ‡å—]]></title>
    <url>%2F2018%2F07%2F20%2FXMind%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%8C%87%E5%8D%97%2F</url>
    <content type="text"><![CDATA[å¿«æ·éµï¼ˆWindowsï¼‰ å¿«æ·éµï¼ˆMacï¼‰ æè¿° Ctrl+N Command+N å»ºç«‹æ–°å·¥ä½œç°¿ Ctrl+O Command+O å¼€å¯å·¥ä½œç°¿ Ctrl+S Command+S å‚¨å­˜ç›®å‰å·¥ä½œç°¿ Ctrl+Shift+S Command+Shift+S å‚¨å­˜å…¨éƒ¨å·¥ä½œç°¿ Ctrl+W Command+W å…³é—­ç›®å‰å·¥ä½œç°¿ Ctrl+Shift+W Command+Shift+W å…³é—­å…¨éƒ¨å·¥ä½œç°¿ Ctrl+P Command+P åˆ—å° Ctrl+Z Command+Z å¤åŽŸ Ctrl+Y Command+Y é‡åš Ctrl+X Command+X å‰ªåˆ‡ Ctrl+C Command+C å¤åˆ¶ Ctrl+V Command+V è´´ä¸Š Delete Delete åˆ é™¤ Ctrl+Home Command+Home è¿”å›žä¸­å¿ƒä¸»é¡Œ Ctrl+A Command+A é€‰æ‹©å…¨éƒ¨ä¸»é¡Œ Ctrl+Shift+A Command+Shift+A é€‰æ‹©åŒå±¤ç´šä¸»é¡Œ Ctrl+Alt+A Command+Alt+A é€‰æ‹©å­ä¸»é¡Œ Ctrl+F Command+F å¯»æ‰¾/å–ä»£ Ctrl++ Command++ æ”¾å¤§ Ctrl+- Command+- ç¼©å° Ctrl+= Command+= æ­£å¸¸å¤§å° Ctrl+] Command+] æ’å…¥æ‘˜è¦ Alt+Enter Alt+Enter å±žæ€§å†…å®¹å…§å®¹ Enter Enter æ’å…¥ä¸»é¢˜ Tab Tab æ’å…¥å­ä¸»é¢˜ Shift+Enter Shift+Enter åœ¨ç›®å‰ä¸»é¢˜å‰æ’å…¥ä¸»é¢˜ Ctrl+Enter Command+Enter æ’å…¥ç›®å‰ä¸»é¢˜çˆ¶ä¸»é¢˜ Ctrl+Shift+L Command+Shift+L å¿«æ·éµåŠ©æ‰‹ Ctrl+I Ctrl+I æ’å…¥å›¾ç‰‡ Ctrl+Shift+H Command+Shift+H æ’å…¥è¶…é“¾æŽ¥ Ctrl+B Command+B æ·»åŠ å¤–æ¡† Ctrl+L Command+L æ·»åŠ å…³è” F2 F2 ç¼–è¾‘ä¸»é¢˜ F3 F3 æ·»åŠ /ç¼–è¾‘æ ‡ç­¾ F4 F4 æ·»åŠ /ç¼–è¾‘å¤‡æ³¨ F5 F5 ç®€æŠ¥æ¼”ç¤º F6 F6 ä¸‹é’» Shift+F6 Shift+F6 ä¸Šé’» F7 F7 æ™ºæ…§æˆªå–å›¾é¢ + + å±•å¼€ç›®å‰åˆ†æ”¯ - - æ”¶ç¼©ç›®å‰åˆ†æ”¯ * * å±•å¼€æ‰€æœ‰åˆ†æ”¯ / / æ”¶ç¼©æ‰€æœ‰åˆ†æ”¯ Alt+Up Alt+Up å‘å‰ç§»åŠ¨ Alt+Down Alt+Down å‘åŽç§»åŠ¨ Ctrl+T Command+T å»ºç«‹æ–°å¿ƒæ™ºå›¾ Ctrl+1,2,3,4,5,6 Command+1,2,3,4,5,6 å¿«é€Ÿæ·»åŠ ä¼˜å…ˆç­‰çº§å›¾æ ‡ Esc Esc å…³é—­è·³å‡ºçš„å¤‡æ³¨å¯¹è¯æ¡† / å–æ¶ˆæˆªå›¾ Ctrl+æ»‘é¼ æ»šè½® Command+æ»‘é¼ æ»šè½® æ”¾å¤§ç¼©å°ç›®å‰çš„ç”»é¢]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[ç†è§£springä¸­çš„BeanFactoryä¸ŽFactoryBeanåŒºåˆ«]]></title>
    <url>%2F2018%2F07%2F19%2F%E7%90%86%E8%A7%A3spring%E4%B8%AD%E7%9A%84BeanFactory%E4%B8%8EFactoryBean%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[å®žçŽ° BeanFactory æŽ¥å£çš„ç±»è¡¨æ˜Žæ­¤ç±»äº‹ä¸€ä¸ªå·¥åŽ‚ï¼Œä½œç”¨å°±æ˜¯é…ç½®ã€æ–°å»ºã€ç®¡ç† å„ç§Beanã€‚DefaultListBeanFacoryç­‰éƒ½å®žçŽ°è¿™ä¸ªæŽ¥å£ï¼ŒIOCå®¹å™¨ï¼Œç®¡ç†beanã€‚ è€Œ å®žçŽ° FactoryBean çš„ç±»è¡¨æ˜Žæ­¤ç±»ä¹Ÿæ˜¯ä¸€ä¸ªBeanï¼Œç±»åž‹ä¸ºå·¥åŽ‚Beanï¼ˆSpringä¸­å…±æœ‰ä¸¤ç§beanï¼Œä¸€ç§ä¸ºæ™®é€šbeanï¼Œå¦ä¸€ç§åˆ™ä¸ºå·¥åŽ‚beanï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒä¹Ÿæ˜¯ç”¨æ¥ç®¡ç†Beançš„ï¼Œè€Œå®ƒæœ¬èº«ç”±springç®¡ç†ã€‚ ä¸€ä¸ªBeanæƒ³è¦å®žçŽ° FactoryBean ï¼Œå¿…é¡»å®žçŽ°ä»¥ä¸‹ä¸‰ä¸ªæŽ¥å£ï¼š 123451. Object getObject():è¿”å›žç”±FactoryBeanåˆ›å»ºçš„Beançš„å®žä¾‹2. boolean isSingleton():ç¡®å®šç”±FactoryBeanåˆ›å»ºçš„Beançš„ä½œç”¨åŸŸæ˜¯singletonè¿˜æ˜¯prototypeï¼›3. getObjectType():è¿”å›žFactoryBeanåˆ›å»ºçš„Beançš„ç±»åž‹ã€‚12345 æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå¦‚æžœå°†ä¸€ä¸ªå®žçŽ°äº†FactoryBeançš„ç±»æˆåŠŸé…ç½®åˆ°äº†springä¸Šä¸‹æ–‡ä¸­ï¼Œé‚£ä¹ˆé€šè¿‡è¯¥ç±»å¯¹è±¡çš„åç§°ï¼ˆæ¯”å¦‚appleFactoryBeanï¼‰ä»Žspringçš„applicationContextæˆ–è€…beanFactoryèŽ·å–beanæ—¶ï¼ŒèŽ·å–åˆ°çš„æ˜¯appleFactoryBeanåˆ›å»ºçš„appleå®žä¾‹ï¼Œè€Œä¸æ˜¯appleFactoryBeanè‡ªå·±ï¼Œå¦‚æžœæƒ³é€šè¿‡springæ‹¿åˆ°appleFactoryBeanï¼Œéœ€è¦åœ¨åç§°å‰åŠ  &amp; ç¬¦å· ï¼š 1out.println(applicationContext.getBean("&amp;appleFactoryBean"))1 è¿™ä¸ªprefixåœ¨BeanFactoryæŽ¥å£æºç ä¸­æœ‰æåˆ°ï¼š 1234567/*** Used to dereference a &#123;@link FactoryBean&#125; instance and distinguish it from* beans &lt;i&gt;created&lt;/i&gt; by the FactoryBean. For example, if the bean named* &#123;@code myJndiObject&#125; is a FactoryBean, getting &#123;@code &amp;myJndiObject&#125;* will return the factory, not the instance returned by the factory.*/ String FACTORY_BEAN_PREFIX = "&amp;";1234567 è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒFactoryBeanç®¡ç†çš„beanå®žé™…ä¸Šä¹Ÿæ˜¯ç”±springè¿›è¡Œé…ç½®ã€å®žä¾‹åŒ–ã€ç®¡ç†ï¼Œå› æ­¤ç”±FactoryBeanç®¡ç†çš„beanä¸èƒ½å†æ¬¡é…ç½®åˆ°springé…ç½®æ–‡ä»¶ä¸­ï¼ˆxmlã€javaç±»é…ç½®ã€æ³¨è§£å‡ä¸å¯ä»¥ï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥å¦‚ä¸‹å¼‚å¸¸ï¼š 1234567891011121314Exception in thread "main" org.springframework.beans.factory.BeanIsNotAFactoryException: Bean named 'appleFactoryBean' is expected to be of type 'org.springframework.beans.factory.FactoryBean' but was actually of type 'java.lang.Object' at org.springframework.beans.factory.support.AbstractBeanFactory.getObjectForBeanInstance(AbstractBeanFactory.java:1612) at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:317) at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197) at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:742) at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:866) at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:542) at org.springframework.context.annotation.AnnotationConfigApplicationContext.&lt;init&gt;(AnnotationConfigApplicationContext.java:84) at com.joen.testspringcontainer.Start.main(Start.java:11) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at com.intellij.rt.execution.application.AppMain.main(AppMain.java:147)1234567891011121314 é™„ä¸Šä¸€ä¸ªä¾‹å­ï¼š springé…ç½®ç±»ï¼š 1234@Configuration@ComponentScanpublic class Configurations &#123;&#125;1234 AppleBean : 1234//@Component è¿™é‡Œä¸å¯ä»¥åŠ æ³¨è§£ ï¼ï¼ï¼ï¼ï¼ï¼public class AppleBean&#123;&#125;1234 AppleFactoryBean : 123456789101112131415@Componentpublic class AppleFactoryBean implements FactoryBean&#123; public Object getObject() throws Exception &#123; return new AppleBean(); &#125; public Class&lt;?&gt; getObjectType() &#123; return AppleBean.class; &#125; public boolean isSingleton() &#123; return false; &#125;&#125;123456789101112131415 å¯åŠ¨ç±» : 1234567public class Start &#123; public static void main(String[] args)&#123; ApplicationContext applicationContext = new AnnotationConfigApplicationContext(Configurations.class); out.println(applicationContext.getBean("appleFactoryBean"));//å¾—åˆ°çš„æ˜¯apple out.println(applicationContext.getBean("&amp;appleFactoryBean"));//å¾—åˆ°çš„æ˜¯appleå·¥åŽ‚ &#125;&#125;]]></content>
      <categories>
        <category>Spring</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[cookieä¸­çš„pathä¸Ždomainå±žæ€§è¯¦è§£]]></title>
    <url>%2F2018%2F07%2F13%2Fcookie%E4%B8%AD%E7%9A%84path%E4%B8%8Edomain%E5%B1%9E%E6%80%A7%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[#å­—æ®µè§£é‡Š Domain â€“ åŸŸdomainè¡¨ç¤ºçš„æ˜¯cookieæ‰€åœ¨çš„åŸŸï¼Œé»˜è®¤ä¸ºè¯·æ±‚çš„åœ°å€ï¼Œå¦‚ç½‘å€ä¸ºwww.jb51.net/test/test.aspxï¼Œé‚£ä¹ˆdomainé»˜è®¤ä¸ºwww.jb51.netã€‚è€Œè·¨åŸŸè®¿é—®ï¼Œå¦‚åŸŸAä¸ºt1.test.comï¼ŒåŸŸBä¸ºt2.test.comï¼Œé‚£ä¹ˆåœ¨åŸŸAç”Ÿäº§ä¸€ä¸ªä»¤åŸŸAå’ŒåŸŸBéƒ½èƒ½è®¿é—®çš„cookieå°±è¦å°†è¯¥cookieçš„domainè®¾ç½®ä¸º.test.comï¼›å¦‚æžœè¦åœ¨åŸŸAç”Ÿäº§ä¸€ä¸ªä»¤åŸŸAä¸èƒ½è®¿é—®è€ŒåŸŸBèƒ½è®¿é—®çš„cookieå°±è¦å°†è¯¥cookieçš„domainè®¾ç½®ä¸ºt2.test.comã€‚ å€¼æ˜¯åŸŸåï¼Œæ¯”å¦‚www.china.comã€‚è¿™æ˜¯å¯¹pathè·¯å¾„å±žæ€§çš„ä¸€ä¸ªå»¶ä¼¸ã€‚å¦‚æžœæˆ‘ä»¬æƒ³è®© www.china.comèƒ½å¤Ÿè®¿é—®bbs.china.comè®¾ç½®çš„cookiesï¼Œè¯¥æ€Žä¹ˆåŠž? æˆ‘ä»¬å¯ä»¥æŠŠdomainå±žæ€§è®¾ç½®æˆâ€œ.china.comâ€ï¼Œå¹¶æŠŠpathå±žæ€§è®¾ç½®æˆâ€œ/â€ã€‚ è·¯å¾„èƒ½è§£å†³åœ¨åŒä¸€ä¸ªåŸŸä¸‹è®¿é—® cookie çš„é—®é¢˜ï¼Œå’±ä»¬æŽ¥ç€è¯´ cookie å®žçŽ°åŒåŸŸä¹‹é—´è®¿é—®çš„é—®é¢˜ã€‚è¯­æ³•å¦‚ä¸‹ï¼š document.cookie = â€œname=value;path=path;domain=domainâ€œ çº¢è‰²çš„domainå°±æ˜¯è®¾ç½®çš„ cookie åŸŸçš„å€¼ã€‚ä¾‹å¦‚ â€œwww.qq.comâ€ ä¸Ž â€œsports.qq.comâ€ å…¬ç”¨ä¸€ä¸ªå…³è”çš„åŸŸåâ€qq.comâ€ï¼Œæˆ‘ä»¬å¦‚æžœæƒ³è®©â€sports.qq.comâ€ ä¸‹çš„cookieè¢« â€œwww.qq.comâ€ è®¿é—®ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°cookie çš„domainå±žæ€§ï¼Œå¹¶ä¸”éœ€è¦æŠŠpathå±žæ€§è®¾ç½®ä¸º â€œ/â€œã€‚ä¾‹ï¼š document.cookie = â€œusername=Darren;path=/;domain=qq.comâ€œ æ³¨ï¼šä¸€å®šçš„æ˜¯åŒåŸŸä¹‹é—´çš„è®¿é—®ï¼Œä¸èƒ½æŠŠdomainçš„å€¼è®¾ç½®æˆéžä¸»åŸŸçš„åŸŸåã€‚ Path â€“ è·¯å¾„pathè¡¨ç¤ºcookieæ‰€åœ¨çš„ç›®å½•ï¼Œasp.neté»˜è®¤ä¸º/ï¼Œå°±æ˜¯æ ¹ç›®å½•ã€‚åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šæœ‰ç›®å½•å¦‚ä¸‹ï¼š/test/,/test/cd/,/test/dd/ï¼ŒçŽ°è®¾ä¸€ä¸ªcookie1çš„pathä¸º/test/ï¼Œcookie2çš„pathä¸º/test/cd/ï¼Œé‚£ä¹ˆtestä¸‹çš„æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥è®¿é—®åˆ°cookie1ï¼Œè€Œ/test/å’Œ/test/dd/çš„å­é¡µé¢ä¸èƒ½è®¿é—®cookie2ã€‚è¿™æ˜¯å› ä¸ºcookieèƒ½è®©å…¶pathè·¯å¾„ä¸‹çš„é¡µé¢è®¿é—®ã€‚ å€¼å¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªè·¯å¾„ã€‚å¦‚æžœhttp://www.china.com/test/index.html å»ºç«‹äº†ä¸€ä¸ªcookieï¼Œé‚£ä¹ˆåœ¨http://www.china.com/test/ç›®å½•é‡Œçš„æ‰€æœ‰é¡µé¢ï¼Œä»¥åŠè¯¥ç›®å½•ä¸‹é¢ä»»ä½•å­ç›®å½•é‡Œçš„é¡µé¢éƒ½å¯ä»¥è®¿é—®è¿™ä¸ªcookieã€‚è¿™å°±æ˜¯è¯´ï¼Œåœ¨http://www.china.com/test/test2/test3 é‡Œçš„ä»»ä½•é¡µé¢éƒ½å¯ä»¥è®¿é—®http://www.china.com/test/index.htmlå»ºç«‹çš„cookieã€‚ä½†æ˜¯ï¼Œå¦‚æžœhttp://www.china.com/test/ éœ€è¦è®¿é—®http://www.china.com/test/index.htmlè®¾ç½®çš„cookesï¼Œè¯¥æ€Žä¹ˆåŠžï¼Ÿè¿™æ—¶ï¼Œæˆ‘ä»¬è¦æŠŠcookiesçš„pathå±žæ€§è®¾ç½®æˆâ€œ/â€ã€‚åœ¨æŒ‡å®šè·¯å¾„çš„æ—¶å€™ï¼Œå‡¡æ˜¯æ¥è‡ªåŒä¸€æœåŠ¡å™¨ï¼ŒURLé‡Œæœ‰ç›¸åŒè·¯å¾„çš„æ‰€æœ‰WEBé¡µé¢éƒ½å¯ä»¥å…±äº«cookiesã€‚ Expires â€“ è¿‡æœŸæ—¶é—´æŒ‡cookieçš„ç”Ÿå‘½æœŸï¼Œç¡®åˆ‡åœ°è¯´æ˜¯è¿‡æœŸæ—¥æœŸã€‚å¦‚æžœæƒ³è®©cookieçš„å­˜åœ¨æœŸé™è¶…è¿‡å½“å‰æµè§ˆå™¨çš„ä¼šè¯æ—¶é—´ï¼Œå°±å¿…é¡»ä½¿ç”¨è¿™ä¸ªå±žæ€§ã€‚å½“è¿‡äº†åˆ°æœŸæ—¥æœŸæ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ é™¤cookieæ–‡ä»¶ã€‚ expires/Max-Age å­—æ®µä¸ºæ­¤cookieè¶…æ—¶æ—¶é—´ã€‚è‹¥è®¾ç½®å…¶å€¼ä¸ºä¸€ä¸ªæ—¶é—´ï¼Œé‚£ä¹ˆå½“åˆ°è¾¾æ­¤æ—¶é—´åŽï¼Œæ­¤cookieå¤±æ•ˆã€‚ä¸è®¾ç½®çš„è¯é»˜è®¤å€¼æ˜¯Sessionï¼Œæ„æ€æ˜¯cookieä¼šå’Œsessionä¸€èµ·å¤±æ•ˆã€‚å½“æµè§ˆå™¨å…³é—­(ä¸æ˜¯æµè§ˆå™¨æ ‡ç­¾é¡µï¼Œè€Œæ˜¯æ•´ä¸ªæµè§ˆå™¨) åŽï¼Œæ­¤cookieå¤±æ•ˆã€‚ 3.æµè§ˆå™¨ä¼šå°†domainå’Œpathéƒ½ç›¸åŒçš„cookieä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œcookieé—´ç”¨*éš”å¼€ã€‚ ##Secure â€“ å®‰å…¨ è®¾ç½®æ˜¯å¦åªèƒ½é€šè¿‡httpsæ¥ä¼ é€’cookie ##httpå­—æ®µ cookieçš„httponlyå±žæ€§ã€‚è‹¥æ­¤å±žæ€§ä¸ºtrueï¼Œåˆ™åªæœ‰åœ¨httpè¯·æ±‚å¤´ä¸­ä¼šå¸¦æœ‰æ­¤cookieçš„ä¿¡æ¯ï¼Œè€Œä¸èƒ½é€šè¿‡document.cookieæ¥è®¿é—®æ­¤cookieã€‚ Sizeå­—æ®µæ­¤cookieå¤§å°ã€‚ æµ‹è¯•ä»Šå¤©ç ”ç©¶ä¸€å¤©å‘çŽ°cookieæ— æ³•è®¾ç½®é™¤å½“å‰åŸŸåæˆ–è€…å…¶çˆ¶åŸŸåä¹‹å¤–çš„å…¶ä»–domain. è¿™ä¸ªæ˜¯æµè§ˆå™¨å‡ºäºŽå¯¹cookieçš„ä¿æŠ¤é€ æˆçš„ï¼Œä¹Ÿå°±æ˜¯cookieæ— æ³•è·¨åŸŸè®¾ç½®ã€‚ å¯¹äºŽå­åŸŸåä¹Ÿæœ‰å¦‚ä¸‹è§„åˆ™ï¼Œå½“å‰åŸŸååªèƒ½è®¾ç½®å½“å‰åŸŸåä»¥åŠä»–çš„çˆ¶åŸŸåï¼Œä¸èƒ½è®¾ç½®å­åŸŸå å¦‚åœ¨www.wo.cao.baidu.com åŸŸåä¸‹åªèƒ½è®¾ç½® cao.baidu.com baidu.com ä¸èƒ½è®¾ç½® da.jia.wo.cao.baidu.comçš„cookieã€‚ å½“æˆ‘ä»¬ç»™ç½‘ç«™è®¾ç½®cookieæ—¶ï¼Œå¤§å®¶æœ‰æ²¡æœ‰å‘çŽ°åœ¨ç½‘ç«™çš„å…¶ä»–åŸŸåä¸‹ä¹ŸæŽ¥æ”¶åˆ°äº†è¿™äº›cookieã€‚è¿™äº›æ²¡ç”¨çš„cookieçœ‹ä¼¼ä¸å å¤šå°‘æµé‡ï¼Œä½†å¦‚æžœå¯¹ä¸€ä¸ªæ—¥PVåƒä¸‡çš„ç«™ç‚¹æ¥è¯´ï¼Œé‚£æµªè´¹çš„èµ„æºå°±ä¸æ˜¯ä¸€ç‚¹ç‚¹äº†ã€‚å› æ­¤åœ¨è®¾ç½®cookieæ—¶ï¼Œå¯¹å®ƒçš„ä½œç”¨åŸŸä¸€å®šè¦è®¾ç½®å‡†ç¡®äº†ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“åœ¨PHPä¸­ç”¨setcookie æ¥è®¾ç½®ç½‘ç«™çš„cookieï¼Œè¯¥å‡½æ•°çš„ç”¨æ³•å¦‚ä¸‹ï¼š bool setcookie ( string $name [, string $value [, int$expire = 0 [, string$path [, string $domain [, bool$secure = false [, bool$httponly = false ]]]]]] ) ä»Šå¤©æˆ‘ä»¬å°±æ¥æŽ¢è®¨ä¸€ä¸‹å®ƒçš„ç¬¬äº”ä¸ªå‚æ•°$domainï¼Œå› ä¸ºå®ƒå†³å®šäº†cookieçš„ä½œç”¨åŸŸã€‚ çŽ°åœ¨æœ‰å¦‚ä¸‹3ä¸ªåŸŸåï¼Œä¸€ä¸ªé¡¶çº§åŸŸåã€ä¸€ä¸ªäºŒçº§åŸŸåå’Œä¸€ä¸ªä¸‰çº§åŸŸåï¼š â‘  zydya.comâ‘¡blog.zyday.comâ‘¢one.blog.zyday.com é¦–å…ˆåœ¨â‘ zyday.comåŸŸåä¸‹è®¾ç½®cookieï¼Œåšå››æ¬¡æµ‹è¯•ï¼Œåˆ†åˆ«è®¾ç½®domainå‚æ•°ä¸ºç©ºã€â€™zyday.comâ€™ã€â€™blog.zyday.comâ€™ä¸Žâ€™one.blog.zyday.comâ€™ã€‚âˆšè¡¨ç¤ºè¯¥åŸŸåä¸‹èƒ½å–åˆ°cookieï¼ŒÃ—è¡¨ç¤ºä¸èƒ½å–åˆ°cookie domainå‚æ•° zydya.com blog.zyday.com one.blog.zyday.com setcookie(â€˜nameâ€™,1,time()+1) âˆš âˆš âˆš setcookie(â€˜nameâ€™,1,time()+1,â€™/â€˜,â€™zyday.comâ€™) âˆš âˆš âˆš setcookie(â€˜nameâ€™,1,time() +1,â€™/â€˜,â€™blog.zyday.comâ€™) Ã— Ã— Ã— setcookie(â€˜nameâ€™,1,time() +1,â€™/â€˜,â€™one.blog.zyday.comâ€™) Ã— Ã— Ã— å½“domainè®¾ç½®ä¸ºç©ºæ—¶ï¼Œdomainé»˜è®¤ä¸ºå½“å‰åŸŸåï¼Œå¹¶ä¸”è¯¥åŸŸåä¸‹çš„å­åŸŸåéƒ½å¯ä»¥æŽ¥æ”¶åˆ°cookieã€‚ä½†æ˜¯domainå‚æ•°è®¾ç½®å…¶å­åŸŸåæ—¶ï¼Œæ‰€æœ‰åŸŸåå°±æŽ¥æ”¶ä¸åˆ°äº†ï¼ŒåŒ…æ‹¬é‚£ä¸ªå­åŸŸåã€‚ åªèƒ½è®¾ç½®å½“å‰åŸŸåæˆ–è€…çˆ¶åŸŸåçš„cookieï¼Œ ç„¶åŽåœ¨â‘¡blog.zyday.comåŸŸåä¸‹è®¾ç½®cookieï¼Œæµ‹è¯•æ¡ä»¶åŒä¸Š domainå‚æ•° zydya.com *blog.zyday.com* one.blog.zyday.com setcookie(â€˜nameâ€™,1,time() +1) Ã— âˆš âˆš setcookie(â€˜nameâ€™,1,time()+1,â€™/â€˜,â€™zyday.comâ€™) âˆš âˆš âˆš setcookie(â€˜nameâ€™,1,time()+1,â€™/â€˜,â€™blog.zyday.comâ€™) Ã— âˆš âˆš setcookie(â€˜nameâ€™,1,time()+1,â€™/â€˜,one.blog.zyday.comâ€™) Ã— Ã— Ã— çœ‹ç¬¬äºŒè¡Œï¼Œdomainå‚æ•°æ˜¯zyday.comï¼Œæ˜¯blog.zyday.comçš„çˆ¶åŸŸåï¼Œé‚£ä¹ˆzyday.comä¸‹æ‰€æœ‰å­åŸŸå(åŒ…æ‹¬zyday.comã€blog.zyday.comã€one.blog.zyday.com)éƒ½èƒ½æŽ¥æ”¶åˆ°cookieã€‚å½“domainä¸ºè‡ªèº«åŸŸåæ—¶ï¼Œé‚£ä¹ˆå…¶çˆ¶åŸŸåå—å½±å“ï¼Œå…¶æœ¬èº«ä¸Žå…¶å­åŸŸåå¯ä»¥æŽ¥æ”¶åˆ°cookieã€‚è€Œè®¾ç½®å…¶å­åŸŸåæˆ–å…¶ä»–åŸŸåæ—¶ï¼Œæ‰€æœ‰åŸŸåéƒ½æŽ¥æ”¶ä¸åˆ°cookieäº†ã€‚ æœ€åŽåœ¨â‘¢one.blog.zyday.comåŸŸåä¸‹è®¾ç½®cookie domainå‚æ•° zydya.com blog.zyday.com *one.blog.zyday.com* setcookie(â€˜nameâ€™,1,time() +1) Ã— Ã— âˆš setcookie(â€˜nameâ€™,1,time()+1,â€™/â€˜,â€™zyday.comâ€™) âˆš âˆš âˆš setcookie(â€˜nameâ€™,1,time()+1,â€™/â€˜,â€™blog.zyday.comâ€™) Ã— âˆš âˆš setcookie(â€˜nameâ€™,1,time()+1,â€™/â€˜,one.blog.zyday.comâ€™) Ã— Ã— âˆš ç¬¬ä¸‰ä¸ªæµ‹è¯•å¾—å‡ºçš„ç»“è®ºåœ¨ä¸Šé¢å·²ç»æ€»ç»“äº†ã€‚å†çœ‹ä¸€éï¼Œè¿™é‡Œå°±ä¸å¤šè§£é‡Šäº†ã€‚ domainçš„è®¾ç½®ï¼Œæœ‰ä¸¤ç‚¹è¦æ³¨æ„ï¼š 1.åœ¨setcookieä¸­çœç•¥domainå‚æ•°ï¼Œé‚£ä¹ˆdomainé»˜è®¤ä¸ºå½“å‰åŸŸåã€‚ 2.domainå‚æ•°å¯ä»¥è®¾ç½®çˆ¶åŸŸåä»¥åŠè‡ªèº«ï¼Œä½†ä¸èƒ½è®¾ç½®å…¶å®ƒåŸŸåï¼ŒåŒ…æ‹¬å­åŸŸåï¼Œå¦åˆ™cookieä¸èµ·ä½œç”¨ã€‚ é‚£ä¹ˆcookieçš„ä½œç”¨åŸŸï¼š cookieçš„ä½œç”¨åŸŸæ˜¯domainæœ¬èº«ä»¥åŠdomainä¸‹çš„æ‰€æœ‰å­åŸŸåã€‚ è®¾ç½®COOKIEé¡¶çº§åŸŸåé¡¶çº§åŸŸååªèƒ½è®¾ç½®domainä¸ºé¡¶çº§åŸŸåï¼Œä¸èƒ½è®¾ç½®ä¸ºäºŒçº§åŸŸåæˆ–è€…ä¸‰çº§åŸŸåç­‰ç­‰ï¼Œå¦åˆ™cookieæ— æ³•ç”Ÿæˆã€‚ å¦‚yangbai.comèƒ½è®¾ç½®domainä¸ºyangbai.comæˆ–è€…www.yangbai.comï¼Œä½†ä¸èƒ½è®¾ç½®domainä¸ºlogin.yangbai.comï¼Œè¿™æ ·cookieä¸ä¼šç”Ÿæˆã€‚ ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼š 1234setcookie("name1", "yangbai", time() + 1000);//yangbai.comè‡ªå·±å¯ä»¥çœ‹åˆ°setcookie("name2", "yangbai", time() + 1000, "/", "www.yangbai.com");//*.www.yangbai.coméƒ½å¯ä»¥çœ‹åˆ°setcookie("name3", "yangbai", time() + 1000, "/", "yangbai.com");//*.yangbai.coméƒ½å¯ä»¥çœ‹åˆ°setcookie("name4", "yangbai", time() + 1000, "/", "login.youzan.com");//è®¾ç½®æ— æ•ˆ è®¾ç½®domainçš„æ—¶å€™ï¼Œ.yangbai.comå’Œyangbai.comæ˜¯ä¸€æ ·çš„ã€‚æœªæŒ‡å®šdomainæ—¶ï¼Œé»˜è®¤çš„domainä¸ºç”¨å“ªä¸ªåŸŸåè®¿é—®å°±æ˜¯å“ªä¸ªã€‚ æ‰§è¡ŒåŽï¼Œwww.yangbai.comåœ¨æµè§ˆå™¨çš„cookieæƒ…å†µå¦‚ä¸‹å›¾ï¼š äºŒçº§åŸŸålogin.yangbai.comå’Œgame.yangbai.comæµè§ˆå™¨çš„cookieæƒ…å†µå¦‚ä¸‹å›¾ï¼š æ€»çš„æ¥è¯´ï¼Œé¡¶çº§åŸŸåè®¾ç½®çš„cookieå¯ä»¥å…±äº«ã€éœ€è¦æŒ‡å®šdomainä¸»åŸŸåçš„hostã€‘ç»™äºŒçº§åŸŸåï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç§æœ‰ã€ä¸æŒ‡å®šdomainã€‘ã€‚ äºŒçº§åŸŸåæ‹¿game.yangbai.comä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š 123setcookie("game", "yangbai");//åªæœ‰è‡ªå·±å¯ä»¥çœ‹åˆ°setcookie("game1", "yangbai", time() + 1000, "/", "yangbai.com");//*.yangbai.coméƒ½å¯ä»¥çœ‹åˆ°setcookie("game2", "yangbai", time() + 1000, "/", "chip.game.yangbai.com");//è®¾ç½®æ— æ•ˆ æ‰§è¡ŒåŽï¼Œgame.yangbai.comåœ¨æµè§ˆå™¨çš„cookieæƒ…å†µå¦‚ä¸‹å›¾ï¼š æ€»çš„æ¥è¯´ï¼Œè®¾ç½®cookieçš„è¯åªèƒ½åœ¨æœ¬åŸŸåä¸‹æˆ–è€…domainçº§åˆ«é«˜äºŽè‡ªèº«çš„åŸŸåä¸‹æ‰ä¼šç”Ÿæ•ˆï¼ è¯»å–COOKIEæœ‰äº†ä¸Šé¢çš„ä¾‹å­å’Œå®žè·µï¼Œå¤§æ¦‚çš„è§„åˆ™å¦‚ä¸‹ï¼š äºŒçº§åŸŸåèƒ½è¯»å–è®¾ç½®äº†domainä¸ºé¡¶çº§åŸŸåæˆ–è€…è‡ªèº«çš„cookieï¼Œä¸èƒ½è¯»å–å…¶ä»–äºŒçº§åŸŸådomainçš„cookieã€‚ä¾‹å¦‚ï¼šè¦æƒ³cookieåœ¨å¤šä¸ªäºŒçº§åŸŸåä¸­å…±äº«ï¼Œéœ€è¦è®¾ç½®domainä¸ºé¡¶çº§åŸŸåï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ‰€æœ‰äºŒçº§åŸŸåé‡Œé¢æˆ–è€…åˆ°è¿™ä¸ªcookieçš„å€¼äº†ã€‚ é¡¶çº§åŸŸååªèƒ½èŽ·å–åˆ°domainè®¾ç½®ä¸ºé¡¶çº§åŸŸåçš„cookieï¼Œdomainè®¾ç½®ä¸ºå…¶ä»–å­çº§åŸŸåçš„æ— æ³•èŽ·å–ã€‚ ä¿®æ”¹COOKIEé¡¶çº§åŸŸåé¡¶çº§åŸŸåçš„cookieåœ¨é¡¶çº§åŸŸåæˆ–è€…éžé¡¶çº§åŸŸåã€éœ€è¦è®¾ç½®domainä¸ºé¡¶çº§åŸŸåæ‰å¯ä»¥ã€‘éƒ½å¯ä»¥ä¿®æ”¹ã€‚ä»£ç å¦‚ä¸‹ï¼š 12345#ä¸ºæ‰€æœ‰äºŒçº§åŸŸåè®¾ç½®ä¸€ä¸ªcookiesetcookie("name", "yangbai", time() + 1000, "/", "yangbai.com");#åœ¨game.yangbai.comä¸‹é¢ä¿®æ”¹è¿™ä¸ªcookieå€¼setcookie("name", "yangbai11", time() + 1000, "/", "yangbai.com"); äºŒçº§åŸŸåä¿®æ”¹äºŒçº§åŸŸåè‡ªèº«ç”Ÿæˆçš„cookieä¸éœ€è¦è®¾ç½®domainï¼Œç›´æŽ¥è®¾ç½®å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š 12#ä¿®æ”¹game.yangbai.comä¸‹é¢è‡ªèº«çš„cookieå€¼setcookie("game", "chip", time() + 10000); åˆ é™¤COOKIEåˆ é™¤cookieç†è§£ä¸ºæ˜¯ä¿®æ”¹cookieçš„ä¸€ç§ç‰¹æ®Šåœºæ™¯ï¼Œåªéœ€å°†expireè®¾ç½®ä¸ºè¿‡æœŸã€å€¼è®¾ç½®ä¸ºnullå³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345#åˆ é™¤yangbai.comä¸‹é¢çš„cookieå€¼setcookie("name", null, time() - 1000, "/", "yangbai.com");#åˆ é™¤game.yangbai.comä¸‹é¢è‡ªèº«çš„cookieå€¼setcookie("game", null, time() - 1000);]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Mysql for mac å®‰è£…åŠçŽ¯å¢ƒé…ç½®]]></title>
    <url>%2F2018%2F07%2F07%2FMysql-for-mac-%E5%AE%89%E8%A3%85%E5%8F%8A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[ä¸€.ä¸‹è½½åŠå®‰è£…é¦–å…ˆåŽ»å®˜ç½‘ä¸‹è½½macå¯¹åº”ç‰ˆæœ¬çš„Mysql,å°¾ç¼€ä¸º.dmgçš„ç¨‹åºåŒ… ä¸‹è½½åœ°å€ï¼šhttps://dev.mysql.com/downloads/mysql/ ä¸‹è½½å®Œæ¯•åŽï¼Œä¸€æ­¥æ­¥å‚»ç“œå¼å®‰è£…å³å¯ï¼Œå®‰è£…å®ŒåŽmysqlä¼šå¼¹å‡ºä¸€ä¸ªæ¡†æ¡†ï¼Œå‘Šè¯‰ä½ å®‰è£…æˆåŠŸä»¥åŠrootç”¨æˆ·çš„åˆå§‹å¯†ç ï¼Œæ³¨æ„Mysql for Mac çš„åˆå§‹å¯†ç æ˜¯éšæœºç”Ÿæˆçš„ï¼Œæœ€å¥½è®°ä½ äºŒ.æ›´æ”¹åˆå§‹å¯†ç A.æ‰“å¼€ç»ˆç«¯ 1.è¿›å…¥mysqlçš„binç›®å½•ä¸‹ï¼ˆé»˜è®¤å®‰è£…çš„ç›®å½•ä¸º /usr/local/mysql/binï¼‰ cd /usr/local/mysql/bin/ 2.è¾“å…¥æŒ‡ä»¤ï¼Œä¼šæç¤ºè¾“å…¥å¯†ç ï¼ˆè¾“å…¥macè´¦æˆ·çš„rootå¯†ç ï¼‰ sudo ./mysqld_safe â€“skip-grant-tables 3.è¾“å…¥å¯†ç åŽï¼Œä¼šå‘çŽ°æœ‰ä¸€äº›æç¤ºï¼Œä¸”Mysqlä¼šè‡ªåŠ¨é‡å¯ B.å¦å¼€ä¸€ä¸ªç»ˆç«¯ 1ã€è¾“å…¥æŒ‡ä»¤1ï¼šï¼ˆè¿›å…¥åˆ°mysqlçš„binç›®å½•ä¸‹ï¼‰è¾“å…¥ï¼šcd /usr/local/mysql/bin/2ã€è¾“å…¥æŒ‡ä»¤2ï¼šè¾“å…¥ï¼š./mysql3ã€è¿›å…¥åˆ°mysqlå‘½ä»¤çŠ¶æ€ä¸‹ï¼šï¼ˆmysql&gt;æ˜¯mysqlå‘½ä»¤çŠ¶æ€æç¤ºï¼‰è¾“å…¥ï¼šmysql&gt; FLUSH PRIVILEGES;4ã€è®¾ç½®å¯†ç rootè¾“å…¥ï¼šmysql&gt; SET PASSWORD FOR &#39;root&#39;@&#39;localhost&#39; = PASSWORD(&#39;root&#39;); è‡³æ­¤ï¼Œåˆå§‹å¯†ç è®¾ç½®å®Œæ¯• ä¸‰.é…ç½®çŽ¯å¢ƒå˜é‡è‹¥ä¸è®¾ç½®çŽ¯å¢ƒå˜é‡ï¼Œè¾“å…¥å‘½ä»¤å¤ªç¹çï¼Œæ¯æ¬¡ç™»é™†Mysqlçš„å‘½ä»¤ä¸ºï¼š/usr/local/mysql/bin/ mysql -u root -p windowsç³»ç»Ÿç›´æŽ¥åœ¨çŽ¯å¢ƒå˜é‡ä¸­æ·»åŠ mysqlçš„è·¯å¾„å°±å¥½ï¼Œmacç³»ç»Ÿåˆ™éœ€è¦åœ¨homeç›®å½•ä¸‹çš„.bash_profileæ–‡ä»¶ä¸­æ–°å»ºpathè·¯å¾„æŒ‡å‘mysqlçš„è·¯å¾„ æŸ¥çœ‹homeç›®å½•ï¼š è¾“å…¥å‘½ä»¤ echo $HOME macé»˜è®¤çš„homeç›®å½•ä¸ºå½“å‰ç”¨æˆ·æ ¹ç›®å½• /Users/silverlaw é…ç½®çŽ¯å¢ƒå˜é‡ï¼š 1.æ‰“å¼€ç»ˆç«¯,è¾“å…¥ï¼š open .bash_profile 2.ç›´æŽ¥è¾“å…¥å¦‚ä¸‹è¯­å¥ï¼š export PATH=${PATH}:/usr/local/mysql/bin ä¿å­˜ï¼Œå…³é—­ç»ˆç«¯å’ŒTextEdit é‡æ–°æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼šmysql -u root -pï¼Œå³å¯æˆåŠŸç™»é™†]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[linuxæŠŠæ–‡ä»¶åŽ‹ç¼©æˆ.tar.gzçš„å‘½ä»¤]]></title>
    <url>%2F2018%2F07%2F05%2Flinux%E6%8A%8A%E6%96%87%E4%BB%B6%E5%8E%8B%E7%BC%A9%E6%88%90-tar-gz%E7%9A%84%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585901-.taræ ¼å¼è§£åŒ…ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar xvf FileName.taræ‰“åŒ…ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar cvf FileName.tar DirNameï¼ˆæ³¨ï¼štaræ˜¯æ‰“åŒ…ï¼Œä¸æ˜¯åŽ‹ç¼©ï¼ï¼‰02-.gzæ ¼å¼è§£åŽ‹1ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ gunzip FileName.gzè§£åŽ‹2ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ gzip -d FileName.gzåŽ‹ ç¼©ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ gzip FileName03-.tar.gzæ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar zxvf FileName.tar.gzåŽ‹ç¼©ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar zcvf FileName.tar.gz DirNameæŸ¥çœ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar ztvf FileName.tar.gz04-.bz2æ ¼å¼è§£åŽ‹1ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ bzip2 -d FileName.bz2è§£åŽ‹2ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ bunzip2 FileName.bz2åŽ‹ ç¼©ï¼š [ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ bzip2 -z FileName05-.tar.bz2æ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar jxvf FileName.tar.bz2åŽ‹ç¼©ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar jcvf FileName.tar.bz2 DirName06-.bzæ ¼å¼è§£åŽ‹1ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ bzip2 -d FileName.bzè§£åŽ‹2ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ bunzip2 FileName.bz07-.tar.bzæ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar jxvf FileName.tar.bz08-.Zæ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ uncompress FileName.ZåŽ‹ç¼©ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ compress FileName09-.tar.Zæ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar Zxvf FileName.tar.ZåŽ‹ç¼©ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar Zcvf FileName.tar.Z DirName10-.tgzæ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar zxvf FileName.tgz11-.tar.tgzæ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar zxvf FileName.tar.tgzåŽ‹ç¼©ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ tar zcvf FileName.tar.tgz FileName12-.zipæ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ unzip FileName.zipåŽ‹ç¼©ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ zip FileName.zip DirName13-.lhaæ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ lha -e FileName.lhaåŽ‹ç¼©ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ lha -a FileName.lha FileName14-.raræ ¼å¼è§£åŽ‹ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ rar a FileName.raråŽ‹ç¼©ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ rar e FileName.rarrarè¯·åˆ°ï¼šä¸‹è½½ï¼è§£åŽ‹åŽè¯·å°†rar_staticæ‹·è´åˆ°/usr/binç›®å½•ï¼ˆå…¶ä»–ç”±$PATHçŽ¯å¢ƒå˜é‡æŒ‡å®šçš„ç›®å½•ä¹Ÿè¡Œï¼‰ï¼š[ï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š]$ cp rar_static /usr/bin/rar]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Nginxå¸¸ç”¨é…ç½®åŠåå‘ä»£ç†è§£å†³è·¨åŸŸé—®é¢˜]]></title>
    <url>%2F2018%2F06%2F28%2FNginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[1.å®šä¹‰è·¨åŸŸæ˜¯æŒ‡aé¡µé¢æƒ³èŽ·å–bé¡µé¢èµ„æºï¼Œå¦‚æžœaã€bé¡µé¢çš„åè®®ã€åŸŸåã€ç«¯å£ã€å­åŸŸåä¸åŒï¼Œæ‰€è¿›è¡Œçš„è®¿é—®è¡ŒåŠ¨éƒ½æ˜¯è·¨åŸŸçš„ï¼Œè€Œæµè§ˆå™¨ä¸ºäº†å®‰å…¨é—®é¢˜ä¸€èˆ¬éƒ½é™åˆ¶äº†è·¨åŸŸè®¿é—®ï¼Œä¹Ÿå°±æ˜¯ä¸å…è®¸è·¨åŸŸè¯·æ±‚èµ„æºã€‚å¿…é¡»æ˜¯åè®®ã€åŸŸåã€ç«¯å£å…¨éƒ¨ä¸€è‡´ã€‚æ³¨æ„ï¼šè·¨åŸŸé™åˆ¶è®¿é—®ï¼Œå…¶å®žæ˜¯æµè§ˆå™¨çš„é™åˆ¶ã€‚ç†è§£è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼ï¼ï¼ 2.è·¨åŸŸè®¿é—®ç¤ºä¾‹å‡è®¾æœ‰ä¸¤ä¸ªç½‘ç«™ï¼ŒAç½‘ç«™éƒ¨ç½²åœ¨ï¼šhttp://localhost:81 å³æœ¬åœ°ipç«¯å£81ä¸Šï¼›Bç½‘ç«™éƒ¨ç½²åœ¨ï¼šhttp://localhost:82 å³æœ¬åœ°ipç«¯å£82ä¸Šã€‚ çŽ°åœ¨Aç½‘ç«™çš„é¡µé¢æƒ³åŽ»è®¿é—®Bç½‘ç«™çš„ä¿¡æ¯ï¼ŒAç½‘ç«™é¡µé¢çš„ä»£ç å¦‚ä¸‹ï¼ˆè¿™é‡Œä½¿ç”¨jqueryçš„å¼‚æ­¥è¯·æ±‚ï¼‰ï¼š 12345678&lt;h2&gt;Index&lt;/h2&gt;&lt;div id="show"&gt;&lt;/div&gt;&lt;script type="text/javascript"&gt; $(function () &#123; $.get("http://localhost:82/api/values", &#123;&#125;, function (result) &#123; $("#show").html(result); &#125;) &#125;) æµè§ˆå™¨ä¼šæç¤ºå¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š Origin ... is therefore not allowed access 3.nginxåå‘ä»£ç†è§£å†³è·¨åŸŸé—®é¢˜3.1nginxé…ç½®æ‰¾åˆ°nginxçš„é…ç½®æ–‡ä»¶â€œnginx.confâ€ï¼Œä¿®æ”¹ä¸€ä¸‹ä¿¡æ¯ 123456789101112131415161718server &#123; listen 80; #ç›‘å¬80ç«¯å£ï¼Œå¯ä»¥æ”¹æˆå…¶ä»–ç«¯å£ server_name localhost; # å½“å‰æœåŠ¡çš„åŸŸå #charset koi8-r; #access_log logs/host.access.log main; location / &#123; proxy_pass http://localhost:81; proxy_redirect default; &#125; location /apis &#123; #æ·»åŠ è®¿é—®ç›®å½•ä¸º/apisçš„ä»£ç†é…ç½® rewrite ^/apis/(.*)$ /$1 break; proxy_pass http://localhost:82; &#125;#ä»¥ä¸‹é…ç½®çœç•¥ é…ç½®è§£é‡Šï¼š ç”±é…ç½®ä¿¡æ¯å¯çŸ¥ï¼Œæˆ‘ä»¬è®©nginxç›‘å¬localhostçš„80ç«¯å£ï¼Œç½‘ç«™Aä¸Žç½‘ç«™Bçš„è®¿é—®éƒ½æ˜¯ç»è¿‡localhostçš„80ç«¯å£è¿›è¡Œè®¿é—®ã€‚ æˆ‘ä»¬ç‰¹æ®Šé…ç½®äº†ä¸€ä¸ªâ€œ/apisâ€ç›®å½•çš„è®¿é—®ï¼Œå¹¶ä¸”å¯¹urlæ‰§è¡Œäº†é‡å†™ï¼Œæœ€åŽä½¿ä»¥â€œ/apisâ€å¼€å¤´çš„åœ°å€éƒ½è½¬åˆ°â€œhttp://localhost:82â€è¿›è¡Œå¤„ç†ã€‚ rewrite ^/apis/(.*)$ /$1 break; ä»£è¡¨é‡å†™æ‹¦æˆªè¿›æ¥çš„è¯·æ±‚ï¼Œå¹¶ä¸”åªèƒ½å¯¹åŸŸååŽè¾¹ä»¥â€œ/apisâ€å¼€å¤´çš„èµ·ä½œç”¨ï¼Œä¾‹å¦‚www.a.com/apis/msg?x=1é‡å†™ã€‚åªå¯¹/apisé‡å†™ã€‚ è¯·æ±‚/msg?x=1è½¬å‘åˆ°localhost:82 rewriteåŽé¢çš„å‚æ•°æ˜¯ä¸€ä¸ªç®€å•çš„æ­£åˆ™ ^/apis/(.*)$ ,$1ä»£è¡¨æ­£åˆ™ä¸­çš„ç¬¬ä¸€ä¸ª(),$2ä»£è¡¨ç¬¬äºŒä¸ª()çš„å€¼,ä»¥æ­¤ç±»æŽ¨ã€‚ breakä»£è¡¨åŒ¹é…ä¸€ä¸ªä¹‹åŽåœæ­¢åŒ¹é…ã€‚ 3.2 è®¿é—®åœ°å€ä¿®æ”¹æ—¢ç„¶é…ç½®äº†nginxï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è®¿é—®éƒ½è¦èµ°nginxï¼Œè€Œä¸æ˜¯èµ°ç½‘ç«™åŽŸæœ¬çš„åœ°å€ï¼ˆAç½‘ç«™localhost:81,Bç½‘ç«™localhost:82ï¼‰ã€‚æ‰€ä»¥è¦ä¿®æ”¹Aç½‘ç«™ä¸­çš„ajaxè®¿é—®åœ°å€ï¼ŒæŠŠè®¿é—®åœ°å€ç”± â€œhttp://localhost:82/api/valuesâ€æ”¹æˆã€‹ã€‹ã€‹â€œ/apis/api/valuesâ€ã€‚å¦‚ä¸‹ä»£ç ï¼š api/valuesè½¬å‘åˆ°localhost:82 12345678910&lt;h2&gt;Index&lt;/h2&gt;&lt;div id="show"&gt;&lt;/div&gt;&lt;script type="text/javascript"&gt; $(function () &#123; $.get("/apis/api/values", &#123;&#125;, function (result) &#123; $("#show").html(result); &#125;) &#125;)&lt;/script&gt; ç¤ºä¾‹æ¡ˆä¾‹å‰ç«¯æ”¾åœ¨tomcat-test/webapps/testç›®å½• hello.htmlå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset="utf-8"&gt;&lt;title&gt;èœé¸Ÿæ•™ç¨‹(runoob.com)&lt;/title&gt;&lt;script src="https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"&gt;&lt;/script&gt;&lt;script&gt;$(document).ready(function()&#123; $("button").click(function()&#123; $.get("/apis/api/hello",function(data,status)&#123; alert("æ•°æ®: " + data + "\nçŠ¶æ€: " + status); &#125;); &#125;);&#125;);&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;button&gt;å‘é€ä¸€ä¸ª HTTP GET è¯·æ±‚å¹¶èŽ·å–è¿”å›žç»“æžœ&lt;/button&gt;&lt;/body&gt;&lt;/html&gt; å¯åŠ¨./tomcat-test/bin/startup.sh ï¼Œç«¯å£åœ¨8080 åŽç«¯å¯åŠ¨åœ¨8011ç«¯å£ï¼Œè®¿é—®è·¯å¾„localhost:8011/api/hello 12345678910@RestController@RequestMapping("/api")public class HelloController &#123; @RequestMapping(value = "/hello", method = RequestMethod.GET) public String test() &#123; return "hello,world"; &#125;&#125; nginx.confé…ç½®1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#user nobody;worker_processes 1;#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application/octet-stream; #log_format main '$remote_addr - $remote_user [$time_local] "$request" ' # '$status $body_bytes_sent "$http_referer" ' # '"$http_user_agent" "$http_x_forwarded_for"'; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server &#123; listen 6080; server_name localhost; #åŽç«¯æŽ¥å£è½¬å‘ï¼Œè§£å†³è·¨åŸŸ location /apis &#123; rewrite ^/apis/(.*)$ /$1 break; proxy_pass http://127.0.0.1:8011; &#125; location /html &#123; rewrite ^/html/(.*)$ /$1 break; proxy_pass http://127.0.0.1:8080; &#125; &#125; include servers/*;&#125; è®¿é—®http://localhost:6080/html/test/hello.html NginxåŒ¹é…è§„åˆ™ https://moonbingbing.gitbooks.io/openresty-best-practices/ngx/nginx_local_pcre.html å¸¸ç”¨location ^~ /uriå‰ç¼€åŒ¹é… location /é€šç”¨åŒ¹é…ï¼Œä»»ä½•æœªåŒ¹é…åˆ°å…¶å®ƒlocationçš„è¯·æ±‚éƒ½ä¼šåŒ¹é…åˆ°ï¼Œç›¸å½“äºŽswitchä¸­çš„default è¯­æ³•è§„åˆ™ location [=|~|~*|^~] /uri/ { â€¦ } æ¨¡å¼ å«ä¹‰ location = /uri = è¡¨ç¤ºç²¾ç¡®åŒ¹é…ï¼Œåªæœ‰å®Œå…¨åŒ¹é…ä¸Šæ‰èƒ½ç”Ÿæ•ˆ location ^~ /uri ^~ å¼€å¤´å¯¹URLè·¯å¾„è¿›è¡Œå‰ç¼€åŒ¹é…ï¼Œå¹¶ä¸”åœ¨æ­£åˆ™ä¹‹å‰ã€‚ location ~ pattern å¼€å¤´è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é… location ~* pattern å¼€å¤´è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é… location /uri ä¸å¸¦ä»»ä½•ä¿®é¥°ç¬¦ï¼Œä¹Ÿè¡¨ç¤ºå‰ç¼€åŒ¹é…ï¼Œä½†æ˜¯åœ¨æ­£åˆ™åŒ¹é…ä¹‹åŽ location / é€šç”¨åŒ¹é…ï¼Œä»»ä½•æœªåŒ¹é…åˆ°å…¶å®ƒlocationçš„è¯·æ±‚éƒ½ä¼šåŒ¹é…åˆ°ï¼Œç›¸å½“äºŽswitchä¸­çš„default å‰ç¼€åŒ¹é…æ—¶ï¼ŒNginx ä¸å¯¹ url åšç¼–ç ï¼Œå› æ­¤è¯·æ±‚ä¸º /static/20%/aaï¼Œå¯ä»¥è¢«è§„åˆ™ ^~ /static/ /aa åŒ¹é…åˆ°ï¼ˆæ³¨æ„æ˜¯ç©ºæ ¼ï¼‰ å¤šä¸ª location é…ç½®çš„æƒ…å†µä¸‹åŒ¹é…é¡ºåºä¸ºï¼ˆå‚è€ƒèµ„æ–™è€Œæ¥ï¼Œè¿˜æœªå®žé™…éªŒè¯ï¼Œè¯•è¯•å°±çŸ¥é“äº†ï¼Œä¸å¿…æ‹˜æ³¥ï¼Œä»…ä¾›å‚è€ƒï¼‰: é¦–å…ˆç²¾ç¡®åŒ¹é… = å…¶æ¬¡å‰ç¼€åŒ¹é… ^~ å…¶æ¬¡æ˜¯æŒ‰æ–‡ä»¶ä¸­é¡ºåºçš„æ­£åˆ™åŒ¹é… ç„¶åŽåŒ¹é…ä¸å¸¦ä»»ä½•ä¿®é¥°çš„å‰ç¼€åŒ¹é…ã€‚ æœ€åŽæ˜¯äº¤ç»™ / é€šç”¨åŒ¹é… å½“æœ‰åŒ¹é…æˆåŠŸæ—¶å€™ï¼Œåœæ­¢åŒ¹é…ï¼ŒæŒ‰å½“å‰åŒ¹é…è§„åˆ™å¤„ç†è¯·æ±‚ æ³¨æ„ï¼šå‰ç¼€åŒ¹é…ï¼Œå¦‚æžœæœ‰åŒ…å«å…³ç³»æ—¶ï¼ŒæŒ‰æœ€å¤§åŒ¹é…åŽŸåˆ™è¿›è¡ŒåŒ¹é…ã€‚æ¯”å¦‚åœ¨å‰ç¼€åŒ¹é…ï¼šlocation /dir01 ä¸Ž location /dir01/dir02ï¼Œå¦‚æœ‰è¯·æ±‚ http://localhost/dir01/dir02/file å°†æœ€ç»ˆåŒ¹é…åˆ° location /dir01/dir02 ä¾‹å­ï¼Œæœ‰å¦‚ä¸‹åŒ¹é…è§„åˆ™ï¼š 123456789101112131415161718192021222324location = / &#123; echo "è§„åˆ™A";&#125;location = /login &#123; echo "è§„åˆ™B";&#125;location ^~ /static/ &#123; echo "è§„åˆ™C";&#125;location ^~ /static/files &#123; echo "è§„åˆ™X";&#125;location ~ \.(gif|jpg|png|js|css)$ &#123; echo "è§„åˆ™D";&#125;location ~* \.png$ &#123; echo "è§„åˆ™E";&#125;location /img &#123; echo "è§„åˆ™Y";&#125;location / &#123; echo "è§„åˆ™F";&#125; é‚£ä¹ˆäº§ç”Ÿçš„æ•ˆæžœå¦‚ä¸‹ï¼š è®¿é—®æ ¹ç›®å½• /ï¼Œæ¯”å¦‚ http://localhost/ å°†åŒ¹é… è§„åˆ™A è®¿é—® http://localhost/login å°†åŒ¹é… è§„åˆ™Bï¼Œhttp://localhost/register åˆ™åŒ¹é… è§„åˆ™F è®¿é—® http://localhost/static/a.html å°†åŒ¹é… è§„åˆ™C è®¿é—® http://localhost/static/files/a.exe å°†åŒ¹é… è§„åˆ™Xï¼Œè™½ç„¶ è§„åˆ™C ä¹Ÿèƒ½åŒ¹é…åˆ°ï¼Œä½†å› ä¸ºæœ€å¤§åŒ¹é…åŽŸåˆ™ï¼Œæœ€ç»ˆé€‰ä¸­äº† è§„åˆ™Xã€‚ä½ å¯ä»¥æµ‹è¯•ä¸‹ï¼ŒåŽ»æŽ‰è§„åˆ™ X ï¼Œåˆ™å½“å‰ URL ä¼šåŒ¹é…ä¸Š è§„åˆ™Cã€‚ è®¿é—® http://localhost/a.gif, http://localhost/b.jpg å°†åŒ¹é… è§„åˆ™D å’Œ è§„åˆ™ E ï¼Œä½†æ˜¯ è§„åˆ™ D é¡ºåºä¼˜å…ˆï¼Œè§„åˆ™ E ä¸èµ·ä½œç”¨ï¼Œè€Œ http://localhost/static/c.png åˆ™ä¼˜å…ˆåŒ¹é…åˆ° è§„åˆ™ C è®¿é—® http://localhost/a.PNG åˆ™åŒ¹é… è§„åˆ™ E ï¼Œè€Œä¸ä¼šåŒ¹é… è§„åˆ™ D ï¼Œå› ä¸º è§„åˆ™ E ä¸åŒºåˆ†å¤§å°å†™ã€‚ è®¿é—® http://localhost/img/a.gif ä¼šåŒ¹é…ä¸Š è§„åˆ™D,è™½ç„¶ è§„åˆ™Y ä¹Ÿå¯ä»¥åŒ¹é…ä¸Šï¼Œä½†æ˜¯å› ä¸ºæ­£åˆ™åŒ¹é…ä¼˜å…ˆï¼Œè€Œå¿½ç•¥äº† è§„åˆ™Yã€‚ è®¿é—® http://localhost/img/a.tiff ä¼šåŒ¹é…ä¸Š è§„åˆ™Yã€‚ è®¿é—® http://localhost/category/id/1111 åˆ™æœ€ç»ˆåŒ¹é…åˆ°è§„åˆ™ F ï¼Œå› ä¸ºä»¥ä¸Šè§„åˆ™éƒ½ä¸åŒ¹é…ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥æ˜¯ Nginx è½¬å‘è¯·æ±‚ç»™åŽç«¯åº”ç”¨æœåŠ¡å™¨ï¼Œæ¯”å¦‚ FastCGIï¼ˆphpï¼‰ï¼Œtomcatï¼ˆjspï¼‰ï¼ŒNginx ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨å­˜åœ¨ã€‚ æ‰€ä»¥å®žé™…ä½¿ç”¨ä¸­ï¼Œç¬”è€…è§‰å¾—è‡³å°‘æœ‰ä¸‰ä¸ªåŒ¹é…è§„åˆ™å®šä¹‰ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819202122# ç›´æŽ¥åŒ¹é…ç½‘ç«™æ ¹ï¼Œé€šè¿‡åŸŸåè®¿é—®ç½‘ç«™é¦–é¡µæ¯”è¾ƒé¢‘ç¹ï¼Œä½¿ç”¨è¿™ä¸ªä¼šåŠ é€Ÿå¤„ç†ï¼Œå®˜ç½‘å¦‚æ˜¯è¯´ã€‚# è¿™é‡Œæ˜¯ç›´æŽ¥è½¬å‘ç»™åŽç«¯åº”ç”¨æœåŠ¡å™¨äº†ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªé™æ€é¦–é¡µ# ç¬¬ä¸€ä¸ªå¿…é€‰è§„åˆ™location = / &#123; proxy_pass http://tomcat:8080/index&#125;# ç¬¬äºŒä¸ªå¿…é€‰è§„åˆ™æ˜¯å¤„ç†é™æ€æ–‡ä»¶è¯·æ±‚ï¼Œè¿™æ˜¯ nginx ä½œä¸º http æœåŠ¡å™¨çš„å¼ºé¡¹# æœ‰ä¸¤ç§é…ç½®æ¨¡å¼ï¼Œç›®å½•åŒ¹é…æˆ–åŽç¼€åŒ¹é…ï¼Œä»»é€‰å…¶ä¸€æˆ–æ­é…ä½¿ç”¨location ^~ /static/ &#123; root /webroot/static/;&#125;location ~* \.(gif|jpg|jpeg|png|css|js|ico)$ &#123; root /webroot/res/;&#125;# ç¬¬ä¸‰ä¸ªè§„åˆ™å°±æ˜¯é€šç”¨è§„åˆ™ï¼Œç”¨æ¥è½¬å‘åŠ¨æ€è¯·æ±‚åˆ°åŽç«¯åº”ç”¨æœåŠ¡å™¨# éžé™æ€æ–‡ä»¶è¯·æ±‚å°±é»˜è®¤æ˜¯åŠ¨æ€è¯·æ±‚ï¼Œè‡ªå·±æ ¹æ®å®žé™…æŠŠæ¡# æ¯•ç«Ÿç›®å‰çš„ä¸€äº›æ¡†æž¶çš„æµè¡Œï¼Œå¸¦.phpã€.jspåŽç¼€çš„æƒ…å†µå¾ˆå°‘äº†location / &#123; proxy_pass http://tomcat:8080/&#125; rewrite è¯­æ³• last â€“ åŸºæœ¬ä¸Šéƒ½ç”¨è¿™ä¸ª Flag break â€“ ä¸­æ­¢ Rewirteï¼Œä¸å†ç»§ç»­åŒ¹é… redirect â€“ è¿”å›žä¸´æ—¶é‡å®šå‘çš„ HTTP çŠ¶æ€ 302 permanent â€“ è¿”å›žæ°¸ä¹…é‡å®šå‘çš„ HTTP çŠ¶æ€ 301 1ã€ä¸‹é¢æ˜¯å¯ä»¥ç”¨æ¥åˆ¤æ–­çš„è¡¨è¾¾å¼ï¼š 1234-f å’Œ !-f ç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶-d å’Œ !-d ç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›®å½•-e å’Œ !-e ç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶æˆ–ç›®å½•-x å’Œ !-x ç”¨æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ 2ã€ä¸‹é¢æ˜¯å¯ä»¥ç”¨ä½œåˆ¤æ–­çš„å…¨å±€å˜é‡ 1234567ä¾‹ï¼šhttp://localhost:88/test1/test2/test.php?k=v$hostï¼šlocalhost$server_portï¼š88$request_uriï¼š/test1/test2/test.php?k=v$document_uriï¼š/test1/test2/test.php$document_rootï¼šD:\nginx/html$request_filenameï¼šD:\nginx/html/test1/test2/test.php redirect è¯­æ³•123456789server &#123; listen 80; server_name start.igrow.cn; index index.html index.php; root html; if ($http_host !~ "^star\.igrow\.cn$") &#123; rewrite ^(.*) http://star.igrow.cn$1 redirect; &#125;&#125; é˜²ç›—é“¾123456location ~* \.(gif|jpg|swf)$ &#123; valid_referers none blocked start.igrow.cn sta.igrow.cn; if ($invalid_referer) &#123; rewrite ^/ http://$host/logo.png; &#125;&#125; æ ¹æ®æ–‡ä»¶ç±»åž‹è®¾ç½®è¿‡æœŸæ—¶é—´123456location ~* \.(js|css|jpg|jpeg|gif|png|swf)$ &#123; if (-f $request_filename) &#123; expires 1h; break; &#125;&#125; ç¦æ­¢è®¿é—®æŸä¸ªç›®å½•1234location ~* \.(txt|doc)$&#123; root /data/www/wwwroot/linuxtone/test; deny all;&#125; Macè®¿é—®80ç«¯å£1 . å…ˆå¯¹pf.confè¿›è¡Œå¤‡ä»½ï¼š1sudo cp /etc/pf.conf /etc/pf.conf.normal.bak ä¹‹åŽåœ¨è¯¥æ–‡ä»¶ä¸­ä»¥ä¸‹è¡Œï¼š 1sudo vim /etc/pf.conf rdr-anchor &quot;com.apple/*&quot; åŽé¢æ·»åŠ ä¸€è¡Œé…ç½®ï¼Œè½¬å‘åˆ°5555,å¦‚ä¸‹ï¼š 1rdr on lo0 inet proto tcp from any to 127.0.0.1 port 80 -&gt; 127.0.0.1 port 5555 2ã€ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š123sudo pfctl -dsudo pfctl -f /etc/pf.confsudo pfctl -e æ³¨æ„ï¼šå¦‚æžœæœ‰apacheç­‰æœåŠ¡å™¨å ç”¨äº†80ç«¯å£ï¼Œåˆ™éœ€è¦å°†å…¶åœæŽ‰æ–¹èƒ½æˆåŠŸï¼ å¦‚æžœå‡ºçŽ° 123No ALTQ support in kernelALTQ related functions disabledpfctl: pf not enabled å¿½ç•¥å³å¯ã€‚ å¸¸ç”¨å‘½ä»¤##1ã€æŸ¥çœ‹nginxè¿›ç¨‹ 1ps -ef|grep nginx è¯´æ˜Žï¼šnginxçš„è¿›ç¨‹ç”±ä¸»è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹ç»„æˆã€‚ ##2ã€å¯åŠ¨nginx 1234nginxnginx -c ~/Dropbox/commonConfig/nginx/nginx.confnginx -t -c ~/Dropbox/commonConfig/nginx/nginx.conf å¯åŠ¨ç»“æžœæ˜¾ç¤ºnginxçš„ä¸»çº¿ç¨‹å’Œå·¥ä½œçº¿ç¨‹ï¼Œå·¥ä½œçº¿ç¨‹çš„æ•°é‡è·Ÿnginx.confä¸­çš„é…ç½®å‚æ•°worker_processesæœ‰å…³ã€‚ ##3ã€å¹³æ»‘å¯åŠ¨nginx 12345kill -HUP `cat /var/run/nginx.pid`æˆ–è€…nginx -s reloadnginx -s reload -c ~/Dropbox/commonConfig/nginx/nginx.conf å…¶ä¸­è¿›ç¨‹æ–‡ä»¶è·¯å¾„åœ¨é…ç½®æ–‡ä»¶nginx.confä¸­å¯ä»¥æ‰¾åˆ°ã€‚ å¹³æ»‘å¯åŠ¨çš„æ„æ€æ˜¯åœ¨ä¸åœæ­¢nginxçš„æƒ…å†µä¸‹ï¼Œé‡å¯nginxï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨æ–°çš„å·¥ä½œçº¿ç¨‹ï¼Œå®Œç¾Žåœæ­¢æ—§çš„å·¥ä½œçº¿ç¨‹ã€‚ ##4ã€å®Œç¾Žåœæ­¢nginx 1kill -QUIT `cat /var/run/nginx.pid` ##5ã€å¿«é€Ÿåœæ­¢nginx 123kill -TERM `cat /var/run/nginx.pid`æˆ–è€…kill -INT `cat /var/run/nginx.pid` ##6ã€å®Œç¾Žåœæ­¢å·¥ä½œè¿›ç¨‹ï¼ˆä¸»è¦ç”¨äºŽå¹³æ»‘å‡çº§ï¼‰ 1kill -WINCH `cat /var/run/nginx.pid` ##7ã€å¼ºåˆ¶åœæ­¢nginx 1pkill -9 nginx ##8ã€æ£€æŸ¥å¯¹nginx.confæ–‡ä»¶çš„ä¿®æ”¹æ˜¯å¦æ­£ç¡® 123nginx -t -c /etc/nginx/nginx.conf æˆ–è€… nginx -tnginx -t -c ~/Dropbox/commonConfig/nginx/nginx.conf ##9ã€åœæ­¢nginxçš„å‘½ä»¤ 1nginx -s stop ##10ã€æŸ¥çœ‹nginxçš„ç‰ˆæœ¬ä¿¡æ¯ 1nginx -v ##11ã€æŸ¥çœ‹å®Œæ•´çš„nginxçš„é…ç½®ä¿¡æ¯ 1nginx -V]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Homebrew nginxå¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2018%2F06%2F28%2FHomebrew%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[123456789brew updatebrew search nginx //æŸ¥è¯¢è¦å®‰è£…çš„è½¯ä»¶æ˜¯å¦å­˜åœ¨brew info nginxbrew install nginxnginx å®‰è£…å·¥å…·ï¼š homebrewï¼ˆè¿˜æ²¡ç”¨è¿‡çš„å°ä¼™ä¼´å¯ä»¥ç‚¹é“¾æŽ¥è¿›è¡Œäº†è§£æˆ–è€…è‡ªè¡Œç™¾åº¦ï¼‰ æ­¥éª¤ï¼š 1ã€æ‰“å¼€ç»ˆç«¯ï¼Œä¹ æƒ¯æ€§å‘½ä»¤ï¼š 12brew update//ç»“æžœï¼šAlready up-to-date. 2ã€ç»ˆç«¯ç»§ç»­æ‰§è¡Œå‘½ä»¤ï¼š 1brew search nginx //æŸ¥è¯¢è¦å®‰è£…çš„è½¯ä»¶æ˜¯å¦å­˜åœ¨ 3ã€è¿™é‡Œæˆ‘ä»¬å¤šæ‰§è¡Œä¸€æ­¥â€œåºŸâ€å‘½ä»¤ï¼Œä¸è¿‡æœ‰åˆ©äºŽæˆ‘ä»¬åŽé¢çš„é…ç½®ï¼š 1brew info nginx è¿è¡Œç»“æžœï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œnginxåœ¨æœ¬åœ°è¿˜æœªå®‰è£…ï¼ˆNot installedï¼‰ï¼Œnginxçš„æ¥æºï¼ˆFromï¼‰ï¼ŒDocrooté»˜è®¤ä¸º/usr/local/var/wwwï¼Œåœ¨/usr/local/etc/nginx/nginx.confé…ç½®æ–‡ä»¶ä¸­é»˜è®¤ç«¯å£è¢«é…ç½®ä¸º8080ä»Žè€Œä½¿nginxè¿è¡Œæ—¶ä¸éœ€è¦åŠ sudoï¼Œnginxå°†åœ¨/usr/local/etc/nginx/servers/ç›®å½•ä¸­åŠ è½½æ‰€æœ‰æ–‡ä»¶ï¼Œä»¥åŠæˆ‘ä»¬å¯ä»¥é€šè¿‡æœ€ç®€å•çš„å‘½ä»¤ â€˜nginxâ€™ æ¥å¯åŠ¨nginxã€‚ 4ã€æ­£å¼å¼€å§‹å®‰è£…ï¼š 1brew install nginx 5ã€æŸ¥çœ‹nginxå®‰è£…ç›®å½•ï¼ˆæ˜¯å¦å¦‚infoæ‰€è¯´ï¼‰ï¼š 1open /usr/local/etc/nginx/ æˆåŠŸæ‰“å¼€nginxç›®å½•ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°å¦‚infoæ‰€è¯´serversç›®å½•ä»¥åŠnginx.confçš„é…ç½®æ–‡ä»¶ï¼ˆåŽé¢ä¼šç”¨åˆ°è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼‰ã€‚ä½†æˆ‘ä»¬å¹¶æ²¡æœ‰æ‰¾åˆ°nginxè¢«å®‰è£…åˆ°äº†å“ªé‡Œã€‚ ç»ˆç«¯ç»§ç»­æ‰§è¡Œï¼š 1open /usr/local/Cellar/nginx //å…¶å®žè¿™ä¸ªæ‰æ˜¯nginxè¢«å®‰è£…åˆ°çš„ç›®å½• ä¼šçœ‹åˆ°ä¸€ä¸ªä»¥å½“å‰å®‰è£…çš„nginxçš„ç‰ˆæœ¬å·ä¸ºåç§°çš„æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å®‰è£…çš„nginxæ ¹ç›®å½•å•¦ã€‚è¿›å…¥1.12.2_1/bin ç›®å½•ï¼Œä¼šçœ‹åˆ°nginxçš„å¯æ‰§è¡Œå¯åŠ¨æ–‡ä»¶ã€‚ åŒæ ·çš„ï¼Œæˆ‘ä»¬åœ¨1.12.2_1/ç›®å½•ä¸‹è¿˜å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåå­—ä¸ºhtmlçš„å¿«æ·æ–¹å¼æ–‡ä»¶å¤¹ï¼ˆæš‚ä¸”å°±è¿™ä¹ˆå«å§ï¼‰ï¼Œè¿›å…¥è¯¥ç›®å½•æˆ‘ä»¬ä¼šå‘çŽ°å…¶å®žå®ƒæŒ‡å‘çš„å°±æ˜¯/usr/local/var/wwwç›®å½•ï¼Œè¿™ä¸ªåœ¨ä¸Šé¢æˆ‘ä»¬æŸ¥çœ‹çš„infoä¿¡æ¯ä¸­æœ‰æåˆ°ï¼ˆDcrootï¼‰ 6ã€å¯åŠ¨nginxï¼Œç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š 1nginx æ²¡æœ‰æŠ¥é”™å³ä¸ºå¯åŠ¨æˆåŠŸã€‚ 7ã€è®¿é—®éªŒè¯ï¼š æ‰“å¼€æµè§ˆå™¨è®¿é—®localhost:8080,è¿™é‡Œè·Ÿç½‘ä¸Šçš„ä¸€äº›æ•™ç¨‹ä¼šæœ‰äº›ä¸ä¸€æ ·ï¼Œæ­£å¸¸æƒ…å†µä¸‹åˆ°è¿™ä¸€æ­¥å°±ä¼šèƒ½çœ‹åˆ°nginxçš„æ¬¢è¿Žç•Œé¢å•¦ï¼Œç„¶è€Œåšä¸»å´é‡åˆ°äº†å‘çˆ¹çš„æƒ…å†µï¼ˆå¦‚æžœä½ èƒ½æ­£å¸¸çœ‹åˆ°nginxæ¬¢è¿Žç•Œé¢ï¼Œå¯ä»¥ç›´æŽ¥è·³è¿‡è¿™ä¸€æ­¥äº†ï¼‰ æƒ³å¿…è¿™ä¸ªé”™è¯¯å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œæˆ‘å°±ä¸å†å¤šåšè§£é‡Šï¼ŒæŽ¥ä¸‹æ¥ç›´æŽ¥è¯´åŽŸå› ï¼ˆè¯¥åŽŸå› ä»…ä¸ºçŒœæµ‹ï¼Œå› ä¸ºæ— ä»ŽéªŒè¯ï¼‰ï¼šå®‰è£…çš„nginxä¼šé»˜è®¤åœ¨htmlï¼ˆä¹Ÿå°±æ˜¯/usr/local/var/wwwï¼‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªæ¬¢è¿Žé¡µé¢æ–‡ä»¶ï¼Œè€Œå‡ºçŽ°ä¸Šé¢è¿™ç§æƒ…å†µå°±æ˜¯æ¬¢è¿Žé¡µé¢æ–‡ä»¶æ²¡æœ‰ç”Ÿæˆï¼ˆè‡³äºŽä¸ºä»€ä¹ˆæ²¡æœ‰ç”Ÿæˆå°±ä¸å¾—è€ŒçŸ¥äº†ï¼Œä¸€åˆ‡éƒ½æ˜¯çŒœæµ‹ï¼‰ã€‚ é‚£åœ¨è§£å†³è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹nginxçš„é…ç½®æ–‡ä»¶å§ï¼ˆnginx.confï¼‰: 1cat /usr/local/etc/nginx/nginx.conf æ˜¾ç¤ºé…ç½®æ–‡ä»¶çš„ä»£ç ä¸ºï¼š ;) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455#user nobody;worker_processes 1;#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application/octet-stream; #log_format main '$remote_addr - $remote_user [$time_local] "$request" ' # '$status $body_bytes_sent "$http_referer" ' # '"$http_user_agent" "$http_x_forwarded_for"'; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server &#123; #ä¾¦å¬8080ç«¯å£ listen 8080; #å®šä¹‰ä½¿ç”¨ localhostè®¿é—® server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location / &#123; #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½® root html; #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§° index index.html index.htm; &#125; ... ... ... (æ³¨é‡Šä»£ç å¤ªå¤šï¼Œå°±ä¸å…¨éƒ¨è´´å‡ºæ¥äº†) include servers/*;&#125; ;) é€šè¿‡é…ç½®æ–‡ä»¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶é»˜è®¤çš„ç½‘ç«™æ ¹ç›®å½•ä¸ºhtmlï¼ˆå³/usr/local/var/wwwï¼‰ï¼Œè€Œé»˜è®¤çš„ç´¢å¼•æ–‡ä»¶ä¸ºindex.html å’Œ index.htmï¼Œè¿™ä¸‹å°±æ‰¾åˆ°åŽŸå› äº†ï¼ŒåŽŸæ¥æˆ‘ä»¬çš„æ ¹ç›®å½•å°‘äº†é¦–é¡µç´¢å¼•æ–‡ä»¶ï¼Œé‚£å°±æ¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªå§ï¼š 123cd /usr/local/var/www/ //è¿›å…¥åˆ°wwwç›®å½•ä¸‹touch index.html //åˆ›å»ºä¸€ä¸ªæ–°çš„index.htmlæ–‡ä»¶vim index.html //ç¼–è¾‘è¯¥æ–‡ä»¶ å°†å¦‚ä¸‹ä»£ç å†™å…¥index.htmlæ–‡ä»¶ä¸­ï¼š ;) 123456789101112&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;title&gt;title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div&gt; &lt;h1&gt;æˆ‘çš„nginxæ¬¢è¿Žé¡µé¢&lt;/h1&gt; &lt;/div&gt;&lt;/body&gt;&lt;/html&gt; ;) æŒ‰escé”®ï¼Œè¾“å…¥:wqæŽ¨å‡ºç¼–è¾‘å¹¶ä¿å­˜ï¼ˆè¿™ä¸ªç›¸ä¿¡å¤§å®¶éƒ½ä¼šï¼Œä½†è¿˜æ˜¯å¼ºè¿«ç—‡çš„å†™ä¸Šäº†ï¼‰ã€‚ å›žåˆ°æµè§ˆå™¨ï¼ˆlocalhost:8080ï¼‰åˆ·æ–°ï¼š OKï¼Œå¤§åŠŸå‘Šæˆå•¦ï¼]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Dubboæºç åˆ†æžä¹‹æœåŠ¡æ¶ˆè´¹è¿‡ç¨‹]]></title>
    <url>%2F2018%2F06%2F28%2FDubbo%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[æ¶ˆè´¹ç«¯å‘é€æ¶ˆæ¯æµç¨‹ æ¶ˆè´¹ç«¯çš„è°ƒç”¨è¿‡ç¨‹ invokerè°ƒç”¨é“¾å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637InvokerInvocationHandler.invoke()MockClusterInvoker.invoke()AbstractClusterInvoker.invoke() å¾—åˆ°invokerList å’Œ loadbalanceFailoverClusterInvoker.doInvoke() ç„¶åŽselecté€‰å‡ºçš„Invokerä¸º: RegistryDirectory.InvokerDelegate(ProtocolFilterWrapper(ListenerInvoker(DubboInvoker)))å¤‡æ³¨ï¼šprivate static class InvokerDelegete&lt;T&gt; extends InvokerWrapperProtocolFilterWrapper è°ƒç”¨buildInvokerChainè°ƒç”¨æž„å»ºä¸€ä¸ªFilteré“¾æ¡ , new Filter()ç„¶åŽæ‰§è¡ŒFilter.invoker(Invoker invoker , Invocation invocation)æ–¹æ³•MonitorFilterå…¶ä»–Filter====å†æ‰§è¡ŒçœŸæ­£çš„DubboInvoker extends AbstractInvokerDubboInvoker&lt;T&gt; extends AbstractInvoker&lt;T&gt;AbstractInvoker.invoke()DubboInvoker.doInvoke() DefaultFuture.get() è¿”å›ž ResultReferenceCountExchangeClient.request() è¿”å›ž DefaultFutureHeaderExchangeClient.request() è¿”å›ž DefaultFutureHeaderExchangeChannel.request() è¿”å›ž DefaultFutureAbstractPeer.send()AbstractClient.send()NettyChannel.send()NioClientSocket.write() æœåŠ¡ç«¯æŽ¥æ”¶æ¶ˆæ¯å¤„ç†è¿‡ç¨‹NettyHandler. messageReceivedæŽ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œé€šè¿‡NettyHandler.messageReceivedä½œä¸ºå…¥å£ã€‚ 123456789Overridepublic void messageReceived(ChannelHandlerContext ctx, MessageEvent e) throws Exception &#123; NettyChannel channel = NettyChannel.getOrAddChannel(ctx.getChannel(), url, handler); try &#123; handler.received(channel, e.getMessage()); &#125; finally &#123; NettyChannel.removeChannelIfDisconnected(ctx.getChannel()); &#125;&#125; åœ¨æœåŠ¡å‘å¸ƒçš„æ—¶å€™ï¼Œç»„è£…äº†ä¸€ç³»åˆ—çš„handler HeaderExchanger.bind 123public ExchangeServer bind(URL url, ExchangeHandler handler) throws RemotingException &#123; return new HeaderExchangeServer(Transporters.bind(url, new DecodeHandler(new HeaderExchangeHandler(handler))));&#125; æŽ¥ç€åˆåœ¨Nettyserverä¸­ï¼Œwrapäº†å¤šä¸ªhandler 12345678public NettyServer(URL url, ChannelHandler handler) throws RemotingException &#123; super(url, ChannelHandlers.wrap(handler, ExecutorUtil.setThreadName(url, SERVER_THREAD_POOL_NAME)));&#125;protected ChannelHandler wrapInternal(ChannelHandler handler, URL url) &#123; return new MultiMessageHandler(new HeartbeatHandler(ExtensionLoader.getExtensionLoader(Dispatcher.class) .getAdaptiveExtension().dispatch(handler, url)));&#125; æ‰€ä»¥æœåŠ¡ç«¯çš„handlerå¤„ç†é“¾ä¸º MultiMessageHandler(HeartbeatHandler(AllChannelHandler(DecodeHandler))) MultiMessageHandler: å¤åˆæ¶ˆæ¯å¤„ç† HeartbeatHandlerï¼šå¿ƒè·³æ¶ˆæ¯å¤„ç†ï¼ŒæŽ¥æ”¶å¿ƒè·³å¹¶å‘é€å¿ƒè·³å“åº” AllChannelHandlerï¼šä¸šåŠ¡çº¿ç¨‹è½¬åŒ–å¤„ç†å™¨ï¼ŒæŠŠæŽ¥æ”¶åˆ°çš„æ¶ˆæ¯å°è£…æˆChannelEventRunnableå¯æ‰§è¡Œä»»åŠ¡ç»™çº¿ç¨‹æ± å¤„ç† DecodeHandler:ä¸šåŠ¡è§£ç å¤„ç†å™¨ è°ƒç”¨é“¾å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637MultiMessageHandler.received()HeartbeatHandler.received()AllChannelHandler.received æ”¾åˆ°çº¿ç¨‹æ± executor.execute(ChannelEventRunnable) run() RECEIVEDDecodeHandler.received()HeaderExchangeHandler.received()DubboProtocol.reply()ProtocolFilterWrapperé‡Œé¢buildInvokerChainï¼ˆï¼‰ä¸­last = new Invoker&lt;T&gt;()çš„invoke()æ–¹æ³•å¼€å§‹new Invoker().invoker(Invocation invocation) é‡Œé¢å®žçŽ°æ˜¯ filter.invoke(invoker , invocation)====EchoFilter.invoke()ClassLoaderFilter.invoke()GenericFilter.invoke()ContextFilter.invoke()TraceFilter.invoke()TimeoutFilter.invoke()MonitorFilter.invoke()å†æ‰§è¡ŒçœŸæ­£çš„AbstractProxyInvokerAbstractProxyInvoker.invoke()AbstractProxyInvokerçš„doInvokeæ–¹æ³•JavassistProxyFactoryä¸­getInvokerï¼ˆï¼‰æ–¹æ³• return new AbstractProxyInvoker&lt;T&gt;(proxy, type, url) &#123; @Override protected Object doInvoke(T proxy, String methodName, Class&lt;?&gt;[] parameterTypes, Object[] arguments) throws Throwable &#123; return wrapper.invokeMethod(proxy, methodName, parameterTypes, arguments); &#125; &#125;; æœåŠ¡å‘å¸ƒæ—¶ RegistryProtol.exportï¼ˆInvoker invokerï¼‰æ–¹æ³•ä¸­ 123final Invoker&lt;?&gt; invokerDelegete = new InvokerDelegete&lt;T&gt;(originInvoker, getProviderUrl(originInvoker));Filter(Listener(InvokerDelegete(AbstractProxyInvoker (Wrapper.invokeMethod))) HeaderExchangeHandler.receivedäº¤äº’å±‚è¯·æ±‚å“åº”å¤„ç†ï¼Œæœ‰ä¸‰ç§å¤„ç†æ–¹å¼ handlerRequestï¼ŒåŒå‘è¯·æ±‚ 2.handler.received å•å‘è¯·æ±‚ 3.handleResponse å“åº”æ¶ˆæ¯ 123456789101112131415161718192021222324252627282930313233343536public void received(Channel channel, Object message) throws RemotingException &#123; channel.setAttribute(KEY_READ_TIMESTAMP, System.currentTimeMillis()); ExchangeChannel exchangeChannel = HeaderExchangeChannel.getOrAddChannel(channel); try &#123; if (message instanceof Request) &#123; // handle request. Request request = (Request) message; if (request.isEvent()) &#123; handlerEvent(channel, request); &#125; else &#123; if (request.isTwoWay()) &#123; Response response = handleRequest(exchangeChannel, request); channel.send(response); &#125; else &#123; handler.received(exchangeChannel, request.getData()); &#125; &#125; &#125; else if (message instanceof Response) &#123; handleResponse(channel, (Response) message); &#125; else if (message instanceof String) &#123; if (isClientSide(channel)) &#123; Exception e = new Exception("Dubbo client can not supported string message: " + message + " in channel: " + channel + ", url: " + channel.getUrl()); logger.error(e.getMessage(), e); &#125; else &#123; String echo = handler.telnet(channel, (String) message); if (echo != null &amp;&amp; echo.length() &gt; 0) &#123; channel.send(echo); &#125; &#125; &#125; else &#123; handler.received(exchangeChannel, message); &#125; &#125; finally &#123; HeaderExchangeChannel.removeChannelIfDisconnected(channel); &#125;&#125; handleRequestå¤„ç†è¯·æ±‚å¹¶è¿”å›žresponse 1234567891011121314151617181920212223242526Response handleRequest(ExchangeChannel channel, Request req) throws RemotingException &#123; Response res = new Response(req.getId(), req.getVersion()); if (req.isBroken()) &#123; Object data = req.getData(); String msg; if (data == null) msg = null; else if (data instanceof Throwable) msg = StringUtils.toString((Throwable) data); else msg = data.toString(); res.setErrorMessage("Fail to decode request due to: " + msg); res.setStatus(Response.BAD_REQUEST); return res; &#125; // find handler by message class. Object msg = req.getData(); try &#123; // handle data. Object result = handler.reply(channel, msg); res.setStatus(Response.OK); res.setResult(result); &#125; catch (Throwable e) &#123; res.setStatus(Response.SERVICE_ERROR); res.setErrorMessage(StringUtils.toString(e)); &#125; return res;&#125; ExchangeHandlerAdaptive.replay(DubboProtocol)è°ƒç”¨DubboProtocolä¸­å®šä¹‰çš„ExchangeHandlerAdapter. replyæ–¹æ³•å¤„ç†æ¶ˆæ¯ 12345private ExchangeHandler requestHandler = new ExchangeHandlerAdapter() &#123; public Object reply(ExchangeChannel channel, Object message) throws RemotingException &#123; invoker.invoke(inv);&#125; é‚£æŽ¥ä¸‹æ¥invoker.invokeä¼šè°ƒç”¨å“ªä¸ªç±»ä¸­çš„æ–¹æ³•å‘¢ï¼Ÿè¿˜è®°å¾—åœ¨RegistryDirectoryä¸­å‘å¸ƒæœ¬åœ°æ–¹æ³•çš„æ—¶å€™ï¼Œå¯¹invokeråšçš„åŒ…è£…å—ï¼Ÿé€šè¿‡InvokerDelegeteå¯¹åŽŸæœ¬çš„invokeråšäº†ä¸€å±‚åŒ…è£…ï¼Œè€ŒåŽŸæœ¬çš„invokeræ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯ä¸€ä¸ªJavassistProxyFactoryç”Ÿæˆçš„åŠ¨æ€ä»£ç†å§ã€‚æ‰€ä»¥æ­¤å¤„çš„invokeråº”è¯¥æ˜¯ Filter(Listener(InvokerDelegete(AbstractProxyInvoker (Wrapper.invokeMethod))) RegistryDirectoryç”Ÿæˆinvokerçš„ä»£ç å¦‚ä¸‹ 123456789101112131415private &lt;T&gt; ExporterChangeableWrapper&lt;T&gt; doLocalExport(final Invoker&lt;T&gt; originInvoker)&#123; String key = getCacheKey(originInvoker); ExporterChangeableWrapper&lt;T&gt; exporter = (ExporterChangeableWrapper&lt;T&gt;) bounds.get(key); if (exporter == null) &#123; synchronized (bounds) &#123; exporter = (ExporterChangeableWrapper&lt;T&gt;) bounds.get(key); if (exporter == null) &#123; final Invoker&lt;?&gt; invokerDelegete = new InvokerDelegete&lt;T&gt;(originInvoker, getProviderUrl(originInvoker)); exporter = new ExporterChangeableWrapper&lt;T&gt;((Exporter&lt;T&gt;)protocol.export(invokerDelegete), originInvoker); bounds.put(key, exporter); &#125; &#125; &#125; return (ExporterChangeableWrapper&lt;T&gt;) exporter;&#125; Directoryé›†ç¾¤ç›®å½•æœåŠ¡Directoryï¼Œ ä»£è¡¨å¤šä¸ªInvoker, å¯ä»¥çœ‹æˆList,å®ƒçš„å€¼å¯èƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„æ¯”å¦‚æ³¨å†Œä¸­å¿ƒæŽ¨é€å˜æ›´ã€‚é›†ç¾¤é€‰æ‹©è°ƒç”¨æœåŠ¡æ—¶é€šè¿‡ç›®å½•æœåŠ¡æ‰¾åˆ°æ‰€æœ‰æœåŠ¡ StaticDirectory: é™æ€ç›®å½•æœåŠ¡ï¼Œ å®ƒçš„æ‰€æœ‰Invokeré€šè¿‡æž„é€ å‡½æ•°ä¼ å…¥ï¼Œ æœåŠ¡æ¶ˆè´¹æ–¹å¼•ç”¨æœåŠ¡çš„æ—¶å€™ï¼Œ æœåŠ¡å¯¹å¤šæ³¨å†Œä¸­å¿ƒçš„å¼•ç”¨ï¼Œå°†Invokersé›†åˆç›´æŽ¥ä¼ å…¥ StaticDirectoryæž„é€ å™¨ï¼Œå†ç”±Clusterä¼ªè£…æˆä¸€ä¸ªInvokerï¼›StaticDirectoryçš„listæ–¹æ³•ç›´æŽ¥è¿”å›žæ‰€æœ‰invokeré›†åˆï¼› RegistryDirectory: æ³¨å†Œç›®å½•æœåŠ¡ï¼Œ å®ƒçš„Invokeré›†åˆæ˜¯ä»Žæ³¨å†Œä¸­å¿ƒèŽ·å–çš„ï¼Œ å®ƒå®žçŽ°äº†NotifyListeneræŽ¥å£å®žçŽ°äº†å›žè°ƒæŽ¥å£notify(List) Directoryç›®å½•æœåŠ¡çš„æ›´æ–°è¿‡ç¨‹RegistryProtocol.doReferæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹ç«¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº†RegistryDirectoryè¿™ä¸ªç±»ã€‚ç„¶åŽæ‰§è¡Œcluster.join(directory)æ–¹æ³•ã€‚ cluster.joinå…¶å®žå°±æ˜¯å°†Directoryä¸­çš„å¤šä¸ªInvokerä¼ªè£…æˆä¸€ä¸ªInvoker, å¯¹ä¸Šå±‚é€æ˜Žï¼ŒåŒ…å«é›†ç¾¤çš„å®¹é”™æœºåˆ¶ 1234567891011121314151617181920212223242526private &lt;T&gt; Invoker&lt;T&gt; doRefer(Cluster cluster, Registry registry, Class&lt;T&gt; type, URL url) &#123; RegistryDirectory&lt;T&gt; directory = new RegistryDirectory&lt;T&gt;(type, url);//å¯¹å¤šä¸ªinvokerè¿›è¡Œç»„è£… directory.setRegistry(registry); //ZookeeperRegistry directory.setProtocol(protocol); //protocol=Protocol$Adaptive //url=consumer://192.168.111.... URL subscribeUrl = new URL(Constants.CONSUMER_PROTOCOL, NetUtils.getLocalHost(), 0, type.getName(), directory.getUrl().getParameters()); //ä¼šæŠŠconsumer://192... æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ if (! Constants.ANY_VALUE.equals(url.getServiceInterface()) &amp;&amp; url.getParameter(Constants.REGISTER_KEY, true)) &#123; //zkClient.create() registry.register(subscribeUrl.addParameters(Constants.CATEGORY_KEY, Constants.CONSUMERS_CATEGORY, Constants.CHECK_KEY, String.valueOf(false))); &#125; directory.subscribe(subscribeUrl.addParameter(Constants.CATEGORY_KEY, Constants.PROVIDERS_CATEGORY + "," + Constants.CONFIGURATORS_CATEGORY + "," + Constants.ROUTERS_CATEGORY)); //Cluster$Adaptive return cluster.join(directory);&#125; directory.subscribeè®¢é˜…èŠ‚ç‚¹çš„å˜åŒ–ï¼Œ å½“zookeeperä¸ŠæŒ‡å®šèŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ä»¥åŽï¼Œä¼šé€šçŸ¥åˆ°RegistryDirectoryçš„notifyæ–¹æ³• 2.å°†urlè½¬åŒ–ä¸ºinvokerå¯¹è±¡ è°ƒç”¨è¿‡ç¨‹ä¸­invokersçš„ä½¿ç”¨å†è°ƒç”¨è¿‡ç¨‹ä¸­ï¼ŒAbstractClusterInvoker.invokeæ–¹æ³•ä¸­ï¼Œ 123456789101112131415161718public Result invoke(final Invocation invocation) throws RpcException &#123; checkWhetherDestroyed(); LoadBalance loadbalance; List&lt;Invoker&lt;T&gt;&gt; invokers = list(invocation); if (invokers != null &amp;&amp; invokers.size() &gt; 0) &#123; loadbalance = ExtensionLoader.getExtensionLoader(LoadBalance.class).getExtension(invokers.get(0).getUrl().getMethodParameter(invocation.getMethodName(),Constants.LOADBALANCE_KEY, Constants.DEFAULT_LOADBALANCE)); &#125; else &#123; loadbalance = ExtensionLoader.getExtensionLoader(LoadBalance.class).getExtension(Constants.DEFAULT_LOADBALANCE); &#125; RpcUtils.attachInvocationIdIfAsync(getUrl(), invocation); return doInvoke(invocation, invokers, loadbalance);&#125; listæ–¹æ³•ä»Ždirectoryä¸­èŽ·å¾—invokers 1234protected List&lt;Invoker&lt;T&gt;&gt; list(Invocation invocation) throws RpcException &#123; List&lt;Invoker&lt;T&gt;&gt; invokers = directory.list(invocation); return invokers;&#125; è´Ÿè½½å‡è¡¡LoadBalanceLoadBalanceè´Ÿè½½å‡è¡¡ï¼Œ è´Ÿè´£ä»Žå¤šä¸ª Invokersä¸­é€‰å‡ºå…·ä½“çš„ä¸€ä¸ªInvokerç”¨äºŽæœ¬æ¬¡è°ƒç”¨ï¼Œè°ƒç”¨è¿‡ç¨‹ä¸­åŒ…å«äº†è´Ÿè½½å‡è¡¡çš„ç®—æ³•ã€‚ è´Ÿè½½å‡è¡¡ä»£ç è®¿é—®å…¥å£åœ¨AbstractClusterInvoker.invokeä¸­ä»£ç å¦‚ä¸‹ï¼Œé€šè¿‡åç§°èŽ·å¾—æŒ‡å®šçš„æ‰©å±•ç‚¹ã€‚RandomLoadBalance AbstractClusterInvoker.doselectè°ƒç”¨LoadBalance.selectæ–¹æ³•ï¼Œè®²invokersæŒ‰ç…§æŒ‡å®šç®—æ³•è¿›è¡Œè´Ÿè½½ 1234567891011121314151617181920212223242526272829303132333435private Invoker&lt;T&gt; doselect(LoadBalance loadbalance, Invocation invocation, List&lt;Invoker&lt;T&gt;&gt; invokers, List&lt;Invoker&lt;T&gt;&gt; selected) throws RpcException &#123; if (invokers == null || invokers.size() == 0) return null; if (invokers.size() == 1) return invokers.get(0); // å¦‚æžœåªæœ‰ä¸¤ä¸ªinvokerï¼Œé€€åŒ–æˆè½®å¾ª if (invokers.size() == 2 &amp;&amp; selected != null &amp;&amp; selected.size() &gt; 0) &#123; return selected.get(0) == invokers.get(0) ? invokers.get(1) : invokers.get(0); &#125; Invoker&lt;T&gt; invoker = loadbalance.select(invokers, getUrl(), invocation); //å¦‚æžœ selectedä¸­åŒ…å«ï¼ˆä¼˜å…ˆåˆ¤æ–­ï¼‰ æˆ–è€… ä¸å¯ç”¨&amp;&amp;availablecheck=true åˆ™é‡è¯•. if( (selected != null &amp;&amp; selected.contains(invoker)) ||(!invoker.isAvailable() &amp;&amp; getUrl()!=null &amp;&amp; availablecheck))&#123; try&#123; Invoker&lt;T&gt; rinvoker = reselect(loadbalance, invocation, invokers, selected, availablecheck); if(rinvoker != null)&#123; invoker = rinvoker; &#125;else&#123; //çœ‹ä¸‹ç¬¬ä¸€æ¬¡é€‰çš„ä½ç½®ï¼Œå¦‚æžœä¸æ˜¯æœ€åŽï¼Œé€‰+1ä½ç½®. int index = invokers.indexOf(invoker); try&#123; //æœ€åŽåœ¨é¿å…ç¢°æ’ž invoker = index &lt;invokers.size()-1?invokers.get(index+1) :invoker; &#125;catch (Exception e) &#123; logger.warn(e.getMessage()+" may because invokers list dynamic change, ignore.",e); &#125; &#125; &#125;catch (Throwable t)&#123; logger.error("clustor relselect fail reason is :"+t.getMessage() +" if can not slove ,you can set cluster.availablecheck=false in url",t); &#125; &#125; return invoker;&#125; é»˜è®¤æƒ…å†µä¸‹ï¼ŒLoadBalanceä½¿ç”¨çš„æ˜¯Randomç®—æ³•ï¼Œä½†æ˜¯è¿™ä¸ªéšæœºå’Œæˆ‘ä»¬ç†è§£ä¸Šçš„éšæœºè¿˜æ˜¯ä¸ä¸€æ ·çš„,å› ä¸ºä»–è¿˜æœ‰ä¸ªæ¦‚å¿µå«weight(æƒé‡) RandomLoadBalanceå‡è®¾æœ‰å››ä¸ªé›†ç¾¤èŠ‚ç‚¹A,B,C,D,å¯¹åº”çš„æƒé‡åˆ†åˆ«æ˜¯1,2,3,4,é‚£ä¹ˆè¯·æ±‚åˆ°AèŠ‚ç‚¹çš„æ¦‚çŽ‡å°±ä¸º1/(1+2+3+4) = 10%.B,C,DèŠ‚ç‚¹ä¾æ¬¡ç±»æŽ¨ä¸º20%,30%,40%. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051protected &lt;T&gt; Invoker&lt;T&gt; doSelect(List&lt;Invoker&lt;T&gt;&gt; invokers, URL url, Invocation invocation) &#123; int length = invokers.size(); // æ€»ä¸ªæ•° int totalWeight = 0; // æ€»æƒé‡ boolean sameWeight = true; // æƒé‡æ˜¯å¦éƒ½ä¸€æ · for (int i = 0; i &lt; length; i++) &#123; int weight = getWeight(invokers.get(i), invocation); totalWeight += weight; // ç´¯è®¡æ€»æƒé‡ if (sameWeight &amp;&amp; i &gt; 0 &amp;&amp; weight != getWeight(invokers.get(i - 1), invocation)) &#123; sameWeight = false; // è®¡ç®—æ‰€æœ‰æƒé‡æ˜¯å¦ä¸€æ · &#125; &#125; if (totalWeight &gt; 0 &amp;&amp; ! sameWeight) &#123; // å¦‚æžœæƒé‡ä¸ç›¸åŒä¸”æƒé‡å¤§äºŽ0åˆ™æŒ‰æ€»æƒé‡æ•°éšæœº int offset = random.nextInt(totalWeight); // å¹¶ç¡®å®šéšæœºå€¼è½åœ¨å“ªä¸ªç‰‡æ–­ä¸Š for (int i = 0; i &lt; length; i++) &#123; offset -= getWeight(invokers.get(i), invocation); if (offset &lt; 0) &#123; return invokers.get(i); &#125; &#125; &#125; // å¦‚æžœæƒé‡ç›¸åŒæˆ–æƒé‡ä¸º0åˆ™å‡ç­‰éšæœº return invokers.get(random.nextInt(length));&#125; new Invoker åŒ…è£…Filterè´£ä»»é“¾æ¨¡å¼123public interface Filter &#123; Result invoke(Invoker&lt;?&gt; invoker, Invocation invocation) throws RpcException;&#125; 12345678public class ClassLoaderFilter implements Filter &#123; public Result invoke(Invoker&lt;?&gt; invoker, Invocation invocation) throws RpcException &#123; doSomething(); return invoker.invoke(invocation); &#125;&#125; 12345678public class OneFilter implements Filter&#123; public Result invoke(Invoker&lt;?&gt; invoker, Invocation invocation) &#123; doOne(); return invoker.invoke(invocation); &#125;&#125; 123456789for(Filter filter : filterList)&#123; Filter next = last; last = new Invoker()&#123; public Result invoke(Invocation invocation) throws RpcException &#123; return filter.invoke(next, invocation); &#125; &#125;&#125; 123456789for (int i = filters.size() - 1; i &gt;= 0; i --) &#123; final Filter filter = filters.get(i); final Invoker&lt;T&gt; next = last; last = new Invoker&lt;T&gt;() &#123; public Result invoke(Invocation invocation) throws RpcException &#123; return filter.invoke(next, invocation); &#125; &#125;;&#125;]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[SpringBootæºç åˆ†æžä¹‹æ¡ä»¶æ³¨è§£çš„åº•å±‚å®žçŽ°]]></title>
    <url>%2F2018%2F06%2F25%2FSpringBoot%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E6%9D%A1%E4%BB%B6%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%2F</url>
    <content type="text"><![CDATA[SpringBootå†…éƒ¨æä¾›äº†ç‰¹æœ‰çš„æ³¨è§£ï¼šæ¡ä»¶æ³¨è§£(Conditional Annotation)ã€‚æ¯”å¦‚@ConditionalOnBeanã€@ConditionalOnClassã€@ConditionalOnExpressionã€@ConditionalOnMissingBeanç­‰ã€‚ æ¡ä»¶æ³¨è§£å­˜åœ¨çš„æ„ä¹‰åœ¨äºŽåŠ¨æ€è¯†åˆ«(ä¹Ÿå¯ä»¥è¯´æ˜¯ä»£ç è‡ªåŠ¨åŒ–æ‰§è¡Œ)ã€‚æ¯”å¦‚@ConditionalOnClassä¼šæ£€æŸ¥ç±»åŠ è½½å™¨ä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„ç±»ï¼Œå¦‚æžœæœ‰çš„è¯è¢«æ³¨è§£ä¿®é¥°çš„ç±»å°±æœ‰èµ„æ ¼è¢«Springå®¹å™¨æ‰€æ³¨å†Œï¼Œå¦åˆ™ä¼šè¢«skipã€‚ æ¯”å¦‚FreemarkerAutoConfigurationè¿™ä¸ªè‡ªåŠ¨åŒ–é…ç½®ç±»çš„å®šä¹‰å¦‚ä¸‹ï¼š 123456@Configuration@ConditionalOnClass(&#123; freemarker.template.Configuration.class, FreeMarkerConfigurationFactory.class &#125;)@AutoConfigureAfter(WebMvcAutoConfiguration.class)@EnableConfigurationProperties(FreeMarkerProperties.class)public class FreeMarkerAutoConfiguration è¿™ä¸ªè‡ªåŠ¨åŒ–é…ç½®ç±»è¢«@ConditionalOnClassæ¡ä»¶æ³¨è§£ä¿®é¥°ï¼Œè¿™ä¸ªæ¡ä»¶æ³¨è§£å­˜åœ¨çš„æ„ä¹‰åœ¨äºŽåˆ¤æ–­ç±»åŠ è½½å™¨ä¸­æ˜¯å¦å­˜åœ¨freemarker.template.Configurationå’ŒFreeMarkerConfigurationFactoryè¿™ä¸¤ä¸ªç±»ï¼Œå¦‚æžœéƒ½å­˜åœ¨çš„è¯ä¼šåœ¨Springå®¹å™¨ä¸­åŠ è½½è¿™ä¸ªFreeMarkerAutoConfigurationé…ç½®ç±»ï¼›å¦åˆ™ä¸ä¼šåŠ è½½ã€‚ æ¡ä»¶æ³¨è§£å†…éƒ¨çš„ä¸€äº›åŸºç¡€åœ¨åˆ†æžæ¡ä»¶æ³¨è§£çš„åº•å±‚å®žçŽ°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™äº›æ¡ä»¶æ³¨è§£çš„å®šä¹‰ã€‚ä»¥@ConditionalOnClassæ³¨è§£ä¸ºä¾‹ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š 12345678@Target(&#123; ElementType.TYPE, ElementType.METHOD &#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Conditional(OnClassCondition.class)public @interface ConditionalOnClass &#123; Class&lt;?&gt;[] value() default &#123;&#125;; // éœ€è¦åŒ¹é…çš„ç±» String[] name() default &#123;&#125;; // éœ€è¦åŒ¹é…çš„ç±»å&#125; å®ƒæœ‰2ä¸ªå±žæ€§ï¼Œåˆ†åˆ«æ˜¯ç±»æ•°ç»„å’Œå­—ç¬¦ä¸²æ•°ç»„(ä½œç”¨ä¸€æ ·ï¼Œç±»åž‹ä¸ä¸€æ ·)ï¼Œè€Œä¸”è¢«@Conditionalæ³¨è§£æ‰€ä¿®é¥°ï¼Œè¿™ä¸ª@Conditionalæ³¨è§£æœ‰ä¸ªåä¸ºvaluesçš„Class&lt;? extends Condition&gt;[]ç±»åž‹çš„å±žæ€§ã€‚ è¿™ä¸ªConditionæ˜¯ä¸ªæŽ¥å£ï¼Œç”¨äºŽåŒ¹é…ç»„ä»¶æ˜¯å¦æœ‰èµ„æ ¼è¢«å®¹å™¨æ³¨å†Œï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 1234public interface Condition &#123; // ConditionContextå†…éƒ¨ä¼šå­˜å‚¨Springå®¹å™¨ã€åº”ç”¨ç¨‹åºçŽ¯å¢ƒä¿¡æ¯ã€èµ„æºåŠ è½½å™¨ã€ç±»åŠ è½½å™¨ boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata);&#125; ä¹Ÿå°±æ˜¯è¯´@Conditionalæ³¨è§£å±žæ€§ä¸­å¯ä»¥æŒæœ‰å¤šä¸ªConditionæŽ¥å£çš„å®žçŽ°ç±»ï¼Œæ‰€æœ‰çš„ConditionæŽ¥å£éœ€è¦å…¨éƒ¨åŒ¹é…æˆåŠŸåŽè¿™ä¸ª@Conditionalä¿®é¥°çš„ç»„ä»¶æ‰æœ‰èµ„æ ¼è¢«æ³¨å†Œã€‚ ConditionæŽ¥å£æœ‰ä¸ªå­æŽ¥å£ConfigurationConditionï¼š 123456789101112public interface ConfigurationCondition extends Condition &#123; ConfigurationPhase getConfigurationPhase(); public static enum ConfigurationPhase &#123; PARSE_CONFIGURATION, REGISTER_BEAN &#125;&#125; è¿™ä¸ªå­æŽ¥å£æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¡ä»¶æŽ¥å£ï¼Œå¤šäº†ä¸€ä¸ªgetConfigurationPhaseæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æ¡ä»¶æ³¨è§£çš„ç”Ÿæ•ˆé˜¶æ®µã€‚åªæœ‰åœ¨ConfigurationPhaseä¸­å®šä¹‰çš„ä¸¤ç§é˜¶æ®µä¸‹æ‰ä¼šç”Ÿæ•ˆã€‚ ConditionæŽ¥å£æœ‰ä¸ªå®žçŽ°æŠ½è±¡ç±»SpringBootConditionï¼ŒSpringBootä¸­æ‰€æœ‰æ¡ä»¶æ³¨è§£å¯¹åº”çš„æ¡ä»¶ç±»éƒ½ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»ã€‚å®ƒå®žçŽ°äº†matchesæ–¹æ³•ï¼š 12345678910111213141516171819202122232425@Overridepublic final boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) &#123; String classOrMethodName = getClassOrMethodName(metadata); // å¾—åˆ°ç±»åæˆ–è€…æ–¹æ³•å(æ¡ä»¶æ³¨è§£å¯ä»¥ä½œç”¨çš„ç±»æˆ–è€…æ–¹æ³•ä¸Š) try &#123; ConditionOutcome outcome = getMatchOutcome(context, metadata); // æŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“å­ç±»å®žçŽ°ã€‚ConditionOutcomeè®°å½•äº†åŒ¹é…ç»“æžœbooleanå’Œlogä¿¡æ¯ logOutcome(classOrMethodName, outcome); // logè®°å½•ä¸€ä¸‹åŒ¹é…ä¿¡æ¯ recordEvaluation(context, classOrMethodName, outcome); // æŠ¥å‘Šè®°å½•ä¸€ä¸‹åŒ¹é…ä¿¡æ¯ return outcome.isMatch(); // è¿”å›žæ˜¯å¦åŒ¹é… &#125; catch (NoClassDefFoundError ex) &#123; throw new IllegalStateException( "Could not evaluate condition on " + classOrMethodName + " due to " + ex.getMessage() + " not " + "found. Make sure your own configuration does not rely on " + "that class. This can also happen if you are " + "@ComponentScanning a springframework package (e.g. if you " + "put a @ComponentScan in the default package by mistake)", ex); &#125; catch (RuntimeException ex) &#123; throw new IllegalStateException( "Error processing condition on " + getName(metadata), ex); &#125;&#125; åŸºäºŽClassçš„æ¡ä»¶æ³¨è§£SpringBootæä¾›äº†ä¸¤ä¸ªåŸºäºŽClassçš„æ¡ä»¶æ³¨è§£ï¼š@ConditionalOnClass(ç±»åŠ è½½å™¨ä¸­å­˜åœ¨æŒ‡æ˜Žçš„ç±»)æˆ–è€…@ConditionalOnMissingClass(ç±»åŠ è½½å™¨ä¸­ä¸å­˜åœ¨æŒ‡æ˜Žçš„ç±»)ã€‚ @ConditionalOnClassæˆ–è€…@ConditionalOnMissingClassæ³¨è§£å¯¹åº”çš„æ¡ä»¶ç±»æ˜¯OnClassConditionï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465@Order(Ordered.HIGHEST_PRECEDENCE) // ä¼˜å…ˆçº§ã€æœ€é«˜çº§åˆ«class OnClassCondition extends SpringBootCondition &#123; @Override public ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) &#123; StringBuffer matchMessage = new StringBuffer(); // è®°å½•åŒ¹é…ä¿¡æ¯ MultiValueMap&lt;String, Object&gt; onClasses = getAttributes(metadata, ConditionalOnClass.class); // å¾—åˆ°@ConditionalOnClassæ³¨è§£çš„å±žæ€§ if (onClasses != null) &#123; // å¦‚æžœå±žæ€§å­˜åœ¨ List&lt;String&gt; missing = getMatchingClasses(onClasses, MatchType.MISSING, context); // å¾—åˆ°åœ¨ç±»åŠ è½½å™¨ä¸­ä¸å­˜åœ¨çš„ç±» if (!missing.isEmpty()) &#123; // å¦‚æžœå­˜åœ¨ç±»åŠ è½½å™¨ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ç±»ï¼Œè¿”å›žä¸€ä¸ªåŒ¹é…å¤±è´¥çš„ConditionalOutcome return ConditionOutcome .noMatch("required @ConditionalOnClass classes not found: " + StringUtils.collectionToCommaDelimitedString(missing)); &#125; // å¦‚æžœç±»åŠ è½½å™¨ä¸­å­˜åœ¨å¯¹åº”çš„ç±»çš„è¯ï¼ŒåŒ¹é…ä¿¡æ¯è¿›è¡Œè®°å½• matchMessage.append("@ConditionalOnClass classes found: " + StringUtils.collectionToCommaDelimitedString( getMatchingClasses(onClasses, MatchType.PRESENT, context))); &#125; // å¯¹@ConditionalOnMissingClassæ³¨è§£åšç›¸åŒçš„é€»è¾‘å¤„ç†(è¯´æ˜Ž@ConditionalOnClasså’Œ@ConditionalOnMissingClasså¯ä»¥ä¸€èµ·ä½¿ç”¨) MultiValueMap&lt;String, Object&gt; onMissingClasses = getAttributes(metadata, ConditionalOnMissingClass.class); if (onMissingClasses != null) &#123; List&lt;String&gt; present = getMatchingClasses(onMissingClasses, MatchType.PRESENT, context); if (!present.isEmpty()) &#123; return ConditionOutcome .noMatch("required @ConditionalOnMissing classes found: " + StringUtils.collectionToCommaDelimitedString(present)); &#125; matchMessage.append(matchMessage.length() == 0 ? "" : " "); matchMessage.append("@ConditionalOnMissing classes not found: " + StringUtils.collectionToCommaDelimitedString(getMatchingClasses( onMissingClasses, MatchType.MISSING, context))); &#125; // è¿”å›žå…¨éƒ¨åŒ¹é…æˆåŠŸçš„ConditionalOutcome return ConditionOutcome.match(matchMessage.toString()); &#125; private enum MatchType &#123; // æžšä¸¾ï¼šåŒ¹é…ç±»åž‹ã€‚ç”¨äºŽæŸ¥è¯¢ç±»ååœ¨å¯¹åº”çš„ç±»åŠ è½½å™¨ä¸­æ˜¯å¦å­˜åœ¨ã€‚ PRESENT &#123; // åŒ¹é…æˆåŠŸ @Override public boolean matches(String className, ConditionContext context) &#123; return ClassUtils.isPresent(className, context.getClassLoader()); &#125; &#125;, MISSING &#123; // åŒ¹é…ä¸æˆåŠŸ @Override public boolean matches(String className, ConditionContext context) &#123; return !ClassUtils.isPresent(className, context.getClassLoader()); &#125; &#125;; public abstract boolean matches(String className, ConditionContext context); &#125;&#125; æ¯”å¦‚FreemarkerAutoConfigurationä¸­çš„@ConditionalOnClassæ³¨è§£ä¸­æœ‰valueå±žæ€§æ˜¯freemarker.template.Configuration.classå’ŒFreeMarkerConfigurationFactory.classã€‚åœ¨OnClassConditionæ‰§è¡Œè¿‡ç¨‹ä¸­å¾—åˆ°çš„æœ€ç»ˆConditionalOutcomeä¸­çš„log messageå¦‚ä¸‹ï¼š 1@ConditionalOnClass classes found: freemarker.template.Configuration,org.springframework.ui.freemarker.FreeMarkerConfigurationFactory åŸºäºŽBeançš„æ¡ä»¶æ³¨è§£@ConditionalOnBean(Springå®¹å™¨ä¸­å­˜åœ¨æŒ‡æ˜Žçš„bean)ã€@ConditionalOnMissingBean(Springå®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡æ˜Žçš„bean)ä»¥åŠConditionalOnSingleCandidate(Springå®¹å™¨ä¸­å­˜åœ¨ä¸”åªå­˜åœ¨ä¸€ä¸ªæŒ‡æ˜Žçš„bean)éƒ½æ˜¯åŸºäºŽBeançš„æ¡ä»¶æ³¨è§£ï¼Œå®ƒä»¬å¯¹åº”çš„æ¡ä»¶ç±»æ˜¯ConditionOnBeanã€‚ @ConditionOnBeanæ³¨è§£å®šä¹‰å¦‚ä¸‹ï¼š 1234567891011@Target(&#123; ElementType.TYPE, ElementType.METHOD &#125;)@Retention(RetentionPolicy.RUNTIME)@Documented@Conditional(OnBeanCondition.class)public @interface ConditionalOnBean &#123; Class&lt;?&gt;[] value() default &#123;&#125;; // åŒ¹é…çš„beanç±»åž‹ String[] type() default &#123;&#125;; // åŒ¹é…çš„beanç±»åž‹çš„ç±»å Class&lt;? extends Annotation&gt;[] annotation() default &#123;&#125;; // åŒ¹é…çš„beanæ³¨è§£ String[] name() default &#123;&#125;; // åŒ¹é…çš„beançš„åå­— SearchStrategy search() default SearchStrategy.ALL; // æœç´¢ç­–ç•¥ã€‚æä¾›CURRENT(åªåœ¨å½“å‰å®¹å™¨ä¸­æ‰¾)ã€PARENTS(åªåœ¨æ‰€æœ‰çš„çˆ¶å®¹å™¨ä¸­æ‰¾ï¼›ä½†æ˜¯ä¸åŒ…æ‹¬å½“å‰å®¹å™¨)å’ŒALL(CURRENTå’ŒPARENTSçš„ç»„åˆ)&#125; OnBeanConditionæ¡ä»¶ç±»çš„åŒ¹é…ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445@Overridepublic ConditionOutcome getMatchOutcome(ConditionContext context, AnnotatedTypeMetadata metadata) &#123; StringBuffer matchMessage = new StringBuffer(); // è®°å½•åŒ¹é…ä¿¡æ¯ if (metadata.isAnnotated(ConditionalOnBean.class.getName())) &#123; BeanSearchSpec spec = new BeanSearchSpec(context, metadata, ConditionalOnBean.class); // æž„é€ ä¸€ä¸ªBeanSearchSpecï¼Œä¼šä»Ž@ConditionalOnBeanæ³¨è§£ä¸­èŽ·å–å±žæ€§ï¼Œç„¶åŽè®¾ç½®åˆ°BeanSearchSpecä¸­ List&lt;String&gt; matching = getMatchingBeans(context, spec); // ä»ŽBeanFactoryä¸­æ ¹æ®ç­–ç•¥æ‰¾å‡ºæ‰€æœ‰åŒ¹é…çš„bean if (matching.isEmpty()) &#123; // å¦‚æžœæ²¡æœ‰åŒ¹é…çš„beanï¼Œè¿”å›žä¸€ä¸ªæ²¡æœ‰åŒ¹é…æˆåŠŸçš„ConditionalOutcome return ConditionOutcome .noMatch("@ConditionalOnBean " + spec + " found no beans"); &#125; // å¦‚æžœæ‰¾åˆ°åŒ¹é…çš„beanï¼ŒåŒ¹é…ä¿¡æ¯è¿›è¡Œè®°å½• matchMessage.append( "@ConditionalOnBean " + spec + " found the following " + matching); &#125; if (metadata.isAnnotated(ConditionalOnSingleCandidate.class.getName())) &#123; // ç›¸åŒçš„é€»è¾‘ï¼Œé’ˆå¯¹@ConditionalOnSingleCandidateæ³¨è§£ BeanSearchSpec spec = new SingleCandidateBeanSearchSpec(context, metadata, ConditionalOnSingleCandidate.class); List&lt;String&gt; matching = getMatchingBeans(context, spec); if (matching.isEmpty()) &#123; return ConditionOutcome.noMatch( "@ConditionalOnSingleCandidate " + spec + " found no beans"); &#125; else if (!hasSingleAutowireCandidate(context.getBeanFactory(), matching)) &#123; // å¤šäº†ä¸€å±‚åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦åªæœ‰ä¸€ä¸ªbean return ConditionOutcome.noMatch("@ConditionalOnSingleCandidate " + spec + " found no primary candidate amongst the" + " following " + matching); &#125; matchMessage.append("@ConditionalOnSingleCandidate " + spec + " found " + "a primary candidate amongst the following " + matching); &#125; if (metadata.isAnnotated(ConditionalOnMissingBean.class.getName())) &#123; // ç›¸åŒçš„é€»è¾‘ï¼Œé’ˆå¯¹@ConditionalOnMissingBeanæ³¨è§£ BeanSearchSpec spec = new BeanSearchSpec(context, metadata, ConditionalOnMissingBean.class); List&lt;String&gt; matching = getMatchingBeans(context, spec); if (!matching.isEmpty()) &#123; return ConditionOutcome.noMatch("@ConditionalOnMissingBean " + spec + " found the following " + matching); &#125; matchMessage.append(matchMessage.length() == 0 ? "" : " "); matchMessage.append("@ConditionalOnMissingBean " + spec + " found no beans"); &#125; return ConditionOutcome.match(matchMessage.toString()); //è¿”å›žåŒ¹é…æˆåŠŸçš„ConditonalOutcome&#125; SpringBootè¿˜æä¾›äº†å…¶ä»–æ¯”å¦‚ConditionalOnJavaã€ConditionalOnNotWebApplicationã€ConditionalOnWebApplicationã€ConditionalOnResourceã€ConditionalOnPropertyã€ConditionalOnExpressionç­‰æ¡ä»¶æ³¨è§£ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹å®ƒä»¬çš„åº•å±‚å¤„ç†é€»è¾‘ã€‚ å„ç§æ¡ä»¶æ³¨è§£çš„æ€»ç»“ æ¡ä»¶æ³¨è§£ å¯¹åº”çš„Conditionå¤„ç†ç±» å¤„ç†é€»è¾‘ @ConditionalOnBean OnBeanCondition Springå®¹å™¨ä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„å®žä¾‹ã€‚å¯ä»¥é€šè¿‡å®žä¾‹çš„ç±»åž‹ã€ç±»åã€æ³¨è§£ã€æ˜µç§°åŽ»å®¹å™¨ä¸­æŸ¥æ‰¾(å¯ä»¥é…ç½®ä»Žå½“å‰å®¹å™¨ä¸­æŸ¥æ‰¾æˆ–è€…çˆ¶å®¹å™¨ä¸­æŸ¥æ‰¾æˆ–è€…ä¸¤è€…ä¸€èµ·æŸ¥æ‰¾)è¿™äº›å±žæ€§éƒ½æ˜¯æ•°ç»„ï¼Œé€šè¿‡â€ä¸Žâ€çš„å…³ç³»è¿›è¡ŒæŸ¥æ‰¾ @ConditionalOnClass OnClassCondition ç±»åŠ è½½å™¨ä¸­æ˜¯å¦å­˜åœ¨å¯¹åº”çš„ç±»ã€‚å¯ä»¥é€šè¿‡ClassæŒ‡å®š(valueå±žæ€§)æˆ–è€…Classçš„å…¨åæŒ‡å®š(nameå±žæ€§)ã€‚å¦‚æžœæ˜¯å¤šä¸ªç±»æˆ–è€…å¤šä¸ªç±»åçš„è¯ï¼Œå…³ç³»æ˜¯â€ä¸Žâ€å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›ç±»æˆ–è€…ç±»åéƒ½å¿…é¡»åŒæ—¶åœ¨ç±»åŠ è½½å™¨ä¸­å­˜åœ¨ @ConditionalOnExpression OnExpressionCondition åˆ¤æ–­SpEL è¡¨è¾¾å¼æ˜¯å¦æˆç«‹ @ConditionalOnJava OnJavaCondition æŒ‡å®šJavaç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚å†…éƒ¨æœ‰2ä¸ªå±žæ€§valueå’Œrangeã€‚valueè¡¨ç¤ºä¸€ä¸ªæžšä¸¾çš„Javaç‰ˆæœ¬ï¼Œrangeè¡¨ç¤ºæ¯”è¿™ä¸ªè€æˆ–è€…æ–°äºŽç­‰äºŽæŒ‡å®šçš„Javaç‰ˆæœ¬(é»˜è®¤æ˜¯æ–°äºŽç­‰äºŽ)ã€‚å†…éƒ¨ä¼šåŸºäºŽæŸäº›jdkç‰ˆæœ¬ç‰¹æœ‰çš„ç±»åŽ»ç±»åŠ è½½å™¨ä¸­æŸ¥è¯¢ï¼Œæ¯”å¦‚å¦‚æžœæ˜¯jdk9ï¼Œç±»åŠ è½½å™¨ä¸­éœ€è¦å­˜åœ¨java.security.cert.URICertStoreParametersï¼›å¦‚æžœæ˜¯jdk8ï¼Œç±»åŠ è½½å™¨ä¸­éœ€è¦å­˜åœ¨java.util.function.Functionï¼›å¦‚æžœæ˜¯jdk7ï¼Œç±»åŠ è½½å™¨ä¸­éœ€è¦å­˜åœ¨java.nio.file.Filesï¼›å¦‚æžœæ˜¯jdk6ï¼Œç±»åŠ è½½å™¨ä¸­éœ€è¦å­˜åœ¨java.util.ServiceLoader @ConditionalOnMissingBean OnBeanCondition Springå®¹å™¨ä¸­æ˜¯å¦ç¼ºå°‘å¯¹åº”çš„å®žä¾‹ã€‚å¯ä»¥é€šè¿‡å®žä¾‹çš„ç±»åž‹ã€ç±»åã€æ³¨è§£ã€æ˜µç§°åŽ»å®¹å™¨ä¸­æŸ¥æ‰¾(å¯ä»¥é…ç½®ä»Žå½“å‰å®¹å™¨ä¸­æŸ¥æ‰¾æˆ–è€…çˆ¶å®¹å™¨ä¸­æŸ¥æ‰¾æˆ–è€…ä¸¤è€…ä¸€èµ·æŸ¥æ‰¾)è¿™äº›å±žæ€§éƒ½æ˜¯æ•°ç»„ï¼Œé€šè¿‡â€ä¸Žâ€çš„å…³ç³»è¿›è¡ŒæŸ¥æ‰¾ã€‚è¿˜å¤šäº†2ä¸ªå±žæ€§ignored(ç±»å)å’ŒignoredType(ç±»å)ï¼ŒåŒ¹é…çš„è¿‡ç¨‹ä¸­ä¼šå¿½ç•¥è¿™äº›bean @ConditionalOnMissingClass OnClassCondition è·ŸConditionalOnClassçš„å¤„ç†é€»è¾‘ä¸€æ ·ï¼Œåªæ˜¯æ¡ä»¶ç›¸åï¼Œåœ¨ç±»åŠ è½½å™¨ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ç±» @ConditionalOnNotWebApplication OnWebApplicationCondition åº”ç”¨ç¨‹åºæ˜¯å¦æ˜¯éžWebç¨‹åºï¼Œæ²¡æœ‰æä¾›å±žæ€§ï¼Œåªæ˜¯ä¸€ä¸ªæ ‡è¯†ã€‚ä¼šä»Žåˆ¤æ–­Webç¨‹åºç‰¹æœ‰çš„ç±»æ˜¯å¦å­˜åœ¨ï¼ŒçŽ¯å¢ƒæ˜¯å¦æ˜¯ServletçŽ¯å¢ƒï¼Œå®¹å™¨æ˜¯å¦æ˜¯Webå®¹å™¨ç­‰ @ConditionalOnProperty OnPropertyCondition åº”ç”¨çŽ¯å¢ƒä¸­çš„å±¬æ€§æ˜¯å¦å­˜åœ¨ã€‚æä¾›prefixã€nameã€havingValueä»¥åŠmatchIfMissingå±žæ€§ã€‚prefixè¡¨ç¤ºå±žæ€§åçš„å‰ç¼€ï¼Œnameæ˜¯å±žæ€§åï¼ŒhavingValueæ˜¯å…·ä½“çš„å±žæ€§å€¼ï¼ŒmatchIfMissingæ˜¯ä¸ªbooleanå€¼ï¼Œå¦‚æžœå±žæ€§ä¸å­˜åœ¨ï¼Œè¿™ä¸ªmatchIfMissingä¸ºtrueçš„è¯ï¼Œä¼šç»§ç»­éªŒè¯ä¸‹åŽ»ï¼Œå¦åˆ™å±žæ€§ä¸å­˜åœ¨çš„è¯ç›´æŽ¥å°±ç›¸å½“äºŽåŒ¹é…ä¸æˆåŠŸ @ConditionalOnResource OnResourceCondition æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„èµ„æºæ–‡ä»¶ã€‚åªæœ‰ä¸€ä¸ªå±žæ€§resourcesï¼Œæ˜¯ä¸ªStringæ•°ç»„ã€‚ä¼šä»Žç±»åŠ è½½å™¨ä¸­åŽ»æŸ¥è¯¢å¯¹åº”çš„èµ„æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨ @ConditionalOnSingleCandidate OnBeanCondition Springå®¹å™¨ä¸­æ˜¯å¦å­˜åœ¨ä¸”åªå­˜åœ¨ä¸€ä¸ªå¯¹åº”çš„å®žä¾‹ã€‚åªæœ‰3ä¸ªå±žæ€§valueã€typeã€searchã€‚è·ŸConditionalOnBeanä¸­çš„è¿™3ç§å±žæ€§å€¼æ„ä¹‰ä¸€æ · @ConditionalOnWebApplication OnWebApplicationCondition åº”ç”¨ç¨‹åºæ˜¯å¦æ˜¯Webç¨‹åºï¼Œæ²¡æœ‰æä¾›å±žæ€§ï¼Œåªæ˜¯ä¸€ä¸ªæ ‡è¯†ã€‚ä¼šä»Žåˆ¤æ–­Webç¨‹åºç‰¹æœ‰çš„ç±»æ˜¯å¦å­˜åœ¨ï¼ŒçŽ¯å¢ƒæ˜¯å¦æ˜¯ServletçŽ¯å¢ƒï¼Œå®¹å™¨æ˜¯å¦æ˜¯Webå®¹å™¨ç­‰ ä¾‹å­ ä¾‹å­æ„ä¹‰ @ConditionalOnBean(javax.sql.DataSource.class) Springå®¹å™¨æˆ–è€…æ‰€æœ‰çˆ¶å®¹å™¨ä¸­éœ€è¦å­˜åœ¨è‡³å°‘ä¸€ä¸ªjavax.sql.DataSourceç±»çš„å®žä¾‹ @ConditionalOnClass ({ Configuration.class, FreeMarkerConfigurationFactory.class }) ç±»åŠ è½½å™¨ä¸­å¿…é¡»å­˜åœ¨Configurationå’ŒFreeMarkerConfigurationFactoryè¿™ä¸¤ä¸ªç±» @ConditionalOnExpression (â€œâ€˜${server.host}â€™==â€™localhostâ€™â€) server.hosté…ç½®é¡¹çš„å€¼éœ€è¦æ˜¯localhost ConditionalOnJava(JavaVersion.EIGHT) Javaç‰ˆæœ¬è‡³å°‘æ˜¯8 @ConditionalOnMissingBean(value = ErrorController.class, search = SearchStrategy.CURRENT) Springå½“å‰å®¹å™¨ä¸­ä¸å­˜åœ¨ErrorControllerç±»åž‹çš„bean @ConditionalOnMissingClass (â€œGenericObjectPoolâ€) ç±»åŠ è½½å™¨ä¸­ä¸èƒ½å­˜åœ¨GenericObjectPoolè¿™ä¸ªç±» @ConditionalOnNotWebApplication å¿…é¡»åœ¨éžWebåº”ç”¨ä¸‹æ‰ä¼šç”Ÿæ•ˆ @ConditionalOnProperty(prefix = â€œspring.aopâ€, name = â€œautoâ€, havingValue = â€œtrueâ€, matchIfMissing = true) åº”ç”¨ç¨‹åºçš„çŽ¯å¢ƒä¸­å¿…é¡»æœ‰spring.aop.autoè¿™é¡¹é…ç½®ï¼Œä¸”å®ƒçš„å€¼æ˜¯trueæˆ–è€…çŽ¯å¢ƒä¸­ä¸å­˜åœ¨spring.aop.autoé…ç½®(matchIfMissingä¸ºtrue) @ConditionalOnResource (resources=â€mybatis.xmlâ€) ç±»åŠ è½½è·¯å¾„ä¸­å¿…é¡»å­˜åœ¨mybatis.xmlæ–‡ä»¶ @ConditionalOnSingleCandidate (PlatformTransactionManager.class) Springå½“å‰æˆ–çˆ¶å®¹å™¨ä¸­å¿…é¡»å­˜åœ¨PlatformTransactionManagerè¿™ä¸ªç±»åž‹çš„å®žä¾‹ï¼Œä¸”åªæœ‰ä¸€ä¸ªå®žä¾‹ @ConditionalOnWebApplication å¿…é¡»åœ¨Webåº”ç”¨ä¸‹æ‰ä¼šç”Ÿæ•ˆ SpringBootæ¡ä»¶æ³¨è§£çš„æ¿€æ´»æœºåˆ¶åˆ†æžå®Œäº†æ¡ä»¶æ³¨è§£çš„æ‰§è¡Œé€»è¾‘ä¹‹åŽï¼ŒæŽ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯SpringBootæ˜¯å¦‚ä½•è®©è¿™äº›æ¡ä»¶æ³¨è§£ç”Ÿæ•ˆçš„ï¼Ÿ SpringBootä½¿ç”¨ConditionEvaluatorè¿™ä¸ªå†…éƒ¨ç±»å®Œæˆæ¡ä»¶æ³¨è§£çš„è§£æžå’Œåˆ¤æ–­ã€‚ åœ¨Springå®¹å™¨çš„refreshè¿‡ç¨‹ä¸­ï¼Œåªæœ‰è·Ÿè§£æžæˆ–è€…æ³¨å†Œbeanæœ‰å…³ç³»çš„ç±»éƒ½ä¼šä½¿ç”¨ConditionEvaluatorå®Œæˆæ¡ä»¶æ³¨è§£çš„åˆ¤æ–­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä¸€äº›ç±»ä¸æ»¡è¶³æ¡ä»¶çš„è¯å°±ä¼šè¢«skipã€‚è¿™äº›ç±»æ¯”å¦‚æœ‰AnnotatedBeanDefinitionReaderã€ConfigurationClassBeanDefinitionReaderã€ConfigurationClassParseã€ClassPathScanningCandidateComponentProviderç­‰ã€‚ æ¯”å¦‚ConfigurationClassParserçš„æž„é€ å‡½æ•°ä¼šåˆå§‹åŒ–å†…éƒ¨å±žæ€§conditionEvaluatorï¼š 1234567891011121314public ConfigurationClassParser(MetadataReaderFactory metadataReaderFactory, ProblemReporter problemReporter, Environment environment, ResourceLoader resourceLoader, BeanNameGenerator componentScanBeanNameGenerator, BeanDefinitionRegistry registry) &#123; this.metadataReaderFactory = metadataReaderFactory; this.problemReporter = problemReporter; this.environment = environment; this.resourceLoader = resourceLoader; this.registry = registry; this.componentScanParser = new ComponentScanAnnotationParser( resourceLoader, environment, componentScanBeanNameGenerator, registry); // æž„é€ ConditionEvaluatorç”¨äºŽå¤„ç†æ¡ä»¶æ³¨è§£ this.conditionEvaluator = new ConditionEvaluator(registry, environment, resourceLoader);&#125; ConfigurationClassParserå¯¹æ¯ä¸ªé…ç½®ç±»è¿›è¡Œè§£æžçš„æ—¶å€™éƒ½ä¼šä½¿ç”¨ConditionEvaluatorï¼š 123if (this.conditionEvaluator.shouldSkip(configClass.getMetadata(), ConfigurationPhase.PARSE_CONFIGURATION)) &#123; return;&#125; ConditionEvaluatorçš„skipæ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344public boolean shouldSkip(AnnotatedTypeMetadata metadata, ConfigurationPhase phase) &#123; // å¦‚æžœè¿™ä¸ªç±»æ²¡æœ‰è¢«@Conditionalæ³¨è§£æ‰€ä¿®é¥°ï¼Œä¸ä¼šskip if (metadata == null || !metadata.isAnnotated(Conditional.class.getName())) &#123; return false; &#125; // å¦‚æžœå‚æ•°ä¸­æ²’æœ‰è®¾ç½®æ¡ä»¶æ³¨è§£çš„ç”Ÿæ•ˆé˜¶æ®µ if (phase == null) &#123; // æ˜¯é…ç½®ç±»çš„è¯ç›´æŽ¥ä½¿ç”¨PARSE_CONFIGURATIONé˜¶æ®µ if (metadata instanceof AnnotationMetadata &amp;&amp; ConfigurationClassUtils.isConfigurationCandidate((AnnotationMetadata) metadata)) &#123; return shouldSkip(metadata, ConfigurationPhase.PARSE_CONFIGURATION); &#125; // å¦åˆ™ä½¿ç”¨REGISTER_BEANé˜¶æ®µ return shouldSkip(metadata, ConfigurationPhase.REGISTER_BEAN); &#125; // è¦è§£æžçš„é…ç½®ç±»çš„æ¡ä»¶é›†åˆ List&lt;Condition&gt; conditions = new ArrayList&lt;Condition&gt;(); // èŽ·å–é…ç½®ç±»çš„æ¡ä»¶æ³¨è§£å¾—åˆ°æ¡ä»¶æ•°æ®ï¼Œå¹¶æ·»åŠ åˆ°é›†åˆä¸­ for (String[] conditionClasses : getConditionClasses(metadata)) &#123; for (String conditionClass : conditionClasses) &#123; Condition condition = getCondition(conditionClass, this.context.getClassLoader()); conditions.add(condition); &#125; &#125; // å¯¹æ¡ä»¶é›†åˆåšä¸ªæŽ’åº AnnotationAwareOrderComparator.sort(conditions); // éåŽ†æ¡ä»¶é›†åˆ for (Condition condition : conditions) &#123; ConfigurationPhase requiredPhase = null; if (condition instanceof ConfigurationCondition) &#123; requiredPhase = ((ConfigurationCondition) condition).getConfigurationPhase(); &#125; // æ²¡æœ‰è¿™ä¸ªè§£æžç±»ä¸éœ€è¦é˜¶æ®µçš„åˆ¤æ–­æˆ–è€…è§£æžç±»å’Œå‚æ•°ä¸­çš„é˜¶æ®µä¸€è‡´æ‰ä¼šç»§ç»­è¿›è¡Œ if (requiredPhase == null || requiredPhase == phase) &#123; // é˜¶æ®µä¸€è‡´åˆ‡ä¸æ»¡è¶³æ¡ä»¶çš„è¯ï¼Œè¿”å›žtrueå¹¶è·³è¿‡è¿™ä¸ªbeançš„è§£æž if (!condition.matches(this.context, metadata)) &#123; return true; &#125; &#125; &#125; return false;&#125; SpringBootåœ¨æ¡ä»¶æ³¨è§£çš„è§£æžlogè®°å½•åœ¨äº†ConditionEvaluationReportç±»ä¸­ï¼Œå¯ä»¥é€šè¿‡BeanFactoryèŽ·å–(BeanFactoryæ˜¯æœ‰çˆ¶å­å…³ç³»çš„ï¼›æ¯ä¸ªBeanFactoryéƒ½å­˜æœ‰ä¸€ä»½ConditionEvaluationReportï¼Œäº’ä¸ç›¸å¹²)ï¼š 12345678910ConditionEvaluationReport conditionEvaluationReport = beanFactory.getBean("autoConfigurationReport", ConditionEvaluationReport.class);Map&lt;String, ConditionEvaluationReport.ConditionAndOutcomes&gt; result = conditionEvaluationReport.getConditionAndOutcomesBySource();for(String key : result.keySet()) &#123; ConditionEvaluationReport.ConditionAndOutcomes conditionAndOutcomes = result.get(key); Iterator&lt;ConditionEvaluationReport.ConditionAndOutcome&gt; iterator = conditionAndOutcomes.iterator(); while(iterator.hasNext()) &#123; ConditionEvaluationReport.ConditionAndOutcome conditionAndOutcome = iterator.next(); System.out.println(key + " -- " + conditionAndOutcome.getCondition().getClass().getSimpleName() + " -- " + conditionAndOutcome.getOutcome()); &#125;&#125; æ‰“å°å‡ºæ¡ä»¶æ³¨è§£ä¸‹çš„ç±»åŠ è½½ä¿¡æ¯ï¼š 12345678.......org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration -- OnClassCondition -- required @ConditionalOnClass classes not found: freemarker.template.Configuration,org.springframework.ui.freemarker.FreeMarkerConfigurationFactoryorg.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration -- OnClassCondition -- required @ConditionalOnClass classes not found: groovy.text.markup.MarkupTemplateEngineorg.springframework.boot.autoconfigure.gson.GsonAutoConfiguration -- OnClassCondition -- required @ConditionalOnClass classes not found: com.google.gson.Gsonorg.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration -- OnClassCondition -- required @ConditionalOnClass classes not found: org.h2.server.web.WebServletorg.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration -- OnClassCondition -- required @ConditionalOnClass classes not found: org.springframework.hateoas.Resource,org.springframework.plugin.core.Pluginorg.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration -- OnClassCondition -- required @ConditionalOnClass classes not found: com.hazelcast.core.HazelcastInstance.......]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Dubboæºç åˆ†æžä¹‹æœåŠ¡å‘å¸ƒè¿‡ç¨‹]]></title>
    <url>%2F2018%2F06%2F24%2FDubbo%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B%E6%9C%8D%E5%8A%A1%E5%8F%91%E5%B8%83%E8%BF%87%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[æœåŠ¡ç«¯å‘å¸ƒæµç¨‹ Spring å¯¹å¤–ç•™å‡ºçš„æ‰©å±•dubbo æ˜¯åŸºäºŽ spring é…ç½®æ¥å®žçŽ°æœåŠ¡çš„å‘å¸ƒçš„ï¼Œä¸€å®šæ˜¯åŸºäºŽ spring çš„æ‰©å±•æ¥å†™äº†ä¸€å¥—è‡ªå·±çš„æ ‡ç­¾ã€‚åœ¨ dubbo é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°çš„&lt;dubbo:service&gt; ï¼Œå°±æ˜¯å±žäºŽè‡ªå®šä¹‰æ‰©å±•æ ‡ç­¾è¦å®žçŽ°è‡ªå®šä¹‰æ‰©å±•ï¼Œæœ‰ä¸‰ä¸ªæ­¥éª¤(åœ¨ spring ä¸­å®šä¹‰äº†ä¸¤ä¸ªæŽ¥å£ï¼Œç”¨æ¥å®žçŽ° æ‰©å±•) NamespaceHandler: æ³¨å†Œä¸€å † BeanDefinitionParserï¼Œåˆ©ç”¨ä»–ä»¬æ¥è¿›è¡Œè§£æž BeanDefinitionParser:ç”¨äºŽè§£æžæ¯ä¸ªelementçš„å†…å®¹ Spring é»˜è®¤ä¼šåŠ è½½ jar åŒ…ä¸‹çš„ META-INF/spring.handlers æ–‡ä»¶å¯»æ‰¾å¯¹åº”çš„ NamespaceHandlerã€‚ è¿™ä¸ªé‡Œé¢ä¸»è¦åšäº†ä¸€ä»¶äº‹ï¼ŒæŠŠä¸åŒçš„é…ç½®åˆ†åˆ«è½¬åŒ–æˆ spring å®¹å™¨ä¸­çš„ bean å¯¹è±¡application å¯¹åº” ApplicationConfigregistry å¯¹åº” RegistryConfigmonitor å¯¹åº” MonitorConfigprovider å¯¹åº” ProviderConfigconsumer å¯¹åº” ConsumerConfig ä¸ºäº†åœ¨ spring å¯åŠ¨çš„æ—¶å€™ï¼Œä¹Ÿç›¸åº”çš„å¯åŠ¨ provider å‘å¸ƒæœåŠ¡æ³¨å†ŒæœåŠ¡çš„ è¿‡ç¨‹ï¼Œè€ŒåŒæ—¶ä¸ºäº†è®©å®¢æˆ·ç«¯åœ¨å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨è®¢é˜…å‘çŽ°æœåŠ¡ï¼ŒåŠ å…¥äº†ä¸¤ä¸ª beanServiceBeanã€ReferenceBeanã€‚åˆ†åˆ«ç»§æ‰¿äº† ServiceConfig å’Œ ReferenceConfigåŒ æ—¶ è¿˜ åˆ† åˆ« å®ž çŽ° äº† InitializingBean ã€ DisposableBean, ApplicationContextAware, ApplicationListener, BeanNameAware InitializingBean æŽ¥å£ä¸º bean æä¾›äº†åˆå§‹åŒ–æ–¹æ³•çš„æ–¹å¼ï¼Œå®ƒåªåŒ…æ‹¬ afterPropertiesSet æ–¹æ³•ï¼Œå‡¡æ˜¯ç»§æ‰¿è¯¥æŽ¥å£çš„ç±»ï¼Œåœ¨åˆå§‹åŒ– bean çš„æ—¶å€™ä¼š æ‰§è¡Œè¯¥æ–¹æ³•ã€‚DisposableBean bean è¢«é”€æ¯çš„æ—¶å€™ï¼Œspring å®¹å™¨ä¼šè‡ªåŠ¨æ‰§è¡Œ destory æ–¹ æ³•ï¼Œæ¯”å¦‚é‡Šæ”¾èµ„æºApplicationContextAware å®žçŽ°äº†è¿™ä¸ªæŽ¥å£çš„ beanï¼Œå½“ spring å®¹å™¨åˆå§‹ åŒ–çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨çš„å°† ApplicationContext æ³¨å…¥è¿›æ¥ApplicationListener ApplicationEvent äº‹ä»¶ç›‘å¬ï¼Œspring å®¹å™¨å¯åŠ¨åŽä¼šå‘ä¸€ä¸ªäº‹ä»¶é€šçŸ¥BeanNameAware èŽ·å¾—è‡ªèº«åˆå§‹åŒ–æ—¶ï¼Œæœ¬èº«çš„ bean çš„ id å±žæ€§ é‚£ä¹ˆåŸºæœ¬çš„å®žçŽ°æ€è·¯å¯ä»¥æ•´ç†å‡ºæ¥äº† åˆ©ç”¨ spring çš„è§£æžæ”¶é›† xml ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œç„¶åŽæŠŠè¿™äº›é…ç½®ä¿¡æ¯å­˜å‚¨åˆ° serviceConfig ä¸­ è°ƒç”¨ServiceConfigçš„exportæ–¹æ³•æ¥è¿›è¡ŒæœåŠ¡çš„å‘å¸ƒå’Œæ³¨å†Œ æœåŠ¡çš„å‘å¸ƒè¿‡ç¨‹serviceBean æ˜¯æœåŠ¡å‘å¸ƒçš„åˆ‡å…¥ç‚¹ï¼Œé€šè¿‡ afterPropertiesSet æ–¹æ³•ï¼Œè°ƒç”¨ export()æ–¹æ³•è¿›è¡Œå‘å¸ƒã€‚export ä¸ºçˆ¶ç±» ServiceConfig ä¸­çš„æ–¹æ³•ï¼Œæ‰€ä»¥è·³è½¬åˆ° SeviceConfig ç±»ä¸­çš„ export æ–¹æ³• delayä½œç”¨ export æ˜¯ synchronized ä¿®é¥°çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´æš´éœ²çš„è¿‡ç¨‹æ˜¯åŽŸå­æ“ä½œï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šå‡ºçŽ°é”ç«žäº‰çš„é—®é¢˜ï¼Œæ¯•ç«Ÿåˆå§‹åŒ–è¿‡ç¨‹å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ å•ä¸€çº¿ç¨‹æ“ä½œï¼Œè¿™é‡Œè”æƒ³åˆ°äº† spring çš„åˆå§‹åŒ–æµç¨‹ï¼Œä¹Ÿè¿›è¡Œäº†åŠ é”æ“ ä½œï¼Œè¿™é‡Œä¹Ÿç»™æˆ‘ä»¬å¹³æ—¶è®¾è®¡ä¸€ä¸ªä¸é”™çš„å¯ç¤º:åˆå§‹åŒ–æµç¨‹çš„æ€§èƒ½è°ƒä¼˜ä¼˜å…ˆçº§åº”è¯¥æ¯”è¾ƒä½Žï¼Œä½†æ˜¯å®‰å…¨çš„ä¼˜å…ˆçº§åº”è¯¥æ”¾çš„æ¯”è¾ƒé«˜! ç»§ç»­çœ‹doExport()æ–¹æ³•ã€‚åŒæ ·æ˜¯ä¸€å †åˆå§‹åŒ–ä»£ 12345678910111213141516171819202122232425262728293031public synchronized void export() &#123; if (provider != null) &#123; if (export == null) &#123; export = provider.getExport(); &#125; if (delay == null) &#123; delay = provider.getDelay(); &#125; &#125; if (export != null &amp;&amp; ! export.booleanValue()) &#123; return; &#125; if (delay != null &amp;&amp; delay &gt; 0) &#123; Thread thread = new Thread(new Runnable() &#123; public void run() &#123; try &#123; Thread.sleep(delay); &#125; catch (Throwable e) &#123; &#125; doExport(); &#125; &#125;); thread.setDaemon(true); thread.setName("DelayExportServiceThread"); thread.start(); &#125; else &#123; doExport(); &#125;&#125; ç»§ç»­çœ‹ doExport()ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ° doExportUrls()ä¸­:123456private void doExportUrls() &#123; List&lt;URL&gt; registryURLs = loadRegistries(true);//æ˜¯ä¸æ˜¯èŽ·å¾—æ³¨å†Œä¸­å¿ƒçš„é…ç½® for (ProtocolConfig protocolConfig : protocols) &#123; //æ˜¯ä¸æ˜¯æ”¯æŒå¤šåè®®å‘å¸ƒ doExportUrlsFor1Protocol(protocolConfig, registryURLs); &#125;&#125; è¿™ ä¸ª protocols é•¿ è¿™ ä¸ª æ · å­ protocols ä¹Ÿæ˜¯æ ¹æ®é…ç½®è£…é…å‡ºæ¥çš„ã€‚æŽ¥ä¸‹ æ¥è®©æˆ‘ä»¬è¿›å…¥ doExportUrlsFor1Protocol æ–¹æ³•çœ‹çœ‹ dubbo å…·ä½“æ˜¯æ€Žä¹ˆæ · å°†æœåŠ¡æš´éœ²å‡ºåŽ» doExportUrlsFor1Protocol1234567891011121314151617181920212223242526272829303132//å¦‚æžœé…ç½®ä¸æ˜¯localåˆ™æš´éœ²ä¸ºè¿œç¨‹æœåŠ¡.(é…ç½®ä¸ºlocalï¼Œåˆ™è¡¨ç¤ºåªæš´éœ²æœ¬åœ°æœåŠ¡)//æ³¨å†ŒæœåŠ¡if (! Constants.SCOPE_LOCAL.toString().equalsIgnoreCase(scope) )&#123; if (logger.isInfoEnabled()) &#123; logger.info("Export dubbo service " + interfaceClass.getName() + " to url " + url); &#125; if (registryURLs != null &amp;&amp; registryURLs.size() &gt; 0 &amp;&amp; url.getParameter("register", true)) &#123; for (URL registryURL : registryURLs) &#123;// url = url.addParameterIfAbsent("dynamic", registryURL.getParameter("dynamic")); URL monitorUrl = loadMonitor(registryURL); if (monitorUrl != null) &#123; url = url.addParameterAndEncoded(Constants.MONITOR_KEY, monitorUrl.toFullString()); &#125; if (logger.isInfoEnabled()) &#123; logger.info("Register dubbo service " + interfaceClass.getName() + " url " + url + " to registry " + registryURL); &#125; //é€šè¿‡proxyFactoryæ¥èŽ·å–Invokerå¯¹è±¡ Invoker&lt;?&gt; invoker = proxyFactory.getInvoker(ref, (Class)interfaceClass,registryURL.addParameterAndEncoded(Constants.EXPORT_KEY, url.toFullString())); //æ³¨å†ŒæœåŠ¡ Exporter&lt;?&gt; exporter = protocol.export(invoker); //å°†exporteræ·»åŠ åˆ°listä¸­ exporters.add(exporter); &#125; &#125; else &#123; Invoker&lt;?&gt; invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, url); Exporter&lt;?&gt; exporter = protocol.export(invoker); exporters.add(exporter); &#125;&#125; doExportUrlsFor1Protocol æ–¹ æ³•ï¼Œå…ˆåˆ›å»ºä¸¤ä¸ª URLï¼Œåˆ†åˆ«å¦‚ä¸‹ dubbo://192.168.xx.63:20888/com.gupaoedu.IGHello; registry://192.168.xx ;æ˜¯ä¸æ˜¯è§‰å¾—è¿™ä¸ª URL å¾ˆçœ¼ç†Ÿï¼Œæ²¡é”™åœ¨æ³¨å†Œä¸­å¿ƒçœ‹åˆ°çš„ services çš„ providers ä¿¡æ¯å°±æ˜¯è¿™ä¸ªåœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­å¯ä»¥çœ‹åˆ° Dubbo çš„æ¯”è¾ƒæ ¸å¿ƒçš„æŠ½è±¡:Invokeã€‚Invoker æ˜¯ä¸€ä¸ªä»£ç†ç±»ï¼Œä»Ž ProxyFactory ä¸­ç”Ÿæˆã€‚ è¿™ä¸ªåœ°æ–¹å¯ä»¥åšä¸€ä¸ªå°ç»“ Invoker - æ‰§è¡Œå…·ä½“çš„è¿œç¨‹è°ƒç”¨ Protocol â€“ æœåŠ¡åœ°å€çš„å‘å¸ƒå’Œè®¢é˜… Exporter â€“ æš´éœ²æœåŠ¡æˆ–å–æ¶ˆæš´éœ² protocol.export(invoker)protocol è¿™ä¸ªåœ°æ–¹ï¼Œå…¶å®žå¹¶ä¸æ˜¯ç›´æŽ¥è°ƒç”¨ DubboProtocol åè®®çš„ export, å¤§å®¶è·Ÿæˆ‘çœ‹çœ‹ protocol è¿™ä¸ªå±žæ€§æ˜¯åœ¨å“ªé‡Œå®žä¾‹åŒ–çš„?ä»¥åŠå®žä¾‹åŒ–çš„ä»£ç  æ˜¯ä»€ä¹ˆ?è¿™ä¸ª Protocol å¾—åˆ°çš„åº”è¯¥æ˜¯ä¸€ä¸ª Protocol$Adaptiveä¸€ä¸ªè‡ªé€‚åº” çš„é€‚é…å™¨ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé€šè¿‡ protocol.export(invoker),å®žé™…ä¸Šè°ƒç”¨çš„åº”è¯¥æ˜¯Protocol$Adaptive è¿™ä¸ªåŠ¨æ€ç±»çš„ export æ–¹æ³•ã€‚ Protocol$Adaptiveå‰é¢çš„ExtensionLoaderæœ‰è®²è¿‡ï¼Œé»˜è®¤æ˜¯dubboã€‚ ä¸Šé¢è¿™æ®µä»£ç åšä¸¤ä¸ªäº‹æƒ… ä»Ž url ä¸­èŽ·å¾— protocol çš„åè®®åœ°å€ï¼Œå¦‚æžœ protocol ä¸ºç©ºï¼Œè¡¨ç¤ºå·² dubboåè®®å‘å¸ƒæœåŠ¡ï¼Œå¦åˆ™æ ¹æ®é…ç½®çš„åè®®ç±»åž‹æ¥å‘å¸ƒæœåŠ¡ã€‚ è°ƒ ç”¨ExtensionLoader.getExtensionLoader(Protocol.class).getExtension(extName);ExtensionLoader.getExtensionLoader(Protocol.class).getExtension(extName); è¿™æ®µä»£ç åšäº†ä»€ä¹ˆäº‹æƒ…å‘¢?å‰é¢è¿™æ®µä»£ç æˆ‘ä»¬å·²ç»ç†è§£äº†ï¼Œé€šè¿‡å·¥åŽ‚æ¨¡å¼ èŽ·å¾—ä¸€ä¸ª ExtensionLoader å®žä¾‹ï¼Œæˆ‘ä»¬æ¥åˆ†æžä¸‹ä¸‹ getExtension è¿™ä¸ªæ–¹æ³•ã€‚getExtensionè¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥èŽ·å– ExtensionLoader å®žä¾‹ä»£è¡¨çš„æ‰©å±•çš„æŒ‡å®š å®žçŽ°ï¼Œå·²æ‰©å±•å®žçŽ°çš„åå­—ä½œä¸ºå‚æ•°ã€‚ 1234567891011121314151617181920212223242526272829303132 /** * è¿”å›žæŒ‡å®šåå­—çš„æ‰©å±•ã€‚å¦‚æžœæŒ‡å®šåå­—çš„æ‰©å±•ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å¼‚å¸¸ &#123;@link IllegalStateException&#125;. * * @param name * @return */@SuppressWarnings("unchecked")public T getExtension(String name) &#123; if (name == null || name.length() == 0) throw new IllegalArgumentException("Extension name == null"); if ("true".equals(name)) &#123; return getDefaultExtension(); &#125; ////åˆ¤æ–­æ˜¯å¦å·²ç»ç¼“å­˜è¿‡è¯¥æ‰©å±•ç‚¹ Holder&lt;Object&gt; holder = cachedInstances.get(name); if (holder == null) &#123; cachedInstances.putIfAbsent(name, new Holder&lt;Object&gt;()); holder = cachedInstances.get(name); &#125; Object instance = holder.get(); if (instance == null) &#123; synchronized (holder) &#123; instance = holder.get(); if (instance == null) &#123; ////createExtension ï¼Œåˆ›å»ºæ‰©å±•ç‚¹ instance = createExtension(name); holder.set(instance); &#125; &#125; &#125; return (T) instance;&#125; createExtension æ ¹æ® name èŽ·å–å¯¹åº”çš„ class æ ¹æ®classåˆ›å»ºä¸€ä¸ªå®žä¾‹ å¯¹èŽ·å–çš„å®žä¾‹è¿›è¡Œä¾èµ–æ³¨å…¥ å¯¹å®žä¾‹è¿›è¡ŒåŒ…è£…ï¼Œåˆ†åˆ«è°ƒç”¨å¸¦ Protocol å‚æ•°çš„æž„é€ å‡½æ•°åˆ›å»ºå®žä¾‹ï¼Œç„¶åŽè¿›è¡Œä¾èµ–æ³¨å…¥ã€‚a) åœ¨ dubbo-rpc-api çš„ resources è·¯ å¾„ ä¸‹ ï¼Œ æ‰¾ åˆ°com.alibaba.dubbo.rcp.Protocol æ–‡ä»¶ä¸­æœ‰å­˜åœ¨ filter/listenerb) éåŽ† cachedWrapperClass å¯¹ DubboProtocol è¿›è¡ŒåŒ…è£…ï¼Œä¼šé€šè¿‡ProtocolFilterWrapperã€ProtocolListenerWrapper åŒ…è£… 12345678910111213141516171819202122232425private T createExtension(String name) &#123; Class&lt;?&gt; clazz = getExtensionClasses().get(name);//"dubbo" clazz=DubboProtocol if (clazz == null) &#123; throw findException(name); &#125; try &#123; T instance = (T) EXTENSION_INSTANCES.get(clazz); if (instance == null) &#123; EXTENSION_INSTANCES.putIfAbsent(clazz, (T) clazz.newInstance()); instance = (T) EXTENSION_INSTANCES.get(clazz); &#125; injectExtension(instance); Set&lt;Class&lt;?&gt;&gt; wrapperClasses = cachedWrapperClasses; if (wrapperClasses != null &amp;&amp; wrapperClasses.size() &gt; 0) &#123; for (Class&lt;?&gt; wrapperClass : wrapperClasses) &#123; //// å¯¹å®žä¾‹è¿›è¡ŒåŒ…è£…ï¼Œåˆ†åˆ«è°ƒç”¨å¸¦ Protocol å‚æ•°çš„æž„ é€ å‡½æ•°åˆ›å»ºå®žä¾‹ï¼Œç„¶åŽè¿›è¡Œä¾èµ–æ³¨å…¥ã€‚ instance = injectExtension((T) wrapperClass.getConstructor(type).newInstance(instance)); &#125; &#125; return instance; &#125; catch (Throwable t) &#123; throw new IllegalStateException("Extension instance(name: " + name + ", class: " + type + ") could not be instantiated: " + t.getMessage(), t); &#125;&#125; getExtensionClassesè¿™ä¸ªæ–¹æ³•ä¹‹å‰åœ¨è®²è‡ªé€‚åº”æ‰©å±•ç‚¹çš„æ—¶å€™è®²è¿‡äº†ï¼Œå…¶å®žå°±æ˜¯åŠ è½½æ‰©å±•ç‚¹å®žçŽ° ç±»äº†ã€‚ç„¶åŽè°ƒç”¨ loadExtensionClassesï¼ŒåŽ»å¯¹åº”æ–‡ä»¶ä¸‹åŽ»åŠ è½½æŒ‡å®šçš„æ‰©å±• ç‚¹123456789101112131415//åŠ è½½æ‰©å±•ç‚¹çš„å®žçŽ°ç±»private Map&lt;String, Class&lt;?&gt;&gt; getExtensionClasses() &#123; Map&lt;String, Class&lt;?&gt;&gt; classes = cachedClasses.get(); if (classes == null) &#123; synchronized (cachedClasses) &#123; classes = cachedClasses.get(); if (classes == null) &#123; classes = loadExtensionClasses(); cachedClasses.set(classes); &#125; &#125; &#125; return classes;&#125; ResigtryProtocolExtensionLoader.getExtensionLoader(Protocol.class).getExtension(extN ame); å½“ extName ä¸º registry çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†æ¬¡åŽ»é˜…è¯»è¿™å—ä»£ç  äº†ï¼Œç›´æŽ¥å¯ä»¥åœ¨æ‰©å±•ç‚¹ä¸­æ‰¾åˆ°ç›¸åº”çš„å®žçŽ°æ‰©å±•ç‚¹[/dubbo-registry- api/src/main/resources/META- INF/dubbo/internal/com.alibaba.dubbo.rpc.Protocol] é…ç½®å¦‚ä¸‹æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å®šä½åˆ° RegistryProtocolè¿™ä¸ªç±»ä¸­çš„exportæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738public &lt;T&gt; Exporter&lt;T&gt; export(final Invoker&lt;T&gt; originInvoker) throws RpcException &#123; //export invoker ï¼Œ æœ¬åœ°å‘å¸ƒæœåŠ¡ï¼ˆå¯åŠ¨nettyï¼‰ final ExporterChangeableWrapper&lt;T&gt; exporter = doLocalExport(originInvoker); //registry provider final Registry registry = getRegistry(originInvoker); final URL registedProviderUrl = getRegistedProviderUrl(originInvoker); registry.register(registedProviderUrl); // è®¢é˜…overrideæ•°æ® // FIXME æä¾›è€…è®¢é˜…æ—¶ï¼Œä¼šå½±å“åŒä¸€JVMå³æš´éœ²æœåŠ¡ï¼Œåˆå¼•ç”¨åŒä¸€æœåŠ¡çš„çš„åœºæ™¯ï¼Œå› ä¸ºsubscribedä»¥æœåŠ¡åä¸ºç¼“å­˜çš„keyï¼Œå¯¼è‡´è®¢é˜…ä¿¡æ¯è¦†ç›–ã€‚ final URL overrideSubscribeUrl = getSubscribedOverrideUrl(registedProviderUrl); final OverrideListener overrideSubscribeListener = new OverrideListener(overrideSubscribeUrl); overrideListeners.put(overrideSubscribeUrl, overrideSubscribeListener); registry.subscribe(overrideSubscribeUrl, overrideSubscribeListener); //ä¿è¯æ¯æ¬¡exportéƒ½è¿”å›žä¸€ä¸ªæ–°çš„exporterå®žä¾‹ return new Exporter&lt;T&gt;() &#123; public Invoker&lt;T&gt; getInvoker() &#123; return exporter.getInvoker(); &#125; public void unexport() &#123; try &#123; exporter.unexport(); &#125; catch (Throwable t) &#123; logger.warn(t.getMessage(), t); &#125; try &#123; registry.unregister(registedProviderUrl); &#125; catch (Throwable t) &#123; logger.warn(t.getMessage(), t); &#125; try &#123; overrideListeners.remove(overrideSubscribeUrl); registry.unsubscribe(overrideSubscribeUrl, overrideSubscribeListener); &#125; catch (Throwable t) &#123; logger.warn(t.getMessage(), t); &#125; &#125; &#125;;&#125; æœ¬åœ°å…ˆå¯åŠ¨ç›‘å¬æœåŠ¡ 123456789101112131415private &lt;T&gt; ExporterChangeableWrapper&lt;T&gt; doLocalExport(final Invoker&lt;T&gt; originInvoker)&#123; String key = getCacheKey(originInvoker); ExporterChangeableWrapper&lt;T&gt; exporter = (ExporterChangeableWrapper&lt;T&gt;) bounds.get(key); if (exporter == null) &#123; synchronized (bounds) &#123; exporter = (ExporterChangeableWrapper&lt;T&gt;) bounds.get(key); if (exporter == null) &#123; final Invoker&lt;?&gt; invokerDelegete = new InvokerDelegete&lt;T&gt;(originInvoker, getProviderUrl(originInvoker)); exporter = new ExporterChangeableWrapper&lt;T&gt;((Exporter&lt;T&gt;)protocol.export(invokerDelegete), originInvoker); bounds.put(key, exporter); &#125; &#125; &#125; return (ExporterChangeableWrapper&lt;T&gt;) exporter;&#125; ä¸Šé¢ä»£ç ä¸­ï¼Œprotocolä»£ç æ˜¯æ€Žä¹ˆèµ‹å€¼çš„å‘¢ï¼Ÿæˆ‘ä»¬çœ‹çœ‹ä»£ç ï¼Œç†Ÿæ‚‰å—ï¼Ÿæ˜¯ä¸€ä¸ªä¾èµ–æ³¨å…¥çš„æ‰©å±•ç‚¹ã€‚ä¸ç†Ÿæ‚‰çš„è¯ï¼Œæˆ‘ä»¬å†å›žæƒ³ä¸€ä¸‹ï¼Œåœ¨åŠ è½½æ‰©å±•ç‚¹çš„æ—¶å€™ï¼Œ æœ‰ä¸€ä¸ªinjectExtensionæ–¹æ³•ï¼Œé’ˆå¯¹å·²ç»åŠ è½½çš„æ‰©å±•ç‚¹ä¸­çš„æ‰©å±•ç‚¹å±žæ€§è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚ï¼ˆç‰›é€¼çš„ä»£ç ï¼‰ 12345private Protocol protocol;public void setProtocol(Protocol protocol) &#123; this.protocol = protocol;&#125; å› æ­¤æˆ‘ä»¬çŸ¥é“protocolæ˜¯ä¸€ä¸ªè‡ªé€‚åº”æ‰©å±•ç‚¹ï¼ŒProtocol$Adaptiveï¼Œç„¶åŽè°ƒç”¨è¿™ä¸ªè‡ªé€‚åº”æ‰©å±•ç‚¹ä¸­çš„exportæ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™ä¼ å…¥çš„åè®®åœ°å€åº”è¯¥æ˜¯ dubbo://127.0.0.1/xxxxâ€¦ å› æ­¤åœ¨Protocol$Adaptive.exportæ–¹æ³•ä¸­ï¼ŒExtensionLoader.getExtension(Protocol.class).getExtension(extName)ã€‚åº”è¯¥å°±æ˜¯ProtocolFilterWrapper(ProtocolListenerWrapper(DubboProtocol)))ï¼Œåœ¨ExtensionLoaderä¸­ä¼šæ‰«ææ˜¯å¦æœ‰wrappedClassï¼Œå°±æ˜¯å­˜åœ¨æž„é€ å‡½æ•°ï¼Œå‚æ•°æ˜¯çˆ¶ç±»æŽ¥å£ã€‚ è¿™é‡Œå¹¶ä¸æ˜¯èŽ·å¾—ä¸€ä¸ªå•çº¯çš„DubboProtocolæ‰©å±•ç‚¹ï¼Œè€Œæ˜¯ä¼šé€šè¿‡Wrapperå¯¹Protocolè¿›è¡Œè£…é¥°ï¼Œè£…é¥°å™¨åˆ†åˆ«ä¸º: ProtocolFilterWrapper/ ProtocolListenerWrapper; è‡³äºŽMockProtocolä¸ºä»€ä¹ˆä¸åœ¨è£…é¥°å™¨é‡Œé¢å‘¢ï¼Ÿå¤§å®¶å†å›žæƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨çœ‹ExtensionLoader.loadFileè¿™æ®µä»£ç çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œè£…é¥°å™¨å¿…é¡»è¦å…·å¤‡ä¸€ä¸ªå¸¦æœ‰Protocolçš„æž„é€ æ–¹æ³•ï¼Œå¦‚ä¸‹ 123456public ProtocolFilterWrapper(Protocol protocol)&#123; if (protocol == null) &#123; throw new IllegalArgumentException("protocol == null"); &#125; this.protocol = protocol;&#125; åˆ†æžProtocolFilterWrapperå’ŒProtocolListenerWrapperProtocolFilterWrapperè¿™ä¸ªç±»éžå¸¸é‡è¦ï¼Œdubboæœºåˆ¶é‡Œé¢æ—¥å¿—è®°å½•ã€è¶…æ—¶ç­‰ç­‰åŠŸèƒ½éƒ½æ˜¯åœ¨è¿™ä¸€éƒ¨åˆ†å®žçŽ°çš„ è¿™ä¸ªç±»æœ‰3ä¸ªç‰¹ç‚¹ï¼Œ ç¬¬ä¸€å®ƒæœ‰ä¸€ä¸ªå‚æ•°ä¸ºProtocol protocolçš„æž„é€ å‡½æ•°ï¼› ç¬¬äºŒï¼Œå®ƒå®žçŽ°äº†ProtocolæŽ¥å£ï¼› ç¬¬ä¸‰ï¼Œå®ƒä½¿ç”¨è´£ä»»é“¾æ¨¡å¼ï¼Œå¯¹exportå’Œreferå‡½æ•°è¿›è¡Œäº†å°è£…ã€‚åˆ†åˆ«ä½¿ç”¨SERVICE_FILTER_KEYå’ŒREFERENCE_FILTER_KEYè°ƒç”¨buildInvokerChainæ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374public class ProtocolFilterWrapper implements Protocol &#123; private final Protocol protocol; public ProtocolFilterWrapper(Protocol protocol)&#123; if (protocol == null) &#123; throw new IllegalArgumentException("protocol == null"); &#125; this.protocol = protocol; &#125; public int getDefaultPort() &#123; return protocol.getDefaultPort(); &#125; public &lt;T&gt; Exporter&lt;T&gt; export(Invoker&lt;T&gt; invoker) throws RpcException &#123; if (Constants.REGISTRY_PROTOCOL.equals(invoker.getUrl().getProtocol())) &#123; return protocol.export(invoker); &#125; return protocol.export(buildInvokerChain(invoker, Constants.SERVICE_FILTER_KEY, Constants.PROVIDER)); &#125; public &lt;T&gt; Invoker&lt;T&gt; refer(Class&lt;T&gt; type, URL url) throws RpcException &#123; if (Constants.REGISTRY_PROTOCOL.equals(url.getProtocol())) &#123; return protocol.refer(type, url); &#125; return buildInvokerChain(protocol.refer(type, url), Constants.REFERENCE_FILTER_KEY, Constants.CONSUMER); &#125; public void destroy() &#123; protocol.destroy(); &#125;//buildInvokerChainå‡½æ•°ï¼šå®ƒè¯»å–æ‰€æœ‰çš„filterç±»ï¼Œåˆ©ç”¨è¿™äº›ç±»å°è£…invoker private static &lt;T&gt; Invoker&lt;T&gt; buildInvokerChain(final Invoker&lt;T&gt; invoker, String key, String group) &#123; Invoker&lt;T&gt; last = invoker; List&lt;Filter&gt; filters = ExtensionLoader.getExtensionLoader(Filter.class).getActivateExtension(invoker.getUrl(), key, group); if (filters.size() &gt; 0) &#123; for (int i = filters.size() - 1; i &gt;= 0; i --) &#123; final Filter filter = filters.get(i); final Invoker&lt;T&gt; next = last; last = new Invoker&lt;T&gt;() &#123; public Class&lt;T&gt; getInterface() &#123; return invoker.getInterface(); &#125; public URL getUrl() &#123; return invoker.getUrl(); &#125; public boolean isAvailable() &#123; return invoker.isAvailable(); &#125; public Result invoke(Invocation invocation) throws RpcException &#123; return filter.invoke(next, invocation); &#125; public void destroy() &#123; invoker.destroy(); &#125; @Override public String toString() &#123; return invoker.toString(); &#125; &#125;; &#125; &#125; return last; &#125;&#125; æˆ‘ä»¬çœ‹å¦‚ä¸‹æ–‡ä»¶ï¼š /dubbo-rpc-api/src/main/resources/META-INF/dubbo/internal/com.alibaba.dubbo.rpc.Filter å…¶å®žå°±æ˜¯å¯¹Invokerï¼Œé€šè¿‡å¦‚ä¸‹çš„Filterç»„è£…æˆä¸€ä¸ªè´£ä»»é“¾ 1234567891011121314echo=com.alibaba.dubbo.rpc.filter.EchoFiltergeneric=com.alibaba.dubbo.rpc.filter.GenericFiltergenericimpl=com.alibaba.dubbo.rpc.filter.GenericImplFiltertoken=com.alibaba.dubbo.rpc.filter.TokenFilteraccesslog=com.alibaba.dubbo.rpc.filter.AccessLogFilteractivelimit=com.alibaba.dubbo.rpc.filter.ActiveLimitFilterclassloader=com.alibaba.dubbo.rpc.filter.ClassLoaderFiltercontext=com.alibaba.dubbo.rpc.filter.ContextFilterconsumercontext=com.alibaba.dubbo.rpc.filter.ConsumerContextFilterexception=com.alibaba.dubbo.rpc.filter.ExceptionFilterexecutelimit=com.alibaba.dubbo.rpc.filter.ExecuteLimitFilterdeprecated=com.alibaba.dubbo.rpc.filter.DeprecatedFiltercompatible=com.alibaba.dubbo.rpc.filter.CompatibleFiltertimeout=com.alibaba.dubbo.rpc.filter.TimeoutFilter è¿™å…¶ä¸­æ¶‰åŠåˆ°å¾ˆå¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬æƒé™éªŒè¯ã€å¼‚å¸¸ã€è¶…æ—¶ç­‰ç­‰ï¼Œå½“ç„¶å¯ä»¥é¢„è®¡è®¡ç®—è°ƒç”¨æ—¶é—´ç­‰ç­‰åº”è¯¥ä¹Ÿæ˜¯åœ¨è¿™å…¶ä¸­çš„æŸä¸ªç±»å®žçŽ°çš„ï¼› è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°exportå’Œreferè¿‡ç¨‹éƒ½ä¼šè¢«filterè¿‡æ»¤ ProtocolListenerWrapperåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°exportå’Œreferåˆ†åˆ«å¯¹åº”äº†ä¸åŒçš„Wrapperï¼›exportæ˜¯å¯¹åº”çš„ListenerExporterWrapperã€‚è¿™å—æš‚æ—¶å…ˆä¸åŽ»åˆ†æžï¼Œå› ä¸ºè¿™ä¸ªåœ°æ–¹å¹¶æ²¡æœ‰æä¾›å®žçŽ°ç±»ã€‚ 123456789101112131415161718public &lt;T&gt; Exporter&lt;T&gt; export(Invoker&lt;T&gt; invoker) throws RpcException &#123; if (Constants.REGISTRY_PROTOCOL.equals(invoker.getUrl().getProtocol())) &#123; return protocol.export(invoker); &#125; return new ListenerExporterWrapper&lt;T&gt;(protocol.export(invoker), Collections.unmodifiableList(ExtensionLoader.getExtensionLoader(ExporterListener.class) .getActivateExtension(invoker.getUrl(), Constants.EXPORTER_LISTENER_KEY)));&#125;public &lt;T&gt; Invoker&lt;T&gt; refer(Class&lt;T&gt; type, URL url) throws RpcException &#123; if (Constants.REGISTRY_PROTOCOL.equals(url.getProtocol())) &#123; return protocol.refer(type, url); &#125; return new ListenerInvokerWrapper&lt;T&gt;(protocol.refer(type, url), Collections.unmodifiableList( ExtensionLoader.getExtensionLoader(InvokerListener.class) .getActivateExtension(url, Constants.INVOKER_LISTENER_KEY)));&#125; DubboProtocol.exporté€šè¿‡ä¸Šé¢çš„ä»£ç åˆ†æžå®Œä»¥åŽï¼Œæœ€ç»ˆæˆ‘ä»¬èƒ½å¤Ÿå®šä½åˆ°DubboProtocol.exportæ–¹æ³•ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹dubboProtocolçš„exportæ–¹æ³•ï¼šopenServer(urlï¼‰ 123456789101112131415161718192021222324252627public &lt;T&gt; Exporter&lt;T&gt; export(Invoker&lt;T&gt; invoker) throws RpcException &#123; URL url = invoker.getUrl(); // export service. String key = serviceKey(url); DubboExporter&lt;T&gt; exporter = new DubboExporter&lt;T&gt;(invoker, key, exporterMap); exporterMap.put(key, exporter); //export an stub service for dispaching event Boolean isStubSupportEvent = url.getParameter(Constants.STUB_EVENT_KEY,Constants.DEFAULT_STUB_EVENT); Boolean isCallbackservice = url.getParameter(Constants.IS_CALLBACK_SERVICE, false); if (isStubSupportEvent &amp;&amp; !isCallbackservice)&#123; String stubServiceMethods = url.getParameter(Constants.STUB_EVENT_METHODS_KEY); if (stubServiceMethods == null || stubServiceMethods.length() == 0 )&#123; if (logger.isWarnEnabled())&#123; logger.warn(new IllegalStateException("consumer [" +url.getParameter(Constants.INTERFACE_KEY) + "], has set stubproxy support event ,but no stub methods founded.")); &#125; &#125; else &#123; stubServiceMethodsMap.put(url.getServiceKey(), stubServiceMethods); &#125; &#125; //æš´éœ²æœåŠ¡ openServer(url); return exporter;&#125; openServerå¼€å¯æœåŠ¡ 123456789101112131415private void openServer(URL url) &#123; // find server. String key = url.getAddress();//192.168.11.156ï¼š20880 //client ä¹Ÿå¯ä»¥æš´éœ²ä¸€ä¸ªåªæœ‰serverå¯ä»¥è°ƒç”¨çš„æœåŠ¡ã€‚ boolean isServer = url.getParameter(Constants.IS_SERVER_KEY,true); if (isServer) &#123; ExchangeServer server = serverMap.get(key); if (server == null) &#123;//æ²¡æœ‰çš„è¯å°±æ˜¯åˆ›å»ºæœåŠ¡ serverMap.put(key, createServer(url)); &#125; else &#123; //serveræ”¯æŒreset,é…åˆoverrideåŠŸèƒ½ä½¿ç”¨ server.reset(url); &#125; &#125;&#125; createServeråˆ›å»ºæœåŠ¡,å¼€å¯å¿ƒè·³æ£€æµ‹ï¼Œé»˜è®¤ä½¿ç”¨nettyã€‚ç»„è£…url 1234567891011121314151617181920212223242526private ExchangeServer createServer(URL url) &#123; //é»˜è®¤å¼€å¯serverå…³é—­æ—¶å‘é€readonlyäº‹ä»¶ url = url.addParameterIfAbsent(Constants.CHANNEL_READONLYEVENT_SENT_KEY, Boolean.TRUE.toString()); //é»˜è®¤å¼€å¯heartbeat url = url.addParameterIfAbsent(Constants.HEARTBEAT_KEY, String.valueOf(Constants.DEFAULT_HEARTBEAT)); String str = url.getParameter(Constants.SERVER_KEY, Constants.DEFAULT_REMOTING_SERVER); if (str != null &amp;&amp; str.length() &gt; 0 &amp;&amp; ! ExtensionLoader.getExtensionLoader(Transporter.class).hasExtension(str)) throw new RpcException("Unsupported server type: " + str + ", url: " + url); url = url.addParameter(Constants.CODEC_KEY, Version.isCompatibleVersion() ? COMPATIBLE_CODEC_NAME : DubboCodec.NAME); ExchangeServer server; try &#123; server = Exchangers.bind(url, requestHandler); &#125; catch (RemotingException e) &#123; throw new RpcException("Fail to start server(url: " + url + ") " + e.getMessage(), e); &#125; str = url.getParameter(Constants.CLIENT_KEY); if (str != null &amp;&amp; str.length() &gt; 0) &#123; Set&lt;String&gt; supportedTypes = ExtensionLoader.getExtensionLoader(Transporter.class).getSupportedExtensions(); if (!supportedTypes.contains(str)) &#123; throw new RpcException("Unsupported client type: " + str); &#125; &#125; return server;&#125; Exchangers.bind12345678910public static ExchangeServer bind(URL url, ExchangeHandler handler) throws RemotingException &#123; if (url == null) &#123; throw new IllegalArgumentException("url == null"); &#125; if (handler == null) &#123; throw new IllegalArgumentException("handler == null"); &#125; url = url.addParameterIfAbsent(Constants.CODEC_KEY, "exchange"); return getExchanger(url).bind(url, handler);&#125; é€šè¿‡ExtensionLoaderèŽ·å¾—æŒ‡å®šçš„æ‰©å±•ç‚¹ï¼Œtypeé»˜è®¤ä¸ºheader 123456789public static Exchanger getExchanger(URL url) &#123; //urlä¸­èŽ·å¾—exchanger, é»˜è®¤ä¸ºheader String type = url.getParameter(Constants.EXCHANGER_KEY, Constants.DEFAULT_EXCHANGER); return getExchanger(type);&#125;public static Exchanger getExchanger(String type) &#123; return ExtensionLoader.getExtensionLoader(Exchanger.class).getExtension(type);&#125; HeaderExchanger.bindè°ƒç”¨headerExchangerçš„bindæ–¹æ³• 123public ExchangeServer bind(URL url, ExchangeHandler handler) throws RemotingException &#123; return new HeaderExchangeServer(Transporters.bind(url, new DecodeHandler(new HeaderExchangeHandler(handler))));&#125; é€šè¿‡transporter.bindæ¥è¿›è¡Œç»‘å®šã€‚ 123456789101112131415public static Server bind(URL url, ChannelHandler... handlers) throws RemotingException &#123; if (url == null) &#123; throw new IllegalArgumentException("url == null"); &#125; if (handlers == null || handlers.length == 0) &#123; throw new IllegalArgumentException("handlers == null"); &#125; ChannelHandler handler; if (handlers.length == 1) &#123; handler = handlers[0]; &#125; else &#123; handler = new ChannelHandlerDispatcher(handlers); &#125; return getTransporter().bind(url, handler);&#125; NettyTransport.bindé€šè¿‡NettyTranportåˆ›å»ºåŸºäºŽNettyçš„serveræœåŠ¡ 123public Server bind(URL url, ChannelHandler listener) throws RemotingException &#123; return new NettyServer(url, listener);&#125; new HeaderExchangeServeråœ¨è°ƒç”¨HeaderExchanger.bindæ–¹æ³•çš„æ—¶å€™ï¼Œæ˜¯å…ˆnewä¸€ä¸ªHeaderExchangeServer. è¿™ä¸ªserveræ˜¯å¹²å˜›å‘¢ï¼Ÿ æ˜¯å¯¹å½“å‰è¿™ä¸ªè¿žæŽ¥åŽ»å»ºç«‹å¿ƒè·³æœºåˆ¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class HeaderExchangeServer implements ExchangeServer &#123; private final ScheduledExecutorService scheduled = Executors. newScheduledThreadPool(1,new NamedThreadFactory( "dubbo-remoting-server-heartbeat", true)); // å¿ƒè·³å®šæ—¶å™¨ private ScheduledFuture&lt;?&gt; heatbeatTimer; // å¿ƒè·³è¶…æ—¶ï¼Œæ¯«ç§’ã€‚ç¼ºçœ0ï¼Œä¸ä¼šæ‰§è¡Œå¿ƒè·³ã€‚ private int heartbeat; private int heartbeatTimeout; private final Server server; private volatile boolean closed = false; public HeaderExchangeServer(Server server) &#123; //..å±žæ€§èµ‹å€¼ //å¿ƒè·³ startHeatbeatTimer(); &#125; private void startHeatbeatTimer() &#123; //å…³é—­å¿ƒè·³å®šæ—¶ stopHeartbeatTimer(); if (heartbeat &gt; 0) &#123; //æ¯éš”heartbeatæ—¶é—´æ‰§è¡Œä¸€æ¬¡ heatbeatTimer = scheduled.scheduleWithFixedDelay( new HeartBeatTask( new HeartBeatTask.ChannelProvider() &#123; //èŽ·å–channels public Collection&lt;Channel&gt; getChannels() &#123; return Collections.unmodifiableCollection( HeaderExchangeServer.this.getChannels() ); &#125; &#125;, heartbeat, heartbeatTimeout), heartbeat, heartbeat,TimeUnit.MILLISECONDS); &#125; &#125; //å…³é—­å¿ƒè·³å®šæ—¶ private void stopHeartbeatTimer() &#123; try &#123; ScheduledFuture&lt;?&gt; timer = heatbeatTimer; if (timer != null &amp;&amp; ! timer.isCancelled()) &#123; timer.cancel(true); &#125; &#125; catch (Throwable t) &#123; logger.warn(t.getMessage(), t); &#125; finally &#123; heatbeatTimer =null; &#125; &#125; æœåŠ¡æ³¨å†Œçš„è¿‡ç¨‹å‰é¢ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒåŸºäºŽspringè¿™ä¸ªè§£æžå…¥å£ï¼Œåˆ°å‘å¸ƒæœåŠ¡çš„è¿‡ç¨‹ï¼ŒæŽ¥ç€åŸºäºŽDubboProtocolåŽ»å‘å¸ƒï¼Œæœ€ç»ˆè°ƒç”¨Nettyçš„apiåˆ›å»ºäº†ä¸€ä¸ªNettyServerã€‚ é‚£ä¹ˆç»§ç»­æ²¿ç€RegistryProtocol.exportè¿™ä¸ªæ–¹æ³•ï¼Œæ¥çœ‹çœ‹æ³¨å†ŒæœåŠ¡çš„ä»£ç  RegistryProtocol.export1234567891011121314151617181920212223242526272829303132333435363738public &lt;T&gt; Exporter&lt;T&gt; export(final Invoker&lt;T&gt; originInvoker) throws RpcException &#123; //export invokeré€šè¿‡DubboProtocalå‘å¸ƒæœ¬åœ°æœåŠ¡ final ExporterChangeableWrapper&lt;T&gt; exporter = doLocalExport(originInvoker); //registry provider è¿™ä¸ªæ–¹æ³•æ˜¯invokerçš„åœ°å€èŽ·å–registryå®žä¾‹ final Registry registry = getRegistry(originInvoker); final URL registedProviderUrl = getRegistedProviderUrl(originInvoker); registry.register(registedProviderUrl); // è®¢é˜…overrideæ•°æ® // FIXME æä¾›è€…è®¢é˜…æ—¶ï¼Œä¼šå½±å“åŒä¸€JVMå³æš´éœ²æœåŠ¡ï¼Œåˆå¼•ç”¨åŒä¸€æœåŠ¡çš„çš„åœºæ™¯ï¼Œå› ä¸ºsubscribedä»¥æœåŠ¡åä¸ºç¼“å­˜çš„keyï¼Œå¯¼è‡´è®¢é˜…ä¿¡æ¯è¦†ç›–ã€‚ final URL overrideSubscribeUrl = getSubscribedOverrideUrl(registedProviderUrl); final OverrideListener overrideSubscribeListener = new OverrideListener(overrideSubscribeUrl); overrideListeners.put(overrideSubscribeUrl, overrideSubscribeListener); registry.subscribe(overrideSubscribeUrl, overrideSubscribeListener); //ä¿è¯æ¯æ¬¡exportéƒ½è¿”å›žä¸€ä¸ªæ–°çš„exporterå®žä¾‹ return new Exporter&lt;T&gt;() &#123; public Invoker&lt;T&gt; getInvoker() &#123; return exporter.getInvoker(); &#125; public void unexport() &#123; try &#123; exporter.unexport(); &#125; catch (Throwable t) &#123; logger.warn(t.getMessage(), t); &#125; try &#123; registry.unregister(registedProviderUrl); &#125; catch (Throwable t) &#123; logger.warn(t.getMessage(), t); &#125; try &#123; overrideListeners.remove(overrideSubscribeUrl); registry.unsubscribe(overrideSubscribeUrl, overrideSubscribeListener); &#125; catch (Throwable t) &#123; logger.warn(t.getMessage(), t); &#125; &#125; &#125;;&#125; getRegistryè¿™ä¸ªæ–¹æ³•æ˜¯invokerçš„åœ°å€èŽ·å–registryå®žä¾‹ registry://192.168.11.156ï¼š2181çš„åè®®åœ°å€ , registryUrlå°±ä¼šå˜æˆäº†zookeeper://192.168.11.156 12345678910111213141516/** * æ ¹æ®invokerçš„åœ°å€èŽ·å–registryå®žä¾‹ * @param originInvoker * @return */private Registry getRegistry(final Invoker&lt;?&gt; originInvoker)&#123; URL registryUrl = originInvoker.getUrl(); //èŽ·å¾—registry://192.168.11.156ï¼š2181çš„åè®®åœ°å€ if (Constants.REGISTRY_PROTOCOL.equals(registryUrl.getProtocol())) &#123;//å¾—åˆ°zookeeperçš„åè®®åœ°å€ String protocol = registryUrl.getParameter(Constants.REGISTRY_KEY, Constants.DEFAULT_DIRECTORY); //registryUrlå°±ä¼šå˜æˆäº†zookeeper://192.168.11.156registryUrl = registryUrl.setProtocol(protocol).removeParameter(Constants.REGISTRY_KEY); &#125;//registryFactoryæ˜¯ä»€ä¹ˆï¼Ÿ return registryFactory.getRegistry(registryUrl);&#125; registryFactory.getRegistryè¿™æ®µä»£ç å¾ˆæ˜Žæ˜¾äº†ï¼Œé€šè¿‡å‰é¢è¿™æ®µä»£ç çš„åˆ†æžï¼Œå…¶å®žå°±æ˜¯æŠŠregistryçš„åè®®å¤´æ”¹æˆæœåŠ¡æä¾›è€…é…ç½®çš„åè®®åœ°å€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é…ç½®çš„ ç„¶åŽregistryFactory.getRegistryçš„ç›®çš„ï¼Œå°±æ˜¯é€šè¿‡åè®®åœ°å€åŒ¹é…åˆ°å¯¹åº”çš„æ³¨å†Œä¸­å¿ƒã€‚é‚£registryFactoryæ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„å¯¹è±¡å‘¢ï¼Ÿï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸‹è¿™ä¸ªä»£ç çš„å®šä¹‰ 12345private RegistryFactory registryFactory;public void setRegistryFactory(RegistryFactory registryFactory) &#123; this.registryFactory = registryFactory;&#125; è¿™ä¸ªä»£ç æœ‰ç‚¹çœ¼ç†Ÿï¼Œå†æ¥çœ‹çœ‹RegistryFactoryè¿™ä¸ªç±»çš„å®šä¹‰ï¼Œæˆ‘çŒœæƒ³ä¸€å®šæ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œä¸ä¿¡ï¼Œå’±ä»¬çœ‹ å¹¶ä¸”ï¼Œå¤§å®¶è¿˜è¦æ³¨æ„è¿™é‡Œé¢çš„ä¸€ä¸ªæ–¹æ³•ä¸Šï¼Œæœ‰ä¸€ä¸ª@Adaptiveçš„æ³¨è§£ï¼Œè¯´æ˜Žä»€ä¹ˆï¼Ÿ è¿™ä¸ªæ˜¯ä¸€ä¸ªè‡ªé€‚åº”æ‰©å±•ç‚¹ã€‚æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çœ‹è¿‡ä»£ç ï¼Œè‡ªé€‚åº”æ‰©å±•ç‚¹åŠ åœ¨æ–¹æ³• å±‚é¢ä¸Šï¼Œè¡¨ç¤ºä¼šåŠ¨æ€ç”Ÿæˆä¸€ä¸ªè‡ªé€‚åº”çš„é€‚é…å™¨ã€‚æ‰€ä»¥è¿™ä¸ªè‡ªé€‚åº”é€‚é…å™¨åº”è¯¥æ˜¯RegistryFactory$Adaptive 12345@SPI("dubbo")public interface RegistryFactory &#123; @Adaptive(&#123;"protocol"&#125;) Registry getRegistry(URL url);&#125; 123456789101112131415public class RegistryFactory$Adaptive implements com.alibaba.dubbo.registry.RegistryFactory &#123; public com.alibaba.dubbo.registry.Registry getRegistry(com.alibaba.dubbo.common.URL arg0) &#123; if (arg0 == null) throw new IllegalArgumentException("url == null"); com.alibaba.dubbo.common.URL url = arg0; String extName = (url.getProtocol() == null ? "dubbo" : url.getProtocol()); if (extName == null) throw new IllegalStateException("Fail to get extension(com.alibaba.dubbo.registry.RegistryFactory) " + "name from url(" + url.toString() + ") use keys([protocol])"); com.alibaba.dubbo.registry.RegistryFactory extension = (com.alibaba.dubbo.registry.RegistryFactory) ExtensionLoader.getExtensionLoader(com.alibaba.dubbo.registry.RegistryFactory.class). getExtension(extName); return extension.getRegistry(arg0); &#125;&#125; ZookeeperRegistryFactoryè¿™ä¸ªæ–¹æ³•ä¸­å¹¶æ²¡æœ‰getRegistryæ–¹æ³•ï¼Œè€Œæ˜¯åœ¨çˆ¶ç±»AbstractRegistryFactory ä»Žç¼“å­˜REGISTRIESä¸­ï¼Œæ ¹æ®keyèŽ·å¾—å¯¹åº”çš„Registry å¦‚æžœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºRegistry 1234567891011121314151617181920212223public Registry getRegistry(URL url) &#123; url = url.setPath(RegistryService.class.getName()) .addParameter(Constants.INTERFACE_KEY, RegistryService.class.getName()) .removeParameters(Constants.EXPORT_KEY, Constants.REFER_KEY); String key = url.toServiceString(); // é”å®šæ³¨å†Œä¸­å¿ƒèŽ·å–è¿‡ç¨‹ï¼Œä¿è¯æ³¨å†Œä¸­å¿ƒå•ä¸€å®žä¾‹ LOCK.lock(); try &#123; Registry registry = REGISTRIES.get(key); if (registry != null) &#123; return registry; &#125; registry = createRegistry(url); if (registry == null) &#123; throw new IllegalStateException("Can not create registry " + url); &#125; REGISTRIES.put(key, registry); return registry; &#125; finally &#123; // é‡Šæ”¾é” LOCK.unlock(); &#125;&#125; createRegistryåˆ›å»ºä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“çš„å®žçŽ°åœ¨å¯¹åº”çš„å­ç±»å®žä¾‹ä¸­å®žçŽ°çš„ï¼Œåœ¨ZookeeperRegistryFactoryä¸­ 123456789101112131415161718192021222324252627public Registry createRegistry(URL url) &#123; return new ZookeeperRegistry(url, zookeeperTransporter);&#125;//é€šè¿‡zkClientï¼ŒèŽ·å¾—ä¸€ä¸ªzookeeperçš„è¿žæŽ¥å®žä¾‹public ZookeeperRegistry(URL url, ZookeeperTransporter zookeeperTransporter) &#123; super(url); if (url.isAnyHost()) &#123; throw new IllegalStateException("registry address == null"); &#125; String group = url.getParameter(Constants.GROUP_KEY, DEFAULT_ROOT); if (! group.startsWith(Constants.PATH_SEPARATOR)) &#123; group = Constants.PATH_SEPARATOR + group; &#125; this.root = group; //è®¾ç½®æ ¹èŠ‚ç‚¹ zkClient = zookeeperTransporter.connect(url);//å»ºç«‹è¿žæŽ¥ zkClient.addStateListener(new StateListener() &#123; public void stateChanged(int state) &#123; if (state == RECONNECTED) &#123; try &#123; recover(); &#125; catch (Exception e) &#123; logger.error(e.getMessage(), e); &#125; &#125;);&#125; ä»£ç åˆ†æžåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹äºŽgetRegistryå¾—å‡ºäº†ä¸€ä¸ªç»“è®ºï¼Œæ ¹æ®å½“å‰æ³¨å†Œä¸­å¿ƒçš„é…ç½®ä¿¡æ¯ï¼ŒèŽ·å¾—ä¸€ä¸ªåŒ¹é…çš„æ³¨å†Œä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯ZookeeperRegistry registry.register(registedProviderUrl);ZookeeperRegistry extends FailbackRegistry ç»§ç»­å¾€ä¸‹åˆ†æžï¼Œä¼šè°ƒç”¨registry.registeråŽ»å°†dubbo://çš„åè®®åœ°å€æ³¨å†Œåˆ°zookeeperä¸Š è¿™ä¸ªæ–¹æ³•ä¼šè°ƒç”¨FailbackRegistryç±»ä¸­çš„register. ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºZookeeperRegistryè¿™ä¸ªç±»ä¸­å¹¶æ²¡æœ‰registerè¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä»–çš„çˆ¶ç±»FailbackRegistryä¸­å­˜åœ¨registeræ–¹æ³•ï¼Œè€Œè¿™ä¸ªç±»åˆé‡å†™äº†AbstractRegistryç±»ä¸­çš„registeræ–¹æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æŽ¥å®šä½FailbackRegistryè¿™ä¸ªç±»ä¸­çš„registeræ–¹æ³•ä¸­ FailbackRegistry.register FailbackRegistryï¼Œä»Žåå­—ä¸Šæ¥çœ‹ï¼Œæ˜¯ä¸€ä¸ªå¤±è´¥é‡è¯•æœºåˆ¶ è°ƒç”¨çˆ¶ç±»çš„registeræ–¹æ³•ï¼Œè®²å½“å‰urlæ·»åŠ åˆ°ç¼“å­˜é›†åˆä¸­ è°ƒç”¨doRegisteræ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¾ˆæ˜Žæ˜¾ï¼Œæ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä¼šç”±ZookeeperRegistryå­ç±»å®žçŽ°ã€‚ 12345678910111213141516171819202122232425262728@Overridepublic void register(URL url) &#123; super.register(url); failedRegistered.remove(url); failedUnregistered.remove(url); try &#123; // å‘æœåŠ¡å™¨ç«¯å‘é€æ³¨å†Œè¯·æ±‚ doRegister(url); &#125; catch (Exception e) &#123; Throwable t = e; // å¦‚æžœå¼€å¯äº†å¯åŠ¨æ—¶æ£€æµ‹ï¼Œåˆ™ç›´æŽ¥æŠ›å‡ºå¼‚å¸¸ boolean check = getUrl().getParameter(Constants.CHECK_KEY, true) &amp;&amp; url.getParameter(Constants.CHECK_KEY, true) &amp;&amp; ! Constants.CONSUMER_PROTOCOL.equals(url.getProtocol()); boolean skipFailback = t instanceof SkipFailbackWrapperException; if (check || skipFailback) &#123; if(skipFailback) &#123; t = t.getCause(); &#125; throw new IllegalStateException("Failed to register " + url + " to registry " + getUrl().getAddress() + ", cause: " + t.getMessage(), t); &#125; else &#123; logger.error("Failed to register " + url + ", waiting for retry, cause: " + t.getMessage(), t); &#125; // å°†å¤±è´¥çš„æ³¨å†Œè¯·æ±‚è®°å½•åˆ°å¤±è´¥åˆ—è¡¨ï¼Œå®šæ—¶é‡è¯• failedRegistered.add(url); &#125;&#125; 1234567protected void doRegister(URL url) &#123; try &#123; zkClient.create(toUrlPath(url), url.getParameter(Constants.DYNAMIC_KEY, true)); &#125; catch (Throwable e) &#123; throw new RpcException("Failed to register " + url + " to zookeeper " + getUrl() + ", cause: " + e.getMessage(), e); &#125;&#125; RegistryProtocol.export è¿™ä¸ªæ–¹æ³•ä¸­åŽç»­çš„ä»£ç å°±ä¸ç”¨å†åˆ†æžäº†ã€‚å°±æ˜¯åŽ»å¯¹æœåŠ¡æä¾›ç«¯åŽ»æ³¨å†Œä¸€ä¸ªzookeeperç›‘å¬ï¼Œå½“ç›‘å¬å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯åšç›¸åº”çš„å¤„ç†ã€‚ æ¶ˆè´¹ç«¯å¯åŠ¨åˆå§‹åŒ–è¿‡ç¨‹æ¶ˆè´¹ç«¯çš„ä»£ç è§£æžæ˜¯ä»Žä¸‹é¢è¿™æ®µä»£ç å¼€å§‹çš„ 1ReferenceBean(afterPropertiesSet) -&gt;getObject() -&gt;get()-&gt;init()-&gt;createProxy æœ€ç»ˆä¼šèŽ·å¾—ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚ createProxyç¬¬375è¡Œå‰é¢å¾ˆå¤šä»£ç éƒ½æ˜¯åˆå§‹åŒ–çš„åŠ¨ä½œï¼Œéœ€è¦ä»”ç»†åˆ†æžçš„ä»£ç ä»£ç ä»ŽcreateProxyç¬¬375è¡Œå¼€å§‹ 1234567891011121314151617181920212223242526272829303132List&lt;URL&gt; us = loadRegistries(false); //ä»Žæ³¨å†Œä¸­å¿ƒä¸ŠèŽ·å¾—ç›¸åº”çš„åè®®urlåœ°å€if (us != null &amp;&amp; us.size() &gt; 0) &#123; for (URL u : us) &#123; URL monitorUrl = loadMonitor(u); if (monitorUrl != null) &#123; map.put(Constants.MONITOR_KEY, URL.encode(monitorUrl.toFullString())); &#125; urls.add(u.addParameterAndEncoded(Constants.REFER_KEY, StringUtils.toQueryString(map))); &#125;&#125;if (urls == null || urls.size() == 0) &#123; throw new IllegalStateException("No such any registry to reference " + interfaceName + " on the consumer " + NetUtils.getLocalHost() + " use dubbo version " + Version.getVersion() + ", please config &lt;dubbo:registry address=\"...\" /&gt; to your spring config."); &#125;if (urls.size() == 1) &#123; invoker = refprotocol.refer(interfaceClass, urls.get(0)); //èŽ·å¾—invokerä»£ç†å¯¹è±¡&#125; else &#123; List&lt;Invoker&lt;?&gt;&gt; invokers = new ArrayList&lt;Invoker&lt;?&gt;&gt;(); URL registryURL = null; for (URL url : urls) &#123; invokers.add(refprotocol.refer(interfaceClass, url)); if (Constants.REGISTRY_PROTOCOL.equals(url.getProtocol())) &#123; registryURL = url; // ç”¨äº†æœ€åŽä¸€ä¸ªregistry url &#125; &#125; if (registryURL != null) &#123; // æœ‰ æ³¨å†Œä¸­å¿ƒåè®®çš„URL // å¯¹æœ‰æ³¨å†Œä¸­å¿ƒçš„Cluster åªç”¨ AvailableCluster URL u = registryURL.addParameter(Constants.CLUSTER_KEY, AvailableCluster.NAME); invoker = cluster.join(new StaticDirectory(u, invokers)); &#125; else &#123; // ä¸æ˜¯ æ³¨å†Œä¸­å¿ƒçš„URL invoker = cluster.join(new StaticDirectory(invokers)); &#125;&#125; refprotocol.referâ€‹ invokers.add(refprotocol.refer(interfaceClass, url)); è°ƒç”¨protocolçš„referæ–¹æ³•ï¼Œå¾—åˆ°invokerï¼Œ ä¼ é€’è¿›æ¥çš„å‚æ•°urlï¼Œåè®®åœ°å€ä¸ºregistry://ã€‚ refprotocolè¿™ä¸ªå¯¹è±¡ï¼Œå®šä¹‰çš„ä»£ç å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªè‡ªé€‚åº”æ‰©å±•ç‚¹ï¼Œå¾—åˆ°çš„æ˜¯Protocol$Adaptive ReferenceConfigä¸­refprotocolçš„å®šä¹‰å¦‚ä¸‹ 1private static final Protocol refprotocol = ExtensionLoader.getExtensionLoader(Protocol.class).getAdaptiveExtension(); æ‰€ä»¥æœ€ç»ˆè°ƒç”¨RegistryProtocol.referä»£ç  RegistryProtocol.referè¿™ä¸ªæ–¹æ³•é‡Œé¢çš„ä»£ç ï¼ŒåŸºæœ¬ä¸Šéƒ½èƒ½çœ‹æ‡‚1.æ ¹æ®æ ¹æ®urlèŽ·å¾—æ³¨å†Œä¸­å¿ƒï¼Œè¿™ä¸ªregistryæ˜¯zookeeperRegistry2.è°ƒç”¨doReferï¼ŒæŒ‰æ–¹æ³•ï¼Œä¼ é€’äº†å‡ ä¸ªå‚æ•°ï¼Œ å…¶ä¸­æœ‰ä¸€ä¸ªculsterå‚æ•°ï¼Œè¿™ä¸ªéœ€è¦æ³¨æ„ä¸‹ 123456789101112131415161718192021222324252627282930313233public &lt;T&gt; Invoker&lt;T&gt; refer(Class&lt;T&gt; type, URL url) throws RpcException &#123; url = url.setProtocol(url.getParameter(Constants.REGISTRY_KEY, Constants.DEFAULT_REGISTRY)).removeParameter(Constants.REGISTRY_KEY); Registry registry = registryFactory.getRegistry(url); if (RegistryService.class.equals(type)) &#123; return proxyFactory.getInvoker((T) registry, type, url); &#125; // group="a,b" or group="*" Map&lt;String, String&gt; qs = StringUtils.parseQueryString(url.getParameterAndDecoded(Constants.REFER_KEY)); String group = qs.get(Constants.GROUP_KEY); if (group != null &amp;&amp; group.length() &gt; 0 ) &#123; if ( ( Constants.COMMA_SPLIT_PATTERN.split( group ) ).length &gt; 1 || "*".equals( group ) ) &#123; return doRefer( getMergeableCluster(), registry, type, url ); &#125; &#125; return doRefer(cluster, registry, type, url); &#125; clusterdoReferæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªå‚æ•°æ˜¯cluster,æˆ‘ä»¬æ‰¾åˆ°å®ƒçš„å®šä¹‰ä»£ç å¦‚ä¸‹ï¼Œã€‚åˆæ˜¯ä¸€ä¸ªè‡ªåŠ¨æ³¨å…¥çš„æ‰©å±•ç‚¹ã€‚ 12345private Cluster cluster;public void setCluster(Cluster cluster) &#123; this.cluster = cluster;&#125; ä»Žä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œè€Œä¸”æ–¹æ³•å±‚é¢ä¸Šï¼Œè¿˜æœ‰ä¸€ä¸ª@Adaptiveï¼Œè¡¨ç¤ºä¼šåŠ¨æ€ç”Ÿæˆä¸€ä¸ªè‡ªé€‚åº”é€‚é…å™¨Cluster$Adaptive 1234567@SPI(FailoverCluster.NAME)public interface Cluster &#123; @Adaptive &lt;T&gt; Invoker&lt;T&gt; join(Directory&lt;T&gt; directory) throws RpcException;&#125; Cluster$Adaptiveé€šè¿‡debugçš„æ–¹å¼ï¼Œï¼ŒèŽ·å–åˆ°Cluster$Adaptiveè¿™ä¸ªé€‚é…å™¨ï¼Œä»£ç å¦‚ä¸‹ã€‚æˆ‘ä»¬çŸ¥é“clusterè¿™ä¸ªå¯¹è±¡çš„å®žä¾‹ä»¥åŽï¼Œç»§ç»­çœ‹doReferæ–¹æ³•ï¼›æ³¨æ„ï¼šè¿™é‡Œçš„Cluster$Adaptiveä¹Ÿå¹¶ä¸å•çº¯ï¼Œå¤§å®¶è¿˜è®°å¾—åœ¨è®²æ‰©å±•ç‚¹çš„æ—¶å€™æœ‰ä¸€ä¸ªæ‰©å±•ç‚¹è£…é¥°å™¨å—ï¼Ÿå¦‚æžœè¿™ä¸ªæ‰©å±•ç‚¹å­˜åœ¨ä¸€ä¸ªæž„é€ å‡½æ•°ï¼Œå¹¶ä¸”æž„é€ å‡½æ•°å°±æ˜¯æ‰©å±•æŽ¥å£æœ¬èº«ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‰©å±•ç‚¹å°±ä¼šè¿™ä¸ªwrapperè£…é¥°ï¼Œè€ŒClusterè¢«è£…é¥°çš„æ˜¯ï¼šMockClusterWrapper 123456789101112131415public class Cluster$Adaptive implements com.alibaba.dubbo.rpc.cluster.Cluster &#123; public Invoker join(Directory arg0) throws RpcException &#123; if (arg0 == null) throw new IllegalArgumentException("com.alibaba.dubbo.rpc.cluster.Directory argument == null"); if (arg0.getUrl() == null) throw new IllegalArgumentException("com.alibaba.dubbo.rpc.cluster.Directory argument getUrl() == null"); com.alibaba.dubbo.common.URL url = arg0.getUrl(); String extName = url.getParameter("cluster", "failover"); if (extName == null) throw new IllegalStateException("Fail to get extension(com.alibaba.dubbo.rpc.cluster.Cluster) name from url(" + url.toString() + ") use keys([cluster])"); com.alibaba.dubbo.rpc.cluster.Cluster extension = (com.alibaba.dubbo.rpc.cluster.Cluster) ExtensionLoader.getExtensionLoader(com.alibaba.dubbo.rpc.cluster.Cluster.class).getExtension(extName); return extension.join(arg0); &#125;&#125; RegistryProtocol.doReferè¿™æ®µä»£ç ä¸­ï¼Œæœ‰ä¸€ä¸ªRegistryDirectory,å¯èƒ½çœ‹ä¸æ‡‚ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆå¿½ç•¥ï¼Œç­‰ä¼šå•ç‹¬è®².ï¼ˆåŸºäºŽæ³¨å†Œä¸­å¿ƒåŠ¨æ€å‘çŽ°æœåŠ¡æä¾›è€…ï¼‰ å°†consumer://åè®®åœ°å€æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ registryDirectoryçš„subscribeæ–¹æ³•ï¼Œè®¢é˜…zookeeperåœ°å€çš„å˜åŒ– è°ƒç”¨cluster.join()æ–¹æ³• 12345678910111213141516171819private &lt;T&gt; Invoker&lt;T&gt; doRefer(Cluster cluster, Registry registry, Class&lt;T&gt; type, URL url) &#123; RegistryDirectory&lt;T&gt; directory = new RegistryDirectory&lt;T&gt;(type, url); directory.setRegistry(registry); directory.setProtocol(protocol); URL subscribeUrl = new URL(Constants.CONSUMER_PROTOCOL, NetUtils.getLocalHost(), 0, type.getName(), directory.getUrl().getParameters()); if (! Constants.ANY_VALUE.equals(url.getServiceInterface()) &amp;&amp; url.getParameter(Constants.REGISTER_KEY, true)) &#123;// å°†consumer://åè®®åœ°å€æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ registry.register(subscribeUrl.addParameters(Constants.CATEGORY_KEY, Constants.CONSUMERS_CATEGORY, Constants.CHECK_KEY, String.valueOf(false))); &#125; //é€šè¿‡registryDirectoryçš„subscribeï¼Œ directory.subscribe(subscribeUrl.addParameter(Constants.CATEGORY_KEY, Constants.PROVIDERS_CATEGORY + "," + Constants.CONFIGURATORS_CATEGORY + "," + Constants.ROUTERS_CATEGORY)); return cluster.join(directory);&#125; cluster.joinç”±å‰é¢çš„Cluster$Adaptiveè¿™ä¸ªç±»ä¸­çš„joinæ–¹æ³•çš„åˆ†æžï¼Œå¾—çŸ¥cluster.joinä¼šè°ƒç”¨MockClusterWrapper.joinæ–¹æ³•ï¼Œ ç„¶åŽå†è°ƒç”¨FailoverCluster.joinæ–¹æ³•ã€‚ MockClusterWrapper.joinè¿™ä¸ªæ„æ€å¾ˆæ˜Žæ˜¾äº†ã€‚ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸ŠèŠ‚è¯¾è®²è¿‡çš„mockå®¹é”™æœºåˆ¶ï¼Œå¦‚æžœå‡ºçŽ°å¼‚å¸¸æƒ…å†µï¼Œä¼šè°ƒç”¨MockClusterInvokerï¼Œå¦åˆ™ï¼Œè°ƒç”¨FailoverClusterInvoker. 12345678910111213public class MockClusterWrapper implements Cluster &#123; private Cluster cluster; public MockClusterWrapper(Cluster cluster) &#123; this.cluster = cluster; &#125; public &lt;T&gt; Invoker&lt;T&gt; join(Directory&lt;T&gt; directory) throws RpcException &#123; return new MockClusterInvoker&lt;T&gt;(directory, this.cluster.join(directory)); &#125;&#125; å°ç»“refprotocol.refï¼Œè¿™ä¸ªæ–¹æ³•ï¼Œä¼šè¿”å›žä¸€ä¸ªMockClusterInvoker(FailoverClusterInvoker)ã€‚è¿™é‡Œé¢ä¸€å®šè¿˜æœ‰ç–‘é—®ï¼Œæˆ‘ä»¬å…ˆæŠŠä¸»çº¿èµ°å®Œï¼Œå†å›žè¿‡å¤´çœ‹çœ‹ä»€ä¹ˆæ˜¯clusterã€ä»€ä¹ˆæ˜¯directory proxyFactory.getProxy(invoker);å†å›žåˆ°ReferenceConfigè¿™ä¸ªç±»ï¼Œåœ¨createProxyæ–¹æ³•çš„æœ€åŽä¸€è¡Œï¼Œè°ƒç”¨proxyFactory.getProxy(invoker). æŠŠå‰é¢ç”Ÿæˆçš„invokerå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå†é€šè¿‡proxyFactoryå·¥åŽ‚åŽ»èŽ·å¾—ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æžä¸‹è¿™æ®µä»£ç åšäº†ä»€ä¹ˆã€‚ å…¶å®žå‰é¢åœ¨åˆ†æžæœåŠ¡å‘å¸ƒçš„æ—¶å€™ï¼ŒåŸºæœ¬åˆ†æžè¿‡äº†ï¼Œæ‰€ä»¥å†çœ‹è¿™æ®µä»£ç ï¼Œåº”è¯¥ä¼šå¾ˆç†Ÿæ‚‰ ProxyFactoryï¼Œ ä¼šç”Ÿæˆä¸€ä¸ªåŠ¨æ€çš„è‡ªé€‚åº”é€‚é…å™¨ã€‚ProxyFactory$Adaptiveï¼Œç„¶åŽè°ƒç”¨è¿™ä¸ªé€‚é…å™¨ä¸­çš„getProxyæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ 123ReferenceConfig// åˆ›å»ºæœåŠ¡ä»£ç† return (T) proxyFactory.getProxy(invoker); 12345678910public java.lang.Object getProxy(Invoker arg0) throws RpcException &#123; if (arg0 == null) throw new IllegalArgumentException("com.alibaba.dubbo.rpc.Invoker argument == null"); if (arg0.getUrl() == null) throw new IllegalArgumentException("com.alibaba.dubbo.rpc.Invoker argument getUrl() == null");com.alibaba.dubbo.common.URL url = arg0.getUrl(); String extName = url.getParameter("proxy", "javassist"); if(extName == null) throw new IllegalStateException("Fail to get extension(com.alibaba.dubbo.rpc.ProxyFactory) name from url(" + url.toString() + ") use keys([proxy])"); com.alibaba.dubbo.rpc.ProxyFactory extension = (com.alibaba.dubbo.rpc.ProxyFactory)ExtensionLoader.getExtensionLoader(com.alibaba.dubbo.rpc.ProxyFactory.class).getExtension(extName); return extension.getProxy(arg0); å¾ˆæ˜¾ç„¶ï¼Œåˆæ˜¯é€šè¿‡javassistå®žçŽ°çš„ä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹JavassistProxyFactory.getProxy JavassistProxyFactory.getProxyé€šè¿‡javasssiståŠ¨æ€å­—èŠ‚ç ç”ŸæˆåŠ¨æ€ä»£ç†ç±»ï¼Œ 123public &lt;T&gt; T getProxy(Invoker&lt;T&gt; invoker, Class&lt;?&gt;[] interfaces) &#123; return (T) Proxy.getProxy(interfaces).newInstance(new InvokerInvocationHandler(invoker));&#125; Proxy.getProxy(interfaces)åœ¨Proxy.getProxyè¿™ä¸ªç±»çš„å¦‚ä¸‹ä»£ç ä¸­æ·»åŠ æ–­ç‚¹ï¼Œåœ¨debugä¸‹å¯ä»¥çœ‹åˆ°åŠ¨æ€å­—èŠ‚ç å¦‚ä¸‹ 123456public java.lang.String sayHello(java.lang.String arg0)&#123; Object[] args = new Object[1]; args[0] = ($w)$1; Object ret = handler.invoke(this, methods[0], args);return (java.lang.String)ret;&#125; ä¸Šé¢ä»£ç çš„handlerï¼Œå°±æ˜¯åœ¨JavassistProxyFactory.getProxyä¸­ã€‚ä¼ é€’çš„new InvokerInvocationHandler(invoker) ä»€ä¹ˆæ—¶å€™å»ºç«‹å’ŒæœåŠ¡ç«¯çš„è¿žæŽ¥å‰é¢æˆ‘ä»¬é€šè¿‡ä»£ç åˆ†æžåˆ°äº†ï¼Œæ¶ˆè´¹ç«¯çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä½†æ˜¯ä¼¼ä¹Žæ²¡æœ‰çœ‹åˆ°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹NIOè¿žæŽ¥ã€‚å®žé™…ä¸Šï¼Œå»ºç«‹è¿žæŽ¥çš„è¿‡ç¨‹åœ¨æ¶ˆè´¹ç«¯åˆå§‹åŒ–çš„æ—¶å€™å°±å»ºç«‹å¥½çš„ï¼Œåªæ˜¯å‰é¢æˆ‘ä»¬æ²¡æœ‰åˆ†æžï¼Œä»£ç åœ¨RegistryProtocol.doReferæ–¹æ³•å†…çš„directory.subscribeæ–¹æ³•ä¸­ã€‚ 1234567891011121314151617181920212223private &lt;T&gt; Invoker&lt;T&gt; doRefer(Cluster cluster, Registry registry, Class&lt;T&gt; type, URL url) &#123; RegistryDirectory&lt;T&gt; directory = new RegistryDirectory&lt;T&gt;(type, url); directory.setRegistry(registry); directory.setProtocol(protocol); // consumer://192.*** URL subscribeUrl = new URL(Constants.CONSUMER_PROTOCOL, NetUtils.getLocalHost(), 0, type.getName(), directory.getUrl().getParameters()); if (! Constants.ANY_VALUE.equals(url.getServiceInterface()) &amp;&amp; url.getParameter(Constants.REGISTER_KEY, true)) &#123; // consumer://192.***æ³¨å†Œåˆ°zkæ³¨å†Œä¸­å¿ƒ registry.register(subscribeUrl.addParameters(Constants.CATEGORY_KEY, Constants.CONSUMERS_CATEGORY, Constants.CHECK_KEY, String.valueOf(false))); &#125; //registryDirectoryè®¢é˜…providerã€configuratorã€routerçš„ç›®å½•çš„å˜åŒ– directory.subscribe(subscribeUrl.addParameter(Constants.CATEGORY_KEY, Constants.PROVIDERS_CATEGORY + "," + Constants.CONFIGURATORS_CATEGORY + "," + Constants.ROUTERS_CATEGORY)); return cluster.join(directory);&#125; directory.subscribeRegistryProtocolçš„referæ–¹æ³•Invoker&lt;T&gt; refer(Class&lt;T&gt; type, URL url)ï¼Œä¼ å…¥çš„å‚æ•°urlä¸ºzookeeper://127.0.0.1:2181/com.alibaba.dubbo.registry.RegistryService?application=dubbo-client-demo è€ŒregistryFactoryæ˜¯RegistryFactory$Adaptiveï¼Œæ‰€ä»¥æ ¹æ®urlçš„protocolï¼Œå®žé™…è°ƒç”¨çš„æ˜¯ZookeeperRegistryFactoryçš„getRegistryæ–¹æ³•ï¼Œæœ€ç»ˆå¾—åˆ°ZookeeperRegsitryå®žä¾‹ã€‚ 12345678910111213141516171819202122//RegistryProtocol public &lt;T&gt; Invoker&lt;T&gt; refer(Class&lt;T&gt; type, URL url) throws RpcException &#123; url = url.setProtocol(url.getParameter(Constants.REGISTRY_KEY, Constants.DEFAULT_REGISTRY)).removeParameter(Constants.REGISTRY_KEY); //ZookeeperRegistyFactoryå¾—åˆ°ZookeeperRegistry Registry registry = registryFactory.getRegistry(url); if (RegistryService.class.equals(type)) &#123; return proxyFactory.getInvoker((T) registry, type, url); &#125; // group="a,b" or group="*" Map&lt;String, String&gt; qs = StringUtils.parseQueryString(url.getParameterAndDecoded(Constants.REFER_KEY)); String group = qs.get(Constants.GROUP_KEY); if (group != null &amp;&amp; group.length() &gt; 0 ) &#123; if ( ( Constants.COMMA_SPLIT_PATTERN.split( group ) ).length &gt; 1 || "*".equals( group ) ) &#123; return doRefer( getMergeableCluster(), registry, type, url ); &#125; &#125; return doRefer(cluster, registry, type, url); &#125; åœ¨RegistryProtocolçš„doReferæ–¹æ³•ä¸­ï¼Œdirectory.setResgitryä¸­å‚æ•°ä¸ºzookeeperRegistryã€‚ å› ä¸ºZookeeperRegistry extends FailbackRegistryï¼ŒFailbackRegistry extends AbstractRegistry æ‰€ä»¥registryDirectoryçš„è°ƒç”¨é“¾ä¸ºï¼š RegistryDirectory.subscribe -&gt;FailbackRegistry. subscribe-&gt;- AbstractRegistry.subscribe&gt;zookeeperRegistry.doSubscribe 123456//RegistryDirectorypublic void subscribe(URL url) &#123; setConsumerUrl(url); registry.subscribe(url, this);&#125; FailbackRegistry. subscribeè°ƒç”¨FailbackRegistry.subscribe è¿›è¡Œè®¢é˜…ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç‰¹æ®Šå¤„ç†ï¼Œå¦‚æžœè®¢é˜…å¤±è´¥ï¼Œåˆ™ä¼šæ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ä¸­è¿›è¡Œé‡è¯• 1234567@Overridepublic void subscribe(URL url, NotifyListener listener) &#123; super.subscribe(url, listener); removeFailedSubscribed(url, listener); try &#123; // å‘æœåŠ¡å™¨ç«¯å‘é€è®¢é˜…è¯·æ±‚ doSubscribe(url, listener); zookeeperRegistry. doSubscribeè°ƒç”¨zookeeperRegistryæ‰§è¡ŒçœŸæ­£çš„è®¢é˜…æ“ä½œï¼Œè¿™æ®µä»£ç å¤ªé•¿ï¼Œæˆ‘å°±ä¸è´´å‡ºæ¥äº†ï¼Œè¿™é‡Œé¢ä¸»è¦åšä¸¤ä¸ªæ“ä½œ å¯¹providers/routers/configuratorä¸‰ä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ›å»ºå’Œç›‘å¬ è°ƒç”¨notify(url,listener,urls) å°†å·²ç»å¯ç”¨çš„åˆ—è¡¨è¿›è¡Œé€šçŸ¥ AbstractRegistry.notify12345678910111213141516171819202122232425262728293031323334353637383940414243protected void notify(URL url, NotifyListener listener, List&lt;URL&gt; urls) &#123; if (url == null) &#123; throw new IllegalArgumentException("notify url == null"); &#125; if (listener == null) &#123; throw new IllegalArgumentException("notify listener == null"); &#125; if ((urls == null || urls.size() == 0) &amp;&amp; ! Constants.ANY_VALUE.equals(url.getServiceInterface())) &#123; logger.warn("Ignore empty notify urls for subscribe url " + url); return; &#125; if (logger.isInfoEnabled()) &#123; logger.info("Notify urls for subscribe url " + url + ", urls: " + urls); &#125; Map&lt;String, List&lt;URL&gt;&gt; result = new HashMap&lt;String, List&lt;URL&gt;&gt;(); for (URL u : urls) &#123; if (UrlUtils.isMatch(url, u)) &#123; String category = u.getParameter(Constants.CATEGORY_KEY, Constants.DEFAULT_CATEGORY); List&lt;URL&gt; categoryList = result.get(category); if (categoryList == null) &#123; categoryList = new ArrayList&lt;URL&gt;(); result.put(category, categoryList); &#125; categoryList.add(u); &#125; &#125; if (result.size() == 0) &#123; return; &#125; Map&lt;String, List&lt;URL&gt;&gt; categoryNotified = notified.get(url); if (categoryNotified == null) &#123; notified.putIfAbsent(url, new ConcurrentHashMap&lt;String, List&lt;URL&gt;&gt;()); categoryNotified = notified.get(url); &#125; for (Map.Entry&lt;String, List&lt;URL&gt;&gt; entry : result.entrySet()) &#123; String category = entry.getKey(); List&lt;URL&gt; categoryList = entry.getValue(); categoryNotified.put(category, categoryList); saveProperties(url); listener.notify(categoryList); &#125;&#125; æ€»ç»“æ¶ˆè´¹ç«¯åˆå§‹åŒ–è¿™å—å°±å®Œäº†]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Dubboæºç åˆ†æžä¹‹ExtensionLoaderåŠ¨æ€æ‰©å±•]]></title>
    <url>%2F2018%2F06%2F24%2FDubbo%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8BExtensionLoader%E5%8A%A8%E6%80%81%E6%89%A9%E5%B1%95%2F</url>
    <content type="text"><![CDATA[1. ç›¸å…³æ³¨è§£SPIå®šä¹‰ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œservice provider interface Adaptiveè‡ªé€‚åº”æ‰©å±•ç‚¹ï¼Œåœ¨{@link ExtensionLoader}ç”ŸæˆExtensionçš„Adaptive Instanceæ—¶ï¼Œä¸º{@link ExtensionLoader}æä¾›ä¿¡æ¯ã€‚ Activateè‡ªåŠ¨æ¿€æ´»åŠ è½½æ‰©å±•ç‚¹ åœ¨è¿™ä¸ªæºç ä¸­å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªæ³¨ è§£ï¼Œä¸€ä¸ªæ˜¯åœ¨ç±»çº§åˆ«ä¸Šçš„@SPI(â€œdubboâ€), å¦ä¸€ä¸ªæ˜¯ @Adaptive@SPI è¡¨ç¤ºå½“å‰è¿™ä¸ªæŽ¥å£æ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå¯ä»¥å®žçŽ°è‡ªå·±çš„ æ‰©å±•å®žçŽ°ï¼Œé»˜è®¤çš„æ‰©å±•ç‚¹æ˜¯ DubboProtocolã€‚@Adaptive è¡¨ç¤ºä¸€ä¸ªè‡ªé€‚åº”æ‰©å±•ç‚¹ï¼Œåœ¨æ–¹æ³•çº§åˆ«ä¸Šï¼Œä¼šåŠ¨æ€æ‹¼æŽ¥å­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªé€‚é…å™¨ç±»ã€‚åœ¨ç±»ä¸Šï¼Œåˆ™ä¸ä¼šã€‚ 123456789101112@SPI("dubbo")public interface Protocol &#123; int getDefaultPort(); @Adaptive &lt;T&gt; Exporter&lt;T&gt; export(Invoker&lt;T&gt; invoker) throws RpcException; @Adaptive &lt;T&gt; Invoker&lt;T&gt; refer(Class&lt;T&gt; type, URL url) throws RpcException; void destroy();&#125; 2. getAdaptiveExtensionèŽ·å–è‡ªé€‚åº”çš„æ‰©å±•ç‚¹æµç¨‹æ—¶åºå›¾å¦‚ä¸‹ï¼š getExtensionLoaderä¸å­˜åœ¨ï¼Œnewä¸€ä¸ª123456789 public static &lt;T&gt; ExtensionLoader&lt;T&gt; getExtensionLoader(Class&lt;T&gt; type) &#123;//å¼‚å¸¸nullå¤„ç†çœç•¥ã€‚ã€‚ã€‚ ExtensionLoader&lt;T&gt; loader = (ExtensionLoader&lt;T&gt;) EXTENSION_LOADERS.get(type); if (loader == null) &#123; EXTENSION_LOADERS.putIfAbsent(type, new ExtensionLoader&lt;T&gt;(type)); loader = (ExtensionLoader&lt;T&gt;) EXTENSION_LOADERS.get(type); &#125; return loader; &#125; 123456private ExtensionLoader(Class&lt;?&gt; type) &#123;//Protocol.class this.type = type; objectFactory = (type == ExtensionFactory.class ? null : ExtensionLoader.getExtensionLoader(ExtensionFactory.class). getAdaptiveExtension());&#125; getAdaptiveExtensionè¿™ä¸ªæ–¹æ³•é‡Œé¢ä¸»è¦åšå‡ ä¸ªäº‹æƒ…: ä»Ž cacheAdaptiveInstance è¿™ä¸ªå†…å­˜ç¼“å­˜ä¸­èŽ·å¾—ä¸€ä¸ªå¯¹è±¡å®žä¾‹ å¦‚æžœå®žä¾‹ä¸ºç©ºï¼Œè¯´æ˜Žæ˜¯ç¬¬ä¸€æ¬¡åŠ è½½ï¼Œåˆ™é€šè¿‡åŒé‡æ£€æŸ¥é”çš„æ–¹å¼åŽ»åˆ›å»ºä¸€ä¸ªé€‚é…å™¨æ‰©å±•ç‚¹123456789101112131415161718192021public T getAdaptiveExtension() &#123; Object instance = cachedAdaptiveInstance.get(); if (instance == null) &#123; if(createAdaptiveInstanceError == null) &#123; synchronized (cachedAdaptiveInstance) &#123; instance = cachedAdaptiveInstance.get(); if (instance == null) &#123; try &#123; instance = createAdaptiveExtension(); cachedAdaptiveInstance.set(instance); &#125; catch (Throwable t) &#123; createAdaptiveInstanceError = t; throw new IllegalStateException("fail to create adaptive instance: " + t.toString(), t); &#125; &#125; &#125; &#125; &#125; return (T) instance;&#125; createAdaptiveExtensionè¿™æ®µä»£ç é‡Œé¢æœ‰ä¸¤ä¸ªç»“æž„ï¼Œä¸€ä¸ªæ˜¯ injectExtension. å¦ä¸€ ä¸ªæ˜¯ getAdaptiveExtensionClass() 12345678private T createAdaptiveExtension() &#123; try &#123; //å¯ä»¥å®žçŽ°æ‰©å±•ç‚¹çš„æ³¨å…¥ return injectExtension((T) getAdaptiveExtensionClass().newInstance()); &#125; catch (Exception e) &#123; throw new IllegalStateException("Can not create adaptive extenstion " + type + ", cause: " + e.getMessage(), e); &#125;&#125; getAdaptiveExtensionClassä»Žç±»åæ¥çœ‹ï¼Œæ˜¯èŽ·å¾—ä¸€ä¸ªé€‚é…å™¨æ‰©å±•ç‚¹çš„ç±»ã€‚ åœ¨è¿™æ®µä»£ç ä¸­ï¼Œåšäº†ä¸¤ä¸ªäº‹æƒ… getExtensionClasses() åŠ è½½æ‰€æœ‰è·¯å¾„ä¸‹çš„æ‰©å±•ç‚¹ createAdaptiveExtensionClass() åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ‰©å±•ç‚¹ cachedAdaptiveClass è¿™é‡Œæœ‰ä¸ªåˆ¤æ–­ï¼Œç”¨æ¥åˆ¤æ–­å½“å‰ Protocol è¿™ä¸ªæ‰©å±•ç‚¹æ˜¯å¦å­˜åœ¨ä¸€ä¸ªè‡ªå®šä¹‰çš„é€‚é…å™¨ï¼Œå¦‚æžœ æœ‰ï¼Œåˆ™ç›´æŽ¥è¿”å›žè‡ªå®šä¹‰é€‚é…å™¨ï¼Œå¦åˆ™ï¼Œå°±åŠ¨æ€åˆ›å»ºï¼Œè¿™ä¸ªå€¼ æ˜¯åœ¨ getExtensionClasses ä¸­èµ‹å€¼çš„ï¼Œè¿™å—ä»£ç æˆ‘ä»¬ç¨åŽå†çœ‹1234567private Class&lt;?&gt; getAdaptiveExtensionClass() &#123; getExtensionClasses(); if (cachedAdaptiveClass != null) &#123; return cachedAdaptiveClass; //AdaptiveCompiler &#125; return cachedAdaptiveClass = createAdaptiveExtensionClass();&#125; createAdaptiveExtensionClassåŠ¨æ€ç”Ÿæˆé€‚é…å™¨ä»£ç ï¼Œä»¥åŠåŠ¨æ€ç¼–è¯‘ createAdaptiveExtensionClassCode, åŠ¨æ€åˆ›å»ºä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ã€‚è¿”å›ž code è¿™ä¸ªå­—ç¬¦ä¸² é€šè¿‡ compiler.compile è¿›è¡Œç¼–è¯‘(é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯javassist) é€šè¿‡ ClassLoader åŠ è½½åˆ° jvm ä¸­12345678910//åˆ›å»ºä¸€ä¸ªé€‚é…å™¨æ‰©å±•ç‚¹ã€‚ï¼ˆåˆ›å»ºä¸€ä¸ªåŠ¨æ€çš„å­—èŠ‚ç æ–‡ä»¶ï¼‰private Class&lt;?&gt; createAdaptiveExtensionClass() &#123; //ç”Ÿæˆå­—èŠ‚ç ä»£ç  String code = createAdaptiveExtensionClassCode(); //èŽ·å¾—ç±»åŠ è½½å™¨ ClassLoader classLoader = findClassLoader(); com.alibaba.dubbo.common.compiler.Compiler compiler = ExtensionLoader.getExtensionLoader(com.alibaba.dubbo.common.compiler.Compiler.class).getAdaptiveExtension(); //åŠ¨æ€ç¼–è¯‘å­—èŠ‚ç  return compiler.compile(code, classLoader);&#125; codeçš„å­—èŠ‚ç å†…å®¹12345678910111213141516171819202122232425262728293031public class Protocol$Adaptive implements com.alibaba.dubbo.rpc.Protocol &#123; public void destroy() &#123; throw new UnsupportedOperationException("method public abstract void com.alibaba.dubbo.rpc.Protocol.destroy() of interface com.alibaba.dubbo.rpc.Protocol is not adaptive method!"); &#125; public int getDefaultPort() &#123; throw new UnsupportedOperationException("method public abstract int com.alibaba.dubbo.rpc.Protocol.getDefaultPort() of interface com.alibaba.dubbo.rpc.Protocol is not adaptive method!"); &#125; public com.alibaba.dubbo.rpc.Invoker refer(java.lang.Class arg0, com.alibaba.dubbo.common.URL arg1) throws com.alibaba.dubbo.rpc.RpcException &#123; if (arg1 == null) throw new IllegalArgumentException("url == null"); com.alibaba.dubbo.common.URL url = arg1; String extName = (url.getProtocol() == null ? "dubbo" : url.getProtocol()); if (extName == null) throw new IllegalStateException("Fail to get extension(com.alibaba.dubbo.rpc.Protocol) name from url(" + url.toString() + ") use keys([protocol])"); com.alibaba.dubbo.rpc.Protocol extension = (com.alibaba.dubbo.rpc.Protocol) ExtensionLoader.getExtensionLoader(com.alibaba.dubbo.rpc.Protocol.class).getExtension(extName); return extension.refer(arg0, arg1); &#125; public com.alibaba.dubbo.rpc.Exporter export(com.alibaba.dubbo.rpc.Invoker arg0) throws com.alibaba.dubbo.rpc.RpcException &#123; if (arg0 == null) throw new IllegalArgumentException("com.alibaba.dubbo.rpc.Invoker argument == null"); if (arg0.getUrl() == null) throw new IllegalArgumentException("com.alibaba.dubbo.rpc.Invoker argument getUrl() == null"); com.alibaba.dubbo.common.URL url = arg0.getUrl(); String extName = (url.getProtocol() == null ? "dubbo" : url.getProtocol()); if (extName == null) throw new IllegalStateException("Fail to get extension(com.alibaba.dubbo.rpc.Protocol) name from url(" + url.toString() + ") use keys([protocol])"); com.alibaba.dubbo.rpc.Protocol extension = (com.alibaba.dubbo.rpc.Protocol) ExtensionLoader.getExtensionLoader(com.alibaba.dubbo.rpc.Protocol.class).getExtension(extName); return extension.export(arg0); &#125;&#125; Protocol$Adaptive çš„ä¸»è¦åŠŸèƒ½ ä»Ž url æˆ–æ‰©å±•æŽ¥å£èŽ·å–æ‰©å±•æŽ¥å£å®žçŽ°ç±»çš„åç§°; æ ¹ æ® å ç§° ï¼Œ èŽ· å– å®ž çŽ° ç±» ExtensionLoader.getExtensionLoader( æ‰© å±• æŽ¥ å£ ç±»).getExtension(æ‰©å±•æŽ¥å£å®žçŽ°ç±»åç§°)ï¼Œç„¶åŽè°ƒç”¨å®žçŽ°ç±» çš„æ–¹æ³•ã€‚éœ€è¦æ˜Žç™½ä¸€ç‚¹ dubbo çš„å†…éƒ¨ä¼ å‚åŸºæœ¬ä¸Šéƒ½æ˜¯åŸºäºŽ Url æ¥å®ž çŽ°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ Dubbo æ˜¯åŸºäºŽ URL é©±åŠ¨çš„æŠ€æœ¯ æ‰€ä»¥ï¼Œé€‚é…å™¨ç±»çš„ç›®çš„æ˜¯åœ¨è¿è¡ŒæœŸèŽ·å–æ‰©å±•çš„çœŸæ­£å®žçŽ°æ¥è°ƒç”¨ï¼Œè§£è€¦æŽ¥å£å’Œå®žçŽ°ï¼Œè¿™æ ·çš„è¯ä¸è¦æˆ‘ä»¬è‡ªå·±å®žçŽ°é€‚é…å™¨ç±»ï¼Œè€Œè¿™äº›éƒ½æ˜¯é€šè¿‡ Adpative æ¥å®žçŽ°ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ AdaptiveExtension çš„ä¸»çº¿èµ°å®Œäº†ï¼Œå¯ ä»¥ç®€å•æ•´ç†ä¸€ä¸‹ä»–ä»¬çš„è°ƒç”¨å…³ç³»å¦‚ä¸‹ getExtensionClassesè¿™æ®µä»£ç ä¸»è¦åšå¦‚ä¸‹å‡ ä¸ªäº‹æƒ… ä»Ž cachedClasses ä¸­èŽ·å¾—ä¸€ä¸ªç»“æžœï¼Œè¿™ä¸ªç»“æžœå®žé™…ä¸Šå°± æ˜¯æ‰€æœ‰çš„æ‰©å±•ç‚¹ç±»ï¼Œkey å¯¹åº” nameï¼Œvalue å¯¹åº” class é€šè¿‡åŒé‡æ£€æŸ¥é”è¿›è¡Œåˆ¤æ–­ è°ƒç”¨ loadExtensionClassesï¼ŒåŽ»åŠ è½½å·¦å³æ‰©å±•ç‚¹çš„å®žçŽ° 123456789101112131415//åŠ è½½æ‰©å±•ç‚¹çš„å®žçŽ°ç±»private Map&lt;String, Class&lt;?&gt;&gt; getExtensionClasses() &#123; Map&lt;String, Class&lt;?&gt;&gt; classes = cachedClasses.get(); if (classes == null) &#123; synchronized (cachedClasses) &#123; classes = cachedClasses.get(); if (classes == null) &#123; classes = loadExtensionClasses(); cachedClasses.set(classes); &#125; &#125; &#125; return classes;&#125; loadExtensionClassesä»Žä¸åŒç›®å½•åŽ»åŠ è½½æ‰©å±•ç‚¹çš„å®žçŽ°ï¼ŒMETA-INF/dubbo ; META-INF/internal ; META- INF/ser vicesä¸»è¦é€»è¾‘ èŽ·å¾—å½“å‰æ‰©å±•ç‚¹çš„æ³¨è§£ï¼Œä¹Ÿå°±æ˜¯ Protocol.class è¿™ä¸ªç±»çš„ æ³¨è§£ï¼Œ@SPI åˆ¤æ–­è¿™ä¸ªæ³¨è§£ä¸ä¸ºç©ºï¼Œåˆ™å†æ¬¡èŽ·å¾—@SPI ä¸­çš„ value å€¼ å¦‚æžœ value æœ‰å€¼ï¼Œä¹Ÿå°±æ˜¯@SPI(â€œdubboâ€)ï¼Œåˆ™è®²è¿™ä¸ª dubbo çš„å€¼èµ‹ç»™ cachedDefaultNameã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ ExtensionLoader.getExtensionLoader(Protocol.class).getDefaultExtension() ,èƒ½å¤ŸèŽ·å¾— DubboProtocol è¿™ä¸ªæ‰© å±•ç‚¹çš„åŽŸå›  æœ€åŽï¼Œé€šè¿‡ loadFile åŽ»åŠ è½½æŒ‡å®šè·¯å¾„ä¸‹çš„æ‰€æœ‰æ‰©å±•ç‚¹ã€‚ ä¹Ÿ å°± æ˜¯ META-INF/dubbo;META-INF/internal;META-INF/services è¯»å–com.alibaba.dubbo.common.extension.ExtensionFactoryçš„æ–‡ä»¶å†…å®¹ï¼ŒæŒ‰è¡Œè¯»å–ï¼Œæ–‡ä»¶é‡‡ç”¨ name=value æ–¹å¼123adaptive=com.alibaba.dubbo.common.extension.factory.AdaptiveExtensionFactoryspi=com.alibaba.dubbo.common.extension.factory.SpiExtensionFactoryspring=com.alibaba.dubbo.config.spring.extension.SpringExtensionFactory 1.Adaptiveæ³¨è§£åœ¨ç±»ä¸ŠApaptiveæ³¨è§£åœ¨ç±»ä¸Šï¼Œæ¯”å¦‚AdaptiveExtensionFactoryæ˜¯ExtensionFactoryçš„å®žçŽ°ï¼Œåˆ™ç›´æŽ¥cachedAdaptiveClass = clazzã€‚å› ä¸º`cachedAdaptiveClasså·²ç»ä¸ä¸ºnullï¼Œä¸ä¼šåŽ»å†æ‰§è¡ŒåŠ¨æ€æ‹¼æŽ¥å­—èŠ‚ç ã€‚ @Adaptiveå¦‚æžœæ˜¯åŠ åœ¨ç±»ä¸Šï¼Œ è¡¨ç¤ºå½“å‰ç±»æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„è‡ªé€‚åº”æ‰©å±•ç‚¹ ã€‚å¦‚æžœæ˜¯åŠ åœ¨æ–¹æ³•çº§åˆ«ä¸Šï¼Œè¡¨ç¤ºéœ€è¦åŠ¨æ€åˆ›å»ºä¸€ä¸ªè‡ªé€‚åº”æ‰©å±•ç‚¹ï¼Œä¹Ÿå°±æ˜¯Protocol$Adaptive 1234567if (clazz.isAnnotationPresent(Adaptive.class)) &#123; if(cachedAdaptiveClass == null) &#123; cachedAdaptiveClass = clazz; &#125; else if (! cachedAdaptiveClass.equals(clazz)) &#123; throw new IllegalStateException("More than 1 adaptive class found: "+ cachedAdaptiveClass.getClass().getName()+ ", " + clazz.getClass().getName()); &#125;&#125; 12345678private Class&lt;?&gt; getAdaptiveExtensionClass() &#123; getExtensionClasses(); //å¦‚æžœcachedAdaptiveClasså·²ç»èµ‹å€¼ï¼Œç›´æŽ¥è¿”å›ž if (cachedAdaptiveClass != null) &#123; return cachedAdaptiveClass; &#125; return cachedAdaptiveClass = createAdaptiveExtensionClass();&#125; 2.ç±»æ²¡æœ‰Adaptiveæ³¨è§£å¦‚æžœç±»æ²¡æœ‰Adaptiveæ³¨è§£ï¼Œæ¯”å¦‚SpringExtensionFactoryï¼Œä¸å­˜åœ¨ï¼ˆExtensionFactoryï¼‰çš„æž„é€ å‡½æ•°ï¼Œèµ°catchçš„é€»è¾‘ï¼Œspring=com.alibaba.dubbo.config.spring.extension.SpringExtensionFactoryï¼Œæœ€åŽåˆ†åˆ«å‘cachedNameså’ŒextensionClasseså­˜å…¥key value : å­—ç¬¦ä¸²springå’ŒSpringExtensionFactoryçš„classå­—èŠ‚ç ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344else &#123; try &#123; clazz.getConstructor(type); Set&lt;Class&lt;?&gt;&gt; wrappers = cachedWrapperClasses; if (wrappers == null) &#123; cachedWrapperClasses = new ConcurrentHashSet&lt;Class&lt;?&gt;&gt;(); wrappers = cachedWrapperClasses; &#125; wrappers.add(clazz); &#125; catch (NoSuchMethodException e) &#123; //SpringExtensionFactoryä¸å­˜åœ¨ï¼ˆExtensionFactoryï¼‰çš„æž„é€ å‡½æ•° clazz.getConstructor(); if (name == null || name.length() == 0) &#123; name = findAnnotationName(clazz); if (name == null || name.length() == 0) &#123; if (clazz.getSimpleName().length() &gt; type.getSimpleName().length() &amp;&amp; clazz.getSimpleName().endsWith(type.getSimpleName())) &#123; name = clazz.getSimpleName().substring(0, clazz.getSimpleName().length() - type.getSimpleName().length()).toLowerCase(); &#125; else &#123; throw new IllegalStateException("No such extension name for the class " + clazz.getName() + " in the config " + url); &#125; &#125; &#125; String[] names = NAME_SEPARATOR.split(name); if (names != null &amp;&amp; names.length &gt; 0) &#123; Activate activate = clazz.getAnnotation(Activate.class); if (activate != null) &#123; cachedActivates.put(names[0], activate); &#125; for (String n : names) &#123; if (! cachedNames.containsKey(clazz)) &#123; cachedNames.put(clazz, n); &#125; Class&lt;?&gt; c = extensionClasses.get(n); if (c == null) &#123; extensionClasses.put(n, clazz); &#125; else if (c != clazz) &#123; throw new IllegalStateException("Duplicate extension " + type.getName() + " name " + n + " on " + c.getName() + " and " + clazz.getName()); &#125; &#125; &#125; &#125;&#125; 3.å­˜åœ¨æž„é€ å‡½æ•°ProtocolListenerWrapperå­˜åœ¨æž„é€ å‡½æ•°ProtocolListenerWrapper(Protocol protocol)ï¼Œåˆ™å‘wrappersé›†åˆä¸­æ·»åŠ clazz å¦‚æžœæ²¡æœ‰ Adaptive æ³¨è§£ï¼Œåˆ™åˆ¤æ–­å½“å‰ç±»æ˜¯å¦å¸¦æœ‰å‚æ•°æ˜¯ type ç±»åž‹çš„æž„é€ å‡½æ•°ï¼Œå¦‚æžœæœ‰ï¼Œåˆ™è®¤ä¸ºæ˜¯wrapper ç±»ã€‚è¿™ä¸ª wrapper å®žé™…ä¸Šå°±æ˜¯å¯¹æ‰©å±•ç±»è¿›è¡Œè£… é¥°.å¯ ä»¥åœ¨ dubbo-rpc-api/internal ä¸‹æ‰¾åˆ° Protocol æ–‡ä»¶ï¼Œå‘çŽ° Protocol é…ç½®äº† 3 ä¸ªè£…é¥°åˆ†åˆ«æ˜¯,filter/listener/mock. æ‰€ä»¥ Protocol è¿™ä¸ªå®ž ä¾‹æ¥è¯´ï¼Œä¼šå¢žåŠ å¯¹åº”çš„è£…é¥°å™¨ 1234567clazz.getConstructor(type); Set&lt;Class&lt;?&gt;&gt; wrappers = cachedWrapperClasses; if (wrappers == null) &#123; cachedWrapperClasses = new ConcurrentHashSet&lt;Class&lt;?&gt;&gt;(); wrappers = cachedWrapperClasses; &#125; wrappers.add(clazz); 3. ExtensionFactory12ExtensionLoader.getExtensionLoader(ExtensionFactory.class).getAdaptiveExtension() Object object = objectFactory.getExtension(pt, property); objectFactory =&gt; AdaptiveExtensionFactory AdaptiveExtensionFactory123456789public &lt;T&gt; T getExtension(Class&lt;T&gt; type, String name) &#123; for (ExtensionFactory factory : factories) &#123; T extension = factory.getExtension(type, name); if (extension != null) &#123; return extension; &#125; &#125; return null;&#125; 1registry://127.0.0.1:2181/com.alibaba.dubbo.registry.RegistryService?application=dubbo-client&amp;dubbo=2.5.3&amp;owner=joey&amp;pid=57644&amp;registry=zookeeper&amp;timestamp=1529844392952 1234 if (urls.size() == 1) &#123; invoker = refprotocol.refer(interfaceClass, urls.get(0)); &#125;//è¿™é‡Œinvokerä¸º MockClusterInvoker 12345678public com.alibaba.dubbo.rpc.Invoker refer(java.lang.Class arg0, com.alibaba.dubbo.common.URL arg1) &#123; if (arg1 == null) throw new IllegalArgumentException("url == null"); com.alibaba.dubbo.common.URL url = arg1; String extName = ( url.getProtocol() == null ? "dubbo" : url.getProtocol() ); if(extName == null) throw new IllegalStateException("Fail to get extension(com.alibaba.dubbo.rpc.Protocol) name from url(" + url.toString() + ") use keys([protocol])"); com.alibaba.dubbo.rpc.Protocol extension = (com.alibaba.dubbo.rpc.Protocol)ExtensionLoader.getExtensionLoader(com.alibaba.dubbo.rpc.Protocol.class).getExtension(extName); return extension.refer(arg0, arg1);&#125; 12345678910111213141516171819public &lt;T&gt; Invoker&lt;T&gt; refer(Class&lt;T&gt; type, URL url) throws RpcException &#123; url = url.setProtocol(url.getParameter(Constants.REGISTRY_KEY, Constants.DEFAULT_REGISTRY)).removeParameter(Constants.REGISTRY_KEY); //èŽ·å¾—æ³¨å†Œä¸­å¿ƒ Registry registry = registryFactory.getRegistry(url); if (RegistryService.class.equals(type)) &#123; return proxyFactory.getInvoker((T) registry, type, url); &#125; // group="a,b" or group="*" Map&lt;String, String&gt; qs = StringUtils.parseQueryString(url.getParameterAndDecoded(Constants.REFER_KEY)); String group = qs.get(Constants.GROUP_KEY); if (group != null &amp;&amp; group.length() &gt; 0 ) &#123; if ( ( Constants.COMMA_SPLIT_PATTERN.split( group ) ).length &gt; 1 || "*".equals( group ) ) &#123; return doRefer( getMergeableCluster(), registry, type, url ); &#125; &#125; return doRefer(cluster, registry, type, url); &#125; 1234567891011121314151617private &lt;T&gt; Invoker&lt;T&gt; doRefer(Cluster cluster, Registry registry, Class&lt;T&gt; type, URL url) &#123; RegistryDirectory&lt;T&gt; directory = new RegistryDirectory&lt;T&gt;(type, url); directory.setRegistry(registry); directory.setProtocol(protocol); URL subscribeUrl = new URL(Constants.CONSUMER_PROTOCOL, NetUtils.getLocalHost(), 0, type.getName(), directory.getUrl().getParameters()); if (! Constants.ANY_VALUE.equals(url.getServiceInterface()) &amp;&amp; url.getParameter(Constants.REGISTER_KEY, true)) &#123; //å°†æ¶ˆè´¹è€…çš„åœ°å€æ³¨å†Œåˆ°zk registry.register(subscribeUrl.addParameters(Constants.CATEGORY_KEY, Constants.CONSUMERS_CATEGORY, Constants.CHECK_KEY, String.valueOf(false))); &#125; directory.subscribe(subscribeUrl.addParameter(Constants.CATEGORY_KEY, Constants.PROVIDERS_CATEGORY + "," + Constants.CONFIGURATORS_CATEGORY + "," + Constants.ROUTERS_CATEGORY)); return cluster.join(directory);&#125; 1234directory.subscribe(subscribeUrl.addParameter(Constants.CATEGORY_KEY, Constants.PROVIDERS_CATEGORY + "," + Constants.CONFIGURATORS_CATEGORY + "," + Constants.ROUTERS_CATEGORY)); url = zookeeper://127.0.0.1:2181/com.alibaba.dubbo.registry.RegistryService?application=dubbo-client&amp;dubbo=2.5.3&amp;owner=joey&amp;pid=57644&amp;refer=application%3Ddubbo-client%26dubbo%3D2.5.3%26interface%3Dcom.joey.hello.IhelloService%26methods%3DsayHello%26owner%3Djoey%26pid%3D57644%26side%3Dconsumer%26timestamp%3D1529844387888&amp;timestamp=1529844392952 123456789mock=com.alibaba.dubbo.rpc.cluster.support.wrapper.MockClusterWrapperfailover=com.alibaba.dubbo.rpc.cluster.support.FailoverClusterfailfast=com.alibaba.dubbo.rpc.cluster.support.FailfastClusterfailsafe=com.alibaba.dubbo.rpc.cluster.support.FailsafeClusterfailback=com.alibaba.dubbo.rpc.cluster.support.FailbackClusterforking=com.alibaba.dubbo.rpc.cluster.support.ForkingClusteravailable=com.alibaba.dubbo.rpc.cluster.support.AvailableClustermergeable=com.alibaba.dubbo.rpc.cluster.support.MergeableClusterbroadcast=com.alibaba.dubbo.rpc.cluster.support.BroadcastCluster MockClusterWrapperå­˜åœ¨MockClusterWrapper(Cluster cluster)ï¼Œæ‰€ä»¥ä¼šå°†FailfastClusterç­‰è¿›è¡ŒåŒ…è£…ï¼Œæ˜¯å¤±è´¥é™çº§ç”¨çš„ã€‚ 1234567891011121314public class MockClusterWrapper implements Cluster &#123; private Cluster cluster; public MockClusterWrapper(Cluster cluster) &#123; this.cluster = cluster; &#125; public &lt;T&gt; Invoker&lt;T&gt; join(Directory&lt;T&gt; directory) throws RpcException &#123; return new MockClusterInvoker&lt;T&gt;(directory, this.cluster.join(directory)); &#125;&#125; ProxyFactory$Adaptive StubProxyFactoryWrapperå­˜åœ¨æž„é€ å‡½æ•°ï¼Œæ˜¯wrapperï¼Œä¼šæŠŠJavassistProxyFactoryåŒ…è£… 123public StubProxyFactoryWrapper(ProxyFactory proxyFactory) &#123; this.proxyFactory = proxyFactory;&#125; æœ€ç»ˆè¿˜æ˜¯JavassistProxyFactory Proxy123456789// create Proxy class.String fcn = Proxy.class.getName() + id;ccm = ClassGenerator.newInstance(cl);ccm.setClassName(fcn);ccm.addDefaultConstructor();ccm.setSuperClass(Proxy.class);ccm.addMethod("public Object newInstance(" + InvocationHandler.class.getName() + " h)&#123; return new " + pcn + "($1); &#125;");Class&lt;?&gt; pc = ccm.toClass();proxy = (Proxy)pc.newInstance(); ccm method debugçš„ç»“æžœ 12345public java.lang.String sayHello(java.lang.String arg0)&#123;Object[] args = new Object[1]; args[0] = ($w)$1;Object ret = handler.invoke(this, methods[0], args);return (java.lang.String)ret;&#125; 1public java.lang.Object $echo(java.lang.Object arg0)&#123;Object[] args = new Object[1]; args[0] = ($w)$1; Object ret = handler.invoke(this, methods[1], args); return (java.lang.Object)ret;&#125; Proxy0 hander invoker :interface com.joey.hello.IhelloService -&gt; zookeeper://127.0.0.1:2181/com.alibaba.dubbo.registry.RegistryService?anyhost=true&amp;application=dubbo-client&amp;check=false&amp;dubbo=2.5.3&amp;interface=com.joey.hello.IhelloService&amp;methods=sayHello&amp;owner=joey&amp;pid=57718&amp;side=consumer&amp;timestamp=1529847722831,directory: com.alibaba.dubbo.registry.integration.RegistryDirectory@3cfdd820 1234567891011121314151617181920212223List&lt;URL&gt; urls = new ArrayList&lt;URL&gt;();for (String path : toCategoriesPath(url)) &#123; ConcurrentMap&lt;NotifyListener, ChildListener&gt; listeners = zkListeners.get(url); if (listeners == null) &#123; zkListeners.putIfAbsent(url, new ConcurrentHashMap&lt;NotifyListener, ChildListener&gt;()); listeners = zkListeners.get(url); &#125; ChildListener zkListener = listeners.get(listener); if (zkListener == null) &#123; listeners.putIfAbsent(listener, new ChildListener() &#123; public void childChanged(String parentPath, List&lt;String&gt; currentChilds) &#123; ZookeeperRegistry.this.notify(url, listener, toUrlsWithEmpty(url, parentPath, currentChilds)); &#125; &#125;); zkListener = listeners.get(listener); &#125; zkClient.create(path, false); List&lt;String&gt; children = zkClient.addChildListener(path, zkListener); if (children != null) &#123; urls.addAll(toUrlsWithEmpty(url, path, children)); &#125;&#125;notify(url, listener, urls); AbstractRegistry1234567for (Map.Entry&lt;String, List&lt;URL&gt;&gt; entry : result.entrySet()) &#123; String category = entry.getKey(); List&lt;URL&gt; categoryList = entry.getValue(); categoryNotified.put(category, categoryList); saveProperties(url); listener.notify(categoryList);&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142/** * æ ¹æ®invokerURLåˆ—è¡¨è½¬æ¢ä¸ºinvokeråˆ—è¡¨ã€‚è½¬æ¢è§„åˆ™å¦‚ä¸‹ï¼š * 1.å¦‚æžœurlå·²ç»è¢«è½¬æ¢ä¸ºinvokerï¼Œåˆ™ä¸åœ¨é‡æ–°å¼•ç”¨ï¼Œç›´æŽ¥ä»Žç¼“å­˜ä¸­èŽ·å–ï¼Œæ³¨æ„å¦‚æžœurlä¸­ä»»ä½•ä¸€ä¸ªå‚æ•°å˜æ›´ä¹Ÿä¼šé‡æ–°å¼•ç”¨ * 2.å¦‚æžœä¼ å…¥çš„invokeråˆ—è¡¨ä¸ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºæœ€æ–°çš„invokeråˆ—è¡¨ * 3.å¦‚æžœä¼ å…¥çš„invokerUrlåˆ—è¡¨æ˜¯ç©ºï¼Œåˆ™è¡¨ç¤ºåªæ˜¯ä¸‹å‘çš„overrideè§„åˆ™æˆ–routeè§„åˆ™ï¼Œéœ€è¦é‡æ–°äº¤å‰å¯¹æ¯”ï¼Œå†³å®šæ˜¯å¦éœ€è¦é‡æ–°å¼•ç”¨ã€‚ * @param invokerUrls ä¼ å…¥çš„å‚æ•°ä¸èƒ½ä¸ºnull */private void refreshInvoker(List&lt;URL&gt; invokerUrls)&#123; if (invokerUrls != null &amp;&amp; invokerUrls.size() == 1 &amp;&amp; invokerUrls.get(0) != null &amp;&amp; Constants.EMPTY_PROTOCOL.equals(invokerUrls.get(0).getProtocol())) &#123; this.forbidden = true; // ç¦æ­¢è®¿é—® this.methodInvokerMap = null; // ç½®ç©ºåˆ—è¡¨ destroyAllInvokers(); // å…³é—­æ‰€æœ‰Invoker &#125; else &#123; this.forbidden = false; // å…è®¸è®¿é—® Map&lt;String, Invoker&lt;T&gt;&gt; oldUrlInvokerMap = this.urlInvokerMap; // local reference if (invokerUrls.size() == 0 &amp;&amp; this.cachedInvokerUrls != null)&#123; invokerUrls.addAll(this.cachedInvokerUrls); &#125; else &#123; this.cachedInvokerUrls = new HashSet&lt;URL&gt;(); this.cachedInvokerUrls.addAll(invokerUrls);//ç¼“å­˜invokerUrlsåˆ—è¡¨ï¼Œä¾¿äºŽäº¤å‰å¯¹æ¯” &#125; if (invokerUrls.size() ==0 )&#123; return; &#125; Map&lt;String, Invoker&lt;T&gt;&gt; newUrlInvokerMap = toInvokers(invokerUrls) ;// å°†URLåˆ—è¡¨è½¬æˆInvokeråˆ—è¡¨ Map&lt;String, List&lt;Invoker&lt;T&gt;&gt;&gt; newMethodInvokerMap = toMethodInvokers(newUrlInvokerMap); // æ¢æ–¹æ³•åæ˜ å°„Invokeråˆ—è¡¨ // state change //å¦‚æžœè®¡ç®—é”™è¯¯ï¼Œåˆ™ä¸è¿›è¡Œå¤„ç†. if (newUrlInvokerMap == null || newUrlInvokerMap.size() == 0 )&#123; logger.error(new IllegalStateException("urls to invokers error .invokerUrls.size :"+invokerUrls.size() + ", invoker.size :0. urls :"+invokerUrls.toString())); return ; &#125; this.methodInvokerMap = multiGroup ? toMergeMethodInvokerMap(newMethodInvokerMap) : newMethodInvokerMap; this.urlInvokerMap = newUrlInvokerMap; try&#123; destroyUnusedInvokers(oldUrlInvokerMap,newUrlInvokerMap); // å…³é—­æœªä½¿ç”¨çš„Invoker &#125;catch (Exception e) &#123; logger.warn("destroyUnusedInvokers error. ", e); &#125; &#125;&#125; filter(listener(dubboProtocol)) DubboProtocol 123456public &lt;T&gt; Invoker&lt;T&gt; refer(Class&lt;T&gt; serviceType, URL url) throws RpcException &#123; // create rpc invoker. DubboInvoker&lt;T&gt; invoker = new DubboInvoker&lt;T&gt;(serviceType, url, getClients(url), invokers); invokers.add(invoker); return invoker;&#125; 12Map&lt;String, Invoker&lt;T&gt;&gt; newUrlInvokerMap = toInvokers(invokerUrls) ;// å°†URLåˆ—è¡¨è½¬æˆInvokeråˆ—è¡¨Map&lt;String, List&lt;Invoker&lt;T&gt;&gt;&gt; newMethodInvokerMap = toMethodInvokers(newUrlInvokerMap); // æ¢æ–¹æ³•åæ˜ å°„Invokeråˆ—è¡¨ MockClusterInvoker invoke -&gt; 1MockClusterInvoker 4.dubbo SPIæœºåˆ¶å¤§éƒ¨åˆ†çš„æ€æƒ³éƒ½æ˜¯å’Œ SPI æ˜¯ä¸€æ ·ï¼Œåªæ˜¯ä¸‹é¢ä¸¤ä¸ªåœ°æ–¹æœ‰å·® å¼‚ã€‚ éœ€è¦åœ¨ resource ç›®å½•ä¸‹é…ç½® META-INF/dubbo æˆ–è€… META-INF/dubbo/internal æˆ–è€… META-INF/servicesï¼Œå¹¶åŸº äºŽ SPI æŽ¥å£åŽ»åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ æ–‡ä»¶åç§°å’ŒæŽ¥å£åç§°ä¿æŒä¸€è‡´ï¼Œæ–‡ä»¶å†…å®¹å’Œ SPI æœ‰å·®å¼‚ï¼Œ å†…å®¹æ˜¯ KEY å¯¹åº” Value å¦‚æžœç±»æ²¡æœ‰Adaptiveæ³¨è§£ï¼Œæ¯”å¦‚SpringExtensionFactoryï¼Œä¸å­˜åœ¨ï¼ˆExtensionFactoryï¼‰çš„æž„é€ å‡½æ•°ï¼Œèµ°catchçš„é€»è¾‘ï¼Œspring=com.alibaba.dubbo.config.spring.extension.SpringExtensionFactoryï¼Œæœ€åŽåˆ†åˆ«å‘cachedNameså’ŒextensionClasseså­˜å…¥key value : å­—ç¬¦ä¸²springå’ŒSpringExtensionFactoryçš„classå­—èŠ‚ç ã€‚]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[TCPåè®®è¯¦è§£]]></title>
    <url>%2F2018%2F06%2F21%2FTCP%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[TCPä¸‰æ¬¡æ¡æ‰‹ Client A åºå· Server B â€”â€”1â€”â€”&gt; &lt;â€”â€”2â€”â€” â€”â€”3â€”â€”&gt; ClientA -&gt; ServerB: SYN=1, ACK=0 , åºåˆ—å·seq=x ã€‚ æ­¤æ—¶ï¼ŒTCPå®¢æˆ·ç«¯ClientAè¿›ç¨‹è¿›å…¥äº† SYN-SENTï¼ˆåŒæ­¥å·²å‘é€çŠ¶æ€ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒSYNæŠ¥æ–‡æ®µï¼ˆSYN=1çš„æŠ¥æ–‡æ®µï¼‰ä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†éœ€è¦æ¶ˆè€—æŽ‰ä¸€ä¸ªåºå·ã€‚ ServerB -&gt; ClientA: SYN=1, ACK=1 , åºåˆ—å·seq=y , ç¡®è®¤å·ack=x+1 ã€‚æ­¤æ—¶ï¼ŒServerBè¿›å…¥SYN-RCVDåŒæ­¥æ”¶åˆ°çŠ¶æ€ã€‚SNCæŠ¥æ–‡æ®µä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†æ˜¯éœ€è¦æ¶ˆè€—ä¸€ä¸ªåºåˆ—å·ã€‚ ClientA -&gt; ServerB: ACK=1, seq=x+1 , ack=y+1 ã€‚clinetAå‘é€åŽè¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿žæŽ¥ï¼‰çŠ¶æ€ï¼ŒserverBæ”¶åˆ°åŽ=ï¼Œä¹Ÿè¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿žæŽ¥ï¼‰çŠ¶æ€ã€‚ TCPè§„å®šï¼ŒACKæŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä½†æ˜¯å¦‚æžœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ã€‚ ACK: TCPåè®®è§„å®šï¼Œåªæœ‰ACK=1æ—¶æœ‰æ•ˆï¼Œä¹Ÿè§„å®šè¿žæŽ¥å»ºç«‹åŽæ‰€æœ‰å‘é€çš„æŠ¥æ–‡çš„ACKå¿…é¡»ä¸º1 SYN(SYNchronization) ï¼š åœ¨è¿žæŽ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚ å½“SYN=1ï¼ŒACK=0æ—¶ï¼Œè¡¨æ˜Žè¿™æ˜¯ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ã€‚å¯¹æ–¹è‹¥åŒæ„å»ºç«‹è¿žæŽ¥ï¼Œåˆ™åº”åœ¨å“åº”æŠ¥æ–‡ä¸­ä½¿SYN=1ï¼ŒACK=1ã€‚ FINï¼Œç”¨æ¥é‡Šæ”¾è¿žæŽ¥ã€‚å½“FIN=1ï¼Œè¡¨æ˜Žæ­¤æŠ¥æ–‡çš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶ä¸”è¦æ±‚é‡Šæ”¾ã€‚ ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡â€‹ clientA ç¬¬ä¸€æ¬¡åœ¨æ­¥éª¤1ä¸­å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œç”±äºŽç½‘ç»œåŽŸå› ï¼Œé•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°ServerBç¡®è®¤å›žå¤ã€‚äºŽæ˜¯ï¼ŒclientAç¬¬äºŒæ¬¡å‘é€è¯·æ±‚ï¼ŒæˆåŠŸå»ºç«‹è¿žæŽ¥ï¼Œå¤„ç†å®ŒæˆåŽï¼Œå…³é—­è¿žæŽ¥ã€‚ä½†æ˜¯ï¼Œç¬¬ä¸€æ¬¡çš„è¯·æ±‚ç»è¿‡æ¼«é•¿çš„ä¸€æ®µæ—¶é—´åŽï¼Œåˆ°è¾¾äº†ServerBï¼Œå¹¶ä¸”ç»™äº†å›žå¤ç¡®è®¤ã€‚å³å·²å¤±æ•ˆçš„è¯·æ±‚è¿žæŽ¥æŠ¥æ–‡æ®µã€‚ â€‹ å¦‚æžœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡çš„è¿™ä¸ªè¿žæŽ¥å°±å»ºç«‹äº†ï¼Œå®žé™…æ˜¯ä¸åº”è¯¥å»ºç«‹çš„ï¼Œå¯¼è‡´ä¸è¦çš„é”™è¯¯å’Œèµ„æºæµªè´¹ã€‚ â€‹ é‡‡ç”¨ä¸‰æ¬¡æ¡æ‰‹ï¼Œå°±å¯ä»¥é˜²æ­¢ä¸Šé¢çš„é—®é¢˜ã€‚clientAå¯¹äºŽçš„ServerBçš„å›žå¤ç¡®è®¤ä¸äºˆç†ç¬ï¼ŒServerBæ”¶ä¸åˆ°clinetAçš„ç¬¬ä¸‰æ¬¡å›žå¤ï¼Œè¿™æ ·å°±ä¸ä¼šæµªè´¹å»ºç«‹æ–°çš„è¿žæŽ¥ã€‚ TCPå››æ¬¡æŒ¥æ‰‹ Client A åºå· Server B â€”â€”1â€”â€”&gt; &lt;â€”â€”2â€”â€” &lt;â€”â€”3â€”â€” â€”â€”4â€”â€”&gt; clientA -&gt; ServerB : FIN=1 , åºåˆ—å·seq=uï¼ˆç­‰äºŽå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åŽä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ ã€‚ æ­¤æ—¶ClientAä»ŽESTABLISHEDå»ºç«‹è¿žæŽ¥çŠ¶æ€å˜ä¸ºFIN-WAIT-1ç»ˆæ­¢ç­‰å¾…1çŠ¶æ€ã€‚TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚ ServerB -&gt; clientA : ACK=1 , seq=v , ack=u+1 ã€‚ æ­¤æ—¶ï¼Œ ServerBä»ŽESTABLISHEDå»ºç«‹è¿žæŽ¥çŠ¶æ€å˜ä¸ºCLOSE-WAITå…³é—­ç­‰å¾…çŠ¶æ€ã€‚clientAæ”¶åˆ°åŽï¼Œå˜ä¸ºFIN-WAIT-2ç»ˆæ­¢ç­‰å¾…2çŠ¶æ€ã€‚ å³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æŽ¥å—ã€‚ ServerB -&gt; clientA : FIN=1 , ACK=1 , seq=w , ack=u+1 ã€‚ æœåŠ¡å™¨ServerBå°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åŽç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚ clientA -&gt; ServerB : ACK=1 , seq=u+1 , ack=w+1 ã€‚ clientAå‘å‡ºåŽï¼Œè¿›å…¥TIME_WAITçŠ¶æ€ã€‚ æ³¨æ„æ­¤æ—¶TCPè¿žæŽ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2*MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åŽï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåŽï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåŽï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿žæŽ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿žæŽ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚ ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯æœ€åŽéœ€è¦ç­‰å¾…2MSL]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[sublime user setting]]></title>
    <url>%2F2018%2F06%2F19%2Fsublime-user-setting%2F</url>
    <content type="text"><![CDATA[Sublime3 Preferences -&gt; settings Useré…ç½® 12345678910111213141516171819202122&#123; "atomic_save": true, "color_scheme": "Packages/Color Scheme - Default/Mariana.sublime-color-scheme", "draw_white_space": "all", "font_face": "YaHei Consolas Hybrid", "font_size": 14, "ignored_packages": [ "Vintage" ], "open_files_in_new_window": false, "save_on_focus_lost": true, "soda_classic_tabs": true, "soda_folder_icons": true, "tab_size": 4, "theme": "Soda Light 3.sublime-theme", "translate_tabs_to_spaces": true, "trim_trailing_white_space_on_save": true, "update_check": false, "fold_buttons": true, "fade_fold_buttons": false,&#125; æ‰‹åŠ¨å®‰è£…soda Preferences -&gt; browse packages å°†Theme - Sodaè§£åŽ‹æ”¾åˆ°ç›®å½•ï¼ŒåŒä¸€çº§çš„è¿˜æœ‰Pretty JSON User ä¸­æ–‡ç½‘ http://www.sublimetextcn.com/ åˆ é™¤ç©ºè¡ŒCTRL+Hæ‰“å¼€replaceåŠŸèƒ½ï¼Œå‹¾é€‰ä¸Šå·¦ä¾§çš„regular expressionï¼Œå¹¶å¡«å†™ find whatæ  : \s+$ ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰replace withæ  : ï¼ˆè¿™è¡Œç•™ç©ºï¼‰ æ“ä½œå¤šè¡Œ5ç§æ–¹æ³• 1ï¼Œé¼ æ ‡é€‰ä¸­å¤šè¡Œï¼ŒæŒ‰ä¸‹ Ctrl Shift L (Command Shift L) å³å¯åŒæ—¶ç¼–è¾‘è¿™äº›è¡Œï¼›2ï¼Œé¼ æ ‡é€‰ä¸­æ–‡æœ¬ï¼Œåå¤æŒ‰ CTRL D (Command D) å³å¯ç»§ç»­å‘ä¸‹åŒæ—¶é€‰ä¸­ä¸‹ä¸€ä¸ªç›¸åŒçš„æ–‡æœ¬è¿›è¡ŒåŒæ—¶ç¼–è¾‘ï¼›3ï¼Œé¼ æ ‡é€‰ä¸­æ–‡æœ¬ï¼ŒæŒ‰ä¸‹ Alt F3 (Win) æˆ– Ctrl Command G(Mac) å³å¯ä¸€æ¬¡æ€§é€‰æ‹©å…¨éƒ¨çš„ç›¸åŒæ–‡æœ¬è¿›è¡ŒåŒæ—¶ç¼–è¾‘ï¼›4ï¼ŒShift é¼ æ ‡å³é”® (Win) æˆ– Option é¼ æ ‡å·¦é”® (Mac) æˆ–ä½¿ç”¨é¼ æ ‡ä¸­é”®å¯ä»¥ç”¨é¼ æ ‡è¿›è¡Œç«–å‘å¤šè¡Œé€‰æ‹©ï¼›5ï¼ŒCtrl é¼ æ ‡å·¦é”®(Win) æˆ– Command é¼ æ ‡å·¦é”®(Mac) å¯ä»¥æ‰‹åŠ¨é€‰æ‹©åŒæ—¶è¦ç¼–è¾‘ã€‚]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[telnetå‘½ä»¤è¯¦è§£]]></title>
    <url>%2F2018%2F06%2F12%2Ftelnet%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[telnetå‘½ä»¤ç”¨äºŽç™»å½•è¿œç¨‹ä¸»æœºï¼Œå¯¹è¿œç¨‹ä¸»æœºè¿›è¡Œç®¡ç†ã€‚telnetå› ä¸ºé‡‡ç”¨æ˜Žæ–‡ä¼ é€æŠ¥æ–‡ï¼Œå®‰å…¨æ€§ä¸å¥½ï¼Œå¾ˆå¤šLinuxæœåŠ¡å™¨éƒ½ä¸å¼€æ”¾telnetæœåŠ¡ï¼Œè€Œæ”¹ç”¨æ›´å®‰å…¨çš„sshæ–¹å¼äº†ã€‚ä½†ä»ç„¶æœ‰å¾ˆå¤šåˆ«çš„ç³»ç»Ÿå¯èƒ½é‡‡ç”¨äº†telnetæ–¹å¼æ¥æä¾›è¿œç¨‹ç™»å½•ï¼Œå› æ­¤å¼„æ¸…æ¥štelnetå®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹å¼ä»æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ è¯­æ³•1telnet(é€‰é¡¹)(å‚æ•°) é€‰é¡¹123456789101112131415161718-8ï¼šå…è®¸ä½¿ç”¨8ä½å­—ç¬¦èµ„æ–™ï¼ŒåŒ…æ‹¬è¾“å…¥ä¸Žè¾“å‡ºï¼›-aï¼šå°è¯•è‡ªåŠ¨ç™»å…¥è¿œç«¯ç³»ç»Ÿï¼›-b&lt;ä¸»æœºåˆ«å&gt;ï¼šä½¿ç”¨åˆ«åæŒ‡å®šè¿œç«¯ä¸»æœºåç§°ï¼›-cï¼šä¸è¯»å–ç”¨æˆ·ä¸“å±žç›®å½•é‡Œçš„.telnetrcæ–‡ä»¶ï¼›-dï¼šå¯åŠ¨æŽ’é”™æ¨¡å¼ï¼›-e&lt;è„±ç¦»å­—ç¬¦&gt;ï¼šè®¾ç½®è„±ç¦»å­—ç¬¦ï¼›-Eï¼šæ»¤é™¤è„±ç¦»å­—ç¬¦ï¼›-fï¼šæ­¤å‚æ•°çš„æ•ˆæžœå’ŒæŒ‡å®š"-F"å‚æ•°ç›¸åŒï¼›-Fï¼šä½¿ç”¨Kerberos V5è®¤è¯æ—¶ï¼ŒåŠ ä¸Šæ­¤å‚æ•°å¯æŠŠæœ¬åœ°ä¸»æœºçš„è®¤è¯æ•°æ®ä¸Šä¼ åˆ°è¿œç«¯ä¸»æœºï¼›-k&lt;åŸŸå&gt;ï¼šä½¿ç”¨Kerberosè®¤è¯æ—¶ï¼ŒåŠ ä¸Šæ­¤å‚æ•°è®©è¿œç«¯ä¸»æœºé‡‡ç”¨æŒ‡å®šçš„é¢†åŸŸåï¼Œè€Œéžè¯¥ä¸»æœºçš„åŸŸåï¼›-Kï¼šä¸è‡ªåŠ¨ç™»å…¥è¿œç«¯ä¸»æœºï¼›-l&lt;ç”¨æˆ·åç§°&gt;ï¼šæŒ‡å®šè¦ç™»å…¥è¿œç«¯ä¸»æœºçš„ç”¨æˆ·åç§°ï¼›-Lï¼šå…è®¸è¾“å‡º8ä½å­—ç¬¦èµ„æ–™ï¼›-n&lt;è®°å½•æ–‡ä»¶&gt;ï¼šæŒ‡å®šæ–‡ä»¶è®°å½•ç›¸å…³ä¿¡æ¯ï¼›-rï¼šä½¿ç”¨ç±»ä¼¼rloginæŒ‡ä»¤çš„ç”¨æˆ·ç•Œé¢ï¼›-S&lt;æœåŠ¡ç±»åž‹&gt;ï¼šè®¾ç½®telnetè¿žçº¿æ‰€éœ€çš„ip TOSä¿¡æ¯ï¼›-xï¼šå‡è®¾ä¸»æœºæœ‰æ”¯æŒæ•°æ®åŠ å¯†çš„åŠŸèƒ½ï¼Œå°±ä½¿ç”¨å®ƒï¼›-X&lt;è®¤è¯å½¢æ€&gt;ï¼šå…³é—­æŒ‡å®šçš„è®¤è¯å½¢æ€ã€‚ å‚æ•° è¿œç¨‹ä¸»æœºï¼šæŒ‡å®šè¦ç™»å½•è¿›è¡Œç®¡ç†çš„è¿œç¨‹ä¸»æœºï¼› ç«¯å£ï¼šæŒ‡å®šTELNETåè®®ä½¿ç”¨çš„ç«¯å£å·ã€‚ å®žä¾‹12345678910telnet 192.168.2.10Trying 192.168.2.10...Connected to 192.168.2.10 (192.168.2.10).Escape character is '^]'. localhost (Linux release 2.6.18-274.18.1.el5 #1 SMP Thu Feb 9 12:45:44 EST 2012) (1)login: rootPassword:Login incorrect ç¤ºä¾‹1ï¼šè¿œç¨‹æœåŠ¡å™¨æ— æ³•è®¿é—® 1234[root@linuxprobe ~]# telnet 192.168.120.209Trying 192.168.120.209...telnet: connect to address 192.168.120.209: No route to hosttelnet: Unable to connect to remote host: No route to host å¤„ç†è¿™ç§æƒ…å†µæ–¹æ³•ï¼šï¼ˆ1ï¼‰ç¡®è®¤IPåœ°å€æ˜¯å¦æ­£ç¡®ï¼ˆ2ï¼‰ç¡®è®¤IPåœ°å€å¯¹åº”çš„è£…æœºæ˜¯å¦å·²ç»å¼€æœºï¼ˆ3ï¼‰å¦‚æžœä¸»æœºå·²ç»å¯åŠ¨ï¼Œç¡®è®¤è·¯ç”±è®¾ç½®æ˜¯å¦è®¾ç½®æ­£ç¡®ï¼ˆä½¿ç”¨routeå‘½ä»¤æŸ¥çœ‹ï¼‰ï¼ˆ4ï¼‰å¦‚æžœä¸»æœºå·²ç»å¯åŠ¨ï¼Œç¡®è®¤ä¸»æœºä¸Šæ˜¯å¦å¼€å¯äº†telnetæœåŠ¡ï¼ˆä½¿ç”¨netstatå‘½ä»¤æŸ¥çœ‹ï¼ŒTCPçš„23ç«¯å£æ˜¯å¦æœ‰LISTENçŠ¶æ€è¡Œï¼‰ï¼ˆ5ï¼‰å¦‚æžœä¸»æœºå·²ç»å¯åŠ¨telnetæœåŠ¡ï¼Œç¡®è®¤é˜²ç«å¢™æ˜¯å¦å¼€æ”¾äº†23ç«¯å£çš„è®¿é—®ï¼ˆä½¿ç”¨iptables-saveæŸ¥çœ‹ï¼‰ ç¤ºä¾‹2ï¼šåŸŸåæ— æ³•è§£æž 12[root@linuxprobe ~]# telnet www.baidu.comwww.baidu.com/telnet: Temporary failure in name resolution å¤„ç†è¿™ç§æƒ…å†µæ–¹æ³•ï¼šï¼ˆ1ï¼‰ç¡®è®¤åŸŸåæ˜¯å¦æ­£ç¡®ï¼ˆ2ï¼‰ç¡®è®¤æœ¬æœºçš„åŸŸåè§£æžæœ‰å…³çš„è®¾ç½®æ˜¯å¦æ­£ç¡®(/etc/resolv.confä¸­nameserverçš„é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œå¯ä»¥ä½¿ç”¨nameserver 8.8.8.8)ï¼ˆ3ï¼‰ç¡®è®¤é˜²ç«å¢™æ˜¯å¦æ”¾å¼€äº†UDP53ç«¯å£çš„è®¿é—®(DNSä½¿ç”¨UDPåè®®ï¼Œç«¯å£53ï¼Œä½¿ç”¨iptables-saveæŸ¥çœ‹) ç¤ºä¾‹3ï¼šæ‹’ç»è®¿é—® 1234[root@linuxprobe ~]# telnet 192.168.120.206Trying 192.168.120.206...telnet: connect to address 192.168.120.206: Connection refusedtelnet: Unable to connect to remote host: Connection refused å¤„ç†è¿™ç§æƒ…å†µæ–¹æ³•ï¼šï¼ˆ1ï¼‰ç¡®è®¤IPåœ°å€æˆ–è€…ä¸»æœºåæ˜¯å¦æ­£ç¡®ï¼ˆ2ï¼‰ç¡®è®¤ç«¯å£æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦é»˜è®¤23ç«¯å£ è‹¥è¦æ£€æŸ¥192.168.120.206çš„æŸç«¯å£æ˜¯å¦èƒ½å¦èƒ½è®¿é—®ï¼Œå¦‚443ç«¯å£ï¼Œå¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ 123[root@linuxprobe ~]# telnet 192.168.120.206 443Trying 192.168.120.206...telnet: connect to address 192.168.120.206: Connection refused è¯´æ˜Žï¼šè¿™è¡¨ç¤º192.168.120.206çš„443ç«¯å£ä¸èƒ½è®¿é—® ç¤ºä¾‹4ï¼štelnet rootç”¨æˆ·çš„ç™»å…¥ 12345678910[root@linuxprobe ~]# telnet 192.168.120.204Trying 192.168.120.204...Connected to 192.168.120.204 (192.168.120.204).Escape character is '^]'. localhost (Linux release 2.6.18-274.18.1.el5 #1 SMP Thu Feb 9 12:45:44 EST 2012) (1)login: rootPassword:Login incorrect è¯´æ˜Žï¼šä¸€èˆ¬æƒ…å†µä¸‹ä¸å…è®¸rootä»Žè¿œç¨‹ç™»å½•ï¼Œå¯ä»¥å…ˆç”¨æ™®é€šè´¦å·ç™»å½•ï¼Œç„¶åŽå†su -åˆ‡åˆ°rootç”¨æˆ·ã€‚è‹¥è¦å…è®¸rootç”¨æˆ·ç™»å…¥ï¼Œå¯ç”¨ä¸‹åˆ—æ–¹æ³•ï¼š 1234[root@linuxprobe ~]# vi /etc/pam.d/login#auth required pam_securetty.so #å°†è¿™ä¸€è¡ŒåŠ ä¸Šæ³¨é‡Šï¼æˆ–[root@linuxprobe ~]# mv /etc/securetty /etc/securetty.bak ç¤ºä¾‹5ï¼šå¯ç”¨telnetæœåŠ¡ 123456789101112131415161718192021222324252627282930313233343536[root@linuxprobe ~]# cd /etc/xinetd.d/[root@linuxprobe xinetd.d]# llæ€»è®¡ 124-rw-r--r-- 1 root root 1157 2011-05-31 chargen-dgram-rw-r--r-- 1 root root 1159 2011-05-31 chargen-stream-rw-r--r-- 1 root root 523 2009-09-04 cvs-rw-r--r-- 1 root root 1157 2011-05-31 daytime-dgram-rw-r--r-- 1 root root 1159 2011-05-31 daytime-stream-rw-r--r-- 1 root root 1157 2011-05-31 discard-dgram-rw-r--r-- 1 root root 1159 2011-05-31 discard-stream-rw-r--r-- 1 root root 1148 2011-05-31 echo-dgram-rw-r--r-- 1 root root 1150 2011-05-31 echo-stream-rw-r--r-- 1 root root 323 2004-09-09 eklogin-rw-r--r-- 1 root root 347 2005-09-06 ekrb5-telnet-rw-r--r-- 1 root root 326 2004-09-09 gssftp-rw-r--r-- 1 root root 310 2004-09-09 klogin-rw-r--r-- 1 root root 323 2004-09-09 krb5-telnet-rw-r--r-- 1 root root 308 2004-09-09 kshell-rw-r--r-- 1 root root 317 2004-09-09 rsync-rw-r--r-- 1 root root 1212 2011-05-31 tcpmux-server-rw-r--r-- 1 root root 1149 2011-05-31 time-dgram-rw-r--r-- 1 root root 1150 2011-05-31 time-stream[root@linuxprobe xinetd.d]# cat krb5-telnet# default: off# description: The kerberized telnet server accepts normal telnet sessions, \# but can also use Kerberos 5 authentication.service telnet&#123; flags = REUSE socket_type = stream wait = no user = root server = /usr/kerberos/sbin/telnetd log_on_failure += USERID disable = yes&#125; é…ç½®å‚æ•°é€šå¸¸å¦‚ä¸‹ï¼š 12345678910111213141516171819service telnet&#123;disable = no #å¯ç”¨flags = REUSE #socketå¯é‡ç”¨socket_type = stream #è¿žæŽ¥æ–¹å¼ä¸ºTCPwait = no #ä¸ºæ¯ä¸ªè¯·æ±‚å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹user = root #å¯åŠ¨æœåŠ¡çš„ç”¨æˆ·ä¸ºrootserver = /usr/sbin/in.telnetd #è¦æ¿€æ´»çš„è¿›ç¨‹log_on_failure += USERID #ç™»å½•å¤±è´¥æ—¶è®°å½•ç™»å½•ç”¨æˆ·å&#125; å¦‚æžœè¦é…ç½®å…è®¸ç™»å½•çš„å®¢æˆ·ç«¯åˆ—è¡¨ï¼ŒåŠ å…¥only_from = 192.168.0.2 #åªå…è®¸192.168.0.2ç™»å½•å¦‚æžœè¦é…ç½®ç¦æ­¢ç™»å½•çš„å®¢æˆ·ç«¯åˆ—è¡¨ï¼ŒåŠ å…¥no_access = 192.168.0.{2,3,4} #ç¦æ­¢192.168.0.2ã€192.168.0.3ã€192.168.0.4ç™»å½•å¦‚æžœè¦è®¾ç½®å¼€æ”¾æ—¶æ®µï¼ŒåŠ å…¥access_times = 9:00-12:00 13:00-17:00 # æ¯å¤©åªæœ‰è¿™ä¸¤ä¸ªæ—¶æ®µå¼€æ”¾æœåŠ¡ï¼ˆæˆ‘ä»¬çš„ä¸Šç­æ—¶é—´ï¼šPï¼‰å¦‚æžœä½ æœ‰ä¸¤ä¸ªIPåœ°å€ï¼Œä¸€ä¸ªæ˜¯ç§ç½‘çš„IPåœ°å€å¦‚192.168.0.2ï¼Œä¸€ä¸ªæ˜¯å…¬ç½‘çš„IPåœ°å€å¦‚218.75.74.83ï¼Œå¦‚æžœä½ å¸Œæœ›ç”¨æˆ·åªèƒ½ä»Žç§ç½‘æ¥ç™»å½•telnetæœåŠ¡ï¼Œé‚£ä¹ˆåŠ å…¥bind = 192.168.0.2å„é…ç½®é¡¹å…·ä½“çš„å«ä¹‰å’Œè¯­æ³•å¯å‚è€ƒxinedé…ç½®æ–‡ä»¶å±žæ€§è¯´æ˜Žï¼ˆman xinetd.confï¼‰é…ç½®ç«¯å£ï¼Œä¿®æ”¹servicesæ–‡ä»¶ï¼š# vi /etc/servicesæ‰¾åˆ°ä»¥ä¸‹ä¸¤å¥telnet 23/tcptelnet 23/udpå¦‚ æžœå‰é¢æœ‰#å­—ç¬¦ï¼Œå°±åŽ»æŽ‰å®ƒã€‚telnetçš„é»˜è®¤ç«¯å£æ˜¯23ï¼Œè¿™ä¸ªç«¯å£ä¹Ÿæ˜¯é»‘å®¢ç«¯å£æ‰«æçš„ä¸»è¦å¯¹è±¡ï¼Œå› æ­¤æœ€å¥½å°†è¿™ä¸ªç«¯å£ä¿®æ”¹æŽ‰ï¼Œä¿®æ”¹çš„æ–¹æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯å°† 23è¿™ä¸ªæ•°å­—ä¿®æ”¹æŽ‰ï¼Œæ”¹æˆå¤§ä¸€ç‚¹çš„æ•°å­—ï¼Œæ¯”å¦‚61123ã€‚æ³¨æ„ï¼Œ1024ä»¥ä¸‹çš„ç«¯å£å·æ˜¯internetä¿ç•™çš„ç«¯å£å·ï¼Œå› æ­¤æœ€å¥½ä¸è¦ç”¨ï¼Œè¿˜åº”è¯¥æ³¨æ„ä¸è¦ä¸Ž å…¶å®ƒæœåŠ¡çš„ç«¯å£å†²çªã€‚å¯åŠ¨æœåŠ¡ï¼šservice xinetd restart]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[zookeeper watcheræœºåˆ¶æºç åˆ†æž]]></title>
    <url>%2F2018%2F06%2F10%2Fzookeeper-watcher%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%2F</url>
    <content type="text"><![CDATA[Watcherçš„åŸºæœ¬æµç¨‹ZooKeeper çš„ Watcher æœºåˆ¶ï¼Œæ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ï¼šå®¢æˆ·ç«¯æ³¨å†Œ Watcherã€æœåŠ¡å™¨å¤„ç† Watcher å’Œå®¢æˆ·ç«¯å›žè°ƒ Watcher å®¢æˆ·ç«¯æ³¨å†Œwatcheræœ‰3ç§æ–¹å¼ï¼ŒgetDataã€existsã€getChildrenï¼›ä»¥å¦‚ä¸‹ä»£ç ä¸ºä¾‹æ¥åˆ†æžæ•´ä¸ªè§¦å‘æœºåˆ¶çš„åŽŸç† 12345678910ZooKeeper zookeeper=new ZooKeeper(â€œ192.168.11.152:2181â€,4000,new Watcher()&#123; public void processor(WatchedEvent event)&#123; System.out.println(â€œevent.typeâ€);&#125;&#125;)ï¼›zookeeper.create(â€œ/micâ€,â€0â€.getByte(),ZooDefs.Ids. OPEN_ACL_UNSAFE,CreateModel. PERSISTENT); //åˆ›å»ºèŠ‚ç‚¹zookeeper.exists(â€œ/micâ€,true); //æ³¨å†Œç›‘å¬zookeeper.setData(â€œ/micâ€, â€œ1â€.getByte(),-1) ; //ä¿®æ”¹èŠ‚ç‚¹çš„å€¼è§¦å‘ç›‘å¬ ZooKeeper APIçš„åˆå§‹åŒ–è¿‡ç¨‹12345ZooKeeper zookeeper=new ZooKeeper(â€œ192.168.11.152:2181â€,4000,new Watcher()&#123; public void processor(WatchedEvent event)&#123; System.out.println(â€œevent.typeâ€);&#125;&#125;)ï¼› åœ¨åˆ›å»ºä¸€ä¸ª ZooKeeper å®¢æˆ·ç«¯å¯¹è±¡å®žä¾‹æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡new Watcher()å‘æž„é€ æ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ªé»˜è®¤çš„ Watcher, è¿™ä¸ª Watcher å°†ä½œä¸ºæ•´ä¸ª ZooKeeperä¼šè¯æœŸé—´çš„é»˜è®¤ Watcherï¼Œä¼šä¸€ç›´è¢«ä¿å­˜åœ¨å®¢æˆ·ç«¯ ZKWatchManager çš„ defaultWatcher ä¸­;ä»£ç å¦‚ä¸‹ 123456789101112131415161718192021public ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, boolean canBeReadOnly, HostProvider aHostProvider, ZKClientConfig clientConfig) throws IOException &#123; LOG.info("Initiating client connection, connectString=" + connectString + " sessionTimeout=" + sessionTimeout + " watcher=" + watcher); if (clientConfig == null) &#123; clientConfig = new ZKClientConfig(); &#125; this.clientConfig = clientConfig; watchManager = defaultWatchManager(); watchManager.defaultWatcher = watcher; --åœ¨è¿™é‡Œå°†watcherè®¾ç½®åˆ°ZKWatchManager ConnectStringParser connectStringParser = new ConnectStringParser( connectString); hostProvider = aHostProvider; --åˆå§‹åŒ–äº†ClientCnxnï¼Œå¹¶ä¸”è°ƒç”¨cnxn.start()æ–¹æ³• cnxn = new ClientCnxn(connectStringParser.getChrootPath(), hostProvider, sessionTimeout, this, watchManager, getClientCnxnSocket(), canBeReadOnly); cnxn.start(); &#125; ClientCnxn:æ˜¯Zookeeperå®¢æˆ·ç«¯å’ŒZookeeperæœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡å’Œäº‹ä»¶é€šçŸ¥å¤„ç†çš„ä¸»è¦ç±»ï¼Œå®ƒå†…éƒ¨åŒ…å«ä¸¤ä¸ªç±»ï¼Œ SendThread ï¼šè´Ÿè´£å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„æ•°æ®é€šä¿¡, ä¹ŸåŒ…æ‹¬äº‹ä»¶ä¿¡æ¯çš„ä¼ è¾“ EventThread : ä¸»è¦åœ¨å®¢æˆ·ç«¯å›žè°ƒæ³¨å†Œçš„Watchersè¿›è¡Œé€šçŸ¥å¤„ç† ClientCnxnåˆå§‹åŒ–123456789101112131415161718192021222324public ClientCnxn(String chrootPath, HostProvider hostProvider, int sessionTimeout, ZooKeeper zooKeeper, ClientWatchManager watcher, ClientCnxnSocket clientCnxnSocket, long sessionId, byte[] sessionPasswd, boolean canBeReadOnly) &#123; this.zooKeeper = zooKeeper; this.watcher = watcher; this.sessionId = sessionId; this.sessionPasswd = sessionPasswd; this.sessionTimeout = sessionTimeout; this.hostProvider = hostProvider; this.chrootPath = chrootPath; connectTimeout = sessionTimeout / hostProvider.size(); readTimeout = sessionTimeout * 2 / 3; readOnly = canBeReadOnly; sendThread = new SendThread(clientCnxnSocket); --åˆå§‹åŒ–sendThread eventThread = new EventThread(); --åˆå§‹åŒ–eventThread this.clientConfig=zooKeeper.getClientConfig(); &#125; public void start() &#123; --å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ sendThread.start(); eventThread.start(); &#125; å®¢æˆ·ç«¯é€šè¿‡existsæ³¨å†Œç›‘å¬1zookeeper.exists(â€œ/micâ€,true); //æ³¨å†Œç›‘å¬ é€šè¿‡existsæ–¹æ³•æ¥æ³¨å†Œç›‘å¬ï¼Œä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334 public Stat exists(final String path, Watcher watcher) throws KeeperException, InterruptedException &#123; final String clientPath = path; PathUtils.validatePath(clientPath); // the watch contains the un-chroot path WatchRegistration wcb = null; if (watcher != null) &#123; wcb = new ExistsWatchRegistration(watcher, clientPath); //æž„å»ºExistWatchRegistration &#125; final String serverPath = prependChroot(clientPath); // æž„é€ RequestHeader RequestHeader h = new RequestHeader(); h.setType(ZooDefs.OpCode.exists); //è®¾ç½®æ“ä½œç±»åž‹ä¸ºexists ExistsRequest request = new ExistsRequest(); // æž„é€ ExistsRequest request.setPath(serverPath); request.setWatch(watcher != null); //æ˜¯å¦æ³¨å†Œç›‘å¬ SetDataResponse response = new SetDataResponse(); //è®¾ç½®æœåŠ¡ç«¯å“åº”çš„æŽ¥æ”¶ç±»//å°†å°è£…çš„RequestHeaderã€ExistsRequestã€SetDataResponseã€WatchRegistrationæ·»åŠ åˆ°å‘é€é˜Ÿåˆ— ReplyHeader r = cnxn.submitRequest(h, request, response, wcb); if (r.getErr() != 0) &#123; if (r.getErr() == KeeperException.Code.NONODE.intValue()) &#123; return null; &#125; throw KeeperException.create(KeeperException.Code.get(r.getErr()), clientPath); &#125; //è¿”å›žexistså¾—åˆ°çš„ç»“æžœï¼ˆStatä¿¡æ¯ï¼‰ return response.getStat().getCzxid() == -1 ? null : response.getStat(); &#125; cnxn.submitRequest1234567891011121314public ReplyHeader submitRequest(RequestHeader h, Record request, Record response, WatchRegistration watchRegistration, WatchDeregistration watchDeregistration) throws InterruptedException &#123; ReplyHeader r = new ReplyHeader(); //å°†æ¶ˆæ¯æ·»åŠ åˆ°é˜Ÿåˆ—,å¹¶æž„é€ ä¸€ä¸ªPacketä¼ è¾“å¯¹è±¡ Packet packet = queuePacket(h, r, request, response, null, null, null, null, watchRegistration, watchDeregistration); synchronized (packet) &#123; while (!packet.finished) &#123; //åœ¨æ•°æ®åŒ…æ²¡æœ‰å¤„ç†å®Œæˆä¹‹å‰ï¼Œä¸€ç›´é˜»å¡ž packet.wait(); &#125; &#125; return r; &#125; å°†RequestHeader h, ReplyHeader r, Record request, Record responseï¼Œå°è£…æˆpackageï¼Œ æ·»åŠ åˆ°outgoingQueueé˜Ÿåˆ—ä¸­ï¼Œå†å”¤é†’sendThread,é€šçŸ¥æœ‰æ•°æ®åŒ…è¿‡æ¥ã€‚outgoingQueueæ˜¯ä¸€ä¸ªé˜»å¡žé˜Ÿåˆ—ï¼ŒoutgoingQueueæ˜¯å¾…å‘é€çš„é˜Ÿåˆ—ã€‚ 1private final LinkedBlockingDeque&lt;Packet&gt; outgoingQueue = new LinkedBlockingDeque&lt;Packet&gt;(); 1234567891011121314151617181920212223242526public Packet queuePacket(RequestHeader h, ReplyHeader r, Record request, Record response, AsyncCallback cb, String clientPath, String serverPath, Object ctx, WatchRegistration watchRegistration, WatchDeregistration watchDeregistration) &#123; //å°†ç›¸å…³ä¼ è¾“å¯¹è±¡è½¬åŒ–æˆPacket Packet packet = null; packet = new Packet(h, r, request, response, watchRegistration); packet.cb = cb; packet.ctx = ctx; packet.clientPath = clientPath; packet.serverPath = serverPath; packet.watchDeregistration = watchDeregistration; synchronized (state) &#123; if (!state.isAlive() || closing) &#123; conLossPacket(packet); &#125; else &#123; if (h.getType() == OpCode.closeSession) &#123; closing = true; &#125; outgoingQueue.add(packet); //æ·»åŠ åˆ°outgoingQueue &#125; &#125; sendThread.getClientCnxnSocket().packetAdded();//æ­¤å¤„æ˜¯å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œå”¤é†’Selectorï¼Œå‘Šè¯‰ä»–æœ‰æ•°æ®åŒ…æ·»åŠ è¿‡æ¥äº† return packet;&#125; åœ¨ ZooKeeper ä¸­ï¼ŒPacket æ˜¯ä¸€ä¸ªæœ€å°çš„é€šä¿¡åè®®å•å…ƒï¼Œå³æ•°æ®åŒ…ã€‚Pakcet ç”¨äºŽè¿›è¡Œå®¢æˆ·ç«¯ä¸ŽæœåŠ¡ç«¯ä¹‹é—´çš„ç½‘ç»œä¼ è¾“ï¼Œä»»ä½•éœ€è¦ä¼ è¾“çš„å¯¹è±¡éƒ½éœ€è¦åŒ…è£…æˆä¸€ä¸ª Packet å¯¹è±¡ã€‚åœ¨ ClientCnxn ä¸­ WatchRegistration ä¹Ÿä¼šè¢«å°è£…åˆ° Pakcet ä¸­ï¼Œç„¶åŽç”± SendThread çº¿ç¨‹è°ƒç”¨queuePacketæ–¹æ³•æŠŠ Packet æ”¾å…¥å‘é€é˜Ÿåˆ—ä¸­ç­‰å¾…å®¢æˆ·ç«¯å‘é€ï¼Œè¿™åˆæ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿé‡‡ç”¨å¼‚æ­¥é€šä¿¡æ˜¯ä¸€ä¸ªéžå¸¸å¸¸è§çš„æ‰‹æ®µã€‚ SendThreadçš„å‘é€è¿‡ç¨‹åœ¨åˆå§‹åŒ–è¿žæŽ¥çš„æ—¶å€™ï¼Œzookeeperåˆå§‹åŒ–äº†ä¸¤ä¸ªçº¿ç¨‹å¹¶ä¸”å¯åŠ¨äº†ã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æžSendThreadçš„å‘é€è¿‡ç¨‹ï¼Œå› ä¸ºæ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥å¯åŠ¨çš„æ—¶å€™ä¼šè°ƒç”¨SendThread.runæ–¹æ³•ã€‚ runæ–¹æ³•ä¸­ï¼Œé€šè¿‡clientCnxnSocketï¼ŒåŽ»æ‹¿é˜Ÿåˆ—çš„æ•°æ®å¤„ç†ã€‚ 1clientCnxnSocket.doTransport(to, pendingQueue, ClientCnxn.this); 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152public void run() &#123; clientCnxnSocket.introduce(this, sessionId, outgoingQueue); clientCnxnSocket.updateNow(); clientCnxnSocket.updateLastSendAndHeard(); int to; long lastPingRwServer = Time.currentElapsedTime(); final int MAX_SEND_PING_INTERVAL = 10000; //10 seconds while (state.isAlive()) &#123; try &#123; if (!clientCnxnSocket.isConnected()) &#123;// å¦‚æžœæ²¡æœ‰è¿žæŽ¥ï¼šå‘èµ·è¿žæŽ¥ // don't re-establish connection if we are closing if (closing) &#123; break; &#125; startConnect(); //å‘èµ·è¿žæŽ¥ clientCnxnSocket.updateLastSendAndHeard(); &#125; if (state.isConnected()) &#123; //å¦‚æžœæ˜¯è¿žæŽ¥çŠ¶æ€ï¼Œåˆ™å¤„ç†saslçš„è®¤è¯æŽˆæƒ // determine whether we need to send an AuthFailed event. if (zooKeeperSaslClient != null) &#123; boolean sendAuthEvent = false; if (zooKeeperSaslClient.getSaslState() == ZooKeeperSaslClient.SaslState.INITIAL) &#123; try &#123; zooKeeperSaslClient.initialize(ClientCnxn.this); &#125; catch (SaslException e) &#123; LOG.error("SASL authentication with Zookeeper Quorum member failed: " + e); state = States.AUTH_FAILED; sendAuthEvent = true; &#125; &#125; KeeperState authState = zooKeeperSaslClient.getKeeperState(); if (authState != null) &#123; if (authState == KeeperState.AuthFailed) &#123; // An authentication error occurred during authentication with the Zookeeper Server. state = States.AUTH_FAILED; sendAuthEvent = true; &#125; else &#123; if (authState == KeeperState.SaslAuthenticated) &#123; sendAuthEvent = true; &#125; &#125; &#125; if (sendAuthEvent == true) &#123; eventThread.queueEvent(new WatchedEvent( Watcher.Event.EventType.None, authState,null)); &#125; &#125; to = readTimeout - clientCnxnSocket.getIdleRecv(); &#125; else &#123; to = connectTimeout - clientCnxnSocket.getIdleRecv(); &#125; //to,è¡¨ç¤ºå®¢æˆ·ç«¯è·ç¦»timeoutè¿˜å‰©å¤šå°‘æ—¶é—´ï¼Œå‡†å¤‡å‘èµ·pingè¿žæŽ¥ if (to &lt;= 0) &#123;//è¡¨ç¤ºå·²ç»è¶…æ—¶äº†ã€‚ String warnInfo; warnInfo = "Client session timed out, have not heard from server in " + clientCnxnSocket.getIdleRecv() + "ms" + " for sessionid 0x" + Long.toHexString(sessionId); LOG.warn(warnInfo); throw new SessionTimeoutException(warnInfo); &#125; if (state.isConnected()) &#123; //è®¡ç®—ä¸‹ä¸€æ¬¡pingè¯·æ±‚çš„æ—¶é—´ int timeToNextPing = readTimeout / 2 - clientCnxnSocket.getIdleSend() - ((clientCnxnSocket.getIdleSend() &gt; 1000) ? 1000 : 0); //send a ping request either time is due or no packet sent out within MAX_SEND_PING_INTERVAL if (timeToNextPing &lt;= 0 || clientCnxnSocket.getIdleSend() &gt; MAX_SEND_PING_INTERVAL) &#123; sendPing(); //å‘é€pingè¯·æ±‚ clientCnxnSocket.updateLastSend(); &#125; else &#123; if (timeToNextPing &lt; to) &#123; to = timeToNextPing; &#125; &#125; &#125; // If we are in read-only mode, seek for read/write server if (state == States.CONNECTEDREADONLY) &#123; long now = Time.currentElapsedTime(); int idlePingRwServer = (int) (now - lastPingRwServer); if (idlePingRwServer &gt;= pingRwTimeout) &#123; lastPingRwServer = now; idlePingRwServer = 0; pingRwTimeout = Math.min(2*pingRwTimeout, maxPingRwTimeout); pingRwServer(); &#125; to = Math.min(to, pingRwTimeout - idlePingRwServer); &#125; è°ƒç”¨clientCnxnSocketï¼Œå‘èµ·ä¼ è¾“ å…¶ä¸­ pendingQueueæ˜¯ä¸€ä¸ªç”¨æ¥å­˜æ”¾å·²ç»å‘é€ã€ç­‰å¾…å›žåº”çš„Packeté˜Ÿåˆ—ï¼ŒclientCnxnSocketé»˜è®¤ä½¿ç”¨ClientCnxnSocketNIOï¼ˆpsï¼šè¿˜è®°å¾—åœ¨å“ªé‡Œåˆå§‹åŒ–å—ï¼Ÿåœ¨å®žä¾‹åŒ–zookeeperçš„æ—¶å€™ï¼‰ clientCnxnSocket.doTransport(to, pendingQueue, ClientCnxn.this); &#125; catch (Throwable e) &#123; if (closing) &#123; if (LOG.isDebugEnabled()) &#123; // closing so this is expected LOG.debug("An exception was thrown while closing send thread for session 0x" + Long.toHexString(getSessionId()) + " : " + e.getMessage()); &#125; break; &#125; else &#123; // this is ugly, you have a better way speak up if (e instanceof SessionExpiredException) &#123; LOG.info(e.getMessage() + ", closing socket connection"); &#125; else if (e instanceof SessionTimeoutException) &#123; LOG.info(e.getMessage() + RETRY_CONN_MSG); &#125; else if (e instanceof EndOfStreamException) &#123; LOG.info(e.getMessage() + RETRY_CONN_MSG); &#125; else if (e instanceof RWServerFoundException) &#123; LOG.info(e.getMessage()); &#125; else &#123; LOG.warn( "Session 0x" + Long.toHexString(getSessionId()) + " for server " + clientCnxnSocket.getRemoteSocketAddress() + ", unexpected error" + RETRY_CONN_MSG, e); &#125; // At this point, there might still be new packets appended to outgoingQueue. // they will be handled in next connection or cleared up if closed. cleanup(); if (state.isAlive()) &#123; eventThread.queueEvent(new WatchedEvent( Event.EventType.None, Event.KeeperState.Disconnected, null)); &#125; clientCnxnSocket.updateNow(); clientCnxnSocket.updateLastSendAndHeard(); &#125; &#125; &#125; synchronized (state) &#123; // When it comes to this point, it guarantees that later queued // packet to outgoingQueue will be notified of death. cleanup(); &#125; clientCnxnSocket.close(); if (state.isAlive()) &#123; eventThread.queueEvent(new WatchedEvent(Event.EventType.None, Event.KeeperState.Disconnected, null)); &#125; ZooTrace.logTraceMessage(LOG, ZooTrace.getTextTraceLevel(), "SendThread exited loop for session: 0x" + Long.toHexString(getSessionId())); &#125; client å’Œ serverçš„ç½‘ç»œäº¤äº’doTransportæœ‰ä¸¤ç§å®žçŽ°ï¼Œä¸€ç§java nioï¼Œå¦ä¸€ç§æ˜¯netty è¿™é‡Œå°±æ˜¯sendThreadçš„runæ–¹æ³•ï¼Œå‘é€æ•°æ®çš„å…·ä½“ä»£ç ã€‚pendingQueueè¡¨ç¤ºå¤„äºŽå·²ç»å‘é€è¿‡ç­‰å¾…å“åº”çš„packeté˜Ÿåˆ—ã€‚outgoingQueueä¸ºå¾…å‘é€çš„æ•°æ®åŒ…é˜Ÿåˆ—ã€‚è¿™é‡Œå…ˆä»ŽoutgoingQueue.pollå‡ºä¸€ä¸ªpackageï¼Œå‡†å¤‡å‘é€ã€‚å†è°ƒç”¨doWrite(pendingQueue, head, cnxn)æ”¾å…¥pendingQueueä¸­ï¼Œç­‰å¾…serverçš„å“åº”ã€‚ 12345678910111213141516171819202122232425262728293031323334353637@Override void doTransport(int waitTimeOut, List&lt;Packet&gt; pendingQueue, ClientCnxn cnxn) throws IOException, InterruptedException &#123; try &#123; if (!firstConnect.await(waitTimeOut, TimeUnit.MILLISECONDS)) &#123; return; &#125; Packet head = null; if (needSasl.get()) &#123; if (!waitSasl.tryAcquire(waitTimeOut, TimeUnit.MILLISECONDS)) &#123; return; &#125; &#125; else &#123; //åˆ¤æ–­outgoingQueueæ˜¯å¦å­˜åœ¨å¾…å‘é€çš„æ•°æ®åŒ…ï¼Œä¸å­˜åœ¨åˆ™ç›´æŽ¥è¿”å›ž if ((head = outgoingQueue.poll(waitTimeOut, TimeUnit.MILLISECONDS)) == null) &#123; return; &#125; &#125; // check if being waken up on closing. if (!sendThread.getZkState().isAlive()) &#123; // adding back the patck to notify of failure in conLossPacket(). addBack(head); return; &#125; // channel disconnection happened if (disconnected.get()) &#123; //å¼‚å¸¸æµç¨‹ï¼Œchannelå…³é—­äº†ï¼Œè®²å½“å‰çš„packetæ·»åŠ åˆ°addBackä¸­ addBack(head); throw new EndOfStreamException("channel for sessionid 0x" + Long.toHexString(sessionId) + " is lost"); &#125; if (head != null) &#123; //å¦‚æžœå½“å‰å­˜åœ¨éœ€è¦å‘é€çš„æ•°æ®åŒ…ï¼Œåˆ™è°ƒç”¨doWriteæ–¹æ³•ï¼ŒpendingQueueè¡¨ç¤ºå¤„äºŽå·²ç»å‘é€è¿‡ç­‰å¾…å“åº”çš„packeté˜Ÿåˆ— doWrite(pendingQueue, head, cnxn); &#125; &#125; finally &#123; updateNow(); &#125; &#125; DoWriteæ–¹æ³•å°†å½“å‰çš„packetæ·»åŠ åˆ°pendingQueueé˜Ÿåˆ—ä¸­ 1234567891011121314151617181920private void doWrite(List&lt;Packet&gt; pendingQueue, Packet p, ClientCnxn cnxn) &#123; updateNow(); while (true) &#123; if (p != WakeupPacket.getInstance()) &#123; if ((p.requestHeader != null) &amp;&amp; //åˆ¤æ–­è¯·æ±‚å¤´ä»¥åŠåˆ¤æ–­å½“å‰è¯·æ±‚ç±»åž‹ä¸æ˜¯pingæˆ–è€…authæ“ä½œ (p.requestHeader.getType() != ZooDefs.OpCode.ping) &amp;&amp; (p.requestHeader.getType() != ZooDefs.OpCode.auth)) &#123; p.requestHeader.setXid(cnxn.getXid()); //è®¾ç½®xidï¼Œè¿™ä¸ªxidç”¨æ¥åŒºåˆ†è¯·æ±‚ç±»åž‹ synchronized (pendingQueue) &#123; pendingQueue.add(p); //å°†å½“å‰çš„packetæ·»åŠ åˆ°pendingQueueé˜Ÿåˆ—ä¸­ &#125; &#125; sendPkt(p); //å°†æ•°æ®åŒ…å‘é€å‡ºåŽ» &#125; if (outgoingQueue.isEmpty()) &#123; break; &#125; p = outgoingQueue.remove(); &#125;&#125; sendPkté€šè¿‡nio channelå‘é€å­—èŠ‚ç¼“å­˜åˆ°æœåŠ¡ç«¯ 12345678private void sendPkt(Packet p) &#123; // Assuming the packet will be sent out successfully. Because if it fails, // the channel will close and clean up queues. p.createBB(); //åºåˆ—åŒ–è¯·æ±‚æ•°æ® updateLastSend(); //æ›´æ–°æœ€åŽä¸€æ¬¡å‘é€updateLastSend sentCount++; //æ›´æ–°å‘é€æ¬¡æ•° channel.write(ChannelBuffers.wrappedBuffer(p.bb)); //é€šè¿‡nio channelå‘é€å­—èŠ‚ç¼“å­˜åˆ°æœåŠ¡ç«¯ &#125; createBB1234567891011121314151617181920212223public void createBB() &#123; try &#123; ByteArrayOutputStream baos = new ByteArrayOutputStream(); BinaryOutputArchive boa = BinaryOutputArchive.getArchive(baos); boa.writeInt(-1, "len"); // We'll fill this in later if (requestHeader != null) &#123; requestHeader.serialize(boa, "header"); //åºåˆ—åŒ–headerå¤´(requestHeader) &#125; if (request instanceof ConnectRequest) &#123; request.serialize(boa, "connect"); // append "am-I-allowed-to-be-readonly" flag boa.writeBool(readOnly, "readOnly"); &#125; else if (request != null) &#123; request.serialize(boa, "request"); //åºåˆ—åŒ–request(request) &#125; baos.close(); this.bb = ByteBuffer.wrap(baos.toByteArray()); this.bb.putInt(this.bb.capacity() - 4); this.bb.rewind(); &#125; catch (IOException e) &#123; LOG.warn("Ignoring unexpected exception", e); &#125; &#125; ä»ŽcreateBBæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨åº•å±‚å®žé™…çš„ç½‘ç»œä¼ è¾“åºåˆ—åŒ–ä¸­ï¼Œzookeeperåªä¼šè®²requestHeaderå’Œrequestä¸¤ä¸ªå±žæ€§è¿›è¡Œåºåˆ—åŒ–ï¼Œå³åªæœ‰è¿™ä¸¤ä¸ªä¼šè¢«åºåˆ—åŒ–åˆ°åº•å±‚å­—èŠ‚æ•°ç»„ä¸­åŽ»è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œä¸ä¼šå°†watchRegistrationç›¸å…³çš„ä¿¡æ¯è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚ æ€»ç»“ç”¨æˆ·è°ƒç”¨existsæ³¨å†Œç›‘å¬ä»¥åŽï¼Œä¼šåšå‡ ä¸ªäº‹æƒ… è®²è¯·æ±‚æ•°æ®å°è£…ä¸ºpacketï¼Œæ·»åŠ åˆ°outgoingQueue SendThreadè¿™ä¸ªçº¿ç¨‹ä¼šæ‰§è¡Œæ•°æ®å‘é€æ“ä½œï¼Œä¸»è¦æ˜¯å°†outgoingQueueé˜Ÿåˆ—ä¸­çš„æ•°æ®å‘é€åˆ°æœåŠ¡ç«¯ é€šè¿‡clientCnxnSocket.doTransport(to, pendingQueue, ClientCnxn.this); å…¶ä¸­ClientCnxnSocketåªzookeeperå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è¿žæŽ¥é€šä¿¡çš„å°è£…ï¼Œæœ‰ä¸¤ä¸ªå…·ä½“çš„å®žçŽ°ç±»ClientCnxnSocketNettyå’ŒClientCnxnSocketNIO;å…·ä½“ä½¿ç”¨å“ªä¸€ä¸ªç±»æ¥å®žçŽ°å‘é€ï¼Œæ˜¯åœ¨åˆå§‹åŒ–è¿‡ç¨‹æ˜¯åœ¨å®žä¾‹åŒ–Zookeeperçš„æ—¶å€™è®¾ç½®çš„ï¼Œä»£ç å¦‚ä¸‹ 12345678910111213141516171819cnxn = new ClientCnxn(connectStringParser.getChrootPath(), hostProvider, sessionTimeout, this, watchManager, getClientCnxnSocket(), canBeReadOnly); private ClientCnxnSocket getClientCnxnSocket() throws IOException &#123; String clientCnxnSocketName = getClientConfig().getProperty( ZKClientConfig.ZOOKEEPER_CLIENT_CNXN_SOCKET); if (clientCnxnSocketName == null) &#123; clientCnxnSocketName = ClientCnxnSocketNIO.class.getName(); &#125; try &#123; Constructor&lt;?&gt; clientCxnConstructor = Class.forName(clientCnxnSocketName).getDeclaredConstructor(ZKClientConfig.class); ClientCnxnSocket clientCxnSocket = (ClientCnxnSocket) clientCxnConstructor.newInstance(getClientConfig()); return clientCxnSocket; &#125; catch (Exception e) &#123; IOException ioe = new IOException("Couldn't instantiate " + clientCnxnSocketName); ioe.initCause(e); throw ioe; &#125; &#125; åŸºäºŽç¬¬3æ­¥ï¼Œæœ€ç»ˆä¼šåœ¨ClientCnxnSocketNettyæ–¹æ³•ä¸­æ‰§è¡ŒsendPktå°†è¯·æ±‚çš„æ•°æ®åŒ…å‘é€åˆ°æœåŠ¡ç«¯ æœåŠ¡ç«¯æŽ¥æ”¶è¯·æ±‚å¤„ç†æµç¨‹æœåŠ¡ç«¯æœ‰ä¸€ä¸ªNettyServerCnxnç±»ï¼Œç”¨æ¥å¤„ç†å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ã€‚ é€šè¿‡zks.processPacket(this, bb)å¤„ç†å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ•°æ®åŒ…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109public void receiveMessage(ChannelBuffer message) &#123; try &#123; while(message.readable() &amp;&amp; !throttled) &#123; if (bb != null) &#123; //ByteBufferä¸ä¸ºç©º if (LOG.isTraceEnabled()) &#123; LOG.trace("message readable " + message.readableBytes() + " bb len " + bb.remaining() + " " + bb); ByteBuffer dat = bb.duplicate(); dat.flip(); LOG.trace(Long.toHexString(sessionId) + " bb 0x" + ChannelBuffers.hexDump( ChannelBuffers.copiedBuffer(dat))); &#125; //bbå‰©ä½™ç©ºé—´å¤§äºŽmessageä¸­å¯è¯»å­—èŠ‚å¤§å° if (bb.remaining() &gt; message.readableBytes()) &#123; int newLimit = bb.position() + message.readableBytes(); bb.limit(newLimit); &#125; // å°†messageå†™å…¥bbä¸­ message.readBytes(bb); bb.limit(bb.capacity()); if (LOG.isTraceEnabled()) &#123; LOG.trace("after readBytes message readable " + message.readableBytes() + " bb len " + bb.remaining() + " " + bb); ByteBuffer dat = bb.duplicate(); dat.flip(); LOG.trace("after readbytes " + Long.toHexString(sessionId) + " bb 0x" + ChannelBuffers.hexDump( ChannelBuffers.copiedBuffer(dat))); &#125; if (bb.remaining() == 0) &#123; // å·²ç»è¯»å®Œmessageï¼Œè¡¨ç¤ºå†…å®¹å·²ç»å…¨éƒ¨æŽ¥æ”¶ packetReceived(); // ç»Ÿè®¡æŽ¥æ”¶ä¿¡æ¯ bb.flip(); ZooKeeperServer zks = this.zkServer; if (zks == null || !zks.isRunning()) &#123;//ZookeeperæœåŠ¡å™¨ä¸ºç©º ,è¯´æ˜ŽæœåŠ¡ç«¯æŒ‚äº† throw new IOException("ZK down"); &#125; if (initialized) &#123; //å¤„ç†å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ•°æ®åŒ… zks.processPacket(this, bb); if (zks.shouldThrottle(outstandingCount.incrementAndGet())) &#123; disableRecvNoWait(); &#125; &#125; else &#123; LOG.debug("got conn req request from " + getRemoteSocketAddress()); zks.processConnectRequest(this, bb); initialized = true; &#125; bb = null; &#125; &#125; else &#123; //bbä¸ºnullçš„æƒ…å†µï¼Œå¤§å®¶è‡ªå·±åŽ»çœ‹ï¼Œæˆ‘å°±ä¸ç»†è®²äº† if (LOG.isTraceEnabled()) &#123; LOG.trace("message readable " + message.readableBytes() + " bblenrem " + bbLen.remaining()); ByteBuffer dat = bbLen.duplicate(); dat.flip(); LOG.trace(Long.toHexString(sessionId) + " bbLen 0x" + ChannelBuffers.hexDump( ChannelBuffers.copiedBuffer(dat))); &#125; if (message.readableBytes() &lt; bbLen.remaining()) &#123; bbLen.limit(bbLen.position() + message.readableBytes()); &#125; message.readBytes(bbLen); bbLen.limit(bbLen.capacity()); if (bbLen.remaining() == 0) &#123; bbLen.flip(); if (LOG.isTraceEnabled()) &#123; LOG.trace(Long.toHexString(sessionId) + " bbLen 0x" + ChannelBuffers.hexDump( ChannelBuffers.copiedBuffer(bbLen))); &#125; int len = bbLen.getInt(); if (LOG.isTraceEnabled()) &#123; LOG.trace(Long.toHexString(sessionId) + " bbLen len is " + len); &#125; bbLen.clear(); if (!initialized) &#123; if (checkFourLetterWord(channel, message, len)) &#123; return; &#125; &#125; if (len &lt; 0 || len &gt; BinaryInputArchive.maxBuffer) &#123; throw new IOException("Len error " + len); &#125; bb = ByteBuffer.allocate(len); &#125; &#125; &#125; &#125; catch(IOException e) &#123; LOG.warn("Closing connection to " + getRemoteSocketAddress(), e); close(); &#125; &#125; NettyServerCnxnZookeeperServer-zks.processPacket(this, bb);å¤„ç†å®¢æˆ·ç«¯ä¼ é€è¿‡æ¥çš„æ•°æ®åŒ…ï¼Œå°è£…è¯·æ±‚å¯¹è±¡ï¼Œå¹¶å‘é€ã€‚ 12Request si = new Request(cnxn, cnxn.getSessionId(), h.getXid(), h.getType(), incomingBuffer, cnxn.getAuthInfo()); 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public void processPacket(ServerCnxn cnxn, ByteBuffer incomingBuffer) throws IOException &#123; // We have the request, now process and setup for next InputStream bais = new ByteBufferInputStream(incomingBuffer); BinaryInputArchive bia = BinaryInputArchive.getArchive(bais); RequestHeader h = new RequestHeader(); h.deserialize(bia, "header"); //ååºåˆ—åŒ–å®¢æˆ·ç«¯headerå¤´ä¿¡æ¯ // Through the magic of byte buffers, txn will not be // pointing // to the start of the txn incomingBuffer = incomingBuffer.slice(); if (h.getType() == OpCode.auth) &#123; //åˆ¤æ–­å½“å‰æ“ä½œç±»åž‹ï¼Œå¦‚æžœæ˜¯authæ“ä½œï¼Œåˆ™æ‰§è¡Œä¸‹é¢çš„ä»£ç  LOG.info("got auth packet " + cnxn.getRemoteSocketAddress()); AuthPacket authPacket = new AuthPacket(); ByteBufferInputStream.byteBuffer2Record(incomingBuffer, authPacket); String scheme = authPacket.getScheme(); ServerAuthenticationProvider ap = ProviderRegistry.getServerProvider(scheme); Code authReturn = KeeperException.Code.AUTHFAILED; if(ap != null) &#123; try &#123; authReturn = ap.handleAuthentication(new ServerAuthenticationProvider.ServerObjs(this, cnxn), authPacket.getAuth()); &#125; catch(RuntimeException e) &#123; LOG.warn("Caught runtime exception from AuthenticationProvider: " + scheme + " due to " + e); authReturn = KeeperException.Code.AUTHFAILED; &#125; &#125; if (authReturn == KeeperException.Code.OK) &#123; if (LOG.isDebugEnabled()) &#123; LOG.debug("Authentication succeeded for scheme: " + scheme); &#125; LOG.info("auth success " + cnxn.getRemoteSocketAddress()); ReplyHeader rh = new ReplyHeader(h.getXid(), 0, KeeperException.Code.OK.intValue()); cnxn.sendResponse(rh, null, null); &#125; else &#123; if (ap == null) &#123; LOG.warn("No authentication provider for scheme: " + scheme + " has " + ProviderRegistry.listProviders()); &#125; else &#123; LOG.warn("Authentication failed for scheme: " + scheme); &#125; // send a response... ReplyHeader rh = new ReplyHeader(h.getXid(), 0, KeeperException.Code.AUTHFAILED.intValue()); cnxn.sendResponse(rh, null, null); // ... and close connection cnxn.sendBuffer(ServerCnxnFactory.closeConn); cnxn.disableRecv(); &#125; return; &#125; else &#123; //å¦‚æžœä¸æ˜¯æŽˆæƒæ“ä½œï¼Œå†åˆ¤æ–­æ˜¯å¦ä¸ºsaslæ“ä½œ if (h.getType() == OpCode.sasl) &#123; Record rsp = processSasl(incomingBuffer,cnxn); ReplyHeader rh = new ReplyHeader(h.getXid(), 0, KeeperException.Code.OK.intValue()); cnxn.sendResponse(rh,rsp, "response"); // not sure about 3rd arg..what is it? return; &#125; else &#123;//æœ€ç»ˆè¿›å…¥è¿™ä¸ªä»£ç å—è¿›è¡Œå¤„ç† //å°è£…è¯·æ±‚å¯¹è±¡ Request si = new Request(cnxn, cnxn.getSessionId(), h.getXid(), h.getType(), incomingBuffer, cnxn.getAuthInfo()); si.setOwner(ServerCnxn.me); // Always treat packet from the client as a possible // local request. setLocalSessionFlag(si); submitRequest(si); //æäº¤è¯·æ±‚ &#125; &#125; cnxn.incrOutstandingRequests(h); &#125; submitRequestè´Ÿè´£åœ¨æœåŠ¡ç«¯æäº¤å½“å‰è¯·æ±‚ 123456789101112131415161718192021222324252627282930313233343536373839public void submitRequest(Request si) &#123; if (firstProcessor == null) &#123; //processorå¤„ç†å™¨ï¼Œrequestè¿‡æ¥ä»¥åŽä¼šç»åŽ†ä¸€ç³»åˆ—å¤„ç†å™¨çš„å¤„ç†è¿‡ç¨‹ synchronized (this) &#123; try &#123; // Since all requests are passed to the request // processor it should wait for setting up the request // processor chain. The state will be updated to RUNNING // after the setup. while (state == State.INITIAL) &#123; wait(1000); &#125; &#125; catch (InterruptedException e) &#123; LOG.warn("Unexpected interruption", e); &#125; if (firstProcessor == null || state != State.RUNNING) &#123; throw new RuntimeException("Not started"); &#125; &#125; &#125; try &#123; touch(si.cnxn); boolean validpacket = Request.isValid(si.type); //åˆ¤æ–­æ˜¯å¦åˆæ³• if (validpacket) &#123; firstProcessor.processRequest(si); è°ƒç”¨firstProcessorå‘èµ·è¯·æ±‚ï¼Œè€Œè¿™ä¸ªfirstProcessæ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œæœ‰å¤šä¸ªå®žçŽ°ç±»ï¼Œå…·ä½“çš„è°ƒç”¨é“¾æ˜¯æ€Žä¹ˆæ ·çš„ï¼Ÿå¾€ä¸‹çœ‹å§ if (si.cnxn != null) &#123; incInProcess(); &#125; &#125; else &#123; LOG.warn("Received packet at server of unknown type " + si.type); new UnimplementedRequestProcessor().processRequest(si); &#125; &#125; catch (MissingSessionException e) &#123; if (LOG.isDebugEnabled()) &#123; LOG.debug("Dropping request: " + e.getMessage()); &#125; &#125; catch (RequestProcessorException e) &#123; LOG.error("Unable to process request:" + e.getMessage(), e); &#125; &#125; firstProcessorçš„è¯·æ±‚é“¾ç»„æˆ firstProcessorçš„åˆå§‹åŒ–æ˜¯åœ¨ZookeeperServerçš„setupRequestProcessorä¸­å®Œæˆçš„ï¼Œä»£ç å¦‚ä¸‹ 1234567protected void setupRequestProcessors() &#123; RequestProcessor finalProcessor = new FinalRequestProcessor(this); RequestProcessor syncProcessor = new SyncRequestProcessor(this, finalProcessor); ((SyncRequestProcessor)syncProcessor).start(); firstProcessor = new PrepRequestProcessor(this, syncProcessor);//éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒPrepRequestProcessorä¸­ä¼ é€’çš„æ˜¯ä¸€ä¸ªsyncProcessor ((PrepRequestProcessor)firstProcessor).start(); &#125; ä»Žä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°firstProcessorçš„å®žä¾‹æ˜¯ä¸€ä¸ªPrepRequestProcessorï¼Œè€Œè¿™ä¸ªæž„é€ æ–¹æ³•ä¸­åˆä¼ é€’äº†ä¸€ä¸ªProcessoræž„æˆäº†ä¸€ä¸ªè°ƒç”¨é“¾ã€‚ RequestProcessor syncProcessor = new SyncRequestProcessor(this, finalProcessor); è€ŒsyncProcessorçš„æž„é€ æ–¹æ³•ä¼ é€’çš„åˆæ˜¯ä¸€ä¸ªProcessorï¼Œå¯¹åº”çš„æ˜¯FinalRequestProcessor æ‰€ä»¥æ•´ä¸ªè°ƒç”¨é“¾æ˜¯PrepRequestProcessor -&gt; SyncRequestProcessor -&gt;FinalRequestProcessor PredRequestProcessor.processRequest(si);é€šè¿‡ä¸Šé¢äº†è§£åˆ°è°ƒç”¨é“¾å…³ç³»ä»¥åŽï¼Œæˆ‘ä»¬ç»§ç»­å†çœ‹firstProcessor.processRequest(si)ï¼› ä¼šè°ƒç”¨åˆ°PrepRequestProcessor å”‰ï¼Œå¾ˆå¥‡æ€ªï¼ŒprocessRequeståªæ˜¯æŠŠrequestæ·»åŠ åˆ°submittedRequestsä¸­ï¼Œæ ¹æ®å‰é¢çš„ç»éªŒï¼Œå¾ˆè‡ªç„¶çš„æƒ³åˆ°è¿™é‡Œåˆæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚è€ŒsubittedRequestsåˆæ˜¯ä¸€ä¸ªé˜»å¡žé˜Ÿåˆ— LinkedBlockingQueue&lt;Request&gt; submittedRequests = new LinkedBlockingQueue&lt;Request&gt;(); è€ŒPrepRequestProcessorè¿™ä¸ªç±»åˆç»§æ‰¿äº†çº¿ç¨‹ç±»ï¼Œå› æ­¤æˆ‘ä»¬ç›´æŽ¥æ‰¾åˆ°å½“å‰ç±»ä¸­çš„runæ–¹æ³•å¦‚ä¸‹ 1234567891011121314151617181920212223242526public void run() &#123; try &#123; while (true) &#123; Request request = submittedRequests.take(); //okï¼Œä»Žé˜Ÿåˆ—ä¸­æ‹¿åˆ°è¯·æ±‚è¿›è¡Œå¤„ç† long traceMask = ZooTrace.CLIENT_REQUEST_TRACE_MASK; if (request.type == OpCode.ping) &#123; traceMask = ZooTrace.CLIENT_PING_TRACE_MASK; &#125; if (LOG.isTraceEnabled()) &#123; ZooTrace.logRequest(LOG, traceMask, 'P', request, ""); &#125; if (Request.requestOfDeath == request) &#123; break; &#125; pRequest(request); //è°ƒç”¨pRequestè¿›è¡Œé¢„å¤„ç† &#125; &#125; catch (RequestProcessorException e) &#123; if (e.getCause() instanceof XidRolloverException) &#123; LOG.info(e.getCause().getMessage()); &#125; handleException(this.getName(), e); &#125; catch (Exception e) &#123; handleException(this.getName(), e); &#125; LOG.info("PrepRequestProcessor exited loop!"); &#125; pRequesté¢„å¤„ç†è¿™å—çš„ä»£ç å¤ªé•¿ï¼Œå°±ä¸å¥½è´´äº†ã€‚å‰é¢çš„Nè¡Œä»£ç éƒ½æ˜¯æ ¹æ®å½“å‰çš„OPç±»åž‹è¿›è¡Œåˆ¤æ–­å’Œåšç›¸åº”çš„å¤„ç†ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­çš„æœ€åŽä¸€è¡Œä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹ä»£ç  1nextProcessor.processRequest(request); å¾ˆæ˜¾ç„¶ï¼ŒnextProcessorå¯¹åº”çš„åº”è¯¥æ˜¯SyncRequestProcessor SyncRequestProcessor. processRequest1234public void processRequest(Request request) &#123; // request.addRQRec("&gt;sync"); queuedRequests.add(request); &#125; è¿™ä¸ªæ–¹æ³•çš„ä»£ç ä¹Ÿæ˜¯ä¸€æ ·ï¼ŒåŸºäºŽå¼‚æ­¥åŒ–çš„æ“ä½œï¼ŒæŠŠè¯·æ±‚æ·»åŠ åˆ°queuedRequetsä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»§ç»­åœ¨å½“å‰ç±»æ‰¾åˆ°runæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374public void run() &#123; try &#123; int logCount = 0; // we do this in an attempt to ensure that not all of the servers // in the ensemble take a snapshot at the same time int randRoll = r.nextInt(snapCount/2); while (true) &#123; Request si = null; //ä»Žé˜»å¡žé˜Ÿåˆ—ä¸­èŽ·å–è¯·æ±‚ if (toFlush.isEmpty()) &#123; si = queuedRequests.take(); &#125; else &#123; si = queuedRequests.poll(); if (si == null) &#123; flush(toFlush); continue; &#125; &#125; if (si == requestOfDeath) &#123; break; &#125; if (si != null) &#123; // track the number of records written to the log //ä¸‹é¢è¿™å—ä»£ç ï¼Œç²—ç•¥çœ‹æ¥æ˜¯è§¦å‘å¿«ç…§æ“ä½œï¼Œå¯åŠ¨ä¸€ä¸ªå¤„ç†å¿«ç…§çš„çº¿ç¨‹ if (zks.getZKDatabase().append(si)) &#123; logCount++; if (logCount &gt; (snapCount / 2 + randRoll)) &#123; randRoll = r.nextInt(snapCount/2); // roll the log zks.getZKDatabase().rollLog(); // take a snapshot if (snapInProcess != null &amp;&amp; snapInProcess.isAlive()) &#123; LOG.warn("Too busy to snap, skipping"); &#125; else &#123; snapInProcess = new ZooKeeperThread("Snapshot Thread") &#123; public void run() &#123; try &#123; zks.takeSnapshot(); &#125; catch(Exception e) &#123; LOG.warn("Unexpected exception", e); &#125; &#125; &#125;; snapInProcess.start(); &#125; logCount = 0; &#125; &#125; else if (toFlush.isEmpty()) &#123; // optimization for read heavy workloads // iff this is a read, and there are no pending // flushes (writes), then just pass this to the next // processor if (nextProcessor != null) &#123; nextProcessor.processRequest(si); //ç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ªå¤„ç†å™¨æ¥å¤„ç†è¯·æ±‚ if (nextProcessor instanceof Flushable) &#123; ((Flushable)nextProcessor).flush(); &#125; &#125; continue; &#125; toFlush.add(si); if (toFlush.size() &gt; 1000) &#123; flush(toFlush); &#125; &#125; &#125; &#125; catch (Throwable t) &#123; handleException(this.getName(), t); &#125; finally&#123; running = false; &#125; LOG.info("SyncRequestProcessor exited!"); &#125; FinalRequestProcessor. processRequestè¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬åœ¨è¯¾å ‚ä¸Šåˆ†æžåˆ°çš„æ–¹æ³•äº†ï¼ŒFinalRequestProcessor.processRequestæ–¹æ³•å¹¶æ ¹æ®Requestå¯¹è±¡ä¸­çš„æ“ä½œæ›´æ–°å†…å­˜ä¸­Sessionä¿¡æ¯æˆ–è€…znodeæ•°æ®ã€‚ è¿™å—ä»£ç æœ‰å°300å¤šè¡Œï¼Œå°±ä¸å…¨éƒ¨è´´å‡ºæ¥äº†ï¼Œæˆ‘ä»¬ç›´æŽ¥å®šä½åˆ°å…³é”®ä»£ç ï¼Œæ ¹æ®å®¢æˆ·ç«¯çš„OPç±»åž‹æ‰¾åˆ°å¦‚ä¸‹çš„ä»£ç  1234567891011121314151617 case OpCode.exists: &#123; lastOp = "EXIS"; // TODO we need to figure out the security requirement for this! ExistsRequest existsRequest = new ExistsRequest(); //ååºåˆ—åŒ– (å°†ByteBufferååºåˆ—åŒ–æˆä¸ºExitsRequest.è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚çš„æ—¶å€™ä¼ é€’è¿‡æ¥çš„Requestå¯¹è±¡ ByteBufferInputStream.byteBuffer2Record(request.request, existsRequest); String path = existsRequest.getPath(); //å¾—åˆ°è¯·æ±‚çš„è·¯å¾„ if (path.indexOf('\0') != -1) &#123; throw new KeeperException.BadArgumentsException(); &#125; //ç»ˆäºŽæ‰¾åˆ°ä¸€ä¸ªå¾ˆå…³é”®çš„ä»£ç ï¼Œåˆ¤æ–­è¯·æ±‚çš„getWatchæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æžœå­˜åœ¨ï¼Œåˆ™ä¼ é€’cnxnï¼ˆservercnxnï¼‰//å¯¹äºŽexistsè¯·æ±‚ï¼Œéœ€è¦ç›‘å¬dataå˜åŒ–äº‹ä»¶ï¼Œæ·»åŠ watcher Stat stat = zks.getZKDatabase().statNode(path, existsRequest.getWatch() ? cnxn : null); rsp = new ExistsResponse(stat); //åœ¨æœåŠ¡ç«¯å†…å­˜æ•°æ®åº“ä¸­æ ¹æ®è·¯å¾„å¾—åˆ°ç»“æžœè¿›è¡Œç»„è£…ï¼Œè®¾ç½®ä¸ºExistsResponse break; &#125; statNodeè¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆï¼Ÿ123public Stat statNode(String path, ServerCnxn serverCnxn) throws KeeperException.NoNodeException &#123; return dataTree.statNode(path, serverCnxn); &#125; ä¸€è·¯å‘ä¸‹ï¼Œåœ¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè®²ServerCnxnå‘ä¸Šè½¬åž‹ä¸ºWatcheräº†ã€‚ å› ä¸ºServerCnxnå®žçŽ°äº†WatcheræŽ¥å£ 123456789101112131415public Stat statNode(String path, Watcher watcher) throws KeeperException.NoNodeException &#123; Stat stat = new Stat(); DataNode n = nodes.get(path); //èŽ·å¾—èŠ‚ç‚¹æ•°æ® if (watcher != null) &#123; //å¦‚æžœwatcherä¸ä¸ºç©ºï¼Œåˆ™è®²å½“å‰çš„watcherå’Œpathè¿›è¡Œç»‘å®š dataWatches.addWatch(path, watcher); &#125; if (n == null) &#123; throw new KeeperException.NoNodeException(); &#125; synchronized (n) &#123; n.copyStat(stat); return stat; &#125; &#125; WatchManager.addWatch(path, watcher);12345678910111213141516171819synchronized void addWatch(String path, Watcher watcher) &#123; HashSet&lt;Watcher&gt; list = watchTable.get(path); //åˆ¤æ–­watcherTableä¸­æ˜¯å¦å­˜åœ¨å½“å‰è·¯å¾„å¯¹åº”çš„watcher if (list == null) &#123; //ä¸å­˜åœ¨åˆ™ä¸»åŠ¨æ·»åŠ  // don't waste memory if there are few watches on a node // rehash when the 4th entry is added, doubling size thereafter // seems like a good compromise list = new HashSet&lt;Watcher&gt;(4); // æ–°ç”Ÿæˆwatcheré›†åˆ watchTable.put(path, list); &#125; list.add(watcher); //æ·»åŠ åˆ°watcherè¡¨ HashSet&lt;String&gt; paths = watch2Paths.get(watcher); if (paths == null) &#123; // cnxns typically have many watches, so use default cap here paths = new HashSet&lt;String&gt;(); watch2Paths.put(watcher, paths); // è®¾ç½®watcheråˆ°èŠ‚ç‚¹è·¯å¾„çš„æ˜ å°„ &#125; paths.add(path); // å°†è·¯å¾„æ·»åŠ è‡³pathsé›†åˆ &#125; å…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ â‘  é€šè¿‡ä¼ å…¥çš„pathï¼ˆèŠ‚ç‚¹è·¯å¾„ï¼‰ä»ŽwatchTableèŽ·å–ç›¸åº”çš„watcheré›†åˆï¼Œè¿›å…¥â‘¡ â‘¡ åˆ¤æ–­â‘ ä¸­çš„watcheræ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºï¼Œåˆ™è¿›å…¥â‘¢ï¼Œå¦åˆ™ï¼Œè¿›å…¥â‘£ â‘¢ æ–°ç”Ÿæˆwatcheré›†åˆï¼Œå¹¶å°†è·¯å¾„pathå’Œæ­¤é›†åˆæ·»åŠ è‡³watchTableä¸­ï¼Œè¿›å…¥â‘£ â‘£ å°†ä¼ å…¥çš„watcheræ·»åŠ è‡³watcheré›†åˆï¼Œå³å®Œæˆäº†pathå’Œwatcheræ·»åŠ è‡³watchTableçš„æ­¥éª¤ï¼Œè¿›å…¥â‘¤ â‘¤ é€šè¿‡ä¼ å…¥çš„watcherä»Žwatch2Pathsä¸­èŽ·å–ç›¸åº”çš„pathé›†åˆï¼Œè¿›å…¥â‘¥ â‘¥ åˆ¤æ–­pathé›†åˆæ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºï¼Œåˆ™è¿›å…¥â‘¦ï¼Œå¦åˆ™ï¼Œè¿›å…¥â‘§ â‘¦ æ–°ç”Ÿæˆpathé›†åˆï¼Œå¹¶å°†watcherå’Œpathsæ·»åŠ è‡³watch2Pathsä¸­ï¼Œè¿›å…¥â‘§ â‘§ å°†ä¼ å…¥çš„pathï¼ˆèŠ‚ç‚¹è·¯å¾„ï¼‰æ·»åŠ è‡³pathé›†åˆï¼Œå³å®Œæˆäº†pathå’Œwatcheræ·»åŠ è‡³watch2Pathsçš„æ­¥éª¤ æ€»ç»“è°ƒç”¨å…³ç³»é“¾å¦‚ä¸‹ NettyServerCnxn(processPackage) -&gt; ZookeeperServer(processRequest) -&gt; PredRequestProcessor(processRequest) -&gt; SyncRequestProcessor(processRequest) -&gt; FinalRequestProcessor(processRequest) -&gt; ZKDataBase (statNode)-&gt; DataTree(statNode) -&gt; WatchManager(addWatch) å®¢æˆ·ç«¯æŽ¥æ”¶æœåŠ¡ç«¯å¤„ç†å®Œæˆçš„å“åº”ClientCnxnSocketNetty.messageReceivedæœåŠ¡ç«¯å¤„ç†å®Œæˆä»¥åŽï¼Œä¼šé€šè¿‡NettyServerCnxn.sendResponseå‘é€è¿”å›žçš„å“åº”ä¿¡æ¯ï¼Œ å®¢æˆ·ç«¯ä¼šåœ¨ClientCnxnSocketNetty.messageReceivedæŽ¥æ”¶æœåŠ¡ç«¯çš„è¿”å›ž 12345678910111213141516171819202122232425262728293031323334public void messageReceived(ChannelHandlerContext ctx, MessageEvent e) throws Exception &#123; updateNow(); ChannelBuffer buf = (ChannelBuffer) e.getMessage(); while (buf.readable()) &#123; if (incomingBuffer.remaining() &gt; buf.readableBytes()) &#123; int newLimit = incomingBuffer.position() + buf.readableBytes(); incomingBuffer.limit(newLimit); &#125; buf.readBytes(incomingBuffer); incomingBuffer.limit(incomingBuffer.capacity()); if (!incomingBuffer.hasRemaining()) &#123; incomingBuffer.flip(); if (incomingBuffer == lenBuffer) &#123; recvCount++; readLength(); &#125; else if (!initialized) &#123; readConnectResult(); lenBuffer.clear(); incomingBuffer = lenBuffer; initialized = true; updateLastHeard(); &#125; else &#123; sendThread.readResponse(incomingBuffer); //æ”¶åˆ°æ¶ˆæ¯ä»¥åŽè§¦å‘SendThread.readResponseæ–¹æ³• lenBuffer.clear(); incomingBuffer = lenBuffer; updateLastHeard(); &#125; &#125; &#125; wakeupCnxn(); &#125; SendThread. readResponseè¿™ä¸ªæ–¹æ³•é‡Œé¢ä¸»è¦çš„æµç¨‹å¦‚ä¸‹ é¦–å…ˆè¯»å–headerï¼Œå¦‚æžœå…¶xid == -2ï¼Œè¡¨æ˜Žæ˜¯ä¸€ä¸ªpingçš„responseï¼Œreturn å¦‚æžœxidæ˜¯ -4 ï¼Œè¡¨æ˜Žæ˜¯ä¸€ä¸ªAuthPacketçš„response return å¦‚æžœxidæ˜¯ -1ï¼Œè¡¨æ˜Žæ˜¯ä¸€ä¸ªnotification,æ­¤æ—¶è¦ç»§ç»­è¯»å–å¹¶æž„é€ ä¸€ä¸ªenentï¼Œé€šè¿‡EventThread.queueEventå‘é€ï¼Œreturn å…¶å®ƒæƒ…å†µä¸‹ï¼š ä»ŽpendingQueueæ‹¿å‡ºä¸€ä¸ªPacketï¼Œæ ¡éªŒåŽæ›´æ–°packetä¿¡æ¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118void readResponse(ByteBuffer incomingBuffer) throws IOException &#123; ByteBufferInputStream bbis = new ByteBufferInputStream( incomingBuffer); BinaryInputArchive bbia = BinaryInputArchive.getArchive(bbis); ReplyHeader replyHdr = new ReplyHeader(); replyHdr.deserialize(bbia, "header"); //ååºåˆ—åŒ–header if (replyHdr.getXid() == -2) &#123; //? // -2 is the xid for pings if (LOG.isDebugEnabled()) &#123; LOG.debug("Got ping response for sessionid: 0x" + Long.toHexString(sessionId) + " after " + ((System.nanoTime() - lastPingSentNs) / 1000000) + "ms"); &#125; return; &#125; if (replyHdr.getXid() == -4) &#123; // -4 is the xid for AuthPacket if(replyHdr.getErr() == KeeperException.Code.AUTHFAILED.intValue()) &#123; state = States.AUTH_FAILED; eventThread.queueEvent( new WatchedEvent(Watcher.Event.EventType.None, Watcher.Event.KeeperState.AuthFailed, null) ); &#125; if (LOG.isDebugEnabled()) &#123; LOG.debug("Got auth sessionid:0x" + Long.toHexString(sessionId)); &#125; return; &#125; if (replyHdr.getXid() == -1) &#123; //è¡¨ç¤ºå½“å‰çš„æ¶ˆæ¯ç±»åž‹ä¸ºä¸€ä¸ªnotification(æ„å‘³ç€æ˜¯æœåŠ¡ç«¯çš„ä¸€ä¸ªå“åº”äº‹ä»¶) // -1 means notification if (LOG.isDebugEnabled()) &#123; LOG.debug("Got notification sessionid:0x" + Long.toHexString(sessionId)); &#125; WatcherEvent event = new WatcherEvent();//? event.deserialize(bbia, "response"); //ååºåˆ—åŒ–å“åº”ä¿¡æ¯ // convert from a server path to a client path if (chrootPath != null) &#123; String serverPath = event.getPath(); if(serverPath.compareTo(chrootPath)==0) event.setPath("/"); else if (serverPath.length() &gt; chrootPath.length()) event.setPath(serverPath.substring(chrootPath.length())); else &#123; LOG.warn("Got server path " + event.getPath() + " which is too short for chroot path " + chrootPath); &#125; &#125; WatchedEvent we = new WatchedEvent(event); if (LOG.isDebugEnabled()) &#123; LOG.debug("Got " + we + " for sessionid 0x" + Long.toHexString(sessionId)); &#125; eventThread.queueEvent( we ); return; &#125; // If SASL authentication is currently in progress, construct and // send a response packet immediately, rather than queuing a // response as with other packets. if (tunnelAuthInProgress()) &#123; GetSASLRequest request = new GetSASLRequest(); request.deserialize(bbia,"token"); zooKeeperSaslClient.respondToServer(request.getToken(), ClientCnxn.this); return; &#125; Packet packet; synchronized (pendingQueue) &#123; if (pendingQueue.size() == 0) &#123; throw new IOException("Nothing in the queue, but got " + replyHdr.getXid()); &#125; packet = pendingQueue.remove(); //å› ä¸ºå½“å‰è¿™ä¸ªæ•°æ®åŒ…å·²ç»æ”¶åˆ°äº†å“åº”ï¼Œæ‰€ä»¥è®²å®ƒä»ŽpendingQueuedä¸­ç§»é™¤ &#125; /* * Since requests are processed in order, we better get a response * to the first request! */ try &#123;//æ ¡éªŒæ•°æ®åŒ…ä¿¡æ¯ï¼Œæ ¡éªŒæˆåŠŸåŽè®²æ•°æ®åŒ…ä¿¡æ¯è¿›è¡Œæ›´æ–°ï¼ˆæ›¿æ¢ä¸ºæœåŠ¡ç«¯çš„ä¿¡æ¯ï¼‰ if (packet.requestHeader.getXid() != replyHdr.getXid()) &#123; packet.replyHeader.setErr( KeeperException.Code.CONNECTIONLOSS.intValue()); throw new IOException("Xid out of order. Got Xid " + replyHdr.getXid() + " with err " + + replyHdr.getErr() + " expected Xid " + packet.requestHeader.getXid() + " for a packet with details: " + packet ); &#125; packet.replyHeader.setXid(replyHdr.getXid()); packet.replyHeader.setErr(replyHdr.getErr()); packet.replyHeader.setZxid(replyHdr.getZxid()); if (replyHdr.getZxid() &gt; 0) &#123; lastZxid = replyHdr.getZxid(); &#125; if (packet.response != null &amp;&amp; replyHdr.getErr() == 0) &#123; packet.response.deserialize(bbia, "response"); //èŽ·å¾—æœåŠ¡ç«¯çš„å“åº”ï¼Œååºåˆ—åŒ–ä»¥åŽè®¾ç½®åˆ°packet.responseå±žæ€§ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨existsæ–¹æ³•çš„æœ€åŽä¸€è¡Œé€šè¿‡packet.responseæ‹¿åˆ°æ”¹è¯·æ±‚çš„è¿”å›žç»“æžœ &#125; if (LOG.isDebugEnabled()) &#123; LOG.debug("Reading reply sessionid:0x" + Long.toHexString(sessionId) + ", packet:: " + packet); &#125; &#125; finally &#123; finishPacket(packet); //æœ€åŽè°ƒç”¨finishPacketæ–¹æ³•å®Œæˆå¤„ç† &#125; &#125; finishPacketæ–¹æ³•ä¸»è¦åŠŸèƒ½æ˜¯æŠŠä»Ž Packet ä¸­å–å‡ºå¯¹åº”çš„ Watcher å¹¶æ³¨å†Œåˆ° ZKWatchManager ä¸­åŽ» 123456789101112131415161718192021222324252627282930313233343536373839private void finishPacket(Packet p) &#123; int err = p.replyHeader.getErr(); if (p.watchRegistration != null) &#123; p.watchRegistration.register(err); //å°†äº‹ä»¶æ³¨å†Œåˆ°zkwatchemanagerä¸­watchRegistrationï¼Œç†Ÿæ‚‰å—ï¼Ÿåœ¨ç»„è£…è¯·æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆå§‹åŒ–äº†è¿™ä¸ªå¯¹è±¡æŠŠwatchRegistration å­ç±»é‡Œé¢çš„ Watcher å®žä¾‹æ”¾åˆ° ZKWatchManager çš„ existsWatches ä¸­å­˜å‚¨èµ·æ¥ã€‚ &#125; //å°†æ‰€æœ‰ç§»é™¤çš„ç›‘è§†äº‹ä»¶æ·»åŠ åˆ°äº‹ä»¶é˜Ÿåˆ—, è¿™æ ·å®¢æˆ·ç«¯èƒ½æ”¶åˆ° â€œdata/child äº‹ä»¶è¢«ç§»é™¤â€çš„äº‹ä»¶ç±»åž‹ if (p.watchDeregistration != null) &#123; Map&lt;EventType, Set&lt;Watcher&gt;&gt; materializedWatchers = null; try &#123; materializedWatchers = p.watchDeregistration.unregister(err); for (Entry&lt;EventType, Set&lt;Watcher&gt;&gt; entry : materializedWatchers.entrySet()) &#123; Set&lt;Watcher&gt; watchers = entry.getValue(); if (watchers.size() &gt; 0) &#123; queueEvent(p.watchDeregistration.getClientPath(), err, watchers, entry.getKey()); // ignore connectionloss when removing from local // session p.replyHeader.setErr(Code.OK.intValue()); &#125; &#125; &#125; catch (KeeperException.NoWatcherException nwe) &#123; p.replyHeader.setErr(nwe.code().intValue()); &#125; catch (KeeperException ke) &#123; p.replyHeader.setErr(ke.code().intValue()); &#125; &#125; //cbå°±æ˜¯AsnycCallbackï¼Œå¦‚æžœä¸ºnullï¼Œè¡¨æ˜Žæ˜¯åŒæ­¥è°ƒç”¨çš„æŽ¥å£ï¼Œä¸éœ€è¦å¼‚æ­¥å›žæŽ‰ï¼Œå› æ­¤ï¼Œç›´æŽ¥notifyAllå³å¯ã€‚ if (p.cb == null) &#123; synchronized (p) &#123; p.finished = true; p.notifyAll(); &#125; &#125; else &#123; p.finished = true; eventThread.queuePacket(p); &#125; &#125; watchRegistration12345678910111213public void register(int rc) &#123; if (shouldAddWatch(rc)) &#123; Map&lt;String, Set&lt;Watcher&gt;&gt; watches = getWatches(rc); // //é€šè¿‡å­ç±»çš„å®žçŽ°å–å¾—ZKWatchManager ä¸­çš„ existsWatches synchronized(watches) &#123; Set&lt;Watcher&gt; watchers = watches.get(clientPath); if (watchers == null) &#123; watchers = new HashSet&lt;Watcher&gt;(); watches.put(clientPath, watchers); &#125; watchers.add(watcher); //å°† Watcher å¯¹è±¡æ”¾åˆ° ZKWatchManager ä¸­çš„ existsWatchesé‡Œé¢ &#125; &#125; &#125; ä¸‹é¢è¿™æ®µä»£ç æ˜¯å®¢æˆ·ç«¯å­˜å‚¨watcherçš„å‡ ä¸ªmapé›†åˆï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ç§æ³¨å†Œç›‘å¬äº‹ä»¶ 1234567static class ZKWatchManager implements ClientWatchManager &#123; private final Map&lt;String, Set&lt;Watcher&gt;&gt; dataWatches = new HashMap&lt;String, Set&lt;Watcher&gt;&gt;(); private final Map&lt;String, Set&lt;Watcher&gt;&gt; existWatches = new HashMap&lt;String, Set&lt;Watcher&gt;&gt;(); private final Map&lt;String, Set&lt;Watcher&gt;&gt; childWatches = new HashMap&lt;String, Set&lt;Watcher&gt;&gt;(); æ€»çš„æ¥è¯´ï¼Œå½“ä½¿ç”¨ZooKeeper æž„é€ æ–¹æ³•æˆ–è€…ä½¿ç”¨ getDataã€exists å’Œ getChildren ä¸‰ä¸ªæŽ¥å£æ¥å‘ ZooKeeper æœåŠ¡å™¨æ³¨å†Œ Watcher çš„æ—¶å€™ï¼Œé¦–å…ˆå°†æ­¤æ¶ˆæ¯ä¼ é€’ç»™æœåŠ¡ç«¯ï¼Œä¼ é€’æˆåŠŸåŽï¼ŒæœåŠ¡ç«¯ä¼šé€šçŸ¥å®¢æˆ·ç«¯ï¼Œç„¶åŽå®¢æˆ·ç«¯å°†è¯¥è·¯å¾„å’ŒWatcherå¯¹åº”å…³ç³»å­˜å‚¨èµ·æ¥å¤‡ç”¨ã€‚ EventThread.queuePacket()finishPacketæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨eventThread.queuePacketï¼Œ è®²å½“å‰çš„æ•°æ®åŒ…æ·»åŠ åˆ°ç­‰å¾…äº‹ä»¶é€šçŸ¥çš„é˜Ÿåˆ—ä¸­ 12345678910public void queuePacket(Packet packet) &#123; if (wasKilled) &#123; synchronized (waitingEvents) &#123; if (isRunning) waitingEvents.add(packet); else processEvent(packet); &#125; &#125; else &#123; waitingEvents.add(packet); &#125; &#125; äº‹ä»¶è§¦å‘å‰é¢è¿™ä¹ˆé•¿çš„è¯´æ˜Žï¼Œåªæ˜¯ä¸ºäº†æ¸…æ´—çš„è¯´æ˜Žäº‹ä»¶çš„æ³¨å†Œæµç¨‹ï¼Œæœ€ç»ˆçš„è§¦å‘ï¼Œè¿˜å¾—éœ€è¦é€šè¿‡äº‹åŠ¡åž‹æ“ä½œæ¥å®Œæˆ åœ¨æˆ‘ä»¬æœ€å¼€å§‹çš„æ¡ˆä¾‹ä¸­ï¼Œé€šè¿‡å¦‚ä¸‹ä»£ç åŽ»å®Œæˆäº†äº‹ä»¶çš„è§¦å‘ 1zookeeper.setData(â€œ/micâ€, â€œ1â€.getByte(),-1) ; //ä¿®æ”¹èŠ‚ç‚¹çš„å€¼è§¦å‘ç›‘å¬ å‰é¢çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯¹æŽ¥çš„æµç¨‹å°±ä¸å†é‡å¤è®²è§£äº†ï¼Œäº¤äº’æµç¨‹æ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€çš„å·®åˆ«åœ¨äºŽäº‹ä»¶è§¦å‘äº† æœåŠ¡ç«¯çš„äº‹ä»¶å“åº”DataTree.setData()12345678910111213141516171819202122232425public Stat setData(String path, byte data[], int version, long zxid, long time) throws KeeperException.NoNodeException &#123; Stat s = new Stat(); DataNode n = nodes.get(path); if (n == null) &#123; throw new KeeperException.NoNodeException(); &#125; byte lastdata[] = null; synchronized (n) &#123; lastdata = n.data; n.data = data; n.stat.setMtime(time); n.stat.setMzxid(zxid); n.stat.setVersion(version); n.copyStat(s); &#125; // now update if the path is in a quota subtree. String lastPrefix = getMaxPrefixWithQuota(path); if(lastPrefix != null) &#123; this.updateBytes(lastPrefix, (data == null ? 0 : data.length) - (lastdata == null ? 0 : lastdata.length)); &#125; dataWatches.triggerWatch(path, EventType.NodeDataChanged); //è§¦å‘å¯¹åº”èŠ‚ç‚¹çš„NodeDataChangedäº‹ä»¶ return s; &#125; WatcherManager. triggerWatch 12345678910111213141516171819202122232425262728Set&lt;Watcher&gt; triggerWatch(String path, EventType type, Set&lt;Watcher&gt; supress) &#123; WatchedEvent e = new WatchedEvent(type, KeeperState.SyncConnected, path); // æ ¹æ®äº‹ä»¶ç±»åž‹ã€è¿žæŽ¥çŠ¶æ€ã€èŠ‚ç‚¹è·¯å¾„åˆ›å»ºWatchedEvent HashSet&lt;Watcher&gt; watchers; synchronized (this) &#123; watchers = watchTable.remove(path); // ä»Žwatcherè¡¨ä¸­ç§»é™¤pathï¼Œå¹¶è¿”å›žå…¶å¯¹åº”çš„watcheré›†åˆ if (watchers == null || watchers.isEmpty()) &#123; if (LOG.isTraceEnabled()) &#123; ZooTrace.logTraceMessage(LOG, ZooTrace.EVENT_DELIVERY_TRACE_MASK, "No watchers for " + path); &#125; return null; &#125; for (Watcher w : watchers) &#123; // éåŽ†watcheré›†åˆ HashSet&lt;String&gt; paths = watch2Paths.get(w); // æ ¹æ®watcherä»Žwatcherè¡¨ä¸­å–å‡ºè·¯å¾„é›†åˆ if (paths != null) &#123; paths.remove(path); //ç§»é™¤è·¯å¾„ &#125; &#125; &#125; for (Watcher w : watchers) &#123; // éåŽ†watcheré›†åˆ if (supress != null &amp;&amp; supress.contains(w)) &#123; continue; &#125; w.process(e); //OKï¼Œé‡ç‚¹åˆæ¥äº†ï¼Œw.processæ˜¯åšä»€ä¹ˆå‘¢ï¼Ÿ &#125; return watchers; &#125; w.process(e);è¿˜è®°å¾—æˆ‘ä»¬åœ¨æœåŠ¡ç«¯ç»‘å®šäº‹ä»¶çš„æ—¶å€™ï¼Œwatcherç»‘å®šæ˜¯æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ServerCnxnï¼Œ æ‰€ä»¥w.process(e)ï¼Œå…¶å®žè°ƒç”¨çš„åº”è¯¥æ˜¯ServerCnxnçš„processæ–¹æ³•ã€‚è€Œservercnxnåˆæ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæœ‰ä¸¤ä¸ªå®žçŽ°ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼šNIOServerCnxnå’ŒNettyServerCnxnã€‚é‚£æŽ¥ä¸‹æ¥æˆ‘ä»¬æ‰’å¼€NettyServerCnxnè¿™ä¸ªç±»çš„processæ–¹æ³•çœ‹çœ‹ç©¶ç«Ÿ 123456789101112131415161718192021public void process(WatchedEvent event) &#123; ReplyHeader h = new ReplyHeader(-1, -1L, 0); if (LOG.isTraceEnabled()) &#123; ZooTrace.logTraceMessage(LOG, ZooTrace.EVENT_DELIVERY_TRACE_MASK, "Deliver event " + event + " to 0x" + Long.toHexString(this.sessionId) + " through " + this); &#125; // Convert WatchedEvent to a type that can be sent over the wire WatcherEvent e = event.getWrapper(); try &#123; sendResponse(h, e, "notification"); //lookï¼Œ è¿™ä¸ªåœ°æ–¹å‘é€äº†ä¸€ä¸ªäº‹ä»¶ï¼Œäº‹ä»¶å¯¹è±¡ä¸ºWatcherEventã€‚å®Œç¾Ž &#125; catch (IOException e1) &#123; if (LOG.isDebugEnabled()) &#123; LOG.debug("Problem sending to " + getRemoteSocketAddress(), e1); &#125; close(); &#125; &#125; é‚£æŽ¥ä¸‹é‡Œï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°è¿™ä¸ªresponseï¼Œè§¦å‘SendThread.readResponseæ–¹æ³• å®¢æˆ·ç«¯å¤„ç†äº‹ä»¶å“åº”SendThread.readResponseè¿™å—ä»£ç ä¸Šé¢å·²ç»è´´è¿‡äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæŒ‘é€‰å½“å‰æµç¨‹çš„ä»£ç è¿›è¡Œè®²è§£ï¼ŒæŒ‰ç…§å‰é¢æˆ‘ä»¬å°†åˆ°è¿‡çš„ï¼Œnotifacationé€šçŸ¥æ¶ˆæ¯çš„xidä¸º-1ï¼Œæ„å‘³ç€~ç›´æŽ¥æ‰¾åˆ°-1çš„åˆ¤æ–­è¿›è¡Œåˆ†æžåœ¨ä¸‹é¢ä»£ç æ ‡çº¢å¤„. eventThread.queueEvent SendThread æŽ¥æ”¶åˆ°æœåŠ¡ç«¯çš„é€šçŸ¥äº‹ä»¶åŽï¼Œä¼šé€šè¿‡è°ƒç”¨ EventThread ç±»çš„ queueEvent æ–¹æ³•å°†äº‹ä»¶ä¼ ç»™ EventThread çº¿ç¨‹ï¼ŒqueueEvent æ–¹æ³•æ ¹æ®è¯¥é€šçŸ¥äº‹ä»¶ï¼Œä»Ž ZKWatchManager ä¸­å–å‡ºæ‰€æœ‰ç›¸å…³çš„ Watcherï¼Œå¦‚æžœèŽ·å–åˆ°ç›¸åº”çš„Watcherï¼Œå°±ä¼šè®©Watcherç§»é™¤å¤±æ•ˆã€‚ Meterializeæ–¹æ³•é€šè¿‡dataWatchesæˆ–è€…existWatchesæˆ–è€…childWatchesçš„removeå–å‡ºå¯¹åº”çš„watchï¼Œè¡¨æ˜Žå®¢æˆ·ç«¯watchä¹Ÿæ˜¯æ³¨å†Œä¸€æ¬¡å°±ç§»é™¤åŒæ—¶éœ€è¦æ ¹æ®keeperStateã€eventTypeå’Œpathè¿”å›žåº”è¯¥è¢«é€šçŸ¥çš„Watcheré›†åˆ waitingEvents.addæœ€åŽä¸€æ­¥ï¼ŒæŽ¥è¿‘çœŸç›¸äº†waitingEventsæ˜¯EventThreadè¿™ä¸ªçº¿ç¨‹ä¸­çš„é˜»å¡žé˜Ÿåˆ—ï¼Œå¾ˆæ˜Žæ˜¾ï¼Œåˆæ˜¯åœ¨æˆ‘ä»¬ç¬¬ä¸€æ­¥æ“ä½œçš„æ—¶å€™å®žä¾‹åŒ–çš„ä¸€ä¸ªçº¿ç¨‹ã€‚ä»Žåå­—å¯ä»¥æŒ‡å¯¼ï¼ŒwaitingEvents æ˜¯ä¸€ä¸ªå¾…å¤„ç† Watcher çš„é˜Ÿåˆ—ï¼ŒEventThread çš„ run() æ–¹æ³•ä¼šä¸æ–­ä»Žé˜Ÿåˆ—ä¸­å–æ•°æ®ï¼Œäº¤ç”± processEvent æ–¹æ³•å¤„ç†ï¼š ProcessEventç”±äºŽè¿™å—çš„ä»£ç å¤ªé•¿ï¼Œæˆ‘åªæŠŠæ ¸å¿ƒçš„ä»£ç è´´å‡ºæ¥ï¼Œè¿™é‡Œå°±æ˜¯å¤„ç†äº‹ä»¶è§¦å‘çš„æ ¸å¿ƒä»£]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[zookeeperåŽŸç”ŸAPIä½¿ç”¨]]></title>
    <url>%2F2018%2F06%2F09%2Fzookeeper%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0_05_%E5%8E%9F%E7%94%9FAPI%E7%9A%84%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[1ã€å‡†å¤‡å·¥ä½œ1.1ã€jaråŒ…12345&lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.4.8&lt;/version&gt;&lt;/dependency&gt; 1.2ã€å‡†å¤‡å·¥ä½œæœ¬äººä½¿ç”¨çš„æ˜¯VMware + CentOS7çŽ¯å¢ƒï¼Œå³è™šæ‹Ÿæœºï¼Œè¿™é‡Œéœ€è¦å°†zookeeperå®¢æˆ·ç«¯è®¿é—®æŽ¥å£å¯¹å¤–æš´éœ²ã€‚å‚è€ƒï¼šCentosé˜²ç«å¢™è®¾ç½®ä¸Žç«¯å£å¼€æ”¾çš„æ–¹æ³•123456// åœ¨æŒ‡å®šåŒºåŸŸæ‰“å¼€ç«¯å£firewall-cmd --zone=public --add-port=80/tcpfirewall-cmd --zone=public --add-port=80/tcp --permanent // æ°¸ä¹…ç”Ÿæ•ˆ// é‡å¯é˜²ç«å¢™firewall-cmd --reload 2ã€åˆ›å»ºè¿žæŽ¥ã€åˆ›å»ºèŠ‚ç‚¹ã€ä¿®æ”¹èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹2.1ã€åˆ›å»ºè¿žæŽ¥12345// org.apache.zookeeper.ZooKeeperpublic ZooKeeper(String connectString, int sessionTimeout, Watcher watcher)public ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, boolean canBeReadOnly)public ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, long sessionId, byte[] sessionPasswd)public ZooKeeper(String connectString, int sessionTimeout, Watcher watcher, long sessionId, byte[] sessionPasswd, boolean canBeReadOnly) å‚æ•° å«ä¹‰ connectString ZookeeperæœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£å·ip:portã€‚é›†ç¾¤çŽ¯å¢ƒä½¿ç”¨é€—å·éš”å¼€ã€‚ sessionTimeout è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´ä¸åœ¨è¿žæŽ¥ watcher ç›‘å¬äº‹ä»¶ canBeReadOnly è¡¨ç¤ºå½“å‰newçš„å¯¹è±¡åªèƒ½æ‰§è¡Œè¯»æ“ä½œï¼Œä¸èƒ½æ‰§è¡Œå†™æ“ä½œã€‚é»˜è®¤ï¼šfalse sessionId å› Zookeeperçš„é‡è¿žæœºåˆ¶ï¼Œå³æ–­å¼€è¿žæŽ¥åŽï¼Œåœ¨ä¸€å®šæ—¶é—´å†…å¯å†æ¬¡è¿žæŽ¥ï¼Œä¿æŒåŒä¸€ä¸ªä¼šè¯ã€‚zookeeper.getSessionId()å¯ä»¥åœ¨æ–­å¼€è¿žæŽ¥å‰èŽ·å–sessionId sessionPasswd å› Zookeeperçš„é‡è¿žæœºåˆ¶ï¼Œå³æ–­å¼€è¿žæŽ¥åŽï¼Œåœ¨ä¸€å®šæ—¶é—´å†…å¯å†æ¬¡è¿žæŽ¥ï¼Œä¿æŒåŒä¸€ä¸ªä¼šè¯ã€‚zookeeper.getSessionPasswd()sessionPasswd å‚è€ƒï¼šZookeeperå®žä¾‹åŽŸç”ŸAPIâ€“å¤ç”¨sessionIdå’ŒsessionPasswd 2.2ã€åˆ›å»ºèŠ‚ç‚¹12String create(final String path, byte[] data, List&lt;ACL&gt; acl, CreateMode createMode)void create(final String path, byte[] data, List&lt;ACL&gt; acl, CreateMode createMode, StringCallback cb, Object ctx) å‚æ•° å«ä¹‰ path è¢«åˆ›å»ºèŠ‚ç‚¹çš„è·¯å¾„ data è¢«åˆ›å»ºèŠ‚ç‚¹çš„å€¼ acl aclç­–ç•¥ã€‚è¯¦è§zookeeperå®¢æˆ·ç«¯çš„ä½¿ç”¨çš„1.6ç« èŠ‚ createMode èŠ‚ç‚¹ç±»åž‹ï¼Œä¸´æ—¶æˆ–è€…æŒä¹…ï¼Œæœ‰åºèŠ‚ç‚¹ç­‰ã€‚è¯¦è§zookeeperå®¢æˆ·ç«¯çš„ä½¿ç”¨çš„1.2ã€1.3ç« èŠ‚ cb å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚æ³¨å†Œçš„å›žè°ƒå‡½æ•°ï¼Œéœ€å®žçŽ°StringCallbackæŽ¥å£ã€‚æ•°æ®èŠ‚ç‚¹åˆ›å»ºå®Œæˆä¹‹åŽï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ä¸»è¦é’ˆå¯¹public void processResult(int rc, String path, Object ctx, String name)æŽ¥å£è¿›è¡Œé‡å†™ã€‚å‚è€ƒï¼šZookeeperå®¢æˆ·ç«¯APIä¹‹åˆ›å»ºèŠ‚ç‚¹ï¼ˆä¸ƒï¼‰ ctx å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚ç”¨æˆ·ä¼ é€’ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åœ¨å›žè°ƒæ–¹æ³•æ‰§è¡Œæ—¶ä½¿ç”¨ ä¸´æ—¶èŠ‚ç‚¹ä¸‹ä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹ å› ä¸ºæ˜¯åŽŸç”ŸAPIï¼Œæ•…ä¸èƒ½åœ¨æ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„å‰æä¸‹ç›´æŽ¥åˆ›å»ºå­èŠ‚ç‚¹ 2.2.1ã€å…³äºŽStringCallbackè½¬è‡ªï¼šZookeeperå®¢æˆ·ç«¯APIä¹‹åˆ›å»ºèŠ‚ç‚¹ï¼ˆä¸ƒï¼‰ StringCallbackæŽ¥å£ç»§æ‰¿äº†AsyncCallbackæŽ¥å£ï¼Œæ¥å®žçŽ°å›žè°ƒæ—¶çš„ä¸šåŠ¡å¤„ç†ã€‚å…¶ä¸­AsyncCallbackæŽ¥å£è¿˜åŒ…8ä¸ªå›žè°ƒæŽ¥å£ï¼šStatCallbackã€DataCallbackã€ACLCallbackã€ChildrenCallbackã€Children2Callbackã€VoidCallbackã€MultiCallbackã€StringCallbackã€‚å¯ä»¥åœ¨ä¸åŒçš„å¼‚æ­¥æŽ¥å£ä¸­å®žçŽ°ä¸åŒçš„å›žè°ƒæŽ¥å£ã€‚ StringCallbackæŽ¥å£çš„public void processResult(int rc, String path, Object ctx, String name)æ–¹æ³•ã€‚ å‚æ•° å«ä¹‰ rc æœåŠ¡å™¨çš„å“åº”ç ï¼Œå³Event.KeeperStateï¼Œ0è¡¨ç¤ºè°ƒç”¨æˆåŠŸï¼Œ-4è¡¨ç¤ºè¿žæŽ¥å·²æ–­å¼€ï¼Œ-110è¡¨ç¤ºæŒ‡å®šèŠ‚ç‚¹å·²å­˜åœ¨ï¼Œ-112è¡¨ç¤ºä¼šè¯å·²è¿‡æœŸã€‚ path è°ƒç”¨createæ–¹æ³•æ—¶ä¼ å…¥çš„pathã€‚ ctx è°ƒç”¨createæ–¹æ³•æ—¶ä¼ å…¥çš„ctxã€‚ name åˆ›å»ºæˆåŠŸçš„èŠ‚ç‚¹åç§°ã€‚ 2.3ã€ä¿®æ”¹èŠ‚ç‚¹12Stat setData(final String path, byte data[], int version)public void setData(final String path, byte data[], int version, StatCallback cb, Object ctx) å‚æ•° å«ä¹‰ path è¢«ä¿®æ”¹èŠ‚ç‚¹çš„è·¯å¾„ data è¢«ä¿®æ”¹èŠ‚ç‚¹çš„æ–°å€¼ version ä»£è¡¨èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ï¼Œå¦‚æžœè¯¥å€¼ä¸ŽzookeeperæœåŠ¡å™¨æ­¤èŠ‚ç‚¹çš„dataVersionå±žæ€§å€¼ä¸ç›¸åŒï¼Œåˆ™ä¿®æ”¹å¤±è´¥ã€‚ -1ä»£è¡¨å¿½ç•¥ç‰ˆæœ¬å·çš„ä½œç”¨ï¼Œå¼ºåˆ¶ä¿®æ”¹ï¼ cb å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚æ³¨å†Œçš„å›žè°ƒå‡½æ•°ï¼Œéœ€å®žçŽ°StatCallbackæŽ¥å£ã€‚æ•°æ®èŠ‚ç‚¹åˆ›å»ºå®Œæˆä¹‹åŽï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ ctx å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚ç”¨æˆ·ä¼ é€’ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åœ¨å›žè°ƒæ–¹æ³•æ‰§è¡Œæ—¶ä½¿ç”¨ è¿”å›žå€¼Stat æè¿°ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹zookeeperå®¢æˆ·ç«¯çš„ä½¿ç”¨çš„ç« èŠ‚2 å…³äºŽStatCallbackï¼Œä¸ŽStringCallbackç±»ä¼¼ã€‚ å®žçŽ°çš„æ–¹æ³•æ˜¯public void processResult(int rc, String path, Object ctx, Stat stat) 2.4ã€åˆ é™¤èŠ‚ç‚¹12void delete(final String path, int version)void delete(final String path, int version, VoidCallback cb, Object ctx) ä¸Žä¿®æ”¹èŠ‚ç‚¹setDataæ–¹æ³•ç±»ä¼¼ã€‚ å› ä¸ºæ˜¯åŽŸå§‹APIï¼Œä¸å…è®¸åˆ é™¤å­˜åœ¨å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ 2.5ã€Demo12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576public class ApiZookeeper&#123; // é›†ç¾¤çŽ¯å¢ƒç”¨,éš”å¼€ private static final String CONNECTSTRING = "192.168.27.128:2181"; private static ZooKeeper zookeeper; public static void main(String[] args) throws Exception &#123; connect(); createNode("/xych", "xych"); // createNode("/xych1/lanboo","lanboo"); // æŠ¥é”™ setNode("/xych", "XYCH", -1); deleteNode("/xych", -1); &#125; /** * åˆ é™¤èŠ‚ç‚¹ */ public static void deleteNode(String nodePath, int version) throws Exception &#123; zookeeper.delete(nodePath, version); System.out.println("åˆ é™¤æˆåŠŸ"); &#125; /** * ä¿®æ”¹èŠ‚ç‚¹ */ public static void setNode(String nodePath, String value, int version) throws Exception &#123; Stat stat = zookeeper.setData(nodePath, value.getBytes(), version); System.out.println("ä¿®æ”¹æˆåŠŸ " + stat); &#125; /** * åˆ›å»ºèŠ‚ç‚¹ */ public static void createNode(String nodePath, String value) throws Exception &#123; String result = zookeeper.create(nodePath, value.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL); System.out.println("åˆ›å»ºæˆåŠŸ " + result); &#125; /** * åˆ›å»ºè¿žæŽ¥ */ public static void connect() throws Exception &#123; // ä½¿ç”¨CountDownLatchï¼Œä½¿ä¸»çº¿ç¨‹ç­‰å¾… CountDownLatch countDownLatch = new CountDownLatch(1); zookeeper = new ZooKeeper(CONNECTSTRING, 10000, new Watcher() &#123; @Override public void process(WatchedEvent event) &#123; if(event.getState() == Event.KeeperState.SyncConnected) &#123; System.out.println("Watcher " + zookeeper.getState()); countDownLatch.countDown(); &#125; &#125; &#125;); System.out.println("connect " + zookeeper.getState()); countDownLatch.await(); System.out.println("connect " + zookeeper.getState()); // zookeeper.close(); &#125;&#125;/* è¾“å‡ºç»“æžœconnect CONNECTINGWatcher CONNECTEDconnect CONNECTEDåˆ›å»ºæˆåŠŸ /xychä¿®æ”¹æˆåŠŸ 46,47,1524152856857,1524152856864,1,0,0,72057600313458694,4,0,46åˆ é™¤æˆåŠŸ*/ 3ã€existsã€getDataã€getChildren3.1ã€exists åˆ¤æ–­æŸèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨1234Stat exists(String path, boolean watch)Stat exists(final String path, Watcher watcher)void exists(String path, boolean watch, StatCallback cb, Object ctx)void exists(final String path, Watcher watcher, StatCallback cb, Object ctx) å‚æ•° å«ä¹‰ path è¢«åˆ¤æ–­èŠ‚ç‚¹çš„è·¯å¾„ watch æ˜¯å¦æ·»åŠ ä¸€ä¸ªé»˜è®¤Watcher watcher ç›‘å¬äº‹ä»¶ cb å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚æ³¨å†Œçš„å›žè°ƒå‡½æ•°ï¼Œéœ€å®žçŽ°StatCallbackæŽ¥å£ã€‚æ•°æ®èŠ‚ç‚¹åˆ›å»ºå®Œæˆä¹‹åŽï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ ctx å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚ç”¨æˆ·ä¼ é€’ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åœ¨å›žè°ƒæ–¹æ³•æ‰§è¡Œæ—¶ä½¿ç”¨ å…³äºŽStatCallbackå¯ä»¥å‚è€ƒæœ¬æ–‡2.2.1ã€‚ 3.2ã€getData èŽ·å–èŠ‚ç‚¹å†…å®¹ï¼ŒåŒæ­¥èŽ·å–å’Œå¼‚æ­¥èŽ·å–1234byte[] getData(String path, boolean watch, Stat stat)byte[] getData(final String path, Watcher watcher, Stat stat)void getData(String path, boolean watch, DataCallback cb, Object ctx)void getData(final String path, Watcher watcher, DataCallback cb, Object ctx) å‚æ•° å«ä¹‰ path èŠ‚ç‚¹çš„è·¯å¾„ watch æ˜¯å¦æ³¨å†Œä¸€ä¸ªé»˜è®¤Watcher watcher ç›‘å¬äº‹ä»¶ cb å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚æ³¨å†Œçš„å›žè°ƒå‡½æ•°ï¼Œéœ€å®žçŽ°DataCallbackæŽ¥å£ã€‚æ•°æ®èŠ‚ç‚¹åˆ›å»ºå®Œæˆä¹‹åŽï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ ctx å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚ç”¨æˆ·ä¼ é€’ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åœ¨å›žè°ƒæ–¹æ³•æ‰§è¡Œæ—¶ä½¿ç”¨ å…³äºŽDataCallbackå¯ä»¥å‚è€ƒæœ¬æ–‡2.2.1ã€‚ 3.3ã€getChildren èŽ·å–å­èŠ‚ç‚¹åˆ—è¡¨ï¼ŒåŒæ­¥èŽ·å–å’Œå¼‚æ­¥èŽ·å–12345678List&lt;String&gt; getChildren(String path, boolean watch)List&lt;String&gt; getChildren(final String path, Watcher watcher)List&lt;String&gt; getChildren(String path, boolean watch, Stat stat)List&lt;String&gt; getChildren(final String path, Watcher watcher, Stat stat)void getChildren(String path, boolean watch, ChildrenCallback cb, Object ctx)void getChildren(String path, boolean watch, Children2Callback cb, Object ctx)void getChildren(final String path, Watcher watcher, ChildrenCallback cb, Object ctx)void getChildren(final String path, Watcher watcher, Children2Callback cb, Object ctx) å‚æ•° å«ä¹‰ path èŠ‚ç‚¹çš„è·¯å¾„ watch æ˜¯å¦æ³¨å†Œä¸€ä¸ªé»˜è®¤Watcher watcher ç›‘å¬äº‹ä»¶ stat æè¿°ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ä¼šå°†pathæŒ‡å®šçš„èŠ‚ç‚¹çš„ä¿¡æ¯æ›´æ–°å…·ä½“å¯ä»¥æŸ¥çœ‹zookeeperå®¢æˆ·ç«¯çš„ä½¿ç”¨çš„ç« èŠ‚2 cb å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚æ³¨å†Œçš„å›žè°ƒå‡½æ•°ï¼Œéœ€å®žçŽ°ChildrenCallbackã€Children2CallbackæŽ¥å£ã€‚æ•°æ®èŠ‚ç‚¹åˆ›å»ºå®Œæˆä¹‹åŽï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ ctx å¼‚æ­¥åˆ›å»ºæ–¹æ³•å‚æ•°ã€‚ç”¨æˆ·ä¼ é€’ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åœ¨å›žè°ƒæ–¹æ³•æ‰§è¡Œæ—¶ä½¿ç”¨ å…³äºŽChildrenCallbackã€Children2Callbackå¯ä»¥å‚è€ƒæœ¬æ–‡2.2.1ã€‚ 4ã€Watcheräº‹ä»¶ç›‘æŽ§ Watcheræ˜¯ä¸€æ¬¡æ€§çš„ï¼Œç”¨å®Œå°±ä¼šå¤±æ•ˆ è½¬è‡ªï¼šZooKeeperç›‘å¬æœºåˆ¶ 4.1ã€äº‹ä»¶ç±»åž‹ äº‹ä»¶ç±»åž‹ å«ä¹‰ EventType.None ä¸ŽæœåŠ¡å™¨å»ºç«‹è¿žæŽ¥æ—¶è§¦å‘ EventType.NodeCreated è¢«ç›‘æŽ§çš„èŠ‚ç‚¹è¢«åˆ›å»ºè§¦å‘ EventType.NodeDeleted è¢«ç›‘æŽ§çš„èŠ‚ç‚¹è¢«åˆ é™¤è§¦å‘ EventType.NodeDataChanged è¢«ç›‘æŽ§çš„èŠ‚ç‚¹è¢«ä¿®æ”¹è§¦å‘ EventType.NodeChildrenChanged è¢«ç›‘æŽ§çš„èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°é‡å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘ 4.2ã€è¯»æ“ä½œç»‘å®šäº‹ä»¶ è¯»æ“ä½œ å«ä¹‰ new ZooKeeper ä¸ä¼šæŒ‡å®šæŸèŠ‚ç‚¹ï¼Œæ•…è§¦å‘ç±»åž‹ä¸ºEventType.None exists åˆ¤æ–­æŸèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼ŒåŒæ—¶å¯¹è¯¥èŠ‚ç‚¹æ·»åŠ Watcher getData èŽ·å–æŸèŠ‚ç‚¹çš„å€¼ï¼ŒåŒæ—¶å¯¹è¯¥èŠ‚ç‚¹æ·»åŠ Watcher getChildren èŽ·å–æŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼ŒåŒæ—¶å¯¹è¯¥èŠ‚ç‚¹æ·»åŠ Watcher 4.3ã€å†™æ“ä½œè§¦å‘äº‹ä»¶ å†™æ“ä½œ Event For â€œ/pathâ€ Event For â€œ/path/childâ€ create(â€œ/pathâ€) EventType.NodeCreated - delete(â€œ/pathâ€) EventType.NodeDeleted - setData(â€œ/pathâ€) EventType.NodeDataChanged - create(â€œ/path/childâ€) EventType.NodeChildrenChanged EventType.NodeCreated delete(â€œ/path/childâ€) EventType.NodeChildrenChanged EventType.NodeDeleted setData(â€œ/path/childâ€) - EventType.NodeDataChanged 4.4ã€å†™æ“ä½œè§¦å‘[è¯»æ“ä½œç»‘å®šçš„äº‹ä»¶] â€œ/pathâ€ â€œ/path/childâ€ å†™æ“ä½œæ‰€è§¦å‘çš„ç»‘å®šäº‹ä»¶ exists getData getChildren exists getData getChildren create(â€œ/pathâ€) âˆš âˆš delete(â€œ/pathâ€) âˆš âˆš âˆš setData(â€œ/pathâ€) âˆš âˆš create(â€œ/path/childâ€) âˆš âˆš âˆš delete(â€œ/path/childâ€) âˆš âˆš âˆš âˆš setData(â€œ/path/childâ€) âˆš âˆš create(&quot;/path/child&quot;)å’Œdelete(&quot;/path/child&quot;)åªä¼šè§¦å‘getChildrenå¯¹&quot;/path&quot;çš„ç»‘å®šäº‹ä»¶ï¼› ä¸ä¼šè§¦å‘existsã€getDataå¯¹&quot;/path&quot;çš„ç»‘å®šäº‹ä»¶ã€‚ 4.4ã€Demo123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184public class ApiZookeeperWatcher implements Watcher&#123; // é›†ç¾¤çŽ¯å¢ƒç”¨,éš”å¼€ private static final String CONNECTSTRING = "192.168.27.131:2181"; private static ZooKeeper zookeeper; // ä½¿ç”¨CountDownLatchï¼Œä½¿ä¸»çº¿ç¨‹ç­‰å¾… private static CountDownLatch countDownLatch = new CountDownLatch(1); public static void main(String[] args) throws Exception &#123; connect(); createWatcher("/xych", "xych"); setDataWatcher("/xych", "XYCH"); deleteWatcher("/xych"); // è¿™é‡Œ"/xych"å·²è¢«åˆ é™¤ï¼Œå†æ¬¡åˆ›å»ºã€‚ï¼ˆæ­¤æ—¶"/xych"æ²¡æœ‰ä»»ä½•Watcherï¼‰ // æ³¨æ„ï¼šä¸´æ—¶èŠ‚ç‚¹ä¸‹ä¸èƒ½åˆ›å»ºèŠ‚ç‚¹ if(zookeeper.exists("/xych1", false) == null) &#123; zookeeper.create("/xych1", "xych".getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); &#125; createWatcher_Children("/xych1", "/lanboo", "lanboo"); setDataWatcher_Children("/xych1", "/lanboo", "LANBOO"); deleteWatcher_Children("/xych1", "/lanboo"); &#125; public static void deleteWatcher_Children(String path, String children) throws Exception &#123; countDownLatch = new CountDownLatch(1); // åˆ©ç”¨getChildrenï¼Œå¯¹çˆ¶èŠ‚ç‚¹æ·»åŠ Watcher List&lt;String&gt; pathChildren = zookeeper.getChildren(path, new ApiZookeeperWatcher()); System.out.println("deleteWatcher_Childrenï¼š" + path + "çš„å­èŠ‚ç‚¹ï¼š" + pathChildren); // åˆ©ç”¨existsï¼Œå¯¹å­èŠ‚ç‚¹æ·»åŠ Watcher Stat childrenStat = zookeeper.exists(path + children, new ApiZookeeperWatcher()); if(pathChildren != null &amp;&amp; childrenStat != null) &#123; zookeeper.delete(path + children, -1); countDownLatch.await(); &#125; System.out.println(); &#125; public static void setDataWatcher_Children(String path, String children, String value) throws Exception &#123; countDownLatch = new CountDownLatch(1); // åˆ©ç”¨getChildrenï¼Œå¯¹çˆ¶èŠ‚ç‚¹æ·»åŠ Watcher List&lt;String&gt; pathChildren = zookeeper.getChildren(path, new ApiZookeeperWatcher()); System.out.println("setDataWatcher_Childrenï¼š" + path + "çš„å­èŠ‚ç‚¹ï¼š" + pathChildren); // åˆ©ç”¨existsï¼Œå¯¹å­èŠ‚ç‚¹æ·»åŠ Watcher Stat childrenStat = zookeeper.exists(path + children, new ApiZookeeperWatcher()); if(pathChildren != null &amp;&amp; childrenStat != null) &#123; zookeeper.setData(path + children, value.getBytes(), -1); countDownLatch.await(); &#125; System.out.println(); &#125; /** * å¯¹æŸèŠ‚ç‚¹æ·»åŠ Warcherï¼Œå¯¹è¯¥èŠ‚ç‚¹æ·»åŠ å­èŠ‚ç‚¹ */ public static void createWatcher_Children(String path, String children, String value) throws Exception &#123; countDownLatch = new CountDownLatch(2); // åˆ©ç”¨getChildrenï¼Œå¯¹çˆ¶èŠ‚ç‚¹æ·»åŠ Watcher List&lt;String&gt; pathChildren = zookeeper.getChildren(path, new ApiZookeeperWatcher()); System.out.println("createWatcher_Childrenï¼š" + path + "çš„å­èŠ‚ç‚¹ï¼š" + pathChildren); // åˆ©ç”¨existsï¼Œå¯¹å­èŠ‚ç‚¹æ·»åŠ Watcher Stat childrenStat = zookeeper.exists(path + children, new ApiZookeeperWatcher()); if(pathChildren != null &amp;&amp; childrenStat == null) &#123; zookeeper.create(path + children, value.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL); countDownLatch.await(); &#125; System.out.println(); &#125; /** * å¯¹setDataç›‘æŽ§ * åšæ³•ï¼š * 1ã€åˆ©ç”¨existsï¼Œåˆ¤æ–­æŸèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼ŒåŒæ—¶å¯¹è¯¥èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªWatcher * 2ã€åˆ é™¤è¯¥èŠ‚ç‚¹ */ public static void deleteWatcher(String path) throws Exception &#123; countDownLatch = new CountDownLatch(1); // åˆ¤æ–­"/xych"èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”å¯¹æ­¤èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªWatcher Stat stat = zookeeper.exists(path, new ApiZookeeperWatcher()); System.out.println("deleteWatcherï¼š" + path + "çš„èŠ‚ç‚¹å±žæ€§ï¼š" + stat); if(stat != null) &#123; zookeeper.delete(path, -1); countDownLatch.await(); &#125; System.out.println(); &#125; /** * å¯¹setDataç›‘æŽ§ * åšæ³•ï¼š * 1ã€åˆ©ç”¨getDataï¼ŒèŽ·å–æŸèŠ‚ç‚¹çš„valueï¼ŒåŒæ—¶å¯¹è¯¥èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªWatcher * 2ã€åˆ›å»ºè¯¥èŠ‚ç‚¹ */ public static void setDataWatcher(String path, String value) throws Exception &#123; countDownLatch = new CountDownLatch(1); Stat stat = new Stat(); byte[] bytes = zookeeper.getData(path, new ApiZookeeperWatcher(), stat); System.out.println("setDataWatcherï¼š" + path + "çš„åŽŸå§‹å€¼ = " + new String(bytes)); System.out.println("setDataWatcherï¼š" + path + "çš„èŠ‚ç‚¹ä¿¡æ¯ = " + stat); zookeeper.setData(path, value.getBytes(), -1); countDownLatch.await(); System.out.println(); &#125; /** * å¯¹createç›‘æŽ§ * åšæ³•ï¼š * 1ã€åˆ©ç”¨existsï¼Œåˆ¤æ–­æŸèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼ŒåŒæ—¶å¯¹è¯¥èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªWatcher * 2ã€åˆ›å»ºè¯¥èŠ‚ç‚¹ */ public static void createWatcher(String path, String value) throws Exception &#123; countDownLatch = new CountDownLatch(1); // åˆ¤æ–­pathèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ï¼Œå¹¶ä¸”å¯¹æ­¤èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªWatcher Stat stat = zookeeper.exists(path, new ApiZookeeperWatcher()); System.out.println("createWatcherï¼š" + path + "çš„èŠ‚ç‚¹å±žæ€§ï¼š" + stat); if(stat == null) &#123; zookeeper.create(path, value.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL); countDownLatch.await(); &#125; System.out.println(); &#125; /** * åˆ›å»ºè¿žæŽ¥ */ public static void connect() throws Exception &#123; zookeeper = new ZooKeeper(CONNECTSTRING, 10000, new ApiZookeeperWatcher()); System.out.println("connect " + zookeeper.getState()); countDownLatch.await(); System.out.println("connect " + zookeeper.getState()); System.out.println(); &#125; @Override public void process(WatchedEvent watchedEvent) &#123; // åªåœ¨è¿žæŽ¥æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œäº‹ä»¶ç›‘å¬ if(watchedEvent.getState() == Watcher.Event.KeeperState.SyncConnected) &#123; try &#123; if(Event.EventType.None == watchedEvent.getType()) &#123; System.out.println("Watcherï¼š" + watchedEvent.getState() + "--&gt;" + watchedEvent.getType()); &#125; else if(Event.EventType.NodeCreated == watchedEvent.getType()) &#123; System.out.println("Watcherï¼š" + watchedEvent.getPath() + "è¢«åˆ›å»º"); &#125; else if(Event.EventType.NodeDeleted == watchedEvent.getType()) &#123; System.out.println("Watcherï¼š" + watchedEvent.getPath() + "è¢«åˆ é™¤"); &#125; else if(Event.EventType.NodeDataChanged == watchedEvent.getType()) &#123; System.out.println("Watcherï¼š" + watchedEvent.getPath() + "è¢«ä¿®æ”¹"); &#125; else if(Event.EventType.NodeChildrenChanged == watchedEvent.getType()) &#123; System.out.println("Watcherï¼š" + watchedEvent.getPath() + "çš„å­èŠ‚ç‚¹æ•°é‡å‘ç”Ÿæ”¹å˜"); &#125; countDownLatch.countDown(); &#125; catch(Exception e) &#123; e.printStackTrace(); &#125; &#125; System.out.println("Watcherï¼š" + this); &#125;&#125; è¾“å‡º12345678910111213141516171819202122232425262728293031323334353637connect CONNECTINGWatcherï¼šSyncConnected--&gt;NoneWatcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@7b23ec81connect CONNECTEDcreateWatcherï¼š/xychçš„èŠ‚ç‚¹å±žæ€§ï¼šnullWatcherï¼š/xychè¢«åˆ›å»ºWatcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@1a7d63bdsetDataWatcherï¼š/xychçš„åŽŸå§‹å€¼ = xychsetDataWatcherï¼š/xychçš„èŠ‚ç‚¹ä¿¡æ¯ = 165,165,1524221468877,1524221468877,0,0,0,72057600313458724,4,0,165Watcherï¼š/xychè¢«ä¿®æ”¹Watcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@7aa0aa6fdeleteWatcherï¼š/xychçš„èŠ‚ç‚¹å±žæ€§ï¼š165,166,1524221468877,1524221468884,1,0,0,72057600313458724,4,0,165Watcherï¼š/xychè¢«åˆ é™¤Watcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@bb15e0dcreateWatcher_Childrenï¼š/xych1çš„å­èŠ‚ç‚¹ï¼š[]Watcherï¼š/xych1/lanbooè¢«åˆ›å»ºWatcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@2cce4a9aWatcherï¼š/xych1çš„å­èŠ‚ç‚¹æ•°é‡å‘ç”Ÿæ”¹å˜Watcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@2d8e2810setDataWatcher_Childrenï¼š/xych1çš„å­èŠ‚ç‚¹ï¼š[lanboo]Watcherï¼š/xych1/lanbooè¢«ä¿®æ”¹Watcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@7333dbfedeleteWatcher_Childrenï¼š/xych1çš„å­èŠ‚ç‚¹ï¼š[lanboo]Watcherï¼š/xych1/lanbooè¢«åˆ é™¤Watcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@7165a6c4Watcherï¼š/xych1çš„å­èŠ‚ç‚¹æ•°é‡å‘ç”Ÿæ”¹å˜Watcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@2f21b320Watcherï¼š/xych1çš„å­èŠ‚ç‚¹æ•°é‡å‘ç”Ÿæ”¹å˜Watcherï¼šcom.xych.zookeeper.api.ApiZookeeperWatcher@31ecabd5]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤§åž‹è·¨å¢ƒç”µå•†JVMè°ƒä¼˜ç»åŽ†]]></title>
    <url>%2F2018%2F05%2F29%2F%E5%A4%A7%E5%9E%8B%E8%B7%A8%E5%A2%83%E7%94%B5%E5%95%86JVM%E8%B0%83%E4%BC%98%E7%BB%8F%E5%8E%86%2F</url>
    <content type="text"><![CDATA[ç¤ºä¾‹ å¼•ç”¨è‡ª https://juejin.im/post/5b091ee35188253892389683?utm_source=gold_browser_extension å‰æï¼šæŸå¤§åž‹è·¨å¢ƒç”µå•†ä¸šåŠ¡å‘å±•éžå¸¸å¿«ï¼Œçº¿ä¸Šæœºå™¨æ‰©å®¹ä¹Ÿå¾ˆé¢‘ç¹ï¼Œä½†æ˜¯å¯¹äºŽçº¿ä¸Šæœºå™¨çš„è¿è¡Œæƒ…å†µï¼Œç‰¹åˆ«æ˜¯jvmå†…å­˜çš„æƒ…å†µï¼Œä¸€ç›´æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†æ¥ç»™åˆ°å„ä¸ªåº”ç”¨æœåŠ¡çš„ownerã€‚ç»è¿‡618å¤§ä¿ƒä¹‹åŽï¼Œå’Œè¿ç»´çš„åŒå­¦è®¨è®ºäº†ä¸‹ï¼Œå¸Œæœ›å°†çº¿ä¸ŠæœåŠ¡å™¨çš„jvmå‚æ•°æ ‡å‡†åŒ–ï¼Œå¯ä»¥ä»¥ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼ç»™åˆ°å„ä¸ªåº”ç”¨ï¼Œæå‡çº¿ä¸ŠæœåŠ¡å™¨çš„ç¨³å®šæ€§ï¼ŒåŒæ—¶å‡å°‘å¤§å®¶éƒ½åŽ»è°ƒæ•´jvmå‚æ•°çš„æ—¶é—´ã€‚å‚è€ƒäº†ä¹‹å‰åœ¨æ·˜å®å¤©çŒ«å·¥ä½œçš„å…¬å¸çš„ç»åŽ†ï¼šç»è¿‡å¤§å®¶è®¨è®ºï¼Œæ ¹æ®jdkçš„ç‰ˆæœ¬ä»¥åŠçº¿ä¸Šæœºå™¨é…ç½®ï¼Œç¡®å®šäº†ä¸€ä¸ªæŽ¨èçš„é»˜è®¤jvmæ¨¡ç‰ˆï¼šæœ€ç»ˆæŽ¨èçš„jvmæ¨¡ç‰ˆï¼šjdkç‰ˆæœ¬ æœºå™¨é…ç½® å»ºè®®jvmå‚æ•° å¤‡æ³¨ 1jdk1.7 6V8G -server -Xms4g -Xmx4g -Xmn2g -Xss768k -XX:PermSize=512m -XX:MaxPermSize=512m -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+CMSClassUnloadingEnabled -XX:+DisableExplicitGC -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=68 -verbose:gc -XX:+PrintGCDetails -Xloggc:&#123;CATALINA_BASE&#125;/logs/gc.log -XX:+PrintGCDateStamps -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=&#123;CATALINA_BASE&#125;/logs å‰å° 1jdk1.7 8V8G -server -Xms4g -Xmx4g -Xmn2g -Xss768k -XX:PermSize=512m -XX:MaxPermSize=512m -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+CMSClassUnloadingEnabled -XX:+DisableExplicitGC -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=68 -verbose:gc -XX:+PrintGCDetails -Xloggc:&#123;CATALINA_BASE&#125;/logs/gc.log -XX:+PrintGCDateStamps -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=&#123;CATALINA_BASE&#125;/logs å‰å° 1jdk1.7 4V8G -server -Xms4g -Xmx4g -Xmn2g -Xss768k -XX:PermSize=512m -XX:MaxPermSize=512m -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+CMSClassUnloadingEnabled -XX:+DisableExplicitGC -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=68 -verbose:gc -XX:+PrintGCDetails -Xloggc:&#123;CATALINA_BASE&#125;/logs/gc.log -XX:+PrintGCDateStamps -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=&#123;CATALINA_BASE&#125;/logs å‰å° 123jdk1.7 6V8G -server -Xms4g -Xmx4g -XX:MaxPermSize=512m \-verbose:gc -XX:+PrintGCDetails -Xloggcï¿¼&#123;CATALINA_BASE&#125;/logs/gc.log -XX:+PrintGCTimeStamps \ åŽå° é…ç½®è¯´æ˜Žï¼š å †è®¾ç½® o -Xms:åˆå§‹å †å¤§å°o -Xmx:æœ€å¤§å †å¤§å°o -XX:NewSize=n:è®¾ç½®å¹´è½»ä»£å¤§å°o -XX:NewRatio=n:è®¾ç½®å¹´è½»ä»£å’Œå¹´è€ä»£çš„æ¯”å€¼ã€‚å¦‚:ä¸º3ï¼Œè¡¨ç¤ºå¹´è½»ä»£ä¸Žå¹´è€ä»£æ¯”å€¼ä¸º1ï¼š3ï¼Œå¹´è½»ä»£å æ•´ä¸ªå¹´è½»ä»£å¹´è€ä»£å’Œçš„1/4o -XX:SurvivorRatio=n:å¹´è½»ä»£ä¸­EdenåŒºä¸Žä¸¤ä¸ªSurvivoråŒºçš„æ¯”å€¼ã€‚æ³¨æ„SurvivoråŒºæœ‰ä¸¤ä¸ªã€‚å¦‚ï¼š3ï¼Œè¡¨ç¤ºEdenï¼šSurvivor=3ï¼š2ï¼Œä¸€ä¸ªSurvivoråŒºå æ•´ä¸ªå¹´è½»ä»£çš„1/5o -XX:MaxPermSize=n:è®¾ç½®æŒä¹…ä»£å¤§å° æ”¶é›†å™¨è®¾ç½® o -XX:+UseSerialGC:è®¾ç½®ä¸²è¡Œæ”¶é›†å™¨o -XX:+UseParallelGC:è®¾ç½®å¹¶è¡Œæ”¶é›†å™¨o -XX:+UseParalledlOldGC:è®¾ç½®å¹¶è¡Œå¹´è€ä»£æ”¶é›†å™¨o -XX:+UseConcMarkSweepGC:è®¾ç½®å¹¶å‘æ”¶é›†å™¨ åžƒåœ¾å›žæ”¶ç»Ÿè®¡ä¿¡æ¯-XX:+PrintGC-XX:+PrintGCDetails-XX:+PrintGCTimeStamps-Xloggc:filename å¹¶è¡Œæ”¶é›†å™¨è®¾ç½®-XX:ParallelGCThreads=n:è®¾ç½®å¹¶è¡Œæ”¶é›†å™¨æ”¶é›†æ—¶ä½¿ç”¨çš„CPUæ•°ã€‚å¹¶è¡Œæ”¶é›†çº¿ç¨‹æ•°ã€‚-XX:MaxGCPauseMillis=n:è®¾ç½®å¹¶è¡Œæ”¶é›†æœ€å¤§æš‚åœæ—¶é—´-XX:GCTimeRatio=n:è®¾ç½®åžƒåœ¾å›žæ”¶æ—¶é—´å ç¨‹åºè¿è¡Œæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚å…¬å¼ä¸º1/(1+n) å¹¶å‘æ”¶é›†å™¨è®¾ç½®-XX:+CMSIncrementalMode:è®¾ç½®ä¸ºå¢žé‡æ¨¡å¼ã€‚é€‚ç”¨äºŽå•CPUæƒ…å†µã€‚-XX:ParallelGCThreads=n:è®¾ç½®å¹¶å‘æ”¶é›†å™¨å¹´è½»ä»£æ”¶é›†æ–¹å¼ä¸ºå¹¶è¡Œæ”¶é›†æ—¶ï¼Œä½¿ç”¨çš„CPUæ•°ã€‚å¹¶è¡Œæ”¶é›†çº¿ç¨‹æ•°ã€‚ å‚æ•°è§£é‡Šï¼š-Xms3072m -Xmx3072mé’ˆå¯¹JVMå †çš„è®¾ç½®ï¼Œé€šè¿‡-Xms -Xmxé™å®šå…¶æœ€å°ã€æœ€å¤§å€¼ -Xmn1024mè®¾ç½®å¹´è½»ä»£å¤§å°ä¸º1024mæ•´ä¸ªJVMå†…å­˜å¤§å°=å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å° + æŒä¹…ä»£å¤§å°ï¼ˆpermï¼‰ã€‚ -Xss768k è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ã€‚JDK5.0ä»¥åŽæ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º1Mï¼Œä»¥å‰æ¯ä¸ªçº¿ç¨‹å †æ ˆå¤§å°ä¸º256Kã€‚æ›´å…·åº”ç”¨çš„çº¿ç¨‹æ‰€éœ€å†…å­˜å¤§å°è¿›è¡Œè°ƒæ•´ã€‚åœ¨ç›¸åŒç‰©ç†å†…å­˜ä¸‹ï¼Œå‡å°è¿™ä¸ªå€¼èƒ½ç”Ÿæˆæ›´å¤šçš„çº¿ç¨‹ã€‚ä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹æ•°è¿˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œä¸èƒ½æ— é™ç”Ÿæˆï¼Œç»éªŒå€¼åœ¨3000~5000å·¦å³ã€‚ -XX:PermSize=512m -XX:MaxPermSize=512mæŒä¹…ä»£ä¸€èˆ¬å›ºå®šå¤§å°ä¸º64mï¼Œæ‰€ä»¥å¢žå¤§å¹´è½»ä»£åŽï¼Œå°†ä¼šå‡å°å¹´è€ä»£å¤§å°ã€‚æ­¤å€¼å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒSunå®˜æ–¹æŽ¨èé…ç½®ä¸ºæ•´ä¸ªå †çš„3/8ã€‚è®¾ç½®éžå †å†…å­˜åˆå§‹å€¼ï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼›ç”±XX:MaxPermSizeè®¾ç½®æœ€å¤§éžå †å†…å­˜çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/4 -XX:+UseConcMarkSweepGCCMSæ”¶é›†å™¨ä¹Ÿè¢«ç§°ä¸ºçŸ­æš‚åœé¡¿å¹¶å‘æ”¶é›†å™¨ã€‚å®ƒæ˜¯å¯¹å¹´è€ä»£è¿›è¡Œåžƒåœ¾æ”¶é›†çš„ã€‚CMSæ”¶é›†å™¨é€šè¿‡å¤šçº¿ç¨‹å¹¶å‘è¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œå°½é‡å‡å°‘åžƒåœ¾æ”¶é›†é€ æˆçš„åœé¡¿ã€‚CMSæ”¶é›†å™¨å¯¹å¹´è½»ä»£è¿›è¡Œåžƒåœ¾å›žæ”¶ä½¿ç”¨çš„ç®—æ³•å’ŒParallelæ”¶é›†å™¨ä¸€æ ·ã€‚è¿™ä¸ªåžƒåœ¾æ”¶é›†å™¨é€‚ç”¨äºŽä¸èƒ½å¿å—é•¿æ—¶é—´åœé¡¿è¦æ±‚å¿«é€Ÿå“åº”çš„åº”ç”¨ã€‚ -XX:+UseParNewGCå¯¹å¹´è½»ä»£é‡‡ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå›žæ”¶ï¼Œè¿™æ ·æ”¶å¾—å¿«ï¼› -XX:+CMSClassUnloadingEnabledå¦‚æžœä½ å¯ç”¨äº†CMSClassUnloadingEnabled ï¼Œåžƒåœ¾å›žæ”¶ä¼šæ¸…ç†æŒä¹…ä»£ï¼Œç§»é™¤ä¸å†ä½¿ç”¨çš„classesã€‚è¿™ä¸ªå‚æ•°åªæœ‰åœ¨ UseConcMarkSweepGC ä¹Ÿå¯ç”¨çš„æƒ…å†µä¸‹æ‰æœ‰ç”¨ã€‚ -XX:+DisableExplicitGCç¦æ­¢System.gc()ï¼Œå…å¾—ç¨‹åºå‘˜è¯¯è°ƒç”¨gcæ–¹æ³•å½±å“æ€§èƒ½ï¼› -XX:+UseCMSInitiatingOccupancyOnlyæ ‡å¿—æ¥å‘½ä»¤JVMä¸åŸºäºŽè¿è¡Œæ—¶æ”¶é›†çš„æ•°æ®æ¥å¯åŠ¨CMSåžƒåœ¾æ”¶é›†å‘¨æœŸã€‚è€Œæ˜¯ï¼Œå½“è¯¥æ ‡å¿—è¢«å¼€å¯æ—¶ï¼ŒJVMé€šè¿‡CMSInitiatingOccupancyFractionçš„å€¼è¿›è¡Œæ¯ä¸€æ¬¡CMSæ”¶é›†ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¬¬ä¸€æ¬¡ã€‚ç„¶è€Œï¼Œè¯·è®°ä½å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒJVMæ¯”æˆ‘ä»¬è‡ªå·±èƒ½ä½œå‡ºæ›´å¥½çš„åžƒåœ¾æ”¶é›†å†³ç­–ã€‚å› æ­¤ï¼Œåªæœ‰å½“æˆ‘ä»¬å……è¶³çš„ç†ç”±(æ¯”å¦‚æµ‹è¯•)å¹¶ä¸”å¯¹åº”ç”¨ç¨‹åºäº§ç”Ÿçš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæœ‰æ·±åˆ»çš„è®¤çŸ¥æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨è¯¥æ ‡å¿—ã€‚ -XX:CMSInitiatingOccupancyFraction=68é»˜è®¤CMSæ˜¯åœ¨tenured generation(å¹´è€ä»£ï¼‰å æ»¡68%çš„æ—¶å€™å¼€å§‹è¿›è¡ŒCMSæ”¶é›†ï¼Œå¦‚æžœä½ çš„å¹´è€ä»£å¢žé•¿ä¸æ˜¯é‚£ä¹ˆå¿«ï¼Œå¹¶ä¸”å¸Œæœ›é™ä½ŽCMSæ¬¡æ•°çš„è¯ï¼Œå¯ä»¥é€‚å½“è°ƒé«˜æ­¤å€¼ï¼› -XX:+UseParNewGCï¼šå¯¹å¹´è½»ä»£é‡‡ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå›žæ”¶ï¼Œè¿™æ ·æ”¶å¾—å¿«ï¼› -XX:HeapDumpPath-XX:+PrintGCDetails-XX:+PrintGCTimeStamps-Xloggc:/usr/aaa/dump/heap_trace.txtä¸Šé¢çš„çš„å‚æ•°æ‰“Heap Dumpä¿¡æ¯ â€œ -XX:+HeapDumpOnOutOfMemoryErroræ­¤å‚æ•°å¯ä»¥æŽ§åˆ¶OutOfMemoryErroræ—¶æ‰“å°å †çš„ä¿¡æ¯ å¤§å®¶å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œè¿™é‡ŒæŽ¨èé‡‡ç”¨cmsæ–¹å¼è¿›è¡Œåžƒåœ¾å›žæ”¶ï¼›CMSæ˜¯ä¸€ç§ä»¥èŽ·å–æœ€çŸ­å›žæ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘æœåŠ¡å™¨åœé¡¿çš„æ—¶é—´ï¼›CMSçš„GCçº¿ç¨‹å¯¹CPUçš„å ç”¨çŽ‡ä¼šæ¯”è¾ƒé«˜ï¼Œä½†åœ¨å¤šæ ¸çš„æœåŠ¡å™¨ä¸Šè¿˜æ˜¯å±•çŽ°äº†ä¼˜è¶Šçš„ç‰¹æ€§ï¼Œç›®å‰ä¹Ÿè¢«éƒ¨ç½²åœ¨å›½å†…çš„å„å¤§ç”µå•†ç½‘ç«™ä¸Šã€‚æ‰€ä»¥è¿™é‡Œå¼ºçƒˆæŽ¨èï¼cmsçš„æ¦‚å¿µï¼š CMSæ”¶é›†å™¨ä¹Ÿè¢«ç§°ä¸ºçŸ­æš‚åœé¡¿å¹¶å‘æ”¶é›†å™¨ã€‚å®ƒæ˜¯å¯¹å¹´è€ä»£è¿›è¡Œåžƒåœ¾æ”¶é›†çš„ã€‚CMSæ”¶é›†å™¨é€šè¿‡å¤šçº¿ç¨‹å¹¶å‘è¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œå°½é‡å‡å°‘åžƒåœ¾æ”¶é›†é€ æˆçš„åœé¡¿ã€‚CMSæ”¶é›†å™¨å¯¹å¹´è½»ä»£è¿›è¡Œåžƒåœ¾å›žæ”¶ä½¿ç”¨çš„ç®—æ³•å’ŒParallelæ”¶é›†å™¨ä¸€æ ·ã€‚è¿™ä¸ªåžƒåœ¾æ”¶é›†å™¨é€‚ç”¨äºŽä¸èƒ½å¿å—é•¿æ—¶é—´åœé¡¿è¦æ±‚å¿«é€Ÿå“åº”çš„åº”ç”¨ã€‚CMSé‡‡ç”¨äº†å¤šç§æ–¹å¼å°½å¯èƒ½é™ä½ŽGCçš„æš‚åœæ—¶é—´,å‡å°‘ç”¨æˆ·ç¨‹åºåœé¡¿ã€‚åœé¡¿æ—¶é—´é™ä½Žçš„åŒæ—¶ç‰ºç‰²äº†CPUåžåé‡ ã€‚è¿™æ˜¯åœ¨åœé¡¿æ—¶é—´å’Œæ€§èƒ½é—´åšå‡ºçš„å–èˆï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºâ€ç©ºé—´(æ€§èƒ½)â€æ¢æ—¶é—´ã€‚ è°ƒæ•´çš„èŠ‚å¥ï¼šç”±äºŽæ€•å½±å“çº¿ä¸Šåº”ç”¨ï¼Œæ‰€ä»¥è°ƒæ•´çš„æ­¥éª¤åˆ†ä¸‰æ­¥ï¼šç¬¬ä¸€æ­¥ï¼šéƒ¨åˆ†å½±å“å°‘é‡æœºå™¨è¯•ç‚¹ï¼Œå¯¹æ¯”æœªè°ƒæ•´çš„æœºå™¨ï¼Œè§‚å¯Ÿè°ƒæ•´åŽçš„ç»“æžœï¼›ç¬¬äºŒæ­¥ï¼šè°ƒæ•´éƒ¨åˆ†åº”ç”¨çš„å‚æ•°ï¼Œè¿›è¡ŒåŽ‹æµ‹ï¼Œè§‚å¯Ÿé«˜å¹¶å‘åŽ‹æµ‹ä¹‹åŽçš„æ•ˆæžœï¼›ç¬¬ä¸‰æ­¥ï¼šè°ƒæ•´éƒ¨åˆ†æ ¸å¿ƒåº”ç”¨çš„jvmå‚æ•°ï¼Œé€šè¿‡818å¤§ä¿ƒæ¥å®žé™…æ£€éªŒæ•ˆæžœï¼› ä¸€:é•¿æœŸè¡¨çŽ°ï¼Œç¬¬ä¸€ä¸ªå˜åŒ–ï¼šfgcçš„æ¬¡æ•°å‡å°‘ï¼Œå‡å°‘äº†å¤§æ¦‚ä¸€å€ä»¥ä¸Šï¼›mobileå·¥ç¨‹ï¼Œè°ƒæ•´å‰åŸºæœ¬ä¸Šä¸€å¤©1-2è¾†æ¬¡ï¼Œè°ƒæ•´åŽåŸºæœ¬ä¸Šå°±æ˜¯2-3å¤©ä¸€æ¬¡ï¼šonlineï¼ˆå¦å¤–ä¸€ä¸ªå·¥ç¨‹ï¼‰ï¼šå¯ä»¥æ˜Žæ˜¾çœ‹åˆ°fgcçš„ç»Ÿè®¡é¢‘çŽ‡å°‘äº†å¾ˆå¤šï¼› ç¬¬äºŒä¸ªå˜åŒ–ï¼šfgcçš„æ—¶é—´å‡å°‘åŽŸæ¥ä¸€æ¬¡fgcè¦å°†è¿‘500msï¼ŒçŽ°åœ¨åªè¦100msä¸åˆ°äº†ã€‚ä¹Ÿè¯æ˜Žäº†cmsæœ€å¤§çš„å¥½å¤„å°±æ˜¯å‡å°‘fgcçš„åœé¡¿æ—¶é—´ã€‚]]></content>
      <categories>
        <category>è°ƒä¼˜</category>
      </categories>
      <tags>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mysqlè¯­å¥ä¼˜åŒ–explainä½¿ç”¨]]></title>
    <url>%2F2018%2F05%2F18%2FMysql%E8%AF%AD%E5%8F%A5%E4%BC%98%E5%8C%96explain%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[id1å¦‚æžœæ˜¯å­æŸ¥è¯¢ï¼Œidçš„åºå·ä¼šé€’å¢žï¼Œidçš„å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ select_typeæŸ¥è¯¢çš„ç±»åž‹ï¼Œä¸»è¦ç”¨äºŽåŒºåˆ«æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰çš„å¤æ‚æŸ¥è¯¢ SIMPLE:ç®€å•çš„selectæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…UNION PRIMARY:æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†ï¼Œæœ€å¤–å±‚æŸ¥è¯¢åˆ™è¢«æ ‡è®°ä¸ºPRIMARYï¼ˆæœ€åŽåŠ è½½çš„é‚£ä¸€ä¸ª ï¼‰ SUBQUERY:åœ¨SELECTæˆ–WHEREåˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢ DERIVED:åœ¨FROMåˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸ºDERIVEDï¼ˆè¡ç”Ÿï¼‰ï¼ŒMysqlä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æžœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œã€‚ UNION:è‹¥ç¬¬äºŒä¸ªSELECTå‡ºçŽ°åœ¨UNIONä¹‹åŽï¼Œåˆ™è¢«æ ‡è®°ä¸ºUNIONï¼›è‹¥UNIONåŒ…å«åœ¨FROMå­—å¥çš„æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚SELECTå°†è¢«æ ‡è®°ä¸º:DERIVED UNION RESULT:ä»ŽUNIONè¡¨èŽ·å–ç»“æžœçš„SELECT type æ˜¾ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ä½•ç§ç±»åž‹ï¼Œä»Žæœ€å¥½åˆ°æœ€å·®ä¾æ¬¡æ˜¯System&gt;const&gt;eq_ref&gt;range&gt;index&gt;Allï¼ˆå…¨è¡¨æ‰«æï¼‰ï¼Œä¸€èˆ¬æ¥è¯´è‡³å°‘è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½è¾¾åˆ°ref All:å…¨è¡¨æ‰«æ System:è¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼Œè¿™æ˜¯constç±»åž‹çš„ç‰¹ä¾‹ï¼Œå¹³æ—¶ä¸ä¼šå‡ºçŽ°(å¿½ç•¥ä¸è®¡) const:è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†,constç”¨äºŽæ¯”è¾ƒprimary keyæˆ–è€…uniqueç´¢å¼•ï¼Œå› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äºŽwhereåˆ—è¡¨ä¸­ï¼ŒMySQLå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ã€‚ const:è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†,constç”¨äºŽæ¯”è¾ƒprimary keyæˆ–è€…uniqueç´¢å¼•ï¼Œå› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äºŽwhereåˆ—è¡¨ä¸­ï¼ŒMySQLå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ã€‚ eq_ref:å”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œå¯¹äºŽæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸Žä¹‹åŒ¹é…ã€‚å¸¸è§äºŽä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æã€‚ refï¼šéžå”¯ä¸€ç´¢å¼•æ‰«æï¼Œè¿”å›žåŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œå®ƒè¿”å›žæ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œç„¶è€Œå®ƒå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥å®ƒåº”è¯¥å±žäºŽæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“ rangeï¼šåªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚keyåˆ—æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ï¼Œä¸€èˆ¬å°±æ˜¯åœ¨ä½ çš„whereè¯­å¥ä¸­å‡ºçŽ°äº†betweenã€&lt;ã€&gt;ã€inç­‰çš„æŸ¥è¯¢ã€‚è¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºŽç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œç»“æŸäºŽå¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•ã€‚ index:FULL INDEX SCAN,indexä¸ŽallåŒºåˆ«ä¸ºindexç±»åž‹åªéåŽ†ç´¢å¼•æ ‘ã€‚è¿™é€šå¸¸æ¯”allå¿«ï¼Œå› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ã€‚ rowsæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•° extraåŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯ åŒ…å«çš„ä¿¡æ¯ï¼š ï¼ˆå±é™©!ï¼‰Using filesort:è¯´æ˜Žmysqlä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æŽ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ï¼ŒMYSQLä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æŽ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æŽ’åºâ€ ï¼ˆç‰¹åˆ«å±é™©!ï¼‰Using temporary:ä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æžœï¼ŒMYSQLåœ¨å¯¹æŸ¥è¯¢ç»“æžœæŽ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äºŽæŽ’åºorder by å’Œåˆ†ç»„æŸ¥è¯¢ group by Using index:è¡¨ç¤ºç›¸åº”çš„selectæ“ä½œä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œé¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆçŽ‡ä¸é”™ã€‚å¦‚æžœåŒæ—¶å‡ºçŽ°using whereï¼Œè¡¨æ˜Žç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ï¼›å¦‚æžœæ²¡æœ‰åŒæ—¶å‡ºçŽ°using whereï¼Œè¡¨æ˜Žç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®è€Œéžæ‰§è¡ŒæŸ¥æ‰¾æ“ä½œã€‚ possible_keysæ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œ ä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢å®žé™…ä½¿ç”¨ keyå®žé™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æžœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•ä»…å‡ºçŽ°åœ¨keyåˆ—è¡¨ä¸­ï¼Œkeyå‚æ•°å¯ä»¥ä½œä¸ºä½¿ç”¨äº†ç´¢å¼•çš„åˆ¤æ–­æ ‡å‡† key_len:è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ç´¢å¼•çš„é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ï¼Œkey_lenæ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éžå®žé™…ä½¿ç”¨é•¿åº¦ï¼Œå³key_lenæ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å‡ºçš„ã€‚ refå¯¹åº”ç´¢å¼•çš„èµ‹å€¼ï¼Œæ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æžœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºŽæŸ¥æ‰¾ç´¢å¼•ä¸Šçš„å€¼ã€‚]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŸºäºŽ Redis çš„åˆ†å¸ƒå¼é”]]></title>
    <url>%2F2018%2F05%2F15%2F%E5%9F%BA%E4%BA%8E-Redis-%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%2F</url>
    <content type="text"><![CDATA[å‰è¨€åˆ†å¸ƒå¼é”åœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­åº”ç”¨å¹¿æ³›ï¼Œæƒ³è¦æžæ‡‚ä¸€ä¸ªæ–°äº‹ç‰©é¦–å…ˆå¾—äº†è§£å®ƒçš„ç”±æ¥ï¼Œè¿™æ ·æ‰èƒ½æ›´åŠ çš„ç†è§£ç”šè‡³å¯ä»¥ä¸¾ä¸€åä¸‰ã€‚ é¦–å…ˆè°ˆåˆ°åˆ†å¸ƒå¼é”è‡ªç„¶ä¹Ÿå°±è”æƒ³åˆ°åˆ†å¸ƒå¼åº”ç”¨ã€‚ åœ¨æˆ‘ä»¬å°†åº”ç”¨æ‹†åˆ†ä¸ºåˆ†å¸ƒå¼åº”ç”¨ä¹‹å‰çš„å•æœºç³»ç»Ÿä¸­ï¼Œå¯¹ä¸€äº›å¹¶å‘åœºæ™¯è¯»å–å…¬å…±èµ„æºæ—¶å¦‚æ‰£åº“å­˜ï¼Œå–è½¦ç¥¨ä¹‹ç±»çš„éœ€æ±‚å¯ä»¥ç®€å•çš„ä½¿ç”¨åŒæ­¥æˆ–è€…æ˜¯åŠ é”å°±å¯ä»¥å®žçŽ°ã€‚ ä½†æ˜¯åº”ç”¨åˆ†å¸ƒå¼äº†ä¹‹åŽç³»ç»Ÿç”±ä»¥å‰çš„å•è¿›ç¨‹å¤šçº¿ç¨‹çš„ç¨‹åºå˜ä¸ºäº†å¤šè¿›ç¨‹å¤šçº¿ç¨‹ï¼Œè¿™æ—¶ä½¿ç”¨ä»¥ä¸Šçš„è§£å†³æ–¹æ¡ˆæ˜Žæ˜¾å°±ä¸å¤Ÿäº†ã€‚ å› æ­¤ä¸šç•Œå¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯å€ŸåŠ©äºŽä¸€ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶å¹¶åˆ©ç”¨å®ƒè‡ªèº«çš„æŽ’ä»–æ€§æ¥è¾¾åˆ°å¤šè¿›ç¨‹çš„äº’æ–¥ã€‚å¦‚ï¼š åŸºäºŽ DB çš„å”¯ä¸€ç´¢å¼•ã€‚ åŸºäºŽ ZK çš„ä¸´æ—¶æœ‰åºèŠ‚ç‚¹ã€‚ åŸºäºŽ Redis çš„ NX EX å‚æ•°ã€‚ è¿™é‡Œä¸»è¦åŸºäºŽ Redis è¿›è¡Œè®¨è®ºã€‚ å®žçŽ°æ—¢ç„¶æ˜¯é€‰ç”¨äº† Redisï¼Œé‚£ä¹ˆå®ƒå°±å¾—å…·æœ‰æŽ’ä»–æ€§æ‰è¡Œã€‚åŒæ—¶å®ƒæœ€å¥½ä¹Ÿæœ‰é”çš„ä¸€äº›åŸºæœ¬ç‰¹æ€§ï¼š é«˜æ€§èƒ½(åŠ ã€è§£é”æ—¶é«˜æ€§èƒ½) å¯ä»¥ä½¿ç”¨é˜»å¡žé”ä¸Žéžé˜»å¡žé”ã€‚ ä¸èƒ½å‡ºçŽ°æ­»é”ã€‚ å¯ç”¨æ€§(ä¸èƒ½å‡ºçŽ°èŠ‚ç‚¹ down æŽ‰åŽåŠ é”å¤±è´¥)ã€‚ è¿™é‡Œåˆ©ç”¨ Redis set key æ—¶çš„ä¸€ä¸ª NX å‚æ•°å¯ä»¥ä¿è¯åœ¨è¿™ä¸ª key ä¸å­˜åœ¨çš„æƒ…å†µä¸‹å†™å…¥æˆåŠŸã€‚å¹¶ä¸”å†åŠ ä¸Š EX å‚æ•°å¯ä»¥è®©è¯¥ key åœ¨è¶…æ—¶ä¹‹åŽè‡ªåŠ¨åˆ é™¤ã€‚ æ‰€ä»¥åˆ©ç”¨ä»¥ä¸Šä¸¤ä¸ªç‰¹æ€§å¯ä»¥ä¿è¯åœ¨åŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹èŽ·å¾—é”ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºçŽ°æ­»é”(æœ€åçš„æƒ…å†µå°±æ˜¯è¶…æ—¶è‡ªåŠ¨åˆ é™¤ key)ã€‚ åŠ é”å®žçŽ°ä»£ç å¦‚ä¸‹ï¼š 123456789101112private static final String SET_IF_NOT_EXIST = "NX";private static final String SET_WITH_EXPIRE_TIME = "PX";public boolean tryLock(String key, String request) &#123; String result = this.jedis.set(LOCK_PREFIX + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); if (LOCK_MSG.equals(result))&#123; return true ; &#125;else &#123; return false ; &#125;&#125; æ³¨æ„è¿™é‡Œä½¿ç”¨çš„ jedis çš„ 1String set(String key, String value, String nxxx, String expx, long time); apiã€‚ è¯¥å‘½ä»¤å¯ä»¥ä¿è¯ NX EX çš„åŽŸå­æ€§ã€‚ ä¸€å®šä¸è¦æŠŠä¸¤ä¸ªå‘½ä»¤(NX EX)åˆ†å¼€æ‰§è¡Œï¼Œå¦‚æžœåœ¨ NX ä¹‹åŽç¨‹åºå‡ºçŽ°é—®é¢˜å°±æœ‰å¯èƒ½äº§ç”Ÿæ­»é”ã€‚ é˜»å¡žé”åŒæ—¶ä¹Ÿå¯ä»¥å®žçŽ°ä¸€ä¸ªé˜»å¡žé”ï¼š 123456789101112131415161718192021222324252627282930//ä¸€ç›´é˜»å¡žpublic void lock(String key, String request) throws InterruptedException &#123; for (;;)&#123; String result = this.jedis.set(LOCK_PREFIX + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); if (LOCK_MSG.equals(result))&#123; break ; &#125; //é˜²æ­¢ä¸€ç›´æ¶ˆè€— CPU Thread.sleep(DEFAULT_SLEEP_TIME) ; &#125;&#125; //è‡ªå®šä¹‰é˜»å¡žæ—¶é—´ public boolean lock(String key, String request,int blockTime) throws InterruptedException &#123; while (blockTime &gt;= 0)&#123; String result = this.jedis.set(LOCK_PREFIX + key, request, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, 10 * TIME); if (LOCK_MSG.equals(result))&#123; return true ; &#125; blockTime -= DEFAULT_SLEEP_TIME ; Thread.sleep(DEFAULT_SLEEP_TIME) ; &#125; return false ;&#125; è§£é”è§£é”ä¹Ÿå¾ˆç®€å•ï¼Œå…¶å®žå°±æ˜¯æŠŠè¿™ä¸ª key åˆ æŽ‰å°±ä¸‡äº‹å¤§å‰äº†ï¼Œæ¯”å¦‚ä½¿ç”¨ del key å‘½ä»¤ã€‚ ä½†çŽ°å®žå¾€å¾€æ²¡æœ‰é‚£ä¹ˆ easyã€‚ å¦‚æžœè¿›ç¨‹ A èŽ·å–äº†é”è®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯ç”±äºŽæ‰§è¡Œå‘¨æœŸè¾ƒé•¿å¯¼è‡´åˆ°äº†è¶…æ—¶æ—¶é—´ä¹‹åŽé”å°±è‡ªåŠ¨é‡Šæ”¾äº†ã€‚è¿™æ—¶è¿›ç¨‹ B èŽ·å–äº†è¯¥é”æ‰§è¡Œå¾ˆå¿«å°±é‡Šæ”¾é”ã€‚è¿™æ ·å°±ä¼šå‡ºçŽ°è¿›ç¨‹ B å°†è¿›ç¨‹ A çš„é”é‡Šæ”¾äº†ã€‚ æ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯åœ¨æ¯æ¬¡è§£é”æ—¶éƒ½éœ€è¦åˆ¤æ–­é”æ˜¯å¦æ˜¯è‡ªå·±çš„ã€‚ è¿™æ—¶å°±éœ€è¦ç»“åˆåŠ é”æœºåˆ¶ä¸€èµ·å®žçŽ°äº†ã€‚ åŠ é”æ—¶éœ€è¦ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œå°†è¯¥å‚æ•°ä½œä¸ºè¿™ä¸ª key çš„ valueï¼Œè¿™æ ·æ¯æ¬¡è§£é”æ—¶åˆ¤æ–­ value æ˜¯å¦ç›¸ç­‰å³å¯ã€‚ æ‰€ä»¥è§£é”ä»£ç å°±ä¸èƒ½æ˜¯ç®€å•çš„ deläº†ã€‚ 1234567891011121314151617181920public boolean unlock(String key,String request)&#123; //lua script String script = "if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end"; Object result = null ; if (jedis instanceof Jedis)&#123; result = ((Jedis)this.jedis).eval(script, Collections.singletonList(LOCK_PREFIX + key), Collections.singletonList(request)); &#125;else if (jedis instanceof JedisCluster)&#123; result = ((JedisCluster)this.jedis).eval(script, Collections.singletonList(LOCK_PREFIX + key), Collections.singletonList(request)); &#125;else &#123; //throw new RuntimeException("instance is error") ; return false ; &#125; if (UNLOCK_MSG.equals(result))&#123; return true ; &#125;else &#123; return false ; &#125;&#125; è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ª lua è„šæœ¬æ¥åˆ¤æ–­ value æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰æ‰æ‰§è¡Œ del å‘½ä»¤ã€‚ ä½¿ç”¨ lua ä¹Ÿå¯ä»¥ä¿è¯è¿™é‡Œä¸¤ä¸ªæ“ä½œçš„åŽŸå­æ€§ã€‚ å› æ­¤ä¸Šæ–‡æåˆ°çš„å››ä¸ªåŸºæœ¬ç‰¹æ€§ä¹Ÿèƒ½æ»¡è¶³äº†ï¼š ä½¿ç”¨ Redis å¯ä»¥ä¿è¯æ€§èƒ½ã€‚ é˜»å¡žé”ä¸Žéžé˜»å¡žé”è§ä¸Šæ–‡ã€‚ åˆ©ç”¨è¶…æ—¶æœºåˆ¶è§£å†³äº†æ­»é”ã€‚ Redis æ”¯æŒé›†ç¾¤éƒ¨ç½²æé«˜äº†å¯ç”¨æ€§ã€‚ ä½¿ç”¨æˆ‘è‡ªå·±æœ‰æ’¸äº†ä¸€ä¸ªå®Œæ•´çš„å®žçŽ°ï¼Œå¹¶ä¸”å·²ç»ç”¨äºŽäº†ç”Ÿäº§ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å¼€ç®±ä½¿ç”¨: maven ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;top.crossoverjie.opensource&lt;/groupId&gt; &lt;artifactId&gt;distributed-redis-lock&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt;&lt;/dependency&gt; é…ç½® bean : 1234567891011121314@Configurationpublic class RedisLockConfig &#123; @Bean public RedisLock build()&#123; RedisLock redisLock = new RedisLock() ; HostAndPort hostAndPort = new HostAndPort("127.0.0.1",7000) ; JedisCluster jedisCluster = new JedisCluster(hostAndPort) ; // Jedis æˆ– JedisCluster éƒ½å¯ä»¥ redisLock.setJedisCluster(jedisCluster) ; return redisLock ; &#125;&#125; ä½¿ç”¨ï¼š 123456789101112131415161718192021@Autowiredprivate RedisLock redisLock ;public void use() &#123; String key = "key"; String request = UUID.randomUUID().toString(); try &#123; boolean locktest = redisLock.tryLock(key, request); if (!locktest) &#123; System.out.println("locked error"); return; &#125; //do something &#125; finally &#123; redisLock.unlock(key,request) ; &#125;&#125; ä½¿ç”¨å¾ˆç®€å•ã€‚è¿™é‡Œä¸»è¦æ˜¯æƒ³åˆ©ç”¨ Spring æ¥å¸®æˆ‘ä»¬ç®¡ç† RedisLock è¿™ä¸ªå•ä¾‹çš„ beanï¼Œæ‰€ä»¥åœ¨é‡Šæ”¾é”çš„æ—¶å€™éœ€è¦æ‰‹åŠ¨(å› ä¸ºæ•´ä¸ªä¸Šä¸‹æ–‡åªæœ‰ä¸€ä¸ª RedisLock å®žä¾‹)çš„ä¼ å…¥ key ä»¥åŠ request(api çœ‹èµ·æ¥ä¸æ˜¯ç‰¹åˆ«ä¼˜é›…)ã€‚ ä¹Ÿå¯ä»¥åœ¨æ¯æ¬¡ä½¿ç”¨é”çš„æ—¶å€™ new ä¸€ä¸ª RedisLock ä¼ å…¥ key ä»¥åŠ requestï¼Œè¿™æ ·å€’æ˜¯åœ¨è§£é”æ—¶å¾ˆæ–¹ä¾¿ã€‚ä½†æ˜¯éœ€è¦è‡ªè¡Œç®¡ç† RedisLock çš„å®žä¾‹ã€‚å„æœ‰ä¼˜åŠ£å§ã€‚ é¡¹ç›®æºç åœ¨ï¼š https://github.com/crossoverJie/distributed-lock-redis æ¬¢è¿Žè®¨è®ºã€‚ å•æµ‹åœ¨åšè¿™ä¸ªé¡¹ç›®çš„æ—¶å€™è®©æˆ‘ä¸å¾—ä¸æƒ³æä¸€ä¸‹å•æµ‹ã€‚ å› ä¸ºè¿™ä¸ªåº”ç”¨æ˜¯å¼ºä¾èµ–äºŽç¬¬ä¸‰æ–¹ç»„ä»¶çš„(Redis)ï¼Œä½†æ˜¯åœ¨å•æµ‹ä¸­æˆ‘ä»¬éœ€è¦æŽ’é™¤æŽ‰è¿™ç§ä¾èµ–ã€‚æ¯”å¦‚å…¶ä»–ä¼™ä¼´ fork äº†è¯¥é¡¹ç›®æƒ³åœ¨æœ¬åœ°è·‘ä¸€éå•æµ‹ï¼Œç»“æžœè¿è¡Œä¸èµ·æ¥ï¼š æœ‰å¯èƒ½æ˜¯ Redis çš„ ipã€ç«¯å£å’Œå•æµ‹é‡Œçš„ä¸ä¸€è‡´ã€‚ Redis è‡ªèº«å¯èƒ½ä¹Ÿæœ‰é—®é¢˜ã€‚ ä¹Ÿæœ‰å¯èƒ½æ˜¯è¯¥åŒå­¦çš„çŽ¯å¢ƒä¸­å¹¶æ²¡æœ‰ Redisã€‚ æ‰€ä»¥æœ€å¥½æ˜¯è¦æŠŠè¿™äº›å¤–éƒ¨ä¸ç¨³å®šçš„å› ç´ æŽ’é™¤æŽ‰ï¼Œå•æµ‹åªæµ‹æˆ‘ä»¬å†™å¥½çš„ä»£ç ã€‚ äºŽæ˜¯å°±å¯ä»¥å¼•å…¥å•æµ‹åˆ©å™¨ Mock äº†ã€‚ å®ƒçš„æƒ³æ³•å¾ˆç®€ç­”ï¼Œå°±æ˜¯è¦æŠŠä½ æ‰€ä¾èµ–çš„å¤–éƒ¨èµ„æºç»Ÿç»Ÿå±è”½æŽ‰ã€‚å¦‚ï¼šæ•°æ®åº“ã€å¤–éƒ¨æŽ¥å£ã€å¤–éƒ¨æ–‡ä»¶ç­‰ç­‰ã€‚ ä½¿ç”¨æ–¹å¼ä¹ŸæŒºç®€å•ï¼Œå¯ä»¥å‚è€ƒè¯¥é¡¹ç›®çš„å•æµ‹ï¼š 12345678910111213141516@Testpublic void tryLock() throws Exception &#123; String key = "test"; String request = UUID.randomUUID().toString(); Mockito.when(jedisCluster.set(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyLong())).thenReturn("OK"); boolean locktest = redisLock.tryLock(key, request); System.out.println("locktest=" + locktest); Assert.assertTrue(locktest); //check Mockito.verify(jedisCluster).set(Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyString(), Mockito.anyLong());&#125; è¿™é‡Œåªæ˜¯ç®€å•æ¼”ç¤ºä¸‹ï¼Œå¯ä»¥çš„è¯ä¸‹æ¬¡ä»”ç»†åˆ†æžåˆ†æžã€‚ å®ƒçš„åŽŸç†å…¶å®žä¹ŸæŒºç®€å•ï¼Œdebug çš„è¯å¯ä»¥å¾ˆç›´æŽ¥çš„çœ‹å‡ºæ¥ï¼š è¿™é‡Œæˆ‘ä»¬æ‰€ä¾èµ–çš„ JedisCluster å…¶å®žæ˜¯ä¸€ä¸ª cglib ä»£ç†å¯¹è±¡ã€‚æ‰€ä»¥ä¹Ÿä¸éš¾æƒ³åˆ°å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° JedisCluster çš„ set å‡½æ•°å¹¶éœ€è¦å®ƒçš„è¿”å›žå€¼ã€‚ Mock å°±å°†è¯¥å¯¹è±¡ä»£ç†äº†ï¼Œå¹¶åœ¨å®žé™…æ‰§è¡Œ set æ–¹æ³•åŽç»™ä½ è¿”å›žäº†ä¸€ä¸ªä½ è‡ªå®šä¹‰çš„å€¼ã€‚ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšå¿ƒæ‰€æ¬²çš„æµ‹è¯•äº†ï¼Œå®Œå…¨æŠŠå¤–éƒ¨ä¾èµ–æ‰€å±è”½äº†ã€‚ æ€»ç»“è‡³æ­¤ä¸€ä¸ªåŸºäºŽ Redis çš„åˆ†å¸ƒå¼é”å®Œæˆï¼Œä½†æ˜¯ä¾ç„¶æœ‰äº›é—®é¢˜ã€‚ å¦‚åœ¨ key è¶…æ—¶ä¹‹åŽä¸šåŠ¡å¹¶æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ä½†å´è‡ªåŠ¨é‡Šæ”¾é”äº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å¹¶å‘é—®é¢˜ã€‚ å°±ç®— Redis æ˜¯é›†ç¾¤éƒ¨ç½²çš„ï¼Œå¦‚æžœæ¯ä¸ªèŠ‚ç‚¹éƒ½åªæ˜¯ master æ²¡æœ‰ slaveï¼Œé‚£ä¹ˆ master å®•æœºæ—¶è¯¥èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰ key åœ¨é‚£ä¸€æ—¶åˆ»éƒ½ç›¸å½“äºŽæ˜¯é‡Šæ”¾é”äº†ï¼Œè¿™æ ·ä¹Ÿä¼šå‡ºçŽ°å¹¶å‘é—®é¢˜ã€‚å°±ç®—æ˜¯æœ‰ slave èŠ‚ç‚¹ï¼Œä½†å¦‚æžœåœ¨æ•°æ®åŒæ­¥åˆ° salve ä¹‹å‰ master å®•æœºä¹Ÿæ˜¯ä¼šå‡ºçŽ°ä¸Šé¢çš„é—®é¢˜ã€‚ æ„Ÿå…´è¶£çš„æœ‹å‹è¿˜å¯ä»¥å‚è€ƒ Redisson çš„å®žçŽ°ã€‚]]></content>
      <categories>
        <category>ç¼“å­˜</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼é”</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Disruptorå¹¶å‘æ¡†æž¶ä¸Šæ‰‹demo]]></title>
    <url>%2F2018%2F05%2F15%2FDisruptor%E5%B9%B6%E5%8F%91%E6%A1%86%E6%9E%B6%E4%B8%8A%E6%89%8Bdemo%2F</url>
    <content type="text"><![CDATA[æ¡†æž¶ç®€ä»‹ Martin Fowleråœ¨è‡ªå·±ç½‘ç«™ä¸Šå†™äº†ä¸€ç¯‡LMAXæž¶æž„çš„æ–‡ç« ï¼Œåœ¨æ–‡ç« ä¸­ä»–ä»‹ç»äº†LMAXæ˜¯ä¸€ç§æ–°åž‹é›¶å”®é‡‘èžäº¤æ˜“å¹³å°ï¼Œå®ƒèƒ½å¤Ÿä»¥å¾ˆä½Žçš„å»¶è¿Ÿäº§ç”Ÿå¤§é‡äº¤æ˜“ã€‚è¿™ä¸ªç³»ç»Ÿæ˜¯å»ºç«‹åœ¨JVMå¹³å°ä¸Šï¼Œå…¶æ ¸å¿ƒæ˜¯ä¸€ä¸ªä¸šåŠ¡é€»è¾‘å¤„ç†å™¨ï¼Œå®ƒèƒ½å¤Ÿåœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œæ¯ç§’å¤„ç†6ç™¾ä¸‡è®¢å•ã€‚ä¸šåŠ¡é€»è¾‘å¤„ç†å™¨å®Œå…¨æ˜¯è¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œä½¿ç”¨äº‹ä»¶æºé©±åŠ¨æ–¹å¼ã€‚ä¸šåŠ¡é€»è¾‘å¤„ç†å™¨çš„æ ¸å¿ƒæ˜¯Disruptorã€‚ Disruptorå®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„å¹¶å‘æ¡†æž¶ï¼Œå¹¶èŽ·å¾—2011 Dukeâ€™s ç¨‹åºæ¡†æž¶åˆ›æ–°å¥–ï¼Œèƒ½å¤Ÿåœ¨æ— é”çš„æƒ…å†µä¸‹å®žçŽ°ç½‘ç»œçš„Queueå¹¶å‘æ“ä½œã€‚ Disruptoræ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼‚æ­¥å¤„ç†æ¡†æž¶ï¼Œæˆ–è€…å¯ä»¥è®¤ä¸ºæ˜¯æœ€å¿«çš„æ¶ˆæ¯æ¡†æž¶ï¼ˆè½»é‡çš„JMSï¼‰ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼çš„å®žçŽ°ï¼Œæˆ–è€…äº‹ä»¶ç›‘å¬æ¨¡å¼çš„å®žçŽ°ã€‚ åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œé¦–å…ˆè¯´æ˜Ždisruptorä¸»è¦åŠŸèƒ½åŠ ä»¥è¯´æ˜Žï¼Œä½ å¯ä»¥ç†è§£ä¸ºä»–æ˜¯ä¸€ç§é«˜æ•ˆçš„â€ç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡åž‹ã€‚ä¹Ÿå°±æ€§èƒ½è¿œè¿œé«˜äºŽä¼ ç»Ÿçš„BlockingQueueå®¹å™¨ã€‚ ä¸Šæ‰‹demo é¦–å…ˆå£°æ˜Žä¸€ä¸ªEventæ¥åŒ…å«éœ€è¦ä¼ é€’çš„æ•°æ®ï¼š 12345678910public class LongEvent &#123; private long value; public long getValue() &#123; return value; &#125; public void setValue(long value) &#123; this.value = value; &#125;&#125; äºŽéœ€è¦è®©Disruptorä¸ºæˆ‘ä»¬åˆ›å»ºäº‹ä»¶ï¼Œæˆ‘ä»¬åŒæ—¶è¿˜å£°æ˜Žäº†ä¸€ä¸ªEventFactoryæ¥å®žä¾‹åŒ–Eventå¯¹è±¡ã€‚ 12345678// éœ€è¦è®©disruptorä¸ºæˆ‘ä»¬åˆ›å»ºäº‹ä»¶ï¼Œæˆ‘ä»¬åŒæ—¶è¿˜å£°æ˜Žäº†ä¸€ä¸ªEventFactoryæ¥å®žä¾‹åŒ–Eventå¯¹è±¡ã€‚public class LongEventFactory implements EventFactory &#123; @Override public Object newInstance() &#123; return new LongEvent(); &#125;&#125; æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªäº‹ä»¶æ¶ˆè´¹è€…ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨ã€‚è¿™ä¸ªäº‹ä»¶å¤„ç†å™¨ç®€å•åœ°æŠŠäº‹ä»¶ä¸­å­˜å‚¨çš„æ•°æ®æ‰“å°åˆ°ç»ˆç«¯ï¼š 12345678public class LongEventHandler implements EventHandler&lt;LongEvent&gt; &#123; @Override public void onEvent(LongEvent longEvent, long l, boolean b) throws Exception &#123; System.out.println(longEvent.getValue()); &#125;&#125; äº‹ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ªç”Ÿæˆäº‹ä»¶çš„æºï¼Œè¿™ä¸ªä¾‹å­ä¸­å‡è®¾äº‹ä»¶æ˜¯ç”±äºŽç£ç›˜IOæˆ–è€…networkè¯»å–æ•°æ®çš„æ—¶å€™è§¦å‘çš„ï¼Œäº‹ä»¶æºä½¿ç”¨ä¸€ä¸ªByteBufferæ¥æ¨¡æ‹Ÿå®ƒæŽ¥å—åˆ°çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹ä»¶æºä¼šåœ¨IOè¯»å–åˆ°ä¸€éƒ¨åˆ†æ•°æ®çš„æ—¶å€™è§¦å‘äº‹ä»¶ï¼ˆè§¦å‘äº‹ä»¶ä¸æ˜¯è‡ªåŠ¨çš„ï¼Œç¨‹åºå‘˜éœ€è¦åœ¨è¯»å–åˆ°æ•°æ®çš„æ—¶å€™è‡ªå·±è§¦å‘äº‹ä»¶å¹¶å‘å¸ƒï¼‰ 1234567891011121314151617181920212223242526272829public class LongEventProducer &#123; private final RingBuffer&lt;LongEvent&gt; ringBuffer; public LongEventProducer(RingBuffer&lt;LongEvent&gt; ringBuffer)&#123; this.ringBuffer = ringBuffer; &#125; /** * onDataç”¨æ¥å‘å¸ƒäº‹ä»¶ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡å°±å‘å¸ƒä¸€æ¬¡äº‹ä»¶ * å®ƒçš„å‚æ•°ä¼šç”¨è¿‡äº‹ä»¶ä¼ é€’ç»™æ¶ˆè´¹è€… */ public void onData(ByteBuffer bb)&#123; //1.å¯ä»¥æŠŠringBufferçœ‹åšä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—ï¼Œé‚£ä¹ˆnextå°±æ˜¯å¾—åˆ°ä¸‹é¢ä¸€ä¸ªäº‹ä»¶æ§½ long sequence = ringBuffer.next(); try &#123; //2.ç”¨ä¸Šé¢çš„ç´¢å¼•å–å‡ºä¸€ä¸ªç©ºçš„äº‹ä»¶ç”¨äºŽå¡«å……ï¼ˆèŽ·å–è¯¥åºå·å¯¹åº”çš„äº‹ä»¶å¯¹è±¡ï¼‰ LongEvent event = ringBuffer.get(sequence); //3.èŽ·å–è¦é€šè¿‡äº‹ä»¶ä¼ é€’çš„ä¸šåŠ¡æ•°æ® event.setValue(bb.getLong(0)); &#125; finally &#123; //4.å‘å¸ƒäº‹ä»¶ //æ³¨æ„ï¼Œæœ€åŽçš„ ringBuffer.publish æ–¹æ³•å¿…é¡»åŒ…å«åœ¨ finally ä¸­ä»¥ç¡®ä¿å¿…é¡»å¾—åˆ°è°ƒç”¨ï¼› // å¦‚æžœæŸä¸ªè¯·æ±‚çš„ sequence æœªè¢«æäº¤ï¼Œå°†ä¼šå µå¡žåŽç»­çš„å‘å¸ƒæ“ä½œæˆ–è€…å…¶å®ƒçš„ producerã€‚ ringBuffer.publish(sequence); &#125; &#125;&#125; mainå‡½æ•°æ‰§è¡Œè°ƒç”¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class LongEventMain &#123; public static void main(String[] args) throws Exception &#123; //åˆ›å»ºç¼“å†²æ±  ExecutorService executor = Executors.newCachedThreadPool(); //åˆ›å»ºå·¥åŽ‚ LongEventFactory factory = new LongEventFactory(); //åˆ›å»ºbufferSize ,ä¹Ÿå°±æ˜¯RingBufferå¤§å°ï¼Œå¿…é¡»æ˜¯2çš„Næ¬¡æ–¹ int ringBufferSize = 1024 * 1024; // /** //BlockingWaitStrategy æ˜¯æœ€ä½Žæ•ˆçš„ç­–ç•¥ï¼Œä½†å…¶å¯¹CPUçš„æ¶ˆè€—æœ€å°å¹¶ä¸”åœ¨å„ç§ä¸åŒéƒ¨ç½²çŽ¯å¢ƒä¸­èƒ½æä¾›æ›´åŠ ä¸€è‡´çš„æ€§èƒ½è¡¨çŽ° WaitStrategy BLOCKING_WAIT = new BlockingWaitStrategy(); //SleepingWaitStrategy çš„æ€§èƒ½è¡¨çŽ°è·ŸBlockingWaitStrategyå·®ä¸å¤šï¼Œå¯¹CPUçš„æ¶ˆè€—ä¹Ÿç±»ä¼¼ï¼Œä½†å…¶å¯¹ç”Ÿäº§è€…çº¿ç¨‹çš„å½±å“æœ€å°ï¼Œé€‚åˆç”¨äºŽå¼‚æ­¥æ—¥å¿—ç±»ä¼¼çš„åœºæ™¯ WaitStrategy SLEEPING_WAIT = new SleepingWaitStrategy(); //YieldingWaitStrategy çš„æ€§èƒ½æ˜¯æœ€å¥½çš„ï¼Œé€‚åˆç”¨äºŽä½Žå»¶è¿Ÿçš„ç³»ç»Ÿã€‚åœ¨è¦æ±‚æžé«˜æ€§èƒ½ä¸”äº‹ä»¶å¤„ç†çº¿æ•°å°äºŽCPUé€»è¾‘æ ¸å¿ƒæ•°çš„åœºæ™¯ä¸­ï¼ŒæŽ¨èä½¿ç”¨æ­¤ç­–ç•¥ï¼›ä¾‹å¦‚ï¼ŒCPUå¼€å¯è¶…çº¿ç¨‹çš„ç‰¹æ€§ WaitStrategy YIELDING_WAIT = new YieldingWaitStrategy(); */ /** * å‚æ•°è¯´æ˜Žï¼š */ //åˆ›å»ºdisruptor Disruptor&lt;LongEvent&gt; disruptor = new Disruptor&lt;LongEvent&gt;(factory, ringBufferSize, executor, ProducerType.SINGLE, new YieldingWaitStrategy()); // è¿žæŽ¥æ¶ˆè´¹äº‹ä»¶æ–¹æ³• disruptor.handleEventsWith(new LongEventHandler()); // å¯åŠ¨ disruptor.start(); //Disruptor çš„äº‹ä»¶å‘å¸ƒè¿‡ç¨‹æ˜¯ä¸€ä¸ªä¸¤é˜¶æ®µæäº¤çš„è¿‡ç¨‹ï¼š //å‘å¸ƒäº‹ä»¶ RingBuffer&lt;LongEvent&gt; ringBuffer = disruptor.getRingBuffer(); LongEventProducer producer = new LongEventProducer(ringBuffer); //LongEventProducerWithTranslator producer = new LongEventProducerWithTranslator(ringBuffer); ByteBuffer byteBuffer = ByteBuffer.allocate(8); for(long l = 0; l&lt;100; l++)&#123; byteBuffer.putLong(0, l); producer.onData(byteBuffer); //Thread.sleep(1000); &#125; disruptor.shutdown();//å…³é—­ disruptorï¼Œæ–¹æ³•ä¼šå µå¡žï¼Œç›´è‡³æ‰€æœ‰çš„äº‹ä»¶éƒ½å¾—åˆ°å¤„ç†ï¼› executor.shutdown();//å…³é—­ disruptor ä½¿ç”¨çš„çº¿ç¨‹æ± ï¼›å¦‚æžœéœ€è¦çš„è¯ï¼Œå¿…é¡»æ‰‹åŠ¨å…³é—­ï¼Œ disruptor åœ¨ shutdown æ—¶ä¸ä¼šè‡ªåŠ¨å…³é—­ï¼› &#125;&#125;]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>javaå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Streamåˆ†ç»„å’Œåˆ†åŒº]]></title>
    <url>%2F2018%2F05%2F14%2FStream%E5%88%86%E7%BB%84%E5%92%8C%E5%88%86%E5%8C%BA%2F</url>
    <content type="text"><![CDATA[è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Streams API ä¸­çš„ Collector åŠ groupingBy å’Œ partitioningBy æ¥å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œåˆ†ç»„å’Œåˆ†åŒºã€‚ æ€è€ƒä¸€ä¸‹ Employee å¯¹è±¡æµï¼Œæ¯ä¸ªå¯¹è±¡å¯¹åº”ä¸€ä¸ªåå­—ã€åŸŽå¸‚å’Œé”€å”®æ•°é‡ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š 12345678+----------+------------+-----------------+| Name | City | Number of Sales |+----------+------------+-----------------+| Alice | London | 200 || Bob | London | 150 || Charles | New York | 160 || Dorothy | Hong Kong | 190 |+----------+------------+-----------------+ åˆ†ç»„é¦–å…ˆï¼Œæˆ‘ä»¬åˆ©ç”¨ï¼ˆlambdaè¡¨è¾¾å¼å‡ºçŽ°ä¹‹å‰çš„ï¼‰å‘½ä»¤å¼é£Žæ ¼Java ç¨‹åºå¯¹æµä¸­çš„é›‡å‘˜æŒ‰åŸŽå¸‚è¿›è¡Œåˆ†ç»„ï¼š 12345678910Map&lt;String, List&lt;Employee&gt;&gt; result = new HashMap&lt;&gt;();for (Employee e : employees) &#123; String city = e.getCity(); List&lt;Employee&gt; empsInCity = result.get(city); if (empsInCity == null) &#123; empsInCity = new ArrayList&lt;&gt;(); result.put(city, empsInCity); &#125; empsInCity.add(e);&#125; ä½ å¯èƒ½å¾ˆç†Ÿæ‚‰å†™è¿™æ ·çš„ä»£ç ï¼Œä½ ä¹Ÿçœ‹åˆ°äº†ï¼Œä¸€ä¸ªå¦‚æ­¤ç®€å•çš„ä»»åŠ¡å°±éœ€è¦è¿™ä¹ˆå¤šä»£ç ï¼ è€Œåœ¨ Java 8 ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ groupingBy æ”¶é›†å™¨ï¼Œä¸€æ¡è¯­å¥å°±èƒ½å®Œæˆç›¸åŒçš„åŠŸèƒ½ï¼Œåƒè¿™æ ·ï¼š 12Map&lt;String, List&lt;Employee&gt;&gt; employeesByCity = employees.stream().collect(groupingBy(Employee::getCity)); ç»“æžœå¦‚ä¸‹é¢çš„ map æ‰€ç¤ºï¼š 1&#123;New York=[Charles], Hong Kong=[Dorothy], London=[Alice, Bob]&#125; è¿˜å¯ä»¥è®¡ç®—æ¯ä¸ªåŸŽå¸‚ä¸­é›‡å‘˜çš„æ•°é‡ï¼Œåªéœ€ä¼ é€’ä¸€ä¸ªè®¡æ•°æ”¶é›†å™¨ç»™ groupingBy æ”¶é›†å™¨ã€‚ç¬¬äºŒä¸ªæ”¶é›†å™¨çš„ä½œç”¨æ˜¯åœ¨æµåˆ†ç±»çš„åŒä¸€ä¸ªç»„ä¸­å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œé€’å½’æ“ä½œã€‚ 12Map&lt;String, Long&gt; numEmployeesByCity = employees.stream().collect(groupingBy(Employee::getCity, counting())); ç»“æžœå¦‚ä¸‹é¢çš„ map æ‰€ç¤ºï¼š 1&#123;New York=1, Hong Kong=1, London=2&#125; é¡ºä¾¿æä¸€ä¸‹ï¼Œè¯¥åŠŸèƒ½ä¸Žä¸‹é¢çš„ SQL è¯­å¥æ˜¯ç­‰åŒçš„ï¼š 1select city, count(*) from Employee group by city å¦ä¸€ä¸ªä¾‹å­æ˜¯è®¡ç®—æ¯ä¸ªåŸŽå¸‚çš„å¹³å‡å¹´é¾„ï¼Œè¿™å¯ä»¥è”åˆä½¿ç”¨ averagingInt å’Œ groupingBy æ”¶é›†å™¨ï¼š 123Map&lt;String, Double&gt; avgSalesByCity = employees.stream().collect(groupingBy(Employee::getCity, averagingInt(Employee::getNumSales))); ç»“æžœå¦‚ä¸‹ map æ‰€ç¤ºï¼š 1&#123;New York=160.0, Hong Kong=190.0, London=175.0&#125; åˆ†åŒºåˆ†åŒºæ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆ†ç»„ï¼Œç»“æžœ map è‡³å°‘åŒ…å«ä¸¤ä¸ªä¸åŒçš„åˆ†ç»„â€”â€”ä¸€ä¸ªtrueï¼Œä¸€ä¸ªfalseã€‚ä¾‹å¦‚ï¼Œå¦‚æžœæƒ³æ‰¾å‡ºæœ€ä¼˜ç§€çš„å‘˜å·¥ï¼Œä½ å¯ä»¥å°†æ‰€æœ‰é›‡å‘˜åˆ†ä¸ºä¸¤ç»„ï¼Œä¸€ç»„é”€å”®é‡å¤§äºŽ Nï¼Œå¦ä¸€ç»„å°äºŽ Nï¼Œä½¿ç”¨ partitioningBy æ”¶é›†å™¨ï¼š 12Map&lt;Boolean, List&lt;Employee&gt;&gt; partitioned = employees.stream().collect(partitioningBy(e -&gt; e.getNumSales() &gt; 150)); è¾“å‡ºå¦‚ä¸‹ç»“æžœï¼š 1&#123;false=[Bob], true=[Alice, Charles, Dorothy]&#125; ä½ ä¹Ÿå¯ä»¥å°† groupingBy æ”¶é›†å™¨ä¼ é€’ç»™ partitioningBy æ”¶é›†å™¨æ¥å°†è”åˆä½¿ç”¨åˆ†åŒºå’Œåˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ç»Ÿè®¡æ¯ä¸ªåˆ†åŒºä¸­çš„æ¯ä¸ªåŸŽå¸‚çš„é›‡å‘˜äººæ•°ï¼š è¿™æ ·ä¼šç”Ÿæˆä¸€ä¸ªäºŒçº§ Map: 123Map&lt;Boolean, Map&lt;String, Long&gt;&gt; result = employees.stream().collect(partitioningBy(e -&gt; e.getNumSales() &gt; 150, groupingBy(Employee::getCity, counting())));]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[javaæ­»é”é‡çŽ°ä¸ŽæŽ’æŸ¥]]></title>
    <url>%2F2018%2F05%2F14%2Fjava%E6%AD%BB%E9%94%81%E9%87%8D%E7%8E%B0%E4%B8%8E%E6%8E%92%E6%9F%A5%2F</url>
    <content type="text"><![CDATA[1.æž„é€ æ­»é”é€šè¿‡æ¨¡æ‹Ÿä¸¤ä¸ªå“²å­¦åƒé¥­ï¼Œéœ€è¦ä¸¤æŠŠå‰å­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687/** * Created by xiaowu.zhou@tongdun.cn on 2018/5/14. */public class DeadLock extends Thread&#123; //å“²å­¦å®¶åƒé¥­éœ€è¦çš„åˆ€å‰ static Object fork1 = new Object(); static Object fork2 = new Object(); private Object tool; public DeadLock(Object object) &#123; this.tool = object; if (tool == fork1)&#123; this.setName("å“²å­¦å®¶1"); &#125;else if (tool == fork2)&#123; this.setName("å“²å­¦å®¶2"); &#125; &#125; @Override public void run() &#123; if (tool == fork1)&#123; synchronized (fork1)&#123; try &#123; System.out.println("å“²å­¦å®¶1å¼€å§‹å‡†å¤‡ï¼Œæœ‰äº†ä¸€æŠŠå‰å­1"); Thread.sleep(500); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (fork2)&#123; System.out.println("å“²å­¦å®¶1å¼€å§‹åƒé¥­ï¼Œæœ‰äº†ä¸¤æŠŠå‰å­"); &#125; &#125; &#125; if(tool == fork2)&#123; synchronized (fork2)&#123; try &#123; System.out.println("å“²å­¦å®¶2å¼€å§‹å‡†å¤‡ï¼Œæœ‰äº†ä¸€æŠŠå‰å­2"); Thread.sleep(1500); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (fork1)&#123; System.out.println("å“²å­¦å®¶2å¼€å§‹åƒé¥­ï¼Œæœ‰äº†ä¸¤æŠŠå‰å­"); &#125; &#125; &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; DeadLock deadLock1 = new DeadLock(fork1); DeadLock deadLock2 = new DeadLock(fork2); deadLock1.start(); deadLock2.start(); while (true)&#123; &#125; &#125;&#125; 2. æŽ’æŸ¥é—®é¢˜æ­»é”çš„çº¿ç¨‹ä¸å ç”¨cpuï¼Œé€šè¿‡jstackå¯ä»¥æŽ’æŸ¥ 1jstack 59356 &gt; dead_lock_stack.log æœç´¢deadlock 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071082018-05-14 09:08:13Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.144-b01 mixed mode):"Attach Listener" #12 daemon prio=9 os_prio=31 tid=0x00007fb3818c8000 nid=0x1407 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE"å“²å­¦å®¶2" #11 prio=5 os_prio=31 tid=0x00007fb38185a000 nid=0x5103 waiting for monitor entry [0x000070000d069000] java.lang.Thread.State: BLOCKED (on object monitor) at DeadLock.run(DeadLock.java:59) - waiting to lock &lt;0x0000000795782620&gt; (a java.lang.Object) - locked &lt;0x0000000795782630&gt; (a java.lang.Object)"å“²å­¦å®¶1" #10 prio=5 os_prio=31 tid=0x00007fb382042800 nid=0x4f03 waiting for monitor entry [0x000070000cf66000] java.lang.Thread.State: BLOCKED (on object monitor) at DeadLock.run(DeadLock.java:41) - waiting to lock &lt;0x0000000795782630&gt; (a java.lang.Object) - locked &lt;0x0000000795782620&gt; (a java.lang.Object)"Service Thread" #9 daemon prio=9 os_prio=31 tid=0x00007fb38206c800 nid=0x4b03 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE"C1 CompilerThread2" #8 daemon prio=9 os_prio=31 tid=0x00007fb38185f000 nid=0x4903 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE"C2 CompilerThread1" #7 daemon prio=9 os_prio=31 tid=0x00007fb382815800 nid=0x4703 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE"C2 CompilerThread0" #6 daemon prio=9 os_prio=31 tid=0x00007fb381859000 nid=0x4503 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE"Monitor Ctrl-Break" #5 daemon prio=5 os_prio=31 tid=0x00007fb3830b9000 nid=0x4303 runnable [0x000070000c954000] java.lang.Thread.State: RUNNABLE at java.net.SocketInputStream.socketRead0(Native Method) at java.net.SocketInputStream.socketRead(SocketInputStream.java:116) at java.net.SocketInputStream.read(SocketInputStream.java:171) at java.net.SocketInputStream.read(SocketInputStream.java:141) at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284) at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326) at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178) - locked &lt;0x0000000795708738&gt; (a java.io.InputStreamReader) at java.io.InputStreamReader.read(InputStreamReader.java:184) at java.io.BufferedReader.fill(BufferedReader.java:161) at java.io.BufferedReader.readLine(BufferedReader.java:324) - locked &lt;0x0000000795708738&gt; (a java.io.InputStreamReader) at java.io.BufferedReader.readLine(BufferedReader.java:389) at com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:64)"Signal Dispatcher" #4 daemon prio=9 os_prio=31 tid=0x00007fb382030800 nid=0x4103 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE"Finalizer" #3 daemon prio=8 os_prio=31 tid=0x00007fb38202b000 nid=0x3103 in Object.wait() [0x000070000c74e000] java.lang.Thread.State: WAITING (on object monitor) at java.lang.Object.wait(Native Method) - waiting on &lt;0x0000000795588ec8&gt; (a java.lang.ref.ReferenceQueue$Lock) at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143) - locked &lt;0x0000000795588ec8&gt; (a java.lang.ref.ReferenceQueue$Lock) at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164) at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)"Reference Handler" #2 daemon prio=10 os_prio=31 tid=0x00007fb382805000 nid=0x2f03 in Object.wait() [0x000070000c64b000] java.lang.Thread.State: WAITING (on object monitor) at java.lang.Object.wait(Native Method) - waiting on &lt;0x0000000795586b68&gt; (a java.lang.ref.Reference$Lock) at java.lang.Object.wait(Object.java:502) at java.lang.ref.Reference.tryHandlePending(Reference.java:191) - locked &lt;0x0000000795586b68&gt; (a java.lang.ref.Reference$Lock) at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)"main" #1 prio=5 os_prio=31 tid=0x00007fb382005800 nid=0x1c03 runnable [0x000070000c039000] java.lang.Thread.State: RUNNABLE at DeadLock.main(DeadLock.java:81)"VM Thread" os_prio=31 tid=0x00007fb382802800 nid=0x2d03 runnable"GC task thread#0 (ParallelGC)" os_prio=31 tid=0x00007fb38200e800 nid=0x2503 runnable"GC task thread#1 (ParallelGC)" os_prio=31 tid=0x00007fb38200f800 nid=0x2703 runnable"GC task thread#2 (ParallelGC)" os_prio=31 tid=0x00007fb382010000 nid=0x2903 runnable"GC task thread#3 (ParallelGC)" os_prio=31 tid=0x00007fb382010800 nid=0x2b03 runnable"VM Periodic Task Thread" os_prio=31 tid=0x00007fb382085800 nid=0x4d03 waiting on conditionJNI global references: 22Found one Java-level deadlock:============================="å“²å­¦å®¶2": waiting to lock monitor 0x00007fb38202a5f8 (object 0x0000000795782620, a java.lang.Object), which is held by "å“²å­¦å®¶1""å“²å­¦å®¶1": waiting to lock monitor 0x00007fb3818ca808 (object 0x0000000795782630, a java.lang.Object), which is held by "å“²å­¦å®¶2"Java stack information for the threads listed above:==================================================="å“²å­¦å®¶2": at DeadLock.run(DeadLock.java:59) - waiting to lock &lt;0x0000000795782620&gt; (a java.lang.Object) - locked &lt;0x0000000795782630&gt; (a java.lang.Object)"å“²å­¦å®¶1": at DeadLock.run(DeadLock.java:41) - waiting to lock &lt;0x0000000795782630&gt; (a java.lang.Object) - locked &lt;0x0000000795782620&gt; (a java.lang.Object)Found 1 deadlock. å‘çŽ°å“²å­¦å®¶1ï¼ŒæŒæœ‰é”0x0000000795782620,ç­‰å¾…é”0x0000000795782630 ï¼› è€Œå“²å­¦å®¶2ï¼Œåˆ™ç›¸åã€‚]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[MATä½¿ç”¨æ•™ç¨‹]]></title>
    <url>%2F2018%2F05%2F13%2FMAT%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[MAT å…¨ç§° Eclipse Memory Analysis Tools æ˜¯ä¸€ä¸ªåˆ†æž Javaå †æ•°æ®çš„ä¸“ä¸šå·¥å…·ï¼Œå¯ä»¥è®¡ç®—å‡ºå†…å­˜ä¸­å¯¹è±¡çš„å®žä¾‹æ•°é‡ã€å ç”¨ç©ºé—´å¤§å°ã€å¼•ç”¨å…³ç³»ç­‰ï¼Œçœ‹çœ‹æ˜¯è°é˜»æ­¢äº†åžƒåœ¾æ”¶é›†å™¨çš„å›žæ”¶å·¥ä½œï¼Œä»Žè€Œå®šä½å†…å­˜æ³„æ¼çš„åŽŸå› ã€‚ ä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°MAT? aï¼‰ OutOfMemoryErrorçš„æ—¶å€™ï¼Œè§¦å‘full gcï¼Œä½†ç©ºé—´å´å›žæ”¶ä¸äº†ï¼Œå¼•å‘å†…å­˜æ³„éœ² bï¼‰javaæœåŠ¡å™¨ç³»ç»Ÿå¼‚å¸¸ï¼Œæ¯”å¦‚loadé£™é«˜ï¼Œioå¼‚å¸¸ï¼Œæˆ–è€…çº¿ç¨‹æ­»é”ç­‰ï¼Œéƒ½å¯èƒ½é€šè¿‡åˆ†æžå †ä¸­çš„å†…å­˜å¯¹è±¡æ¥å®šä½åŽŸå›  å¦‚ä½•å®‰è£…ï¼š eclipseæ’ä»¶å®‰è£…ï¼Œåœ°å€ï¼šhttp://download.eclipse.org/mat/1.0/update-site/ åˆ†æžæ–‡ä»¶ç”Ÿæˆæ–¹å¼ï¼š aï¼‰è‡ªåŠ¨ç”Ÿæˆï¼Œjvmå¯åŠ¨å‚æ•°é‡Œæ·»åŠ ä¸‹é¢é…ç½®ï¼Œå½“å‘ç”ŸOutOfMemoryErroræ—¶ï¼Œè™šæ‹Ÿæœºä¼šè‡ªåŠ¨dumpå†…å­˜å¿«ç…§ [html] view plain copy -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=$LOG_DIR/java.hprofâ€ bï¼‰æ‰‹åŠ¨ç”Ÿæˆï¼Œé€šè¿‡æ‰§è¡Œjdkè‡ªå¸¦å‘½ä»¤ jmap -dump:format=b,file=heap.bin æŽ¥ä¸‹å°±å¯ä»¥ç”¨ MATæ‰“å¼€è½¬æ¢åŽçš„ hprofæ–‡ä»¶ æ‰“å¼€åŽçš„é¦–é¡µï¼Œé‡Œé¢æ˜¯ä¸€äº›å †çš„åŸºæœ¬æ¦‚è¦ä¿¡æ¯ï¼Œæ¯”å¦‚ç©ºé—´å¤§å°ã€ç±»çš„æ•°é‡ã€å¯¹è±¡å®žä¾‹æ•°é‡ã€ç±»åŠ è½½å™¨ç­‰ç­‰ Atcioné‡Œé¢æä¾›äº†å¤šç§åˆ†æžç»´åº¦ï¼š Histogramå¯ä»¥åˆ—å‡ºå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå¯¹è±¡çš„ä¸ªæ•°ä»¥åŠå¤§å°ã€‚ Dominator Treeå¯ä»¥åˆ—å‡ºé‚£ä¸ªçº¿ç¨‹ï¼Œä»¥åŠçº¿ç¨‹ä¸‹é¢çš„é‚£äº›å¯¹è±¡å ç”¨çš„ç©ºé—´ã€‚ Top consumersé€šè¿‡å›¾å½¢åˆ—å‡ºæœ€å¤§çš„objectã€‚ Leak Suspectsé€šè¿‡MAè‡ªåŠ¨åˆ†æžæ³„æ¼çš„åŽŸå› ã€‚ Histogram å®ƒæŒ‰ç±»åå°†æ‰€æœ‰çš„å®žä¾‹å¯¹è±¡åˆ—å‡ºæ¥ï¼Œç‚¹å‡»è¡¨å¤´ï¼ˆClass Nameï¼‰å¯ä»¥æŽ’åºï¼Œç¬¬ä¸€è¡Œè¾“å…¥æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥è¿‡æ»¤ç­›é€‰ ï¼› Shallow Heap ï¼šä¸€ä¸ªå¯¹è±¡å†…å­˜çš„æ¶ˆè€—å¤§å°ï¼Œä¸åŒ…å«å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ï¼›Retained Heap ï¼šæ˜¯shallow Heapçš„æ€»å’Œï¼Œä¹Ÿå°±æ˜¯è¯¥å¯¹è±¡è¢«GCä¹‹åŽæ‰€èƒ½å›žæ”¶çš„å†…å­˜å¤§å°ï¼› è¯¦ç»†è§£é‡Šå¯å‚è€ƒæ–‡ç« ï¼šShallow heap &amp; Retained heap åœ¨æŸä¸€é¡¹ä¸Šå³é”®æ‰“å¼€èœå•é€‰æ‹© list objects ï¼š with incoming references å°†åˆ—å‡ºå“ªäº›ç±»å¼•å…¥è¯¥ç±»ï¼› with outgoing references åˆ—å‡ºè¯¥ç±»å¼•ç”¨äº†å“ªäº›ç±» ä»Žå·¥å…·æ ä¸­ç‚¹å¼€ Heap Dump Overviewè§†å›¾ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…¨å±€çš„å†…å­˜å ç”¨ä¿¡æ¯ Dominator Tree å¯ä»¥åˆ—å‡ºå†…å­˜ä¸­å­˜æ´»çš„å¤§å¯¹è±¡åˆ—è¡¨ï¼Œä¼˜ç‚¹æ˜¯æœ‰Percentageå­—æ®µï¼Œå¯ä»¥çœ‹å„ç§æƒ…å†µçš„ç™¾åˆ†æ¯”ã€‚ åˆ†ç»„å·¥å…·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚åˆ†ç»„æŸ¥æ‰¾ï¼Œé»˜è®¤æ ¹æ®classåˆ†ç»„ï¼Œæœ¬æ–‡ä¸­æ˜¯æ ¹æ® packageåˆ†ç»„ï¼Œå‘çŽ°å­˜åœ¨å¤§é‡çš„SSLSocketImplç±»æ— æ³•å›žæ”¶ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ‰€æœ‰ç›´æŽ¥æˆ–é—´æŽ¥å¼•ç”¨åˆ°SSLSocketImplçš„ç±»éƒ½æ— æ³•å›žæ”¶ï¼Œå›¾ä¸­å¯ä»¥çœ‹å‡ºè™½ç„¶Shallow Heapå¤§å°åªæœ‰1.6Mï¼Œä½†Retained Heapå¤§å°å´æœ‰378Mã€‚ å¿«é€Ÿæ‰¾å‡ºæŸä¸ªå®žä¾‹æ²¡è¢«é‡Šæ”¾çš„åŽŸå› ï¼Œå¯ä»¥å³å¥ Path to GC Rootsâ€“&gt;exclude all phantom/weak/soft etc. references å®ƒå±•ç¤ºäº†å¯¹è±¡é—´çš„å¼•ç”¨å…³ç³»ï¼Œæ¯”å¦‚SSLSocketImpl @0xa124b208è¢«PushNotificationManager å®žä¾‹ä¸­çš„socketå±žæ€§æ‰€å¼•ç”¨ã€‚ Top consumers å¤šç§ç»´åº¦ï¼ˆåŒ…æ‹¬ ç±»å¤§å°ã€ç±»åŠ è½½å™¨ã€åŒ…åï¼‰å±•ç¤ºå ç”¨å†…å­˜æ¯”è¾ƒå¤šçš„å¯¹è±¡çš„åˆ†å¸ƒï¼Œä»Žè€Œå®šä½å†…å­˜èµ„æºä¸»è¦è€—è´¹åœ¨å“ªäº›åœ°æ–¹ï¼ Leak Suspects MATæ’ä»¶ä¼šç»™å‡ºä¸€ä»½å¯ç–‘çš„åˆ†æžæŠ¥å‘Šï¼Œéžå¸¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬åªéœ€ç»“åˆæºä»£ç ç¨åŠ åˆ†æžåˆ°åº•å“ªä¸ªProblemæ‰æ˜¯å¼•å‘é—®é¢˜çœŸæ­£åŽŸå› æ‰€åœ¨ã€‚ å‚è€ƒèµ„æ–™ï¼š http://www.eclipse.org/mat/about/screenshots.php https://www.yourkit.com/docs/java/help/garbage_collection.jsp http://www.ibm.com/developerworks/cn/opensource/os-cn-ecl-ma/index.html http://help.eclipse.org/luna/index.jsp?topic=/org.eclipse.mat.ui.help/welcome.html]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JDKå†…ç½®å·¥å…·]]></title>
    <url>%2F2018%2F05%2F13%2FJDK%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%2F</url>
    <content type="text"><![CDATA[1. jps -mlç”¨äºŽæŸ¥çœ‹JVMé‡Œé¢æ‰€æœ‰è¿›ç¨‹çš„å…·ä½“çŠ¶æ€ï¼ŒåŒ…æ‹¬è¿›ç¨‹IDï¼Œè¿›ç¨‹å¯åŠ¨çš„è·¯å¾„ç­‰ç­‰ å‚æ•°æ ¼å¼ï¼š -m è¾“å‡ºä¼ é€’ç»™mainæ–¹æ³•çš„å‚æ•°ï¼Œå¦‚æžœæ˜¯å†…åµŒçš„JVMåˆ™è¾“å‡ºä¸ºnullã€‚ -l è¾“å‡ºåº”ç”¨ç¨‹åºä¸»ç±»çš„å®Œæ•´åŒ…åï¼Œæˆ–è€…æ˜¯åº”ç”¨ç¨‹åºJARæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ï¼ˆéžå¸¸é€‚ç”¨äºŽtaskä»»åŠ¡ï¼‰ -v è¾“å‡ºä¼ ç»™JVMçš„å‚æ•°ã€‚ â€‹ 2. jstat -gcutil pid æ—¶é—´é—´éš”1ï¼‰ç®€ä»‹ï¼š Jstatæ˜¯JDKè‡ªå¸¦çš„ä¸€ä¸ªè½»é‡çº§å°å·¥å…·ã€‚å…¨ç§°â€œJava Virtual Machine statistics monitoring toolâ€ï¼Œå®ƒä½äºŽjavaçš„binç›®å½•ä¸‹ï¼Œä¸»è¦åˆ©ç”¨JVMå†…å»ºçš„æŒ‡ä»¤å¯¹Javaåº”ç”¨ç¨‹åºçš„èµ„æºå’Œæ€§èƒ½è¿›è¡Œå®žæ—¶çš„å‘½ä»¤è¡Œçš„ç›‘æŽ§ï¼ŒåŒ…æ‹¬äº†å¯¹Heap sizeå’Œåžƒåœ¾å›žæ”¶çŠ¶å†µçš„ç›‘æŽ§ã€‚å¯è§ï¼ŒJstatæ˜¯è½»é‡çº§çš„ã€ä¸“é—¨é’ˆå¯¹JVMçš„å·¥å…·ï¼Œéžå¸¸é€‚ç”¨ã€‚ç”±äºŽJVMå†…å­˜è®¾ç½®è¾ƒå¤§ï¼Œå›¾ä¸­ç™¾åˆ†æ¯”å˜åŒ–ä¸å¤ªæ˜Žæ˜¾ä¸€ä¸ªæžå¼ºçš„ç›‘è§†VMå†…å­˜å·¥å…·ã€‚å¯ä»¥ç”¨æ¥ç›‘è§†VMå†…å­˜å†…çš„å„ç§å †å’Œéžå †çš„å¤§å°åŠå…¶å†…å­˜ä½¿ç”¨é‡ã€‚ jstatå·¥å…·ç‰¹åˆ«å¼ºå¤§ï¼Œæœ‰ä¼—å¤šçš„å¯é€‰é¡¹ï¼Œè¯¦ç»†æŸ¥çœ‹å †å†…å„ä¸ªéƒ¨åˆ†çš„ä½¿ç”¨é‡ï¼Œä»¥åŠåŠ è½½ç±»çš„æ•°é‡ã€‚ä½¿ç”¨æ—¶ï¼Œéœ€åŠ ä¸ŠæŸ¥çœ‹è¿›ç¨‹çš„è¿›ç¨‹idï¼Œå’Œæ‰€é€‰å‚æ•°ã€‚ å®ƒä¸»è¦æ˜¯ç”¨æ¥æ˜¾ç¤ºGCåŠPermGenç›¸å…³çš„ä¿¡æ¯. 2ï¼‰å‚æ•°ï¼š -class Option -compiler Option -gc Option -gccapacity Option -gccause Option -gcnew Option -gcnewcapacity Option -gcold Option -gcoldcapacity Option -gcpermcapacity Option -gcutil Option -printcompilation Option æ³¨ï¼šå…¶ä¸­æœ€å¸¸ç”¨çš„å°±æ˜¯ -gcutil é€‰é¡¹äº†ï¼Œå› ä¸ºä»–èƒ½å¤Ÿç»™æˆ‘ä»¬å±•ç¤ºå¤§è‡´çš„GCä¿¡æ¯ã€‚ Optionï¼šæŒ‡çš„æ˜¯vmidã€æ˜¾ç¤ºé—´éš”æ—¶é—´åŠé—´éš”æ¬¡æ•°ç­‰ vmid â€”VMçš„è¿›ç¨‹å·ï¼Œå³å½“å‰è¿è¡Œçš„javaè¿›ç¨‹å· interval é—´éš”æ—¶é—´ï¼Œå•ä½æ¯«ç§’ count â€” æ‰“å°æ¬¡æ•°ï¼Œå¦‚æžœç¼ºçœåˆ™æ‰“å°æ— æ•°æ¬¡ 3ï¼‰è¾“å‡ºç»“æžœ S0 â€” Heapä¸Šçš„ Survivor space 0 åŒºå·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯” S0Cï¼šS0å½“å‰å®¹é‡çš„å¤§å° S0Uï¼šS0å·²ç»ä½¿ç”¨çš„å¤§å° S1 â€” Heapä¸Šçš„ Survivor space 1 åŒºå·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯” S1Cï¼šS1å½“å‰å®¹é‡çš„å¤§å° S1Uï¼šS1å·²ç»ä½¿ç”¨çš„å¤§å° E â€” Heapä¸Šçš„ Eden space åŒºå·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯” ECï¼šEden spaceå½“å‰å®¹é‡çš„å¤§å° EUï¼šEden spaceå·²ç»ä½¿ç”¨çš„å¤§å° O â€” Heapä¸Šçš„ Old space åŒºå·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯” OCï¼šOld spaceå½“å‰å®¹é‡çš„å¤§å° OUï¼šOld spaceå·²ç»ä½¿ç”¨çš„å¤§å° P â€” Perm space åŒºå·²ä½¿ç”¨ç©ºé—´çš„ç™¾åˆ†æ¯” PCï¼šPerm spaceå½“å‰å®¹é‡çš„å¤§å° PUï¼šPerm spaceå·²ç»ä½¿ç”¨çš„å¤§å° YGC â€” ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å‘ç”Ÿ Young GC çš„æ¬¡æ•° YGCTâ€“ ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ Young GC æ‰€ç”¨çš„æ—¶é—´(å•ä½ç§’) FGC â€” ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å‘ç”Ÿ Full GC çš„æ¬¡æ•° FGCTâ€“ ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ Full GC æ‰€ç”¨çš„æ—¶é—´(å•ä½ç§’) GCT â€” ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ç”¨äºŽåžƒåœ¾å›žæ”¶çš„æ€»æ—¶é—´(å•ä½ç§’)ï¼Œå®ƒçš„å€¼ç­‰äºŽYGC+FGC 4ï¼‰ç¤ºä¾‹ jstat -gcutil [pid]. interval å›¾ä¸­åŒæ—¶æ‰“å°äº†young gcå’Œfull gcçš„æ€»æ¬¡æ•°ã€æ€»è€—æ—¶ã€‚è€Œæ¯æ¬¡young gcæ¶ˆè€—çš„æ—¶é—´ï¼Œå¯ä»¥ç”¨ç›¸é—´éš”çš„ä¸¤è¡Œï¼ˆçº¢çº¿æ ‡ç¤ºçš„ï¼‰YGCTç›¸å‡å¾—åˆ°ã€‚æ¯æ¬¡full gcæ¶ˆè€—çš„æ—¶é—´ï¼Œå¯ä»¥ç”¨ç›¸éš”çš„ä¸¤è¡ŒFGCTç›¸å‡å¾—åˆ°ã€‚ å¸¸é©»å†…å­˜åŒº(P)çš„ä½¿ç”¨çŽ‡ï¼Œå§‹ç»ˆåœç•™åœ¨64.78%å·¦å³ï¼Œè¯´æ˜Žå¸¸é©»å†…å­˜æ²¡æœ‰çªå˜ï¼Œæ¯”è¾ƒæ­£å¸¸ã€‚å¦‚æžœyoung gcå’Œfull gcèƒ½å¤Ÿæ­£å¸¸å‘ç”Ÿï¼Œè€Œä¸”éƒ½èƒ½æœ‰æ•ˆå›žæ”¶å†…å­˜ï¼Œå¸¸é©»å†…å­˜åŒºå˜åŒ–ä¸æ˜Žæ˜¾ï¼Œåˆ™è¯´æ˜Žjavaå†…å­˜é‡Šæ”¾æƒ…å†µæ­£å¸¸ï¼Œåžƒåœ¾å›žæ”¶åŠæ—¶ï¼Œjavaå†…å­˜æ³„éœ²çš„å‡ çŽ‡å°±ä¼šå¤§å¤§é™ä½Žï¼Œä½†ä¹Ÿä¸èƒ½è¯´æ˜Žä¸€å®šæ²¡æœ‰å†…å­˜æ³„éœ²ã€‚ jstat -class è¿›ç¨‹id æ˜¾ç¤ºåŠ è½½classçš„æ•°é‡ï¼ŒåŠæ‰€å ç©ºé—´ç­‰ä¿¡æ¯ã€‚ 12341. [yang@vm-cbu-qa-172-43 ~]$ jstat -class 12384 20002. Loaded Bytes Unloaded Bytes Time3. 11493 23583.9 195 291.8 12.31 3. jinfoæ ¼å¼ï¼šjinfo è¿›ç¨‹id è§‚å¯Ÿè¿è¡Œä¸­çš„javaç¨‹åºçš„è¿è¡ŒçŽ¯å¢ƒå‚æ•°ï¼šå‚æ•°åŒ…æ‹¬Java Systemå±žæ€§å’ŒJVMå‘½ä»¤è¡Œå‚æ•° 4. jstackè§‚å¯Ÿjvmä¸­å½“å‰æ‰€æœ‰çº¿ç¨‹çš„è¿è¡Œæƒ…å†µå’Œçº¿ç¨‹å½“å‰çŠ¶æ€ è¯¦ç»†ä½¿ç”¨å¯å‚è€ƒã€ŠjavaæœåŠ¡å™¨loadé£šé«˜æŽ’æŸ¥æ€è·¯ã€‹ 5. jmap1ï¼‰ç®€ä»‹ è¾“å‡ºå†…å­˜ä¸­å¯¹è±¡çš„å·¥å…·ï¼Œæ‰“å°å‡ºæŸä¸ªjavaè¿›ç¨‹åœ¨å†…å­˜ä¸­æ‰€æœ‰â€œå¯¹è±¡â€çš„ä½¿ç”¨æƒ…å†µï¼ˆå¦‚ï¼šäº§ç”Ÿé‚£äº›å¯¹è±¡ã€æ•°é‡ï¼‰ 1jmap -histo pid &gt; aa.log å¯ä»¥å°†äºŒè¿›åˆ¶è¾“å‡ºåˆ°æ–‡æœ¬ï¼ˆaa.logï¼‰ä¸­ï¼Œåœ¨ä¸€æ®µæ—¶é—´åŽï¼Œä½¿ç”¨æ–‡æœ¬æ¯”è¾ƒå·¥å…·ï¼Œå¯ä»¥å¯¹æ¯”å‡ºGCå›žæ”¶äº†å“ªäº›å¯¹è±¡ã€‚ 1jmap -dump:format=b,file=heap.bin 12384 å¯ä»¥å°†12384è¿›ç¨‹çš„å†…å­˜å †æ ˆè¾“å‡ºåˆ°heap.bin æ–‡ä»¶é‡Œï¼Œå†é…åˆMATï¼ˆå†…å­˜åˆ†æžå·¥å…·(Memory Analysis Toolï¼‰ï¼Œå‚è€ƒæ–‡ç«  æˆ– jhat (Java Heap Analysis Tool)ä¸€èµ·ä½¿ç”¨ï¼Œèƒ½å¤Ÿä»¥å›¾åƒçš„å½¢å¼ç›´è§‚çš„åæ˜ å½“å‰å†…å­˜æ˜¯å¦å­˜åœ¨é—®é¢˜ã€‚ å¦‚æžœä½ çš„æœºå­æ˜¯64ä½ï¼Œæ ¼å¼ï¼šjmap -J-d64 -heap pid 2ï¼‰å‚æ•°æ ¼å¼ 1-dump:[live,]format=b,file=&lt;filename&gt; ä½¿ç”¨hprofäºŒè¿›åˆ¶å½¢å¼ï¼Œè¾“å‡ºjvmçš„heapå†…å®¹åˆ°æ–‡ä»¶ä¸­ã€‚ liveå­é€‰é¡¹æ˜¯å¯é€‰çš„ï¼Œå‡å¦‚æŒ‡å®šliveé€‰é¡¹ï¼Œé‚£ä¹ˆåªè¾“å‡ºæ´»çš„å¯¹è±¡ -finalizerinfo æ‰“å°æ­£ç­‰å€™å›žæ”¶çš„å¯¹è±¡çš„ä¿¡æ¯. -heap æ‰“å°heapçš„æ¦‚è¦ä¿¡æ¯ï¼ˆå¹´è½»ä»£ã€å¹´è€ä»£ã€æŒä¹…ä»£çš„æ¦‚æ‹¬ä½¿ç”¨æƒ…å†µï¼‰ï¼ŒGCä½¿ç”¨çš„ç®—æ³•ï¼Œheapçš„é…ç½®åŠwise heapçš„ä½¿ç”¨æƒ…å†µã€‚ -histo[:live] è¾“å‡ºæ¯ä¸ªå¯¹è±¡çš„å®žä¾‹ä¸ªæ•°ã€å ç”¨å­—èŠ‚æ•°ã€ç±»å…¨åä¿¡æ¯ã€‚ VMçš„å†…éƒ¨ç±»åå­—å¼€å¤´ä¼šåŠ ä¸Šå‰ç¼€â€*â€ã€‚å¦‚æžœåŠ ä¸Šliveå­å‚æ•°ï¼Œåªç»Ÿè®¡æ´»çš„å¯¹è±¡æ•°é‡ã€‚ï¼ˆpsï¼šé»˜è®¤æŒ‰å†…å­˜ä¸­å ç”¨çš„å­—èŠ‚æ•°å¤§å°æŽ’åºï¼Œä½¿ç”¨åœºæ™¯è¾ƒå¤šï¼‰ -permstat æ‰“å°classloaderå’Œjvm heapçš„ä¿¡æ¯ã€‚ åŒ…å«classloaderçš„åå­—ã€åŠ è½½çš„classæ•°é‡ã€å ç”¨å†…å­˜å¤§å°ã€çˆ¶classloaderã€æ´»è·ƒæ€§ã€ç±»åž‹ã€‚ 3ï¼‰å®žä¾‹ 11. [yang@vm-cbu-qa-172-43 ~]$ jmap -histo 12384 &gt;aa.log]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•™ä½ å¦‚ä½•æˆä¸ºJavaçš„OOM Killer]]></title>
    <url>%2F2018%2F05%2F13%2F%E6%95%99%E4%BD%A0%E5%A6%82%E4%BD%95%E6%88%90%E4%B8%BAJava%E7%9A%84OOM-Killer%2F</url>
    <content type="text"><![CDATA[Become OOM Killeræˆ‘ä»¬éƒ½çŸ¥é“JVMçš„å†…å­˜ç®¡ç†æ˜¯è‡ªåŠ¨åŒ–çš„ï¼ŒJavaè¯­è¨€çš„ç¨‹åºæŒ‡é’ˆä¹Ÿä¸éœ€è¦å¼€å‘äººå‘˜æ‰‹å·¥é‡Šæ”¾ï¼ŒJVMçš„GCä¼šè‡ªåŠ¨çš„è¿›è¡Œå›žæ”¶ï¼Œä½†æ˜¯ï¼Œå¦‚æžœç¼–ç¨‹ä¸å½“ï¼ŒJVMä»ç„¶ä¼šå‘ç”Ÿå†…å­˜æ³„éœ²ï¼Œå¯¼è‡´Javaç¨‹åºäº§ç”Ÿäº†OutOfMemoryErrorï¼ˆOOMï¼‰é”™è¯¯ã€‚ äº§ç”ŸOutOfMemoryErroré”™è¯¯çš„åŽŸå› åŒ…æ‹¬ï¼š java.lang.OutOfMemoryError: Java heap space java.lang.OutOfMemoryError: PermGen spaceåŠå…¶è§£å†³æ–¹æ³• java.lang.OutOfMemoryError: unable to create new native thread java.lang.OutOfMemoryErrorï¼šGC overhead limit exceeded å¯¹äºŽç¬¬1ç§å¼‚å¸¸ï¼Œè¡¨ç¤ºJavaå †ç©ºé—´ä¸å¤Ÿï¼Œå½“åº”ç”¨ç¨‹åºç”³è¯·æ›´å¤šçš„å†…å­˜ï¼Œè€ŒJavaå †å†…å­˜å·²ç»æ— æ³•æ»¡è¶³åº”ç”¨ç¨‹åºå¯¹å†…å­˜çš„éœ€è¦ï¼Œå°†æŠ›å‡ºè¿™ç§å¼‚å¸¸ã€‚ å¯¹äºŽç¬¬2ç§å¼‚å¸¸ï¼Œè¡¨ç¤ºJavaæ°¸ä¹…å¸¦ï¼ˆæ–¹æ³•åŒºï¼‰ç©ºé—´ä¸å¤Ÿï¼Œæ°¸ä¹…å¸¦ç”¨äºŽå­˜æ”¾ç±»çš„å­—èŠ‚ç å’Œé•¿å¸¸é‡æ± ï¼Œç±»çš„å­—èŠ‚ç åŠ è½½åŽå­˜æ”¾åœ¨è¿™ä¸ªåŒºåŸŸï¼Œè¿™å’Œå­˜æ”¾å¯¹è±¡å®žä¾‹çš„å †åŒºæ˜¯ä¸åŒçš„ï¼Œå¤§å¤šæ•°JVMçš„å®žçŽ°éƒ½ä¸ä¼šå¯¹æ°¸ä¹…å¸¦è¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œå› æ­¤ï¼Œåªè¦ç±»åŠ è½½çš„è¿‡å¤šå°±ä¼šå‡ºçŽ°è¿™ä¸ªé—®é¢˜ã€‚ä¸€èˆ¬çš„åº”ç”¨ç¨‹åºéƒ½ä¸ä¼šäº§ç”Ÿè¿™ä¸ªé”™è¯¯ï¼Œç„¶è€Œï¼Œå¯¹äºŽWebæœåŠ¡å™¨æ¥è®²ï¼Œä¼šäº§ç”Ÿæœ‰å¤§é‡çš„JSPï¼ŒJSPåœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€çš„ç¼–è¯‘æˆJava Servletç±»ï¼Œç„¶åŽåŠ è½½åˆ°æ–¹æ³•åŒºï¼Œå› æ­¤ï¼Œå¤ªå¤šçš„JSPçš„Webå·¥ç¨‹å¯èƒ½äº§ç”Ÿè¿™ä¸ªå¼‚å¸¸ã€‚ å¯¹äºŽç¬¬3ç§å¼‚å¸¸ï¼Œæœ¬è´¨åŽŸå› æ˜¯åˆ›å»ºäº†å¤ªå¤šçš„çº¿ç¨‹ï¼Œè€Œèƒ½åˆ›å»ºçš„çº¿ç¨‹æ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¯¼è‡´äº†è¿™ç§å¼‚å¸¸çš„å‘ç”Ÿã€‚ å¯¹äºŽç¬¬4ç§å¼‚å¸¸ï¼Œæ˜¯åœ¨å¹¶è¡Œæˆ–è€…å¹¶å‘å›žæ”¶å™¨åœ¨GCå›žæ”¶æ—¶é—´è¿‡é•¿ã€è¶…è¿‡98%çš„æ—¶é—´ç”¨æ¥åšGCå¹¶ä¸”å›žæ”¶äº†ä¸åˆ°2%çš„å †å†…å­˜ï¼Œç„¶åŽæŠ›å‡ºè¿™ç§å¼‚å¸¸è¿›è¡Œæå‰é¢„è­¦ï¼Œç”¨æ¥é¿å…å†…å­˜è¿‡å°é€ æˆåº”ç”¨ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚ ä¸‹é¢ä¸¤ä¸ªå¼‚å¸¸ä¸ŽOOMæœ‰å…³ç³»ï¼Œä½†æ˜¯ï¼Œåˆæ²¡æœ‰ç»å¯¹å…³ç³»ã€‚ java.lang.StackOverflowError â€¦ java.net.SocketException: Too many open files å¯¹äºŽç¬¬1ç§å¼‚å¸¸ï¼Œæ˜¯JVMçš„çº¿ç¨‹ç”±äºŽé€’å½’æˆ–è€…æ–¹æ³•è°ƒç”¨å±‚æ¬¡å¤ªå¤šï¼Œå æ»¡äº†çº¿ç¨‹å †æ ˆè€Œå¯¼è‡´çš„ï¼Œçº¿ç¨‹å †æ ˆé»˜è®¤å¤§å°ä¸º1Mã€‚ å¯¹äºŽç¬¬2ç§å¼‚å¸¸ï¼Œæ˜¯ç”±äºŽç³»ç»Ÿå¯¹æ–‡ä»¶å¥æŸ„çš„ä½¿ç”¨æ˜¯æœ‰é™åˆ¶çš„ï¼Œè€ŒæŸä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨çš„æ–‡ä»¶å¥æŸ„è¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼Œå°±ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ã€‚ ä¸Šé¢ä»‹ç»äº†OOMç›¸å…³çš„åŸºç¡€çŸ¥è¯†ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è®²è¿°ç¬”è€…ç»åŽ†çš„ä¸€æ¬¡OOMé—®é¢˜çš„å®šä½å’Œè§£å†³çš„è¿‡ç¨‹ã€‚ 1. äº§ç”Ÿé—®é¢˜çš„çŽ°è±¡ åœ¨æŸä¸€æ®µæ—¶é—´å†…ï¼Œæˆ‘ä»¬å‘çŽ°ä¸åŒçš„ä¸šåŠ¡æœåŠ¡å¼€å§‹å¶å‘çš„æŠ¥OOMçš„å¼‚å¸¸ï¼Œæœ‰çš„æ—¶å€™æ˜¯ç™½å¤©å‘ç”Ÿï¼Œæœ‰çš„æ—¶å€™æ˜¯æ™šä¸Šå‘ç”Ÿï¼Œæœ‰çš„æ—¶å€™æ˜¯åŸºç¡€æœåŠ¡Aå‘ç”Ÿï¼Œæœ‰çš„æ—¶å€™æ˜¯ä¸Šå±‚æœåŠ¡Bå‘ç”Ÿï¼Œæœ‰çš„æ—¶å€™æ˜¯ä¸Šå±‚æœåŠ¡Cå‘ç”Ÿï¼Œæœ‰çš„æ—¶å€™æ˜¯ä¸‹å±‚æœåŠ¡Då‘ç”Ÿï¼Œä¸æ¯«çœ‹ä¸åˆ°ä¸€ç‚¹è§„å¾‹ã€‚ äº§ç”Ÿé—®é¢˜çš„å¼‚å¸¸å¦‚ä¸‹ï¼š 123Caused by: java.lang.OutOfMemoryError: unable to create new native thread at java.lang.Thread.start0(Native Method)at java.lang.Thread.start(Thread.java:597)at java.util.Timer.&lt;init&gt;(Timer.java:154) 2. è§£å†³é—®é¢˜çš„æ€è·¯å’Œè¿‡ç¨‹ ç»è¿‡ç»†å¿ƒè§‚å¯Ÿå‘çŽ°ï¼Œäº§ç”Ÿé—®é¢˜è™½ç„¶åœ¨ä¸åŒçš„æ—¶é—´å‘ç”Ÿåœ¨ä¸åŒçš„æœåŠ¡æ± ï¼Œä½†æ˜¯ï¼Œæ™šä¸Š0ç‚¹å‘ç”Ÿçš„æ—¶å€™æ¦‚çŽ‡è¾ƒå¤§ï¼Œä¹Ÿæœ‰å…¶ä»–æ—¶é—´å¶å‘ï¼Œä½†æ˜¯éƒ½åœ¨æ•´ç‚¹ã€‚ è¿™ä¸ªè§„å¾‹å¾ˆé‡è¦ï¼Œè™½ç„¶ä¸æ˜¯ä¸€ä¸ªæ—¶é—´ï¼Œä½†æ˜¯åŸºæœ¬éƒ½åœ¨æ•´ç‚¹å·¦å³å‘ç”Ÿï¼Œå¹¶ä¸”æ™šä¸Š0ç‚¹å±…å¤šã€‚ä»Žè¿™ä¸ªè§’åº¦æ€è€ƒï¼Œæ•´ç‚¹æˆ–è€…0ç‚¹ç³»ç»Ÿæ˜¯å¦æœ‰å®šæ—¶ï¼Œä¸Žå‡ºé—®é¢˜çš„æ¯ä¸ªä¸šåŠ¡ç³»ç»ŸæŠ€æœ¯è´Ÿè´£äººæ ¸å®žï¼Œ0ç‚¹æ²¡æœ‰å®šæ—¶ä»»åŠ¡ï¼Œå…¶ä»–æ—¶é—´çš„æ•´ç‚¹æœ‰å®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯ä¸Žå‘ç”Ÿé—®é¢˜çš„æ—¶é—´ä¸å»åˆï¼Œè¿™ä¸ªæ€è·¯è¡Œä¸é€šã€‚ åˆ°çŽ°åœ¨ä¸ºæ­¢ï¼Œä»ŽçŽ°è±¡çš„è§„å¾‹ä¸Šæˆ‘ä»¬å·²ç»æ²¡æ³•ç»§ç»­åˆ†æžä¸‹åŽ»äº†ï¼Œé‚£æˆ‘ä»¬å›žé¡¾ä¸€ä¸‹é”™è¯¯æœ¬èº«ï¼š java.lang.OutOfMemoryError: unable to create new native thread é¡¾åæ€ä¹‰ï¼Œé”™è¯¯äº§ç”Ÿçš„åŽŸå› å°±æ˜¯åº”ç”¨ä¸èƒ½åˆ›å»ºçº¿ç¨‹äº†ï¼Œä½†æ˜¯ï¼Œåº”ç”¨è¿˜éœ€è¦åˆ›å»ºçº¿ç¨‹ã€‚ä¸ºä»€ä¹ˆç¨‹åºä¸èƒ½åˆ›å»ºçº¿ç¨‹å‘¢ï¼Ÿ æœ‰ä¸¤ä¸ªå…·ä½“åŽŸå› é€ æˆè¿™ä¸ªå¼‚å¸¸: ç”±äºŽçº¿ç¨‹ä½¿ç”¨çš„èµ„æºè¿‡å¤šï¼Œæ“ä½œç³»ç»Ÿå·²ç»ä¸èƒ½å†æä¾›ç»™åº”ç”¨èµ„æºäº†ã€‚ æ“ä½œç³»ç»Ÿè®¾ç½®äº†åº”ç”¨åˆ›å»ºçº¿ç¨‹çš„æœ€å¤§æ•°é‡ï¼Œå¹¶ä¸”å·²ç»è¾¾åˆ°äº†æœ€å¤§å…è®¸æ•°é‡ã€‚ ä¸Šé¢ç¬¬1æ¡èµ„æºæŒ‡çš„æ˜¯å†…å­˜ï¼Œè€Œç¬¬2æ¡ä¸­ï¼Œåœ¨Linuxä¸‹çº¿ç¨‹ä½¿ç”¨è½»é‡çº§è¿›ç¨‹å®žçŽ°çš„ï¼Œå› æ­¤çº¿ç¨‹çš„æœ€å¤§æ•°é‡ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿå…è®¸çš„è¿›ç¨‹çš„æœ€å¤§æ•°é‡ã€‚ å†…å­˜è®¡ç®— æ“ä½œç³»ç»Ÿä¸­çš„æœ€å¤§å¯ç”¨å†…å­˜é™¤åŽ»æ“ä½œç³»ç»Ÿæœ¬èº«ä½¿ç”¨çš„éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„éƒ½å¯ä»¥ä¸ºæŸä¸€ä¸ªè¿›ç¨‹æœåŠ¡ï¼Œåœ¨JVMè¿›ç¨‹ä¸­ï¼Œå†…å­˜åˆè¢«åˆ†ä¸ºå †ã€æœ¬åœ°å†…å­˜å’Œæ ˆç­‰ä¸‰å¤§å—ï¼ŒJavaå †æ˜¯JVMè‡ªåŠ¨ç®¡ç†çš„å†…å­˜ï¼Œåº”ç”¨çš„å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ã€ç±»çš„è£…è½½ç­‰éƒ½å‘ç”Ÿåœ¨è¿™é‡Œï¼Œæœ¬åœ°å†…å­˜æ˜¯Javaåº”ç”¨ä½¿ç”¨çš„ä¸€ç§ç‰¹æ®Šå†…å­˜ï¼ŒJVMå¹¶ä¸ç›´æŽ¥ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸï¼Œæ¯ä¸ªçº¿ç¨‹ä¹Ÿä¼šæœ‰ä¸€ä¸ªæ ˆï¼Œæ˜¯ç”¨æ¥å­˜å‚¨çº¿ç¨‹å·¥ä½œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–¹æ³•å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°å’Œè¿”å›žå€¼çš„ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”çš„æ ˆçš„é»˜è®¤å¤§å°ä¸º1Mã€‚ Linuxå’ŒJVMçš„å†…å­˜ç®¡ç†ç¤ºæ„å›¾å¦‚ä¸‹ï¼š å› æ­¤ï¼Œä»Žå†…å­˜è§’åº¦æ¥çœ‹åˆ›å»ºçº¿ç¨‹éœ€è¦å†…å­˜ç©ºé—´ï¼Œå¦‚æžœJVMè¿›ç¨‹æ­£å½“ä¸€ä¸ªåº”ç”¨åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ“ä½œç³»ç»Ÿæ²¡æœ‰å‰©ä½™çš„å†…å­˜åˆ†é…ç»™æ­¤JVMè¿›ç¨‹ï¼Œåˆ™ä¼šæŠ›å‡ºé—®é¢˜ä¸­çš„OOMå¼‚å¸¸ï¼šunable to create new native threadã€‚ å¦‚ä¸‹å…¬å¼å¯ä»¥ç”¨æ¥ä»Žå†…å­˜è§’åº¦è®¡ç®—å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ï¼š æœ€å¤§çº¿ç¨‹æ•° = ï¼ˆæ“ä½œç³»ç»Ÿæœ€å¤§å¯ç”¨å†…å­˜ - JVMå†…å­˜ - æ“ä½œç³»ç»Ÿé¢„ç•™å†…å­˜ï¼‰/ çº¿ç¨‹æ ˆå¤§å° æ ¹æ®è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‰©ä½™å†…å­˜è®¡ç®—å¯ä»¥åˆ›å»ºçº¿ç¨‹çš„æ•°é‡ã€‚ ä¸‹é¢æ˜¯é—®é¢˜å‡ºçŽ°çš„æ—¶å€™ï¼Œä»Žç”Ÿäº§æœºå™¨ä¸Šæ‰§è¡Œå‰é¢å°èŠ‚ä»‹ç»çš„Linuxå‘½ä»¤freeçš„è¾“å‡ºï¼š 123free -m &gt;&gt; /tmp/free.log total used free shared buffers cachedMem: 7872 7163 709 0 31 3807-/+ buffers/cache: 3324 4547Swap: 4095 173 3922Tue Jul 5 00:27:51 CST 2016 ä»Žä¸Šé¢è¾“å‡ºå¯ä»¥å¾—å‡ºï¼Œç”Ÿäº§æœºå™¨8Gå†…å­˜ï¼Œä½¿ç”¨äº†7Gï¼Œå‰©ä½™700Må¯ç”¨ï¼Œå…¶ä¸­æ“ä½œç³»ç»Ÿcacheä½¿ç”¨3.8Gã€‚æ“ä½œç³»ç»Ÿcacheä½¿ç”¨çš„3.8Gæ˜¯ç”¨æ¥ç¼“å­˜IOæ•°æ®çš„ï¼Œå¦‚æžœè¿›ç¨‹å†…å­˜ä¸å¤Ÿç”¨ï¼Œè¿™äº›å†…å­˜æ˜¯å¯ä»¥é‡Šæ”¾å‡ºæ¥ä¼˜å…ˆåˆ†é…ç»™è¿›ç¨‹ä½¿ç”¨ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æš‚æ—¶å¹¶ä¸éœ€è¦è€ƒè™‘è¿™å—å†…å­˜ï¼Œå‰©ä½™çš„700Mç©ºé—´å®Œå…¨å¯ä»¥ç»§ç»­ç”¨æ¥åˆ›å»ºçº¿ç¨‹æ•°ï¼š 700M / 1M = 700ä¸ªçº¿ç¨‹ å› æ­¤ï¼Œæ ¹æ®å†…å­˜å¯ç”¨è®¡ç®—ï¼Œå½“OOMå¼‚å¸¸ï¼šunable to create new native threadé—®é¢˜å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿˜æœ‰700Må¯ç”¨å†…å­˜ï¼Œå¯ä»¥åˆ›å»º700ä¸ªçº¿ç¨‹ã€‚ åˆ°çŽ°åœ¨ä¸ºæ­¢å¯ä»¥è¯æ˜Žæ­¤æ¬¡OOMå¼‚å¸¸ä¸æ˜¯å› ä¸ºçº¿ç¨‹åƒå…‰æ‰€æœ‰çš„å†…å­˜è€Œå¯¼è‡´çš„ã€‚ çº¿ç¨‹æ•°å¯¹æ¯” ä¸Šé¢æåˆ°ï¼Œæœ‰ä¸¤ä¸ªå…·ä½“åŽŸå› é€ æˆè¿™ä¸ªå¼‚å¸¸ï¼Œæˆ‘ä»¬ä¸Šé¢å·²ç»æŽ’é™¤äº†ç¬¬1ä¸ªåŽŸå› ï¼Œé‚£æˆ‘ä»¬çŽ°åœ¨ä»Žç¬¬2ä¸ªåŽŸå› å…¥æ‰‹ï¼Œè¯„ä¼°æ˜¯å¦æ“ä½œç³»ç»Ÿè®¾ç½®äº†åº”ç”¨åˆ›å»ºçº¿ç¨‹çš„æœ€å¤§æ•°é‡ï¼Œå¹¶ä¸”å·²ç»è¾¾åˆ°äº†æœ€å¤§å…è®¸æ•°é‡ã€‚ åœ¨é—®é¢˜å‡ºçŽ°çš„ç”Ÿäº§æœºå™¨ä¸Šä½¿ç”¨ulimit -aæ¥æ˜¾ç¤ºå½“å‰çš„å„ç§ç³»ç»Ÿå¯¹ç”¨æˆ·ä½¿ç”¨èµ„æºçš„é™åˆ¶ï¼š 123456robert@robert-ubuntu1410ï¼š~$ ulimit -acore file size (blocks, -c) 0data seg size (kbytes, -d) unlimitedscheduling priority (-e) 0file size (blocks, -f) unlimitedpending signals (-i) 62819max locked memory (kbytes, -l) 64max memory size (kbytes, -m) unlimitedopen files (-n) 65535pipe size (512 bytes, -p) 8POSIX message queues (bytes, -q) 819200real-time priority (-r) 0stack size (kbytes, -s) 10240cpu time (seconds, -t) unlimitedmax user processes (-u) 1024virtual memory (kbytes, -v) unlimitedfile locks (-x) unlimited è¿™é‡Œé¢æˆ‘ä»¬çœ‹åˆ°ç”Ÿäº§æœºå™¨è®¾ç½®çš„å…è®¸ä½¿ç”¨çš„æœ€å¤§ç”¨æˆ·è¿›ç¨‹æ•°ä¸º1024ï¼š 1max user processes (-u) 1024 çŽ°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»èŽ·å¾—é—®é¢˜å‡ºçŽ°çš„æ—¶å€™ï¼Œç”¨æˆ·ä¸‹åˆ›å»ºçš„çº¿ç¨‹æƒ…å†µã€‚ åœ¨é—®é¢˜äº§ç”Ÿçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨å‰é¢å°ç»“ä»‹ç»çš„JVMç›‘æŽ§å‘½ä»¤jstackå‘½ä»¤æ‰“å°å‡ºäº†Javaçº¿ç¨‹æƒ…å†µ,jstackå‘½ä»¤çš„ç¤ºä¾‹è¾“å‡ºå¦‚ä¸‹ï¼š 12345678910111213141516171819202122robert@robert-ubuntu1410:~$ jstack 27432017-04-09 12:06:51Full thread dump Java HotSpot(TM) Server VM (25.20-b23 mixed mode):"Attach Listener" #23 daemon prio=9 os_prio=0 tid=0xc09adc00 nid=0xb4c waiting on condition [0x00000000] java.lang.Thread.State: RUNNABLE"http-nio-8080-Acceptor-0" #22 daemon prio=5 os_prio=0 tid=0xc3341000 nid=0xb02 runnable [0xbf1bd000] java.lang.Thread.State: RUNNABLE at sun.nio.ch.ServerSocketChannelImpl.accept0(Native Method) at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:241) - locked &lt;0xcf8938d8&gt; (a java.lang.Object) at org.apache.tomcat.util.net.NioEndpoint$Acceptor.run(NioEndpoint.java:688) at java.lang.Thread.run(Thread.java:745)"http-nio-8080-ClientPoller-1" #21 daemon prio=5 os_prio=0 tid=0xc35bc400 nid=0xb01 runnable [0xbf1fe000] java.lang.Thread.State: RUNNABLE at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method) at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269) at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:79) at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86) - locked &lt;0xcf99b100&gt; (a sun.nio.ch.Util$2) - locked &lt;0xcf99b0f0&gt; (a java.util.Collections$UnmodifiableSet) - locked &lt;0xcf99aff8&gt; (a sun.nio.ch.EPollSelectorImpl) at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97) at org.apache.tomcat.util.net.NioEndpoint$Poller.run(NioEndpoint.java:1052) at java.lang.Thread.run(Thread.java:745)...... ä»Žjstackå‘½ä»¤çš„è¾“å‡ºå¹¶ç»Ÿè®¡åŽï¼Œæˆ‘ä»¬å¾—çŸ¥ï¼ŒJVMä¸€å…±åˆ›å»ºäº†904ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œè¿™è¿˜æ²¡æœ‰åˆ°æœ€å¤§çš„è¿›ç¨‹é™åˆ¶1024ã€‚ 12robert@robert-ubuntu1410:~$ grep "Thread " js.log | wc -l 904 è¿™æ˜¯æˆ‘ä»¬æ€è€ƒï¼Œé™¤äº†JVMåˆ›å»ºçš„åº”ç”¨å±‚çº¿ç¨‹ï¼ŒJVMæœ¬èº«å¯èƒ½ä¼šæœ‰ä¸€äº›ç®¡ç†çº¿ç¨‹å­˜åœ¨ï¼Œè€Œä¸”æ“ä½œç³»ç»Ÿå†…ç”¨æˆ·ä¸‹å¯èƒ½ä¹Ÿä¼šæœ‰å®ˆæŠ¤çº¿ç¨‹åœ¨è¿è¡Œã€‚ æˆ‘ä»¬ç»§ç»­ä»Žæ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥ç»Ÿè®¡çº¿ç¨‹æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šé¢å°ç»“ä»‹ç»çš„Linuxæ“ä½œç³»ç»Ÿå‘½ä»¤pstackï¼Œå¹¶å¾—åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š 123456789PID LWP USER %CPU %MEM CMD 1 1 root 0.0 0.0 /sbin/init 2 2 root 0.0 0.0 [kthreadd] 3 3 root 0.0 0.0 [migration/0] 4 4 root 0.0 0.0 [ksoftirqd/0] 5 5 root 0.0 0.0 [migration/0] 6 6 root 0.0 0.0 [watchdog/0] 7 7 root 0.0 0.0 [migration/1] 8 8 root 0.0 0.0 [migration/1] 9 9 root 0.0 0.0 [ksoftirqd/1] 10 10 root 0.0 0.0 [watchdog/1] 11 11 root 0.0 0.0 [migration/2] 12 12 root 0.0 0.0 [migration/2] 13 13 root 0.0 0.0 [ksoftirqd/2] 14 14 root 0.0 0.0 [watchdog/2] 15 15 root 0.0 0.0 [migration/3] 16 16 root 0.0 0.0 [migration/3] 17 17 root 0.0 0.0 [ksoftirqd/3] 18 18 root 0.0 0.0 [watchdog/3] 19 19 root 0.0 0.0 [events/0] 20 20 root 0.0 0.0 [events/1] 21 21 root 0.0 0.0 [events/2] 22 22 root 0.0 0.0 [events/3] 23 23 root 0.0 0.0 [cgroup] 24 24 root 0.0 0.0 [khelper] ...... 7257 7257 zabbix 0.0 0.0 /usr/local/zabbix/sbin/zabbix_agentd: active checks #2 [idle 1 sec] 7258 7258 zabbix 0.0 0.0 /usr/local/zabbix/sbin/zabbix_agentd: active checks #3 [idle 1 sec] 7259 7259 zabbix 0.0 0.0 /usr/local/zabbix/sbin/zabbix_agentd: active checks #4 [idle 1 sec] ...... 9040 9040 app 0.0 30.5 /apps/prod/jdk1.6.0_24/bin/java -Dnop -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Ddbconfigpath=/apps/dbconfig/ -Djava.io.tmpdir=/apps/data/java-tmpdir -server -Xms2048m -Xmx2048m -XX:PermSize=128m -XX:MaxPermSize=512m -Dcom.sun.management.jmxremote -Djava.rmi.server.hostname=192.168.10.194 -Dcom.sun.management.jmxremote.port=6969 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp -Xshare:off -Dhostname=sjsa-trade04 -Djute.maxbuffer=41943040 -Djava.net.preferIPv4Stack=true -Dfile.encoding=UTF-8 -Dworkdir=/apps/data/tomcat-work -Djava.endorsed.dirs=/apps/product/tomcat-trade/endorsed -classpath commonlib:/apps/product/tomcat-trade/bin/bootstrap.jar:/apps/product/tomcat-trade/bin/tomcat-juli.jar -Dcatalina.base=/apps/product/tomcat-trade -Dcatalina.home=/apps/product/tomcat-trade -Djava.io.tmpdir=/apps/data/tomcat-temp/ org.apache.catalina.startup.Bootstrap start 9040 9041 app 0.0 30.5 /apps/prod/jdk1.6.0_24/bin/java -Dnop -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -Ddbconfigpath=/apps/dbconfig/ -Djava.io.tmpdir=/apps/data/java-tmpdir -server -Xms2048m -Xmx2048m -XX:PermSize=128m -XX:MaxPermSize=512m -Dcom.sun.management.jmxremote -Djava.rmi.server.hostname=192.168.10.194 -Dcom.sun.management.jmxremote.port=6969 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp -Xshare:off -Dhostname=sjsa-trade04 -Djute.maxbuffer=41943040 -Djava.net.preferIPv4Stack=true -Dfile.encoding=UTF-8 -Dworkdir=/apps/data/tomcat-work -Djava.endorsed.dirs=/apps/product/tomcat-trade/endorsed -classpath commonlib:/apps/product/tomcat-trade/bin/bootstrap.jar:/apps/product/tomcat-trade/bin/tomcat-juli.jar -Dcatalina.base=/apps/product/tomcat-trade -Dcatalina.home=/apps/product/tomcat-trade -Djava.io.tmpdir=/apps/data/tomcat-temp/ org.apache.catalina.startup.Bootstrap start...... é€šè¿‡å‘½ä»¤ç»Ÿè®¡ç”¨æˆ·ä¸‹å·²ç»åˆ›å»ºçš„çº¿ç¨‹æ•°ä¸º1021ã€‚ 12$ grep app pthreads.log | wc -l 1021 çŽ°åœ¨æˆ‘ä»¬ç¡®å®šï¼Œ1021çš„æ•°å­—å·²ç»ç›¸å½“çš„æŽ¥è¿‘1021çš„æœ€å¤§è¿›ç¨‹æ•°äº†ï¼Œæ­£å¦‚å‰é¢æˆ‘ä»¬æåˆ°ï¼Œåœ¨Linuxæ“ä½œç³»ç»Ÿé‡Œï¼Œçº¿ç¨‹æ˜¯é€šè¿‡è½»é‡çº§çš„è¿›ç¨‹å®žçŽ°çš„ï¼Œå› æ­¤ï¼Œé™åˆ¶ç”¨æˆ·çš„æœ€å¤§è¿›ç¨‹æ•°ï¼Œå°±æ˜¯é™åˆ¶ç”¨æˆ·çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œè‡³äºŽä¸ºä»€ä¹ˆæ²¡æœ‰ç²¾ç¡®è¾¾åˆ°1024è¿™ä¸ªæœ€å¤§å€¼å°±å·²ç»æŠ¥å‡ºå¼‚å¸¸ï¼Œåº”è¯¥æ˜¯ç³»ç»Ÿçš„è‡ªæˆ‘ä¿æŠ¤åŠŸèƒ½ï¼Œåœ¨è¿˜å‰©ä¸‹3ä¸ªçº¿ç¨‹çš„å‰æä¸‹ï¼Œå°±å¼€å§‹æŠ¥é”™ã€‚ åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡åˆ†æžæ¥æ‰¾åˆ°é—®é¢˜çš„åŽŸå› ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šåˆ›å»ºè¿™ä¹ˆå¤šçš„çº¿ç¨‹ï¼Œä»Žç¬¬ä¸€ä¸ªè¾“å‡ºå¾—çŸ¥ï¼ŒJVMå·²ç»åˆ›å»ºçš„åº”ç”¨çº¿ç¨‹æœ‰907ä¸ªï¼Œé‚£ä¹ˆä»–ä»¬éƒ½åœ¨åšä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿ äºŽæ˜¯ï¼Œåœ¨é—®é¢˜å‘ç”Ÿçš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆä½¿ç”¨JVMçš„jstackå‘½ä»¤ï¼ŒæŸ¥çœ‹è¾“å‡ºå¾—çŸ¥ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½é˜»å¡žåœ¨æ‰“å°æ—¥å¿—çš„è¯­å¥ä¸Šï¼Œlog4jä¸­æ‰“å°æ—¥å¿—çš„ä»£ç å®žçŽ°å¦‚ä¸‹ï¼š 1234567891011public void callAppenders(LoggingEvent event) &#123; int writes = 0; for(Category c = this; c != null; c=c.parent) &#123; // Protected against simultaneous call to addAppender, removeAppender,... synchronized(c) &#123; if(c.aai != null) &#123; writes += c.aai.appendLoopOnAppenders(event); &#125; if(!c.additive) &#123; break; &#125; &#125; &#125; if(writes == 0) &#123; repository.emitNoAppenderWarning(this); &#125;&#125; åœ¨log4jä¸­ï¼Œæ‰“å°æ—¥å¿—æœ‰ä¸€ä¸ªé”ï¼Œé”çš„ä½œç”¨æ˜¯è®©æ‰“å°æ—¥å¿—å¯ä»¥ä¸²è¡Œï¼Œä¿è¯æ—¥å¿—åœ¨æ—¥å¿—æ–‡ä»¶ä¸­çš„æ­£ç¡®æ€§å’Œé¡ºåºæ€§ã€‚ é‚£ä¹ˆï¼Œæ–°çš„é—®é¢˜åˆæ¥äº†ï¼Œä¸ºä»€ä¹ˆåªæœ‰å‡Œæ™¨0ç‚¹ä¼šå‡ºçŽ°æ‰“å°æ—¥å¿—é˜»å¡žï¼Œå…¶ä»–æ—¶é—´ä¼šå¶å°”å‘ç”Ÿå‘¢ï¼Ÿè¿™æ—¶ï¼Œæˆ‘ä»¬å¸¦ç€æ–°çš„çº¿ç´¢åˆå›žåˆ°é—®é¢˜å¼€å§‹çš„æ€è·¯ï¼Œå‡Œæ™¨12ç‚¹åº”ç”¨æ²¡æœ‰å®šæ—¶ä»»åŠ¡ï¼Œç³»ç»Ÿä¼šä¸ä¼šæœ‰å…¶ä»–çš„IOå¯†é›†åž‹çš„ä»»åŠ¡ï¼Œæ¯”å¦‚è¯´å½’æ¡£æ—¥å¿—ã€ç£ç›˜å¤‡ä»½ç­‰ï¼Ÿ ç»è¿‡ä¸Žè¿ç»´éƒ¨é—¨ç¢°å¤´ï¼ŒåŸºæœ¬ç¡®å®šæ˜¯æ¯å¤©å‡Œæ™¨0ç‚¹æ—¥å¿—åˆ‡å‰²å¯¼è‡´ç£ç›˜IOè¢«å ç”¨ï¼ŒäºŽæ˜¯å µå¡žæ‰“å°æ—¥å¿—ï¼Œæ—¥å¿—æ˜¯æ¯ä¸ªå·¥ä½œä»»åŠ¡éƒ½å¿…é¡»çš„ï¼Œæ—¥å¿—é˜»å¡žï¼Œçº¿ç¨‹æ± å°±é˜»å¡žï¼Œçº¿ç¨‹æ± é˜»å¡žå°±å¯¼è‡´çº¿ç¨‹æ± è¢«æ’‘å¤§ï¼Œçº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹æ•°è¶…è¿‡1024å°±ä¼šæŠ¥é”™ã€‚ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬ç¡®å®šäº†é—®é¢˜çš„åŽŸå› ï¼Œä½†æ˜¯è¿˜éœ€è¦å¯¹æ—¥å¿—åˆ‡å‰²å¯¼è‡´IOå¢žå¤§è¿›è¡Œåˆ†æžå’Œè®ºè¯ã€‚ é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨å‰é¢å°ç»“ä»‹ç»çš„vmstatæŸ¥çœ‹é—®é¢˜å‘ç”Ÿæ—¶IOç­‰å¾…æ•°æ®ï¼š 123vmstat 2 1 &gt;&gt; /tmp/vm.logprocs -----------memory---------- ---swap-- -----io---- --system-- -----cpu----- r b swpd free buff cache si so bi bo in cs us sy id wa st 3 0 177608 725636 31856 3899144 0 0 2 10 0 0 39 1 1 59 0 Tue Jul 5 00:27:51 CST 2016 å¯è§ï¼Œé—®é¢˜å‘ç”Ÿçš„æ—¶å€™ï¼ŒCPUçš„IOç­‰å¾…ä¸º59%ï¼ŒåŒæ—¶åˆä¸Žè¿ç»´éƒ¨é—¨åŒäº‹å¤ç›˜ï¼Œè¿ç»´åŒäº‹ç¡®è®¤ï¼Œè„šæœ¬åˆ‡å‰²é€šè¿‡catå‘½ä»¤æ–¹æ³•ï¼Œå…ˆæŠŠæ—¥å¿—æ–‡ä»¶catåŽï¼Œé€šè¿‡ç®¡é“æ‰“å°åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼Œå†æ¸…ç©ºåŽŸæ–‡ä»¶ï¼Œå› æ­¤ï¼Œä¸€å®šä¼šå¯¼è‡´IOçš„ä¸Šå‡ã€‚ å…¶å®žï¼Œé—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œæˆ‘ä»¬è®¤ä¸ºçº¿ç¨‹è¢«IOé˜»å¡žï¼Œçº¿ç¨‹æ± è¢«æ’‘å¼€ï¼Œå¯¼è‡´çº¿ç¨‹å¢žå¤šï¼ŒäºŽæ˜¯ï¼Œæˆ‘ä»¬æŸ¥çœ‹äº†ä¸€ä¸‹Tomcatçº¿ç¨‹æ± çš„è®¾ç½®ï¼Œæˆ‘ä»¬å‘çŽ°Tomcatçº¿ç¨‹æ± è®¾ç½®äº†800ï¼ŒæŒ‰ç†è¯´ï¼Œæ°¸è¿œä¸ä¼šè¶…è¿‡1024ã€‚ 12345&lt;Connector port="8080" maxThreads="800" minSpareThreads="25" maxSpareThreads="75" enableLookups="false" redirectPort="8443" acceptCount="100" debug="0" connectionTimeout="20000" disableUploadTimeout="true" /&gt; å…³é”®åœ¨äºŽï¼Œç¬”è€…æ‰€åœ¨çš„æ”¯ä»˜å¹³å°æœåŠ¡åŒ–æž¶æž„ä¸­ï¼Œä½¿ç”¨äº†ä¸¤å¥—æœåŠ¡åŒ–æ¡†æž¶ï¼Œä¸€ä¸ªæ˜¯åŸºäºŽdubboçš„æ¡†æž¶ï¼Œä¸€ä¸ªæ˜¯ç‚¹å¯¹ç‚¹çš„RPCï¼Œç”¨æ¥ç´§æ€¥æƒ…å†µä¸‹dubboæœåŠ¡å‡ºçŽ°é—®é¢˜ï¼ŒæœåŠ¡é™çº§ä½¿ç”¨ã€‚ æ¯ä¸ªæœåŠ¡éƒ½é…ç½®äº†ç‚¹å¯¹ç‚¹çš„RPCæœåŠ¡ï¼Œå¹¶ä¸”ç‹¬äº«ä¸€ä¸ªçº¿ç¨‹æ± ï¼š 12345&lt;Connector port="8090" maxThreads="800" minSpareThreads="25" maxSpareThreads="75" enableLookups="false" redirectPort="8443" acceptCount="100" debug="0" connectionTimeout="20000" disableUploadTimeout="true" /&gt; ç”±äºŽæˆ‘ä»¬åœ¨å¯¹dubboæœåŠ¡æ¡†æž¶è¿›è¡Œå®šåˆ¶åŒ–çš„æ—¶å€™ï¼Œè®¾è®¡äº†è‡ªåŠ¨é™çº§åŽŸåˆ™ï¼Œå¦‚æžœdubboæœåŠ¡è´Ÿè½½å˜é«˜ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç‚¹å¯¹ç‚¹çš„RPCæ¡†æž¶ï¼Œè¿™ä¹Ÿç¬¦åˆå¾®æœåŠ¡çš„å¤±æ•ˆè½¬ç§»åŽŸåˆ™ï¼Œä½†æ˜¯è®¾è®¡ä¸­æ²¡æœ‰è¿›è¡Œå…¨é¢çš„è€ƒè™‘ï¼Œä¸€æ—¦ä¸€éƒ¨åˆ†æœåŠ¡åˆ‡æ¢åˆ°äº†ç‚¹å¯¹ç‚¹çš„RPCï¼Œè€Œä¸€éƒ¨åˆ†çš„æœåŠ¡æ²¡æœ‰åˆ‡æ¢ï¼Œå°±å¯¼è‡´ä¸¤ä¸ªçŽ°åœºæ± éƒ½è¢«æ’‘æ»¡ï¼ŒäºŽæ˜¯è¶…è¿‡äº†1024çš„é™åˆ¶ï¼Œå°±å‡ºäº†é—®é¢˜ã€‚ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åŸºæœ¬å¯ä»¥éªŒè¯ï¼Œé—®é¢˜çš„æ ¹æºæ˜¯æ—¥å¿—åˆ‡å‰²å¯¼è‡´IOè´Ÿè½½å¢žåŠ ï¼Œç„¶åŽé˜»å¡žçº¿ç¨‹æ± ï¼Œæœ€åŽå‘ç”ŸOOMï¼šunable to create new native threadã€‚ å‰©ä¸‹çš„ä»»åŠ¡å°±æ˜¯æœ€å°åŒ–é‡çŽ°çš„é—®é¢˜ï¼Œé€šè¿‡å®žè·µæ¥éªŒè¯é—®é¢˜çš„åŽŸå› ã€‚æˆ‘ä»¬ä¸Žæ€§èƒ½åŽ‹æµ‹éƒ¨é—¨æ²Ÿé€šï¼Œæå‡ºåŽ‹æµ‹éœ€æ±‚ï¼š Tomcatçº¿ç¨‹æ± æœ€å¤§è®¾ç½®ä¸º1500. æ“ä½œç³»ç»Ÿå…è®¸çš„æœ€å¤§ç”¨æˆ·è¿›ç¨‹æ•°1024. åœ¨ç»™æœåŠ¡åŠ åŽ‹çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦äººå·¥åˆ¶é€ ç¹å¿™çš„IOæ“ä½œï¼ŒIOç­‰å¾…ä¸å¾—ä½ŽäºŽ50%ã€‚ ç»è¿‡åŽ‹æµ‹åŽ‹æµ‹éƒ¨é—¨çš„ä¸€ä¸‹åˆåŠªåŠ›ï¼ŒçŽ¯å¢ƒæžå®šï¼Œç»“æžœè¯æ˜Žå®Œå…¨å¯ä»¥é‡çŽ°æ­¤é—®é¢˜ã€‚ æœ€åŽï¼Œä¸Žæ‰€æœ‰ç›¸å…³éƒ¨é—¨è®¨è®ºå’Œå¤ç›˜ï¼Œåº”ç”¨è§£å†³æ–¹æ¡ˆï¼Œè§£å†³æ–¹æ¡ˆåŒ…æ‹¬ï¼š å…¨éƒ¨åº”ç”¨æ”¹æˆæŒ‰ç…§å°æ—¶åˆ‡å‰²ï¼Œæˆ–è€…ç›´æŽ¥ä½¿ç”¨log4jçš„æ—¥å¿—æ»šåŠ¨åŠŸèƒ½ã€‚ Tomcatçº¿ç¨‹æ± çš„çº¿ç¨‹æ•°è®¾ç½®ä¸Žæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹æ•°è®¾ç½®ä¸åˆç†ï¼Œé€‚å½“çš„å‡å°‘Tomcatçº¿ç¨‹æ± çº¿ç¨‹æ•°é‡çš„å¤§å°ã€‚ å‡çº§log4jæ—¥å¿—ï¼Œä½¿ç”¨logbackæˆ–è€…log4j2ã€‚ è¿™æ¬¡OOMé—®é¢˜çš„å¯ä»¥å½’ç»“ä¸ºâ€œå¤šä¸ªå› ã€å¤šä¸ªæžœã€å¤šå°æœºå™¨ã€å¤šä¸ªæœåŠ¡æ± ã€ä¸åŒæ—¶é—´â€ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œä¸Žè¿ç»´éƒ¨ã€ç›‘æŽ§éƒ¨å’Œæ€§èƒ½åŽ‹æµ‹éƒ¨é—¨çš„åŒäº‹å¥‹æ–—äº†å‡ å¤©å‡ å¤œï¼Œç»ˆäºŽé€šè¿‡åœ¨çº¿ä¸ŠæŠ“å–ä¿¡æ¯ã€åˆ†æžé—®é¢˜ã€åœ¨æ€§èƒ½åŽ‹æµ‹éƒ¨é—¨åŒäº‹çš„å¸®åŠ©ä¸‹ï¼Œæœ€å°åŒ–é‡çŽ°é—®é¢˜å¹¶æ‰¾åˆ°é—®é¢˜çš„æ ¹æºåŽŸå› ï¼Œæœ€åŽï¼Œé’ˆå¯¹é—®é¢˜äº§ç”Ÿçš„æ ¹æºæä¾›äº†æœ‰æ•ˆçš„æ–¹æ¡ˆã€‚ 3. ä¸Žç›‘æŽ§åŒäº‹çŽ°åœºç¼–å†™çš„è„šæœ¬ æœ¬èŠ‚æä¾›ä¸€ä¸ªç¬”è€…åœ¨å®žè·µè¿‡ç¨‹ä¸­è§£å†³OOMé—®é¢˜çš„ä¸€ä¸ªç®€å•è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬æ˜¯ä¸ºäº†è§£å†³OOMï¼ˆunable to create native thread)çš„é—®é¢˜è€Œåœ¨é—®é¢˜æœºå™¨ä¸Šä¸´æ—¶ç¼–å†™ï¼Œå¹¶ä¸´æ—¶ä½¿ç”¨çš„ï¼Œè„šæœ¬å¹¶æ²¡æœ‰å†™çš„å¾ˆä¸“ä¸šï¼Œç¬”è€…ä¹Ÿæ²¡æœ‰è¿›è¡Œä¼˜åŒ–ï¼Œä¿æŒåŽŸæ±åŽŸå‘³çš„é£Žæ ¼ï¼Œè¿™æ ·èƒ½è®©è¯»è€…æœ‰ç§èº«ä¸´å…¶å¢ƒçš„æ„Ÿè§‰ï¼Œåªæ˜¯ä¸ºäº†æŠ“å–éœ€è¦çš„ä¿¡æ¯å¹¶è§£å†³é—®é¢˜ï¼Œä½†æ˜¯åœ¨çº¿ä¸Šé—®é¢˜ååˆ†ç«æ€¥çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè„šæœ¬ä¼šæœ‰å¤§ç”¨å¤„ã€‚ 12345678#!/bin/bashps -Leo pid,lwp,user,pcpu,pmem,cmd &gt;&gt; /tmp/pthreads.logecho "ps -Leo pid,lwp,user,pcpu,pmem,cmd &gt;&gt; /tmp/pthreads.log" &gt;&gt; /tmp/pthreads.logecho `date` &gt;&gt; /tmp/pthreads.logecho 1pid=`ps aux|grep tomcat|grep cwh|awk -F ' ' '&#123;print $2&#125;'`echo 2echo "pstack $pid &gt;&gt; /tmp/pstack.log" &gt;&gt; /tmp/pstack.logpstack $pid &gt;&gt; /tmp/pstack.logecho `date` &gt;&gt; /tmp/pstack.logecho 3echo "lsof &gt;&gt; /tmp/sys-o-files.log" &gt;&gt; /tmp/sys-o-files.loglsof &gt;&gt; /tmp/sys-o-files.logecho `date` &gt;&gt; /tmp/sys-o-files.logecho 4echo "lsof -p $pid &gt;&gt; /tmp/service-o-files.log" &gt;&gt; /tmp/service-o-files.loglsof -p $pid &gt;&gt; /tmp/service-o-files.logecho `date` &gt;&gt; /tmp/service-o-files.logecho 5echo "jstack -l $pid &gt;&gt; /tmp/js.log" &gt;&gt; /tmp/js.logjstack -l -F $pid &gt;&gt; /tmp/js.logecho `date` &gt;&gt; /tmp/js.logecho 6 echo "free -m &gt;&gt; /tmp/free.log" &gt;&gt; /tmp/free.logfree -m &gt;&gt; /tmp/free.logecho `date` &gt;&gt; /tmp/free.logecho 7echo "vmstat 2 1 &gt;&gt; /tmp/vm.log" &gt;&gt; /tmp/vm.logvmstat 2 1 &gt;&gt; /tmp/vm.logecho `date` &gt;&gt; /tmp/vm.logecho 8echo "jmap -dump:format=b,file=/tmp/heap.hprof 2743" &gt;&gt; /tmp/jmap.logjmap -dump:format=b,file=/tmp/heap.hprof &gt;&gt; /tmp/jmap.logecho `date` &gt;&gt; /tmp/jmap.logecho 9echo end å¦‚æžœè¯»è€…åœ¨çº¿ä¸Šå·²ç»é‡åˆ°äº†OOMçš„é—®é¢˜ï¼Œå¯ä»¥é¡ºç€è¿™ä¸ªçœ‹ä¼¼ç®€é™‹è€Œåˆä¿¡æ¯æ»¡æ»¡çš„JavaæœåŠ¡çš„ç›‘æŽ§è„šæœ¬çš„æ€è·¯ï¼Œåˆ©ç”¨æœ¬æ–‡æä¾›çš„å„ç§è„šæœ¬å’Œå‘½ä»¤æ¥æ·±æŒ–é—®é¢˜çš„æ ¹æœ¬åŽŸå› ã€‚]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ä¸ŠæœåŠ¡å†…å­˜OOMé—®é¢˜å®šä½ä¸‰æ¿æ–§]]></title>
    <url>%2F2018%2F05%2F13%2F%E7%BA%BF%E4%B8%8A%E6%9C%8D%E5%8A%A1%E5%86%85%E5%AD%98OOM%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D%E4%B8%89%E6%9D%BF%E6%96%A7%2F</url>
    <content type="text"><![CDATA[ç›¸ä¿¡å¤§å®¶éƒ½æœ‰æ„Ÿè§¦ï¼Œçº¿ä¸ŠæœåŠ¡å†…å­˜OOMçš„é—®é¢˜ï¼Œæ˜¯æœ€éš¾å®šä½çš„é—®é¢˜ï¼Œä¸è¿‡å½’æ ¹ç»“åº•ï¼Œæœ€å¸¸è§çš„åŽŸå› ï¼š æœ¬èº«èµ„æºä¸å¤Ÿ ç”³è¯·çš„å¤ªå¤š èµ„æºè€—å°½ é¢˜ç›® æŸæœåŠ¡å™¨ä¸Šéƒ¨ç½²äº†JavaæœåŠ¡ä¸€æžšï¼Œå‡ºçŽ°äº†OutOfMemoryErrorï¼Œè¯·é—®æœ‰å¯èƒ½æ˜¯ä»€ä¹ˆåŽŸå› ï¼Œé—®é¢˜åº”è¯¥å¦‚ä½•å®šä½ï¼Ÿ ä¸å¦¨è®¾æœåŠ¡è¿›ç¨‹PIDä¸º10765 è§£å†³æ€è·¯ JavaæœåŠ¡OOMï¼Œæœ€å¸¸è§çš„åŽŸå› ä¸ºï¼š æœ‰å¯èƒ½æ˜¯å†…å­˜åˆ†é…ç¡®å®žè¿‡å°ï¼Œè€Œæ­£å¸¸ä¸šåŠ¡ä½¿ç”¨äº†å¤§é‡å†…å­˜ æŸä¸€ä¸ªå¯¹è±¡è¢«é¢‘ç¹ç”³è¯·ï¼Œå´æ²¡æœ‰é‡Šæ”¾ï¼Œå†…å­˜ä¸æ–­æ³„æ¼ï¼Œå¯¼è‡´å†…å­˜è€—å°½ æŸä¸€ä¸ªèµ„æºè¢«é¢‘ç¹ç”³è¯·ï¼Œç³»ç»Ÿèµ„æºè€—å°½ï¼Œä¾‹å¦‚ï¼šä¸æ–­åˆ›å»ºçº¿ç¨‹ï¼Œä¸æ–­å‘èµ·ç½‘ç»œè¿žæŽ¥ æ›´å…·ä½“çš„ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„ä¸€äº›å·¥å…·é€ä¸€æŽ’æŸ¥ã€‚ ä¸€ã€ç¡®è®¤æ˜¯ä¸æ˜¯å†…å­˜æœ¬èº«å°±åˆ†é…è¿‡å°æ–¹æ³•ï¼šjmap -heap 10765 å¯ä»¥æŸ¥çœ‹æ–°ç”Ÿä»£ï¼Œè€ç”Ÿä»£å †å†…å­˜çš„åˆ†é…å¤§å°ä»¥åŠä½¿ç”¨æƒ…å†µï¼Œçœ‹æ˜¯å¦æœ¬èº«åˆ†é…è¿‡å°ã€‚ äºŒã€æ‰¾åˆ°æœ€è€—å†…å­˜çš„å¯¹è±¡æ–¹æ³•ï¼šjmap -histo:live 10765 | more è¾“å…¥å‘½ä»¤åŽï¼Œä¼šä»¥è¡¨æ ¼çš„å½¢å¼æ˜¾ç¤ºå­˜æ´»å¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶æŒ‰ç…§æ‰€å å†…å­˜å¤§å°æŽ’åºï¼š å®žä¾‹æ•° æ‰€å å†…å­˜å¤§å° ç±»å æ˜¯ä¸æ˜¯å¾ˆç›´è§‚ï¼Ÿå¯¹äºŽå®žä¾‹æ•°è¾ƒå¤šï¼Œå ç”¨å†…å­˜å¤§å°è¾ƒå¤šçš„å®žä¾‹/ç±»ï¼Œç›¸å…³çš„ä»£ç å°±è¦é’ˆå¯¹æ€§reviewäº†ã€‚ ä¸Šå›¾ä¸­å å†…å­˜æœ€å¤šçš„å¯¹è±¡æ˜¯RingBufferLogEventï¼Œå…±å ç”¨å†…å­˜18Mï¼Œå±žäºŽæ­£å¸¸ä½¿ç”¨èŒƒå›´ã€‚ å¦‚æžœå‘çŽ°æŸç±»å¯¹è±¡å ç”¨å†…å­˜å¾ˆå¤§ï¼ˆä¾‹å¦‚å‡ ä¸ªGï¼‰ï¼Œå¾ˆå¯èƒ½æ˜¯ç±»å¯¹è±¡åˆ›å»ºå¤ªå¤šï¼Œä¸”ä¸€ç›´æœªé‡Šæ”¾ã€‚ä¾‹å¦‚ï¼š ç”³è¯·å®Œèµ„æºåŽï¼Œæœªè°ƒç”¨close()æˆ–dispose()é‡Šæ”¾èµ„æº æ¶ˆè´¹è€…æ¶ˆè´¹é€Ÿåº¦æ…¢ï¼ˆæˆ–åœæ­¢æ¶ˆè´¹äº†ï¼‰ï¼Œè€Œç”Ÿäº§è€…ä¸æ–­å¾€é˜Ÿåˆ—ä¸­æŠ•é€’ä»»åŠ¡ï¼Œå¯¼è‡´é˜Ÿåˆ—ä¸­ä»»åŠ¡ç´¯ç§¯è¿‡å¤š ä¸‰ã€ç¡®è®¤æ˜¯å¦æ˜¯èµ„æºè€—å°½å·¥å…·ï¼š pstree netstat æŸ¥çœ‹è¿›ç¨‹åˆ›å»ºçš„çº¿ç¨‹æ•°ï¼Œä»¥åŠç½‘ç»œè¿žæŽ¥æ•°ï¼Œå¦‚æžœèµ„æºè€—å°½ï¼Œä¹Ÿå¯èƒ½å‡ºçŽ°OOMã€‚ è¿™é‡Œä»‹ç»å¦ä¸€ç§æ–¹æ³•ï¼Œé€šè¿‡ /proc/${PID}/fd /proc/${PID}/task å¯ä»¥åˆ†åˆ«æŸ¥çœ‹å¥æŸ„è¯¦æƒ…å’Œçº¿ç¨‹æ•°ã€‚ ä¾‹å¦‚ï¼ŒæŸä¸€å°çº¿ä¸ŠæœåŠ¡å™¨çš„sshdè¿›ç¨‹PIDæ˜¯9339ï¼ŒæŸ¥çœ‹ ll /proc/9339/fd ll /proc/9339/task å¦‚ä¸Šå›¾ï¼Œsshdå…±å ç”¨äº†å››ä¸ªå¥æŸ„ 0 -&gt; æ ‡å‡†è¾“å…¥ 1 -&gt; æ ‡å‡†è¾“å‡º 2 -&gt; æ ‡å‡†é”™è¯¯è¾“å‡º 3 -&gt; socketï¼ˆå®¹æ˜“æƒ³åˆ°æ˜¯ç›‘å¬ç«¯å£ï¼‰ sshdåªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹PIDä¸º9339ï¼Œå¹¶æ²¡æœ‰å¤šçº¿ç¨‹ã€‚ æ‰€ä»¥ï¼Œåªè¦ ll /proc/${PID}/fd | wc -l ll /proc/${PID}/task | wc -l ï¼ˆæ•ˆæžœç­‰åŒpstree -p | wc -lï¼‰ å°±èƒ½çŸ¥é“è¿›ç¨‹æ‰“å¼€çš„å¥æŸ„æ•°å’Œçº¿ç¨‹æ•°ã€‚ é™„ï¼šMATå·¥å…·ä½¿ç”¨macå®‰è£…mat https://www.jianshu.com/p/68a657ed2286 æ–¹æ³•ä¸€ä¿®æ”¹mat.app/Contents/Eclipse/MemoryAnalyzer.ini123456789101112-startup../Eclipse/plugins/org.eclipse.equinox.launcher_1.3.100.v20150511-1540.jar-data/Users/cdqiushengsen/Documents/mat/log--launcher.library../Eclipse/plugins/org.eclipse.equinox.launcher.cocoa.macosx.x86_64_1.1.300.v20150602-1417-vm/Library/Java/Home/jre-vmargs-Xmx1024m-Dorg.eclipse.swt.internal.carbon.smallFonts-XstartOnFirstThread æ–¹æ³•äºŒmacå¯åŠ¨ 1mat.app/Contents/MacOS/MemoryAnalyzer -data ./workspace é…ç½®èŽ·å–dumpæ–‡ä»¶ï¼Œé…ç½® 1-Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError ç¤ºä¾‹ 1234567891011121314151617import java.util.ArrayList;import java.util.List;public class HeapDumpMain &#123; static class OOMHeapDumpObject&#123; String str ="1234567890"; &#125; public static void main(String[] args) &#123; List&lt;OOMHeapDumpObject&gt; ooms = new ArrayList&lt;OOMHeapDumpObject&gt;(); while (true) &#123; ooms.add(new OOMHeapDumpObject()); &#125; &#125;&#125; æ‰“å¼€ç”ŸæˆHeap Dumpæ–‡ä»¶ ç›´æŽ¥ç‚¹å‡»ä¸‹æ–¹çš„ Reports-&gt;Leak Suspects é“¾æŽ¥æ¥ç”ŸæˆæŠ¥å‘Šï¼ŒæŸ¥çœ‹å¯¼è‡´å†…å­˜æ³„éœ²çš„ç½ªé­ç¥¸é¦–]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœåŠ¡å™¨å¼‚å¸¸æ¡ˆä¾‹]]></title>
    <url>%2F2018%2F05%2F13%2F%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BC%82%E5%B8%B8%E6%A1%88%E4%BE%8B%2F</url>
    <content type="text"><![CDATA[####1.æŸåº”ç”¨load&gt;7,sshæ„Ÿåˆ°è¾“å…¥å‘½ä»¤åŽ,è¦ç­‰å¾…1ã€2ç§’ æ‰å¼€å§‹æ‰§è¡Œ topå‘½ä»¤æŸ¥çœ‹cpuå ç”¨çŽ‡,çº¦70%,ä¸è‡³äºŽå¯¼è‡´sshä¸­å‘½ä»¤å“åº”å˜æ…¢ tsaræŸ¥çœ‹æœ€è¿‘çš„ç½‘ç»œæµé‡ï¼Œæ­£å¸¸ iostat 1ï¼Œå‘çŽ°(è™šæ‹Ÿæœº)ç£ç›˜tpsè¾¾åˆ°500+éžå¸¸é«˜ jstackè§‚å¯Ÿjavaä¸­ä¸€ä¸ªçº¿ç¨‹é¢‘ç¹æ“ä½œç£ç›˜ lsofå‘½ä»¤è§‚å¯Ÿæ‰“å¼€æ–‡ä»¶ï¼Œå¹¶æŽ’æŸ¥ä»£ç å‘çŽ°é…ç½®é¡¹æœ‰è¯¯å¯¼è‡´ç£ç›˜ä¸Šå‡ºçŽ°å¾ˆå¤šå°çš„é›¶ç¢Žæ–‡ä»¶ï¼Œå¼•å‘é¢‘ç¹çš„éšæœºè®¿é—®ï¼Œä¿®æ”¹é…ç½®é¡¹åŽé—®é¢˜è§£å†³ï¿¼ï¿¼ ####2.åº”ç”¨Load&gt;10ï¼ŒGCæ­£å¸¸ï¼Œæ´»è·ƒçº¿ç¨‹æ•°å¾ˆå¤šï¼ŒCPU 100% ps -efLï¼Œ æ˜¾ç¤ºæ‰€æœ‰æ´»è·ƒçº¿ç¨‹IDå’Œå¯¹åº”æ—¶é—´ æ ¹æ®å¯¹åº”çº¿ç¨‹SPIDæ‰¾å‡ºjstackä¸­çš„æ‰§è¡Œæ ˆ å®šä½åˆ°é—®é¢˜ä»£ç ï¼Œå‘çŽ°ä¸€ä¸ªæ²¡åŒæ­¥ä¿æŠ¤çš„HashMapé¢‘ç¹å¹¶å‘put/getå¯¼è‡´æ­»å¾ªçŽ¯ 12æ³¨æ„ï¼šé€šå¸¸cpuä½¿ç”¨çŽ‡è¾¾åˆ°äº†100%ï¼Œä¸€èˆ¬æ˜¯æŸäº›çº¿ç¨‹åœ¨æŸç§æ¡ä»¶ä¸‹è¿›å…¥æ­»å¾ªçŽ¯ï¼Œé€€ä¸å‡ºæ¥ ####3.å®¹ç¾æ¼”ä¹ ä¹‹åŽæœåŠ¡æ— æ³•å¯åŠ¨ df â€“h å‘½ä»¤ /home 100%å ç”¨ï¼Œæ—¥å¿—æ–‡ä»¶å·¨å¤§ åˆ æŽ‰ç”±äºŽæ–­ç½‘å¼•èµ·çš„å¤§é‡é‡è¿žæ—¥å¿—ï¼Œé‡å¯ ####4.ï¿¼æŸåº”ç”¨æœºå™¨loadç‹‚é£™100+ï¼ŒæŠ¥è­¦ä¸æ–­ æ”¶é›†å„ä¸ªç³»ç»ŸæŒ‡æ ‡ï¼Œå‘çŽ°é™¤äº†loadä¹‹å¤–æ²¡æœ‰å¼‚å¸¸ï¼Œload&gt;è¿›ç¨‹æ•°ï¼Œåº”ç”¨å“åº”æ­£å¸¸ jstackä¸­RunnableçŠ¶æ€çº¿ç¨‹å¾ˆå¤šâ€œatjava.io.UnixFileSystem.getBooleanAttributes0(Native Method)â€ ps â€“Tel æ‰“å°æ‰€æœ‰çº¿ç¨‹çŠ¶æ€ï¼Œå‘çŽ°å¤§é‡æ€¨å¦‡è¿›ç¨‹ï¼ˆçŠ¶æ€Dï¼Œæ—¢æ— æ³•ä¸­æ–­åˆæ— æ³•ç»§ç»­ï¼‰ æ ¹æ®åƒµå°¸è¿›ç¨‹IDå†æ¬¡æŸ¥æ‰¾jstackä¸­å¯¹åº”ä»£ç ï¼Œä¸ºblockedçš„æ–‡ä»¶è®¿é—®æ ˆ dfå‘½ä»¤hangä½ è”ç³»PEåŒå­¦å¾—çŸ¥NASæ•…éšœ,ä¿®å¤åŽé‡å¯OK ####5.Javaè¿›ç¨‹å¥åœ¨ï¼Œåº”ç”¨è¿è¡Œä¸€æ®µæ—¶é—´å¤±åŽ»å“åº” jstatå„ä¸ªåŒºåŸŸå†…å­˜æ­£å¸¸ï¼Œåº”ç”¨æœåŠ¡å™¨ç³»ç»Ÿèµ„æºæ­£å¸¸ æŸ¥çœ‹åº”ç”¨é»˜è®¤æ—¥å¿—æ–‡ä»¶å‘çŽ°ä¸€è¡Œâ€œWARN [common] æœåŠ¡å™¨ å·²åœæ­¢è¿è¡Œ:12201â€ jstackå‘çŽ°æœ‰çº¿ç¨‹â€œJBoss Shutdown Hookâ€å¥åœ¨ï¼ŒæŸ¥æ‰¾ä»£ç å‘çŽ°å±…ç„¶æœ‰äºŒæ–¹åŒ…ä»£ç åœ¨æŠ›å‡ºå¼‚å¸¸åŽè°ƒç”¨system.exit(0) ï¿¼ï¿¼ï¿¼]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¸¸ç”¨è„šæœ¬]]></title>
    <url>%2F2018%2F05%2F13%2F%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC%2F</url>
    <content type="text"><![CDATA[PSï¼š æœ¬ä»“åº“çš„è„šæœ¬ï¼ˆå¦‚Javaç›¸å…³è„šæœ¬ï¼‰åœ¨é˜¿é‡Œç­‰å…¬å¸ï¼ˆå¦‚éšèº«äº‘ï¼Œè§awesome-scriptsä»“åº“è¯´æ˜Žï¼‰çš„çº¿ä¸Šç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²ä½¿ç”¨ã€‚å¦‚æžœä½ çš„å…¬å¸æœ‰éƒ¨ç½²ä½¿ç”¨ï¼Œæ¬¢è¿Žä½¿ç”¨é€šè¿‡æäº¤Issueå‘ŠçŸ¥ï¼Œæ–¹ä¾¿äº’ç›¸äº¤æµåé¦ˆï½ž :cupid: :beginner: å¿«é€Ÿä¸‹è½½&amp;ä½¿ç”¨1source &lt;(curl -fsSL https://raw.githubusercontent.com/oldratlee/useful-scripts/master/test-cases/self-installer.sh) æ›´å¤šä¸‹è½½&amp;ä½¿ç”¨æ–¹å¼ï¼Œå‚è§ä¸‹è½½ä½¿ç”¨ã€‚ :books: ä½¿ç”¨æ–‡æ¡£:coffee: Javaç›¸å…³è„šæœ¬ show-busy-java-threads ç”¨äºŽå¿«é€ŸæŽ’æŸ¥Javaçš„CPUæ€§èƒ½é—®é¢˜(top uså€¼è¿‡é«˜)ï¼Œè‡ªåŠ¨æŸ¥å‡ºè¿è¡Œçš„Javaè¿›ç¨‹ä¸­æ¶ˆè€—CPUå¤šçš„çº¿ç¨‹ï¼Œå¹¶æ‰“å°å‡ºå…¶çº¿ç¨‹æ ˆï¼Œä»Žè€Œç¡®å®šå¯¼è‡´æ€§èƒ½é—®é¢˜çš„æ–¹æ³•è°ƒç”¨ã€‚ show-duplicate-java-classes æ‰¾å‡ºjaræ–‡ä»¶å’Œclassç›®å½•ä¸­çš„é‡å¤ç±»ã€‚ç”¨äºŽæŽ’æŸ¥Javaç±»å†²çªé—®é¢˜ã€‚ find-in-jars åœ¨ç›®å½•ä¸‹æ‰€æœ‰jaræ–‡ä»¶é‡Œï¼ŒæŸ¥æ‰¾ç±»æˆ–èµ„æºæ–‡ä»¶ã€‚ :shell: Shellç›¸å…³è„šæœ¬Shellä½¿ç”¨åŠ å¼ºï¼š c åŽŸæ ·å‘½ä»¤è¡Œè¾“å‡ºï¼Œå¹¶æ‹·è´æ ‡å‡†è¾“å‡ºåˆ°ç³»ç»Ÿå‰ªè´´æ¿ï¼ŒçœåŽ»CTRL+Cæ“ä½œï¼Œä¼˜åŒ–å‘½ä»¤è¡Œä¸Žå…¶å®ƒåº”ç”¨ä¹‹é—´çš„æ“ä½œæµã€‚ coat å½©è‰²catå‡ºæ–‡ä»¶è¡Œï¼Œæ–¹ä¾¿äººçœ¼åŒºåˆ†ä¸åŒçš„è¡Œã€‚ a2l æŒ‰è¡Œå½©è‰²è¾“å‡ºå‚æ•°ï¼Œæ–¹ä¾¿äººçœ¼æŸ¥çœ‹ã€‚ ap and rp æ‰¹é‡è½¬æ¢æ–‡ä»¶è·¯å¾„ä¸ºç»å¯¹è·¯å¾„/ç›¸å¯¹è·¯å¾„ï¼Œä¼šè‡ªåŠ¨è·Ÿè¸ªé“¾æŽ¥å¹¶è§„èŒƒåŒ–è·¯å¾„ã€‚ tcp-connection-state-counter ç»Ÿè®¡å„ä¸ªTCPè¿žæŽ¥çŠ¶æ€çš„ä¸ªæ•°ã€‚ç”¨äºŽæ–¹ä¾¿æŽ’æŸ¥ç³»ç»Ÿè¿žæŽ¥è´Ÿè·é—®é¢˜ã€‚ xpl and xpf åœ¨å‘½ä»¤è¡Œä¸­å¿«é€Ÿå®Œæˆ åœ¨æ–‡ä»¶æµè§ˆå™¨ä¸­ æ‰“å¼€/é€‰ä¸­ æŒ‡å®šçš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„æ“ä½œï¼Œä¼˜åŒ–å‘½ä»¤è¡Œä¸Žå…¶å®ƒåº”ç”¨ä¹‹é—´çš„æ“ä½œæµã€‚ Shellå¼€å‘/æµ‹è¯•åŠ å¼ºï¼š echo-args è¾“å‡ºè„šæœ¬æ”¶åˆ°çš„å‚æ•°ï¼Œåœ¨æŽ§åˆ¶å°è¿è¡Œæ—¶ï¼ŒæŠŠå‚æ•°å€¼æ‹¬èµ·çš„æ‹¬å·æ˜¾ç¤ºæˆ çº¢è‰²ï¼Œæ–¹ä¾¿äººçœ¼æŸ¥çœ‹ã€‚ç”¨äºŽè°ƒè¯•è„šæœ¬å‚æ•°è¾“å…¥ã€‚ console-text-color-themes.sh æ˜¾ç¤ºTerminatorçš„å…¨éƒ¨æ–‡å­—å½©è‰²ç»„åˆçš„æ•ˆæžœåŠå…¶æ‰“å°æ–¹å¼ï¼Œç”¨äºŽå¼€å‘Shellçš„å½©è‰²è¾“å‡ºã€‚ parseOpts.sh å‘½ä»¤è¡Œé€‰é¡¹è§£æžåº“ï¼ŒåŠ å¼ºæ”¯æŒé€‰é¡¹æœ‰å¤šä¸ªå€¼ï¼ˆå³æ•°ç»„ï¼‰ã€‚ :watch: VCSç›¸å…³è„šæœ¬ç›®å‰VCSçš„è„šæœ¬éƒ½æ˜¯svnåˆ†æ”¯ç›¸å…³çš„æ“ä½œã€‚ä½¿ç”¨æ›´çŽ°ä»£çš„Gitå§ï¼ :boom: å› ä¸ºä¸æŽ¨èä½¿ç”¨svnï¼Œè¿™é‡Œä¸å†åˆ—å‡ºæœ‰å“ªäº›è„šæœ¬äº†ï¼Œå¦‚æžœä½ æœ‰å…´è¶£å¯ä»¥ç‚¹ä¸Šé¢é“¾æŽ¥åŽ»çœ‹ã€‚]]></content>
      <categories>
        <category>shellè„šæœ¬</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[jvmå †å‚æ•°è°ƒæ•´]]></title>
    <url>%2F2018%2F05%2F13%2Fjvm%E5%A0%86%E5%8F%82%E6%95%B0%E8%B0%83%E6%95%B4%2F</url>
    <content type="text"><![CDATA[å¶ç„¶å‘çŽ°çº¿ä¸Šé€šè¿‡obeliskå‘å¸ƒçš„åº”ç”¨é»˜è®¤æ²¡æœ‰é…ç½®å †å¤§å°ç­‰jvmå‚æ•° ä¸‹é¢æ˜¯ç¤¾åŒºçš„ä¸€ä¸ªçº¿ä¸Šdubboåº”ç”¨çš„jvmå‚æ•°ï¼š 123-XX:CICompilerCount=3 -XX:InitialHeapSize=130023424 -XX:+ManagementServer -XX:MaxHeapSize=2063597568 -XX:MaxNewSize=687865856 -XX:MinHeapDeltaBytes=524288 -XX:NewSize=42991616 -XX:OldSize=87031808 -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGCæ³¨ï¼šè€ƒè™‘å®‰å…¨æ€§ï¼Œéƒ¨åˆ†æ•°æ®åˆ é™¤ é‡‡ç”¨é»˜è®¤å€¼ï¼Œæ–°ç”Ÿä»£åªæœ‰600å¤šMï¼Œå †åŒºæ€»å¤§å°ä¹Ÿåªæœ‰2ä¸ªG ç¤¾åŒºè¿™è¾¹çš„çº¿ä¸Šæœºå™¨åŸºæœ¬éƒ½æ˜¯æ ‡é…4æ ¸8Gï¼Œä¸Šé¢çš„é…ç½®å¤ªæµªè´¹ï¼Œå¦‚æžœæ´»åŠ¨æœŸé—´æœ‰è¾ƒé«˜å¹¶å‘é‡ï¼Œä¼°è®¡æ–°ç”Ÿä»£ä¼šä¸è¶³ï¼ŒæŒ¤åŽ‹è€å¹´ä»£ï¼ŒæŒç»­gcï¼Œå¾ˆå®¹æ˜“é›ªå´©ã€‚ çº¿ä¸Šjvmå‚æ•°è°ƒæ•´ 1-Xms5020m -Xmx5020m -Xmn2500m -XX:PermSize=96m -XX:MaxPermSize=256m -XX:ParallelGCThreads=4 -XX:+UseConcMarkSweepGC -XX:+UseCMSCompactAtFullCollection -XX:CMSMaxAbortablePrecleanTime=5000 -XX:+CMSClassUnloadingEnabled -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=80 ======================== ç”¨äº†ä¸¤å°çº¿ä¸Šæœºåšæµ‹è¯•ï¼Œé…ç½®ä¸€æ · 12192.168.16.116ï¼ˆå‚æ•°æœªè°ƒæ•´ï¼‰192.168.18.62 ï¼ˆå‚æ•°è°ƒæ•´ï¼‰ å‘å¸ƒä¸Šçº¿åŽï¼Œbetaäº†ä¸€å¤©ï¼Œå¯¹æ¯”ç»“æžœå¦‚ä¸‹ï¼š 192.168.16.116ï¼ˆæœªè°ƒæ•´å‚æ•°ï¼‰ï¼Œä¸€å¤©å‘ç”Ÿäº†YGC4000å¤šæ¬¡ï¼Œæ•´ä¸ªgcæ—¶é—´26s 192.168.18.62 ï¼ˆå‚æ•°è°ƒæ•´ï¼‰ï¼Œä¸€å¤©YGCåªæœ‰300å¤šæ¬¡ï¼Œæ•´ä¸ªgcæ—¶é—´åªæœ‰5s å¦‚æžœå¹¶å‘é‡å¤§çš„æƒ…å†µä¸‹ï¼Œä¼°è®¡è¿™ä¸ªå·®å¼‚ä¼šæ›´å¤§ï¼Œæ”¯æŒçš„æœ€å¤§QPSåº”è¯¥ä¼šæœ‰å¾ˆå¤§æå‡ï¼Œå¦‚æžœè¦å‡†ç¡®æ•°æ®çš„è¯å¯ä»¥æ€§èƒ½åŽ‹æµ‹å¯¹æ¯”ä¸‹]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaæœåŠ¡å™¨loadé£™é«˜æŽ’æŸ¥æ€è·¯]]></title>
    <url>%2F2018%2F05%2F13%2Fjava%E6%9C%8D%E5%8A%A1%E5%99%A8load%E9%A3%9A%E9%AB%98%E6%8E%92%E6%9F%A5%E6%80%9D%E8%B7%AF%2F</url>
    <content type="text"><![CDATA[Load æ˜¯æŒ‡å¯¹è®¡ç®—æœºå¹²æ´»å¤šå°‘çš„åº¦é‡ï¼ˆWikiPediaï¼šthe system load is a measure of the amount of work that a computer system is doingï¼‰ï¼Œç®€å•çš„è¯´æ˜¯è¿›ç¨‹é˜Ÿåˆ—çš„é•¿åº¦ã€‚Load Average å°±æ˜¯ä¸€æ®µæ—¶é—´ (1 åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿ) å†…å¹³å‡ Load é€šè¿‡uptimeå‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰çš„loadï¼Œå¦‚æžœå€¼å¾ˆé«˜ã€‚ä¸€èˆ¬æƒ…å†µæ˜¯javaæŸäº›çº¿ç¨‹é•¿æœŸå ç”¨èµ„æºã€æ­»é”ã€æ­»å¾ªçŽ¯ç­‰å¯¼è‡´æŸä¸ªè¿›ç¨‹å ç”¨çš„CPUèµ„æºè¿‡é«˜ã€‚å¤§è‡´å¯ä»¥ä»Žä»¥ä¸‹å‡ ä¸ªè§’åº¦æ¥æŽ’æŸ¥ï¼š 1.é¦–å…ˆé€šè¿‡jpså‘½ä»¤ï¼ŒæŸ¥çœ‹å½“å‰è¿›ç¨‹idï¼Œå¦‚idä¸º 28174 2.æŸ¥çœ‹è¯¥è¿›ç¨‹ä¸‹çš„çº¿ç¨‹èµ„æºä½¿ç”¨æƒ…å†µ 1top -p 28174 â€“H 1234567891011121314151632694 root 20 0 3249m 2.0g 11m S 2 6.4 3:31.12 java28175 root 20 0 3249m 2.0g 11m S 0 6.4 0:00.06 java28176 root 20 0 3249m 2.0g 11m S 0 6.4 1:40.79 java28177 root 20 0 3249m 2.0g 11m S 0 6.4 1:41.12 java28178 root 20 0 3249m 2.0g 11m S 0 6.4 1:41.11 java28179 root 20 0 3249m 2.0g 11m S 0 6.4 1:41.33 java28180 root 20 0 3249m 2.0g 11m S 0 6.4 1:41.58 java28181 root 20 0 3249m 2.0g 11m S 0 6.4 1:40.36 java28182 root 20 0 3249m 2.0g 11m S 0 6.4 1:41.02 java28183 root 20 0 3249m 2.0g 11m S 0 6.4 1:40.96 java28184 root 20 0 3249m 2.0g 11m S 0 6.4 4:38.30 java28185 root 20 0 3249m 2.0g 11m S 0 6.4 0:00.46 java28186 root 20 0 3249m 2.0g 11m S 0 6.4 0:01.83 java28187 root 20 0 3249m 2.0g 11m S 0 6.4 0:00.00 java28189 root 20 0 3249m 2.0g 11m S 0 6.4 0:00.01 java28190 root 20 0 3249m 2.0g 11m S 0 6.4 0:49.01 java 3.æ‰“å°JAVAè¿›ç¨‹28174çš„å †æ ˆä¿¡æ¯ 1jstack 28174 &gt;&gt; stack.log 4.å°†cpuæ¶ˆè€—é«˜çš„çº¿ç¨‹çš„pidæ¢ç®—ä¸º16è¿›åˆ¶ 1printf 0x%x 32694 è½¬æ¢åŽçš„16è¿›åˆ¶ä¸º 0x7fb6 5.ä»Žåˆšæ‰çš„æ ˆæ—¥å¿—ä¸­æŸ¥æ‰¾è¯¥çº¿ç¨‹æ­£åœ¨è¿è¡Œçš„æ–¹æ³• 1grep 0x7fb6 stack.log -a3 123456"MSXMLProcessorThread" prio=10 tid=0x00002b469923a800 [color=darkred]nid=0x7fb6[/color] sleeping[0x00002b46b0200000] java.lang.Thread.State: TIMED_WAITING (sleeping) at java.lang.Thread.sleep(Native Method) at com.adventnet.management.xml.MSXmlProcessor.listen(MSXmlProcessor.java:279) at com.adventnet.management.xml.MSXmlProcessor.run(MSXmlProcessor.java:264) at java.lang.Thread.run(Thread.java:619) 6.å¦å¤–ä¹Ÿå¯ä»¥æŸ¥æ‰¾æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼ŒåŠçº¿ç¨‹å¤„äºŽè¿è¡ŒçŠ¶æ€çš„ä½ç½®ï¼Œä»Žè¿™äº›çº¿ç¨‹ä¸­æ¥æŸ¥æ‰¾èµ„æºæ¶ˆè€—è¿‡é«˜çš„ä»£ç ã€‚ 1grep RUNNABLE stack.log -a1 1less a.log |awk '&#123;FS="java.lang.Thread.State:";print $2&#125;'|sort |uniq -c |sort -nr]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linuxå¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2018%2F05%2F13%2Flinux-commands%2F</url>
    <content type="text"><![CDATA[CPUç›¸å…³ã€è¿›ç¨‹æŸ¥çœ‹cpuç¡¬ä»¶é…ç½®1less /proc/cpuinfo 1234uname -a æŸ¥çœ‹å†…æ ¸/æ“ä½œç³»ç»Ÿ/CPUä¿¡æ¯head -n 1 /etc/issue æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬less /proc/cpuinfo æŸ¥çœ‹CPUä¿¡æ¯hostname æŸ¥çœ‹è®¡ç®—æœºå top å‘½ä»¤å®žæ—¶æ˜¾ç¤ºå„ç§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µåŠè¿›ç¨‹çŠ¶æ€ 1234567è¯¦ç»†å‘½ä»¤å‚æ•°ï¼šh: æ˜¾ç¤ºå¸®åŠ©cï¼šæ˜¾ç¤ºè¯¦ç»†çš„å‘½ä»¤å‚æ•°Mï¼šæŒ‰ç…§å ç”¨å†…å­˜å¤§å°ï¼ˆ%MEM åˆ—ï¼‰å¯¹è¿›ç¨‹æŽ’åºï¼›Pï¼šæŒ‰ç…§ CPU ä½¿ç”¨çŽ‡( %CPU åˆ—ï¼‰å¯¹è¿›ç¨‹æŽ’åºï¼›uï¼šæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·çš„è¿›ç¨‹ã€‚é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ï¼›Tï¼šæ ¹æ®ç´¯è®¡è¿è¡Œæ—¶é—´æŽ’åº 123456789ç¬¬ä¸€è¡Œï¼šå½“å‰æ—¶é—´ï¼šç³»ç»Ÿå·²è¿è¡Œæ—¶é—´ï¼š751å¤©ï¼Œç›®å‰4ä¸ªç”¨æˆ·ï¼Œ1ã€5ã€15åˆ†é’Ÿå†…çš„loadåˆ†åˆ«æ˜¯0.07ã€0.02 ã€0.00ç¬¬äºŒè¡Œï¼šè¿›ç¨‹æƒ…å†µï¼šæ€»å…±148ä¸ªï¼Œæ­£åœ¨è¿è¡Œçš„æœ‰2ä¸ªï¼Œä¼‘çœ æœ‰139ä¸ªï¼Œåƒµå°¸è¿›ç¨‹1ä¸ªç¬¬ä¸‰è¡Œï¼šcpuçš„ä½¿ç”¨æƒ…å†µï¼ˆæŒ‰æ•°å­—1æ˜¾ç¤ºæ‰€æœ‰cpuï¼‰ç¬¬å››è¡Œï¼šå†…å­˜æƒ…å†µï¼ˆbuffersè¡¨ç¤ºç”¨ä½œå†…æ ¸ç¼“å­˜çš„å†…å­˜é‡ï¼‰ç¬¬äº”è¡Œï¼šè™šæ‹Ÿå†…å­˜æƒ…å†µï¼ˆç³»ç»Ÿçš„ç‰©ç†å†…å­˜ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼ŒæŠŠç¡¬ç›˜ç©ºé—´ä¸­çš„ä¸€éƒ¨åˆ†ç©ºé—´é‡Šæ”¾å‡ºæ¥ï¼Œä»¥ä¾›å½“å‰è¿è¡Œçš„ç¨‹åºä½¿ç”¨ï¼‰ç¬¬å…­è¡Œï¼šè¿›ç¨‹idï¼Œè™šæ‹Ÿå†…å­˜ï¼Œé©»ç•™å†…å­˜ä½¿ç”¨ï¼Œcpuï¼Œå†…å­˜ä½¿ç”¨ç™¾åˆ†æ¯”ï¼Œè¿è¡Œæ—¶é—´,å‘½ä»¤å‚æ•°ç­‰ã€‚VIRTè¡¨ç¤ºè¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„å†…å­˜æ€»å¤§å°ï¼ŒVIRT=SWAP+RESï¼ŒåŒ…æ‹¬è¿™ä¸ªè¿›ç¨‹çœŸå®žä½¿ç”¨çš„å†…å­˜, æ˜ å°„è¿‡çš„æ–‡ä»¶, å’Œåˆ«çš„è¿›ç¨‹å…±äº«çš„å†…å­˜ç­‰ã€‚RESè¡¨ç¤ºè¿™ä¸ªè¿›ç¨‹çœŸå®žå ç”¨å†…å­˜çš„å¤§å°ï¼Œä¸€èˆ¬è¿™ä¸ªå€¼å’ŒJVMçš„å‚æ•°é…ç½®æœ‰å…³ï¼Œå¦‚æžœ%MEMä½¿ç”¨è¿‡é«˜åˆ™éœ€è¦å…³æ³¨SHRè¡¨ç¤ºå¯ä»¥å’Œåˆ«çš„è¿›ç¨‹å…±äº«çš„å†…å­˜å’Œåº“å¤§å°ã€‚ æŸä¸€ä¸ªè¿›ç¨‹ä¸‹çš„çº¿ç¨‹èµ„æºä½¿ç”¨æƒ…å†µï¼š 1top -p &#123;pid&#125; -H æŸ¥çœ‹ç³»ç»Ÿloadã€cpuèµ„æºçš„å…¶å®ƒå‘½ä»¤ 12345mpstat 1 ï¼ˆæ±‡æ€»çš„ï¼‰mpstat -P ALL 1 ï¼ˆæ±‡æ€»çš„+æ¯ä¸ªcpuçš„ï¼‰wuptimetop -H å’Œ ps -efL/ -Tel æ˜¾ç¤º çº¿ç¨‹ ç»Ÿè®¡ä¸€ä¸ªè¿›ç¨‹ä¸‹çš„çº¿ç¨‹æ•°123456789cat /proc/$&#123;pid&#125;/statusè¿”å›žï¼š...çœç•¥Threads: 74....çœç•¥å…¶å®ƒå‘½ä»¤ï¼štop -bH -d 3 -p &#123;pid&#125; pstree ï¼ˆä»¥æ ‘çŠ¶å›¾çš„æ–¹å¼å±•çŽ°è¿›ç¨‹ä¹‹é—´çš„æ´¾ç”Ÿå…³ç³»ï¼‰Linuxå‘½ä»¤å¤§å…¨ 12pstree -ppstree -p &#123;pid&#125; | wc -l pstack ï¼ˆæ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„æ ˆè·Ÿè¸ªï¼‰ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹ä¸€ä¸ªè¿›ç¨‹ä¸‹çš„çº¿ç¨‹æ€»æ•° 123pstack &#123;pid&#125;// è¾“å‡ºç¬¬ä¸€è¡Œpstack &#123;pid&#125; | head -1 æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹12ps -efps -ef|grep java 5ã€å¯¹äºŽJavaåº”ç”¨ä»Žæ“ä½œç³»ç»Ÿå±‚é¢è§‚å¯Ÿï¼Œå°±åªæœ‰è¿›ç¨‹å’Œçº¿ç¨‹ä¸¤ä¸ªæŒ‡æ ‡ï¼Œä»»ä½•ä¸œè¥¿åœ¨æ“ä½œç³»ç»Ÿå±‚é¢éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨çš„ï¼Œè¿›ç¨‹ä¹Ÿä¸ä¾‹å¤–ã€‚Linuxä¸Šéƒ¨ç½²ä¸€ä¸ªTomcatç¨‹åºäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹æ‰€æœ‰çš„ä¸œè¥¿éƒ½åœ¨è¿™ä¸ªç›®å½•ä¸‹ ll /proc/{pid}/ 12## å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„socketè¿žæŽ¥ll /proc/&#123;pid&#125;/fd | grep socket ulimit -a ï¼ˆæ˜¾ç¤ºå½“å‰çš„å„ç§ç”¨æˆ·è¿›ç¨‹é™åˆ¶ï¼‰linuxä¿®æ”¹max user processes limits 12345678910111213141516ulimit -acore file size (blocks, -c) 100data seg size (kbytes, -d) unlimitedfile size (blocks, -f) unlimitedpending signals (-i) 15237max locked memory (kbytes, -l) 64max memory size (kbytes, -m) unlimitedopen files (-n) 1024pipe size (512 bytes, -p) 8POSIX message queues (bytes, -q) 819200stack size (kbytes, -s) 8192cpu time (seconds, -t) unlimitedmax user processes (-u) 15237virtual memory (kbytes, -v) unlimitedfile locks (-x) unlimited 12345678910111213141516è¾“å‡ºçš„æ¯ä¸€è¡Œç”±èµ„æºåå­—ã€ï¼ˆå•ä½ï¼Œulimitå‘½ä»¤çš„å‚æ•°ï¼‰ã€è½¯é™åˆ¶ç»„æˆã€‚è¯¦ç»†è§£é‡Šï¼šå‚æ•° æè¿°core file size coreæ–‡ä»¶çš„æœ€å¤§å€¼ä¸º100 blocksï¼Œdata seg size è¿›ç¨‹çš„æ•°æ®æ®µå¯ä»¥ä»»æ„å¤§file size æ–‡ä»¶å¯ä»¥ä»»æ„å¤§pending signals æœ€å¤šæœ‰15237ä¸ªå¾…å¤„ç†çš„ä¿¡å·max locked memory ä¸€ä¸ªä»»åŠ¡é”ä½çš„ç‰©ç†å†…å­˜çš„æœ€å¤§å€¼ä¸º64kBmax memory size ä¸€ä¸ªä»»åŠ¡çš„å¸¸é©»ç‰©ç†å†…å­˜çš„æœ€å¤§å€¼open files ä¸€ä¸ªä»»åŠ¡æœ€å¤šå¯ä»¥åŒæ—¶æ‰“å¼€1024çš„æ–‡ä»¶pipe size ç®¡é“çš„æœ€å¤§ç©ºé—´ä¸º4096å­—èŠ‚POSIX message queues POSIXçš„æ¶ˆæ¯é˜Ÿåˆ—çš„æœ€å¤§å€¼ä¸º819200å­—èŠ‚stack size è¿›ç¨‹çš„æ ˆçš„æœ€å¤§å€¼ä¸º8192å­—èŠ‚cpu time è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´max user processes å½“å‰ç”¨æˆ·åŒæ—¶æ‰“å¼€çš„è¿›ç¨‹(åŒ…æ‹¬çº¿ç¨‹)çš„æœ€å¤§ä¸ªæ•°ä¸º15237virtual memory æ²¡æœ‰é™åˆ¶è¿›ç¨‹çš„æœ€å¤§åœ°å€ç©ºé—´file locks æ‰€èƒ½é”ä½çš„æ–‡ä»¶çš„æœ€å¤§ä¸ªæ•°æ²¡æœ‰é™åˆ¶ å†…å­˜ç›¸å…³vmstatVirtual Memory Statisticsï¼Œç»Ÿè®¡è¿›ç¨‹ã€å†…å­˜ã€ioã€cpuç­‰çš„æ´»åŠ¨ä¿¡æ¯ã€‚å¯¹äºŽå¤šCPUç³»ç»Ÿï¼Œvmstatæ‰“å°çš„æ˜¯æ‰€æœ‰CPUçš„å¹³å‡è¾“å‡º 12345678910111213141516171819202122procsr: è¿è¡Œé˜Ÿåˆ—ä¸­è¿›ç¨‹æ•°é‡b: ç­‰å¾…IOçš„è¿›ç¨‹æ•°é‡memoryswpd: ä½¿ç”¨è™šæ‹Ÿå†…å­˜å¤§å°free: å¯ç”¨å†…å­˜å¤§å°buff: ç”¨ä½œç¼“å†²çš„å†…å­˜å¤§å°cache: ç”¨ä½œç¼“å­˜çš„å†…å­˜å¤§å°swapsi: æ¯ç§’ä»Žäº¤æ¢åŒºå†™åˆ°å†…å­˜çš„å¤§å°so: æ¯ç§’ä»Žå†…å­˜å†™å…¥äº¤æ¢åŒºçš„å¤§å°iobi: æ¯ç§’è¯»å–çš„å—æ•°ï¼ˆçŽ°åœ¨çš„Linuxç‰ˆæœ¬å—çš„å¤§å°ä¸º1024bytesï¼‰bo: æ¯ç§’å†™å…¥çš„å—æ•°systemin: æ¯ç§’ä¸­æ–­æ•°ï¼ŒåŒ…æ‹¬æ—¶é’Ÿä¸­æ–­cs: æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ•°cpuï¼ˆä»¥ç™¾åˆ†æ¯”è¡¨ç¤ºï¼‰us: ç”¨æˆ·è¿›ç¨‹æ‰§è¡Œæ—¶é—´(user time)sy: ç³»ç»Ÿè¿›ç¨‹æ‰§è¡Œæ—¶é—´(system time)id: ç©ºé—²æ—¶é—´(åŒ…æ‹¬IOç­‰å¾…æ—¶é—´)wa: ç­‰å¾…IOæ—¶é—´ æ³¨æ„ï¼šæŽ’æŸ¥é—®é¢˜æ—¶ï¼Œè¦ç‰¹åˆ«å…³æ³¨rçš„å€¼ï¼Œå¦‚æžœé•¿æ—¶é—´è¶…è¿‡cpuæ ¸æ•°2å€ï¼Œè¯´æ˜Žç³»ç»Ÿçš„è´Ÿè½½å¾ˆé‡ï¼Œcpuå·²ç»æ— æ³•åŠæ—¶å¤„ç†å †ç§¯ä»»åŠ¡ã€‚ IOåŠç½‘ç»œç½‘ç»œåè®®OSI ä¸ƒå±‚æ¨¡åž‹ ï¼ˆåº”è¡¨ä¼šï¼Œä¼ ç½‘æ•°ç‰©ï¼‰ åº”ç”¨å±‚ APDUåº”ç”¨åè®®æ•°æ®å•å…ƒ åº”ç”¨åè®®æ•°æ®å•å…ƒ ç”¨æˆ·æŽ¥å£ è¡¨ç¤ºå±‚ PPDU æ•°æ®çš„è¡¨çŽ°å½¢å¼ï¼ŒåŽ‹ç¼©ã€åŠ å¯† ä¼šè¯å±‚ SPDU ä¼šè¯çš„ç®¡ç†ã€åŒæ­¥ ä¸Šä¸‰å±‚ï¼Œç»™ç”¨æˆ· ä¼ è¾“å±‚ TPDU TCP/UDP å¯é ä¸Žä¸å¯é çš„ä¼ è¾“ï¼Œç¡®å®šç«¯å£ ç½‘ç»œå±‚ IPåœ°å€ æŠ¥æ–‡ï¼Œæä¾›é€»è¾‘åœ°å€ï¼Œé€‰è·¯ç”± æ•°æ®é“¾è·¯å±‚ æˆå¸§ã€ç”¨MACåœ°å€è®¿é—®åª’ä»‹ ç‰©ç†å±‚ ç‰©ç†å±‚åè®® è®¾å¤‡ä¹‹é—´çš„æ¯”ç‰¹æµçš„ä¼ è¾“ã€ç‰©ç†æŽ¥å£ã€ç”µæ°”ç‰¹æ€§ç­‰ TCP/IP å››å±‚åè®®å¸¸ç”¨ç½‘ç»œå‘½ä»¤æ¸…ç†dnsç¼“å­˜ mac 1sudo dscacheutil -flushcache curlå‚è€ƒ http://aiezu.com/article/linux_curl_command.html -iè¾“å‡ºå“åº”å¤´å’Œå†…å®¹, -bè®¾ç½®cookieå†…å®¹ 1curl -i -b "TSESSIONID=K5PCUJM6W-NWH6793X36IPW7Y7QWSW3-868SY2XJ-YP6" https://portal.tongdun.cn/admin/acl/userManage.json?operationType=doSearch 12345curl -i -b "TSESSIONID=K5PCUJM6W-NWH6793X36IPW7Y7QWSW3-868SY2XJ-YP6" https://oceanus.tongdun.cn/PartnerAppSelect.json?operationType=doSelectMessagecurl -i http://login-dev.tongdun.cn:8081/userLogin.htm\?loginId\=asgard.pro.06@demo.com\&amp;password\=Tongdun123450curl -i https://login.tongdun.cn/userLogin.htm\?loginId\=asgard.pro.06@demo.com\&amp;password\=Tongdun123450 tsar â€“trafficï¼šæ˜¾ç¤ºç½‘ç»œå¸¦å®½netstat12# æŸ¥çœ‹ç«¯å£ï¼ŒåŠå…¶è¿›ç¨‹netstat -tunlp | grep 8088 1234# æ‰€æœ‰TCPé“¾æŽ¥netstat -nat# æŸ¥è¯¢dubboçš„é“¾æŽ¥ï¼Œæ€»æ•°netstat -nat | grep ip:20880 | wc -l ç»Ÿè®¡æ¯ä¸ªçŠ¶æ€çš„æ•°é‡ 1netstat -n | awk '/^tcp/ &#123;++state[$NF]&#125; END &#123;for(key in state) print key,"\t",state[key]&#125;' 123456TIME_WAIT 5856CLOSE_WAIT 268FIN_WAIT1 3ESTABLISHED 4837SYN_RECV 14CLOSING 1 12345-t tcp-u udp-n numericï¼Œä½¿ç”¨æ•°å­—æ˜¾ç¤ºï¼Œä¸ç”¨åˆ«å-l listening,æ­£åœ¨ç›‘å¬-p programs,æ˜¾ç¤ºpidå’Œåç§° ä¸€èˆ¬ç”¨äºŽæ£€éªŒæœ¬æœºå„ç«¯å£çš„ç½‘ç»œè¿žæŽ¥æƒ…å†µã€‚netstatæ˜¯åœ¨å†…æ ¸ä¸­è®¿é—®ç½‘ç»œåŠç›¸å…³ä¿¡æ¯çš„ç¨‹åºï¼Œå®ƒèƒ½æä¾›TCPè¿žæŽ¥ï¼ŒTCPå’ŒUDPç›‘å¬ï¼Œè¿›ç¨‹å†…å­˜ç®¡ç†çš„ç›¸å…³æŠ¥å‘Šã€‚ å‘½ä»¤å‚æ•°ï¼š 123456789101112131415161718192021222324-aæˆ–â€“all æ˜¾ç¤ºæ‰€æœ‰è¿žçº¿ä¸­çš„Socketã€‚-A&lt;ç½‘ç»œç±»åž‹&gt;æˆ–â€“&lt;ç½‘ç»œç±»åž‹&gt; åˆ—å‡ºè¯¥ç½‘ç»œç±»åž‹è¿žçº¿ä¸­çš„ç›¸å…³åœ°å€ã€‚-cæˆ–â€“continuous æŒç»­åˆ—å‡ºç½‘ç»œçŠ¶æ€ã€‚-Cæˆ–â€“cache æ˜¾ç¤ºè·¯ç”±å™¨é…ç½®çš„å¿«å–ä¿¡æ¯ã€‚-eæˆ–â€“extend æ˜¾ç¤ºç½‘ç»œå…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚-Fæˆ–â€“fib æ˜¾ç¤ºFIBã€‚-gæˆ–â€“groups æ˜¾ç¤ºå¤šé‡å¹¿æ’­åŠŸèƒ½ç¾¤ç»„ç»„å‘˜åå•ã€‚-hæˆ–â€“help åœ¨çº¿å¸®åŠ©ã€‚-iæˆ–â€“interfaces æ˜¾ç¤ºç½‘ç»œç•Œé¢ä¿¡æ¯è¡¨å•ã€‚-læˆ–â€“listening æ˜¾ç¤ºç›‘æŽ§ä¸­çš„æœåŠ¡å™¨çš„Socketã€‚-Mæˆ–â€“masquerade æ˜¾ç¤ºä¼ªè£…çš„ç½‘ç»œè¿žçº¿ã€‚-næˆ–â€“numeric ç›´æŽ¥ä½¿ç”¨IPåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨ã€‚-Næˆ–â€“netlinkæˆ–â€“symbolic æ˜¾ç¤ºç½‘ç»œç¡¬ä»¶å¤–å›´è®¾å¤‡çš„ç¬¦å·è¿žæŽ¥åç§°ã€‚-oæˆ–â€“timers æ˜¾ç¤ºè®¡æ—¶å™¨ã€‚-pæˆ–â€“programs æ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨Socketçš„ç¨‹åºè¯†åˆ«ç å’Œç¨‹åºåç§°ã€‚-ræˆ–â€“route æ˜¾ç¤ºRouting Tableã€‚-sæˆ–â€“statistice æ˜¾ç¤ºç½‘ç»œå·¥ä½œä¿¡æ¯ç»Ÿè®¡è¡¨ã€‚-tæˆ–â€“tcp æ˜¾ç¤ºTCPä¼ è¾“åè®®çš„è¿žçº¿çŠ¶å†µã€‚-uæˆ–â€“udp æ˜¾ç¤ºUDPä¼ è¾“åè®®çš„è¿žçº¿çŠ¶å†µã€‚-væˆ–â€“verbose æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ã€‚-Væˆ–â€“version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚-wæˆ–â€“raw æ˜¾ç¤ºRAWä¼ è¾“åè®®çš„è¿žçº¿çŠ¶å†µã€‚-xæˆ–â€“unix æ­¤å‚æ•°çš„æ•ˆæžœå’ŒæŒ‡å®šâ€-A unixâ€å‚æ•°ç›¸åŒã€‚â€“ipæˆ–â€“inet æ­¤å‚æ•°çš„æ•ˆæžœå’ŒæŒ‡å®šâ€-A inetâ€å‚æ•°ç›¸åŒã€‚ è¾“å‡ºç»“æžœï¼š 123456789101112131415161718ä¸€ä¸ªæ˜¯Active Internet connectionsï¼Œç§°ä¸ºæœ‰æºTCPè¿žæŽ¥ï¼Œå…¶ä¸­"Recv-Q"å’Œ"Send-Q"æŒ‡çš„æ˜¯æŽ¥æ”¶é˜Ÿåˆ—å’Œå‘é€é˜Ÿåˆ—ã€‚è¿™äº›æ•°å­—ä¸€èˆ¬éƒ½åº”è¯¥æ˜¯0ã€‚å¦‚æžœä¸æ˜¯åˆ™è¡¨ç¤ºè½¯ä»¶åŒ…æ­£åœ¨é˜Ÿåˆ—ä¸­å †ç§¯ã€‚è¿™ç§æƒ…å†µåªèƒ½åœ¨éžå¸¸å°‘çš„æƒ…å†µè§åˆ°ã€‚å¦ä¸€ä¸ªæ˜¯Active UNIX domain socketsï¼Œç§°ä¸ºæœ‰æºUnixåŸŸå¥—æŽ¥å£(å’Œç½‘ç»œå¥—æŽ¥å­—ä¸€æ ·ï¼Œä½†æ˜¯åªèƒ½ç”¨äºŽæœ¬æœºé€šä¿¡ï¼Œæ€§èƒ½å¯ä»¥æé«˜ä¸€å€)ã€‚Protoæ˜¾ç¤ºè¿žæŽ¥ä½¿ç”¨çš„åè®®,RefCntè¡¨ç¤ºè¿žæŽ¥åˆ°æœ¬å¥—æŽ¥å£ä¸Šçš„è¿›ç¨‹å·,Typesæ˜¾ç¤ºå¥—æŽ¥å£çš„ç±»åž‹,Stateæ˜¾ç¤ºå¥—æŽ¥å£å½“å‰çš„çŠ¶æ€,Pathè¡¨ç¤ºè¿žæŽ¥åˆ°å¥—æŽ¥å£çš„å…¶å®ƒè¿›ç¨‹ä½¿ç”¨çš„è·¯å¾„åã€‚çŠ¶æ€è¯´æ˜Žï¼šLISTENï¼šä¾¦å¬æ¥è‡ªè¿œæ–¹çš„TCPç«¯å£çš„è¿žæŽ¥è¯·æ±‚SYN-SENTï¼šå†å‘é€è¿žæŽ¥è¯·æ±‚åŽç­‰å¾…åŒ¹é…çš„è¿žæŽ¥è¯·æ±‚ï¼ˆå¦‚æžœæœ‰å¤§é‡è¿™æ ·çš„çŠ¶æ€åŒ…ï¼Œæ£€æŸ¥æ˜¯å¦ä¸­æ‹›äº†ï¼‰SYN-RECEIVEDï¼šå†æ”¶åˆ°å’Œå‘é€ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚åŽç­‰å¾…å¯¹æ–¹å¯¹è¿žæŽ¥è¯·æ±‚çš„ç¡®è®¤ï¼ˆå¦‚æœ‰å¤§é‡æ­¤çŠ¶æ€ï¼Œä¼°è®¡è¢«floodæ”»å‡»äº†ï¼‰ESTABLISHEDï¼šä»£è¡¨ä¸€ä¸ªæ‰“å¼€çš„è¿žæŽ¥FIN-WAIT-1ï¼šç­‰å¾…è¿œç¨‹TCPè¿žæŽ¥ä¸­æ–­è¯·æ±‚ï¼Œæˆ–å…ˆå‰çš„è¿žæŽ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤FIN-WAIT-2ï¼šä»Žè¿œç¨‹TCPç­‰å¾…è¿žæŽ¥ä¸­æ–­è¯·æ±‚CLOSE-WAITï¼šç­‰å¾…ä»Žæœ¬åœ°ç”¨æˆ·å‘æ¥çš„è¿žæŽ¥ä¸­æ–­è¯·æ±‚CLOSINGï¼šç­‰å¾…è¿œç¨‹TCPå¯¹è¿žæŽ¥ä¸­æ–­çš„ç¡®è®¤LAST-ACKï¼šç­‰å¾…åŽŸæ¥çš„å‘å‘è¿œç¨‹TCPçš„è¿žæŽ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤ï¼ˆä¸æ˜¯ä»€ä¹ˆå¥½ä¸œè¥¿ï¼Œæ­¤é¡¹å‡ºçŽ°ï¼Œæ£€æŸ¥æ˜¯å¦è¢«æ”»å‡»ï¼‰TIME-WAITï¼šç­‰å¾…è¶³å¤Ÿçš„æ—¶é—´ä»¥ç¡®ä¿è¿œç¨‹TCPæŽ¥æ”¶åˆ°è¿žæŽ¥ä¸­æ–­è¯·æ±‚çš„ç¡®è®¤CLOSEDï¼šæ²¡æœ‰ä»»ä½•è¿žæŽ¥çŠ¶æ€ æ‰¾å‡ºè¿è¡Œåœ¨æŒ‡å®šç«¯å£çš„è¿›ç¨‹ 12netstat -anpt | grep ':20130'netstat -nat | grep "172.16.49.161:20130" å…¶å®ƒä½¿ç”¨åœºæ™¯ 1234567netstat -nat |awk '&#123;print $6&#125;'|sort|uniq -c ä¸åŒç½‘ç»œçŠ¶æ€ç»“æžœç»Ÿè®¡netstat -anop | grep 6379 åº”ç”¨è¿žæŽ¥Redisæƒ…å†µnetstat -pt è¾“å‡ºä¸­æ˜¾ç¤º PID å’Œè¿›ç¨‹åç§°netstat -s æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯netstat -nu æ˜¾ç¤ºå½“å‰UDPè¿žæŽ¥çŠ¶å†µnetstat -nt æ˜¾ç¤ºå½“å‰TCPè¿žæŽ¥çŠ¶å†µnetstat -i æ˜¾ç¤ºç½‘å¡åˆ—è¡¨ 3ã€ iostatiostatæ˜¯I/O statisticsï¼ˆè¾“å…¥/è¾“å‡ºç»Ÿè®¡ï¼‰çš„ç¼©å†™ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯å¯¹ç³»ç»Ÿçš„ç£ç›˜I/Oæ“ä½œè¿›è¡Œç›‘è§†ã€‚å®ƒçš„è¾“å‡ºä¸»è¦æ˜¾ç¤ºç£ç›˜è¯»å†™æ“ä½œçš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿä¼šç»™å‡ºCPUä½¿ç”¨æƒ…å†µã€‚åŒvmstatä¸€æ ·ï¼Œiostatä¹Ÿä¸èƒ½å¯¹æŸä¸ªè¿›ç¨‹è¿›è¡Œæ·±å…¥åˆ†æžï¼Œä»…å¯¹ç³»ç»Ÿçš„æ•´ä½“æƒ…å†µè¿›è¡Œåˆ†æžã€‚ å‘½ä»¤å‚æ•°ï¼š 12345678910-c æ˜¾ç¤ºCPUä½¿ç”¨æƒ…å†µ-d æ˜¾ç¤ºç£ç›˜ä½¿ç”¨æƒ…å†µ-k ä»¥ KB ä¸ºå•ä½æ˜¾ç¤º-m ä»¥ M ä¸ºå•ä½æ˜¾ç¤º-N æ˜¾ç¤ºç£ç›˜é˜µåˆ—(LVM) ä¿¡æ¯-n æ˜¾ç¤ºNFS ä½¿ç”¨æƒ…å†µ-p[ç£ç›˜] æ˜¾ç¤ºç£ç›˜å’Œåˆ†åŒºçš„æƒ…å†µ-t æ˜¾ç¤ºç»ˆç«¯å’ŒCPUçš„ä¿¡æ¯-x æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯-V æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ è¾“å‡ºç»“æžœï¼š 1234567891011121314151617181920212223242526272829cpuå±žæ€§å€¼è¯´æ˜Žï¼š%userï¼šCPUå¤„åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚%niceï¼šCPUå¤„åœ¨å¸¦NICEå€¼çš„ç”¨æˆ·æ¨¡å¼ä¸‹çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚%systemï¼šCPUå¤„åœ¨ç³»ç»Ÿæ¨¡å¼ä¸‹çš„æ—¶é—´ç™¾åˆ†æ¯”ã€‚%iowaitï¼šCPUç­‰å¾…è¾“å…¥è¾“å‡ºå®Œæˆæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚%stealï¼šç®¡ç†ç¨‹åºç»´æŠ¤å¦ä¸€ä¸ªè™šæ‹Ÿå¤„ç†å™¨æ—¶ï¼Œè™šæ‹ŸCPUçš„æ— æ„è¯†ç­‰å¾…æ—¶é—´ç™¾åˆ†æ¯”ã€‚%idleï¼šCPUç©ºé—²æ—¶é—´ç™¾åˆ†æ¯”ã€‚å¤‡æ³¨ï¼šå¦‚æžœ%iowaitçš„å€¼è¿‡é«˜ï¼Œè¡¨ç¤ºç¡¬ç›˜å­˜åœ¨I/Oç“¶é¢ˆï¼Œ%idleå€¼é«˜ï¼Œè¡¨ç¤ºCPUè¾ƒç©ºé—²ï¼Œå¦‚æžœ%idleå€¼é«˜ä½†ç³»ç»Ÿå“åº”æ…¢æ—¶ï¼Œæœ‰å¯èƒ½æ˜¯CPUç­‰å¾…åˆ†é…å†…å­˜ï¼Œæ­¤æ—¶åº”åŠ å¤§å†…å­˜å®¹é‡ã€‚%idleå€¼å¦‚æžœæŒç»­ä½ŽäºŽ10ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„CPUå¤„ç†èƒ½åŠ›ç›¸å¯¹è¾ƒä½Žï¼Œè¡¨æ˜Žç³»ç»Ÿä¸­æœ€éœ€è¦è§£å†³çš„èµ„æºæ˜¯CPUã€‚diskå±žæ€§å€¼è¯´æ˜Žï¼šï¼ˆiostat -xï¼‰rrqm/s: æ¯ç§’è¿›è¡Œ merge çš„è¯»æ“ä½œæ•°ç›®ã€‚å³ rmerge/swrqm/s: æ¯ç§’è¿›è¡Œ merge çš„å†™æ“ä½œæ•°ç›®ã€‚å³ wmerge/sr/s: æ¯ç§’å®Œæˆçš„è¯» I/O è®¾å¤‡æ¬¡æ•°ã€‚å³ rio/sw/s: æ¯ç§’å®Œæˆçš„å†™ I/O è®¾å¤‡æ¬¡æ•°ã€‚å³ wio/srsec/s: æ¯ç§’è¯»æ‰‡åŒºæ•°ã€‚å³ rsect/swsec/s: æ¯ç§’å†™æ‰‡åŒºæ•°ã€‚å³ wsect/srkB/s: æ¯ç§’è¯»Kå­—èŠ‚æ•°ã€‚æ˜¯ rsect/s çš„ä¸€åŠï¼Œå› ä¸ºæ¯æ‰‡åŒºå¤§å°ä¸º512å­—èŠ‚ã€‚wkB/s: æ¯ç§’å†™Kå­—èŠ‚æ•°ã€‚æ˜¯ wsect/s çš„ä¸€åŠã€‚avgrq-sz: å¹³å‡æ¯æ¬¡è®¾å¤‡I/Oæ“ä½œçš„æ•°æ®å¤§å° (æ‰‡åŒº)ã€‚avgqu-sz: å¹³å‡I/Oé˜Ÿåˆ—é•¿åº¦ã€‚await: å¹³å‡æ¯æ¬¡è®¾å¤‡I/Oæ“ä½œçš„ç­‰å¾…æ—¶é—´ (æ¯«ç§’)ã€‚svctm: å¹³å‡æ¯æ¬¡è®¾å¤‡I/Oæ“ä½œçš„æœåŠ¡æ—¶é—´ (æ¯«ç§’)ã€‚%util: ä¸€ç§’ä¸­æœ‰ç™¾åˆ†ä¹‹å¤šå°‘çš„æ—¶é—´ç”¨äºŽ I/O æ“ä½œï¼Œå³è¢«ioæ¶ˆè€—çš„cpuç™¾åˆ†æ¯”å¤‡æ³¨ï¼šå¦‚æžœ %util æŽ¥è¿‘ 100%ï¼Œè¯´æ˜Žäº§ç”Ÿçš„I/Oè¯·æ±‚å¤ªå¤šï¼ŒI/Oç³»ç»Ÿå·²ç»æ»¡è´Ÿè·ï¼Œè¯¥ç£ç›˜å¯èƒ½å­˜åœ¨ç“¶é¢ˆã€‚å¦‚æžœ svctm æ¯”è¾ƒæŽ¥è¿‘ awaitï¼Œè¯´æ˜Ž I/O å‡ ä¹Žæ²¡æœ‰ç­‰å¾…æ—¶é—´ï¼›å¦‚æžœ await è¿œå¤§äºŽ svctmï¼Œè¯´æ˜ŽI/O é˜Ÿåˆ—å¤ªé•¿ï¼Œioå“åº”å¤ªæ…¢ï¼Œåˆ™éœ€è¦è¿›è¡Œå¿…è¦ä¼˜åŒ–ã€‚å¦‚æžœavgqu-szæ¯”è¾ƒå¤§ï¼Œä¹Ÿè¡¨ç¤ºæœ‰å½“é‡ioåœ¨ç­‰å¾…ã€‚ å®šæ—¶æ˜¾ç¤ºæ‰€æœ‰ä¿¡æ¯ï¼ˆæ¯éš” 2ç§’åˆ·æ–°æ˜¾ç¤ºï¼Œä¸”æ˜¾ç¤º3æ¬¡ï¼‰ 1iostat 2 3 ä»¥kBä¸ºå•ä½æ˜¾ç¤ºæ‰€æœ‰ä¿¡æ¯ 1iostat -k 3 4ã€traceroute1traceroute www.baidu.com 5ã€telnet é€€å‡ºï¼Œctrl+] å‡ºçŽ°telnetåŽï¼Œå†è¾“å…¥quit æ–‡ä»¶lsof (ä¸€åˆ‡çš†æ–‡ä»¶)å‘½ä»¤è¯¦æƒ… æŸ¥çœ‹ä½ è¿›ç¨‹å¼€æ‰“çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£(TCPã€UDP) 12// æŸ¥çœ‹sys.logæ–‡ä»¶è¢«å“ªä¸ªè¿›ç¨‹æ‰“å¼€lsof sys.log 12// æŸ¥çœ‹ç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨lsof -iï¼šç«¯å£å· 12// æŸ¥çœ‹å„ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æ•°é‡lsof -n |awk '&#123;print $2&#125; " " $3'|sort|uniq -c |sort -nr|more df123df -hldf -h æŸ¥çœ‹ç£ç›˜çš„ä½¿ç”¨æƒ…å†µç£ç›˜çš„ä½¿ç”¨æƒ…å†µ du12du -hlå½“å‰ç›®å½•ä¸‹çš„æœ€å¶å­ç›®å½•çš„å¤§å° 12du -sch *å½“å‰ç›®å½•ä¸‹çš„å„ç›®å½•çš„å¤§å° findæ–‡ä»¶æŸ¥æ‰¾ 1234567891011121314151617181920212223find . -name "*è™è ä¾ *"# æ‰¾å‡ºå½“å‰ç›®å½•ä»¥åŠå…¶æ‰€æœ‰å­ç›®å½•ä¸‹æ‰€æœ‰åå­—ä¸­åŒ…å«â€œè™è ä¾ â€ä¸‰å­—çš„æ–‡ä»¶find . -inmae '*hello*' -maxdepth 1ä¸åŒºåˆ†å¤§å°å†™ï¼Œåœ¨å½“å‰ç›®å½•æŸ¥æ‰¾ï¼Œä¸åŒ…æ‹¬å­ç›®å½•find . -name "*.rmvb" -maxdepth 1# æ‰¾å‡ºå½“å‰ç›®å½•ï¼ˆä¸åŒ…æ‹¬å­ç›®å½•ï¼‰ä¸‹æ‰€æœ‰åå­—ä¸­åŽç¼€ä¸º".rmvb"çš„æ–‡ä»¶find . -name sys.logå½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾sys.logæ–‡ä»¶find . -name "sy*log"æŸ¥æ‰¾æ–‡ä»¶æ”¯æŒé€šé…ç¬¦find . -size +20MæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹å¤§å°è¶…è¿‡20Mçš„æ–‡ä»¶find . -size +20M | xargs ls -lhæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹å¤§å°è¶…è¿‡20Mçš„æ–‡ä»¶ï¼Œå¹¶è®¡ç®—æ–‡ä»¶å¤§å°find -type f -printf '%s %p\n' |sort -nr | headæŸ¥æ‰¾å ç”¨ç©ºé—´æœ€å¤§çš„10ä¸ªæ–‡ä»¶ grep12345--é€’å½’æŸ¥æ‰¾ç›®å½•ä¸‹å«æœ‰è¯¥å­—ç¬¦ä¸²çš„æ‰€æœ‰æ–‡ä»¶grep -rn "data_chushou_pay_info" /home/hadoop/nisj/automationDemand/--æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹åŽç¼€åè¿‡æ»¤çš„æ–‡ä»¶grep -rn "data_chushou_pay_info" *.py tailä»ŽæŒ‡å®šç‚¹å¼€å§‹å°†æ–‡ä»¶æ ‡å‡†è¾“å‡º æ˜¾ç¤ºæ–‡ä»¶æœ€åŽ5è¡Œå†…å®¹ 1tail -n 5 test.log å®žæ—¶æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ 1tail -f test.log 12ping baidu.com &gt; 1.txt &amp;åŽå°ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼ï¼Œå°†pingå‘½ä»¤çš„è¿”å›žç»“æžœå†™å…¥ 1.txt awk12# æ¯è¡ŒæŒ‰ç©ºæ ¼æˆ–TABåˆ†å‰²ï¼Œè¾“å‡ºæ–‡æœ¬ä¸­çš„1ã€4é¡¹ awk '&#123;print $1,$4&#125;' log.txt dirnameåœ¨å‘½ä»¤è¡ŒçŠ¶æ€ä¸‹å•çº¯æ‰§è¡Œ1cd `dirname $0` æ˜¯æ¯«æ— æ„ä¹‰çš„ã€‚ å› ä¸ºä»–è¿”å›žå½“å‰è·¯å¾„çš„â€.â€ã€‚è¿™ä¸ªå‘½ä»¤å†™åœ¨è„šæœ¬æ–‡ä»¶é‡Œæ‰æœ‰ä½œç”¨ï¼Œä»–è¿”å›žè¿™ä¸ªè„šæœ¬æ–‡ä»¶æ”¾ç½®çš„ç›®å½•ï¼Œå¹¶å¯ä»¥æ ¹æ®è¿™ä¸ªç›®å½•æ¥å®šä½æ‰€è¦è¿è¡Œç¨‹åºçš„ç›¸å¯¹ä½ç½®ï¼ˆç»å¯¹ä½ç½®é™¤å¤–ï¼‰ã€‚ å‚è€ƒ/Users/zhouxiaowu/Dropbox/commonShell è¿è¡Œ dirnameDemo.sh 1234BASE_DIR=`dirname $0`echo $BASE_DIRcd `dirname $0`echo `pwd` è¿è¡Œç»“æžœ: 12./Users/zhouxiaowu/Dropbox/commonShell è¿™æ ·å°±å¯ä»¥çŸ¥é“ä¸€äº›å’Œè„šæœ¬ä¸€èµ·éƒ¨ç½²çš„æ–‡ä»¶çš„ä½ç½®äº†ï¼Œåªè¦çŸ¥é“ç›¸å¯¹ä½ç½®å°±å¯ä»¥æ ¹æ®è¿™ä¸ªç›®å½•æ¥å®šä½ï¼Œè€Œå¯ä»¥ä¸ç”¨å…³å¿ƒç»å¯¹ä½ç½®ã€‚è¿™æ ·è„šæœ¬çš„å¯ç§»æ¤æ€§å°±æé«˜äº†ï¼Œæ‰”åˆ°ä»»ä½•ä¸€å°æœåŠ¡å™¨ï¼Œï¼ˆå¦‚æžœæ˜¯éƒ¨ç½²è„šæœ¬ï¼‰éƒ½å¯ä»¥æ‰§è¡Œã€‚ sed1sed [-hnV][-e&lt;script&gt;][-f&lt;scriptæ–‡ä»¶&gt;][æ–‡æœ¬æ–‡ä»¶] å‚æ•°è¯´æ˜Ž12345- -e&lt;script&gt;æˆ–--expression=&lt;script&gt; ä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„scriptæ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ã€‚- -f&lt;scriptæ–‡ä»¶&gt;æˆ–--file=&lt;scriptæ–‡ä»¶&gt; ä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„scriptæ–‡ä»¶æ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ã€‚- -hæˆ–--help æ˜¾ç¤ºå¸®åŠ©ã€‚- -næˆ–--quietæˆ–--silent ä»…æ˜¾ç¤ºscriptå¤„ç†åŽçš„ç»“æžœã€‚- -Væˆ–--version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚ åŠ¨ä½œè¯´æ˜Ž123456- a ï¼šæ–°å¢žï¼Œ a çš„åŽé¢å¯ä»¥æŽ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºçŽ°(ç›®å‰çš„ä¸‹ä¸€è¡Œ)ï½ž- c ï¼šå–ä»£ï¼Œ c çš„åŽé¢å¯ä»¥æŽ¥å­—ä¸²ï¼Œè¿™äº›å­—ä¸²å¯ä»¥å–ä»£ n1,n2 ä¹‹é—´çš„è¡Œï¼- d ï¼šåˆ é™¤ï¼Œå› ä¸ºæ˜¯åˆ é™¤å•Šï¼Œæ‰€ä»¥ d åŽé¢é€šå¸¸ä¸æŽ¥ä»»ä½•å’šå’šï¼›- i ï¼šæ’å…¥ï¼Œ i çš„åŽé¢å¯ä»¥æŽ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºçŽ°(ç›®å‰çš„ä¸Šä¸€è¡Œ)ï¼›- p ï¼šæ‰“å°ï¼Œäº¦å³å°†æŸä¸ªé€‰æ‹©çš„æ•°æ®å°å‡ºã€‚é€šå¸¸ p ä¼šä¸Žå‚æ•° sed -n ä¸€èµ·è¿è¡Œï½ž- s ï¼šå–ä»£ï¼Œå¯ä»¥ç›´æŽ¥è¿›è¡Œå–ä»£çš„å·¥ä½œï¼Œé€šå¸¸è¿™ä¸ª s çš„åŠ¨ä½œå¯ä»¥æ­é…æ­£è§„è¡¨ç¤ºæ³•ï¼ä¾‹å¦‚ 1,20s/old/new/g å°±æ˜¯å•¦ï¼ æ‰¹é‡æ›¿æ¢æ–‡ä»¶å†…å®¹12345æ ¼å¼: sed -i "s/æŸ¥æ‰¾å­—æ®µ/æ›¿æ¢å­—æ®µ/g" `grep æŸ¥æ‰¾å­—æ®µ -rl è·¯å¾„`ï¼ˆcentosæµ‹è¯•æœ‰æ•ˆï¼Œmacæœªç”Ÿæ•ˆï¼‰æ›¿æ¢/root/testç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œbookæ›¿æ¢ä¸ºapple sed -i "s/book/apple/g" `grep book -rl /root/test` åœ¨testfileæ–‡ä»¶çš„ç¬¬å››è¡ŒåŽæ·»åŠ ä¸€è¡Œ 1sed -e 4a\newLine testfile å…¨éƒ¨æ›¿æ¢ï¼Œå¹¶ä¸ä¼šæ”¹å˜æ–‡ä»¶å†…å®¹ 123sed 's/book/books/g' filesed -e 's/book/books/g' file ä»Žç¬¬2å¤„å¼€å§‹æ›¿æ¢ 1echo sksksksksksk | sed 's/sk/SK/2g' åˆ—å°è¡Œå·ï¼ŒåŒæ—¶ï¼Œè¯·å°†ç¬¬ 2~5 è¡Œåˆ é™¤ 1nl /etc/passwd | sed '2,5d' åªè¦åˆ é™¤ç¬¬ 2 è¡Œ 1nl /etc/passwd | sed '2d' è¦åˆ é™¤ç¬¬ 3 åˆ°æœ€åŽä¸€è¡Œ 1nl /etc/passwd | sed '3,$d' ç”¨æˆ·123456w æŸ¥çœ‹æ´»åŠ¨ç”¨æˆ·id &lt;ç”¨æˆ·å&gt; æŸ¥çœ‹æŒ‡å®šç”¨æˆ·ä¿¡æ¯last æŸ¥çœ‹ç”¨æˆ·ç™»å½•æ—¥å¿—cut -d: -f1 /etc/passwd æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰ç”¨æˆ·cut -d: -f1 /etc/group æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰ç»„crontab -l æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡ å‘½ä»¤è¡Œæ“ä½œ123ctrl+a è·³åˆ°è¡Œé¦–ctrl+e è·³åˆ°è¡Œå°¾ctrl+u åˆ é™¤æ•´è¡Œ è¾“å‡ºé‡å®šå‘123456789101112date &gt; test.log æ ‡å‡†è¾“å‡ºè¦†ç›–æ–¹å¼date &gt;&gt; test.log æ ‡å‡†è¾“å‡ºè¿½åŠ æ–¹å¼datea 2&gt;test.log é”™è¯¯è¾“å‡ºè¦†ç›–æ–¹å¼ï¼Œ&gt;åŽè¦ç´§æŒ¨ç€æ–‡ä»¶datea 2&gt;&gt;test.log é”™è¯¯è¾“å‡ºè¿½åŠ æ–¹å¼,&gt;åŽè¦ç´§æŒ¨ç€æ–‡ä»¶ifconfig &gt;&gt; test.log 2&gt;&amp;1 å¦‚æžœæ˜¯æ­£ç¡®è¾“å‡ºç•™ç©ºæ ¼ï¼Œé”™è¯¯è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼Œç´§æŒ¨ç€ifconfig &amp;&gt;&gt; test.log ä»¥è¿½åŠ çš„æ–¹å¼ï¼Œé”™è¯¯å’Œæ­£ç¡®éƒ½è¾“å‡ºåˆ°æ–‡ä»¶ifconfig &gt;&gt; æ–‡ä»¶1 2&gt;&gt;æ–‡ä»¶2 ä»¥è¿½åŠ çš„æ–¹å¼ï¼Œæ­£ç¡®å’Œé”™è¯¯åˆ†åˆ«åˆ°ä¸åŒçš„æ–‡ä»¶ls &amp;&gt;/dev/null æ­£ç¡®å’Œé”™è¯¯éƒ½åˆ°null è¾“å…¥é‡å®šå‘ wcå‘½ä»¤ï¼Œè¾“å®Œï¼Œctrl+d ç»Ÿè®¡ wc &lt; test.log ç»Ÿè®¡æ–‡ä»¶çš„è¡Œã€å•è¯ã€å­—ç¬¦ ç®¡é“ç¬¦é€»è¾‘ä¸Žæˆ–12345678910date ; ls ; åˆ†å·ï¼Œé¡ºåºæ‰§è¡Œls &amp;&amp; date å‘½ä»¤1 &amp;&amp; å‘½ä»¤2 å‘½ä»¤1æ­£ç¡®æ‰§è¡Œï¼Œæ‰ä¼šæ‰§è¡Œ2ll || date å‘½ä»¤1æ­£ç¡®æ‰§è¡Œï¼Œå‘½ä»¤2ä¸ä¼šæ‰§è¡Œlsasdfsf &amp;&amp; echo "yes" || echo "no" åˆ¤æ–­å‘½ä»¤æ˜¯å¦æ­£ç¡®ls || echo "no" &amp;&amp; echo "yes" ç­‰åŒäºŽ ï¼ˆls || echo "no"ï¼‰ &amp;&amp; echo "yes" ç®¡é“ç¬¦12ll | morenetstat -an | grep ESTABLISHED | wc -l ç»Ÿè®¡å¤šå°‘è¡Œ ç»Ÿé…ç¬¦123456ls aa* * 0æˆ–å¤šä¸ªå­—ç¬¦ls aa? ä¸€ä¸ªls aa[0-9] ä¸€ä¸ªé€‰é¡¹ls aa[0-9][0-9]ls aa[^0-9] å–éžls aa[^0-9]* å˜é‡ï¼Œåå¼•å·ï¼Œ$()1234aa=123echo $aa è¾“å‡º123echo "$aa" 123echo '$aa' '$aa' 12aa=`ls` åå¼•å·ï¼Œå…ˆæ‰§è¡Œç»“æžœï¼Œå†èµ‹å€¼å˜é‡echo $aa $() å•å°æ‹¬å·12aa=$(ls) å’Œåå¼•å·ä¸€æ ·ï¼Œå…ˆæ‰§è¡Œç»“æžœï¼Œå†èµ‹å€¼å˜é‡echo $aa shellè„šæœ¬æŸ¥å½“å‰è„šæœ¬æ‰€åœ¨è·¯å¾„1script_pwd = $( cd $(dirname $0) &amp;&amp; pwd ) æ¡ä»¶åˆ¤æ–­æ–‡ä»¶å­˜åœ¨ã€æƒé™åˆ¤æ–­ [ ]1234567-d æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸ºç›®å½•-e æ–‡ä»¶æ˜¯å¦å­˜åœ¨-f æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸ºæ–‡ä»¶-r æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæœ‰è¯»æƒé™ ä¸ä¼šåŒºåˆ†å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è¯»æƒé™-w æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæœ‰å†™æƒé™-x æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæœ‰å¯æ‰§è¡Œæƒé™ [] åœ¨shellä¸­æ˜¯ä¸ªå‘½ä»¤ï¼Œå®ƒå·¦å³å¿…é¡»æœ‰ç©ºæ ¼,æ‰èƒ½è¯†åˆ«é‡Œé¢çš„å­—ç¬¦ä¸² 123[ -f hello.sh ] &amp;&amp; echo "yes" || echo "no" æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ æ³¨æ„ä¸èƒ½é¢ å€’ &amp;&amp; || é¡ºåº[ -w hello.sh ] &amp;&amp; echo "yes" || echo "no" æ–‡ä»¶æ¯”è¾ƒ123-nf æ–°-ef ç›¸åŒ-of æ—§ 1[ ./hello.sh -ef ./hello.sh ] &amp;&amp; echo yes || echo no ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ç›¸åŒ æ•´æ•°æ¯”è¾ƒ123456-eq ç›¸ç­‰-ne ä¸ç­‰-gt å¤§äºŽ-lt å°äºŽ-ge å¤§äºŽç­‰äºŽ-le å°äºŽç­‰äºŽ 1[ 23 -ge 22 ] &amp;&amp; echo yes || echo no æ•´æ•°æ¯”è¾ƒ å­—ç¬¦ä¸²æ¯”è¾ƒ1234-z ä¸ºç©º-n ä¸ä¸ºç©º== ç›¸ç­‰!= ä¸ç­‰ 12name=hhh[ -n "$name" ] &amp;&amp; echo yes || echo no ä¸ä¸ºç©ºï¼Œè¾“å‡ºyes 123aa=22 ; bb=22[ "$aa"=="$bb" ] &amp;&amp; echo yes || echo no å­—ç¬¦ä¸²æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰[ "$aa" -eq "$bb" ] &amp;&amp; echo yes || echo no æ•°å€¼æ•´æ•°æ¯”è¾ƒ ä¸Žæˆ–éžæ¡ä»¶123-a ä¸Ž-o æˆ–! éž 12aa=11[ -n "$aa" -a "$aa" -gt 23 ] &amp;&amp; echo yes || echo no å­—ç¬¦ä¸²ä¸ä¸ºç©ºï¼Œæ•°å€¼å¤§äºŽ23ï¼Œè¾“å‡ºyes ifè¯­å¥å•åˆ†æ”¯ 12345678910if [ æ¡ä»¶ ] ï¼›then ç¨‹åºfiæˆ–è€… ï¼Œ [] ç­‰äºŽ testif [ æ¡ä»¶ ] then ç¨‹åºfi åˆ¤æ–­å½“å‰ç”¨æˆ· Dropbox/commonShell/isZhouxiaowu.sh 123456789101112#!/bin/bash#åˆ¤æ–­æ˜¯å¦zhouxiaowuç”¨æˆ·#èŽ·å–å½“å‰çš„ç”¨æˆ·åu=$(env | grep USER= | cut -d "=" -f 2)echo $u#åˆ¤æ–­æ˜¯å¦ç­‰äºŽzhouxiaowuif [ "$u" == "zhouxiaowu" ] ; then echo "yes is zhouxiaowu!"fi èŽ·å–ç£ç›˜ä½¿ç”¨é‡ï¼Œåšå‘Šè­¦Dropbox/commonShell/diskWarning.sh 123456789#!/bin/bash#èŽ·å–ç£ç›˜çš„ä½¿ç”¨é‡ï¼ŒawkèŽ·å–ç¬¬5ä¸ªå•è¯ï¼ŒcutæŒ‰%å­—ç¬¦åˆ†éš”ï¼Œå–ç¬¬1ä¸ªamount=$(df -h | grep disk1 | awk '&#123;print $5&#125;' | cut -d "%" -f 1)echo $amountif [ $amount -gt 90 ] ; then echo "ç£ç›˜ä½¿ç”¨é‡è¶…è¿‡90%"fi åŒåˆ†æ”¯ 123456if [ æ¡ä»¶ ] then æ‰§è¡Œè¯­å¥ else æ‰§è¡Œè¯­å¥fi åˆ¤è¯»æ˜¯å¦ç›®å½•Dropbox/commonShell/isDir.sh 12345678910111213#!/bin/bash# è¾“å…¥è¯»å–read -t 30 -p "æ–‡ä»¶åï¼š" dir# echo $dir# åˆ¤æ–­æ˜¯å¦ç›®å½•if [ -d "$dir" ] then echo " is dir" else echo " is not dir"fi åˆ¤æ–­tomcatæ˜¯å¦å¯åŠ¨ Dropbox/commonShell/isTomcatStarted.sh å¤šåˆ†æ”¯ 123456789if [ æ¡ä»¶1 ] then æ‰§è¡Œè¯­å¥elif [ æ¡ä»¶2 ] then æ‰§è¡Œè¯­å¥else æ‰§è¡Œè¯­å¥fi 1echo $? è¾“å‡ºè„šæœ¬çš„exit è¿”å›ž caseè¯­å¥12345678910case $å˜é‡ in "å€¼1") æ‰§è¡Œè¯­å¥ ;; "å€¼2") æ‰§è¡Œè¯­å¥ ;; *) é»˜è®¤è¯­å¥esac forè¯­å¥1234for å˜é‡ in å€¼1 å€¼2 å€¼3 ... do æ‰§è¡Œè¯­å¥ done 1234for(( i=0;i&lt;=100;i=i+1 )) do æ‰§è¡Œè¯­å¥ done å†™åœ¨ä¸€è¡Œ 1for i in ` seq 10000 `; do echo "hello sxt $i" &gt;&gt; test.txt;done æ‰¹é‡è§£åŽ‹æ–‡ä»¶ Dropbox/commonShell/for_tar.sh 1234567891011121314#!/bin/bashcd /Users/zhouxiaowu/install/test_tarls *.tar.gz &gt; ls.logls *.tgz &gt;&gt; ls.logfor i in $( cat ls.log ) do echo "file is $i" tar -zxf $i &gt; /dev/null 2&gt;&amp;1 donerm ls.log æ³¨æ„ i ä¸éœ€è¦ $ï¼Œå¼•ç”¨å˜é‡æ‰éœ€è¦ï¼Œå®šä¹‰å’Œèµ‹å€¼å˜é‡ä¸éœ€è¦ 1åˆ°100æ±‚å’Œ 12345678910#!/bin/bashs=0for(( i=0;i&lt;=100;i=i+1 )) do s=$(( $s+$i )) doneecho $s whileè¯­å¥1234while [ æ¡ä»¶è¯­å¥ ] do æ‰§è¡Œè¯­å¥ done 1åˆ°100æ±‚å’Œ 123456789101112#!/bin/bashi=1s=0while [ $i -le 100 ] do s=$(( $s+$i )) i=$(( $i+1 )) doneecho $s æ³¨æ„èµ‹å€¼ s=$(( $s+$i )) untilè¯­å¥ æ¡ä»¶ä¸æˆç«‹æ‰§è¡Œ 1234until [ æ¡ä»¶è¯­å¥ ] do æ‰§è¡Œè¯­å¥ done 1234567891011121314#!/bin/bash# ä»Ž1åˆ°100æ±‚å’Œs=0i=1until [ $i -gt 100 ] do s=$(( $s+$i )) i=$(( $i+1 )) doneecho "the sum is $s" å˜é‡1env æŸ¥çœ‹çŽ¯å¢ƒå˜é‡ 123bashbashpstree æŸ¥çœ‹pstree 1234#ç³»ç»Ÿä¸‹çš„æ‰€æœ‰å˜é‡setset -u æŠ¥é”™æç¤ºunset aa åˆ é™¤å˜é‡ 1234567# ä¸èƒ½æœ‰ç©ºæ ¼# å­—æ¯å’Œä¸‹åˆ’çº¿å¼€å¤´ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ç»„æˆ# è‡ªå®šä¹‰å˜é‡åªå¯¹å½“å‰shellç”Ÿæ•ˆx=5# å˜é‡è°ƒç”¨echo $x PATHçŽ¯å¢ƒå˜é‡ PS1çŽ¯å¢ƒå˜é‡ 12âžœ ~ echo $PS1$&#123;ret_status&#125; %&#123;$fg[cyan]%&#125;%c%&#123;$reset_color%&#125; $(git_prompt_info) å˜é‡å åŠ 1234x=123# ä¸€èˆ¬ç”¨è¿™ç§x="$x"456x=$(x)789 $@,$0,$1,$2çš„å«ä¹‰è§£é‡Š1$? æœ€åŽè¿è¡Œçš„å‘½ä»¤çš„ç»“æŸä»£ç ï¼ˆè¿”å›žå€¼ï¼‰ï¼Œæ­£ç¡®ä¸º0,ä¸ç¡®å®šéž0 12345$$ æŸ¥çœ‹Shellæœ¬èº«çš„PID$! æŸ¥çœ‹ShellåŽå°Processçš„PID#!/bin/bashecho "pid is $$" 1234567$0 Shellæœ¬èº«çš„æ–‡ä»¶å$1ï½ž$n æ·»åŠ åˆ°Shellçš„å„å‚æ•°å€¼ã€‚$1æ˜¯ç¬¬1å‚æ•°ã€$2æ˜¯ç¬¬2å‚æ•°â€¦ã€‚$- ä½¿ç”¨Setå‘½ä»¤è®¾å®šçš„Flagä¸€è§ˆ$* æ‰€æœ‰å‚æ•°åˆ—è¡¨ã€‚å¦‚"$*"ç”¨ã€Œ"ã€æ‹¬èµ·æ¥çš„æƒ…å†µã€ä»¥"$1 $2 â€¦ $n"çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚$@ æ‰€æœ‰å‚æ•°åˆ—è¡¨ã€‚å¦‚"$@"ç”¨ã€Œ"ã€æ‹¬èµ·æ¥çš„æƒ…å†µã€ä»¥"$1" "$2" â€¦ "$n" çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚$# æ·»åŠ åˆ°Shellçš„å‚æ•°ä¸ªæ•° 1234567891011#!/bin/bashfor i in "$*" do echo $i donefor y in "$@" do echo $y done 1234567âžœ commonShell ./param3.sh 1 2 3 4 51 2 3 4 5 $*1 $@2345 1234567891011#!/bin/bashprintf "The complete list is %s\n" "$$"printf "The complete list is %s\n" "$!"printf "The complete list is %s\n" "$?"printf "The complete list is %s\n" "$*"printf "The complete list is %s\n" "$@"printf "The complete list is %s\n" "$#" ä¸ªæ•°2printf "The complete list is %s\n" "$0" è¾“å‡ºDropbox/commonShell/var.shprintf "The complete list is %s\n" "$1" è¾“å‡ºqqprintf "The complete list is %s\n" "$2" è¾“å‡º123 12345678âžœ ~ Dropbox/commonShell/var.sh qq 123The complete list is 1626The complete list isThe complete list is 0The complete list is qq 123 $*è¾“å‡ºThe complete list is qq $@è¾“å‡ºThe complete list is 123 ç‚¹å·12345678. /lib/init/vars.sh. /lib/lsb/init-functions&lt;/span&gt;ä»¥å¾€æ‰§è¡Œæ–‡ä»¶æ—¶éƒ½æ˜¯ç”¨./file_nameçš„å½¢å¼ï¼ŒæŸ¥é˜…äº†èµ„æ–™å¾—çŸ¥ï¼š1ã€ å¦‚æžœæˆ‘ä»¬è¦æ‰§è¡ŒæŸä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æ­¤æ–‡ä»¶ä¸å¯æ‰§è¡Œï¼Œæ­¤æ—¶æˆ‘ä»¬è¦ç”¨chmod u+x file_nameæ¥ä½¿æ–‡ä»¶å…·æœ‰å¯æ‰§è¡Œæƒé™2ã€å¯æ˜¯æœ‰æ—¶æˆ‘ä»¬ä¸æƒ³æ›´æ”¹æ­¤æ–‡ä»¶çš„æ‰§è¡Œæƒé™ï¼Œä½†åˆæƒ³æ‰§è¡Œæ­¤æ–‡ä»¶ï¼Œå¯ä»¥é‡‡ç”¨(ç‚¹å·--ç©ºæ ¼--æ–‡ä»¶å)çš„å½¢å¼æ¥æ‰§è¡Œä¸€ä¸ªè„šæœ¬ï¼ˆåªæœ‰rootç”¨æˆ·æ‰å¯ä»¥è¿™ä¹ˆåšï¼‰ è¯­ç³»å˜é‡locale12345678910localeLANG="zh_CN.UTF-8" å®šä¹‰ç³»ç»Ÿä¸»è¯­ç³»LC_COLLATE="zh_CN.UTF-8"LC_CTYPE="zh_CN.UTF-8"LC_MESSAGES="zh_CN.UTF-8"LC_MONETARY="zh_CN.UTF-8"LC_NUMERIC="zh_CN.UTF-8"LC_TIME="zh_CN.UTF-8"LC_ALL= å®šä¹‰æ•´ä½“è¯­ç³» 12345echo $LANG æŸ¥çœ‹ç³»ç»Ÿå½“å‰è¯­ç³»local -a | more æŸ¥çœ‹linuxæ”¯æŒçš„æ‰€æœ‰è¯­ç³»zhcon æ’ä»¶ read123456789101112131415#!/bin/bash# -pæç¤º -tæ—¶é—´å†…è¾“å…¥ nameå˜é‡read -p "please input your name : " -t 30 nameecho $name# -s å®‰å…¨è¾“å…¥read -p "please input your passwd : " -s passwdecho -e "\n"echo $passwd# -n è¾“å…¥å­—ç¬¦ä¸ªæ•°read -p "please input sex M/F : " -n 1 sexecho -e "\n"echo $sex æ•°å€¼è¿ç®—$(( $1+$2 )) åŒå°æ‹¬å·æ³¨æ„ä¸¤è¾¹ç•™ç©ºæ ¼ 12345678#!/bin/bashnum1=$1num2=$2#æ•°å€¼è®¡ç®—sum=$(( $1 + $2 ))echo "sum is $sum" 1234echo $(( (11+3)*3/2 )) 21echo $(( 10%3 )) 1echo $(( 1&amp;&amp;0 )) 0echo $(( 1||0 )) 1 $[è¿ç®—ç¬¦]` ä¸­æ‹¬å·1dd=$[$aa+$bb] $(expr $aa + $bb)1dd=$(expr $aa + $bb) +ä¸¤ä¾§å¿…é¡»æœ‰ç©ºæ ¼ declareå˜é‡å£°æ˜Ž12345678declare [+/-][é€‰é¡¹] å˜é‡å- è®¾å®š+ å–æ¶ˆå˜é‡çš„ç±»åž‹ç†Ÿæ‚‰æ€§-a æ•°ç»„-i integer-x çŽ¯å¢ƒå˜é‡-r åªè¯»-p è¾“å‡ºç±»åž‹ declare -p cc å®šä¹‰æ•°ç»„ 12345678movie[0]=aamovie[1]=bbecho $&#123;movie&#125; è¾“å‡ºaa,ç¬¬0ä¸ªecho $&#123;movie[1]&#125; ç¬¬1ä¸ªecho $&#123;movie[*]&#125; å…¨éƒ¨declare -a movie[2]=live çŽ¯å¢ƒå˜é‡ 123456declare -x test=123å’Œexport test ç›¸ä¼¼declare -p æŸ¥çœ‹å…¨éƒ¨å˜é‡declare -xr test=456 åªè¯» çŽ¯å¢ƒå˜é‡declare +r test æç¤ºåªè¯» å˜é‡ç½®æ¢æ–¹å¼ ${y-æ–°å€¼}å¤§æ‹¬å·ï¼Œé»˜è®¤å€¼12345678x=$&#123;y-æ–°å€¼&#125; yæ²¡æœ‰è®¾ç½®ï¼Œx=æ–°å€¼ï¼›yå­˜åœ¨ï¼Œyä¸ºç©ºå€¼,xä¸ºç©º;è®¾ç½®y,x$yx=$&#123;y-2&#125;echo $x ä¸º2y=""x=$&#123;y-2&#125;echo $x ä¸ºç©º å…¶å®ƒ1ã€æŸ¥çœ‹æ‰€æœ‰å®‰è£…çš„è½¯ä»¶åŒ… 1rpm -qa 2ã€æŸ¥çœ‹çŽ¯å¢ƒå˜é‡ 1env 3ã€Mac åˆ é™¤gitæ–‡ä»¶å¤¹ï¼Œåˆ é™¤svnæ–‡ä»¶å¤¹ 1234567cdåˆ°è¯¥æ–‡ä»¶å¤¹//åˆ é™¤æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ .svn æ–‡ä»¶find . -name ".svn" | xargs rm -Rf//åˆ é™¤æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ .git æ–‡ä»¶find . -name ".git" | xargs rm -Rf æ›´å¤šèµ„æ–™ï¼šhttps://app.yinxiang.com/Home.action#n=b0fcd794-072a-4fab-9ac6-012b7b0ad147&amp;ses=4&amp;sh=2&amp;sds=5&amp;]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaçº¿ä¸Šé—®é¢˜æŽ’æŸ¥]]></title>
    <url>%2F2018%2F05%2F13%2Fjava%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%2F</url>
    <content type="text"><![CDATA[å¸¸ç”¨å‘½ä»¤ã€ä¼˜å…ˆã€‘topæŸ¥çœ‹è´Ÿè½½ï¼Œæ‰¾åˆ°CPUè¿‡é«˜çš„ç¨‹åºè¿›ç¨‹ ã€ä¼˜å…ˆã€‘top -Hp [è¿›ç¨‹id]æŸ¥çœ‹è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ï¼Œæ‰¾åˆ°å ç”¨cpuè¾ƒé«˜çš„çº¿ç¨‹ ã€ä¼˜å…ˆã€‘jstack [è¿›ç¨‹id] &gt; js.txtæ‰“å°å½“å‰çº¿ç¨‹å †æ ˆï¼Œæ ¹æ®çº¿ç¨‹idï¼ˆè½¬æ¢ä¸º16è¿›åˆ¶ printf %x ï¼‰æ‰¾åˆ°CPUè¾ƒé«˜çš„çº¿ç¨‹å †æ ˆ jstat -gcutil [è¿›ç¨‹id] 1000æ¯éš”1000ç§’æ‰“å°jvmå†…å­˜GCä¿¡æ¯ jmap -histo [è¿›ç¨‹id] &gt; jmap.txtæŸ¥çœ‹å½“å‰jvmå†…å­˜é‡Œå¯¹è±¡çš„å®žä¾‹æ•°å’Œå†…å­˜æ•° ã€ä¼˜å…ˆã€‘jmap -dump:format=b,file=dump.bin [è¿›ç¨‹id]æŸ¥çœ‹å½“å‰jvmå†…å­˜é‡Œå¯¹è±¡çš„å®žä¾‹æ•°å’Œå†…å­˜æ•° å †å†…å­˜dumpæ–‡ä»¶åˆ†æž å‘½ä»¤ï¼šjmap -dump:format=b,file=dump.bin [è¿›ç¨‹id] å·¥å…·ï¼šMAT FULL_GCé—®é¢˜å®šä½ top æŸ¥çœ‹è´Ÿè½½ï¼Œæ‰¾åˆ°CPUè¿‡é«˜çš„ç¨‹åºè¿›ç¨‹ top -Hp [è¿›ç¨‹id] æŸ¥çœ‹è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ï¼Œæ‰¾åˆ°å ç”¨cpuè¾ƒé«˜çš„çº¿ç¨‹ jstack [è¿›ç¨‹id] &gt; js.txt æ‰“å°å½“å‰çº¿ç¨‹å †æ ˆï¼Œæ ¹æ®çº¿ç¨‹idï¼ˆè½¬æ¢ä¸º16è¿›åˆ¶ printf %x ï¼‰æ‰¾åˆ°CPUè¾ƒé«˜çš„çº¿ç¨‹å †æ ˆ ä¸‰éƒ¨åŸºæœ¬å¯ä»¥å®šä½åˆ°ç¨‹åºçš„ä¸€äº›é—®é¢˜ã€‚ å½“æ—¶å‘çŽ°ï¼Œå ç”¨cpuè¾ƒé«˜çš„çº¿ç¨‹ï¼ŒåŸºæœ¬éƒ½æ˜¯GCçº¿ç¨‹ 4ã€jstat -gcutil [è¿›ç¨‹id] 1000 æ¯éš”1000ç§’æ‰“å°jvmå†…å­˜GCä¿¡æ¯ï¼Œ S0 å¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” S1 å¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” E å¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” O oldä»£å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” P permä»£å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” YGC ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ¬¡æ•° YGCT ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ‰€ç”¨æ—¶é—´(s) FGC ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ¬¡æ•° FGCT ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ‰€ç”¨æ—¶é—´(s) GCT ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶gcç”¨çš„æ€»æ—¶é—´(s) jmap -histo [è¿›ç¨‹id] &gt; jmap.txt æŸ¥çœ‹å½“å‰jvmå†…å­˜é‡Œå¯¹è±¡çš„å®žä¾‹æ•°å’Œå†…å­˜æ•° 6ã€çœ‹GCæ—¥å¿— å¯åŠ¨è„šæœ¬é‡Œæ·»åŠ gclogé…ç½® -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintHeapAtGC -Xloggc:gc.log ç­›é€‰Full GC log å †å†…å­˜dumpæ–‡ä»¶åˆ†æž å‘½ä»¤ï¼šjmap -dump:format=b,file=aa.bin 1232134 å·¥å…·ï¼šMAT]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[anatomy]]></title>
    <url>%2F2018%2F05%2F13%2Fanatomy%2F</url>
    <content type="text"><![CDATA[ç®€ä»‹anatomy æ˜¯é˜¿é‡ŒåŒå­¦å¼€å‘çš„ä¸€æ¬¾ç”¨äºŽJVMè¿›ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸è¯Šæ–­å·¥å…·ï¼Œå¯ä»¥åœ¨ä¸ä¸­æ–­ç¨‹åºæ‰§è¡Œçš„æƒ…å†µä¸‹è½»æ¾å®Œæˆé—®é¢˜æŽ’æŸ¥å·¥ä½œã€‚ çº¯Javaå®žçŽ°çš„å¼€æºé¡¹ç›® å®‰è£…ä½¿ç”¨ä¾¿æ· æ–¹æ³•çº§é—®é¢˜è¯Šæ–­ Groovyè¡¨è¾¾å¼å±•å¼€å˜å¯¹è±¡ï¼Œæ–¹ä¾¿ä½ è§‚å¯Ÿå…¥å‚ã€å‡ºå‚ã€å¼‚å¸¸ã€å½“å‰å¯¹è±¡çš„å„ç§å±žæ€§ç»†èŠ‚ æŽ¥ä¸‹æ¥ç»“åˆçº¿ä¸Šåº”ç”¨ï¼Œåˆ—ä¸¾å¸¸ç”¨çš„å‡ ä¸ªæŽ’æŸ¥é—®é¢˜å‘½ä»¤å¦‚ä½•ä½¿ç”¨1ã€å®‰è£…ï¼š 1curl -sLk http://ompc.oss.aliyuncs.com/greys/install.sh|sh 2ã€å¯åŠ¨ 123greys.sh &lt;PID&gt;æ³¨ï¼šPIDï¼šç›®æ ‡Javaè¿›ç¨‹ID 3ã€help 1234567help æ³¨ï¼šæ‰€æœ‰å‘½ä»¤help watchæ³¨ï¼šhelpå‘½ä»¤åŒæ—¶ä¹Ÿæ”¯æŒå¯¹å…¶ä»–å‘½ä»¤çš„ä¸€ä¸ªè§£é‡Šè¯´æ˜Žï¼Œæ¯”å¦‚æˆ‘ä»¬é”®å…¥help watchï¼ŒåŒ…å«ï¼ˆç”¨é€”è¯´æ˜Žã€å‚æ•°åˆ—è¡¨ã€å®žé™…ä¾‹å­ï¼‰ 4ã€sc æœç´¢æ‰€æœ‰å·²ç»åŠ è½½åˆ°JVMä¸­çš„Classä¿¡æ¯ã€‚ 1sc -d *RecommendManagerImpl ä½¿ç”¨åœºæ™¯ï¼š ä¸»è¦æ˜¯ç”¨äºŽæŽ’æŸ¥ä¸€ä¸ªåº”ç”¨å¯èƒ½å­˜åœ¨åŒä¸€ä¸ªjaråŒ…çš„å¤šä¸ªç‰ˆæœ¬ï¼Œè€Œä¸åŒç‰ˆæœ¬çš„ç±»çš„æ–¹æ³•å¯èƒ½ä¼šæœ‰å®žçŽ°ä¸Šçš„å·®å¼‚ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ç¡®è®¤JVMä¸­åŠ è½½çš„æ˜¯å“ªä¸€ä¸ªjarä¸‹çš„ç±»ã€‚ 5ã€monitor æ–¹æ³•å±‚é¢çš„æ€§èƒ½ç›‘æŽ§ï¼Œéžå®žæ—¶è¿”å›žçš„å‘½ä»¤ï¼Œåˆ™æ˜¯ä¸æ–­çš„ç­‰å¾…ç›®æ ‡Javaè¿›ç¨‹è¿”å›žä¿¡æ¯ï¼Œç›´åˆ°ç”¨æˆ·è¾“å…¥Ctrl+Dä¸ºæ­¢ 123monitor -c 5 *TimelineReadServiceImpl getEditorRecPostæ³¨ï¼š-c : ç»Ÿè®¡å‘¨æœŸï¼Œé»˜è®¤å€¼ä¸º120ç§’ ä½¿ç”¨åœºæ™¯ï¼š çº¿ä¸Šåé¦ˆæŸä¸ªæŽ¥å£çªç„¶å“åº”è¾ƒæ…¢ï¼Œä½†åˆç¼ºä¹å…¨é“¾è·¯ç»´åº¦èŠ‚ç‚¹çš„ç›‘æŽ§ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤èƒ½å®šä½åˆ°å…·ä½“å“ªä¸ªæ–¹æ³•è€—æ—¶è¾ƒé•¿ï¼Œæœ‰æ•ˆç¼©å°æŽ’æŸ¥èŒƒå›´ã€‚ 6ã€trace ç»Ÿè®¡æ•´ä¸ªè°ƒç”¨é“¾è·¯ä¸Šçš„æ‰€æœ‰æ€§èƒ½å¼€é”€å’Œè¿½è¸ªè°ƒç”¨é“¾è·¯ã€‚ 1trace -n 2 *TimelineReadServiceImpl queryRecPageTimeLine ä½¿ç”¨åœºæ™¯ï¼š å®šä½æŸ¥æ‰¾æŸä¸€æŽ¥å£å“åº”è¾ƒæ…¢ï¼Œä¸»è¦æ˜¯æŸè€—åœ¨å“ªä¸€ä¸ªçŽ¯èŠ‚ã€‚ å¦å¤–ä¹Ÿå¯ä»¥åšä¸ºæ€§èƒ½ä¼˜åŒ–çš„å‚è€ƒæ ‡å‡†ï¼Œäº†è§£ä¸€ä¸ªæŽ¥å£ä¸‹é¢æ¯ä¸ªçŽ¯èŠ‚çš„æ¶ˆè€—æ—¶é—´ï¼Œä»Žè€Œåˆ¤æ–­æ˜¯å¦åˆç†ï¼Œæœ‰æ²¡æœ‰ä¼˜åŒ–çš„ç©ºé—´ 7ã€watch è§‚å¯Ÿåˆ°æŒ‡å®šæ–¹æ³•çš„è°ƒç”¨æƒ…å†µ èƒ½è§‚å¯Ÿåˆ°çš„èŒƒå›´ï¼šå…¥å‚ã€è¿”å›žå€¼ã€æŠ›å‡ºå¼‚å¸¸ï¼Œé€šè¿‡ç¼–å†™groovyè¡¨è¾¾å¼è¿›è¡Œå¯¹åº”å˜é‡çš„æŸ¥çœ‹ã€‚è¯¦ç»†ä½¿ç”¨æ‰‹å†Œå¯ä»¥é€šè¿‡å‘½ä»¤help watch 1234567891011watch -b *TimelineReadServiceImpl queryRecPageTimeLine params[0]æ³¨ï¼šæ‰“å°å®Œæ•´çš„å…¥å‚ä¿¡æ¯watch -b *TimelineReadServiceImpl queryRecPageTimeLine params[0] 'params[0].uid&gt;2894731' æ³¨ï¼šå¸¦ä¸Šgroovyè¡¨è¾¾å¼ï¼Œuid&gt;2894731watch -s *TimelineReadServiceImpl queryRecPageTimeLine params[0]+returnObj 'params[0].uid==3680667'æ³¨ï¼šå½“è¯·æ±‚çš„uidä¸º3680667æ—¶ï¼Œæ‰“å°å…¥å‚å’Œè¿”å›žç»“æžœ 8ã€ jvm æŸ¥çœ‹å½“å‰JVMçš„ä¿¡æ¯ï¼Œæ— å‚æ•° å‚è€ƒèµ„æ–™https://github.com/oldmanpushcart/greys-anatomy/wiki/Commands#help]]></content>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaåŽç«¯æž¶æž„å¸ˆæŠ€æœ¯å›¾è°±]]></title>
    <url>%2F2018%2F05%2F08%2Fjava%E5%90%8E%E7%AB%AF%E6%9E%B6%E6%9E%84%E5%B8%88%E6%8A%80%E6%9C%AF%E5%9B%BE%E8%B0%B1%2F</url>
    <content type="text"><![CDATA[æœ€åŽæ›´æ–°äºŽ20180502 [TOC] æ•°æ®ç»“æž„é˜Ÿåˆ— ã€Šjavaé˜Ÿåˆ—â€”â€”queueè¯¦ç»†åˆ†æžã€‹ éžé˜»å¡žé˜Ÿåˆ—ï¼šConcurrentLinkedQueue(æ— ç•Œçº¿ç¨‹å®‰å…¨)ï¼Œé‡‡ç”¨CASæœºåˆ¶ï¼ˆcompareAndSwapObjectåŽŸå­æ“ä½œï¼‰ã€‚ é˜»å¡žé˜Ÿåˆ—ï¼šArrayBlockingQueue(æœ‰ç•Œ)ã€LinkedBlockingQueueï¼ˆæ— ç•Œï¼‰ã€DelayQueueã€PriorityBlockingQueueï¼Œé‡‡ç”¨é”æœºåˆ¶ï¼›ä½¿ç”¨ ReentrantLock é”ã€‚ ã€ŠLinkedListã€ConcurrentLinkedQueueã€LinkedBlockingQueueå¯¹æ¯”åˆ†æžã€‹ é›†åˆ ã€ŠJava Seté›†åˆçš„è¯¦è§£ã€‹ é“¾è¡¨ã€æ•°ç»„ ã€ŠJavaé›†åˆè¯¦è§£â€“ä»€ä¹ˆæ˜¯Listã€‹ å­—å…¸ã€å…³è”æ•°ç»„ ã€ŠJava map è¯¦è§£ - ç”¨æ³•ã€éåŽ†ã€æŽ’åºã€å¸¸ç”¨APIç­‰ã€‹ æ ˆ ã€Šjavaæ•°æ®ç»“æž„ä¸Žç®—æ³•ä¹‹æ ˆï¼ˆStackï¼‰è®¾è®¡ä¸Žå®žçŽ°ã€‹ ã€ŠJava Stack ç±»ã€‹ ã€Šjava stackçš„è¯¦ç»†å®žçŽ°åˆ†æžã€‹ Stack æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å†…éƒ¨ä½¿ç”¨æ•°ç»„ä¿å­˜æ•°æ®ï¼Œä¸å¤Ÿæ—¶ç¿»å€ã€‚ æ ‘äºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå¶å­èŠ‚ç‚¹ã€‚ ã€ŠäºŒå‰æ ‘ã€‹ å®Œå…¨äºŒå‰æ ‘ ã€Šå®Œå…¨äºŒå‰æ ‘ã€‹ å¶èŠ‚ç‚¹åªèƒ½å‡ºçŽ°åœ¨æœ€ä¸‹å±‚å’Œæ¬¡ä¸‹å±‚ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„ç»“ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®çš„äºŒå‰æ ‘ã€‚ å¹³è¡¡äºŒå‰æ ‘å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚ ã€Šæµ…è°ˆæ•°æ®ç»“æž„-å¹³è¡¡äºŒå‰æ ‘ã€‹ ã€Šæµ…è°ˆç®—æ³•å’Œæ•°æ®ç»“æž„: å…« å¹³è¡¡æŸ¥æ‰¾æ ‘ä¹‹2-3æ ‘ã€‹ äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBSTï¼‰äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œä¹Ÿç§°æœ‰åºäºŒå‰æ ‘ï¼ˆordered binary treeï¼‰,æŽ’åºäºŒå‰æ ‘ï¼ˆsorted binary treeï¼‰ã€‚ ã€Šæµ…è°ˆç®—æ³•å’Œæ•°æ®ç»“æž„: ä¸ƒ äºŒå‰æŸ¥æ‰¾æ ‘ã€‹ çº¢é»‘æ ‘ ã€Šæœ€å®¹æ˜“æ‡‚å¾—çº¢é»‘æ ‘ã€‹ æ·»åŠ é˜¶æ®µåŽï¼Œå·¦æ—‹æˆ–è€…å³æ—‹ä»Žè€Œå†æ¬¡è¾¾åˆ°å¹³è¡¡ã€‚ ã€Šæµ…è°ˆç®—æ³•å’Œæ•°æ®ç»“æž„: ä¹ å¹³è¡¡æŸ¥æ‰¾æ ‘ä¹‹çº¢é»‘æ ‘ã€‹ B-ï¼ŒB+ï¼ŒB*æ ‘MySQLæ˜¯åŸºäºŽB+æ ‘èšé›†ç´¢å¼•ç»„ç»‡è¡¨ ã€ŠB-æ ‘ï¼ŒB+æ ‘ï¼ŒB*æ ‘è¯¦è§£ã€‹ ã€ŠB-æ ‘ï¼ŒB+æ ‘ä¸ŽB*æ ‘çš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒã€‹ B+ æ ‘çš„å¶å­èŠ‚ç‚¹é“¾è¡¨ç»“æž„ç›¸æ¯”äºŽ B- æ ‘ä¾¿äºŽæ‰«åº“ï¼Œå’ŒèŒƒå›´æ£€ç´¢ã€‚LSM æ ‘ LSMï¼ˆLog-Structured Merge-Treesï¼‰å’Œ B+ æ ‘ç›¸æ¯”ï¼Œæ˜¯ç‰ºç‰²äº†éƒ¨åˆ†è¯»çš„æ€§èƒ½æ¥æ¢å–å†™çš„æ€§èƒ½(é€šè¿‡æ‰¹é‡å†™å…¥)ï¼Œå®žçŽ°è¯»å†™ä¹‹é—´çš„ã€‚Hbaseã€LevelDBã€Tairï¼ˆLong DBï¼‰ã€nessDB é‡‡ç”¨ LSM æ ‘çš„ç»“æž„ã€‚LSMå¯ä»¥å¿«é€Ÿå»ºç«‹ç´¢å¼•ã€‚ ã€ŠLSMæ ‘ VS B+æ ‘ã€‹ B+ æ ‘è¯»æ€§èƒ½å¥½ï¼Œä½†ç”±äºŽéœ€è¦æœ‰åºç»“æž„ï¼Œå½“keyæ¯”è¾ƒåˆ†æ•£æ—¶ï¼Œç£ç›˜å¯»é“é¢‘ç¹ï¼Œé€ æˆå†™æ€§èƒ½ã€‚ LSM æ˜¯å°†ä¸€ä¸ªå¤§æ ‘æ‹†åˆ†æˆNæ£µå°æ ‘ï¼Œå…ˆå†™åˆ°å†…å­˜ï¼ˆæ— å¯»é“é—®é¢˜ï¼Œæ€§èƒ½é«˜ï¼‰ï¼Œåœ¨å†…å­˜ä¸­æž„å»ºä¸€é¢—æœ‰åºå°æ ‘ï¼ˆæœ‰åºæ ‘ï¼‰ï¼Œéšç€å°æ ‘è¶Šæ¥è¶Šå¤§ï¼Œå†…å­˜çš„å°æ ‘ä¼šflushåˆ°ç£ç›˜ä¸Šã€‚å½“è¯»æ—¶ï¼Œç”±äºŽä¸çŸ¥é“æ•°æ®åœ¨å“ªæ£µå°æ ‘ä¸Šï¼Œå› æ­¤å¿…é¡»éåŽ†ï¼ˆäºŒåˆ†æŸ¥æ‰¾ï¼‰æ‰€æœ‰çš„å°æ ‘ï¼Œä½†åœ¨æ¯é¢—å°æ ‘å†…éƒ¨æ•°æ®æ˜¯æœ‰åºçš„ã€‚ ã€ŠLSMæ ‘ï¼ˆLog-Structured Merge Treeï¼‰å­˜å‚¨å¼•æ“Žã€‹ æžç«¯çš„è¯´ï¼ŒåŸºäºŽLSMæ ‘å®žçŽ°çš„HBaseçš„å†™æ€§èƒ½æ¯”MySQLé«˜äº†ä¸€ä¸ªæ•°é‡çº§ï¼Œè¯»æ€§èƒ½ä½Žäº†ä¸€ä¸ªæ•°é‡çº§ã€‚ ä¼˜åŒ–æ–¹å¼ï¼šBloom filter æ›¿ä»£äºŒåˆ†æŸ¥æ‰¾ï¼›compact å°æ•°ä½å¤§æ ‘ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚ Hbase ä¸­ï¼Œå†…å­˜ä¸­è¾¾åˆ°ä¸€å®šé˜ˆå€¼åŽï¼Œæ•´ä½“flushåˆ°ç£ç›˜ä¸Šã€å½¢æˆä¸€ä¸ªæ–‡ä»¶ï¼ˆB+æ•°ï¼‰ï¼ŒHDFSä¸æ”¯æŒupdateæ“ä½œï¼Œæ‰€ä»¥Hbaseåšæ•´ä½“flushè€Œä¸æ˜¯merge updateã€‚flushåˆ°ç£ç›˜ä¸Šçš„å°æ ‘ï¼Œå®šæœŸä¼šåˆå¹¶æˆä¸€ä¸ªå¤§æ ‘ã€‚ BitSetç»å¸¸ç”¨äºŽå¤§è§„æ¨¡æ•°æ®çš„æŽ’é‡æ£€æŸ¥ã€‚ ã€ŠJava Bitsetç±»ã€‹ ã€ŠJava BitSetï¼ˆä½é›†ï¼‰ã€‹ å¸¸ç”¨ç®—æ³• ã€Šå¸¸è§æŽ’åºç®—æ³•åŠå¯¹åº”çš„æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ã€‹ æŽ’åºã€æŸ¥æ‰¾ç®—æ³• ã€Šå¸¸è§æŽ’åºç®—æ³•åŠå¯¹åº”çš„æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ã€‹ é€‰æ‹©æŽ’åº ã€ŠJavaä¸­çš„ç»å…¸ç®—æ³•ä¹‹é€‰æ‹©æŽ’åºï¼ˆSelectionSortï¼‰ã€‹ æ¯ä¸€è¶Ÿä»Žå¾…æŽ’åºçš„è®°å½•ä¸­é€‰å‡ºæœ€å°çš„å…ƒç´ ï¼Œé¡ºåºæ”¾åœ¨å·²æŽ’å¥½åºçš„åºåˆ—æœ€åŽï¼Œç›´åˆ°å…¨éƒ¨è®°å½•æŽ’åºå®Œæ¯•ã€‚ å†’æ³¡æŽ’åº ã€Šå†’æ³¡æŽ’åºçš„2ç§å†™æ³•ã€‹ ç›¸é‚»å…ƒç´ å‰åŽäº¤æ¢ã€æŠŠæœ€å¤§çš„æŽ’åˆ°æœ€åŽã€‚ æ—¶é—´å¤æ‚åº¦ O(nÂ²) æ’å…¥æŽ’åº ã€ŠæŽ’åºç®—æ³•æ€»ç»“ä¹‹æ’å…¥æŽ’åºã€‹ å¿«é€ŸæŽ’åº ã€Šååœ¨é©¬æ¡¶ä¸Šçœ‹ç®—æ³•ï¼šå¿«é€ŸæŽ’åºã€‹ ä¸€ä¾§æ¯”å¦å¤–ä¸€æ¬¡éƒ½å¤§æˆ–å°ã€‚å½’å¹¶æŽ’åº ã€Šå›¾è§£æŽ’åºç®—æ³•(å››)ä¹‹å½’å¹¶æŽ’åºã€‹ åˆ†è€Œæ²»ä¹‹ï¼Œåˆ†æˆå°ä»½æŽ’åºï¼Œåœ¨åˆå¹¶(é‡å»ºä¸€ä¸ªæ–°ç©ºé—´è¿›è¡Œå¤åˆ¶)ã€‚ å¸Œå°”æŽ’åºTODO å †æŽ’åº ã€Šå›¾è§£æŽ’åºç®—æ³•(ä¸‰)ä¹‹å †æŽ’åºã€‹ æŽ’åºè¿‡ç¨‹å°±æ˜¯æž„å»ºæœ€å¤§å †çš„è¿‡ç¨‹ï¼Œæœ€å¤§å †ï¼šæ¯ä¸ªç»“ç‚¹çš„å€¼éƒ½å¤§äºŽæˆ–ç­‰äºŽå…¶å·¦å³å­©å­ç»“ç‚¹çš„å€¼ï¼Œå †é¡¶å…ƒç´ æ˜¯æœ€å¤§å€¼ã€‚ è®¡æ•°æŽ’åº ã€Šè®¡æ•°æŽ’åºå’Œæ¡¶æŽ’åºã€‹ å’Œæ¡¶æŽ’åºè¿‡ç¨‹æ¯”è¾ƒåƒï¼Œå·®åˆ«åœ¨äºŽæ¡¶çš„æ•°é‡ã€‚ æ¡¶æŽ’åº ã€Šã€å•Šå“ˆï¼ç®—æ³•ã€‘æœ€å¿«æœ€ç®€å•çš„æŽ’åºâ€”â€”æ¡¶æŽ’åºã€‹ ã€ŠæŽ’åºç®—æ³•ï¼ˆä¸‰ï¼‰ï¼šè®¡æ•°æŽ’åºä¸Žæ¡¶æŽ’åºã€‹ æ¡¶æŽ’åºå°†[0,1)åŒºé—´åˆ’åˆ†ä¸ºnä¸ªç›¸åŒçš„å¤§å°çš„å­åŒºé—´ï¼Œè¿™äº›å­åŒºé—´è¢«ç§°ä¸ºæ¡¶ã€‚ æ¯ä¸ªé€šå•ç‹¬è¿›è¡ŒæŽ’åºï¼Œç„¶åŽå†éåŽ†æ¯ä¸ªæ¡¶ã€‚ åŸºæ•°æŽ’åºæŒ‰ç…§ä¸ªä½ã€åä½ã€ç™¾ä½ã€â€¦ä¾æ¬¡æ¥æŽ’ã€‚ ã€ŠæŽ’åºç®—æ³•ç³»åˆ—ï¼šåŸºæ•°æŽ’åºã€‹ ã€ŠåŸºæ•°æŽ’åºã€‹ äºŒåˆ†æŸ¥æ‰¾ ã€ŠäºŒåˆ†æŸ¥æ‰¾(javaå®žçŽ°)ã€‹ è¦æ±‚å¾…æŸ¥æ‰¾çš„åºåˆ—æœ‰åºã€‚ æ—¶é—´å¤æ‚åº¦ O(logN)ã€‚ ã€Šjavaå®žçŽ°äºŒåˆ†æŸ¥æ‰¾-ä¸¤ç§æ–¹å¼ã€‹ while + é€’å½’ã€‚Java ä¸­çš„æŽ’åºå·¥å…· ã€ŠArrays.sortå’ŒCollections.sortå®žçŽ°åŽŸç†è§£æžã€‹ Collections.sortç®—æ³•è°ƒç”¨çš„æ˜¯åˆå¹¶æŽ’åºã€‚ Arrays.sort() é‡‡ç”¨äº†2ç§æŽ’åºç®—æ³• â€“ åŸºæœ¬ç±»åž‹æ•°æ®ä½¿ç”¨å¿«é€ŸæŽ’åºæ³•ï¼Œå¯¹è±¡æ•°ç»„ä½¿ç”¨å½’å¹¶æŽ’åºã€‚ å¸ƒéš†è¿‡æ»¤å™¨å¸¸ç”¨äºŽå¤§æ•°æ®çš„æŽ’é‡ï¼Œæ¯”å¦‚emailï¼Œurl ç­‰ã€‚æ ¸å¿ƒåŽŸç†ï¼šå°†æ¯æ¡æ•°æ®é€šè¿‡è®¡ç®—äº§ç”Ÿä¸€ä¸ªæŒ‡çº¹ï¼ˆä¸€ä¸ªå­—èŠ‚æˆ–å¤šä¸ªå­—èŠ‚ï¼Œä½†ä¸€å®šæ¯”åŽŸå§‹æ•°æ®è¦å°‘å¾ˆå¤šï¼‰ï¼Œå…¶ä¸­æ¯ä¸€ä½éƒ½æ˜¯é€šè¿‡éšæœºè®¡ç®—èŽ·å¾—ï¼Œåœ¨å°†æŒ‡çº¹æ˜ å°„åˆ°ä¸€ä¸ªå¤§çš„æŒ‰ä½å­˜å‚¨çš„ç©ºé—´ä¸­ã€‚æ³¨æ„ï¼šä¼šæœ‰ä¸€å®šçš„é”™è¯¯çŽ‡ã€‚ä¼˜ç‚¹ï¼šç©ºé—´å’Œæ—¶é—´æ•ˆçŽ‡éƒ½å¾ˆé«˜ã€‚ç¼ºç‚¹ï¼šéšç€å­˜å…¥çš„å…ƒç´ æ•°é‡å¢žåŠ ï¼Œè¯¯ç®—çŽ‡éšä¹‹å¢žåŠ ã€‚ ã€Šå¸ƒéš†è¿‡æ»¤å™¨ â€“ ç©ºé—´æ•ˆçŽ‡å¾ˆé«˜çš„æ•°æ®ç»“æž„ã€‹ ã€Šå¤§é‡æ•°æ®åŽ»é‡ï¼šBitmapå’Œå¸ƒéš†è¿‡æ»¤å™¨(Bloom Filter)ã€‹ ã€ŠåŸºäºŽRedisçš„å¸ƒéš†è¿‡æ»¤å™¨çš„å®žçŽ°ã€‹ åŸºäºŽ Redis çš„ Bitmap æ•°æ®ç»“æž„ã€‚ ã€Šç½‘ç»œçˆ¬è™«ï¼šURLåŽ»é‡ç­–ç•¥ä¹‹å¸ƒéš†è¿‡æ»¤å™¨(BloomFilter)çš„ä½¿ç”¨ã€‹ ä½¿ç”¨Javaä¸­çš„ BitSet ç±» å’Œ åŠ æƒå’Œhashç®—æ³•ã€‚ å­—ç¬¦ä¸²æ¯”è¾ƒKMP ç®—æ³•KMPï¼šKnuth-Morris-Prattç®—æ³•ï¼ˆç®€ç§°KMPï¼‰æ ¸å¿ƒåŽŸç†æ˜¯åˆ©ç”¨ä¸€ä¸ªâ€œéƒ¨åˆ†åŒ¹é…è¡¨â€ï¼Œè·³è¿‡å·²ç»åŒ¹é…è¿‡çš„å…ƒç´ ã€‚ ã€Šå­—ç¬¦ä¸²åŒ¹é…çš„KMPç®—æ³•ã€‹ æ·±åº¦ä¼˜å…ˆã€å¹¿åº¦ä¼˜å…ˆ ã€Šå¹¿åº¦ä¼˜å…ˆæœç´¢BFSå’Œæ·±åº¦ä¼˜å…ˆæœç´¢DFSã€‹ è´ªå¿ƒç®—æ³• ã€Šç®—æ³•ï¼šè´ªå©ªç®—æ³•åŸºç¡€ã€‹ ã€Šå¸¸è§ç®—æ³•åŠé—®é¢˜åœºæ™¯â€”â€”è´ªå¿ƒç®—æ³•ã€‹ å›žæº¯ç®—æ³• ã€Š äº”å¤§å¸¸ç”¨ç®—æ³•ä¹‹å››ï¼šå›žæº¯æ³•ã€‹ å‰ªæžç®—æ³• ã€ŠÎ±-Î²å‰ªæžç®—æ³•ã€‹ åŠ¨æ€è§„åˆ’ ã€Šè¯¦è§£åŠ¨æ€è§„åˆ’â€”â€”é‚¹åšè®²åŠ¨æ€è§„åˆ’ã€‹ ã€ŠåŠ¨æ€è§„åˆ’ç®—æ³•çš„ä¸ªäººç†è§£ã€‹ æœ´ç´ è´å¶æ–¯ ã€Šå¸¦ä½ æžæ‡‚æœ´ç´ è´å¶æ–¯åˆ†ç±»ç®—æ³•ã€‹ P(B|A)=P(A|B)P(B)/P(A) ã€Šè´å¶æ–¯æŽ¨æ–­åŠå…¶äº’è”ç½‘åº”ç”¨1ã€‹ ã€Šè´å¶æ–¯æŽ¨æ–­åŠå…¶äº’è”ç½‘åº”ç”¨2ã€‹ æŽ¨èç®—æ³• ã€ŠæŽ¨èç®—æ³•ç»¼è¿°ã€‹ ã€ŠTOP 10 å¼€æºçš„æŽ¨èç³»ç»Ÿç®€ä»‹ã€‹ æœ€å°ç”Ÿæˆæ ‘ç®—æ³• ã€Šç®—æ³•å¯¼è®ºâ€“æœ€å°ç”Ÿæˆæ ‘ï¼ˆKruskalå’ŒPrimç®—æ³•ï¼‰ã€‹ æœ€çŸ­è·¯å¾„ç®—æ³• ã€ŠDijkstraç®—æ³•è¯¦è§£ã€‹ å¹¶å‘å¤šçº¿ç¨‹ ã€Š40ä¸ªJavaå¤šçº¿ç¨‹é—®é¢˜æ€»ç»“ã€‹ çº¿ç¨‹å®‰å…¨ ã€ŠJavaå¹¶å‘ç¼–ç¨‹â€”â€”çº¿ç¨‹å®‰å…¨åŠè§£å†³æœºåˆ¶ç®€ä»‹ã€‹ ä¸€è‡´æ€§ã€äº‹åŠ¡äº‹åŠ¡ ACID ç‰¹æ€§ ã€Šæ•°æ®åº“äº‹åŠ¡ACIDç‰¹æ€§ã€‹ äº‹åŠ¡çš„éš”ç¦»çº§åˆ« æœªæäº¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ªæœªæäº¤çš„æ•°æ®ï¼Œå®¹æ˜“å‡ºçŽ°è„è¯»çš„æƒ…å†µã€‚ è¯»æäº¤ï¼šä¸€ä¸ªäº‹åŠ¡ç­‰å¦å¤–ä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åŽæ‰å¯ä»¥è¯»å–æ•°æ®ï¼Œä½†ä¼šå‡ºçŽ°ä¸å¯é‡å¤è¯»çš„æƒ…å†µï¼ˆå¤šæ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼‰ï¼Œè¯»å–è¿‡ç¨‹ä¸­å‡ºçŽ°UPDATEæ“ä½œï¼Œä¼šå¤šã€‚ï¼ˆå¤§å¤šæ•°æ•°æ®åº“é»˜è®¤çº§åˆ«æ˜¯RCï¼Œæ¯”å¦‚SQL Serverï¼ŒOracleï¼‰ï¼Œè¯»å–çš„æ—¶å€™ä¸å¯ä»¥ä¿®æ”¹ã€‚ å¯é‡å¤è¯»ï¼š åŒä¸€ä¸ªäº‹åŠ¡é‡Œç¡®ä¿æ¯æ¬¡è¯»å–çš„æ—¶å€™ï¼ŒèŽ·å¾—çš„æ˜¯åŒæ ·çš„æ•°æ®ï¼Œä½†ä¸ä¿éšœåŽŸå§‹æ•°æ®è¢«å…¶ä»–äº‹åŠ¡æ›´æ–°ï¼ˆå¹»è¯»ï¼‰ï¼ŒMysql InnoDB å°±æ˜¯è¿™ä¸ªçº§åˆ«ã€‚ åºåˆ—åŒ–ï¼šæ‰€æœ‰äº‹ç‰©ä¸²è¡Œå¤„ç†ï¼ˆç‰ºç‰²äº†æ•ˆçŽ‡ï¼‰ ã€Šç†è§£äº‹åŠ¡çš„4ç§éš”ç¦»çº§åˆ«ã€‹ æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§åŠäº‹åŠ¡éš”ç¦»çº§åˆ« ã€ŠMySQLçš„InnoDBçš„å¹»è¯»é—®é¢˜ ã€‹ å¹»è¯»çš„ä¾‹å­éžå¸¸æ¸…æ¥šã€‚ é€šè¿‡ SELECT â€¦ FOR UPDATE è§£å†³ã€‚ ã€Šä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚MySQLå’ŒInnoDBã€‹ å›¾è§£è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»é—®é¢˜ã€‚ MVCC ã€Šã€mysqlã€‘å…³äºŽinnodbä¸­MVCCçš„ä¸€äº›ç†è§£ã€‹ innodb ä¸­ MVCC ç”¨åœ¨ Repeatable-Read éš”ç¦»çº§åˆ«ã€‚ MVCC ä¼šäº§ç”Ÿå¹»è¯»é—®é¢˜ï¼ˆæ›´æ–°æ—¶å¼‚å¸¸ã€‚ï¼‰ ã€Šè½»æ¾ç†è§£MYSQL MVCC å®žçŽ°æœºåˆ¶ã€‹ é€šè¿‡éšè—ç‰ˆæœ¬åˆ—æ¥å®žçŽ° MVCC æŽ§åˆ¶ï¼Œä¸€åˆ—è®°å½•åˆ›å»ºæ—¶é—´ã€ä¸€åˆ—è®°å½•åˆ é™¤æ—¶é—´ï¼Œè¿™é‡Œçš„æ—¶é—´ æ¯æ¬¡åªæ“ä½œæ¯”å½“å‰ç‰ˆæœ¬å°ï¼ˆæˆ–ç­‰äºŽï¼‰çš„ è¡Œã€‚ é”Javaä¸­çš„é”å’ŒåŒæ­¥ç±» ã€ŠJavaä¸­çš„é”åˆ†ç±»ã€‹ ä¸»è¦åŒ…æ‹¬ synchronizedã€ReentrantLockã€å’Œ ReadWriteLockã€‚ ã€ŠJavaå¹¶å‘ä¹‹AQSè¯¦è§£ã€‹ ã€ŠJavaä¸­ä¿¡å·é‡ Semaphoreã€‹ æœ‰æ•°é‡æŽ§åˆ¶ ç”³è¯·ç”¨ acquireï¼Œç”³è¯·ä¸è¦åˆ™é˜»å¡žï¼›é‡Šæ”¾ç”¨ releaseã€‚ ã€Šjavaå¼€å‘ä¸­çš„Mutex vs Semaphoreã€‹ ç®€å•çš„è¯´ å°±æ˜¯Mutexæ˜¯æŽ’å®ƒçš„ï¼Œåªæœ‰ä¸€ä¸ªå¯ä»¥èŽ·å–åˆ°èµ„æºï¼Œ Semaphoreä¹Ÿå…·æœ‰æŽ’å®ƒæ€§ï¼Œä½†å¯ä»¥å®šä¹‰å¤šä¸ªå¯ä»¥èŽ·å–çš„èµ„æºçš„å¯¹è±¡ã€‚ å…¬å¹³é” &amp; éžå…¬å¹³é”å…¬å¹³é”çš„ä½œç”¨å°±æ˜¯ä¸¥æ ¼æŒ‰ç…§çº¿ç¨‹å¯åŠ¨çš„é¡ºåºæ¥æ‰§è¡Œçš„ï¼Œä¸å…è®¸å…¶ä»–çº¿ç¨‹æ’é˜Ÿæ‰§è¡Œçš„ï¼›è€Œéžå…¬å¹³é”æ˜¯å…è®¸æ’é˜Ÿçš„ã€‚ ã€Šå…¬å¹³é”ä¸Žéžå…¬å¹³é”ã€‹ é»˜è®¤æƒ…å†µä¸‹ ReentrantLock å’Œ synchronized éƒ½æ˜¯éžå…¬å¹³é”ã€‚ReentrantLock å¯ä»¥è®¾ç½®æˆå…¬å¹³é”ã€‚ æ‚²è§‚é”æ‚²è§‚é”å¦‚æžœä½¿ç”¨ä¸å½“ï¼ˆé”çš„æ¡æ•°è¿‡å¤šï¼‰ï¼Œä¼šå¼•èµ·æœåŠ¡å¤§é¢ç§¯ç­‰å¾…ã€‚æŽ¨èä¼˜å…ˆä½¿ç”¨ä¹è§‚é”+é‡è¯•ã€‚ ã€Šã€MySQLã€‘æ‚²è§‚é”&amp;ä¹è§‚é”ã€‹ ä¹è§‚é”çš„æ–¹å¼ï¼šç‰ˆæœ¬å·+é‡è¯•æ–¹å¼ æ‚²è§‚é”ï¼šé€šè¿‡ select â€¦ for update è¿›è¡Œè¡Œé”(ä¸å¯è¯»ã€ä¸å¯å†™ï¼Œshare é”å¯è¯»ä¸å¯å†™)ã€‚ ã€ŠMysqlæŸ¥è¯¢è¯­å¥ä½¿ç”¨select.. for updateå¯¼è‡´çš„æ•°æ®åº“æ­»é”åˆ†æžã€‹ mysqlçš„innodbå­˜å‚¨å¼•æ“Žå®žåŠ¡é”è™½ç„¶æ˜¯é”è¡Œï¼Œä½†å®ƒå†…éƒ¨æ˜¯é”ç´¢å¼•çš„ã€‚ é”ç›¸åŒæ•°æ®çš„ä¸åŒç´¢å¼•æ¡ä»¶å¯èƒ½ä¼šå¼•èµ·æ­»é”ã€‚ ã€ŠMysqlå¹¶å‘æ—¶ç»å…¸å¸¸è§çš„æ­»é”åŽŸå› åŠè§£å†³æ–¹æ³•ã€‹ ä¹è§‚é” &amp; CAS ã€Šä¹è§‚é”çš„ä¸€ç§å®žçŽ°æ–¹å¼â€”â€”CASã€‹ å’ŒMySQLä¹è§‚é”æ–¹å¼ç›¸ä¼¼ï¼Œåªä¸è¿‡æ˜¯é€šè¿‡å’ŒåŽŸå€¼è¿›è¡Œæ¯”è¾ƒã€‚ ABA é—®é¢˜ç”±äºŽé«˜å¹¶å‘ï¼Œåœ¨CASä¸‹ï¼Œæ›´æ–°åŽå¯èƒ½æ­¤Aéžå½¼Aã€‚é€šè¿‡ç‰ˆæœ¬å·å¯ä»¥è§£å†³ï¼Œç±»ä¼¼äºŽä¸Šæ–‡Mysql ä¸­æåˆ°çš„çš„ä¹è§‚é”ã€‚ ã€ŠJava CAS å’ŒABAé—®é¢˜ã€‹ ã€ŠJava ä¸­ ABAé—®é¢˜åŠé¿å…ã€‹ AtomicStampedReference å’Œ AtomicStampedReferenceã€‚ CopyOnWriteå®¹å™¨å¯ä»¥å¯¹CopyOnWriteå®¹å™¨è¿›è¡Œå¹¶å‘çš„è¯»ï¼Œè€Œä¸éœ€è¦åŠ é”ã€‚CopyOnWriteå¹¶å‘å®¹å™¨ç”¨äºŽè¯»å¤šå†™å°‘çš„å¹¶å‘åœºæ™¯ã€‚æ¯”å¦‚ç™½åå•ï¼Œé»‘åå•ï¼Œå•†å“ç±»ç›®çš„è®¿é—®å’Œæ›´æ–°åœºæ™¯ï¼Œä¸é€‚åˆéœ€è¦æ•°æ®å¼ºä¸€è‡´æ€§çš„åœºæ™¯ã€‚ ã€ŠJAVAä¸­å†™æ—¶å¤åˆ¶(Copy-On-Write)Mapå®žçŽ°ã€‹ å®žçŽ°è¯»å†™åˆ†ç¦»ï¼Œè¯»å–å‘ç”Ÿåœ¨åŽŸå§‹æ•°æ®ä¸Šï¼Œå†™å…¥å‘ç”Ÿåœ¨å‰¯æœ¬ä¸Šã€‚ ä¸ç”¨åŠ é”ï¼Œé€šè¿‡æœ€ç»ˆä¸€è‡´å®žçŽ°ä¸€è‡´æ€§ã€‚ ã€ŠèŠèŠå¹¶å‘-Javaä¸­çš„Copy-On-Writeå®¹å™¨ã€‹ RingBuffer ã€Šçº¿ç¨‹å®‰å…¨çš„æ— é”RingBufferçš„å®žçŽ°ã€ä¸€ä¸ªè¯»çº¿ç¨‹ï¼Œä¸€ä¸ªå†™çº¿ç¨‹ã€‘ã€‹ å¯é‡å…¥é” &amp; ä¸å¯é‡å…¥é” ã€Šå¯é‡å…¥é”å’Œä¸å¯é‡å…¥é”ã€‹ é€šè¿‡ç®€å•ä»£ç ä¸¾ä¾‹è¯´æ˜Žå¯é‡å…¥é”å’Œä¸å¯é‡å…¥é”ã€‚ å¯é‡å…¥é”æŒ‡åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å†æ¬¡èŽ·å¾—ä¹‹å‰å·²ç»èŽ·å¾—çš„é”ã€‚ å¯é‡å…¥é”å¯ä»¥ç”¨æˆ·é¿å…æ­»é”ã€‚ Javaä¸­çš„å¯é‡å…¥é”ï¼šsynchronized å’Œ java.util.concurrent.locks.ReentrantLock ã€ŠReenTrantLockå¯é‡å…¥é”ï¼ˆå’Œsynchronizedçš„åŒºåˆ«ï¼‰æ€»ç»“ã€‹ synchronized ä½¿ç”¨æ–¹ä¾¿ï¼Œç¼–è¯‘å™¨æ¥åŠ é”ï¼Œæ˜¯éžå…¬å¹³é”ã€‚ ReenTrantLock ä½¿ç”¨çµæ´»ï¼Œé”çš„å…¬å¹³æ€§å¯ä»¥å®šåˆ¶ã€‚ ç›¸åŒåŠ é”åœºæ™¯ä¸‹ï¼ŒæŽ¨èä½¿ç”¨ synchronizedã€‚ äº’æ–¥é” &amp; å…±äº«é”äº’æ–¥é”ï¼šåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èŽ·å¾—é”ã€‚æ¯”å¦‚ï¼ŒReentrantLock æ˜¯äº’æ–¥é”ï¼ŒReadWriteLock ä¸­çš„å†™é”æ˜¯äº’æ–¥é”ã€‚å…±äº«é”ï¼šå¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æˆ–çš„é”ã€‚æ¯”å¦‚ï¼ŒSemaphoreã€CountDownLatch æ˜¯å…±äº«é”ï¼ŒReadWriteLock ä¸­çš„è¯»é”æ˜¯å…±äº«é”ã€‚ ã€ŠReadWriteLockåœºæ™¯åº”ç”¨ã€‹ æ­»é” ã€Šâ€œæ­»é”â€å››ä¸ªå¿…è¦æ¡ä»¶çš„åˆç†è§£é‡Šã€‹ äº’æ–¥ã€æŒæœ‰ã€ä¸å¯å‰¥å¤ºã€ä¸å¯å‰¥å¤ºã€‚ Javaå¦‚ä½•æŸ¥çœ‹æ­»é”ï¼Ÿ JConsole å¯ä»¥è¯†åˆ«æ­»é”ã€‚ javaå¤šçº¿ç¨‹ç³»åˆ—ï¼šæ­»é”åŠæ£€æµ‹ jstack å¯ä»¥æ˜¾ç¤ºæ­»é”ã€‚ æ“ä½œç³»ç»Ÿè®¡ç®—æœºåŽŸç† ã€Šæ“ä½œç³»ç»ŸåŸºç¡€çŸ¥è¯†â€”â€”æ“ä½œç³»ç»Ÿçš„åŽŸç†ï¼Œç±»åž‹å’Œç»“æž„ã€‹ CPUå¤šçº§ç¼“å­˜å…¸åž‹çš„ CPU æœ‰ä¸‰çº§ç¼“å­˜ï¼Œè·ç¦»æ ¸å¿ƒè¶Šè¿‘ï¼Œé€Ÿåº¦è¶Šå¿«ï¼Œç©ºé—´è¶Šå°ã€‚L1 ä¸€èˆ¬ 32kï¼ŒL2 ä¸€èˆ¬ 256kï¼ŒL3 ä¸€èˆ¬12Mã€‚å†…å­˜é€Ÿåº¦éœ€è¦200ä¸ª CPU å‘¨æœŸï¼ŒCPU ç¼“å­˜éœ€è¦1ä¸ªCPUå‘¨æœŸã€‚ ã€Šä»ŽJavaè§†è§’ç†è§£CPUç¼“å­˜å’Œä¼ªå…±äº«ã€‹ è¿›ç¨‹TODO çº¿ç¨‹ ã€Šçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸåŠçŠ¶æ€è½¬æ¢è¯¦è§£ã€‹ åç¨‹ ã€Šç»ˆç»“pythonåç¨‹â€”-ä»Žyieldåˆ°actoræ¨¡åž‹çš„å®žçŽ°ã€‹ çº¿ç¨‹çš„è°ƒåº¦æ˜¯ç”±æ“ä½œç³»ç»Ÿè´Ÿè´£ï¼Œåç¨‹è°ƒåº¦æ˜¯ç¨‹åºè‡ªè¡Œè´Ÿè´£ ä¸Žçº¿ç¨‹ç›¸æ¯”ï¼Œåç¨‹å‡å°‘äº†æ— è°“çš„æ“ä½œç³»ç»Ÿåˆ‡æ¢. å®žé™…ä¸Šå½“é‡åˆ°IOæ“ä½œæ—¶åšåˆ‡æ¢æ‰æ›´æœ‰æ„ä¹‰ï¼Œï¼ˆå› ä¸ºIOæ“ä½œä¸ç”¨å ç”¨CPUï¼‰ï¼Œå¦‚æžœæ²¡é‡åˆ°IOæ“ä½œï¼ŒæŒ‰ç…§æ—¶é—´ç‰‡åˆ‡æ¢. Linux ã€ŠLinux å‘½ä»¤å¤§å…¨ã€‹ è®¾è®¡æ¨¡å¼è®¾è®¡æ¨¡å¼çš„å…­å¤§åŽŸåˆ™ ã€Šè®¾è®¡æ¨¡å¼çš„å…­å¤§åŽŸåˆ™ã€‹ å¼€é—­åŽŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾,å¯¹ä¿®æ”¹å…³é—­ï¼Œå¤šä½¿ç”¨æŠ½è±¡ç±»å’ŒæŽ¥å£ã€‚ é‡Œæ°ä»£æ¢åŽŸåˆ™ï¼šåŸºç±»å¯ä»¥è¢«å­ç±»æ›¿æ¢ï¼Œä½¿ç”¨æŠ½è±¡ç±»ç»§æ‰¿,ä¸ä½¿ç”¨å…·ä½“ç±»ç»§æ‰¿ã€‚ ä¾èµ–å€’è½¬åŽŸåˆ™ï¼šè¦ä¾èµ–äºŽæŠ½è±¡,ä¸è¦ä¾èµ–äºŽå…·ä½“ï¼Œé’ˆå¯¹æŽ¥å£ç¼–ç¨‹,ä¸é’ˆå¯¹å®žçŽ°ç¼–ç¨‹ã€‚ æŽ¥å£éš”ç¦»åŽŸåˆ™ï¼šä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æŽ¥å£,æ¯”ä½¿ç”¨å•ä¸ªæŽ¥å£å¥½ï¼Œå»ºç«‹æœ€å°çš„æŽ¥å£ã€‚ è¿ªç±³ç‰¹æ³•åˆ™ï¼šä¸€ä¸ªè½¯ä»¶å®žä½“åº”å½“å°½å¯èƒ½å°‘åœ°ä¸Žå…¶ä»–å®žä½“å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œé€šè¿‡ä¸­é—´ç±»å»ºç«‹è”ç³»ã€‚ åˆæˆå¤ç”¨åŽŸåˆ™ï¼šå°½é‡ä½¿ç”¨åˆæˆ/èšåˆ,è€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚ 23ç§å¸¸è§è®¾è®¡æ¨¡å¼ ã€Šè®¾è®¡æ¨¡å¼ã€‹ ã€Š23ç§è®¾è®¡æ¨¡å¼å…¨è§£æžã€‹ åº”ç”¨åœºæ™¯ ã€Šç»†æ•°JDKé‡Œçš„è®¾è®¡æ¨¡å¼ã€‹ ç»“æž„åž‹æ¨¡å¼ï¼š é€‚é…å™¨ï¼šç”¨æ¥æŠŠä¸€ä¸ªæŽ¥å£è½¬åŒ–æˆå¦ä¸€ä¸ªæŽ¥å£ï¼Œå¦‚ java.util.Arrays#asList()ã€‚ æ¡¥æŽ¥æ¨¡å¼ï¼šè¿™ä¸ªæ¨¡å¼å°†æŠ½è±¡å’ŒæŠ½è±¡æ“ä½œçš„å®žçŽ°è¿›è¡Œäº†è§£è€¦ï¼Œè¿™æ ·ä½¿å¾—æŠ½è±¡å’Œå®žçŽ°å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ï¼Œå¦‚JDBCï¼› ç»„åˆæ¨¡å¼ï¼šä½¿å¾—å®¢æˆ·ç«¯çœ‹æ¥å•ä¸ªå¯¹è±¡å’Œå¯¹è±¡çš„ç»„åˆæ˜¯åŒç­‰çš„ã€‚æ¢å¥è¯è¯´ï¼ŒæŸä¸ªç±»åž‹çš„æ–¹æ³•åŒæ—¶ä¹ŸæŽ¥å—è‡ªèº«ç±»åž‹ä½œä¸ºå‚æ•°ï¼Œå¦‚ Map.putAllï¼ŒList.addAllã€Set.addAllã€‚ è£…é¥°è€…æ¨¡å¼ï¼šåŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡é™„åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œè¿™ä¹Ÿæ˜¯å­ç±»çš„ä¸€ç§æ›¿ä»£æ–¹å¼ï¼Œå¦‚ java.util.Collections#checkedList|Map|Set|SortedSet|SortedMapã€‚ äº«å…ƒæ¨¡å¼ï¼šä½¿ç”¨ç¼“å­˜æ¥åŠ é€Ÿå¤§é‡å°å¯¹è±¡çš„è®¿é—®æ—¶é—´ï¼Œå¦‚ valueOf(int)ã€‚ ä»£ç†æ¨¡å¼ï¼šä»£ç†æ¨¡å¼æ˜¯ç”¨ä¸€ä¸ªç®€å•çš„å¯¹è±¡æ¥ä»£æ›¿ä¸€ä¸ªå¤æ‚çš„æˆ–è€…åˆ›å»ºè€—æ—¶çš„å¯¹è±¡ï¼Œå¦‚ java.lang.reflect.Proxy åˆ›å»ºæ¨¡å¼: æŠ½è±¡å·¥åŽ‚æ¨¡å¼ï¼šæŠ½è±¡å·¥åŽ‚æ¨¡å¼æä¾›äº†ä¸€ä¸ªåè®®æ¥ç”Ÿæˆä¸€ç³»åˆ—çš„ç›¸å…³æˆ–è€…ç‹¬ç«‹çš„å¯¹è±¡ï¼Œè€Œä¸ç”¨æŒ‡å®šå…·ä½“å¯¹è±¡çš„ç±»åž‹ï¼Œå¦‚ java.util.Calendar#getInstance()ã€‚ å»ºé€ æ¨¡å¼(Builder)ï¼šå®šä¹‰äº†ä¸€ä¸ªæ–°çš„ç±»æ¥æž„å»ºå¦ä¸€ä¸ªç±»çš„å®žä¾‹ï¼Œä»¥ç®€åŒ–å¤æ‚å¯¹è±¡çš„åˆ›å»ºï¼Œå¦‚ï¼šjava.lang.StringBuilder#append()ã€‚ å·¥åŽ‚æ–¹æ³•ï¼šå°±æ˜¯ ä¸€ä¸ªè¿”* å›žå…·ä½“å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯å¤šä¸ªï¼Œå¦‚ java.lang.Object#toString()ã€java.lang.Class#newInstance()ã€‚ åŽŸåž‹æ¨¡å¼ï¼šä½¿å¾—ç±»çš„å®žä¾‹èƒ½å¤Ÿç”Ÿæˆè‡ªèº«çš„æ‹·è´ã€å¦‚ï¼šjava.lang.Object#clone()ã€‚ å•ä¾‹æ¨¡å¼ï¼šå…¨å±€åªæœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå¦‚ java.lang.Runtime#getRuntime()ã€‚ è¡Œä¸ºæ¨¡å¼ï¼š è´£ä»»é“¾æ¨¡å¼ï¼šé€šè¿‡æŠŠè¯·æ±‚ä»Žä¸€ä¸ªå¯¹è±¡ä¼ é€’åˆ°é“¾æ¡ä¸­ä¸‹ä¸€ä¸ªå¯¹è±¡çš„æ–¹å¼ï¼Œç›´åˆ°è¯·æ±‚è¢«å¤„ç†å®Œæ¯•ï¼Œä»¥å®žçŽ°å¯¹è±¡é—´çš„è§£è€¦ã€‚å¦‚ javax.servlet.Filter#doFilter()ã€‚ å‘½ä»¤æ¨¡å¼ï¼šå°†æ“ä½œå°è£…åˆ°å¯¹è±¡å†…ï¼Œä»¥ä¾¿å­˜å‚¨ï¼Œä¼ é€’å’Œè¿”å›žï¼Œå¦‚ï¼šjava.lang.Runnableã€‚ è§£é‡Šå™¨æ¨¡å¼ï¼šå®šä¹‰äº†ä¸€ä¸ªè¯­è¨€çš„è¯­æ³•ï¼Œç„¶åŽè§£æžç›¸åº”è¯­æ³•çš„è¯­å¥ï¼Œå¦‚ï¼Œjava.text.Formatï¼Œjava.text.Normalizerã€‚ è¿­ä»£å™¨æ¨¡å¼ï¼šæä¾›ä¸€ä¸ªä¸€è‡´çš„æ–¹æ³•æ¥é¡ºåºè®¿é—®é›†åˆä¸­çš„å¯¹è±¡ï¼Œå¦‚ java.util.Iteratorã€‚ ä¸­ä»‹è€…æ¨¡å¼ï¼šé€šè¿‡ä½¿ç”¨ä¸€ä¸ªä¸­é—´å¯¹è±¡æ¥è¿›è¡Œæ¶ˆæ¯åˆ†å‘ä»¥åŠå‡å°‘ç±»ä¹‹é—´çš„ç›´æŽ¥ä¾èµ–ï¼Œjava.lang.reflect.Method#invoke()ã€‚ ç©ºå¯¹è±¡æ¨¡å¼ï¼šå¦‚ java.util.Collections#emptyList()ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ï¼šå®ƒä½¿å¾—ä¸€ä¸ªå¯¹è±¡å¯ä»¥çµæ´»çš„å°†æ¶ˆæ¯å‘é€ç»™æ„Ÿå…´è¶£çš„å¯¹è±¡ï¼Œå¦‚ java.util.EventListenerã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šè®©å­ç±»å¯ä»¥é‡å†™æ–¹æ³•çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªé‡å†™ï¼Œå¦‚ java.util.Collections#sort()ã€‚ ã€ŠSpring-æ¶‰åŠåˆ°çš„è®¾è®¡æ¨¡å¼æ±‡æ€»ã€‹ ã€ŠMybatisä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ã€‹ å•ä¾‹æ¨¡å¼ ã€Šå•ä¾‹æ¨¡å¼çš„ä¸‰ç§å®žçŽ° ä»¥åŠå„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‹ ã€Šå•ä¾‹æ¨¡å¼ï¼ï¼åå°„ï¼ï¼é˜²æ­¢åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼ã€‹ ä½¿ç”¨æžšä¸¾ç±»åž‹ã€‚ è´£ä»»é“¾æ¨¡å¼TODO MVC ã€ŠMVC æ¨¡å¼ã€‹ æ¨¡åž‹(model)ï¼è§†å›¾(view)ï¼æŽ§åˆ¶å™¨(controller) IOC ã€Šç†è§£ IOCã€‹ ã€ŠIOC çš„ç†è§£ä¸Žè§£é‡Šã€‹ æ­£å‘æŽ§åˆ¶ï¼šä¼ ç»Ÿé€šè¿‡newçš„æ–¹å¼ã€‚åå‘æŽ§åˆ¶ï¼Œé€šè¿‡å®¹å™¨æ³¨å…¥å¯¹è±¡ã€‚ ä½œç”¨ï¼šç”¨äºŽæ¨¡å—è§£è€¦ã€‚ DIï¼šDependency Injectionï¼Œå³ä¾èµ–æ³¨å…¥ï¼Œåªå…³å¿ƒèµ„æºä½¿ç”¨ï¼Œä¸å…³å¿ƒèµ„æºæ¥æºã€‚ AOP ã€Šè½»æ¾ç†è§£AOP(é¢å‘åˆ‡é¢ç¼–ç¨‹)ã€‹ ã€ŠSpring AOPè¯¦è§£ã€‹ ã€ŠSpring AOPçš„å®žçŽ°åŽŸç†ã€‹ Spring AOPä½¿ç”¨çš„åŠ¨æ€ä»£ç†ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼šJDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†ã€‚ ã€ŠSpring AOP å®žçŽ°åŽŸç†ä¸Ž CGLIB åº”ç”¨ã€‹ Spring AOP æ¡†æž¶å¯¹ AOP ä»£ç†ç±»çš„å¤„ç†åŽŸåˆ™æ˜¯ï¼šå¦‚æžœç›®æ ‡å¯¹è±¡çš„å®žçŽ°ç±»å®žçŽ°äº†æŽ¥å£ï¼ŒSpring AOP å°†ä¼šé‡‡ç”¨ JDK åŠ¨æ€ä»£ç†æ¥ç”Ÿæˆ AOP ä»£ç†ç±»ï¼›å¦‚æžœç›®æ ‡å¯¹è±¡çš„å®žçŽ°ç±»æ²¡æœ‰å®žçŽ°æŽ¥å£ï¼ŒSpring AOP å°†ä¼šé‡‡ç”¨ CGLIB æ¥ç”Ÿæˆ AOP ä»£ç†ç±» UML ã€ŠUMLæ•™ç¨‹ã€‹ å¾®æœåŠ¡æ€æƒ³ ã€Šå¾®æœåŠ¡æž¶æž„è®¾è®¡ã€‹ ã€Šå¾®æœåŠ¡æž¶æž„æŠ€æœ¯æ ˆé€‰åž‹æ‰‹å†Œã€‹ åº·å¨å®šå¾‹ ã€Šå¾®æœåŠ¡æž¶æž„çš„ç†è®ºåŸºç¡€ - åº·å¨å®šå¾‹ã€‹ å®šå¾‹ä¸€ï¼šç»„ç»‡æ²Ÿé€šæ–¹å¼ä¼šé€šè¿‡ç³»ç»Ÿè®¾è®¡è¡¨è¾¾å‡ºæ¥ï¼Œå°±æ˜¯è¯´æž¶æž„çš„å¸ƒå±€å’Œç»„ç»‡ç»“æž„ä¼šæœ‰ç›¸ä¼¼ã€‚ å®šå¾‹äºŒï¼šæ—¶é—´å†å¤šä¸€ä»¶äº‹æƒ…ä¹Ÿä¸å¯èƒ½åšçš„å®Œç¾Žï¼Œä½†æ€»æœ‰æ—¶é—´åšå®Œä¸€ä»¶äº‹æƒ…ã€‚ä¸€å£æ°”åƒä¸æˆèƒ–å­ï¼Œå…ˆæžå®šèƒ½æžå®šçš„ã€‚ å®šå¾‹ä¸‰ï¼šçº¿åž‹ç³»ç»Ÿå’Œçº¿åž‹ç»„ç»‡æž¶æž„é—´æœ‰æ½œåœ¨çš„å¼‚è´¨åŒæ€ç‰¹æ€§ã€‚ç§ç“œå¾—ç“œï¼Œåšç‹¬ç«‹è‡ªæ²»çš„å­ç³»ç»Ÿå‡å°‘æ²Ÿé€šæˆæœ¬ã€‚ å®šå¾‹å››ï¼šå¤§çš„ç³»ç»Ÿç»„ç»‡æ€»æ˜¯æ¯”å°ç³»ç»Ÿæ›´å€¾å‘äºŽåˆ†è§£ã€‚åˆä¹…å¿…åˆ†ï¼Œåˆ†è€Œæ²»ä¹‹ã€‚ ã€Šå¾®æœåŠ¡æž¶æž„æ ¸â¼¼20è®²ã€‹ è¿ç»´ &amp; ç»Ÿè®¡ &amp; æŠ€æœ¯æ”¯æŒå¸¸è§„ç›‘æŽ§ ã€Šè…¾è®¯ä¸šåŠ¡ç³»ç»Ÿç›‘æŽ§çš„ä¿®ç‚¼ä¹‹è·¯ã€‹ ç›‘æŽ§çš„æ–¹å¼ï¼šä¸»åŠ¨ã€è¢«åŠ¨ã€æ—è·¯(æ¯”å¦‚èˆ†æƒ…ç›‘æŽ§) ç›‘æŽ§ç±»åž‹ï¼š åŸºç¡€ç›‘æŽ§ã€æœåŠ¡ç«¯ç›‘æŽ§ã€å®¢æˆ·ç«¯ç›‘æŽ§ã€ç›‘æŽ§ã€ç”¨æˆ·ç«¯ç›‘æŽ§ ç›‘æŽ§çš„ç›®æ ‡ï¼šå…¨ã€å—ã€å‡† æ ¸å¿ƒæŒ‡æ ‡ï¼šè¯·æ±‚é‡ã€æˆåŠŸçŽ‡ã€è€—æ—¶ ã€Šå¼€æºè¿˜æ˜¯å•†ç”¨ï¼Ÿåå¤§äº‘è¿ç»´ç›‘æŽ§å·¥å…·æ¨ªè¯„ã€‹ Zabbixã€Nagiosã€Gangliaã€Zenossã€Open-falconã€ç›‘æŽ§å®ã€ 360ç½‘ç«™æœåŠ¡ç›‘æŽ§ã€é˜¿é‡Œäº‘ç›‘æŽ§ã€ç™¾åº¦äº‘è§‚æµ‹ã€å°èœœèœ‚ç½‘ç«™ç›‘æµ‹ç­‰ã€‚ ã€Šç›‘æŽ§æŠ¥è­¦ç³»ç»Ÿæ­å»ºåŠäºŒæ¬¡å¼€å‘ç»éªŒã€‹ å‘½ä»¤è¡Œç›‘æŽ§å·¥å…· ã€Šå¸¸ç”¨å‘½ä»¤è¡Œç›‘æŽ§å·¥å…·ã€‹ topã€sarã€tsarã€nload ã€Š20ä¸ªå‘½ä»¤è¡Œå·¥å…·ç›‘æŽ§ Linux ç³»ç»Ÿæ€§èƒ½ã€‹ ã€ŠJVMæ€§èƒ½è°ƒä¼˜ç›‘æŽ§å·¥å…·jpsã€jstackã€jmapã€jhatã€jstatã€hprofä½¿ç”¨è¯¦è§£ã€‹ APMAPM â€” Application Performance Management ã€ŠDapperï¼Œå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„è·Ÿè¸ªç³»ç»Ÿã€‹ CNCF OpenTracingï¼Œä¸­æ–‡ç‰ˆ ä¸»è¦å¼€æºè½¯ä»¶ï¼ŒæŒ‰å­—æ¯æŽ’åº Apache SkyWalking CAT CNCF jaeger Pinpoint Zipkin ã€Šå¼€æºAPMæŠ€æœ¯é€‰åž‹ä¸Žå®žæˆ˜ã€‹ ä¸»è¦åŸºäºŽ Googleçš„Dapperï¼ˆå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„è·Ÿè¸ªç³»ç»Ÿï¼‰ æ€æƒ³ã€‚ ç»Ÿè®¡åˆ†æž ã€Šæµé‡ç»Ÿè®¡çš„åŸºç¡€ï¼šåŸ‹ç‚¹ã€‹ å¸¸ç”¨æŒ‡æ ‡ï¼šè®¿é—®ä¸Žè®¿å®¢ã€åœç•™æ—¶é•¿ã€è·³å‡ºçŽ‡ã€é€€å‡ºçŽ‡ã€è½¬åŒ–çŽ‡ã€å‚ä¸Žåº¦ ã€ŠAPPåŸ‹ç‚¹å¸¸ç”¨çš„ç»Ÿè®¡å·¥å…·ã€åŸ‹ç‚¹ç›®æ ‡å’ŒåŸ‹ç‚¹å†…å®¹ã€‹ ç¬¬ä¸‰æ–¹ç»Ÿè®¡ï¼šå‹ç›Ÿã€ç™¾åº¦ç§»åŠ¨ã€é­”æ–¹ã€App Annieã€talking dataã€ç¥žç­–æ•°æ®ç­‰ã€‚ ã€Šç¾Žå›¢ç‚¹è¯„å‰ç«¯æ— ç—•åŸ‹ç‚¹å®žè·µã€‹ æ‰€è°“æ— ç—•ã€å³é€šè¿‡å¯è§†åŒ–å·¥å…·é…ç½®é‡‡é›†èŠ‚ç‚¹ï¼Œåœ¨å‰ç«¯è‡ªåŠ¨è§£æžé…ç½®å¹¶ä¸ŠæŠ¥åŸ‹ç‚¹æ•°æ®ï¼Œè€Œéžç¡¬ç¼–ç ã€‚ æŒç»­é›†æˆ(CI/CD) ã€ŠæŒç»­é›†æˆæ˜¯ä»€ä¹ˆï¼Ÿã€‹ ã€Š8ä¸ªæµè¡Œçš„æŒç»­é›†æˆå·¥å…·ã€‹ Jenkins ã€Šä½¿ç”¨Jenkinsè¿›è¡ŒæŒç»­é›†æˆã€‹ çŽ¯å¢ƒåˆ†ç¦»å¼€å‘ã€æµ‹è¯•ã€ç”ŸæˆçŽ¯å¢ƒåˆ†ç¦»ã€‚ ã€Šå¼€å‘çŽ¯å¢ƒã€ç”Ÿäº§çŽ¯å¢ƒã€æµ‹è¯•çŽ¯å¢ƒçš„åŸºæœ¬ç†è§£å’ŒåŒºã€‹ è‡ªåŠ¨åŒ–è¿ç»´Ansible ã€ŠAnsibleä¸­æ–‡æƒå¨æŒ‡å—ã€‹ ã€ŠAnsibleåŸºç¡€é…ç½®å’Œä¼ä¸šçº§é¡¹ç›®å®žç”¨æ¡ˆä¾‹ã€‹ puppet ã€Šè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·â€”â€”puppetè¯¦è§£ã€‹ chef ã€ŠChef çš„å®‰è£…ä¸Žä½¿ç”¨ã€‹ æµ‹è¯•TDD ç†è®º ã€Šæ·±åº¦è§£è¯» - TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰ã€‹ åŸºäºŽæµ‹è¯•ç”¨ä¾‹ç¼–ç åŠŸèƒ½ä»£ç ï¼ŒXPï¼ˆExtreme Programmingï¼‰çš„æ ¸å¿ƒå®žè·µ. å¥½å¤„ï¼šä¸€æ¬¡å…³æ³¨ä¸€ä¸ªç‚¹ï¼Œé™ä½Žæ€ç»´è´Ÿæ‹…ï¼›è¿ŽæŽ¥éœ€æ±‚å˜åŒ–æˆ–æ”¹å–„ä»£ç çš„è®¾è®¡ï¼›æå‰æ¾„æ¸…éœ€æ±‚ï¼›å¿«é€Ÿåé¦ˆï¼› å•å…ƒæµ‹è¯• ã€ŠJavaå•å…ƒæµ‹è¯•ä¹‹JUnitç¯‡ã€‹ ã€ŠJUnit 4 ä¸Ž TestNG å¯¹æ¯”ã€‹ TestNG è¦†ç›– JUnit åŠŸèƒ½ï¼Œé€‚ç”¨äºŽæ›´å¤æ‚çš„åœºæ™¯ã€‚ ã€Šå•å…ƒæµ‹è¯•ä¸»è¦çš„æµ‹è¯•åŠŸèƒ½ç‚¹ã€‹ æ¨¡å—æŽ¥å£æµ‹è¯•ã€å±€éƒ¨æ•°æ®ç»“æž„æµ‹è¯•ã€è·¯å¾„æµ‹è¯• ã€é”™è¯¯å¤„ç†æµ‹è¯•ã€è¾¹ç•Œæ¡ä»¶æµ‹è¯• ã€‚ åŽ‹åŠ›æµ‹è¯• ã€ŠApache ab æµ‹è¯•ä½¿ç”¨æŒ‡å—ã€‹ ã€Šå¤§åž‹ç½‘ç«™åŽ‹åŠ›æµ‹è¯•åŠä¼˜åŒ–æ–¹æ¡ˆã€‹ ã€Š10å¤§ä¸»æµåŽ‹åŠ›/è´Ÿè½½/æ€§èƒ½æµ‹è¯•å·¥å…·æŽ¨èã€‹ ã€ŠçœŸå®žæµé‡åŽ‹æµ‹å·¥å…· tcpcopyåº”ç”¨æµ…æžã€‹ ã€ŠnGrinder ç®€æ˜“ä½¿ç”¨æ•™ç¨‹ã€‹ å…¨é“¾è·¯åŽ‹æµ‹ ã€Šäº¬ä¸œ618ï¼šå‡çº§å…¨é“¾è·¯åŽ‹æµ‹æ–¹æ¡ˆï¼Œæ‰“é€ å†›æ¼”æœºå™¨äººForceBotã€‹ ã€Šé¥¿äº†ä¹ˆå…¨é“¾è·¯åŽ‹æµ‹çš„æŽ¢ç´¢ä¸Žå®žè·µã€‹ ã€Šå››å¤§è¯­è¨€ï¼Œå…«å¤§æ¡†æž¶ï½œæ»´æ»´å…¨é“¾è·¯åŽ‹æµ‹è§£å†³ä¹‹é“ã€‹ ã€Šå…¨é“¾è·¯åŽ‹æµ‹ç»éªŒã€‹ A/B ã€ç°åº¦ã€è“ç»¿æµ‹è¯• ã€ŠæŠ€æœ¯å¹²è´§ | AB æµ‹è¯•å’Œç°åº¦å‘å¸ƒæŽ¢ç´¢åŠå®žè·µã€‹ ã€Šnginx æ ¹æ®IP è¿›è¡Œç°åº¦å‘å¸ƒã€‹ ã€Šè“ç»¿éƒ¨ç½²ã€A/B æµ‹è¯•ä»¥åŠç°åº¦å‘å¸ƒã€‹ è™šæ‹ŸåŒ– ã€ŠVPSçš„ä¸‰ç§è™šæ‹ŸæŠ€æœ¯OpenVZã€Xenã€KVMä¼˜ç¼ºç‚¹æ¯”è¾ƒã€‹ KVM ã€ŠKVMè¯¦è§£ï¼Œå¤ªè¯¦ç»†å¤ªæ·±å…¥äº†ï¼Œç»å…¸ã€‹ ã€Šã€å›¾æ–‡ã€‘KVM è™šæ‹Ÿæœºå®‰è£…è¯¦è§£ã€‹ Xen ã€ŠXenè™šæ‹ŸåŒ–åŸºæœ¬åŽŸç†è¯¦è§£ã€‹ OpenVZ ã€Šå¼€æºLinuxå®¹å™¨ OpenVZ å¿«é€Ÿä¸Šæ‰‹æŒ‡å—ã€‹ å®¹å™¨æŠ€æœ¯Docker ã€Šå‡ å¼ å›¾å¸®ä½ ç†è§£ docker åŸºæœ¬åŽŸç†åŠå¿«é€Ÿå…¥é—¨ã€‹ ã€ŠDocker æ ¸å¿ƒæŠ€æœ¯ä¸Žå®žçŽ°åŽŸç†ã€‹ ã€ŠDocker æ•™ç¨‹ã€‹ äº‘æŠ€æœ¯OpenStack ã€ŠOpenStackæž„æž¶çŸ¥è¯†æ¢³ç†ã€‹ DevOps ã€Šä¸€åˆ†é’Ÿå‘Šè¯‰ä½ ç©¶ç«ŸDevOpsæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿã€‹ ã€ŠDevOpsè¯¦è§£ã€‹ æ–‡æ¡£ç®¡ç† Confluence-æ”¶è´¹æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ GitLab? Wiki ä¸­é—´ä»¶Web ServerNginx ã€ŠNgnixçš„åŸºæœ¬å­¦ä¹ -å¤šè¿›ç¨‹å’ŒApacheçš„æ¯”è¾ƒã€‹ Nginx é€šè¿‡å¼‚æ­¥éžé˜»å¡žçš„äº‹ä»¶å¤„ç†æœºåˆ¶å®žçŽ°é«˜å¹¶å‘ã€‚Apache æ¯ä¸ªè¯·æ±‚ç‹¬å ä¸€ä¸ªçº¿ç¨‹ï¼Œéžå¸¸æ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚ äº‹ä»¶é©±åŠ¨é€‚åˆäºŽIOå¯†é›†åž‹æœåŠ¡(Nginx)ï¼Œå¤šè¿›ç¨‹æˆ–çº¿ç¨‹é€‚åˆäºŽCPUå¯†é›†åž‹æœåŠ¡(Apache)ï¼Œæ‰€ä»¥Nginxé€‚åˆåšåå‘ä»£ç†ï¼Œè€ŒéžwebæœåŠ¡å™¨ä½¿ç”¨ã€‚ ã€Šnginxä¸ŽApacheçš„å¯¹æ¯”ä»¥åŠä¼˜ç¼ºç‚¹ã€‹ nginxåªé€‚åˆé™æ€å’Œåå‘ä»£ç†ï¼Œä¸é€‚åˆå¤„ç†åŠ¨æ€è¯·æ±‚ã€‚ OpenResty å®˜æ–¹ç½‘ç«™ ã€Šæµ…è°ˆ OpenRestyã€‹ é€šè¿‡ Lua æ¨¡å—å¯ä»¥åœ¨Nginxä¸Šè¿›è¡Œå¼€å‘ã€‚ Apache Httpd å®˜æ–¹ç½‘ç«™ Tomcatæž¶æž„åŽŸç† ã€ŠTOMCATåŽŸç†è¯¦è§£åŠè¯·æ±‚è¿‡ç¨‹ã€‹ ã€ŠTomcatæœåŠ¡å™¨åŽŸç†è¯¦è§£ã€‹ ã€ŠTomcat ç³»ç»Ÿæž¶æž„ä¸Žè®¾è®¡æ¨¡å¼,ç¬¬ 1 éƒ¨åˆ†: å·¥ä½œåŽŸç†ã€‹ ã€Šå››å¼ å›¾å¸¦ä½ äº†è§£Tomcatç³»ç»Ÿæž¶æž„ã€‹ ã€ŠJBoss vs. Tomcat: Choosing A Java Application Serverã€‹ Tomcat æ˜¯è½»é‡çº§çš„ Serverlet å®¹å™¨ï¼Œæ²¡æœ‰å®žçŽ°å…¨éƒ¨ JEE ç‰¹æ€§ï¼ˆæ¯”å¦‚æŒä¹…åŒ–å’Œäº‹åŠ¡å¤„ç†ï¼‰ï¼Œä½†å¯ä»¥é€šè¿‡å…¶ä»–ç»„ä»¶ä»£æ›¿ï¼Œæ¯”å¦‚Srpingã€‚ Jboss å®žçŽ°å…¨éƒ¨äº†JEEç‰¹æ€§ï¼Œè½¯ä»¶å¼€æºå…è´¹ã€æ–‡æ¡£æ”¶è´¹ã€‚ è°ƒä¼˜æ–¹æ¡ˆ ã€ŠTomcat è°ƒä¼˜æ–¹æ¡ˆã€‹ å¯åŠ¨NIOæ¨¡å¼ï¼ˆæˆ–è€…APRï¼‰ï¼›è°ƒæ•´çº¿ç¨‹æ± ï¼›ç¦ç”¨AJPè¿žæŽ¥å™¨ï¼ˆNginx+tomcatçš„æž¶æž„ï¼Œä¸éœ€è¦AJPï¼‰ï¼› ã€Štomcat httpåè®®ä¸Žajpåè®®ã€‹ ã€ŠAJPä¸ŽHTTPæ¯”è¾ƒå’Œåˆ†æžã€‹ AJP åè®®ï¼ˆ8009ç«¯å£ï¼‰ç”¨äºŽé™ä½Žå’Œå‰ç«¯Serverï¼ˆå¦‚Apacheï¼Œè€Œä¸”éœ€è¦æ”¯æŒAJPåè®®ï¼‰çš„è¿žæŽ¥æ•°(å‰ç«¯)ï¼Œé€šè¿‡é•¿è¿žæŽ¥æé«˜æ€§èƒ½ã€‚ å¹¶å‘é«˜æ—¶ï¼ŒAJPåè®®ä¼˜äºŽHTTPåè®®ã€‚ Jetty ã€ŠJetty çš„å·¥ä½œåŽŸç†ä»¥åŠä¸Ž Tomcat çš„æ¯”è¾ƒã€‹ ã€Šjettyå’Œtomcatä¼˜åŠ¿æ¯”è¾ƒã€‹ æž¶æž„æ¯”è¾ƒ:Jettyçš„æž¶æž„æ¯”Tomcatçš„æ›´ä¸ºç®€å•ã€‚ æ€§èƒ½æ¯”è¾ƒï¼šJettyå’ŒTomcatæ€§èƒ½æ–¹é¢å·®å¼‚ä¸å¤§ï¼ŒJettyé»˜è®¤é‡‡ç”¨NIOç»“æŸåœ¨å¤„ç†I/Oè¯·æ±‚ä¸Šæ›´å ä¼˜åŠ¿ï¼ŒTomcaté»˜è®¤é‡‡ç”¨BIOå¤„ç†I/Oè¯·æ±‚ï¼ŒTomcaté€‚åˆå¤„ç†å°‘æ•°éžå¸¸ç¹å¿™çš„é“¾æŽ¥ï¼Œå¤„ç†é™æ€èµ„æºæ—¶æ€§èƒ½è¾ƒå·®ã€‚ å…¶ä»–æ–¹é¢ï¼šJettyçš„åº”ç”¨æ›´åŠ å¿«é€Ÿï¼Œä¿®æ”¹ç®€å•ï¼Œå¯¹æ–°çš„Servletè§„èŒƒçš„æ”¯æŒè¾ƒå¥½;Tomcat å¯¹JEEå’ŒServlet æ”¯æŒæ›´åŠ å…¨é¢ã€‚ ç¼“å­˜ ã€Šç¼“å­˜å¤±æ•ˆç­–ç•¥ï¼ˆFIFO ã€LRUã€LFUä¸‰ç§ç®—æ³•çš„åŒºåˆ«ï¼‰ã€‹ æœ¬åœ°ç¼“å­˜ ã€ŠHashMapæœ¬åœ°ç¼“å­˜ã€‹ ã€ŠEhCacheæœ¬åœ°ç¼“å­˜ã€‹ å †å†…ã€å †å¤–ã€ç£ç›˜ä¸‰çº§ç¼“å­˜ã€‚ å¯æŒ‰ç…§ç¼“å­˜ç©ºé—´å®¹é‡è¿›è¡Œè®¾ç½®ã€‚ æŒ‰ç…§æ—¶é—´ã€æ¬¡æ•°ç­‰è¿‡æœŸç­–ç•¥ã€‚ ã€ŠGuava Cacheã€‹ ç®€å•è½»é‡ã€æ— å †å¤–ã€ç£ç›˜ç¼“å­˜ã€‚ ã€ŠNginxæœ¬åœ°ç¼“å­˜ã€‹ ã€ŠPagespeedâ€”æ‡’äººå·¥å…·ï¼ŒæœåŠ¡å™¨ç«¯åŠ é€Ÿã€‹ å®¢æˆ·ç«¯ç¼“å­˜ ã€Šæµè§ˆå™¨ç«¯ç¼“å­˜ã€‹ ä¸»è¦æ˜¯åˆ©ç”¨ Cache-Control å‚æ•°ã€‚ ã€ŠH5 å’Œç§»åŠ¨ç«¯ WebView ç¼“å­˜æœºåˆ¶è§£æžä¸Žå®žæˆ˜ã€‹ æœåŠ¡ç«¯ç¼“å­˜Memcached ã€ŠMemcached æ•™ç¨‹ã€‹ ã€Šæ·±å…¥ç†è§£MemcachedåŽŸç†ã€‹ é‡‡ç”¨å¤šè·¯å¤ç”¨æŠ€æœ¯æé«˜å¹¶å‘æ€§ã€‚ slabåˆ†é…ç®—æ³•ï¼š memcachedç»™Slabåˆ†é…å†…å­˜ç©ºé—´ï¼Œé»˜è®¤æ˜¯1MBã€‚åˆ†é…ç»™Slabä¹‹åŽ æŠŠslabçš„åˆ‡åˆ†æˆå¤§å°ç›¸åŒçš„chunkï¼ŒChunkæ˜¯ç”¨äºŽç¼“å­˜è®°å½•çš„å†…å­˜ç©ºé—´ï¼ŒChunk çš„å¤§å°é»˜è®¤æŒ‰ç…§1.25å€çš„é€Ÿåº¦é€’å¢žã€‚å¥½å¤„æ˜¯ä¸ä¼šé¢‘ç¹ç”³è¯·å†…å­˜ï¼Œæé«˜IOæ•ˆçŽ‡ï¼Œåå¤„æ˜¯ä¼šæœ‰ä¸€å®šçš„å†…å­˜æµªè´¹ã€‚ ã€ŠMemcachedè½¯ä»¶å·¥ä½œåŽŸç†ã€‹ ã€ŠMemcacheæŠ€æœ¯åˆ†äº«ï¼šä»‹ç»ã€ä½¿ç”¨ã€å­˜å‚¨ã€ç®—æ³•ã€ä¼˜åŒ–ã€å‘½ä¸­çŽ‡ã€‹ ã€Šmemcache ä¸­ add ã€ set ã€replace çš„åŒºåˆ«ã€‹ åŒºåˆ«åœ¨äºŽå½“keyå­˜åœ¨è¿˜æ˜¯ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›žå€¼æ˜¯trueå’Œfalseçš„ã€‚ ã€Šmemcachedå…¨é¢å‰–æžã€‹ Redis ã€ŠRedis æ•™ç¨‹ã€‹ ã€Šredisåº•å±‚åŽŸç†ã€‹ ä½¿ç”¨ ziplist å­˜å‚¨é“¾è¡¨ï¼Œziplistæ˜¯ä¸€ç§åŽ‹ç¼©é“¾è¡¨ï¼Œå®ƒçš„å¥½å¤„æ˜¯æ›´èƒ½èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå› ä¸ºå®ƒæ‰€å­˜å‚¨çš„å†…å®¹éƒ½æ˜¯åœ¨è¿žç»­çš„å†…å­˜åŒºåŸŸå½“ä¸­çš„ã€‚ ä½¿ç”¨ skiplist(è·³è·ƒè¡¨)æ¥å­˜å‚¨æœ‰åºé›†åˆå¯¹è±¡ã€æŸ¥æ‰¾ä¸Šå…ˆä»Žé«˜LevelæŸ¥èµ·ã€æ—¶é—´å¤æ‚åº¦å’Œçº¢é»‘æ ‘ç›¸å½“ï¼Œå®žçŽ°å®¹æ˜“ï¼Œæ— é”ã€å¹¶å‘æ€§å¥½ã€‚ ã€ŠRedisæŒä¹…åŒ–æ–¹å¼ã€‹ RDBæ–¹å¼ï¼šå®šæœŸå¤‡ä»½å¿«ç…§ï¼Œå¸¸ç”¨äºŽç¾éš¾æ¢å¤ã€‚ä¼˜ç‚¹ï¼šé€šè¿‡forkå‡ºçš„è¿›ç¨‹è¿›è¡Œå¤‡ä»½ï¼Œä¸å½±å“ä¸»è¿›ç¨‹ã€RDB åœ¨æ¢å¤å¤§æ•°æ®é›†æ—¶çš„é€Ÿåº¦æ¯” AOF çš„æ¢å¤é€Ÿåº¦è¦å¿«ã€‚ç¼ºç‚¹ï¼šä¼šä¸¢æ•°æ®ã€‚ AOFæ–¹å¼ï¼šä¿å­˜æ“ä½œæ—¥å¿—æ–¹å¼ã€‚ä¼˜ç‚¹ï¼šæ¢å¤æ—¶æ•°æ®ä¸¢å¤±å°‘ï¼Œç¼ºç‚¹ï¼šæ–‡ä»¶å¤§ï¼Œå›žå¤æ…¢ã€‚ ä¹Ÿå¯ä»¥ä¸¤è€…ç»“åˆä½¿ç”¨ã€‚ ã€Šåˆ†å¸ƒå¼ç¼“å­˜â€“åºåˆ—3â€“åŽŸå­æ“ä½œä¸ŽCASä¹è§‚é”ã€‹ æž¶æž„ ã€ŠRediså•çº¿ç¨‹æž¶æž„ã€‹ å›žæ”¶ç­–ç•¥ ã€Šredisçš„å›žæ”¶ç­–ç•¥ã€‹ Tair å®˜æ–¹ç½‘ç«™ ã€ŠTairå’ŒRedisçš„å¯¹æ¯”ã€‹ ç‰¹ç‚¹ï¼šå¯ä»¥é…ç½®å¤‡ä»½èŠ‚ç‚¹æ•°ç›®ï¼Œé€šè¿‡å¼‚æ­¥åŒæ­¥åˆ°å¤‡ä»½èŠ‚ç‚¹ ä¸€è‡´æ€§Hashç®—æ³•ã€‚ æž¶æž„ï¼šå’ŒHadoop çš„è®¾è®¡æ€æƒ³ç±»ä¼¼ï¼Œæœ‰Configserverï¼ŒDataServerï¼ŒConfigserver é€šè¿‡å¿ƒè·³æ¥æ£€æµ‹ï¼ŒConfigserverä¹Ÿæœ‰ä¸»å¤‡å…³ç³»ã€‚ å‡ ç§å­˜å‚¨å¼•æ“Ž: MDBï¼Œå®Œå…¨å†…å­˜æ€§ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨Sessionç­‰æ•°æ®ã€‚ Rdbï¼ˆç±»ä¼¼äºŽRedisï¼‰ï¼Œè½»é‡åŒ–ï¼ŒåŽ»é™¤äº†aofä¹‹ç±»çš„æ“ä½œï¼Œæ”¯æŒRestfullæ“ä½œ LDBï¼ˆLevelDBå­˜å‚¨å¼•æ“Žï¼‰ï¼ŒæŒä¹…åŒ–å­˜å‚¨ï¼ŒLDB ä½œä¸ºrdbçš„æŒä¹…åŒ–ï¼Œgoogleå®žçŽ°ï¼Œæ¯”è¾ƒé«˜æ•ˆï¼Œç†è®ºåŸºç¡€æ˜¯LSM(Log-Structured-Merge Tree)ç®—æ³•ï¼ŒçŽ°åœ¨å†…å­˜ä¸­ä¿®æ”¹æ•°æ®ï¼Œè¾¾åˆ°ä¸€å®šé‡æ—¶ï¼ˆå’Œå†…å­˜æ±‡æ€»çš„æ—§æ•°æ®ä¸€åŒå†™å…¥ç£ç›˜ï¼‰å†å†™å…¥ç£ç›˜ï¼Œå­˜å‚¨æ›´åŠ é«˜æ•ˆï¼ŒåŽ¿æ¯”å–»Hashç®—æ³•ã€‚ Tairé‡‡ç”¨å…±äº«å†…å­˜æ¥å­˜å‚¨æ•°æ®ï¼Œå¦‚æžœæœåŠ¡æŒ‚æŽ‰ï¼ˆéžæœåŠ¡å™¨ï¼‰ï¼Œé‡å¯æœåŠ¡ä¹‹åŽï¼Œæ•°æ®äº¦ç„¶è¿˜åœ¨ã€‚ æ¶ˆæ¯é˜Ÿåˆ— ã€Šæ¶ˆæ¯é˜Ÿåˆ—-æŽ¨/æ‹‰æ¨¡å¼å­¦ä¹  &amp; ActiveMQåŠJMSå­¦ä¹ ã€‹ RabbitMQ æ¶ˆè´¹è€…é»˜è®¤æ˜¯æŽ¨æ¨¡å¼ï¼ˆä¹Ÿæ”¯æŒæ‹‰æ¨¡å¼ï¼‰ã€‚ Kafka é»˜è®¤æ˜¯æ‹‰æ¨¡å¼ã€‚ Pushæ–¹å¼ï¼šä¼˜ç‚¹æ˜¯å¯ä»¥å°½å¯èƒ½å¿«åœ°å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œç¼ºç‚¹æ˜¯å¦‚æžœæ¶ˆè´¹è€…å¤„ç†èƒ½åŠ›è·Ÿä¸ä¸Šï¼Œæ¶ˆè´¹è€…çš„ç¼“å†²åŒºå¯èƒ½ä¼šæº¢å‡ºã€‚ Pullæ–¹å¼ï¼šä¼˜ç‚¹æ˜¯æ¶ˆè´¹ç«¯å¯ä»¥æŒ‰å¤„ç†èƒ½åŠ›è¿›è¡Œæ‹‰åŽ»ï¼Œç¼ºç‚¹æ˜¯ä¼šå¢žåŠ æ¶ˆæ¯å»¶è¿Ÿã€‚ ã€ŠKafkaã€RabbitMQã€RocketMQç­‰æ¶ˆæ¯ä¸­é—´ä»¶çš„å¯¹æ¯” â€”â€” æ¶ˆæ¯å‘é€æ€§èƒ½å’ŒåŒºåˆ«ã€‹ æ¶ˆæ¯æ€»çº¿æ¶ˆæ¯æ€»çº¿ç›¸å½“äºŽåœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¹‹ä¸Šåšäº†ä¸€å±‚å°è£…ï¼Œç»Ÿä¸€å…¥å£ï¼Œç»Ÿä¸€ç®¡æŽ§ã€ç®€åŒ–æŽ¥å…¥æˆæœ¬ã€‚ ã€Šæ¶ˆæ¯æ€»çº¿VSæ¶ˆæ¯é˜Ÿåˆ—ã€‹ æ¶ˆæ¯çš„é¡ºåº ã€Šå¦‚ä½•ä¿è¯æ¶ˆè´¹è€…æŽ¥æ”¶æ¶ˆæ¯çš„é¡ºåºã€‹ RabbitMQæ”¯æŒäº‹åŠ¡ï¼ŒæŽ¨æ‹‰æ¨¡å¼éƒ½æ˜¯æ”¯æŒã€é€‚åˆéœ€è¦å¯é æ€§æ¶ˆæ¯ä¼ è¾“çš„åœºæ™¯ã€‚ ã€ŠRabbitMQçš„åº”ç”¨åœºæ™¯ä»¥åŠåŸºæœ¬åŽŸç†ä»‹ç»ã€‹ ã€Šæ¶ˆæ¯é˜Ÿåˆ—ä¹‹ RabbitMQã€‹ ã€ŠRabbitMQä¹‹æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼ˆäº‹åŠ¡+Confirmï¼‰ã€‹ RocketMQJavaå®žçŽ°ï¼ŒæŽ¨æ‹‰æ¨¡å¼éƒ½æ˜¯æ”¯æŒï¼Œåžåé‡é€ŠäºŽKafkaã€‚å¯ä»¥ä¿è¯æ¶ˆæ¯é¡ºåºã€‚ ã€ŠRocketMQ å®žæˆ˜ä¹‹å¿«é€Ÿå…¥é—¨ã€‹ ActiveMQçº¯Javaå®žçŽ°ï¼Œå…¼å®¹JMSï¼Œå¯ä»¥å†…åµŒäºŽJavaåº”ç”¨ä¸­ã€‚ ã€ŠActiveMQæ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»ã€‹ Kafkaé«˜åžåé‡ã€é‡‡ç”¨æ‹‰æ¨¡å¼ã€‚é€‚åˆé«˜IOåœºæ™¯ï¼Œæ¯”å¦‚æ—¥å¿—åŒæ­¥ã€‚ å®˜æ–¹ç½‘ç«™ ã€Šå„æ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¯”ï¼ŒKafkaæ·±åº¦è§£æžï¼Œä¼—äººæŽ¨èï¼Œç²¾å½©å¥½æ–‡ï¼ã€‹ ã€ŠKafkaåˆ†åŒºæœºåˆ¶ä»‹ç»ä¸Žç¤ºä¾‹ã€‹ Redis æ¶ˆæ¯æŽ¨é€ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æ¨¡å¼å®Œå…¨æ˜¯å®¢æˆ·ç«¯è¡Œä¸ºï¼Œlist å’Œ æ‹‰æ¨¡å¼å®žçŽ°ï¼Œé˜»å¡žç­‰å¾…é‡‡ç”¨ blpop æŒ‡ä»¤ã€‚ ã€ŠRediså­¦ä¹ ç¬”è®°ä¹‹åï¼šRedisç”¨ä½œæ¶ˆæ¯é˜Ÿåˆ—ã€‹ ZeroMQ TODO å®šæ—¶è°ƒåº¦å•æœºå®šæ—¶è°ƒåº¦ ã€Šlinuxå®šæ—¶ä»»åŠ¡croné…ç½®ã€‹ ã€ŠLinux cronè¿è¡ŒåŽŸç†ã€‹ fork è¿›ç¨‹ + sleep è½®è¯¢ ã€ŠQuartzä½¿ç”¨æ€»ç»“ã€‹ ã€ŠQuartzæºç è§£æž â€”- è§¦å‘å™¨æŒ‰æ—¶å¯åŠ¨åŽŸç†ã€‹ ã€ŠquartzåŽŸç†æ­ç§˜å’Œæºç è§£è¯»ã€‹ å®šæ—¶è°ƒåº¦åœ¨ QuartzSchedulerThread ä»£ç ä¸­ï¼Œwhile()æ— é™å¾ªçŽ¯ï¼Œæ¯æ¬¡å¾ªçŽ¯å–å‡ºæ—¶é—´å°†åˆ°çš„triggerï¼Œè§¦å‘å¯¹åº”çš„jobï¼Œç›´åˆ°è°ƒåº¦å™¨çº¿ç¨‹è¢«å…³é—­ã€‚ åˆ†å¸ƒå¼å®šæ—¶è°ƒåº¦ ã€Šè¿™äº›ä¼˜ç§€çš„å›½äº§åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Œä½ ç”¨è¿‡å‡ ä¸ªï¼Ÿã€‹ opencronã€LTSã€XXL-JOBã€Elastic-Jobã€Uncode-Scheduleã€Antares ã€ŠQuartzä»»åŠ¡è°ƒåº¦çš„åŸºæœ¬å®žçŽ°åŽŸç†ã€‹ Quartzé›†ç¾¤ä¸­ï¼Œç‹¬ç«‹çš„QuartzèŠ‚ç‚¹å¹¶ä¸ä¸Žå¦ä¸€å…¶çš„èŠ‚ç‚¹æˆ–æ˜¯ç®¡ç†èŠ‚ç‚¹é€šä¿¡ï¼Œè€Œæ˜¯é€šè¿‡ç›¸åŒçš„æ•°æ®åº“è¡¨æ¥æ„ŸçŸ¥åˆ°å¦ä¸€Quartzåº”ç”¨çš„ RPC ã€Šä»Žé›¶å¼€å§‹å®žçŽ°RPCæ¡†æž¶ - RPCåŽŸç†åŠå®žçŽ°ã€‹ æ ¸å¿ƒè§’è‰²ï¼šServer: æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ã€Client: è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ã€Registry: æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°çš„æ³¨å†Œä¸­å¿ƒã€‚ ã€Šåˆ†å¸ƒå¼RPCæ¡†æž¶æ€§èƒ½å¤§æ¯”æ‹¼ dubboã€motanã€rpcxã€gRPCã€thriftçš„æ€§èƒ½æ¯”è¾ƒã€‹ Dubbo å®˜æ–¹ç½‘ç«™ dubboå®žçŽ°åŽŸç†ç®€å•ä»‹ç» SPI TODO Thrift å®˜æ–¹ç½‘ç«™ ã€ŠThrift RPCè¯¦è§£ã€‹ æ”¯æŒå¤šè¯­è¨€ï¼Œé€šè¿‡ä¸­é—´è¯­è¨€å®šä¹‰æŽ¥å£ã€‚ gRPCæœåŠ¡ç«¯å¯ä»¥è®¤è¯åŠ å¯†ï¼Œåœ¨å¤–ç½‘çŽ¯å¢ƒä¸‹ï¼Œå¯ä»¥ä¿è¯æ•°æ®å®‰å…¨ã€‚ å®˜æ–¹ç½‘ç«™ ã€Šä½ åº”è¯¥çŸ¥é“çš„RPCåŽŸç†ã€‹ æ•°æ®åº“ä¸­é—´ä»¶Sharding Jdbc å®˜ç½‘ æ—¥å¿—ç³»ç»Ÿæ—¥å¿—æœé›† ã€Šä»Žé›¶å¼€å§‹æ­å»ºä¸€ä¸ªELKBæ—¥å¿—æ”¶é›†ç³»ç»Ÿã€‹ ã€Šç”¨ELKæ­å»ºç®€å•çš„æ—¥å¿—æ”¶é›†åˆ†æžç³»ç»Ÿã€‹ ã€Šæ—¥å¿—æ”¶é›†ç³»ç»Ÿ-æŽ¢ç©¶ã€‹ é…ç½®ä¸­å¿ƒ Apollo - æºç¨‹å¼€æºçš„é…ç½®ä¸­å¿ƒåº”ç”¨ Spring Boot å’Œ Spring Cloud æ”¯æŒæŽ¨ã€æ‹‰æ¨¡å¼æ›´æ–°é…ç½® æ”¯æŒå¤šç§è¯­è¨€ ã€ŠåŸºäºŽzookeeperå®žçŽ°ç»Ÿä¸€é…ç½®ç®¡ç†ã€‹ ã€Š Spring Cloud Config åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒä½¿ç”¨æ•™ç¨‹ã€‹ servlet 3.0 å¼‚æ­¥ç‰¹æ€§å¯ç”¨äºŽé…ç½®ä¸­å¿ƒçš„å®¢æˆ·ç«¯ ã€Šservlet3.0 æ–°ç‰¹æ€§â€”â€”å¼‚æ­¥å¤„ç†ã€‹ API ç½‘å…³ä¸»è¦èŒè´£ï¼šè¯·æ±‚è½¬å‘ã€å®‰å…¨è®¤è¯ã€åè®®è½¬æ¢ã€å®¹ç¾ã€‚ ã€ŠAPIç½‘å…³é‚£äº›å„¿ã€‹ ã€Šè°ˆAPIç½‘å…³çš„èƒŒæ™¯ã€æž¶æž„ä»¥åŠè½åœ°æ–¹æ¡ˆã€‹ ã€Šä½¿ç”¨Zuulæž„å»ºAPI Gatewayã€‹ ã€ŠHTTP APIç½‘å…³é€‰æ‹©ä¹‹ä¸€Kongä»‹ç»ã€‹ ç½‘ç»œåè®®OSI ä¸ƒå±‚åè®® ã€ŠOSIä¸ƒå±‚åè®®æ¨¡åž‹ã€TCP/IPå››å±‚æ¨¡åž‹å­¦ä¹ ç¬”è®°ã€‹ TCP/IP ã€Šæ·±å…¥æµ…å‡º TCP/IP åè®®ã€‹ ã€ŠTCPåè®®ä¸­çš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ã€‹ HTTP ã€Šhttpåè®®è¯¦è§£(è¶…è¯¦ç»†)ã€‹ HTTP2.0 ã€ŠHTTP 2.0 åŽŸç†è¯¦ç»†åˆ†æžã€‹ ã€ŠHTTP2.0çš„åŸºæœ¬å•ä½ä¸ºäºŒè¿›åˆ¶å¸§ã€‹ åˆ©ç”¨äºŒè¿›åˆ¶å¸§è´Ÿè´£ä¼ è¾“ã€‚ å¤šè·¯å¤ç”¨ã€‚ HTTPS ã€ŠhttpsåŽŸç†é€šä¿—äº†è§£ã€‹ ä½¿ç”¨éžå¯¹ç§°åŠ å¯†åå•†åŠ å¯†ç®—æ³• ä½¿ç”¨å¯¹ç§°åŠ å¯†æ–¹å¼ä¼ è¾“æ•°æ® ä½¿ç”¨ç¬¬ä¸‰æ–¹æœºæž„ç­¾å‘çš„è¯ä¹¦ï¼Œæ¥åŠ å¯†å…¬é’¥ï¼Œç”¨äºŽå…¬é’¥çš„å®‰å…¨ä¼ è¾“ã€é˜²æ­¢è¢«ä¸­é—´äººä¸²æ”¹ã€‚ ã€Šå…«å¤§å…è´¹SSLè¯ä¹¦-ç»™ä½ çš„ç½‘ç«™å…è´¹æ·»åŠ Httpså®‰å…¨åŠ å¯†ã€‹ ç½‘ç»œæ¨¡åž‹ ã€Šwebä¼˜åŒ–å¿…é¡»äº†è§£çš„åŽŸç†ä¹‹I/oçš„äº”ç§æ¨¡åž‹å’Œwebçš„ä¸‰ç§å·¥ä½œæ¨¡å¼ã€‹ äº”ç§I/Oæ¨¡åž‹ï¼šé˜»å¡žI/Oï¼Œéžé˜»å¡žI/Oï¼ŒI/Oå¤ç”¨ã€äº‹ä»¶(ä¿¡å·)é©±åŠ¨I/Oã€å¼‚æ­¥I/Oï¼Œå‰å››ç§I/Oå±žäºŽåŒæ­¥æ“ä½œï¼ŒI/Oçš„ç¬¬ä¸€é˜¶æ®µä¸åŒã€ç¬¬äºŒé˜¶æ®µç›¸åŒï¼Œæœ€åŽçš„ä¸€ç§åˆ™å±žäºŽå¼‚æ­¥æ“ä½œã€‚ ä¸‰ç§ Web Server å·¥ä½œæ–¹å¼ï¼šPrefork(å¤šè¿›ç¨‹)ã€Workeræ–¹å¼(çº¿ç¨‹æ–¹å¼)ã€Eventæ–¹å¼ã€‚ ã€Šselectã€pollã€epollä¹‹é—´çš„åŒºåˆ«æ€»ç»“ã€‹ selectï¼Œpollï¼Œepollæœ¬è´¨ä¸Šéƒ½æ˜¯åŒæ­¥I/Oï¼Œå› ä¸ºä»–ä»¬éƒ½éœ€è¦åœ¨è¯»å†™äº‹ä»¶å°±ç»ªåŽè‡ªå·±è´Ÿè´£è¿›è¡Œè¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¯»å†™è¿‡ç¨‹æ˜¯é˜»å¡žçš„ã€‚ select æœ‰æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶ï¼Œé»˜è®¤1024ï¼ˆ2048 for x64ï¼‰ï¼Œ100ä¸‡å¹¶å‘ï¼Œå°±è¦ç”¨1000ä¸ªè¿›ç¨‹ã€åˆ‡æ¢å¼€é”€å¤§ï¼›pollé‡‡ç”¨é“¾è¡¨ç»“æž„ï¼Œæ²¡æœ‰æ•°é‡é™åˆ¶ã€‚ selectï¼Œpoll â€œé†’ç€â€çš„æ—¶å€™è¦éåŽ†æ•´ä¸ªfdé›†åˆï¼Œè€Œepollåœ¨â€œé†’ç€â€çš„æ—¶å€™åªè¦åˆ¤æ–­ä¸€ä¸‹å°±ç»ªé“¾è¡¨æ˜¯å¦ä¸ºç©ºå°±è¡Œäº†ï¼Œé€šè¿‡å›žè°ƒæœºåˆ¶èŠ‚çœå¤§é‡CPUæ—¶é—´ï¼›selectï¼Œpollæ¯æ¬¡è°ƒç”¨éƒ½è¦æŠŠfdé›†åˆä»Žç”¨æˆ·æ€å¾€å†…æ ¸æ€æ‹·è´ä¸€æ¬¡ï¼Œè€Œepollåªè¦ä¸€æ¬¡æ‹·è´ã€‚ pollä¼šéšç€å¹¶å‘å¢žåŠ ï¼Œæ€§èƒ½é€æ¸ä¸‹é™ï¼Œepollé‡‡ç”¨çº¢é»‘æ ‘ç»“æž„ï¼Œæ€§èƒ½ç¨³å®šï¼Œä¸ä¼šéšç€è¿žæŽ¥æ•°å¢žåŠ è€Œé™ä½Žã€‚ ã€Šselectï¼Œpollï¼Œepollæ¯”è¾ƒ ã€‹ åœ¨è¿žæŽ¥æ•°å°‘å¹¶ä¸”è¿žæŽ¥éƒ½ååˆ†æ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œselectå’Œpollçš„æ€§èƒ½å¯èƒ½æ¯”epollå¥½ï¼Œæ¯•ç«Ÿepollçš„é€šçŸ¥æœºåˆ¶éœ€è¦å¾ˆå¤šå‡½æ•°å›žè°ƒã€‚ ã€Šæ·±å…¥ç†è§£Java NIOã€‹ NIO æ˜¯ä¸€ç§åŒæ­¥éžé˜»å¡žçš„ IO æ¨¡åž‹ã€‚åŒæ­¥æ˜¯æŒ‡çº¿ç¨‹ä¸æ–­è½®è¯¢ IO äº‹ä»¶æ˜¯å¦å°±ç»ªï¼Œéžé˜»å¡žæ˜¯æŒ‡çº¿ç¨‹åœ¨ç­‰å¾… IO çš„æ—¶å€™ï¼Œå¯ä»¥åŒæ—¶åšå…¶ä»–ä»»åŠ¡ ã€ŠBIOä¸ŽNIOã€AIOçš„åŒºåˆ«ã€‹ ã€Šä¸¤ç§é«˜æ•ˆçš„æœåŠ¡å™¨è®¾è®¡æ¨¡åž‹ï¼šReactorå’ŒProactoræ¨¡åž‹ã€‹ Epoll ã€Šepollä½¿ç”¨è¯¦è§£ï¼ˆç²¾é«“ï¼‰ã€‹ Java NIO ã€Šæ·±å…¥ç†è§£Java NIOã€‹ ã€ŠJava NIOç¼–å†™SocketæœåŠ¡å™¨çš„ä¸€ä¸ªä¾‹å­ã€‹ kqueue ã€Škqueueç”¨æ³•ç®€ä»‹ã€‹ è¿žæŽ¥å’ŒçŸ­è¿žæŽ¥ ã€ŠTCP/IPç³»åˆ—â€”â€”é•¿è¿žæŽ¥ä¸ŽçŸ­è¿žæŽ¥çš„åŒºåˆ«ã€‹ æ¡†æž¶ ã€ŠNettyåŽŸç†å‰–æžã€‹ Reactor æ¨¡å¼ä»‹ç»ã€‚ Netty æ˜¯ Reactor æ¨¡å¼çš„ä¸€ç§å®žçŽ°ã€‚ é›¶æ‹·è´ï¼ˆZero-copyï¼‰ ã€Šå¯¹äºŽ Netty ByteBuf çš„é›¶æ‹·è´(Zero Copy) çš„ç†è§£ã€‹ å¤šä¸ªç‰©ç†åˆ†ç¦»çš„bufferï¼Œé€šè¿‡é€»è¾‘ä¸Šåˆå¹¶æˆä¸ºä¸€ä¸ªï¼Œä»Žè€Œé¿å…äº†æ•°æ®åœ¨å†…å­˜ä¹‹é—´çš„æ‹·è´ã€‚ åºåˆ—åŒ–(äºŒè¿›åˆ¶åè®®)Hessian ã€ŠHessianåŽŸç†åˆ†æžã€‹Binary-RPC;ä¸ä»…ä»…æ˜¯åºåˆ—åŒ– Protobuf ã€ŠProtobufåè®®çš„Javaåº”ç”¨ä¾‹å­ã€‹Goolgeå‡ºå“ã€å ç”¨ç©ºé—´å’Œæ•ˆçŽ‡å®Œèƒœå…¶ä»–åºåˆ—åŒ–ç±»åº“ï¼Œå¦‚Hessianï¼›éœ€è¦ç¼–å†™ .proto æ–‡ä»¶ã€‚ ã€ŠProtocol Buffersåºåˆ—åŒ–åè®®åŠåº”ç”¨ã€‹ * å…³äºŽåè®®çš„è§£é‡Šï¼›ç¼ºç‚¹ï¼šå¯è¯»æ€§å·®; ã€Šç®€å•çš„ä½¿ç”¨ protobuf å’Œ protostuffã€‹ protostuff çš„å¥½å¤„æ˜¯ä¸ç”¨å†™ .proto æ–‡ä»¶ï¼ŒJava å¯¹è±¡ç›´æŽ¥å°±å¯ä»¥åºåˆ—åŒ–ã€‚ æ•°æ®åº“åŸºç¡€ç†è®ºæ•°æ®åº“è®¾è®¡çš„ä¸‰å¤§èŒƒå¼ ã€Šæ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼ä»¥åŠäº”å¤§çº¦æŸã€‹ ç¬¬ä¸€èŒƒå¼ï¼šæ•°æ®è¡¨ä¸­çš„æ¯ä¸€åˆ—ï¼ˆæ¯ä¸ªå­—æ®µï¼‰å¿…é¡»æ˜¯ä¸å¯æ‹†åˆ†çš„æœ€å°å•å…ƒï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ¯ä¸€åˆ—çš„åŽŸå­æ€§ï¼› ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼šæ»¡è¶³1NFåŽï¼Œè¦æ±‚è¡¨ä¸­çš„æ‰€æœ‰åˆ—ï¼Œéƒ½å¿…é¡»ä¾èµ–äºŽä¸»é”®ï¼Œè€Œä¸èƒ½æœ‰ä»»ä½•ä¸€åˆ—ä¸Žä¸»é”®æ²¡æœ‰å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªè¡¨åªæè¿°ä¸€ä»¶äº‹æƒ…ï¼› ç¬¬ä¸‰èŒƒå¼ï¼šå¿…é¡»å…ˆæ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ï¼Œè¦æ±‚ï¼šè¡¨ä¸­çš„æ¯ä¸€åˆ—åªä¸Žä¸»é”®ç›´æŽ¥ç›¸å…³è€Œä¸æ˜¯é—´æŽ¥ç›¸å…³ï¼Œï¼ˆè¡¨ä¸­çš„æ¯ä¸€åˆ—åªèƒ½ä¾èµ–äºŽä¸»é”®ï¼‰ï¼› MySQLåŽŸç† ã€ŠMySQLçš„InnoDBç´¢å¼•åŽŸç†è¯¦è§£ã€‹ ã€ŠMySQLå­˜å‚¨å¼•æ“Žï¼ï¼MyISAMä¸ŽInnoDBåŒºåˆ«ã€‹ ä¸¤ç§ç±»åž‹æœ€ä¸»è¦çš„å·®åˆ«å°±æ˜¯Innodb æ”¯æŒäº‹åŠ¡å¤„ç†ä¸Žå¤–é”®å’Œè¡Œçº§é” ã€Šmyisamå’Œinnodbç´¢å¼•å®žçŽ°çš„ä¸åŒã€‹ InnoDB ã€Šä¸€ç¯‡æ–‡ç« å¸¦ä½ è¯»æ‡‚Mysqlå’ŒInnoDBã€‹ ä¼˜åŒ– ã€ŠMySQL36æ¡å†›è§„ã€‹ ã€ŠMYSQLæ€§èƒ½ä¼˜åŒ–çš„æœ€ä½³20+æ¡ç»éªŒã€‹ ã€ŠSQLä¼˜åŒ–ä¹‹é“ã€‹ ã€Šmysqlæ•°æ®åº“æ­»é”çš„äº§ç”ŸåŽŸå› åŠè§£å†³åŠžæ³•ã€‹ ã€Šå¯¼è‡´ç´¢å¼•å¤±æ•ˆçš„å¯èƒ½æƒ…å†µã€‹ ã€Š MYSQLåˆ†é¡µlimité€Ÿåº¦å¤ªæ…¢ä¼˜åŒ–æ–¹æ³•ã€‹ åŽŸåˆ™ä¸Šå°±æ˜¯ç¼©å°æ‰«æèŒƒå›´ã€‚ ç´¢å¼•èšé›†ç´¢å¼•, éžèšé›†ç´¢å¼• ã€ŠMySQL èšé›†ç´¢å¼•/éžèšé›†ç´¢å¼•ç®€è¿°ã€‹ ã€ŠMyISAMå’ŒInnoDBçš„ç´¢å¼•å®žçŽ°ã€‹ MyISAM æ˜¯éžèšé›†ï¼ŒInnoDB æ˜¯èšé›† å¤åˆç´¢å¼• ã€Šå¤åˆç´¢å¼•çš„ä¼˜ç‚¹å’Œæ³¨æ„äº‹é¡¹ã€‹ è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•(AHI) ã€ŠInnoDBå­˜å‚¨å¼•æ“Žâ€”â€”è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€‹ explain ã€ŠMySQL æ€§èƒ½ä¼˜åŒ–ç¥žå™¨ Explain ä½¿ç”¨åˆ†æžã€‹ NoSQLMongoDB MongoDB æ•™ç¨‹ ã€ŠMongodbç›¸å¯¹äºŽå…³ç³»åž‹æ•°æ®åº“çš„ä¼˜ç¼ºç‚¹ã€‹ ä¼˜ç‚¹ï¼šå¼±ä¸€è‡´æ€§ï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰ï¼Œæ›´èƒ½ä¿è¯ç”¨æˆ·çš„è®¿é—®é€Ÿåº¦ï¼›å†…ç½®GridFSï¼Œæ”¯æŒå¤§å®¹é‡çš„å­˜å‚¨ï¼›Schema-less æ•°æ®åº“ï¼Œä¸ç”¨é¢„å…ˆå®šä¹‰ç»“æž„ï¼›å†…ç½®Shardingï¼›ç›¸æ¯”äºŽå…¶ä»–NoSQLï¼Œç¬¬ä¸‰æ–¹æ”¯æŒä¸°å¯Œï¼›æ€§èƒ½ä¼˜è¶Šï¼› ç¼ºç‚¹ï¼šmongodbä¸æ”¯æŒäº‹åŠ¡æ“ä½œï¼›mongodbå ç”¨ç©ºé—´è¿‡å¤§ï¼›MongoDBæ²¡æœ‰å¦‚MySQLé‚£æ ·æˆç†Ÿçš„ç»´æŠ¤å·¥å…·ï¼Œè¿™å¯¹äºŽå¼€å‘å’ŒITè¿è¥éƒ½æ˜¯ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼› Hbase ã€Šç®€æ˜Ž HBase å…¥é—¨æ•™ç¨‹ï¼ˆå¼€ç¯‡ï¼‰ã€‹ ã€Šæ·±å…¥å­¦ä¹ HBaseæž¶æž„åŽŸç†ã€‹ ã€Šä¼ ç»Ÿçš„è¡Œå­˜å‚¨å’Œï¼ˆHBaseï¼‰åˆ—å­˜å‚¨çš„åŒºåˆ«ã€‹ ã€ŠHbaseä¸Žä¼ ç»Ÿæ•°æ®åº“çš„åŒºåˆ«ã€‹ ç©ºæ•°æ®ä¸å­˜å‚¨ï¼ŒèŠ‚çœç©ºé—´ï¼Œä¸”é€‚ç”¨äºŽå¹¶å‘ã€‚ ã€ŠHBase Rowkeyè®¾è®¡ã€‹ rowkey æŒ‰ç…§å­—å…¸é¡ºåºæŽ’åˆ—ï¼Œä¾¿äºŽæ‰¹é‡æ‰«æã€‚ é€šè¿‡æ•£åˆ—å¯ä»¥é¿å…çƒ­ç‚¹ã€‚ æœç´¢å¼•æ“Žæœç´¢å¼•æ“ŽåŽŸç† ã€Šå€’æŽ’ç´¢å¼•â€“æœç´¢å¼•æ“Žå…¥é—¨ã€‹ Lucene ã€ŠLuceneå…¥é—¨ç®€ä»‹ã€‹ Elasticsearch ã€ŠElasticsearchå­¦ä¹ ï¼Œè¯·å…ˆçœ‹è¿™ä¸€ç¯‡ï¼ã€‹ ã€ŠElasticsearchç´¢å¼•åŽŸç†ã€‹ Solr ã€Š Apache Solrå…¥é—¨æ•™ç¨‹ã€‹ ã€Šelasticsearchä¸Žsolræ¯”è¾ƒã€‹ sphinx ã€ŠSphinx çš„ä»‹ç»å’ŒåŽŸç†æŽ¢ç´¢ã€‹ æ€§èƒ½æ€§èƒ½ä¼˜åŒ–æ–¹æ³•è®º ã€Š15å¤©çš„æ€§èƒ½ä¼˜åŒ–å·¥ä½œï¼Œ5æ–¹é¢çš„è°ƒä¼˜ç»éªŒã€‹ ä»£ç å±‚é¢ã€ä¸šåŠ¡å±‚é¢ã€æ•°æ®åº“å±‚é¢ã€æœåŠ¡å™¨å±‚é¢ã€å‰ç«¯ä¼˜åŒ–ã€‚ ã€Šç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–çš„å‡ ä¸ªæ–¹é¢ã€‹ å®¹é‡è¯„ä¼° ã€Šè”ç½‘æ€§èƒ½ä¸Žå®¹é‡è¯„ä¼°çš„æ–¹æ³•è®ºå’Œå…¸åž‹æ¡ˆä¾‹ã€‹ ã€Šäº’è”ç½‘æž¶æž„ï¼Œå¦‚ä½•è¿›è¡Œå®¹é‡è®¾è®¡ï¼Ÿã€‹ è¯„ä¼°æ€»è®¿é—®é‡ã€è¯„ä¼°å¹³å‡è®¿é—®é‡QPSã€è¯„ä¼°é«˜å³°QPSã€è¯„ä¼°ç³»ç»Ÿã€å•æœºæžé™QPS CDN ç½‘ç»œ ã€ŠCDNåŠ é€ŸåŽŸç†ã€‹ ã€Šå›½å†…æœ‰å“ªäº›æ¯”è¾ƒå¥½çš„ CDNï¼Ÿã€‹ è¿žæŽ¥æ±  ã€Šä¸»æµJavaæ•°æ®åº“è¿žæŽ¥æ± æ¯”è¾ƒä¸Žå¼€å‘é…ç½®å®žæˆ˜ã€‹ æ€§èƒ½è°ƒä¼˜ ã€Šä¹å¤§Javaæ€§èƒ½è°ƒè¯•å·¥å…·ï¼Œå¿…å¤‡è‡³å°‘ä¸€æ¬¾ã€‹ å¤§æ•°æ®æµå¼è®¡ç®—Storm å®˜æ–¹ç½‘ç«™ ã€Šæœ€è¯¦ç»†çš„Stormå…¥é—¨æ•™ç¨‹ã€‹ Flink ã€ŠFlinkä¹‹ä¸€ FlinkåŸºæœ¬åŽŸç†ä»‹ç»ã€‹ Kafka Stream ã€ŠKafka Streamè°ƒç ”ï¼šä¸€ç§è½»é‡çº§æµè®¡ç®—æ¨¡å¼ã€‹ åº”ç”¨åœºæ™¯ä¾‹å¦‚ï¼š å¹¿å‘Šç›¸å…³å®žæ—¶ç»Ÿè®¡ï¼› æŽ¨èç³»ç»Ÿç”¨æˆ·ç”»åƒæ ‡ç­¾å®žæ—¶æ›´æ–°ï¼› çº¿ä¸ŠæœåŠ¡å¥åº·çŠ¶å†µå®žæ—¶ç›‘æµ‹ï¼› å®žæ—¶æ¦œå•ï¼› å®žæ—¶æ•°æ®ç»Ÿè®¡ã€‚ Hadoop ã€Šç”¨é€šä¿—æ˜“æ‡‚çš„è¯è¯´ä¸‹hadoopæ˜¯ä»€ä¹ˆ,èƒ½åšä»€ä¹ˆã€‹ ã€Šå²ä¸Šæœ€è¯¦ç»†çš„HadoopçŽ¯å¢ƒæ­å»ºã€‹ HDFS ã€Šã€Hadoopå­¦ä¹ ã€‘HDFSåŸºæœ¬åŽŸç†ã€‹ MapReduce ã€Šç”¨é€šä¿—æ˜“æ‡‚çš„å¤§ç™½è¯è®²è§£Map/ReduceåŽŸç†ã€‹ ã€Š ç®€å•çš„map-reduceçš„javaä¾‹å­ã€‹ Yarn ã€Šåˆæ­¥æŽŒæ¡Yarnçš„æž¶æž„åŠåŽŸç†ã€‹ Spark ã€ŠSpark(ä¸€): åŸºæœ¬æž¶æž„åŠåŽŸç†ã€‹ å®‰å…¨web å®‰å…¨XSS ã€Šxssæ”»å‡»åŽŸç†ä¸Žè§£å†³æ–¹æ³•ã€‹CSRF ã€ŠCSRFåŽŸç†åŠé˜²èŒƒã€‹ SQL æ³¨å…¥ ã€ŠSQLæ³¨å…¥ã€‹ Hash Dos ã€Šé‚ªæ¶çš„JAVA HASH DOSæ”»å‡»ã€‹ åˆ©ç”¨JsonObjet ä¸Šä¼ å¤§Jsonï¼ŒJsonObject åº•å±‚ä½¿ç”¨HashMapï¼›ä¸åŒçš„æ•°æ®äº§ç”Ÿç›¸åŒçš„hashå€¼ï¼Œä½¿å¾—æž„å»ºHashé€Ÿåº¦å˜æ…¢ï¼Œè€—å°½CPUã€‚ ã€Šä¸€ç§é«˜çº§çš„DoSæ”»å‡»-Hashç¢°æ’žæ”»å‡»ã€‹ ã€Šå…³äºŽHash Collision DoSæ¼æ´žï¼šè§£æžä¸Žè§£å†³æ–¹æ¡ˆã€‹ è„šæœ¬æ³¨å…¥ ã€Šä¸Šä¼ æ–‡ä»¶æ¼æ´žåŽŸç†åŠé˜²èŒƒã€‹ æ¼æ´žæ‰«æå·¥å…· ã€ŠDVWAã€‹ W3af OpenVASè¯¦è§£ éªŒè¯ç  ã€ŠéªŒè¯ç åŽŸç†åˆ†æžåŠå®žçŽ°ã€‹ ã€Šè¯¦è§£æ»‘åŠ¨éªŒè¯ç çš„å®žçŽ°åŽŸç†ã€‹ æ»‘åŠ¨éªŒè¯ç æ˜¯æ ¹æ®äººåœ¨æ»‘åŠ¨æ»‘å—çš„å“åº”æ—¶é—´ï¼Œæ‹–æ‹½é€Ÿåº¦ï¼Œæ—¶é—´ï¼Œä½ç½®ï¼Œè½¨è¿¹ï¼Œé‡è¯•æ¬¡æ•°ç­‰æ¥è¯„ä¼°é£Žé™©ã€‚ ã€Šæ·˜å®æ»‘åŠ¨éªŒè¯ç ç ”ç©¶ã€‹ DDoS é˜²èŒƒ ã€Šå­¦ä¹ æ‰‹å†Œï¼šDDoSçš„æ”»å‡»æ–¹å¼åŠé˜²å¾¡æ‰‹æ®µã€‹ ã€Šå…è´¹DDoSæ”»å‡»æµ‹è¯•å·¥å…·å¤§åˆé›†ã€‹ ç”¨æˆ·éšç§ä¿¡æ¯ä¿æŠ¤ ç”¨æˆ·å¯†ç éžæ˜Žæ–‡ä¿å­˜ï¼ŒåŠ åŠ¨æ€slatã€‚ èº«ä»½è¯å·ï¼Œæ‰‹æœºå·å¦‚æžœè¦æ˜¾ç¤ºï¼Œç”¨ â€œ*â€ æ›¿ä»£éƒ¨åˆ†å­—ç¬¦ã€‚ è”ç³»æ–¹å¼åœ¨çš„æ˜¾ç¤ºä¸Žå¦ç”±ç”¨æˆ·è‡ªå·±æŽ§åˆ¶ã€‚ TODO ã€Šä¸ªäººéšç§åŒ…æ‹¬å“ªäº›ã€‹ ã€Šåœ¨äº’è”ç½‘ä¸Šï¼Œéšç§çš„èŒƒå›´åŒ…æ‹¬å“ªäº›ï¼Ÿã€‹ ã€Šç”¨æˆ·å¯†ç ä¿å­˜ã€‹ åºåˆ—åŒ–æ¼æ´ž ã€ŠLibä¹‹è¿‡ï¼ŸJavaååºåˆ—åŒ–æ¼æ´žé€šç”¨åˆ©ç”¨åˆ†æžã€‹ åŠ å¯†è§£å¯†å¯¹ç§°åŠ å¯† ã€Šå¸¸è§å¯¹ç§°åŠ å¯†ç®—æ³•ã€‹ DESã€3DESã€Blowfishã€AES DES é‡‡ç”¨ 56ä½ç§˜é’¥ï¼ŒBlowfish é‡‡ç”¨1åˆ°448ä½å˜é•¿ç§˜é’¥ï¼ŒAES 128ï¼Œ192å’Œ256ä½é•¿åº¦çš„ç§˜é’¥ã€‚ DES ç§˜é’¥å¤ªçŸ­ï¼ˆåªæœ‰56ä½ï¼‰ç®—æ³•ç›®å‰å·²ç»è¢« AES å–ä»£ï¼Œå¹¶ä¸” AES æœ‰ç¡¬ä»¶åŠ é€Ÿï¼Œæ€§èƒ½å¾ˆå¥½ã€‚ å“ˆå¸Œç®—æ³• ã€Šå¸¸ç”¨çš„å“ˆå¸Œç®—æ³•ã€‹ MD5 å’Œ SHA-1 å·²ç»ä¸å†å®‰å…¨ï¼Œå·²è¢«å¼ƒç”¨ã€‚ ç›®å‰ SHA-256 æ˜¯æ¯”è¾ƒå®‰å…¨çš„ã€‚ ã€ŠåŸºäºŽHashæ‘˜è¦ç­¾åçš„å…¬ç½‘URLç­¾åéªŒè¯è®¾è®¡æ–¹æ¡ˆã€‹ éžå¯¹ç§°åŠ å¯† ã€Šå¸¸è§éžå¯¹ç§°åŠ å¯†ç®—æ³•ã€‹ RSAã€DSAã€ECDSA(èžºæ—‹æ›²çº¿åŠ å¯†ç®—æ³•) å’Œ RSA ä¸åŒçš„æ˜¯ DSA ä»…èƒ½ç”¨äºŽæ•°å­—ç­¾åï¼Œä¸èƒ½è¿›è¡Œæ•°æ®åŠ å¯†è§£å¯†ï¼Œå…¶å®‰å…¨æ€§å’ŒRSAç›¸å½“ï¼Œä½†å…¶æ€§èƒ½è¦æ¯”RSAå¿«ã€‚ 256ä½çš„ECCç§˜é’¥çš„å®‰å…¨æ€§ç­‰åŒäºŽ3072ä½çš„RSAç§˜é’¥ã€‚ ã€ŠåŒºå—é“¾çš„åŠ å¯†æŠ€æœ¯ã€‹ æœåŠ¡å™¨å®‰å…¨ ã€ŠLinuxå¼ºåŒ–è®ºï¼š15æ­¥æ‰“é€ ä¸€ä¸ªå®‰å…¨çš„LinuxæœåŠ¡å™¨ã€‹ æ•°æ®å®‰å…¨æ•°æ®å¤‡ä»½TODO ç½‘ç»œéš”ç¦»å†…å¤–ç½‘åˆ†ç¦»TODO ç™»å½•è·³æ¿æœºåœ¨å†…å¤–çŽ¯å¢ƒä¸­é€šè¿‡è·³æ¿æœºç™»å½•åˆ°çº¿ä¸Šä¸»æœºã€‚ ã€Šæ­å»ºç®€æ˜“å ¡åž’æœºã€‹ æŽˆæƒã€è®¤è¯RBAC ã€ŠåŸºäºŽç»„ç»‡è§’è‰²çš„æƒé™è®¾è®¡ã€‹ ã€Šæƒé™ç³»ç»Ÿä¸ŽRBACæ¨¡åž‹æ¦‚è¿°ã€‹ ã€ŠSpringæ•´åˆShiroåšæƒé™æŽ§åˆ¶æ¨¡å—è¯¦ç»†æ¡ˆä¾‹åˆ†æžã€‹ OAuth2.0 ã€Šç†è§£OAuth 2.0ã€‹ åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰2FA - Two-factor authenticationï¼Œç”¨äºŽåŠ å¼ºç™»å½•éªŒè¯ å¸¸ç”¨åšæ³•æ˜¯ ç™»å½•å¯†ç  + æ‰‹æœºéªŒè¯ç ï¼ˆæˆ–è€…ä»¤ç‰ŒKeyï¼Œç±»ä¼¼äºŽä¸Žç½‘é“¶çš„ USB keyï¼‰ ã€ã€ŠåŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰æ•™ç¨‹ã€‹ã€‘(http://www.ruanyifeng.com/blog/2017/11/2fa-tutorial.html) å•ç‚¹ç™»å½•(SSO) ã€Šå•ç‚¹ç™»å½•åŽŸç†ä¸Žç®€å•å®žçŽ°ã€‹ CASå•ç‚¹ç™»å½•æ¡†æž¶ å¸¸ç”¨å¼€æºæ¡†æž¶å¼€æºåè®® ã€Šå¼€æºåè®®çš„é€‰æ‹©ã€‹ å¦‚ä½•é€‰æ‹©ä¸€ä¸ªå¼€æºè½¯ä»¶åè®® æ—¥å¿—æ¡†æž¶Log4jã€Log4j2 ã€Šlog4j è¯¦ç»†è®²è§£ã€‹ ã€Šlog4j2 å®žé™…ä½¿ç”¨è¯¦è§£ã€‹ ã€ŠLog4j1,Logbackä»¥åŠLog4j2æ€§èƒ½æµ‹è¯•å¯¹æ¯”ã€‹ Log4J å¼‚æ­¥æ—¥å¿—æ€§èƒ½ä¼˜å¼‚ã€‚ Logback ã€Šæœ€å…¨LogBack è¯¦è§£ã€å«javaæ¡ˆä¾‹å’Œé…ç½®è¯´æ˜Žã€‹ ORM ã€ŠORMæ¡†æž¶ä½¿ç”¨ä¼˜ç¼ºç‚¹ã€‹ ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æé«˜å¼€å‘æ•ˆçŽ‡ã€‚ MyBatisï¼š ã€Šmybatisç¼“å­˜æœºåˆ¶è¯¦è§£ã€‹ ä¸€çº§ç¼“å­˜æ˜¯SqlSessionçº§åˆ«çš„ç¼“å­˜ï¼Œç¼“å­˜çš„æ•°æ®åªåœ¨SqlSessionå†…æœ‰æ•ˆ äºŒçº§ç¼“å­˜æ˜¯mapperçº§åˆ«çš„ç¼“å­˜ï¼ŒåŒä¸€ä¸ªnamespaceå…¬ç”¨è¿™ä¸€ä¸ªç¼“å­˜ï¼Œæ‰€ä»¥å¯¹SqlSessionæ˜¯å…±äº«çš„ï¼›ä½¿ç”¨ LRU æœºåˆ¶æ¸…ç†ç¼“å­˜ï¼Œé€šè¿‡ cacheEnabled å‚æ•°å¼€å¯ã€‚ ã€ŠMyBatiså­¦ä¹ ä¹‹ä»£ç ç”Ÿæˆå™¨Generatorã€‹ ç½‘ç»œæ¡†æž¶TODO Web æ¡†æž¶Spring å®¶æ—Spring Spring ç®€æ˜Žæ•™ç¨‹ Spring Boot å®˜æ–¹ç½‘ç«™ ã€ŠSpring BootåŸºç¡€æ•™ç¨‹ã€‹ Spring Cloud Spring Boot ä¸­æ–‡ç´¢å¼•ç«™ Spring Cloud ä¸­æ–‡æ–‡æ¡£ ã€ŠSpring CloudåŸºç¡€æ•™ç¨‹ã€‹ å·¥å…·æ¡†æž¶ ã€ŠApache Commons å·¥å…·ç±»ä»‹ç»åŠç®€å•ä½¿ç”¨ã€‹ ã€ŠGoogle guava ä¸­æ–‡æ•™ç¨‹ã€‹ åˆ†å¸ƒå¼è®¾è®¡æ‰©å±•æ€§è®¾è®¡ ã€Šæž¶æž„å¸ˆä¸å¯ä¸çŸ¥çš„åå¤§å¯æ‰©å±•æž¶æž„ã€‹ æ€»ç»“ä¸‹æ¥ï¼Œé€šç”¨çš„å¥—è·¯å°±æ˜¯åˆ†å¸ƒã€ç¼“å­˜åŠå¼‚æ­¥å¤„ç†ã€‚ ã€Šå¯æ‰©å±•æ€§è®¾è®¡ä¹‹æ•°æ®åˆ‡åˆ†ã€‹ æ°´å¹³åˆ‡åˆ†+åž‚ç›´åˆ‡åˆ† åˆ©ç”¨ä¸­é—´ä»¶è¿›è¡Œåˆ†ç‰‡å¦‚ï¼ŒMySQL Proxyã€‚ åˆ©ç”¨åˆ†ç‰‡ç­–ç•¥è¿›è¡Œåˆ‡åˆ†ï¼Œå¦‚æŒ‰ç…§IDå–æ¨¡ã€‚ ã€Šè¯´è¯´å¦‚ä½•å®žçŽ°å¯æ‰©å±•æ€§çš„å¤§åž‹ç½‘ç«™æž¶æž„ã€‹ åˆ†å¸ƒå¼æœåŠ¡+æ¶ˆæ¯é˜Ÿåˆ—ã€‚ ã€Šå¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„ï¼ˆä¸ƒï¼‰â€“ç½‘ç«™çš„å¯æ‰©å±•æ€§æž¶æž„ã€‹ ç¨³å®šæ€§ &amp; é«˜å¯ç”¨ ã€Šç³»ç»Ÿè®¾è®¡ï¼šå…³äºŽé«˜å¯ç”¨ç³»ç»Ÿçš„ä¸€äº›æŠ€æœ¯æ–¹æ¡ˆã€‹ å¯æ‰©å±•ï¼šæ°´å¹³æ‰©å±•ã€åž‚ç›´æ‰©å±•ã€‚ é€šè¿‡å†—ä½™éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚ éš”ç¦»ï¼šé¿å…å•ä¸€ä¸šåŠ¡å ç”¨å…¨éƒ¨èµ„æºã€‚é¿å…ä¸šåŠ¡ä¹‹é—´çš„ç›¸äº’å½±å“ 2. æœºæˆ¿éš”ç¦»é¿å…å•ç‚¹æ•…éšœã€‚ è§£è€¦ï¼šé™ä½Žç»´æŠ¤æˆæœ¬ï¼Œé™ä½Žè€¦åˆé£Žé™©ã€‚å‡å°‘ä¾èµ–ï¼Œå‡å°‘ç›¸äº’é—´çš„å½±å“ã€‚ é™æµï¼šæ»‘åŠ¨çª—å£è®¡æ•°æ³•ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ç­‰ç®—æ³•ã€‚é‡åˆ°çªå‘æµé‡æ—¶ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šã€‚ é™çº§ï¼šç´§æ€¥æƒ…å†µä¸‹é‡Šæ”¾éžæ ¸å¿ƒåŠŸèƒ½çš„èµ„æºã€‚ç‰ºç‰²éžæ ¸å¿ƒä¸šåŠ¡ï¼Œä¿è¯æ ¸å¿ƒä¸šåŠ¡çš„é«˜å¯ç”¨ã€‚ ç†”æ–­ï¼šå¼‚å¸¸æƒ…å†µè¶…å‡ºé˜ˆå€¼è¿›å…¥ç†”æ–­çŠ¶æ€ï¼Œå¿«é€Ÿå¤±è´¥ã€‚å‡å°‘ä¸ç¨³å®šçš„å¤–éƒ¨ä¾èµ–å¯¹æ ¸å¿ƒæœåŠ¡çš„å½±å“ã€‚ è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šé€šè¿‡å®Œå–„çš„æµ‹è¯•ï¼Œå‡å°‘å‘å¸ƒå¼•èµ·çš„æ•…éšœã€‚ ç°åº¦å‘å¸ƒï¼šç°åº¦å‘å¸ƒæ˜¯é€Ÿåº¦ä¸Žå®‰å…¨æ€§ä½œä¸ºå¦¥åï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘å‘å¸ƒæ•…éšœã€‚ ã€Šå…³äºŽé«˜å¯ç”¨çš„ç³»ç»Ÿã€‹ è®¾è®¡åŽŸåˆ™ï¼šæ•°æ®ä¸ä¸¢(æŒä¹…åŒ–)ï¼›æœåŠ¡é«˜å¯ç”¨(æœåŠ¡å‰¯æœ¬)ï¼›ç»å¯¹çš„100%é«˜å¯ç”¨å¾ˆéš¾ï¼Œç›®æ ‡æ˜¯åšåˆ°å°½å¯èƒ½å¤šçš„9ï¼Œå¦‚99.999%ï¼ˆå…¨å¹´ç´¯è®¡åªæœ‰5åˆ†é’Ÿï¼‰ã€‚ ç¡¬ä»¶è´Ÿè½½å‡è¡¡ ã€Šè½¬ï¼ï¼è´Ÿè½½å‡è¡¡å™¨æŠ€æœ¯Nginxå’ŒF5çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”ã€‹ ä¸»è¦æ˜¯å’ŒF5å¯¹æ¯”ã€‚ ã€Šè½¯/ç¡¬ä»¶è´Ÿè½½å‡è¡¡äº§å“ ä½ çŸ¥å¤šå°‘ï¼Ÿã€‹ è½¯ä»¶è´Ÿè½½å‡è¡¡ ã€Šå‡ ç§è´Ÿè½½å‡è¡¡ç®—æ³•ã€‹ è½®å¯»ã€æƒé‡ã€è´Ÿè½½ã€æœ€å°‘è¿žæŽ¥ã€QoS ã€ŠDNSè´Ÿè½½å‡è¡¡ã€‹ é…ç½®ç®€å•ï¼Œæ›´æ–°é€Ÿåº¦æ…¢ã€‚ ã€ŠNginxè´Ÿè½½å‡è¡¡ã€‹ ç®€å•è½»é‡ã€å­¦ä¹ æˆæœ¬ä½Žï¼›ä¸»è¦é€‚ç”¨äºŽwebåº”ç”¨ã€‚ ã€Šå€ŸåŠ©LVS+Keepalivedå®žçŽ°è´Ÿè½½å‡è¡¡ ã€‹ é…ç½®æ¯”è¾ƒè´Ÿè½½ã€åªæ”¯æŒåˆ°4å±‚ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚ ã€ŠHAProxyç”¨æ³•è¯¦è§£ å…¨ç½‘æœ€è¯¦ç»†ä¸­æ–‡æ–‡æ¡£ã€‹ æ”¯æŒåˆ°ä¸ƒå±‚ï¼ˆæ¯”å¦‚HTTPï¼‰ã€åŠŸèƒ½æ¯”è¾ƒå…¨é¢ï¼Œæ€§èƒ½ä¹Ÿä¸é”™ã€‚ ã€ŠHaproxy+Keepalived+MySQLå®žçŽ°è¯»å‡è¡¡è´Ÿè½½ã€‹ ä¸»è¦æ˜¯ç”¨æˆ·è¯»è¯·æ±‚çš„è´Ÿè½½å‡è¡¡ã€‚ ã€Šrabbitmq+haproxy+keepalivedå®žçŽ°é«˜å¯ç”¨é›†ç¾¤æ­å»ºã€‹ é™æµ ã€Šè°ˆè°ˆé«˜å¹¶å‘ç³»ç»Ÿçš„é™æµã€‹ è®¡æ•°å™¨ï¼šé€šè¿‡æ»‘åŠ¨çª—å£è®¡æ•°å™¨ï¼ŒæŽ§åˆ¶å•ä½æ—¶é—´å†…çš„è¯·æ±‚æ¬¡æ•°ï¼Œç®€å•ç²—æš´ã€‚ æ¼æ¡¶ç®—æ³•ï¼šå›ºå®šå®¹é‡çš„æ¼æ¡¶ï¼Œæ¼æ¡¶æ»¡äº†å°±ä¸¢å¼ƒè¯·æ±‚ï¼Œæ¯”è¾ƒå¸¸ç”¨ã€‚ ä»¤ç‰Œæ¡¶ç®—æ³•ï¼šå›ºå®šå®¹é‡çš„ä»¤ç‰Œæ¡¶ï¼ŒæŒ‰ç…§ä¸€å®šé€ŸçŽ‡æ·»åŠ ä»¤ç‰Œï¼Œå¤„ç†è¯·æ±‚å‰éœ€è¦æ‹¿åˆ°ä»¤ç‰Œï¼Œæ‹¿ä¸åˆ°ä»¤ç‰Œåˆ™ä¸¢å¼ƒè¯·æ±‚ï¼Œæˆ–è¿›å…¥ä¸¢é˜Ÿåˆ—ï¼Œå¯ä»¥é€šè¿‡æŽ§åˆ¶æ·»åŠ ä»¤ç‰Œçš„é€ŸçŽ‡ï¼Œæ¥æŽ§åˆ¶æ•´ä½“é€Ÿåº¦ã€‚Guava ä¸­çš„ RateLimiter æ˜¯ä»¤ç‰Œæ¡¶çš„å®žçŽ°ã€‚ Nginx é™æµï¼šé€šè¿‡ limit_req ç­‰æ¨¡å—é™åˆ¶å¹¶å‘è¿žæŽ¥æ•°ã€‚ åº”ç”¨å±‚å®¹ç¾ ã€Šé˜²é›ªå´©åˆ©å™¨ï¼šç†”æ–­å™¨ Hystrix çš„åŽŸç†ä¸Žä½¿ç”¨ã€‹ é›ªå´©æ•ˆåº”åŽŸå› ï¼šç¡¬ä»¶æ•…éšœã€ç¡¬ä»¶æ•…éšœã€ç¨‹åºBugã€é‡è¯•åŠ å¤§æµé‡ã€ç”¨æˆ·å¤§é‡è¯·æ±‚ã€‚ é›ªå´©çš„å¯¹ç­–ï¼šé™æµã€æ”¹è¿›ç¼“å­˜æ¨¡å¼(ç¼“å­˜é¢„åŠ è½½ã€åŒæ­¥è°ƒç”¨æ”¹å¼‚æ­¥)ã€è‡ªåŠ¨æ‰©å®¹ã€é™çº§ã€‚ Hystrixè®¾è®¡åŽŸåˆ™ï¼š èµ„æºéš”ç¦»ï¼šHystrixé€šè¿‡å°†æ¯ä¸ªä¾èµ–æœåŠ¡åˆ†é…ç‹¬ç«‹çš„çº¿ç¨‹æ± è¿›è¡Œèµ„æºéš”ç¦», ä»Žè€Œé¿å…æœåŠ¡é›ªå´©ã€‚ ç†”æ–­å¼€å…³ï¼šæœåŠ¡çš„å¥åº·çŠ¶å†µ = è¯·æ±‚å¤±è´¥æ•° / è¯·æ±‚æ€»æ•°ï¼Œé€šè¿‡é˜ˆå€¼è®¾å®šå’Œæ»‘åŠ¨çª—å£æŽ§åˆ¶å¼€å…³ã€‚ å‘½ä»¤æ¨¡å¼ï¼šé€šè¿‡ç»§æ‰¿ HystrixCommand æ¥åŒ…è£…æœåŠ¡è°ƒç”¨é€»è¾‘ã€‚ ã€Šç¼“å­˜ç©¿é€ï¼Œç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜é›ªå´©è§£å†³æ–¹æ¡ˆåˆ†æžã€‹ ã€Šç¼“å­˜å‡»ç©¿ã€å¤±æ•ˆä»¥åŠçƒ­ç‚¹keyé—®é¢˜ã€‹ ä¸»è¦ç­–ç•¥ï¼šå¤±æ•ˆçž¬é—´ï¼šå•æœºä½¿ç”¨é”ï¼›ä½¿ç”¨åˆ†å¸ƒå¼é”ï¼›ä¸è¿‡æœŸï¼› çƒ­ç‚¹æ•°æ®ï¼šçƒ­ç‚¹æ•°æ®å•ç‹¬å­˜å‚¨ï¼›ä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼›åˆ†æˆå¤šä¸ªå­keyï¼› è·¨æœºæˆ¿å®¹ç¾ ã€Šâ€œå¼‚åœ°å¤šæ´»â€å¤šæœºæˆ¿éƒ¨ç½²ç»éªŒè°ˆã€‹ é€šè¿‡è‡ªç ”ä¸­é—´ä»¶è¿›è¡Œæ•°æ®åŒæ­¥ã€‚ ã€Šå¼‚åœ°å¤šæ´»ï¼ˆå¼‚åœ°åŒæ´»ï¼‰å®žè·µç»éªŒã€‹ æ³¨æ„å»¶è¿Ÿé—®é¢˜ï¼Œå¤šæ¬¡è·¨æœºæˆ¿è°ƒç”¨ä¼šå°†å»¶æ—¶æ”¾å¤§æ•°å€ã€‚ å»ºæˆ¿é—´ä¸“çº¿å¾ˆå¤§æ¦‚çŽ‡ä¼šå‡ºçŽ°é—®é¢˜ï¼Œåšå¥½è¿ç»´å’Œç¨‹åºå±‚é¢çš„å®¹é”™ã€‚ ä¸èƒ½ä¾èµ–äºŽç¨‹åºç«¯æ•°æ®åŒå†™ï¼Œè¦æœ‰è‡ªåŠ¨åŒæ­¥æ–¹æ¡ˆã€‚ æ•°æ®æ°¸ä¸åœ¨é«˜å»¶è¿Ÿå’Œè¾ƒå·®ç½‘ç»œè´¨é‡ä¸‹ï¼Œè€ƒè™‘åŒæ­¥è´¨é‡é—®é¢˜ã€‚ æ ¸å¿ƒä¸šåŠ¡å’Œæ¬¡è¦ä¸šåŠ¡åˆ†è€Œæ²»ä¹‹ï¼Œç”šè‡³åªè€ƒè™‘æ ¸å¿ƒä¸šåŠ¡ã€‚ å¼‚åœ°å¤šæ´»ç›‘æŽ§éƒ¨ç½²ã€æµ‹è¯•ä¹Ÿè¦è·Ÿä¸Šã€‚ ä¸šåŠ¡å…è®¸çš„æƒ…å†µä¸‹è€ƒè™‘ç”¨æˆ·åˆ†åŒºï¼Œå°¤å…¶æ˜¯æ¸¸æˆã€é‚®ç®±ä¸šåŠ¡ã€‚ æŽ§åˆ¶è·¨æœºæˆ¿æ¶ˆæ¯ä½“å¤§å°ï¼Œè¶Šå°è¶Šå¥½ã€‚ è€ƒè™‘ä½¿ç”¨dockerå®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œæé«˜åŠ¨æ€è°ƒåº¦èƒ½åŠ›ã€‚ å®¹ç¾æŠ€æœ¯åŠå»ºè®¾ç»éªŒä»‹ç» å®¹ç¾æ¼”ç»ƒæµç¨‹ ã€Šä¾èµ–æ²»ç†ã€ç°åº¦å‘å¸ƒã€æ•…éšœæ¼”ç»ƒï¼Œé˜¿é‡Œç”µå•†æ•…éšœæ¼”ç»ƒç³»ç»Ÿçš„è®¾è®¡ä¸Žå®žæˆ˜ç»éªŒã€‹ å¸¸è§æ•…éšœç”»åƒ æ¡ˆä¾‹ï¼šé¢„æ¡ˆæœ‰æ•ˆæ€§ã€é¢„æ¡ˆæœ‰æ•ˆæ€§ã€æ•…éšœå¤çŽ°ã€æž¶æž„å®¹ç¾æµ‹è¯•ã€å‚æ•°è°ƒä¼˜ã€å‚æ•°è°ƒä¼˜ã€æ•…éšœçªè¢­ã€è”åˆæ¼”ç»ƒã€‚ å¹³æ»‘å¯åŠ¨ å¹³æ»‘é‡å¯åº”ç”¨æ€è·¯1.ç«¯æµé‡ï¼ˆå¦‚vipå±‚ï¼‰ã€2. flush æ•°æ®(å¦‚æžœæœ‰)ã€3, é‡å¯åº”ç”¨ ã€ŠJVMå®‰å…¨é€€å‡ºï¼ˆå¦‚ä½•ä¼˜é›…çš„å…³é—­javaæœåŠ¡ï¼‰ã€‹æŽ¨èæŽ¨å‡ºæ–¹å¼ï¼šSystem.exitï¼ŒKill SIGTERMï¼›ä¸æŽ¨è kill-9ï¼›ç”¨ Runtime.addShutdownHook æ³¨å†Œé’©å­ã€‚ ã€Šå¸¸è§Javaåº”ç”¨å¦‚ä½•ä¼˜é›…å…³é—­ã€‹Javaã€Srpingã€Dubbo ä¼˜é›…å…³é—­æ–¹å¼ã€‚ æ•°æ®åº“æ‰©å±•è¯»å†™åˆ†ç¦»æ¨¡å¼ ã€ŠMysqlä¸»ä»Žæ–¹æ¡ˆçš„å®žçŽ°ã€‹ ã€Šæ­å»ºMySQLä¸»ä»Žå¤åˆ¶ç»å…¸æž¶æž„ã€‹ ã€ŠHaproxy+å¤šå°MySQLä»ŽæœåŠ¡å™¨(Slave) å®žçŽ°è´Ÿè½½å‡è¡¡ã€‹ ã€ŠDRBD+Heartbeat+Mysqlé«˜å¯ç”¨è¯»å†™åˆ†ç¦»æž¶æž„ã€‹ DRDB è¿›è¡Œç£ç›˜å¤åˆ¶ï¼Œé¿å…å•ç‚¹é—®é¢˜ã€‚ ã€ŠMySQL Cluster æ–¹å¼ã€‹ åˆ†ç‰‡æ¨¡å¼ ã€Šåˆ†åº“åˆ†è¡¨éœ€è¦è€ƒè™‘çš„é—®é¢˜åŠæ–¹æ¡ˆã€‹ ä¸­é—´ä»¶ï¼š è½»é‡çº§ï¼šsharding-jdbcã€TShardingï¼›é‡é‡çº§ï¼šAtlasã€MyCATã€Vitessç­‰ã€‚ é—®é¢˜ï¼šäº‹åŠ¡ã€Joinã€è¿ç§»ã€æ‰©å®¹ã€IDã€åˆ†é¡µç­‰ã€‚ äº‹åŠ¡è¡¥å¿ï¼šå¯¹æ•°æ®è¿›è¡Œå¯¹å¸æ£€æŸ¥;åŸºäºŽæ—¥å¿—è¿›è¡Œæ¯”å¯¹;å®šæœŸåŒæ ‡å‡†æ•°æ®æ¥æºè¿›è¡ŒåŒæ­¥ç­‰ã€‚ åˆ†åº“ç­–ç•¥ï¼šæ•°å€¼èŒƒå›´ï¼›å–æ¨¡ï¼›æ—¥æœŸç­‰ã€‚ åˆ†åº“æ•°é‡ï¼šé€šå¸¸ MySQL å•åº“ 5åƒä¸‡æ¡ã€Oracle å•åº“ä¸€äº¿æ¡éœ€è¦åˆ†åº“ã€‚ ã€ŠMySqlåˆ†è¡¨å’Œè¡¨åˆ†åŒºè¯¦è§£ã€‹ åˆ†åŒºï¼šæ˜¯MySQLå†…éƒ¨æœºåˆ¶ï¼Œå¯¹å®¢æˆ·ç«¯é€æ˜Žï¼Œæ•°æ®å­˜å‚¨åœ¨ä¸åŒæ–‡ä»¶ä¸­ï¼Œè¡¨é¢ä¸Šçœ‹æ˜¯åŒä¸€ä¸ªè¡¨ã€‚ åˆ†è¡¨ï¼šç‰©ç†ä¸Šåˆ›å»ºä¸åŒçš„è¡¨ã€å®¢æˆ·ç«¯éœ€è¦ç®¡ç†åˆ†è¡¨è·¯ç”±ã€‚ æœåŠ¡æ²»ç†æœåŠ¡æ³¨å†Œä¸Žå‘çŽ° ã€Šæ°¸ä¸å¤±è”ï¼å¦‚ä½•å®žçŽ°å¾®æœåŠ¡æž¶æž„ä¸­çš„æœåŠ¡å‘çŽ°ï¼Ÿã€‹ å®¢æˆ·ç«¯æœåŠ¡å‘çŽ°æ¨¡å¼ï¼šå®¢æˆ·ç«¯ç›´æŽ¥æŸ¥è¯¢æ³¨å†Œè¡¨ï¼ŒåŒæ—¶è‡ªå·±è´Ÿè´£è´Ÿè½½å‡è¡¡ã€‚Eureka é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚ æœåŠ¡å™¨ç«¯æœåŠ¡å‘çŽ°æ¨¡å¼ï¼šå®¢æˆ·ç«¯é€šè¿‡è´Ÿè½½å‡è¡¡æŸ¥è¯¢æœåŠ¡å®žä¾‹ã€‚ ã€ŠSpringCloudæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ:Consul vs Zookeeper vs Etcd vs Eurekaã€‹ CAPæ”¯æŒï¼šConsulï¼ˆCAï¼‰ã€zookeeperï¼ˆcpï¼‰ã€etcdï¼ˆcpï¼‰ ã€euerkaï¼ˆapï¼‰ ä½œè€…è®¤ä¸ºç›®å‰ Consul å¯¹ Spring cloud çš„æ”¯æŒæ¯”è¾ƒå¥½ã€‚ ã€ŠåŸºäºŽZookeeperçš„æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°ã€‹ ä¼˜ç‚¹ï¼šAPIç®€å•ã€Pinterestï¼ŒAirbnb åœ¨ç”¨ã€å¤šè¯­è¨€ã€é€šè¿‡watcheræœºåˆ¶æ¥å®žçŽ°é…ç½®PUSHï¼Œèƒ½å¿«é€Ÿå“åº”é…ç½®å˜åŒ–ã€‚ æœåŠ¡è·¯ç”±æŽ§åˆ¶ ã€Šåˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶å­¦ä¹ ç¬”è®°4 æœåŠ¡è·¯ç”±ã€‹ åŽŸåˆ™ï¼šé€æ˜ŽåŒ–è·¯ç”± è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šéšæœºã€è½®è¯¢ã€æœåŠ¡è°ƒç”¨å»¶è¿Ÿã€ä¸€è‡´æ€§å“ˆå¸Œã€ç²˜æ»žè¿žæŽ¥ æœ¬åœ°è·¯ç”±æœ‰é™ç­–ç•¥ï¼šinjvm(ä¼˜å…ˆè°ƒç”¨jvmå†…éƒ¨çš„æœåŠ¡)ï¼Œinnative(ä¼˜å…ˆä½¿ç”¨ç›¸åŒç‰©ç†æœºçš„æœåŠ¡),åŽŸåˆ™ä¸Šæ‰¾è·ç¦»æœ€è¿‘çš„æœåŠ¡ã€‚ é…ç½®æ–¹å¼ï¼šç»Ÿä¸€æ³¨å†Œè¡¨ï¼›æœ¬åœ°é…ç½®ï¼›åŠ¨æ€ä¸‹å‘ã€‚ åˆ†å¸ƒå¼ä¸€è‡´CAP ä¸Ž BASE ç†è®º ã€Šä»Žåˆ†å¸ƒå¼ä¸€è‡´æ€§è°ˆåˆ°CAPç†è®ºã€BASEç†è®ºã€‹ ä¸€è‡´æ€§åˆ†ç±»ï¼šå¼ºä¸€è‡´(ç«‹å³ä¸€è‡´)ï¼›å¼±ä¸€è‡´(å¯åœ¨å•ä½æ—¶é—´å†…å®žçŽ°ä¸€è‡´ï¼Œæ¯”å¦‚ç§’çº§)ï¼›æœ€ç»ˆä¸€è‡´(å¼±ä¸€è‡´çš„ä¸€ç§ï¼Œä¸€å®šæ—¶é—´å†…æœ€ç»ˆä¸€è‡´) CAPï¼šä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§(ç½‘ç»œæ•…éšœå¼•èµ·) BASEï¼šBasically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’ŒEventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ BASEç†è®ºçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚ åˆ†å¸ƒå¼é” ã€Šåˆ†å¸ƒå¼é”çš„å‡ ç§å®žçŽ°æ–¹å¼ã€‹ åŸºäºŽæ•°æ®åº“çš„åˆ†å¸ƒå¼é”ï¼šä¼˜ç‚¹ï¼šæ“ä½œç®€å•ã€å®¹æ˜“ç†è§£ã€‚ç¼ºç‚¹ï¼šå­˜åœ¨å•ç‚¹é—®é¢˜ã€æ•°æ®åº“æ€§èƒ½å¤Ÿå¼€é”€è¾ƒå¤§ã€ä¸å¯é‡å…¥ï¼› åŸºäºŽç¼“å­˜çš„åˆ†å¸ƒå¼é”ï¼šä¼˜ç‚¹ï¼šéžé˜»å¡žã€æ€§èƒ½å¥½ã€‚ç¼ºç‚¹ï¼šæ“ä½œä¸å¥½å®¹æ˜“é€ æˆé”æ— æ³•é‡Šæ”¾çš„æƒ…å†µã€‚ Zookeeper åˆ†å¸ƒå¼é”ï¼šé€šè¿‡æœ‰åºä¸´æ—¶èŠ‚ç‚¹å®žçŽ°é”æœºåˆ¶ï¼Œè‡ªå·±å¯¹åº”çš„èŠ‚ç‚¹éœ€è¦æœ€å°ï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯èŽ·å¾—äº†é”ã€‚ä¼˜ç‚¹ï¼šé›†ç¾¤å¯ä»¥é€æ˜Žè§£å†³å•ç‚¹é—®é¢˜ï¼Œé¿å…é”ä¸è¢«é‡Šæ”¾é—®é¢˜ï¼ŒåŒæ—¶é”å¯ä»¥é‡å…¥ã€‚ç¼ºç‚¹ï¼šæ€§èƒ½ä¸å¦‚ç¼“å­˜æ–¹å¼ï¼Œåžåé‡ä¼šéšç€zké›†ç¾¤è§„æ¨¡å˜å¤§è€Œä¸‹é™ã€‚ ã€ŠåŸºäºŽZookeeperçš„åˆ†å¸ƒå¼é”ã€‹ æ¸…æ¥šçš„åŽŸç†æè¿° + Java ä»£ç ç¤ºä¾‹ã€‚ ã€ŠjedisLockâ€”redisåˆ†å¸ƒå¼é”å®žçŽ°ã€‹ åŸºäºŽ setnx(set if ont exists)ï¼Œæœ‰åˆ™è¿”å›žfalseï¼Œå¦åˆ™è¿”å›žtrueã€‚å¹¶æ”¯æŒè¿‡æœŸæ—¶é—´ã€‚ ã€ŠMemcached å’Œ Redis åˆ†å¸ƒå¼é”æ–¹æ¡ˆã€‹ åˆ©ç”¨ memcached çš„ addï¼ˆæœ‰åˆ«äºŽsetï¼‰æ“ä½œï¼Œå½“keyå­˜åœ¨æ—¶ï¼Œè¿”å›žfalseã€‚ åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•PAXOS ã€Šåˆ†å¸ƒå¼ç³»åˆ—æ–‡ç« â€”â€”Paxosç®—æ³•åŽŸç†ä¸ŽæŽ¨å¯¼ã€‹ ã€ŠPaxosâ€“&gt;Fast Paxosâ€“&gt;Zookeeperåˆ†æžã€‹ ã€Šã€åˆ†å¸ƒå¼ã€‘Zookeeperä¸ŽPaxosã€‹ Zab ã€ŠZabï¼šZookeeper ä¸­çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®ä»‹ç»ã€‹ Raft ã€ŠRaft ä¸ºä»€ä¹ˆæ˜¯æ›´æ˜“ç†è§£çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ã€‹ ä¸‰ç§è§’è‰²ï¼šLeaderï¼ˆé¢†è¢–ï¼‰ã€Followerï¼ˆç¾¤ä¼—ï¼‰ã€Candidateï¼ˆå€™é€‰äººï¼‰ é€šè¿‡éšæœºç­‰å¾…çš„æ–¹å¼å‘å‡ºæŠ•ç¥¨ï¼Œå¾—ç¥¨å¤šçš„èŽ·èƒœã€‚ Gossip ã€ŠGossipç®—æ³•ã€‹ ä¸¤é˜¶æ®µæäº¤ã€å¤šé˜¶æ®µæäº¤ ã€Šå…³äºŽåˆ†å¸ƒå¼äº‹åŠ¡ã€ä¸¤é˜¶æ®µæäº¤åè®®ã€ä¸‰é˜¶æäº¤åè®®ã€‹ å¹‚ç­‰ ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿâ€”å¹‚ç­‰æ€§è®¾è®¡ã€‹ å¹‚ç­‰ç‰¹æ€§çš„ä½œç”¨ï¼šè¯¥èµ„æºå…·å¤‡å¹‚ç­‰æ€§ï¼Œè¯·æ±‚æ–¹æ— éœ€æ‹…å¿ƒé‡å¤è°ƒç”¨ä¼šäº§ç”Ÿé”™è¯¯ã€‚ å¸¸è§ä¿è¯å¹‚ç­‰çš„æ‰‹æ®µï¼šMVCCï¼ˆç±»ä¼¼äºŽä¹è§‚é”ï¼‰ã€åŽ»é‡è¡¨(å”¯ä¸€ç´¢å¼•)ã€æ‚²è§‚é”ã€ä¸€æ¬¡æ€§tokenã€åºåˆ—å·æ–¹å¼ã€‚ åˆ†å¸ƒå¼ä¸€è‡´æ–¹æ¡ˆ ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿäº‹åŠ¡ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆã€‹ ã€Šä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸€è‡´æ€§çš„6ç§æ–¹æ¡ˆã€‹ åˆ†å¸ƒå¼ Leader èŠ‚ç‚¹é€‰ä¸¾ ã€Šåˆ©ç”¨zookeeperå®žçŽ°åˆ†å¸ƒå¼leaderèŠ‚ç‚¹é€‰ä¸¾ã€‹ TCC(Try/Confirm/Cancel) æŸ”æ€§äº‹åŠ¡ ã€Šä¼ ç»Ÿäº‹åŠ¡ä¸ŽæŸ”æ€§äº‹åŠ¡ã€‹ åŸºäºŽBASEç†è®ºï¼šåŸºæœ¬å¯ç”¨ã€æŸ”æ€§çŠ¶æ€ã€æœ€ç»ˆä¸€è‡´ã€‚ è§£å†³æ–¹æ¡ˆï¼šè®°å½•æ—¥å¿—+è¡¥å¿ï¼ˆæ­£å‘è¡¥å……æˆ–è€…å›žæ»šï¼‰ã€æ¶ˆæ¯é‡è¯•(è¦æ±‚ç¨‹åºè¦å¹‚ç­‰)ï¼›â€œæ— é”è®¾è®¡â€ã€é‡‡ç”¨ä¹è§‚é”æœºåˆ¶ã€‚ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ è¯´è¯´åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ-åŸºæœ¬æž¶æž„ ï¼Ÿ ã€Šå„ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„æ¯”è¾ƒã€‹ ï¼Ÿ HDFSï¼šå¤§æ‰¹é‡æ•°æ®è¯»å†™ï¼Œç”¨äºŽé«˜åžåé‡çš„åœºæ™¯ï¼Œä¸é€‚åˆå°æ–‡ä»¶ã€‚ FastDFSï¼šè½»é‡çº§ã€é€‚åˆå°æ–‡ä»¶ã€‚ å”¯ä¸€ID ç”Ÿæˆå…¨å±€å”¯ä¸€ID ã€Šé«˜å¹¶å‘åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç”Ÿæˆå…¨å±€å”¯ä¸€Idæ±‡æ€»ã€‹ Twitter æ–¹æ¡ˆï¼ˆSnowflake ç®—æ³•ï¼‰ï¼š41ä½æ—¶é—´æˆ³+10ä½æœºå™¨æ ‡è¯†ï¼ˆæ¯”å¦‚IPï¼ŒæœåŠ¡å™¨åç§°ç­‰ï¼‰+12ä½åºåˆ—å·(æœ¬åœ°è®¡æ•°å™¨) Flicker æ–¹æ¡ˆï¼šMySQLè‡ªå¢žID + â€œREPLACE INTO XXX:SELECT LAST_INSERT_ID();â€ UUIDï¼šç¼ºç‚¹ï¼Œæ— åºï¼Œå­—ç¬¦ä¸²è¿‡é•¿ï¼Œå ç”¨ç©ºé—´ï¼Œå½±å“æ£€ç´¢æ€§èƒ½ã€‚ MongoDB æ–¹æ¡ˆï¼šåˆ©ç”¨ ObjectIdã€‚ç¼ºç‚¹ï¼šä¸èƒ½è‡ªå¢žã€‚ ã€ŠTDDL åœ¨åˆ†å¸ƒå¼ä¸‹çš„SEQUENCEåŽŸç†ã€‹ åœ¨æ•°æ®åº“ä¸­åˆ›å»º sequence è¡¨ï¼Œç”¨äºŽè®°å½•ï¼Œå½“å‰å·²è¢«å ç”¨çš„idæœ€å¤§å€¼ã€‚ æ¯å°å®¢æˆ·ç«¯ä¸»æœºå–ä¸€ä¸ªidåŒºé—´ï¼ˆæ¯”å¦‚ 1000~2000ï¼‰ç¼“å­˜åœ¨æœ¬åœ°ï¼Œå¹¶æ›´æ–° sequence è¡¨ä¸­çš„idæœ€å¤§å€¼è®°å½•ã€‚ å®¢æˆ·ç«¯ä¸»æœºä¹‹é—´å–ä¸åŒçš„idåŒºé—´ï¼Œç”¨å®Œå†å–ï¼Œä½¿ç”¨ä¹è§‚é”æœºåˆ¶æŽ§åˆ¶å¹¶å‘ã€‚ ä¸€è‡´æ€§Hashç®—æ³• ã€Šä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ã€‹ è®¾è®¡æ€æƒ³ &amp; å¼€å‘æ¨¡å¼DDD(Domain-driven Design - é¢†åŸŸé©±åŠ¨è®¾è®¡) ã€Šæµ…è°ˆæˆ‘å¯¹DDDé¢†åŸŸé©±åŠ¨è®¾è®¡çš„ç†è§£ã€‹ æ¦‚å¿µï¼šDDD ä¸»è¦å¯¹ä¼ ç»Ÿè½¯ä»¶å¼€å‘æµç¨‹(åˆ†æž-è®¾è®¡-ç¼–ç )ä¸­å„é˜¶æ®µçš„å‰²è£‚é—®é¢˜è€Œæå‡ºï¼Œé¿å…ç”±äºŽä¸€å¼€å§‹åˆ†æžä¸æ˜Žæˆ–åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­çš„ä¿¡æ¯æµè½¬ä¸ä¸€è‡´è€Œé€ æˆè½¯ä»¶æ— æ³•äº¤ä»˜ï¼ˆå’Œéœ€æ±‚æ–¹è®¾æƒ³ä¸ä¸€è‡´ï¼‰çš„é—®é¢˜ã€‚DDD å¼ºè°ƒä¸€åˆ‡ä»¥é¢†åŸŸï¼ˆDomainï¼‰ä¸ºä¸­å¿ƒï¼Œå¼ºè°ƒé¢†åŸŸä¸“å®¶ï¼ˆDomain Expertï¼‰çš„ä½œç”¨ï¼Œå¼ºè°ƒå…ˆå®šä¹‰å¥½é¢†åŸŸæ¨¡åž‹ä¹‹åŽåœ¨è¿›è¡Œå¼€å‘ï¼Œå¹¶ä¸”é¢†åŸŸæ¨¡åž‹å¯ä»¥æŒ‡å¯¼å¼€å‘ï¼ˆæ‰€è°“çš„é©±åŠ¨ï¼‰ã€‚ è¿‡ç¨‹ï¼šç†è§£é¢†åŸŸã€æ‹†åˆ†é¢†åŸŸã€ç»†åŒ–é¢†åŸŸï¼Œæ¨¡åž‹çš„å‡†ç¡®æ€§å–å†³äºŽæ¨¡åž‹çš„ç†è§£æ·±åº¦ã€‚ è®¾è®¡ï¼šDDD ä¸­æå‡ºäº†å»ºæ¨¡å·¥å…·ï¼Œæ¯”å¦‚èšåˆã€å®žä½“ã€å€¼å¯¹è±¡ã€å·¥åŽ‚ã€ä»“å‚¨ã€é¢†åŸŸæœåŠ¡ã€é¢†åŸŸäº‹ä»¶æ¥å¸®åŠ©é¢†åŸŸå»ºæ¨¡ã€‚ ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡çš„åŸºç¡€çŸ¥è¯†æ€»ç»“ã€‹ é¢†åŸŸï¼ˆDoaminï¼‰æœ¬è´¨ä¸Šå°±æ˜¯é—®é¢˜åŸŸï¼Œæ¯”å¦‚ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼Œä¸€ä¸ªè®ºå›ç³»ç»Ÿç­‰ã€‚ ç•Œé™ä¸Šä¸‹æ–‡ï¼ˆBounded Contextï¼‰ï¼šé˜è¿°å­åŸŸä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥ç®€å•ç†è§£æˆä¸€ä¸ªå­ç³»ç»Ÿæˆ–ç»„ä»¶æ¨¡å—ã€‚ é¢†åŸŸæ¨¡åž‹ï¼ˆDomain Modelï¼‰ï¼šDDDçš„æ ¸å¿ƒæ˜¯å»ºç«‹ï¼ˆç”¨é€šç”¨æè¿°è¯­è¨€ã€å·¥å…·â€”é¢†åŸŸé€šç”¨è¯­è¨€ï¼‰æ­£ç¡®çš„é¢†åŸŸæ¨¡åž‹ï¼›ååº”ä¸šåŠ¡éœ€æ±‚çš„æœ¬è´¨ï¼ŒåŒ…æ‹¬å®žä½“å’Œè¿‡ç¨‹ï¼›å…¶è´¯ç©¿è½¯ä»¶åˆ†æžã€è®¾è®¡ã€å¼€å‘ çš„æ•´ä¸ªè¿‡ç¨‹ï¼›å¸¸ç”¨è¡¨è¾¾é¢†åŸŸæ¨¡åž‹çš„æ–¹å¼ï¼šå›¾ã€ä»£ç æˆ–æ–‡å­—ï¼› é¢†åŸŸé€šç”¨è¯­è¨€ï¼šé¢†åŸŸä¸“å®¶ã€å¼€å‘è®¾è®¡äººå‘˜éƒ½èƒ½ç«‹å³çš„è¯­è¨€æˆ–å·¥å…·ã€‚ ç»å…¸åˆ†å±‚æž¶æž„ï¼šç”¨æˆ·ç•Œé¢/å±•ç¤ºå±‚ã€åº”ç”¨å±‚ã€é¢†åŸŸå±‚ã€åŸºç¡€è®¾æ–½å±‚ï¼Œæ˜¯å››å±‚æž¶æž„æ¨¡å¼ã€‚ ä½¿ç”¨çš„æ¨¡å¼ï¼š å…³è”å°½é‡å°‘ï¼Œå°½é‡å•é¡¹ï¼Œå°½é‡é™ä½Žæ•´ä½“å¤æ‚åº¦ã€‚ å®žä½“ï¼ˆEntityï¼‰ï¼šé¢†åŸŸä¸­çš„å”¯ä¸€æ ‡ç¤ºï¼Œä¸€ä¸ªå®žä½“çš„å±žæ€§å°½é‡å°‘ï¼Œå°‘åˆ™æ¸…æ™°ã€‚ å€¼å¯¹è±¡ï¼ˆValue Objectï¼‰ï¼šæ²¡æœ‰å”¯ä¸€æ ‡è¯†ï¼Œä¸”å±žæ€§å€¼ä¸å¯å˜ï¼Œå°äºŒç®€å•çš„å¯¹è±¡ï¼Œæ¯”å¦‚Dateã€‚ é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰ï¼š åè°ƒå¤šä¸ªé¢†åŸŸå¯¹è±¡ï¼Œåªæœ‰æ–¹æ³•æ²¡æœ‰çŠ¶æ€(ä¸å­˜æ•°æ®)ï¼›å¯ä»¥åˆ†ä¸ºåº”ç”¨å±‚æœåŠ¡ï¼Œé¢†åŸŸå±‚æœåŠ¡ã€åŸºç¡€å±‚æœåŠ¡ã€‚ èšåˆåŠèšåˆæ ¹ï¼ˆAggregateï¼ŒAggregate Rootï¼‰ï¼šèšåˆå®šä¹‰äº†ä¸€ç»„å…·æœ‰å†…èšå…³ç³»çš„ç›¸å…³å¯¹è±¡çš„é›†åˆï¼›èšåˆæ ¹æ˜¯å¯¹èšåˆå¼•ç”¨çš„å”¯ä¸€å…ƒç´ ï¼›å½“ä¿®æ”¹ä¸€ä¸ªèšåˆæ—¶ï¼Œå¿…é¡»åœ¨äº‹åŠ¡çº§åˆ«ï¼›å¤§éƒ¨åˆ†é¢†åŸŸæ¨¡åž‹ä¸­ï¼Œæœ‰70%çš„èšåˆé€šå¸¸åªæœ‰ä¸€ä¸ªå®žä½“ï¼Œ30%åªæœ‰2~3ä¸ªå®žä½“ï¼›å¦‚æžœä¸€ä¸ªèšåˆåªæœ‰ä¸€ä¸ªå®žä½“ï¼Œé‚£ä¹ˆè¿™ä¸ªå®žä½“å°±æ˜¯èšåˆæ ¹ï¼›å¦‚æžœæœ‰å¤šä¸ªå®žä½“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ€è€ƒèšåˆå†…å“ªä¸ªå¯¹è±¡æœ‰ç‹¬ç«‹å­˜åœ¨çš„æ„ä¹‰å¹¶ä¸”å¯ä»¥å’Œå¤–éƒ¨ç›´æŽ¥è¿›è¡Œäº¤äº’ï¼› å·¥åŽ‚ï¼ˆFactoryï¼‰ï¼šç±»ä¼¼äºŽè®¾è®¡æ¨¡å¼ä¸­çš„å·¥åŽ‚æ¨¡å¼ã€‚ ä»“å‚¨ï¼ˆRepositoryï¼‰ï¼šæŒä¹…åŒ–åˆ°DBï¼Œç®¡ç†å¯¹è±¡ï¼Œä¸”åªå¯¹èšåˆè®¾è®¡ä»“å‚¨ã€‚ ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡(DDD)å®žçŽ°ä¹‹è·¯ã€‹ èšåˆï¼šæ¯”å¦‚ä¸€è¾†æ±½è½¦ï¼ˆCarï¼‰åŒ…å«äº†å¼•æ“Žï¼ˆEngineï¼‰ã€è½¦è½®ï¼ˆWheelï¼‰å’Œæ²¹ç®±ï¼ˆTankï¼‰ç­‰ç»„ä»¶ï¼Œç¼ºä¸€ä¸å¯ã€‚ ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ç³»åˆ—ï¼ˆ2ï¼‰æµ…æžVOã€DTOã€DOã€POçš„æ¦‚å¿µã€åŒºåˆ«å’Œç”¨å¤„ã€‹ å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»(CQRS)CQRS â€” Command Query Responsibility Seperation ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ç³»åˆ— (å…­)ï¼šCQRSã€‹ æ ¸å¿ƒæ€æƒ³ï¼šè¯»å†™åˆ†ç¦»ï¼ˆæŸ¥è¯¢å’Œæ›´æ–°åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼‰ï¼Œä¸åŒçš„æµç¨‹åªæ˜¯ä¸åŒçš„è®¾è®¡æ–¹å¼ï¼ŒCQä»£ç åˆ†ç¦»ï¼Œåˆ†å¸ƒå¼çŽ¯å¢ƒä¸­ä¼šæœ‰æ˜Žæ˜¾ä½“çŽ°ï¼ˆæœ‰å†—ä½™æ•°æ®çš„æƒ…å†µä¸‹ï¼‰ï¼Œç›®çš„æ˜¯ä¸ºäº†é«˜æ€§èƒ½ã€‚ ã€ŠDDD CQRSæž¶æž„å’Œä¼ ç»Ÿæž¶æž„çš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒã€‹ æœ€ç»ˆä¸€è‡´çš„è®¾è®¡ç†å¿µï¼›ä¾èµ–äºŽé«˜å¯ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ã€‚ ã€ŠCQRSæž¶æž„ç®€ä»‹ã€‹ ä¸€ä¸ªå®žçŽ° CQRS çš„æŠ½è±¡æ¡ˆä¾‹ã€‚ ã€Šæ·±åº¦é•¿æ–‡ï¼šæˆ‘å¯¹CQRS/EventSourcingæž¶æž„çš„æ€è€ƒã€‹ CQRS æ¨¡å¼åˆ†æž + 12306 æŠ¢ç¥¨æ¡ˆä¾‹ è´«è¡€ï¼Œå……è¡€æ¨¡åž‹ ã€Šè´«è¡€ï¼Œå……è¡€æ¨¡åž‹çš„è§£é‡Šä»¥åŠä¸€äº›ç»éªŒã€‹ å¤±è¡€æ¨¡åž‹ï¼šè€å­å’Œå„¿å­åˆ†åˆ«å®šä¹‰ï¼Œç›¸äº’ä¸çŸ¥é“ï¼ŒäºŒè€…å®žä½“å®šä¹‰ä¸­å®Œå…¨æ²¡æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œé€šè¿‡å¤–éƒ¨Serviceè¿›è¡Œå…³è”ã€‚ è´«è¡€æ¨¡åž‹ï¼šè€å­çŸ¥é“å„¿å­ï¼Œå„¿å­ä¹ŸçŸ¥é“è€å­ï¼›éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘æ”¾åˆ°å®žä½“ä¸­ï¼›ä¼˜ç‚¹ï¼šå„å±‚å•é¡¹ä¾èµ–ï¼Œç»“æž„æ¸…æ¥šï¼Œæ˜“äºŽç»´æŠ¤ï¼›ç¼ºç‚¹ï¼šä¸ç¬¦åˆOOæ€æƒ³ï¼Œç›¸æ¯”äºŽå……è¡€æ¨¡å¼ï¼ŒServiceå±‚è¾ƒä¸ºåŽšé‡ï¼› å……è¡€æ¨¡åž‹ï¼šå’Œè´«è¡€æ¨¡åž‹ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºŽå¦‚ä½•åˆ’åˆ†ä¸šåŠ¡é€»è¾‘ã€‚ä¼˜ç‚¹ï¼šServiceå±‚æ¯”è¾ƒè–„ï¼Œåªå……å½“Facadeçš„è§’è‰²ï¼Œä¸å’ŒDAOæ‰“äº¤é“ã€å¤åˆOOæ€æƒ³ï¼›ç¼ºç‚¹ï¼šéžå•é¡¹ä¾èµ–ï¼ŒDOå’ŒDAOä¹‹é—´åŒå‘ä¾èµ–ã€å’ŒServiceå±‚çš„é€»è¾‘åˆ’åˆ†å®¹æ˜“é€ æˆæ··ä¹±ã€‚ è‚¿èƒ€æ¨¡å¼ï¼šæ˜¯ä¸€ç§æžç«¯æƒ…å†µï¼Œå–æ¶ˆServiceå±‚ã€å…¨éƒ¨ä¸šåŠ¡é€»è¾‘æ”¾åœ¨DOä¸­ï¼›ä¼˜ç‚¹ï¼šç¬¦åˆOOæ€æƒ³ã€ç®€åŒ–äº†åˆ†å±‚ï¼›ç¼ºç‚¹ï¼šæš´éœ²ä¿¡æ¯è¿‡å¤šã€å¾ˆå¤šéžDOé€»è¾‘ä¹Ÿä¼šå¼ºè¡Œå¹¶å…¥DOã€‚è¿™ç§æ¨¡å¼åº”è¯¥é¿å…ã€‚ ä½œè€…ä¸»å¼ ä½¿ç”¨è´«è¡€æ¨¡å¼ã€‚ Actor æ¨¡å¼TODO å“åº”å¼ç¼–ç¨‹ReactorTODO RxJavaTODO Vert.xTODO DODAF2.0 ã€ŠDODAF2.0æ–¹æ³•è®ºã€‹ ã€ŠDODAF2.0ä¹‹èƒ½åŠ›è§†è§’å¦‚ä½•è½åœ°ã€‹ ServerlessTODO Service MeshTODO ã€Šä»€ä¹ˆæ˜¯Service Meshï¼Ÿã€‹ é¡¹ç›®ç®¡ç†æž¶æž„è¯„å®¡ ã€Šæž¶æž„è®¾è®¡ä¹‹å¦‚ä½•è¯„å®¡æž¶æž„è®¾è®¡è¯´æ˜Žä¹¦ã€‹ ã€Šäººäººéƒ½æ˜¯æž¶æž„å¸ˆï¼šéžåŠŸèƒ½æ€§éœ€æ±‚ã€‹ é‡æž„ ã€Šæž¶æž„ä¹‹é‡æž„çš„12æ¡å†›è§„ã€‹ ä»£ç è§„èŒƒTODO ä»£ç  Reviewåˆ¶åº¦è¿˜æ˜¯åˆ¶åº¦!å¦å¤–ï¼Œæ¯ä¸ªå…¬å¸éœ€è¦æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œç›®æ ‡åˆ¶å®šè‡ªå·±çš„ check list ã€Šä¸ºä»€ä¹ˆä½ åšä¸å¥½ Code Reviewï¼Ÿã€‹ ä»£ç  review åšçš„å¥½ï¼Œåœ¨äºŽåˆ¶åº¦å»ºè®¾ã€‚ ã€Šä»Žé›¶å¼€å§‹Code Reviewã€‹ ã€ŠCode Review Checklistã€‹ ã€ŠJava Code Review Checklistã€‹ ã€Šå¦‚ä½•ç”¨ gitlab åš code reviewã€‹ RUP ã€Šè¿ç”¨RUP 4+1è§†å›¾æ–¹æ³•è¿›è¡Œè½¯ä»¶æž¶æž„è®¾è®¡ã€‹ çœ‹æ¿ç®¡ç† ã€Šè¯´è¯´çœ‹æ¿åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ã€‹ SCRUMSCRUM - äº‰çƒ 3ä¸ªè§’è‰²:Product Owner(PO) äº§å“è´Ÿè´£äºº;Scrum Masterï¼ˆSMï¼‰ï¼ŒæŽ¨åŠ¨Scrumæ‰§è¡Œ;Team å¼€å‘å›¢é˜Ÿã€‚ 3ä¸ªå·¥ä»¶ï¼šProduct Backlog äº§å“TODOLISTï¼Œå«ä¼˜å…ˆçº§;Sprint Backlog åŠŸèƒ½å¼€å‘ TODO LISTï¼›ç‡ƒå°½å›¾ï¼› äº”ä¸ªä»·å€¼è§‚ï¼šä¸“æ³¨ã€å‹‡æ°”ã€å…¬å¼€ã€æ‰¿è¯ºã€å°Šé‡ã€‚ ã€Šæ•æ·é¡¹ç›®ç®¡ç†æµç¨‹-Scrumæ¡†æž¶æœ€å…¨æ€»ç»“ï¼ã€‹ ã€Šæ•æ·å…¶å®žå¾ˆç®€å•3â€”æ•æ·æ–¹æ³•ä¹‹scrumã€‹ æ•æ·å¼€å‘TODO æžé™ç¼–ç¨‹ï¼ˆXPï¼‰XP - eXtreme Programming ã€Šä¸»æµæ•æ·å¼€å‘æ–¹æ³•ï¼šæžé™ç¼–ç¨‹XPã€‹ æ˜¯ä¸€ç§æŒ‡å¯¼å¼€å‘äººå‘˜çš„æ–¹æ³•è®ºã€‚ 4å¤§ä»·å€¼ï¼š æ²Ÿé€šï¼šé¼“åŠ±å£å¤´æ²Ÿé€šï¼Œæé«˜æ•ˆçŽ‡ã€‚ ç®€å•ï¼šå¤Ÿç”¨å°±å¥½ã€‚ åé¦ˆï¼šåŠæ—¶åé¦ˆã€é€šçŸ¥ç›¸å…³äººã€‚ å‹‡æ°”ï¼šæå€¡æ‹¥æŠ±å˜åŒ–ï¼Œæ•¢äºŽé‡æž„ã€‚ 5ä¸ªåŽŸåˆ™ï¼šå¿«é€Ÿåé¦ˆã€ç®€å•æ€§å‡è®¾ã€é€æ­¥ä¿®æ”¹ã€æå€¡æ›´æ”¹ï¼ˆå°æ­¥å¿«è·‘ï¼‰ã€ä¼˜è´¨å·¥ä½œï¼ˆä¿è¯è´¨é‡çš„å‰æä¸‹ä¿è¯å°æ­¥å¿«è·‘ï¼‰ã€‚ 5ä¸ªå·¥ä½œï¼šé˜¶æ®µæ€§å†²åˆºï¼›å†²åˆºè®¡åˆ’ä¼šè®®ï¼›æ¯æ—¥ç«™ç«‹ä¼šè®®ï¼›å†²åˆºåŽreviewï¼›å›žé¡¾ä¼šè®®ã€‚ ç»“å¯¹ç¼–ç¨‹è¾¹å†™ç ï¼Œè¾¹reviewã€‚èƒ½å¤Ÿå¢žå¼ºä»£ç è´¨é‡ã€å‡å°‘bugã€‚ ã€Šç»“å¯¹ç¼–ç¨‹ã€‹ FMEAç®¡ç†æ¨¡å¼TODO é€šç”¨ä¸šåŠ¡æœ¯è¯­TODO æŠ€æœ¯è¶‹åŠ¿TODO æ”¿ç­–ã€æ³•è§„TODO æ³•å¾‹ä¸¥æ ¼éµå®ˆåˆ‘æ³•253æ³•æ¡æˆ‘å›½åˆ‘æ³•ç¬¬253æ¡ä¹‹ä¸€è§„å®šï¼š å›½å®¶æœºå…³æˆ–è€…é‡‘èžã€ç”µä¿¡ã€äº¤é€šã€æ•™è‚²ã€åŒ»ç–—ç­‰å•ä½çš„å·¥ä½œäººå‘˜ï¼Œè¿åå›½å®¶è§„å®šï¼Œå°†æœ¬å•ä½åœ¨å±¥è¡ŒèŒè´£æˆ–è€…æä¾›æœåŠ¡è¿‡ç¨‹ä¸­èŽ·å¾—çš„å…¬æ°‘ä¸ªäººä¿¡æ¯ï¼Œå‡ºå”®æˆ–è€…éžæ³•æä¾›ç»™ä»–äººï¼Œæƒ…èŠ‚ä¸¥é‡çš„ï¼Œå¤„3å¹´ä»¥ä¸‹æœ‰æœŸå¾’åˆ‘æˆ–è€…æ‹˜å½¹ï¼Œå¹¶å¤„æˆ–è€…å•å¤„ç½šé‡‘ã€‚ çªƒå–æˆ–è€…ä»¥å…¶ä»–æ–¹æ³•éžæ³•èŽ·å–ä¸Šè¿°ä¿¡æ¯ï¼Œæƒ…èŠ‚ä¸¥é‡çš„ï¼Œä¾ç…§å‰æ¬¾çš„è§„å®šå¤„ç½šã€‚ å•ä½çŠ¯å‰ä¸¤æ¬¾ç½ªçš„ï¼Œå¯¹å•ä½åˆ¤å¤„ç½šé‡‘ï¼Œå¹¶å¯¹å…¶ç›´æŽ¥è´Ÿè´£çš„ä¸»ç®¡äººå‘˜å’Œå…¶ä»–ç›´æŽ¥è´£ä»»äººå‘˜ï¼Œä¾ç…§å„è¯¥æ¬¾çš„è§„å®šå¤„ç½šã€‚ æœ€é«˜äººæ°‘æ³•é™¢ã€æœ€é«˜äººæ°‘æ£€å¯Ÿé™¢å…³äºŽæ‰§è¡Œã€Šä¸­åŽäººæ°‘å…±å’Œå›½åˆ‘æ³•ã€‹ç¡®å®šç½ªåçš„è¡¥å……è§„å®šï¼ˆå››ï¼‰è§„å®šï¼šè§¦çŠ¯åˆ‘æ³•ç¬¬253æ¡ä¹‹ä¸€ç¬¬1æ¬¾ä¹‹è§„å®šï¼Œæž„æˆâ€œå‡ºå”®ã€éžæ³•æä¾›å…¬æ°‘ä¸ªäººä¿¡æ¯ç½ªâ€ï¼›è§¦çŠ¯åˆ‘æ³•ç¬¬253æ¡ä¹‹ä¸€ç¬¬2æ¬¾ä¹‹è§„å®šï¼Œæž„æˆâ€œéžæ³•èŽ·å–å…¬æ°‘ä¸ªäººä¿¡æ¯ç½ªâ€ ã€Šéžæ³•èŽ·å–å…¬æ°‘ä¸ªäººä¿¡æ¯ç½ªã€‹ æž¶æž„å¸ˆç´ è´¨ ã€Šæž¶æž„å¸ˆç”»åƒã€‹ ä¸šåŠ¡ç†è§£å’ŒæŠ½è±¡èƒ½åŠ› NBçš„ä»£ç èƒ½åŠ› å…¨é¢ï¼š1. åœ¨é¢å¯¹ä¸šåŠ¡é—®é¢˜ä¸Šï¼Œæž¶æž„å¸ˆè„‘æµ·é‡Œæ˜¯å¦ä¼šæµ®çŽ°å‡ºå¤šç§æŠ€æœ¯æ–¹æ¡ˆï¼›2. åœ¨åšç³»ç»Ÿè®¾è®¡æ—¶æ˜¯å¦è€ƒè™‘åˆ°äº†è¶³å¤Ÿå¤šçš„æ–¹æ–¹é¢é¢ï¼›3. åœ¨åšç³»ç»Ÿè®¾è®¡æ—¶æ˜¯å¦è€ƒè™‘åˆ°äº†è¶³å¤Ÿå¤šçš„æ–¹æ–¹é¢é¢ï¼› å…¨å±€ï¼šæ˜¯å¦è€ƒè™‘åˆ°äº†å¯¹ä¸Šä¸‹æ¸¸çš„ç³»ç»Ÿçš„å½±å“ã€‚ æƒè¡¡ï¼šæƒè¡¡æŠ•å…¥äº§å‡ºæ¯”ï¼›ä¼˜å…ˆçº§å’ŒèŠ‚å¥æŽ§åˆ¶ï¼› ã€Šå…³äºŽæž¶æž„ä¼˜åŒ–å’Œè®¾è®¡ï¼Œæž¶æž„å¸ˆå¿…é¡»çŸ¥é“çš„äº‹æƒ…ã€‹ è¦åŽ»è€ƒè™‘çš„ç»†èŠ‚ï¼šæ¨¡å—åŒ–ã€è½»è€¦åˆã€æ— å…±äº«æž¶æž„ï¼›å‡å°‘å„ä¸ªç»„ä»¶ä¹‹å‰çš„ä¾æ‡’ã€æ³¨æ„æœåŠ¡ä¹‹é—´ä¾æ‡’æ‰€æœ‰é€ æˆçš„é“¾å¼å¤±è´¥åŠå½±å“ç­‰ã€‚ åŸºç¡€è®¾æ–½ã€é…ç½®ã€æµ‹è¯•ã€å¼€å‘ã€è¿ç»´ç»¼åˆè€ƒè™‘ã€‚ è€ƒè™‘äººã€å›¢é˜Ÿã€å’Œç»„ç»‡çš„å½±å“ã€‚ ã€Šå¦‚ä½•æ‰èƒ½çœŸæ­£çš„æé«˜è‡ªå·±ï¼Œæˆä¸ºä¸€åå‡ºè‰²çš„æž¶æž„å¸ˆï¼Ÿã€‹ ã€Šæž¶æž„å¸ˆçš„å¿…å¤‡ç´ è´¨å’Œæˆé•¿é€”å¾„ã€‹ ç´ è´¨ï¼šä¸šåŠ¡ç†è§£ã€æŠ€æœ¯å¹¿åº¦ã€æŠ€æœ¯æ·±åº¦ã€ä¸°å¯Œç»éªŒã€æ²Ÿé€šèƒ½åŠ›ã€åŠ¨æ‰‹èƒ½åŠ›ã€ç¾Žå­¦ç´ å…»ã€‚ æˆé•¿è·¯å¾„ï¼š2å¹´ç§¯ç´¯çŸ¥è¯†ã€4å¹´ç§¯ç´¯æŠ€èƒ½å’Œç»„å†…å½±å“åŠ›ã€7å¹´ç§¯ç´¯éƒ¨é—¨å†…å½±å“åŠ›ã€7å¹´ä»¥ä¸Šç§¯ç´¯è·¨éƒ¨é—¨å½±å“åŠ›ã€‚ ã€Šæž¶æž„è®¾è®¡å¸ˆâ€”ä½ åœ¨å“ªå±‚æ¥¼ï¼Ÿã€‹ ç¬¬ä¸€å±‚çš„æž¶æž„å¸ˆçœ‹åˆ°çš„åªæ˜¯äº§å“æœ¬èº« ç¬¬äºŒå±‚çš„æž¶æž„å¸ˆä¸ä»…çœ‹åˆ°è‡ªå·±çš„äº§å“ï¼Œè¿˜çœ‹åˆ°äº†æ•´ä½“çš„æ–¹æ¡ˆ ç¬¬ä¸‰å±‚çš„æž¶æž„å¸ˆçœ‹åˆ°çš„æ˜¯å•†ä¸šä»·å€¼ å›¢é˜Ÿç®¡ç†TODO æ‹›è˜èµ„è®¯è¡Œä¸šèµ„è®¯ 36kr Techweb å…¬ä¼—å·åˆ—è¡¨TODO åšå®¢å›¢é˜Ÿåšå®¢ é˜¿é‡Œä¸­é—´ä»¶åšå®¢ ç¾Žå›¢ç‚¹è¯„æŠ€æœ¯å›¢é˜Ÿåšå®¢ ä¸ªäººåšå®¢ é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— é…·å£³ - COOLSHELL-é™ˆçš“ hellojava-é˜¿é‡Œæ¯•çŽ„ Cmâ€™s Blog ç¨‹åºçŒ¿DD-ç¿Ÿæ°¸è¶…-ã€ŠSpring Cloudå¾®æœåŠ¡å®žæˆ˜ã€‹ä½œè€… ç»¼åˆé—¨æˆ·ã€ç¤¾åŒºå›½å†…ï¼š CSDN è€ç‰ŒæŠ€æœ¯ç¤¾åŒºã€ä¸å¿…è§£é‡Šã€‚ 51cto.com ITeye å Java æ–¹å‘ åšå®¢å›­ ChinaUnix å Linux æ–¹å‘ å¼€æºä¸­å›½ç¤¾åŒº æ·±åº¦å¼€æº ä¼¯ä¹åœ¨çº¿ æ¶µç›– ITèŒåœºã€Webå‰ç«¯ã€åŽç«¯ã€ç§»åŠ¨ç«¯ã€æ•°æ®åº“ç­‰æ–¹é¢å†…å®¹ï¼ŒåæŠ€æœ¯ç«¯ã€‚ ITPUB è…¾è®¯äº‘â€” äº‘+ç¤¾åŒº é˜¿é‡Œäº‘â€” äº‘æ –ç¤¾åŒº IBM DeveloperWorks å¼€å‘è€…å¤´æ¡ LinkedKeeper å›½å¤–ï¼š DZone Reddit é—®ç­”ã€è®¨è®ºç±»ç¤¾åŒº segmentfault é—®ç­”+ä¸“æ  çŸ¥ä¹Ž stackoverflow è¡Œä¸šæ•°æ®åˆ†æž è‰¾ç‘žç½‘ QUEST MOBILE å›½å®¶æ•°æ® ä¸“é¡¹ç½‘ç«™ æµ‹è¯•: é¢†æµ‹å›½é™… æµ‹è¯•çª TesterHome è¿ç»´: * [è¿ç»´æ´¾](http://www.yunweipai.com/) * [Abcdocker](https://www.abcdocker.com/) Java: ImportNew ä¸“æ³¨äºŽ Java æŠ€æœ¯åˆ†äº« HowToDoInJava è‹±æ–‡åšå®¢ å®‰å…¨ çº¢é»‘è”ç›Ÿ FreeBuf å¤§æ•°æ® ä¸­å›½å¤§æ•°æ® å…¶ä»–ä¸“é¢˜ç½‘ç«™ï¼š DockerInfo ä¸“æ³¨äºŽ Docker åº”ç”¨åŠå’¨è¯¢ã€æ•™ç¨‹çš„ç½‘ç«™ã€‚ Linuxå…¬ç¤¾ Linux ä¸»é¢˜ç¤¾åŒº å…¶ä»–ç±» ç¨‹åºå‘˜æŠ€èƒ½å›¾è°± æŽ¨èå‚è€ƒä¹¦åœ¨çº¿ç”µå­ä¹¦ ã€Šæ·±å…¥ç†è§£Spring Cloudä¸Žå¾®æœåŠ¡æž„å»ºã€‹ ã€Šé˜¿é‡ŒæŠ€æœ¯å‚è€ƒå›¾å†Œ-ç ”å‘ç¯‡ã€‹ ã€Šé˜¿é‡ŒæŠ€æœ¯å‚è€ƒå›¾å†Œ-ç®—æ³•ç¯‡ã€‹ ã€Š2018ç¾Žå›¢ç‚¹è¯„æŠ€æœ¯å¹´è´§ï¼ˆåˆè¾‘ï¼‰ã€‹70M InfoQã€Šæž¶æž„å¸ˆã€‹æœˆåˆŠ ã€Šæž¶æž„å¸ˆä¹‹è·¯ã€‹ çº¸è´¨ä¹¦å¼€å‘æ–¹é¢ ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹äº¬ä¸œ æ·˜å® æž¶æž„æ–¹é¢ ã€Šè½¯ä»¶æž¶æž„å¸ˆçš„12é¡¹ä¿®ç‚¼ï¼šæŠ€æœ¯æŠ€èƒ½ç¯‡ã€‹äº¬ä¸œ æ·˜å® ã€Šæž¶æž„ä¹‹ç¾Žã€‹äº¬ä¸œ æ·˜å® ã€Šåˆ†å¸ƒå¼æœåŠ¡æž¶æž„ã€‹äº¬ä¸œ æ·˜å® ã€ŠèŠèŠæž¶æž„ã€‹ äº¬ä¸œ æ·˜å® ã€Šäº‘åŽŸç”Ÿåº”ç”¨æž¶æž„å®žè·µã€‹äº¬ä¸œ æ·˜å® ã€Šäº¿çº§æµé‡ç½‘ç«™æž¶æž„æ ¸å¿ƒæŠ€æœ¯ã€‹äº¬ä¸œ æ·˜å® ã€Šæ·˜å®æŠ€æœ¯è¿™åå¹´ã€‹äº¬ä¸œ æ·˜å® ã€Šä¼ä¸šITæž¶æž„è½¬åž‹ä¹‹é“-ä¸­å°æˆ˜ç•¥æ€æƒ³ä¸Žæž¶æž„å®žæˆ˜ã€‹ äº¬ä¸œ æ·˜å® æŠ€æœ¯ç®¡ç†æ–¹é¢ ã€ŠCTOè¯´ã€‹äº¬ä¸œ æ·˜å® ã€ŠæŠ€æœ¯ç®¡ç†ä¹‹å·…ã€‹äº¬ä¸œ æ·˜å® ã€Šç½‘æ˜“ä¸€åƒé›¶ä¸€å¤œï¼šäº’è”ç½‘äº§å“é¡¹ç›®ç®¡ç†å®žæˆ˜ã€‹äº¬ä¸œ æ·˜å® åŸºç¡€ç†è®º ã€Šæ•°å­¦ä¹‹ç¾Žã€‹äº¬ä¸œ æ·˜å® ã€Šç¼–ç¨‹ç çŽ‘ã€‹äº¬ä¸œ æ·˜å® å·¥å…·æ–¹é¢TODO å¤§æ•°æ®æ–¹é¢æŠ€æœ¯èµ„æºå¼€æºèµ„æº github Apache è½¯ä»¶åŸºé‡‘ä¼š æ‰‹å†Œã€æ–‡æ¡£ã€æ•™ç¨‹å›½å†…ï¼š W3Cschool Runoob.com HTML ã€ CSSã€XMLã€Javaã€Pythonã€PHPã€è®¾è®¡æ¨¡å¼ç­‰å…¥é—¨æ‰‹å†Œã€‚ Love2.io å¾ˆå¤šå¾ˆå¤šä¸­æ–‡åœ¨çº¿ç”µå­ä¹¦ï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„å¼€æºæŠ€æœ¯æ–‡æ¡£åˆ†äº«å¹³å°ã€‚ gitbook.cn ä»˜è´¹ç”µå­ä¹¦ã€‚ ApacheCN AIã€å¤§æ•°æ®æ–¹é¢ç³»åˆ—ä¸­æ–‡æ–‡æ¡£ã€‚ å›½å¤–ï¼š Quick Code å…è´¹åœ¨çº¿æŠ€æœ¯æ•™ç¨‹ã€‚ gitbook.com æœ‰éƒ¨åˆ†ä¸­æ–‡ç”µå­ä¹¦ã€‚ Cheatography Cheat Sheets å¤§å…¨ï¼Œå•é¡µæ–‡æ¡£ç½‘ç«™ã€‚ åœ¨çº¿è¯¾å ‚ å­¦å¾’æ— å¿§ æžå®¢æ—¶é—´ segmentfault æ–¯è¾¾å…‹å­¦é™¢ ç‰›å®¢ç½‘ æžå®¢å­¦é™¢ 51CTOå­¦é™¢ ä¼šè®®ã€æ´»åŠ¨ QCon ArchSummit GITCå…¨çƒäº’è”ç½‘æŠ€æœ¯å¤§ä¼š æ´»åŠ¨å‘å¸ƒå¹³å°: æ´»åŠ¨è¡Œ å¸¸ç”¨APP æžå®¢æ—¶é—´ å¾—åˆ° æ‰¾å·¥ä½œ Bossç›´è˜ æ‹‰å‹¾ç½‘ çŒŽè˜ 100Offer å·¥å…· æžå®¢æœç´¢ æŠ€æœ¯æ–‡ç« æœç´¢å¼•æ“Žã€‚ ä»£ç æ‰˜ç®¡ Coding ç äº‘ æ–‡ä»¶æœåŠ¡ ä¸ƒç‰› åˆæ‹äº‘ ç»¼åˆäº‘æœåŠ¡å•† é˜¿é‡Œäº‘ è…¾è®¯äº‘ ç™¾åº¦äº‘ æ–°æµªäº‘ é‡‘å±±äº‘ äºšé©¬é€Šäº‘(AWS) è°·æ­Œäº‘ å¾®è½¯äº‘ VPS Linode]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>javaæž¶æž„</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinkedBlockingQueue]]></title>
    <url>%2F2018%2F05%2F08%2FLinkedBlockingQueue%2F</url>
    <content type="text"><![CDATA[é”åˆ†ç¦»takeå’Œputåˆ†åˆ«ä¸¤ä¸ªReentrantLocké” 1234567891011/** Lock held by take, poll, etc */private final ReentrantLock takeLock = new ReentrantLock();/** Wait queue for waiting takes */private final Condition notEmpty = takeLock.newCondition();/** Lock held by put, offer, etc */private final ReentrantLock putLock = new ReentrantLock();/** Wait queue for waiting puts */private final Condition notFull = putLock.newCondition();]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>javaå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[javaå¹¶å‘åŒ…ç›®å½•]]></title>
    <url>%2F2018%2F05%2F08%2Fjava%E5%B9%B6%E5%8F%91%E5%8C%85%E7%9B%AE%E5%BD%95%2F</url>
    <content type="text"><![CDATA[åŽŸå­ç±»é”å·¥å…·ç±»CyclicBarrier1234567891011121314151617181920212223242526272829303132public class StartGame implements Runnable&#123; private String player; private CyclicBarrier barrier; public StartGame(String player, CyclicBarrier barrier) &#123; this.player = player; this.barrier = barrier; &#125; @Override public void run() &#123; try &#123; System.out.println(this.getPlayer()+" å¼€å§‹åŒ¹é…çŽ©å®¶..."); findOtherPlayer(); barrier.await(); System.out.println(this.getPlayer()+" è¿›è¡Œé€‰æ‹©è§’è‰²..."); choiceRole(); System.out.println(this.getPlayer()+" è§’è‰²é€‰æ‹©å®Œæ¯•ç­‰å¾…å…¶ä»–çŽ©å®¶..."); barrier.await(); System.out.println(this.getPlayer()+" å¼€å§‹æ¸¸æˆ,è¿›è¡Œæ¸¸æˆåŠ è½½..."); loading(); System.out.println(this.getPlayer()+" æ¸¸æˆåŠ è½½å®Œæ¯•ç­‰å¾…å…¶ä»–çŽ©å®¶åŠ è½½å®Œæˆ..."); barrier.await(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; 123456789101112131415161718public class GameMain &#123; public static void main(String[] args) &#123; CyclicBarrier barrier = new CyclicBarrier(5); for(int i=0;i&lt;5;i++)&#123; Thread player1 = new Thread(new StartGame(String.valueOf(i+1),barrier)); player1.start(); &#125; try &#123; System.in.read(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; é›†åˆç±»ConcurrentHashMapLinkedBlockingQueuehttps://zhouxiaowu.coding.me/2018/05/08/LinkedBlockingQueue/ é”ä¼˜åŒ– ã€okã€‘æ­»é”é‡çŽ°ä¸ŽæŽ’æŸ¥ ThreadLocalä¸€.ä»€ä¹ˆæ˜¯ThreadLocal?ThreadLocal æ˜¯åœ¨ java.lang.åŒ…ä¸‹çš„ åœ¨jdk1.2é‡Œå¼•å…¥è¿›æ¥ ä¸»è¦æ˜¯ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…è¯¥çº¿ç¨‹æœ¬èº«çš„æœ¬åœ°å˜é‡ è¯¥å˜é‡æ˜¯è¯¥çº¿ç¨‹ç‹¬æœ‰çš„ åˆ«çš„çº¿ç¨‹æ˜¯è®¿é—®ä¸äº†çš„ã€‚ äºŒ. ThreadLocalçš„å®žçŽ°åŽŸç†ï¼šæœ€å…³é”®çš„æ˜¯åœ¨Threadç±»é‡Œæœ‰ä¸€ä¸ªThreadLocal.ThreadLocalMap threadLocalsçš„å±žæ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ç”Ÿæˆçš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªå¯¹åº”ç§æœ‰å±žæ€§ threadLocals ç”Ÿæˆ è¿™ä¸ªå±žæ€§æ˜¯ä¸€ä¸ª ThreadLocalMap ä¹Ÿå°±æ˜¯MAP ï¼Œçœ‹ThreadLocalç±»çš„getæ–¹æ³•ï¼š 12345678910public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) return (T)e.value; &#125; return setInitialValue(); &#125; é€šè¿‡ä¼ å…¥å½“å‰çº¿ç¨‹å¯¹è±¡tä¼šå–å¾—å½“å‰çº¿ç¨‹çš„ ThreadLocalMap è¿™ä¸ªThreadLocalMap keyæ˜¯ThreadLocalå¯¹è±¡ å€¼æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å€¼OBJ,é€šè¿‡ä¼ å…¥å½“å‰çš„ThreadLocalçš„å¯¹è±¡tlï¼ˆä»£ç é‡Œçš„thisï¼‰ä¼šå–å¾—è¯¥keyå¯¹åº”çš„valueå°±æ˜¯æˆ‘ä»¬setå°±åŽ»çš„å¯¹è±¡ ä»Žè€Œå®žçŽ°ä¸€ä¸ªçº¿ç¨‹ æœ‰è‡ªå·±çš„ç‹¬æœ‰çš„ThreadLocalMap ä¸€ä¸ªThreadLocalå¯ä»¥å–å›žè‡ªå·±ä½œä¸ºkeyå¯¹åº”value(OBJ) ã€‚ThreadLocalMap å¯ä»¥å¤šä¸ªkey=&gt;value(ä¸€ä¸ªçº¿ç¨‹å®žä¾‹åŒ–å¤šä¸ªThreadLocal)ã€‚éƒ½æ˜¯é€šè¿‡ä¼ é€’å½“å‰çš„Threadå¯¹è±¡å’Œå½“å‰çš„ThreadLocalå¯¹è±¡å®žçŽ°å–å¾—å”¯ä¸€çš„å€¼çš„ã€‚ å…·ä½“å¦‚ä½•å®žçŽ°è¯·çœ‹æºä»£ç ï¼ˆThreadLocalç±» Threadç±» ThreadLocalç±»é‡Œçš„å†…éƒ¨ç±»ThreadLocalMapï¼‰çš„å„ä¸ªæ–¹æ³• å°¤å…¶æ˜¯ThreadLocalç±» çš„get() set() remove() ç­‰æ–¹æ³•ã€‚ ä¸‰.ä½¿ç”¨åœºæ™¯ï¼šåŸºæœ¬ä¸Šéœ€è¦åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œä¿å­˜ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ æ¯”å¦‚session cookieç­‰éƒ½å¯ä»¥ç”¨è¿™ä¸ª spring ç­‰æ¡†æž¶ä¹Ÿå¹¿æ³›ä½¿ç”¨äº†è¯¥æŠ€æœ¯ã€‚ å››.æ³¨æ„äº‹é¡¹ï¼š åœ¨ä½¿ç”¨ThreadLocalçš„æ—¶å€™setå®ŒåŽçº¿ç¨‹æ‰§è¡Œå®Œéœ€è¦æ˜¾æ€§è°ƒç”¨removeæ–¹æ³•æ¸…é™¤ ä¸ç„¶åœ¨æœ‰çº¿ç¨‹æ± æ¨¡å¼çš„WEBæœåŠ¡å™¨ä¸‹tomcatä¼šå‡ºçŽ° å†…å­˜æº¢å‡ºå’Œç”¨æˆ·ä¸Šä¸‹é”™ä¹±ï¼ˆæ¯”å¦‚Aç”¨æˆ·æ‹¿åˆ°äº†Bç”¨æˆ·çš„SESSIONï¼‰è™½ç„¶åŒä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œåˆ°SETçš„æ—¶å€™ä¼šè¦†ç›–ä¹‹å‰ä¿ç•™çš„å€¼ä½†æ˜¯ä½ æ— æ³•æŽ§åˆ¶å…¶ä»–äººæ˜¯å¦åœ¨SETä¹‹å‰æœ‰è°ƒç”¨äº†ã€‚æ‰€ä»¥ä¸€å®šè¦åœ¨çº¿ç¨‹æ‰§è¡ŒåŽremove. PS:webxçš„filterå’Œinvokeéƒ½æ˜¯é€’å½’è°ƒç”¨çš„ ç¬¬ä¸€ä¸ªfilteréƒ½æ˜¯æœ€å…ˆæ‰§è¡Œæœ€åŽæ”¶å°¾çš„ invokeä¹Ÿç±»ä¼¼ã€‚ 123456789101112131415161718192021public final class MyContext &#123; /** * ç»‘å®šçº¿ç¨‹ */ private static final ThreadLocal&lt;EventContext&gt; LOCAL_CONTEXT = ThreadLocal.withInitial(() -&gt; new EventContext()); private MyContext() &#123; &#125; public static EventContext getContext() &#123; return LOCAL_CONTEXT.get(); &#125; public static void setContext(EventContext context) &#123; LOCAL_CONTEXT.set(context); &#125; //æœ€åŽfilterè°ƒç”¨ public static void clearContext() &#123; LOCAL_CONTEXT.remove(); &#125; ä½¿ç”¨ç¤ºä¾‹æœ€è¿‘åœ¨æˆ‘ä»¬çš„webé¡¹ç›®ä¸­servletéœ€è¦é¢‘ç¹åˆ›å»ºSimpleDateFormatè¿™ä¸ªå¯¹è±¡ï¼Œè¿›è¡Œæ—¥æœŸæ ¼å¼åŒ–ã€‚å› ä¸ºåˆ›å»ºè¿™ä¸ªå¯¹è±¡æœ¬èº«å¾ˆè´¹æ—¶çš„ï¼Œè€Œä¸”æˆ‘ä»¬ä¹ŸçŸ¥é“SimpleDateFormatæœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿä¸èƒ½ç¼“å­˜ä¸€ä¸ªå…±äº«çš„SimpleDateFormatå®žä¾‹ï¼Œä¸ºæ­¤æˆ‘ä»¬æƒ³åˆ°ä½¿ç”¨ThreadLocalæ¥ç»™æ¯ä¸ªçº¿ç¨‹ç¼“å­˜ä¸€ä¸ªSimpleDateFormatå®žä¾‹ï¼Œæé«˜æ€§èƒ½ã€‚åŒæ—¶å› ä¸ºæ¯ä¸ªServletä¼šç”¨åˆ°ä¸åŒpatternçš„æ—¶é—´æ ¼å¼åŒ–ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹åº”æ¯ä¸€ç§patternç”Ÿæˆäº†ä¸€ä¸ªThreadLocalå®žä¾‹ã€‚ 12345678910111213141516171819202122232425262728public class DateFormatFactory &#123;private static final Map&lt;DatePattern, ThreadLocal&lt;DateFormat&gt;&gt; pattern2ThreadLocal;static &#123; DatePattern[] patterns = DatePattern.values(); int len = patterns.length; pattern2ThreadLocal = new HashMap&lt;DatePattern, ThreadLocal&lt;DateFormat&gt;&gt;(len); for (int i = 0; i &lt; len; i++) &#123; DatePattern datePattern = patterns[i]; final String pattern = datePattern.pattern; pattern2ThreadLocal.put(datePattern, new ThreadLocal&lt;DateFormat&gt;() &#123; @Override protected DateFormat initialValue() &#123; return new SimpleDateFormat(pattern); &#125; &#125;); &#125;&#125;//èŽ·å–DateFormatpublic static DateFormat getDateFormat(DatePattern pattern) &#123; ThreadLocal&lt;DateFormat&gt; threadDateFormat = pattern2ThreadLocal.get(pattern); //ä¸éœ€è¦åˆ¤æ–­threadDateFormatæ˜¯å¦ä¸ºç©º return threadDateFormat.get();&#125; 1234567891011public enum DatePattern &#123;TimePattern("yyyy-MM-dd HH:mm:ss"),DatePattern("yyyy-MM-dd"),public String pattern;private DatePattern(String pattern) &#123; this.pattern = pattern;&#125;]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>javaå¹¶å‘åŒ…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼é”é¡¹ç›®æ±‡æ€»]]></title>
    <url>%2F2018%2F05%2F06%2F%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E9%A1%B9%E7%9B%AE%E6%B1%87%E6%80%BB%2F</url>
    <content type="text"><![CDATA[åŸºäºŽdubboçš„åˆ†å¸ƒå¼å·¥ç¨‹å¼€å‘è§„èŒƒå®žä¾‹å·¥ç¨‹ï¼Œåˆ†å¸ƒå¼è·Ÿè¸ªã€IDç”Ÿæˆã€åˆ†å¸ƒå¼äº‹åŠ¡ã€åˆ†å¸ƒå¼æ²»ç†ã€åˆ†è¡¨åˆ†åº“ã€åˆ†å¸ƒå¼é”ã€é€‰ä¸¾ã€APIæ–‡æ¡£ç”Ÿæˆå™¨â€¦ https://github.com/Frankenjoy123/j360-dubbo-app-all å„ç§é”æ±‡æ€»ï¼Œä¹è§‚é”ã€æ‚²è§‚é”ã€åˆ†å¸ƒå¼é”ã€äº’æ–¥é”ã€è¯»å†™é”ã€åˆ†æ®µé”ã€ç±»é”ç­‰ï¼Œå¾ˆä¸é”™çš„æ€»ç»“ https://github.com/Frankenjoy123/Lock-Learning æ±‡æ€»javaç”Ÿæ€åœˆå¸¸ç”¨æŠ€æœ¯æ¡†æž¶ã€å¼€æºä¸­é—´ä»¶ï¼Œç³»ç»Ÿæž¶æž„ã€é¡¹ç›®ç®¡ç†ã€ç»å…¸æž¶æž„æ¡ˆä¾‹ã€æ•°æ®åº“ã€å¸¸ç”¨ä¸‰æ–¹åº“ã€çº¿ä¸Šè¿ç»´ç­‰çŸ¥è¯† https://github.com/aalansehaiyang/technology-talk]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼é”</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨zookeeperå®žçŽ°åˆ†å¸ƒå¼é”äºŒ]]></title>
    <url>%2F2018%2F05%2F06%2F%E4%BD%BF%E7%94%A8zookeeper%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81(%E4%BA%8C)%2F</url>
    <content type="text"><![CDATA[æŽ¨èä¸€ä¸ªå·¥å…·åŸºäºŽrediså’Œzookeeperåˆ†å¸ƒå¼å·¥å…·é›†-åŒ…æ‹¬:åˆ†å¸ƒå¼é”å®žçŽ°,åˆ†å¸ƒå¼é€ŸçŽ‡é™åˆ¶å™¨,åˆ†å¸ƒå¼IDç”Ÿæˆå™¨ç­‰.https://github.com/yujiasun/Distributed-Kit/blob/master/README.md 1.åˆ†å¸ƒå¼é”çš„ç”±æ¥åœ¨ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ä¸å¾—ä¸è€ƒè™‘çš„å°±æ˜¯å¹¶å‘é—®é¢˜ã€‚åœ¨javaä¸­å¯¹äºŽåŒä¸€ä¸ªjvmè€Œè¨€ï¼Œjdkå·²ç»æä¾›äº†lockå’ŒåŒæ­¥ç­‰ã€‚ä½†æ˜¯åœ¨åˆ†å¸ƒå¼æƒ…å†µä¸‹ï¼Œå¾€å¾€å­˜åœ¨å¤šä¸ªè¿›ç¨‹å¯¹ä¸€äº›èµ„æºäº§ç”Ÿç«žäº‰å…³ç³»ï¼Œè€Œè¿™äº›è¿›ç¨‹å¾€å¾€åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œè¿™ä¸ªæ—¶å€™jdkä¸­æä¾›çš„å·²ç»ä¸èƒ½æ»¡è¶³ã€‚åˆ†å¸ƒå¼é”é¡¾æ˜Žæ€è®®å°±æ˜¯å¯ä»¥æ»¡è¶³åˆ†å¸ƒå¼æƒ…å†µä¸‹çš„å¹¶å‘é”ã€‚ ä¸‹é¢æˆ‘ä»¬è®²è§£æ€Žä¹ˆåˆ©ç”¨zkå®žçŽ°åˆ†å¸ƒå¼é”ã€‚ 2.å®žçŽ°æ€è·¯ï¼š2.1 zkç®€å•ä»‹ç»ï¼šZooKeeperæ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€ä¸ªè½¯ä»¶é¡¹ç›®ï¼Œä»–ä¸ºå¤§åž‹åˆ†å¸ƒå¼è®¡ç®—æä¾›å¼€æºçš„åˆ†å¸ƒå¼é…ç½®æœåŠ¡ã€åŒæ­¥æœåŠ¡å’Œå‘½åæ³¨å†Œã€‚åœ¨ ZooKeeper ä¸­ï¼ŒèŠ‚ç‚¹ç±»åž‹å¯ä»¥åˆ†ä¸ºæŒä¹…èŠ‚ç‚¹ï¼ˆPERSISTENT ï¼‰ã€ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEPHEMERALï¼‰ï¼Œä»¥åŠæ—¶åºèŠ‚ç‚¹ï¼ˆSEQUENTIAL ï¼‰ï¼Œå…·ä½“åœ¨èŠ‚ç‚¹åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬æ˜¯ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥ç”Ÿæˆ 4 ç§èŠ‚ç‚¹ç±»åž‹ï¼šæŒä¹…èŠ‚ç‚¹ï¼ˆPERSISTENTï¼‰ï¼ŒæŒä¹…é¡ºåºèŠ‚ç‚¹ï¼ˆPERSISTENT_SEQUENTIALï¼‰ï¼Œä¸´æ—¶èŠ‚ç‚¹ï¼ˆEPHEMERALï¼‰ï¼Œä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEPHEMERAL_SEQUENTIALï¼‰ï¼›å…·ä½“èŠ‚ç‚¹å«ä¹‰ï¼Œè°·æ­Œä¹‹ã€‚ 2.2 åˆ©ç”¨zkå®žçŽ°ï¼šå½“å¾ˆå¤šè¿›ç¨‹éœ€è¦è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡zkæ¥å®žçŽ°åˆ†å¸ƒå¼é”ã€‚ä¸»è¦æ­¥éª¤æ˜¯ï¼š1.å»ºç«‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå‡å¦‚åä¸ºï¼šlock ã€‚èŠ‚ç‚¹ç±»åž‹ä¸ºæŒä¹…èŠ‚ç‚¹ï¼ˆPERSISTENTï¼‰2.æ¯å½“è¿›ç¨‹éœ€è¦è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œä¼šè°ƒç”¨åˆ†å¸ƒå¼é”çš„lock()æˆ–tryLock()æ–¹æ³•èŽ·å¾—é”ï¼Œè¿™ä¸ªæ—¶å€™ä¼šåœ¨ç¬¬ä¸€æ­¥åˆ›å»ºçš„lockèŠ‚ç‚¹ä¸‹å»ºç«‹ç›¸åº”çš„é¡ºåºå­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ç±»åž‹ä¸ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆEPHEMERAL_SEQUENTIALï¼‰ï¼Œé€šè¿‡ç»„æˆç‰¹å®šçš„åå­—name+lock+é¡ºåºå·ã€‚3.åœ¨å»ºç«‹å­èŠ‚ç‚¹åŽï¼Œå¯¹lockä¸‹é¢çš„æ‰€æœ‰ä»¥nameå¼€å¤´çš„å­èŠ‚ç‚¹è¿›è¡ŒæŽ’åºï¼Œåˆ¤æ–­åˆšåˆšå»ºç«‹çš„å­èŠ‚ç‚¹é¡ºåºå·æ˜¯å¦æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œå‡å¦‚æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œåˆ™èŽ·å¾—è¯¥é”å¯¹èµ„æºè¿›è¡Œè®¿é—®ã€‚4.å‡å¦‚ä¸æ˜¯è¯¥èŠ‚ç‚¹ï¼Œå°±èŽ·å¾—è¯¥èŠ‚ç‚¹çš„ä¸Šä¸€é¡ºåºèŠ‚ç‚¹ï¼Œå¹¶ç»™è¯¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨æ³¨å†Œç›‘å¬äº‹ä»¶ã€‚åŒæ—¶åœ¨è¿™é‡Œé˜»å¡žã€‚ç­‰å¾…ç›‘å¬äº‹ä»¶çš„å‘ç”Ÿï¼ŒèŽ·å¾—é”æŽ§åˆ¶æƒã€‚5.å½“è°ƒç”¨å®Œå…±äº«èµ„æºåŽï¼Œè°ƒç”¨unlockï¼ˆï¼‰æ–¹æ³•ï¼Œå…³é—­zkï¼Œè¿›è€Œå¯ä»¥å¼•å‘ç›‘å¬äº‹ä»¶ï¼Œé‡Šæ”¾è¯¥é”ã€‚å®žçŽ°çš„åˆ†å¸ƒå¼é”æ˜¯ä¸¥æ ¼çš„æŒ‰ç…§é¡ºåºè®¿é—®çš„å¹¶å‘é”ã€‚ 3.ä»£ç å®žçŽ°ï¼šä¸‹é¢å°†è®²è§£ä½¿ç”¨javaå®žçŽ°åˆ†å¸ƒå¼é”ï¼š1.å»ºç«‹ç±»DistributedLockï¼Œå®žçŽ°java.util.concurrent.locks.Lock;å’Œorg.apache.zookeeper.WatcheræŽ¥å£2.å®žçŽ°lockä¸‹é¢çš„æ–¹æ³•ï¼šä¸»è¦åŒ…æ‹¬lockï¼ŒtryLockï¼Œunlockç­‰3.å®žçŽ°watcheræŽ¥å£ä¸‹çš„processæ–¹æ³•ã€‚4.åœ¨æž„é€ å™¨ä¸­å¯¹zkè¿›è¡Œåˆå§‹åŒ–ã€‚5.è¯¦ç»†è§ä»£ç æ³¨é‡Š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170package cn.wpeace.zktest;import java.io.IOException;import java.util.ArrayList;import java.util.Collections;import java.util.List;import java.util.concurrent.CountDownLatch;import java.util.concurrent.TimeUnit;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import org.apache.zookeeper.CreateMode;import org.apache.zookeeper.KeeperException;import org.apache.zookeeper.WatchedEvent;import org.apache.zookeeper.Watcher;import org.apache.zookeeper.ZooDefs;import org.apache.zookeeper.ZooKeeper;import org.apache.zookeeper.Watcher.Event.KeeperState;import org.apache.zookeeper.data.Stat;/** * @author peace * */public class DistributedLock implements Lock, Watcher&#123; private ZooKeeper zk; private String root = "/locks";//æ ¹ private String lockName;//ç«žäº‰èµ„æºçš„æ ‡å¿— private String waitNode;//ç­‰å¾…å‰ä¸€ä¸ªé” private String myZnode;//å½“å‰é” private CountDownLatch latch;//è®¡æ•°å™¨ private CountDownLatch connectedSignal=new CountDownLatch(1); private int sessionTimeout = 30000; /** * åˆ›å»ºåˆ†å¸ƒå¼é”,ä½¿ç”¨å‰è¯·ç¡®è®¤configé…ç½®çš„zookeeperæœåŠ¡å¯ç”¨ * @param config 192.168.1.127:2181 * @param lockName ç«žäº‰èµ„æºæ ‡å¿—,lockNameä¸­ä¸èƒ½åŒ…å«å•è¯_lock_ */ public DistributedLock(String config, String lockName)&#123; this.lockName = lockName; // åˆ›å»ºä¸€ä¸ªä¸ŽæœåŠ¡å™¨çš„è¿žæŽ¥ try &#123; zk = new ZooKeeper(config, sessionTimeout, this); connectedSignal.await(); Stat stat = zk.exists(root, false);//æ­¤åŽ»ä¸æ‰§è¡Œ Watcher if(stat == null)&#123; // åˆ›å»ºæ ¹èŠ‚ç‚¹ zk.create(root, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT); &#125; &#125; catch (IOException e) &#123; throw new LockException(e); &#125; catch (KeeperException e) &#123; throw new LockException(e); &#125; catch (InterruptedException e) &#123; throw new LockException(e); &#125; &#125; /** * zookeeperèŠ‚ç‚¹çš„ç›‘è§†å™¨ */ public void process(WatchedEvent event) &#123; //å»ºç«‹è¿žæŽ¥ç”¨ if(event.getState()==KeeperState.SyncConnected)&#123; connectedSignal.countDown(); return; &#125; //å…¶ä»–çº¿ç¨‹æ”¾å¼ƒé”çš„æ ‡å¿— if(this.latch != null) &#123; this.latch.countDown(); &#125; &#125; public void lock() &#123; try &#123; if(this.tryLock())&#123; System.out.println("Thread " + Thread.currentThread().getId() + " " +myZnode + " get lock true"); return; &#125; else&#123; waitForLock(waitNode, sessionTimeout);//ç­‰å¾…é” &#125; &#125; catch (KeeperException e) &#123; throw new LockException(e); &#125; catch (InterruptedException e) &#123; throw new LockException(e); &#125; &#125; public boolean tryLock() &#123; try &#123; String splitStr = "_lock_"; if(lockName.contains(splitStr)) throw new LockException("lockName can not contains \\u000B"); //åˆ›å»ºä¸´æ—¶å­èŠ‚ç‚¹ myZnode = zk.create(root + "/" + lockName + splitStr, new byte[0], ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.EPHEMERAL_SEQUENTIAL); System.out.println(myZnode + " is created "); //å–å‡ºæ‰€æœ‰å­èŠ‚ç‚¹ List&lt;String&gt; subNodes = zk.getChildren(root, false); //å–å‡ºæ‰€æœ‰lockNameçš„é” List&lt;String&gt; lockObjNodes = new ArrayList&lt;String&gt;(); for (String node : subNodes) &#123; String _node = node.split(splitStr)[0]; if(_node.equals(lockName))&#123; lockObjNodes.add(node); &#125; &#125; Collections.sort(lockObjNodes); if(myZnode.equals(root+"/"+lockObjNodes.get(0)))&#123; //å¦‚æžœæ˜¯æœ€å°çš„èŠ‚ç‚¹,åˆ™è¡¨ç¤ºå–å¾—é” System.out.println(myZnode + "==" + lockObjNodes.get(0)); return true; &#125; //å¦‚æžœä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹ String subMyZnode = myZnode.substring(myZnode.lastIndexOf("/") + 1); waitNode = lockObjNodes.get(Collections.binarySearch(lockObjNodes, subMyZnode) - 1);//æ‰¾åˆ°å‰ä¸€ä¸ªå­èŠ‚ç‚¹ &#125; catch (KeeperException e) &#123; throw new LockException(e); &#125; catch (InterruptedException e) &#123; throw new LockException(e); &#125; return false; &#125; public boolean tryLock(long time, TimeUnit unit) &#123; try &#123; if(this.tryLock())&#123; return true; &#125; return waitForLock(waitNode,time); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return false; &#125; private boolean waitForLock(String lower, long waitTime) throws InterruptedException, KeeperException &#123; Stat stat = zk.exists(root + "/" + lower,true);//åŒæ—¶æ³¨å†Œç›‘å¬ã€‚ //åˆ¤æ–­æ¯”è‡ªå·±å°ä¸€ä¸ªæ•°çš„èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨,å¦‚æžœä¸å­˜åœ¨åˆ™æ— éœ€ç­‰å¾…é”,åŒæ—¶æ³¨å†Œç›‘å¬ if(stat != null)&#123; System.out.println("Thread " + Thread.currentThread().getId() + " waiting for " + root + "/" + lower); this.latch = new CountDownLatch(1); this.latch.await(waitTime, TimeUnit.MILLISECONDS);//ç­‰å¾…ï¼Œè¿™é‡Œåº”è¯¥ä¸€ç›´ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾é” this.latch = null; &#125; return true; &#125; public void unlock() &#123; try &#123; System.out.println("unlock " + myZnode); zk.delete(myZnode,-1); myZnode = null; zk.close(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (KeeperException e) &#123; e.printStackTrace(); &#125; &#125; public void lockInterruptibly() throws InterruptedException &#123; this.lock(); &#125; public Condition newCondition() &#123; return null; &#125; public class LockException extends RuntimeException &#123; private static final long serialVersionUID = 1L; public LockException(String e)&#123; super(e); &#125; public LockException(Exception e)&#123; super(e); &#125; &#125;&#125; 4.æµ‹è¯•ï¼š1.ä¸‹è½½æˆ‘çš„å·¥ç¨‹ä»£ç ï¼šç‚¹å‡»ä¸‹è½½2.æˆ–è€…ç›´æŽ¥ä½¿ç”¨è¯¥ç±»ï¼š DistributedLock lock = new DistributedLock(â€œ192.168.1.127:2181â€,â€lockâ€); lock.lock(); //å…±äº«èµ„æº if(lock != null) lock.unlock();123453.æ‰§è¡Œæ­¥éª¤ï¼š1.å¯åŠ¨zk:zkServer.sh start2.å¯åŠ¨æµ‹è¯•ä»£ç 3.æ‰§è¡Œç»“æžœï¼š0506]]></content>
      <categories>
        <category>zookeeper</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼é”</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨zookeeperå®žçŽ°åˆ†å¸ƒå¼é”ä¸€]]></title>
    <url>%2F2018%2F05%2F06%2F%E4%BD%BF%E7%94%A8zookeeper%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81(%E4%B8%80)%2F</url>
    <content type="text"><![CDATA[ä¸€ã€åˆ†å¸ƒå¼é”ä»‹ç»â€‹ åˆ†å¸ƒå¼é”ä¸»è¦ç”¨äºŽåœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒä¸­ä¿æŠ¤è·¨è¿›ç¨‹ã€è·¨ä¸»æœºã€è·¨ç½‘ç»œçš„å…±äº«èµ„æºå®žçŽ°äº’æ–¥è®¿é—®ï¼Œä»¥è¾¾åˆ°ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚ äºŒã€æž¶æž„ä»‹ç»â€‹ åœ¨ä»‹ç»ä½¿ç”¨Zookeeperå®žçŽ°åˆ†å¸ƒå¼é”ä¹‹å‰ï¼Œé¦–å…ˆçœ‹å½“å‰çš„ç³»ç»Ÿæž¶æž„å›¾ â€‹ â€‹ è§£é‡Šï¼š å·¦è¾¹çš„æ•´ä¸ªåŒºåŸŸè¡¨ç¤ºä¸€ä¸ªZookeeperé›†ç¾¤ï¼Œlockeræ˜¯Zookeeperçš„ä¸€ä¸ªæŒä¹…èŠ‚ç‚¹ï¼Œnode_1ã€node_2ã€node_3æ˜¯lockerè¿™ä¸ªæŒä¹…èŠ‚ç‚¹ä¸‹é¢çš„ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ã€‚client_1ã€client_2ã€client_nè¡¨ç¤ºå¤šä¸ªå®¢æˆ·ç«¯ï¼ŒServiceè¡¨ç¤ºéœ€è¦äº’æ–¥è®¿é—®çš„å…±äº«èµ„æºã€‚ ä¸‰ã€åˆ†å¸ƒå¼é”èŽ·å–æ€è·¯â€‹ 1ï¼ŽèŽ·å–åˆ†å¸ƒå¼é”çš„æ€»ä½“æ€è·¯ â€‹ åœ¨èŽ·å–åˆ†å¸ƒå¼é”çš„æ—¶å€™åœ¨lockerèŠ‚ç‚¹ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œé‡Šæ”¾é”çš„æ—¶å€™åˆ é™¤è¯¥ä¸´æ—¶èŠ‚ç‚¹ã€‚å®¢æˆ·ç«¯è°ƒç”¨createNodeæ–¹æ³•åœ¨lockerä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼Œ ç„¶åŽè°ƒç”¨getChildren(â€œlockerâ€)æ¥èŽ·å–lockerä¸‹é¢çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œæ³¨æ„æ­¤æ—¶ä¸ç”¨è®¾ç½®ä»»ä½•Watcherã€‚å®¢æˆ·ç«¯èŽ·å–åˆ°æ‰€æœ‰çš„å­èŠ‚ç‚¹pathä¹‹åŽï¼Œå¦‚æžœå‘çŽ°è‡ªå·±åœ¨ä¹‹ å‰åˆ›å»ºçš„å­èŠ‚ç‚¹åºå·æœ€å°ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¯¥å®¢æˆ·ç«¯èŽ·å–åˆ°äº†é”ã€‚å¦‚æžœå‘çŽ°è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹å¹¶éžlockeræ‰€æœ‰å­èŠ‚ç‚¹ä¸­æœ€å°çš„ï¼Œè¯´æ˜Žè‡ªå·±è¿˜æ²¡æœ‰èŽ·å–åˆ°é”ï¼Œ æ­¤æ—¶å®¢æˆ·ç«¯éœ€è¦æ‰¾åˆ°æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œç„¶åŽå¯¹å…¶è°ƒç”¨exist()æ–¹æ³•ï¼ŒåŒæ—¶å¯¹å…¶æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ã€‚ä¹‹åŽï¼Œè®©è¿™ä¸ªè¢«å…³æ³¨çš„èŠ‚ç‚¹åˆ é™¤ï¼Œåˆ™å®¢æˆ·ç«¯çš„Watcherä¼š æ”¶åˆ°ç›¸åº”é€šçŸ¥ï¼Œæ­¤æ—¶å†æ¬¡åˆ¤æ–­è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦æ˜¯lockerå­èŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ï¼Œå¦‚çš‹æ˜¯åˆ™èŽ·å–åˆ°äº†é”ï¼Œå¦‚æžœä¸æ˜¯åˆ™é‡å¤ä»¥ä¸Šæ­¥éª¤ç»§ç»­èŽ·å–åˆ°æ¯”è‡ªå·±å°çš„ä¸€ä¸ª èŠ‚ç‚¹å¹¶æ³¨å†Œç›‘å¬ã€‚å½“å‰è¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜éœ€è¦è®¸å¤šçš„é€»è¾‘åˆ¤æ–­ã€‚ 2ï¼ŽèŽ·å–åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒç®—æ³•æµç¨‹ â€‹ ä¸‹é¢åŒä¸ªä¸€ä¸ªæµç¨‹å›¾æ¥åˆ†æžèŽ·å–åˆ†å¸ƒå¼é”çš„å®Œæ•´ç®—æ³•ï¼Œå¦‚ä¸‹ï¼šâ€‹ â€‹ https://img-blog.csdn.net/20160716210945194?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center â€‹ è§£é‡Šï¼šå®¢æˆ·ç«¯Aè¦èŽ·å–åˆ†å¸ƒå¼é”çš„æ—¶å€™é¦–å…ˆåˆ°lockerä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼ˆnode_nï¼‰ï¼Œç„¶åŽç«‹å³èŽ·å–lockerä¸‹çš„æ‰€æœ‰ï¼ˆä¸€çº§ï¼‰å­èŠ‚ç‚¹ã€‚ æ­¤æ—¶å› ä¸ºä¼šæœ‰å¤šä¸ªå®¢æˆ·ç«¯åŒä¸€æ—¶é—´äº‰å–é”ï¼Œå› æ­¤lockerä¸‹çš„å­èŠ‚ç‚¹æ•°é‡å°±ä¼šå¤§äºŽ1ã€‚å¯¹äºŽé¡ºåºèŠ‚ç‚¹ï¼Œç‰¹ç‚¹æ˜¯èŠ‚ç‚¹åç§°åŽé¢è‡ªåŠ¨æœ‰ä¸€ä¸ªæ•°å­—ç¼–å·ï¼Œ å…ˆåˆ›å»ºçš„èŠ‚ç‚¹æ•°å­—ç¼–å·å°äºŽåŽåˆ›å»ºçš„ï¼Œå› æ­¤å¯ä»¥å°†å­èŠ‚ç‚¹æŒ‰ç…§èŠ‚ç‚¹åç§°åŽç¼€çš„æ•°å­—é¡ºåºä»Žå°åˆ°å¤§æŽ’åºï¼Œè¿™æ ·æŽ’åœ¨ç¬¬ä¸€ä½çš„å°±æ˜¯æœ€å…ˆåˆ›å»ºçš„é¡ºåºèŠ‚ç‚¹ï¼Œ æ­¤æ—¶å®ƒå°±ä»£è¡¨äº†æœ€å…ˆäº‰å–åˆ°é”çš„å®¢æˆ·ç«¯ï¼æ­¤æ—¶åˆ¤æ–­æœ€å°çš„è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºå®¢æˆ·ç«¯Aä¹‹å‰åˆ›å»ºå‡ºæ¥çš„node_nï¼Œå¦‚æžœæ˜¯åˆ™è¡¨ç¤ºå®¢æˆ·ç«¯AèŽ·å–åˆ°äº†é”ï¼Œ å¦‚æžœä¸æ˜¯åˆ™è¡¨ç¤ºé”å·²ç»è¢«å…¶å®ƒå®¢æˆ·ç«¯èŽ·å–ï¼Œå› æ­¤å®¢æˆ·ç«¯Aè¦ç­‰å¾…å®ƒé‡Šæ”¾é”ï¼Œä¹Ÿå°±æ˜¯ç­‰å¾…èŽ·å–åˆ°é”çš„é‚£ä¸ªå®¢æˆ·ç«¯BæŠŠè‡ªå·±åˆ›å»ºçš„é‚£ä¸ªèŠ‚ç‚¹åˆ é™¤ã€‚ æ­¤æ—¶å°±é€šè¿‡ç›‘å¬æ¯”node_næ¬¡å°çš„é‚£ä¸ªé¡ºåºèŠ‚ç‚¹çš„åˆ é™¤äº‹ä»¶æ¥çŸ¥é“å®¢æˆ·ç«¯Bæ˜¯å¦å·²ç»é‡Šæ”¾äº†é”ï¼Œå¦‚æžœæ˜¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯Aå†æ¬¡èŽ·å–lockerä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œ å†æ¬¡ä¸Žè‡ªå·±åˆ›å»ºçš„node_nèŠ‚ç‚¹å¯¹æ¯”ï¼Œç›´åˆ°è‡ªå·±åˆ›å»ºçš„node_næ˜¯lockerçš„æ‰€æœ‰å­èŠ‚ç‚¹ä¸­é¡ºåºå·æœ€å°çš„ï¼Œæ­¤æ—¶è¡¨ç¤ºå®¢æˆ·ç«¯AèŽ·å–åˆ°äº†é”ï¼ å››ã€åŸºäºŽZookeeperçš„åˆ†å¸ƒå¼é”çš„ä»£ç å®žçŽ°1ï¼Žå®šä¹‰åˆ†å¸ƒå¼é”æŽ¥å£â€‹ å®šä¹‰çš„åˆ†å¸ƒå¼é”æŽ¥å£å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839public interface DistributedLock &#123; /**èŽ·å–é”ï¼Œå¦‚æžœæ²¡æœ‰å¾—åˆ°å°±ç­‰å¾…*/ public void acquire() throws Exception; /** * èŽ·å–é”ï¼Œç›´åˆ°è¶…æ—¶ * @param timeè¶…æ—¶æ—¶é—´ * @param unit timeå‚æ•°çš„å•ä½ * @returnæ˜¯å¦èŽ·å–åˆ°é” * @throws Exception */ public boolean acquire (long time, TimeUnit unit) throws Exception; /** * é‡Šæ”¾é” * @throws Exception */ public void release() throws Exception;&#125; â€‹ 2ï¼Žå®šä¹‰ä¸€ä¸ªç®€å•çš„äº’æ–¥é”â€‹ å®šä¹‰ä¸€ä¸ªäº’æ–¥é”ç±»ï¼Œå®žçŽ°ä»¥ä¸Šå®šä¹‰çš„é”æŽ¥å£ï¼ŒåŒæ—¶ç»§æ‰¿ä¸€ä¸ªåŸºç±»BaseDistributedLockï¼Œè¯¥åŸºç±»ä¸»è¦ç”¨äºŽä¸ŽZookeeperäº¤äº’ï¼Œ â€‹ åŒ…å«ä¸€ä¸ªå°è¯•èŽ·å–é”çš„æ–¹æ³•å’Œä¸€ä¸ªé‡Šæ”¾é”ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117/**é”æŽ¥å£çš„å…·ä½“å®žçŽ°ï¼Œä¸»è¦å€ŸåŠ©äºŽç»§æ‰¿çš„çˆ¶ç±»BaseDistributedLockæ¥å®žçŽ°çš„æŽ¥å£æ–¹æ³• * è¯¥çˆ¶ç±»æ˜¯åŸºäºŽZookeeperå®žçŽ°åˆ†å¸ƒå¼é”çš„å…·ä½“ç»†èŠ‚å®žçŽ°*/public class SimpleDistributedLockMutex extends BaseDistributedLock implements DistributedLock &#123; /*ç”¨äºŽä¿å­˜Zookeeperä¸­å®žçŽ°åˆ†å¸ƒå¼é”çš„èŠ‚ç‚¹ï¼Œå¦‚åç§°ä¸ºlockerï¼š/lockerï¼Œ *è¯¥èŠ‚ç‚¹åº”è¯¥æ˜¯æŒä¹…èŠ‚ç‚¹ï¼Œåœ¨è¯¥èŠ‚ç‚¹ä¸‹é¢åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹æ¥å®žçŽ°åˆ†å¸ƒå¼é” */ private final String basePath; /*é”åç§°å‰ç¼€ï¼Œlockerä¸‹åˆ›å»ºçš„é¡ºåºèŠ‚ç‚¹ä¾‹å¦‚éƒ½ä»¥lock-å¼€å¤´ï¼Œè¿™æ ·ä¾¿äºŽè¿‡æ»¤æ— å…³èŠ‚ç‚¹ *è¿™æ ·åˆ›å»ºåŽçš„èŠ‚ç‚¹ç±»ä¼¼ï¼šlock-00000001ï¼Œlock-000000002*/ private staticfinal String LOCK_NAME ="lock-"; /*ç”¨äºŽä¿å­˜æŸä¸ªå®¢æˆ·ç«¯åœ¨lockerä¸‹é¢åˆ›å»ºæˆåŠŸçš„é¡ºåºèŠ‚ç‚¹ï¼Œç”¨äºŽåŽç»­ç›¸å…³æ“ä½œä½¿ç”¨ï¼ˆå¦‚åˆ¤æ–­ï¼‰*/ private String ourLockPath; /** * ç”¨äºŽèŽ·å–é”èµ„æºï¼Œé€šè¿‡çˆ¶ç±»çš„èŽ·å–é”æ–¹æ³•æ¥èŽ·å–é” * @param timeèŽ·å–é”çš„è¶…æ—¶æ—¶é—´ * @param unit timeçš„æ—¶é—´å•ä½ * @returnæ˜¯å¦èŽ·å–åˆ°é” * @throws Exception */ private boolean internalLock (long time, TimeUnit unit) throws Exception &#123; //å¦‚æžœourLockPathä¸ä¸ºç©ºåˆ™è®¤ä¸ºèŽ·å–åˆ°äº†é”ï¼Œå…·ä½“å®žçŽ°ç»†èŠ‚è§attemptLockçš„å®žçŽ° ourLockPath = attemptLock(time, unit); return ourLockPath !=null; &#125; /** * ä¼ å…¥Zookeeperå®¢æˆ·ç«¯è¿žæŽ¥å¯¹è±¡ï¼Œå’ŒbasePath * @param client Zookeeperå®¢æˆ·ç«¯è¿žæŽ¥å¯¹è±¡ * @param basePath basePathæ˜¯ä¸€ä¸ªæŒä¹…èŠ‚ç‚¹ */ public SimpleDistributedLockMutex(ZkClientExt client, String basePath)&#123; /*è°ƒç”¨çˆ¶ç±»çš„æž„é€ æ–¹æ³•åœ¨Zookeeperä¸­åˆ›å»ºbasePathèŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸ºbasePathèŠ‚ç‚¹å­èŠ‚ç‚¹è®¾ç½®å‰ç¼€ *åŒæ—¶ä¿å­˜basePathçš„å¼•ç”¨ç»™å½“å‰ç±»å±žæ€§*/ super(client,basePath,LOCK_NAME); this.basePath = basePath; &#125; /**èŽ·å–é”ï¼Œç›´åˆ°è¶…æ—¶ï¼Œè¶…æ—¶åŽæŠ›å‡ºå¼‚å¸¸*/ public void acquire() throws Exception &#123; //-1è¡¨ç¤ºä¸è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶ç”±Zookeeperå†³å®š if (!internalLock(-1,null))&#123; throw new IOException("è¿žæŽ¥ä¸¢å¤±!åœ¨è·¯å¾„:'"+basePath+"'ä¸‹ä¸èƒ½èŽ·å–é”!"); &#125; &#125; /** * èŽ·å–é”ï¼Œå¸¦æœ‰è¶…æ—¶æ—¶é—´ */ public boolean acquire(long time, TimeUnit unit) throws Exception &#123; return internalLock(time, unit); &#125; /**é‡Šæ”¾é”*/ public void release()throws Exception &#123; releaseLock(ourLockPath); &#125;&#125; â€‹ 3. åˆ†å¸ƒå¼é”çš„å®žçŽ°ç»†èŠ‚èŽ·å–åˆ†å¸ƒå¼é”çš„é‡ç‚¹é€»è¾‘åœ¨äºŽBaseDistributedLockï¼Œå®žçŽ°äº†åŸºäºŽZookeeperå®žçŽ°åˆ†å¸ƒå¼é”çš„ç»†èŠ‚ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189public class BaseDistributedLock &#123; private final ZkClientExt client; private final String path; private final String basePath; private final String lockName; private static final Integer MAX_RETRY_COUNT = 10; public BaseDistributedLock(ZkClientExt client, String path, String lockName)&#123; this.client = client; this.basePath = path; this.path = path.concat("/").concat(lockName); this.lockName = lockName; &#125; private void deleteOurPath(String ourPath) throws Exception&#123; client.delete(ourPath); &#125; private String createLockNode(ZkClient client, String path) throws Exception&#123; return client.createEphemeralSequential(path, null); &#125; /** * èŽ·å–é”çš„æ ¸å¿ƒæ–¹æ³• * @param startMillis * @param millisToWait * @param ourPath * @return * @throws Exception */ private boolean waitToLock(long startMillis, Long millisToWait, String ourPath) throws Exception&#123; boolean haveTheLock = false; boolean doDelete = false; try&#123; while ( !haveTheLock ) &#123; //è¯¥æ–¹æ³•å®žçŽ°èŽ·å–lockerèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰é¡ºåºèŠ‚ç‚¹ï¼Œå¹¶ä¸”ä»Žå°åˆ°å¤§æŽ’åº List&lt;String&gt; children = getSortedChildren(); String sequenceNodeName = ourPath.substring(basePath.length()+1); //è®¡ç®—åˆšæ‰å®¢æˆ·ç«¯åˆ›å»ºçš„é¡ºåºèŠ‚ç‚¹åœ¨lockerçš„æ‰€æœ‰å­èŠ‚ç‚¹ä¸­æŽ’åºä½ç½®ï¼Œå¦‚æžœæ˜¯æŽ’åºä¸º0ï¼Œåˆ™è¡¨ç¤ºèŽ·å–åˆ°äº†é” int ourIndex = children.indexOf(sequenceNodeName); /*å¦‚æžœåœ¨getSortedChildrenä¸­æ²¡æœ‰æ‰¾åˆ°ä¹‹å‰åˆ›å»ºçš„[ä¸´æ—¶]é¡ºåºèŠ‚ç‚¹ï¼Œè¿™è¡¨ç¤ºå¯èƒ½ç”±äºŽç½‘ç»œé—ªæ–­è€Œå¯¼è‡´ *Zookeeperè®¤ä¸ºè¿žæŽ¥æ–­å¼€è€Œåˆ é™¤äº†æˆ‘ä»¬åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œæ­¤æ—¶éœ€è¦æŠ›å‡ºå¼‚å¸¸ï¼Œè®©ä¸Šä¸€çº§åŽ»å¤„ç† *ä¸Šä¸€çº§çš„åšæ³•æ˜¯æ•èŽ·è¯¥å¼‚å¸¸ï¼Œå¹¶ä¸”æ‰§è¡Œé‡è¯•æŒ‡å®šçš„æ¬¡æ•° è§åŽé¢çš„ attemptLockæ–¹æ³• */ if ( ourIndex&lt;0 )&#123; throw new ZkNoNodeException("èŠ‚ç‚¹æ²¡æœ‰æ‰¾åˆ°: " + sequenceNodeName); &#125; //å¦‚æžœå½“å‰å®¢æˆ·ç«¯åˆ›å»ºçš„èŠ‚ç‚¹åœ¨lockerå­èŠ‚ç‚¹åˆ—è¡¨ä¸­ä½ç½®å¤§äºŽ0ï¼Œè¡¨ç¤ºå…¶å®ƒå®¢æˆ·ç«¯å·²ç»èŽ·å–äº†é” //æ­¤æ—¶å½“å‰å®¢æˆ·ç«¯éœ€è¦ç­‰å¾…å…¶å®ƒå®¢æˆ·ç«¯é‡Šæ”¾é”ï¼Œ boolean isGetTheLock = ourIndex == 0; //å¦‚ä½•åˆ¤æ–­å…¶å®ƒå®¢æˆ·ç«¯æ˜¯å¦å·²ç»é‡Šæ”¾äº†é”ï¼Ÿä»Žå­èŠ‚ç‚¹åˆ—è¡¨ä¸­èŽ·å–åˆ°æ¯”è‡ªå·±æ¬¡å°çš„å“ªä¸ªèŠ‚ç‚¹ï¼Œå¹¶å¯¹å…¶å»ºç«‹ç›‘å¬ String pathToWatch = isGetTheLock ? null : children.get(ourIndex - 1); if ( isGetTheLock )&#123; haveTheLock = true; &#125;else&#123; //å¦‚æžœæ¬¡å°çš„èŠ‚ç‚¹è¢«åˆ é™¤äº†ï¼Œåˆ™è¡¨ç¤ºå½“å‰å®¢æˆ·ç«¯çš„èŠ‚ç‚¹åº”è¯¥æ˜¯æœ€å°çš„äº†ï¼Œæ‰€ä»¥ä½¿ç”¨CountDownLatchæ¥å®žçŽ°ç­‰å¾… String previousSequencePath = basePath .concat( "/" ) .concat( pathToWatch ); final CountDownLatch latch = new CountDownLatch(1); final IZkDataListener previousListener = new IZkDataListener() &#123; //æ¬¡å°èŠ‚ç‚¹åˆ é™¤äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè®©countDownLatchç»“æŸç­‰å¾… //æ­¤æ—¶è¿˜éœ€è¦é‡æ–°è®©ç¨‹åºå›žåˆ°whileï¼Œé‡æ–°åˆ¤æ–­ä¸€æ¬¡ï¼ public void handleDataDeleted(String dataPath) throws Exception &#123; latch.countDown(); &#125; public void handleDataChange(String dataPath, Object data) throws Exception &#123; // ignore &#125; &#125;; try&#123; //å¦‚æžœèŠ‚ç‚¹ä¸å­˜åœ¨ä¼šå‡ºçŽ°å¼‚å¸¸ client.subscribeDataChanges(previousSequencePath, previousListener); if ( millisToWait != null )&#123; millisToWait -= (System.currentTimeMillis() - startMillis); startMillis = System.currentTimeMillis(); if ( millisToWait &lt;= 0 )&#123; doDelete = true; // timed out - delete our node break; &#125; latch.await(millisToWait, TimeUnit.MICROSECONDS); &#125;else&#123; latch.await(); &#125; &#125;catch ( ZkNoNodeException e )&#123; //ignore &#125;finally&#123; client.unsubscribeDataChanges(previousSequencePath, previousListener); &#125; &#125; &#125; &#125;catch ( Exception e )&#123; //å‘ç”Ÿå¼‚å¸¸éœ€è¦åˆ é™¤èŠ‚ç‚¹ doDelete = true; throw e; &#125;finally&#123; //å¦‚æžœéœ€è¦åˆ é™¤èŠ‚ç‚¹ if ( doDelete )&#123; deleteOurPath(ourPath); &#125; &#125; return haveTheLock; &#125; private String getLockNodeNumber(String str, String lockName) &#123; int index = str.lastIndexOf(lockName); if ( index &gt;= 0 )&#123; index += lockName.length(); return index &lt;= str.length() ? str.substring(index) : ""; &#125; return str; &#125; private List&lt;String&gt; getSortedChildren() throws Exception &#123; try&#123; List&lt;String&gt; children = client.getChildren(basePath); Collections.sort( children, new Comparator&lt;String&gt;()&#123; public int compare(String lhs, String rhs)&#123; return getLockNodeNumber(lhs, lockName).compareTo(getLockNodeNumber(rhs, lockName)); &#125; &#125; ); return children; &#125;catch(ZkNoNodeException e)&#123; client.createPersistent(basePath, true); return getSortedChildren(); &#125; &#125; protected void releaseLock(String lockPath) throws Exception&#123; deleteOurPath(lockPath); &#125; protected String attemptLock(long time, TimeUnit unit) throws Exception&#123; final long startMillis = System.currentTimeMillis(); final Long millisToWait = (unit != null) ? unit.toMillis(time) : null; String ourPath = null; boolean hasTheLock = false; boolean isDone = false; int retryCount = 0; //ç½‘ç»œé—ªæ–­éœ€è¦é‡è¯•ä¸€è¯• while ( !isDone )&#123; isDone = true; try&#123; //createLockNodeç”¨äºŽåœ¨lockerï¼ˆbasePathæŒä¹…èŠ‚ç‚¹ï¼‰ä¸‹åˆ›å»ºå®¢æˆ·ç«¯è¦èŽ·å–é”çš„[ä¸´æ—¶]é¡ºåºèŠ‚ç‚¹ ourPath = createLockNode(client, path); /** * è¯¥æ–¹æ³•ç”¨äºŽåˆ¤æ–­è‡ªå·±æ˜¯å¦èŽ·å–åˆ°äº†é”ï¼Œå³è‡ªå·±åˆ›å»ºçš„é¡ºåºèŠ‚ç‚¹åœ¨lockerçš„æ‰€æœ‰å­èŠ‚ç‚¹ä¸­æ˜¯å¦æœ€å° * å¦‚æžœæ²¡æœ‰èŽ·å–åˆ°é”ï¼Œåˆ™ç­‰å¾…å…¶å®ƒå®¢æˆ·ç«¯é”çš„é‡Šæ”¾ï¼Œå¹¶ä¸”ç¨åŽé‡è¯•ç›´åˆ°èŽ·å–åˆ°é”æˆ–è€…è¶…æ—¶ */ hasTheLock = waitToLock(startMillis, millisToWait, ourPath); &#125;catch ( ZkNoNodeException e )&#123; if ( retryCount++ &lt; MAX_RETRY_COUNT )&#123; isDone = false; &#125;else&#123; throw e; &#125; &#125; &#125; if ( hasTheLock )&#123; return ourPath; &#125; return nullï¼›ï½]]></content>
      <categories>
        <category>zookeeper</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼é”</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨rediså®žçŽ°åˆ†å¸ƒå¼é”å®žè·µ]]></title>
    <url>%2F2018%2F05%2F06%2F%E4%BD%BF%E7%94%A8redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E8%B7%B5%2F</url>
    <content type="text"><![CDATA[åˆ†å¸ƒå¼é”åœ¨å¤šå®žä¾‹éƒ¨ç½²,åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç»å¸¸ä¼šä½¿ç”¨åˆ°,è¿™æ˜¯å› ä¸ºåŸºäºŽjvmçš„é”æ— æ³•æ»¡è¶³å¤šå®žä¾‹ä¸­é”çš„éœ€æ±‚,æœ¬ç¯‡å°†è®²ä¸‹rediså¦‚ä½•é€šè¿‡Luaè„šæœ¬å®žçŽ°åˆ†å¸ƒå¼é”,ä¸åŒäºŽç½‘ä¸Šçš„redission,å®Œå…¨æ˜¯æ‰‹åŠ¨å®žçŽ°çš„ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªæ— é”çš„æƒ…å†µä¸‹ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜: è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„æ›´æ–°ç”¨æˆ·å¹´é¾„çš„åŠŸèƒ½,å„å±‚ä»£ç å¦‚ä¸‹,è®¿é—®controllerå±‚,ä¸€ä¸ªæ›´æ–°,ä¸€ä¸ªæŸ¥è¯¢ è¿™æ˜¯serviceå±‚,æˆ‘ä»¬ä½¿ç”¨contdownlatchå‘ä»¤æžªæ¥æ¨¡æ‹Ÿçº¿ç¨‹åŒæ—¶å¹¶å‘çš„æƒ…å†µ,å‘ä»¤æžªè®¾ä¸º32,å³32ä¸ªçº¿ç¨‹åŒæ—¶åŽ»è¯·æ±‚ä¿®æ”¹å¹´é¾„, è¿™é‡Œä½¿ç”¨çº¿ç¨‹æ± æ¥æäº¤å¤šçº¿ç¨‹ä»»åŠ¡,çœ‹ä»£ç çŸ¥é“,è¿™é‡Œæˆ‘ä»¬å·²ç»æœ‰äº†åˆ¤æ–­å¹´é¾„çš„æ“ä½œ,å½“æŸ¥è¯¢ç”¨æˆ·æŸ¥è¯¢å¤§äºŽ0æ—¶,æ‰åŽ»è°ƒæ›´æ–°ç”¨æˆ·å¹´é¾„-1çš„æ–¹æ³•,ç­‰ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰ç”¨ è¿™é‡Œæ˜¯sql,å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªsql,ä¸€ä¸ªæŸ¥è¯¢ç”¨æˆ·å¹´é¾„,ä¸€ä¸ªä¼šæ‰§è¡Œç”¨æˆ·å¹´é¾„æ¯æ¬¡å‡1 , è¿™é‡Œæ˜¯ç”¨æˆ·æ•°æ®,æˆ‘ä»¬å¯ä»¥çœ‹åˆ°,ç”¨æˆ·UIDä¸ºUR12324çš„ç”¨æˆ·,ä»–çš„å¹´é¾„æ˜¯30,æŽ¥ç€æˆ‘ä»¬æ¥è°ƒ32ä¸ªçº¿ç¨‹æ¥æ“ä½œå‡ä»–å¹´é¾„ æˆ‘ä»¬è¯·æ±‚ä¸‹è¿™ä¸ªæ–¹æ³• ç„¶åŽçœ‹çœ‹ç»“æžœ: å¯ä»¥çœ‹åˆ°åº“ä¸­å¹´é¾„å·²è¢«å‡ä¸º-2,åœ¨æœªåŠ é”çš„æƒ…å†µä¸‹,æŸ¥è¯¢è¾ƒéªŒå¹¶æ²¡æœ‰ä»€ä¹ˆä½œç”¨,æ­¤æ—¶å¦‚æžœåŠ ä¸ªsynchronizedæˆ–locké”è‚¯å®šèƒ½é¿å…è¿™ç§æƒ…å†µ,ä½†æˆ‘ä»¬æœ¬æ–‡è®¨è®ºçš„æ˜¯å¤šå®žä¾‹æˆ–åˆ†å¸ƒå¼çŽ¯å¢ƒä¸­,æ­¤åŠ é”æ–¹å¼ä»ç„¶ä¼šäº§ç”Ÿé—®é¢˜,æ„Ÿå…´è¶£çš„å¯ä»¥è¯•ä¸‹æ˜¯ä¸æ˜¯ ä¸‹é¢æˆ‘ä»¬å¼€å§‹å®žçŽ°ä¸€ä¸ªredisåˆ†å¸ƒå¼é”,æ¥é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿ,å…ˆè¯´è¯´å®žçŽ°æ€è·¯: 1,çº¿ç¨‹è¯·æ±‚è®¿é—®å‰å…ˆè°ƒç”¨åŠ é”çš„æ–¹æ³•,åŠ é”å°±åŽ»é‡Œç”Ÿæˆä¸€ä¸ªéšæœºæ•°åŒæ—¶ä¿å­˜åœ¨çº¿ç¨‹æœ¬åœ°å˜é‡å’Œredisçš„æŸkeyä¸­,æ­¤keyè®¾æœ‰æ•ˆæœŸä¸º200ms,å…·ä½“å€¼æ ¹æ®ä¸šåŠ¡æ‰§è¡Œæ—¶é—´è‡ªè¡Œè°ƒæ•´,åŠ é”æˆåŠŸ; 2.å…¶å®ƒçº¿ç¨‹è¯•ç€è®¿é—®æ‹¿å‡ºå®ƒæœ¬åœ°å˜é‡ä¸Žredisä¸­æŸkeyè¿›è¡Œæ¯”è¾ƒ,å¦‚æžœä¸ä¸€è‡´,åˆ™è¯´æ˜Žæœ‰é”,æ­¤çº¿ç¨‹ä¼‘çœ ä¸€æ®µæ—¶é—´,å†è¯•ç€åŠ é”; 3.åŠ é”æˆåŠŸçš„çº¿ç¨‹åœ¨æ“ä½œç»“æŸåŽåˆ æŽ‰å®ƒæŒæœ‰é”(ç”¨luaå®žçŽ°,ä¿è¯åŽŸå­æ€§,åœ¨å®ƒæ¯”å¯¹å’Œåˆ é™¤é”çš„è¿‡ç¨‹ä¸­,å…¶å®ƒçº¿ç¨‹ä¸ä¼šåŠ é”æˆåŠŸ),è®©å…¶å®ƒçº¿ç¨‹å†æ¬¡åŠ é”ä»¥æ‰§è¡Œä»»åŠ¡; è¯´æ˜Ž:é”çš„æ—¶é—´ä¸º200mså¯é¢„é˜²çº¿ç¨‹æŒ‚æŽ‰ä¹‹åŽæ­»é”,200msåŽä¼šè‡ªåŠ¨é‡Šæ”¾ ä¸‹é¢çœ‹çœ‹æˆ‘ä»¬å†™çš„é”ä»£ç : ç‰‡æ®µ1:ä½¿ç”¨redislock å®žçŽ°lockæ¥å¤å†™å®ƒçš„æ–¹æ³• ç‰‡æ®µ2:è¯•ç€åŠ é”çš„æ–¹æ³• ç‰‡æ®µ3:è§£é”æ–¹æ³•,æ­¤å¤„é¦–å…ˆä»Žçº¿ç¨‹æœ¬åœ°å˜é‡èŽ·å–å®ƒçš„éšæœºæ•°,ç„¶åŽè°ƒç”¨luaè„šæœ¬,ä¸Žredisä¸­keyç›¸æ¯”è¾ƒ,å¦‚æžœç›¸åŒåˆ™åˆ é™¤,å¦åˆ™è¿”å›ž0; æ­¤ä¸ºluaè„šæœ¬æ–¹æ³•,ç”¨æ­¤æ–¹æ³•å¯ä»¥ä¿è¯åˆ¤æ–­å’Œåˆ é™¤çš„åŽŸå­æ€§,åœ¨æ­¤è¿‡ç¨‹ä¸­æ²¡æœ‰çº¿ç¨‹å¯ä»¥æ“ä½œæ­¤key åˆ°æ­¤ä¸ºæ­¢,æˆ‘ä»¬é”åŸºæœ¬å†™å®Œ,æ¥æµ‹è¯•ä¸‹æœ‰æ²¡æœ‰ç”¨: æˆ‘ä»¬åœ¨æ­¤æ–¹æ³•å‰åŽåˆ†åˆ«åŠ å…¥åŠ é”å’Œè§£é”æ–¹æ³•,ä½¿ç”¨æ–¹å¼å’Œlocké”ä¸€æ ·, æˆ‘ä»¬é‡æ–°æŠŠå¹´é¾„æ¢å¤åˆ°30åŽæ¥æµ‹è¯•ä¸€ä¸‹å§ å…ˆçœ‹çœ‹æ—¥å¿— è¿™é‡Œå¯ä»¥çœ‹åˆ°å„ä¸ªçº¿ç¨‹äº‰å¤ºé”çš„æƒ…å†µ,å†çœ‹çœ‹æ‰§è¡Œç»“æžœ è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è™½ç„¶æ˜¯32ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œ,ä½†æ­¤å€¼å¹¶ä¸ä¼šå˜ä¸ºè´Ÿæ•°,åŠ é”æˆåŠŸ. æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€åŽ2ä¸ªçº¿ç¨‹å¹¶æ²¡æœ‰æ‰§è¡Œæ–¹æ³• æ­¤æ—¶è¯´æ˜ŽåŠ é”æˆåŠŸ,å¤§å®¶å¯ä»¥åœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒä¸­æµ‹è¯•æ›´æ˜Žæ˜¾,æœ‰å…³æžç«¯æƒ…å†µä¸‹è§£é”å¤±è´¥åŽåº”è¯¥åšä»€ä¹ˆä¹Ÿå¯ä»¥ç”±æˆ‘ä»¬è‡ªå·±å†³å®š,æ¯”redissionè¦çµæ´»,å¸¦é”çš„redisæœ€å¥½æ˜¯å•å®žä¾‹,åœ¨é›†ç¾¤ä¸­å¯èƒ½ä¼šå‡ºé—®é¢˜,æœ‰æœºä¼šæˆ‘ä»¬å†ç”¨zkå®žçŽ°ä¸‹.]]></content>
      <categories>
        <category>ç¼“å­˜</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼é”</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RateLimitä½¿ç”¨guavaæ¥åšæŽ¥å£é™æµ]]></title>
    <url>%2F2018%2F04%2F25%2FRateLimit-%E4%BD%BF%E7%94%A8guava%E6%9D%A5%E5%81%9A%E6%8E%A5%E5%8F%A3%E9%99%90%E6%B5%81%2F</url>
    <content type="text"><![CDATA[ä¸€ã€é—®é¢˜æè¿° æŸå¤©Aå›çªç„¶å‘çŽ°è‡ªå·±çš„æŽ¥å£è¯·æ±‚é‡çªç„¶æ¶¨åˆ°ä¹‹å‰çš„10å€ï¼Œæ²¡å¤šä¹…è¯¥æŽ¥å£å‡ ä¹Žä¸å¯ä½¿ç”¨ï¼Œå¹¶å¼•å‘è¿žé”ååº”å¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚å¦‚ä½•åº”å¯¹è¿™ç§æƒ…å†µå‘¢ï¼Ÿç”Ÿæ´»ç»™äº†æˆ‘ä»¬ç­”æ¡ˆï¼šæ¯”å¦‚è€å¼ç”µé—¸éƒ½å®‰è£…äº†ä¿é™©ä¸ï¼Œä¸€æ—¦æœ‰äººä½¿ç”¨è¶…å¤§åŠŸçŽ‡çš„è®¾å¤‡ï¼Œä¿é™©ä¸å°±ä¼šçƒ§æ–­ä»¥ä¿æŠ¤å„ä¸ªç”µå™¨ä¸è¢«å¼ºç”µæµç»™çƒ§åã€‚åŒç†æˆ‘ä»¬çš„æŽ¥å£ä¹Ÿéœ€è¦å®‰è£…ä¸Šâ€œä¿é™©ä¸â€ï¼Œä»¥é˜²æ­¢éžé¢„æœŸçš„è¯·æ±‚å¯¹ç³»ç»ŸåŽ‹åŠ›è¿‡å¤§è€Œå¼•èµ·çš„ç³»ç»Ÿç˜«ç—ªï¼Œå½“æµé‡è¿‡å¤§æ—¶ï¼Œå¯ä»¥é‡‡å–æ‹’ç»æˆ–è€…å¼•æµç­‰æœºåˆ¶ã€‚ äºŒã€å¸¸ç”¨çš„é™æµç®—æ³•â€‹ å¸¸ç”¨çš„é™æµç®—æ³•æœ‰ä¸¤ç§ï¼šæ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œè¿™ç¯‡åšæ–‡ä»‹ç»å¾—æ¯”è¾ƒæ¸…æ™°ï¼ˆè¿‡è½½ä¿æŠ¤ç®—æ³•æµ…æžï¼‰ã€‚ â€‹ æ¼æ¡¶ç®—æ³•æ€è·¯å¾ˆç®€å•ï¼Œè¯·æ±‚å…ˆè¿›å…¥åˆ°æ¼æ¡¶é‡Œï¼Œæ¼æ¡¶ä»¥ä¸€å®šçš„é€Ÿåº¦å‡ºæ°´ï¼Œå½“æ°´è¯·æ±‚è¿‡å¤§ä¼šç›´æŽ¥æº¢å‡ºï¼Œå¯ä»¥çœ‹å‡ºæ¼æ¡¶ç®—æ³•èƒ½å¼ºè¡Œé™åˆ¶æ•°æ®çš„ä¼ è¾“é€ŸçŽ‡ã€‚ å›¾1 æ¼æ¡¶ç®—æ³•ç¤ºæ„å›¾ â€‹ å¯¹äºŽå¾ˆå¤šåº”ç”¨åœºæ™¯æ¥è¯´ï¼Œé™¤äº†è¦æ±‚èƒ½å¤Ÿé™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€ŸçŽ‡å¤–ï¼Œè¿˜è¦æ±‚å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚è¿™æ—¶å€™æ¼æ¡¶ç®—æ³•å¯èƒ½å°±ä¸åˆé€‚äº†ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•æ›´ä¸ºé€‚åˆã€‚å¦‚å›¾2æ‰€ç¤ºï¼Œä»¤ç‰Œæ¡¶ç®—æ³•çš„åŽŸç†æ˜¯ç³»ç»Ÿä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æžœè¯·æ±‚éœ€è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»Žæ¡¶é‡ŒèŽ·å–ä¸€ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚ å›¾2 ä»¤ç‰Œæ¡¶ç®—æ³•ç¤ºæ„å›¾ ä¸‰ã€é™æµå·¥å…·ç±»RateLimiter googleå¼€æºå·¥å…·åŒ…guavaæä¾›äº†é™æµå·¥å…·ç±»RateLimiterï¼Œè¯¥ç±»åŸºäºŽâ€œä»¤ç‰Œæ¡¶ç®—æ³•â€ï¼Œéžå¸¸æ–¹ä¾¿ä½¿ç”¨ã€‚è¯¥ç±»çš„æŽ¥å£æè¿°è¯·å‚è€ƒï¼šRateLimiteræŽ¥å£æè¿°ï¼Œå…·ä½“çš„ä½¿ç”¨è¯·å‚è€ƒï¼šRateLimiterä½¿ç”¨å®žè·µã€‚ RateLimiter ä½¿ç”¨Demo 1234567891011121314151617181920212223242526272829303132333435363738package ratelimite;import com.google.common.util.concurrent.RateLimiter;public class RateLimiterDemo &#123; public static void main(String[] args) &#123; testNoRateLimiter(); testWithRateLimiter(); &#125; public static void testNoRateLimiter() &#123; Long start = System.currentTimeMillis(); for (int i = 0; i &lt; 10; i++) &#123; System.out.println("call execute.." + i); &#125; Long end = System.currentTimeMillis(); System.out.println(end - start); &#125; public static void testWithRateLimiter() &#123; Long start = System.currentTimeMillis(); RateLimiter limiter = RateLimiter.create(10.0); // æ¯ç§’ä¸è¶…è¿‡10ä¸ªä»»åŠ¡è¢«æäº¤ for (int i = 0; i &lt; 10; i++) &#123; limiter.acquire(); // è¯·æ±‚RateLimiter, è¶…è¿‡permitsä¼šè¢«é˜»å¡ž System.out.println("call execute.." + i); &#125; Long end = System.currentTimeMillis(); System.out.println(end - start); &#125;&#125; å›› Guavaå¹¶å‘ï¼šListenableFutureä¸ŽRateLimiterç¤ºä¾‹æ¦‚å¿µ â€‹ ListenableFutureé¡¾åæ€ä¹‰å°±æ˜¯å¯ä»¥ç›‘å¬çš„Futureï¼Œå®ƒæ˜¯å¯¹javaåŽŸç”ŸFutureçš„æ‰©å±•å¢žå¼ºã€‚æˆ‘ä»¬çŸ¥é“Futureè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è®¡ç®—ä»»åŠ¡ï¼Œå½“ä»»åŠ¡å®Œæˆæ—¶å¯ä»¥å¾—åˆ°è®¡ç®—ç»“æžœã€‚å¦‚æžœæˆ‘ä»¬å¸Œæœ›ä¸€æ—¦è®¡ç®—å®Œæˆå°±æ‹¿åˆ°ç»“æžœå±•ç¤ºç»™ç”¨æˆ·æˆ–è€…åšå¦å¤–çš„è®¡ç®—ï¼Œå°±å¿…é¡»ä½¿ç”¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸æ–­çš„æŸ¥è¯¢è®¡ç®—çŠ¶æ€ã€‚è¿™æ ·åšï¼Œä»£ç å¤æ‚ï¼Œè€Œä¸”æ•ˆçŽ‡ä½Žä¸‹ã€‚ä½¿ç”¨ListenableFuture Guavaå¸®æˆ‘ä»¬æ£€æµ‹Futureæ˜¯å¦å®Œæˆäº†ï¼Œå¦‚æžœå®Œæˆå°±è‡ªåŠ¨è°ƒç”¨å›žè°ƒå‡½æ•°ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¹¶å‘ç¨‹åºçš„å¤æ‚åº¦ã€‚ â€‹ æŽ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œå› ä¸ºç¬¬äºŒç§æ–¹æ³•å¯ä»¥ç›´æŽ¥å¾—åˆ°Futureçš„è¿”å›žå€¼ï¼Œæˆ–è€…å¤„ç†é”™è¯¯æƒ…å†µã€‚æœ¬è´¨ä¸Šç¬¬äºŒç§æ–¹æ³•æ˜¯é€šè¿‡è°ƒåŠ¨ç¬¬ä¸€ç§æ–¹æ³•å®žçŽ°çš„ï¼Œåšäº†è¿›ä¸€æ­¥çš„å°è£…ã€‚ å¦å¤–ListenableFutureè¿˜æœ‰å…¶ä»–å‡ ç§å†…ç½®å®žçŽ°ï¼š SettableFutureï¼šä¸éœ€è¦å®žçŽ°ä¸€ä¸ªæ–¹æ³•æ¥è®¡ç®—è¿”å›žå€¼ï¼Œè€Œåªéœ€è¦è¿”å›žä¸€ä¸ªå›ºå®šå€¼æ¥åšä¸ºè¿”å›žå€¼ï¼Œå¯ä»¥é€šè¿‡ç¨‹åºè®¾ç½®æ­¤Futureçš„è¿”å›žå€¼æˆ–è€…å¼‚å¸¸ä¿¡æ¯ CheckedFutureï¼š è¿™æ˜¯ä¸€ä¸ªç»§æ‰¿è‡ªListenableFutureæŽ¥å£ï¼Œä»–æä¾›äº†checkedGet()æ–¹æ³•ï¼Œæ­¤æ–¹æ³•åœ¨Futureæ‰§è¡Œå‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¯ä»¥æŠ›å‡ºæŒ‡å®šç±»åž‹çš„å¼‚å¸¸ã€‚ â€‹ RateLimiterç±»ä¼¼äºŽJDKçš„ä¿¡å·é‡Semphoreï¼Œä»–ç”¨æ¥é™åˆ¶å¯¹èµ„æºå¹¶å‘è®¿é—®çš„çº¿ç¨‹æ•°ï¼Œæœ¬æ–‡ä»‹ç»RateLimiterä½¿ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191import java.util.concurrent.Callable;import java.util.concurrent.ExecutionException;import java.util.concurrent.Executors;import java.util.concurrent.TimeUnit;import com.google.common.util.concurrent.FutureCallback;import com.google.common.util.concurrent.Futures;import com.google.common.util.concurrent.ListenableFuture;import com.google.common.util.concurrent.ListeningExecutorService;import com.google.common.util.concurrent.MoreExecutors;import com.google.common.util.concurrent.RateLimiter;public class ListenableFutureDemo &#123; public static void main(String[] args) &#123; testRateLimiter(); testListenableFuture(); &#125; /** * RateLimiterç±»ä¼¼äºŽJDKçš„ä¿¡å·é‡Semphoreï¼Œä»–ç”¨æ¥é™åˆ¶å¯¹èµ„æºå¹¶å‘è®¿é—®çš„çº¿ç¨‹æ•° */ public static void testRateLimiter() &#123; ListeningExecutorService executorService = MoreExecutors .listeningDecorator(Executors.newCachedThreadPool()); RateLimiter limiter = RateLimiter.create(5.0); // æ¯ç§’ä¸è¶…è¿‡4ä¸ªä»»åŠ¡è¢«æäº¤ for (int i = 0; i &lt; 10; i++) &#123; limiter.acquire(); // è¯·æ±‚RateLimiter, è¶…è¿‡permitsä¼šè¢«é˜»å¡ž final ListenableFuture&lt;Integer&gt; listenableFuture = executorService .submit(new Task("is "+ i)); &#125; &#125; public static void testListenableFuture() &#123; ListeningExecutorService executorService = MoreExecutors .listeningDecorator(Executors.newCachedThreadPool()); final ListenableFuture&lt;Integer&gt; listenableFuture = executorService .submit(new Task("testListenableFuture")); //åŒæ­¥èŽ·å–è°ƒç”¨ç»“æžœ try &#123; System.out.println(listenableFuture.get()); &#125; catch (InterruptedException e1) &#123; e1.printStackTrace(); &#125; catch (ExecutionException e1) &#123; e1.printStackTrace(); &#125; //ç¬¬ä¸€ç§æ–¹å¼ listenableFuture.addListener(new Runnable() &#123; @Override public void run() &#123; try &#123; System.out.println("get listenable future's result " + listenableFuture.get()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; &#125; &#125;, executorService); //ç¬¬äºŒç§æ–¹å¼ Futures.addCallback(listenableFuture, new FutureCallback&lt;Integer&gt;() &#123; @Override public void onSuccess(Integer result) &#123; System.out .println("get listenable future's result with callback " + result); &#125; @Override public void onFailure(Throwable t) &#123; t.printStackTrace(); &#125; &#125;); &#125;&#125;class Task implements Callable&lt;Integer&gt; &#123; String str; public Task(String str)&#123; this.str = str; &#125; @Override public Integer call() throws Exception &#123; System.out.println("call execute.." + str); TimeUnit.SECONDS.sleep(1); return 7; &#125;&#125;]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>é™æµ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[React16 ä»Žé›¶æ‰“é€ ç”µå•†åŽå°ç®¡ç†ç³»ç»Ÿ]]></title>
    <url>%2F2018%2F04%2F21%2FReact16-%E4%BB%8E%E9%9B%B6%E6%89%93%E9%80%A0%E7%94%B5%E5%95%86%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[åŸºç¡€çŸ¥è¯† dns-prefetch æå‰fetch charles æŠ“åŒ… WebStorage sessionStorage 12window.sessionStorage.setItem('test',123)window.sessionStorage.getItem('test') localStorage 1window.localStorage é¡¹ç›®åˆå§‹åŒ–node v8.11.3 yarn 1.2.1 12mkdir admin-v2-feyarn init webpack1yarn add webpack@3.10.0 --dev 1yarn add webpack-dev-server 2.9.7 webpack.config.js 123456789const path = require('path');module.exports = &#123; entry: './src/app.js', output: &#123; path: path.resolve(__dirname, './dist'), filename: 'app.js' &#125;&#125;; æ‰§è¡Œ 1./node_modules/.bin/webpack HtmlWebpackPlugin 1yarn add html-webpack-plugin@2.30.1 --dev https://webpack.docschina.org/plugins/html-webpack-plugin/#src/components/Sidebar/Sidebar.jsx 1234567891011var HtmlWebpackPlugin = require('html-webpack-plugin');var path = require('path');module.exports = &#123; entry: 'index.js', output: &#123; path: path.resolve(__dirname, './dist'), filename: 'index_bundle.js' &#125;, plugins: [new HtmlWebpackPlugin()]&#125;; babelå¤„ç† 12yarn add babel-core@6.26.0 --devyarn add babel-preset-env@1.6.1 babel-loader@7.1.2 --dev 1yarn add babel-preset-react@6.24.1 --dev csså¤„ç† 1yarn add react@16.2.0 react-dom@16.2.0 1yarn add style-loader@0.19.1 css-loader@0.28.8 --dev index.cssæ–‡ä»¶ç‹¬ç«‹ https://webpack.docschina.org/plugins/extract-text-webpack-plugin/#src/components/Sidebar/Sidebar.jsx 1yarn add extract-text-webpack-plugin@3.0.2 --dev sasså¤„ç† 12yarn add sass-loader@6.0.6 --devyarn add node-sass@4.7.2 --dev æå–sassæ–‡ä»¶ https://webpack.docschina.org/plugins/extract-text-webpack-plugin/#%E6%8F%90%E5%8F%96-sass-%E6%88%96-less å›¾ç‰‡å¤„ç† 1yarn add file-loader@1.1.6 url-loader@0.6.2 --dev å­—ä½“åº“ http://fontawesome.dashgame.com/ 1yarn add font-awesome webpack-dev server 1yarn add webpack-dev-server@2.9.7 --dev 12345678910output: &#123; path: path.resolve(__dirname, './dist'), publicPath: '/dist', filename: 'js/app.js'&#125;, // webpack-dev server devServer: &#123; &#125; 1./node_modules/.bin/webpack-dev-server package.jsoné…ç½®è„šæœ¬ 1234"scripts" : &#123; "dev" : "node_modules/.bin/webpack-dev-server", "dist" : "node_modules/.bin/webpack"&#125; react-router1yarn add react-router-dom@4.2.2 å‚æ•°åŒ¹é…ï¼Œ/a/:id 123456789ReactDOM.render( &lt;Router&gt; &lt;Wrapper&gt; &lt;Route path="/a/:id" component=&#123;ComponentA&#125;/&gt; &lt;Route path="/b" component=&#123;ComponentB&#125;/&gt; &lt;/Wrapper&gt; &lt;/Router&gt; , document.getElementById('app')); è¯»å–å‚æ•° 1this.props.match.params.id bootcdnhttps://www.bootcdn.cn/]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>react</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[hiveå¸¸ç”¨HIVE QL]]></title>
    <url>%2F2018%2F04%2F13%2Fhive%E5%B8%B8%E7%94%A8HIVE-QL%2F</url>
    <content type="text"><![CDATA[hiveåˆ›å»ºæ•°æ®åº“ 1CREATE DATABASE|SCHEMA [IF NOT EXISTS] &lt;database name&gt;;1 hiveåˆ›å»ºè¡¨ hiveé‡Œä¸€èˆ¬æœ‰ä¸¤ç§è¡¨çš„ç»“æž„ï¼Œè¡¨å’Œå¤–éƒ¨è¡¨ï¼Œä»¥ä¸‹åˆ†åˆ«æ˜¯ä¸¤ç§è¡¨çš„åˆ›å»ºä»£ç ï¼š 1234CREATE TABLE phone_info(id int,name String,storage String,price double)ROW FORMAT DELIMITED //ä»£è¡¨ä¸€è¡Œæ˜¯ä¸€æ¡è®°å½•FIELDS TERMINATED BY '\t'//åˆ—æ˜¯æŒ‰ç…§tableé”®åˆ†å¼€STORED AS TEXTFILE[SEQUENCEFILE];//äºŒç§æœ€å¸¸è§çš„å­˜å‚¨æ ¼å¼ï¼Œä¸€èˆ¬å¯ä»¥ä¸å†™1234 12345CREATE EXTERNAL TABLE phone_external(id int,name String,price double)ROW FORMAT DELIMITEDFIELDS TERMINATED BY '\t'STORED AS TEXTFILELOCATION '&lt;/xudong/phone.txt&gt;';//è¿™é‡Œå¡«å†™å¤–éƒ¨è¡¨æ•°æ®çš„hdfsåœ°å€12345 hiveè¡¨ä¸­å¯¼å…¥æ•°æ® hiveè¡¨ä¸­å¯¼å…¥æ•°æ®æœ‰å››ç§å¸¸è§çš„æ–¹å¼ï¼šï¼ˆ1ï¼‰ä»Žæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­å¯¼å…¥åˆ°hiveè¡¨å‡è®¾æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶å­˜åœ¨çš„ç›®å½•ä¸º/home/xudong 1load data local inpath '/home/xudong/xxx.txt' into table phone_info;1 ï¼ˆ2ï¼‰ä»Žhdfsä¸Šå¯¼å…¥æ•°æ®åˆ°hiveè¡¨å‡è®¾hdfsä¸Šçš„ç›®å½•ä¸º/user/xudong/data 1load data inpath '/user/xudong/data/xxx.txt' into table phone_info;1 æ³¨ï¼šå’Œæœ¬åœ°æ–‡ä»¶å¯¼å…¥ä¸åŒæ˜¯æ²¡æœ‰localå…³é”®å­—ï¼ˆ3ï¼‰ä»Žåˆ«çš„è¡¨ä¸­æŸ¥è¯¢å‡ºç›¸åº”çš„æ•°æ®å¹¶å¯¼å…¥hiveè¡¨ä¸­ 1INSERT INTO phone_info_like SELECT * FROM phone_info;1 ï¼ˆ4ï¼‰åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™é€šè¿‡åˆ«çš„è¡¨æŸ¥è¯¢å‡ºç›¸åº”çš„è®°å½•å¹¶æ’å…¥åˆ°æ‰€åˆ›å»ºçš„è¡¨ä¸­ã€‚ 1234CREATE TABLE temp_infoASSELECT id phone_idï¼Œname phone_name,price FROM phone_infoSORT BY phone_id;1234 hiveåˆ é™¤è¡¨ 1DROP TABLE IF EXISTS phone_info;1 hiveåˆ›å»ºä¸´æ—¶è¡¨å­˜å‚¨ä¸­é—´ç»“æžœ 12345CREATE TABLE temp_infoASSELECT id phone_idï¼Œname phone_name,price FROM phone_infoSORT BY phone_id;12345 hiveç®€å•çš„æŸ¥è¯¢è¯­å¥ 1234SELECT * FROM temp_info;SELECT id phone_id,name phone_name FROM phone_info;SELECT a.ip,a.name,b.username FROM phone_info a INNER JOIN user b on (a.ip=b.ip);1234 hiveæ‰¹é‡æ’å…¥æ•°æ®åˆ°è¡¨ 1234CREATE TABLE phone_info_like LIKE phone_info;//å¤åˆ¶è¡¨çš„ç»“æž„INSERT INTO phone_info_like SELECT * FROM phone_info;INSERT OVERWRITE phoen_info_like SELECT * FROM phone_info;//intoæ˜¯è¿½åŠ æ•°æ®ï¼Œoverwriteæ˜¯è¦†ç›–ä»¥åŠå­˜åœ¨çš„æ•°æ®ï¼Œå±žäºŽé‡å¤æ€§æ ¡éªŒ1234 hiveåˆ†åŒºè¡¨ 12345678CREATE TABLE part_table(id int,name String,ip String,city String,date String)PARTITIONED BY (part_flag String)//è¿™é‡Œçš„åˆ†åŒºå­—æ®µå¯ä»¥æ˜¯è¡¨ä¸­å­—æ®µä¹Ÿå¯ä»¥æ˜¯æŒ‡å®šçš„å­—æ®µROW FORMAT DELIMITED FIELDS TERMINATED BY ',';load data local inpath '/home/xudong/test.txt' into table part_table partition(part_flag='part1');load data local inpath '/home/xudong/test1.txt' into table part_table partition(part_flag='part2');select * from part_table where part_flag='part1';]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[hiveæ•°æ®åŽ»é‡]]></title>
    <url>%2F2018%2F04%2F11%2Fhive%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D%2F</url>
    <content type="text"><![CDATA[distinctä¼šæ•´æ¡æ•°æ®åŽ»é‡ï¼Œæœ‰ä¸€é¡¹æ˜¯ä¸åŒçš„æ•´æ¡æ•°æ®å°±ç®—ä¸åŒçš„ï¼Œä¸ä¼šåŽ»æŽ‰ï¼ŒæŒ‰ç…§æŸä¸€ä¸ªå­—æ®µåŽ»é‡éœ€è¦å¦‚ä¸‹æ–¹æ³• hiveæ•°æ®åŽ»é‡ï¼Œå¹¶æ ¹æ®éœ€æ±‚å–å…¶ä¸­ä¸€æ¡ æ•°æ®æ¡ˆä¾‹ï¼š name adx tran_id cost tsck 5 125.168.10.0 33.00 1407234660ck 5 187.18.99.00 33.32 1407234661ck 5 125.168.10.0 33.24 1407234661åªéœ€è¦å‰ä¸¤è¡Œçš„è®°å½•ï¼Œå› ä¸ºç¬¬ä¸‰è¡Œçš„tran_idå’Œç¬¬ä¸€è¡Œçš„é‡å¤äº†ï¼Œæ‰€ä»¥éœ€è¦å°†æœ€åŽé¢ä¸€è¡Œé‡å¤çš„åŽ»æŽ‰ã€‚ æ–¹æ¡ˆä¸€ï¼š12345selectt1.tran_id,[t2.name](http://t2.name/),t2.costfrom (selectdistinct tran_id from table) t1join table t2 ont1.tran_id=t2.tran_id åˆ†æžï¼šå¦‚æžœä½¿ç”¨distinctçš„è¯ï¼Œéœ€è¦æŠŠtran_idæ”¾åœ¨ç¬¬ä¸€åˆ—ï¼ŒæŸ¥å‡ºæ¥çš„æ•°æ®å¾ˆä¸å‹å¥½ã€‚ æ–¹æ¡ˆäºŒï¼š123456789select* from(â€‹ select *,row_number() over (partition by tran_id order by timestamp asc) num from table ) twheret.num=1; åˆ†æžï¼š row_number() over (partition by tran_idorder by timestamp desc) num å–num=1 çš„æ„æ€æ˜¯å…ˆæ ¹æ®tran_idè¿›è¡Œåˆ†ç»„ï¼Œå¹¶åœ¨åˆ†ç»„å†…éƒ¨æŒ‰timestamp é™åºæŽ’åºï¼Œrow_number()å‡½æ•°è®¡ç®—çš„å€¼å°±è¡¨ç¤ºæŸä¸ªtran_idç»„å†…éƒ¨æŽ’åºåŽçš„é¡ºåºç¼–å·ï¼ˆè¯¥ç¼–å·åœ¨ä¸€ä¸ªç»„å†…æ˜¯è¿žç»­å¹¶ä¸”å”¯ä¸€çš„) ã€‚æ‰€ä»¥æœ€åŽç›´æŽ¥åŽ»æ¯ä¸ªåˆ†ç»„å†…çš„ç¬¬ä¸€ä¸ªï¼ˆnum=1ï¼‰å³å¯ã€‚ PSï¼š ROW_NUMBER() OVERå‡½æ•°çš„åŸºæœ¬ç”¨æ³•è¯­æ³•ï¼šROW_NUMBER() OVER(PARTITION BY COLUMN ORDER BY COLUMN)ç®€å•çš„è¯´row_number()ä»Ž1å¼€å§‹ï¼Œä¸ºæ¯ä¸€ä¸ªåˆ†ç»„è®°å½•è¿”å›žä¸€ä¸ªæ•°å­—ï¼Œè¿™é‡Œçš„ROW_NUMBER() OVER (ORDER BY xlh DESC) æ˜¯å…ˆæŠŠxlhåˆ—é™åºï¼Œå†ä¸ºé™åºä»¥åŽçš„æ¯æ¡xlhè®°å½•è¿”å›žä¸€ä¸ªåºå·ã€‚ç¤ºä¾‹ï¼šxlh row_num1700 11500 21085 3710 4row_number() OVER (PARTITION BY COL1 ORDERBY COL2) è¡¨ç¤ºæ ¹æ®COL1åˆ†ç»„ï¼Œåœ¨åˆ†ç»„å†…éƒ¨æ ¹æ® COL2æŽ’åºï¼Œè€Œæ­¤å‡½æ•°è®¡ç®—çš„å€¼å°±è¡¨ç¤ºæ¯ç»„å†…éƒ¨æŽ’åºåŽçš„é¡ºåºç¼–å·ï¼ˆè¯¥ç¼–å·åœ¨ç»„å†…æ˜¯è¿žç»­å¹¶ä¸”å”¯ä¸€çš„) ã€‚ å®žä¾‹ï¼š æ•°æ®æ˜¾ç¤ºä¸ºempid deptid salary 1 10 5500.002 10 4500.003 20 1900.004 20 4800.005 40 6500.006 40 14500.007 40 44500.008 50 6500.009 50 7500.00éœ€æ±‚ï¼šæ ¹æ®éƒ¨é—¨åˆ†ç»„ï¼Œæ˜¾ç¤ºæ¯ä¸ªéƒ¨é—¨çš„å·¥èµ„ç­‰çº§é¢„æœŸç»“æžœï¼šempid deptid salary rank 1 10 5500.00 12 10 4500.00 24 20 4800.00 13 20 1900.00 27 40 44500.00 16 40 14500.00 25 40 6500.00 39 50 7500.00 18 50 6500.00 2SQLè„šæœ¬ï¼š1SELECT *, Row_Number() OVER (partition by deptidORDER BY salary desc) rank FROM employee]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Spark Pandas UDFs]]></title>
    <url>%2F2018%2F04%2F11%2FSpark-Pandas-UDFs%2F</url>
    <content type="text"><![CDATA[é…ç½®æ‰€æœ‰è¿è¡ŒèŠ‚ç‚¹å®‰è£… pyarrow ï¼Œéœ€è¦ &gt;= 0.8 ä¸ºä»€ä¹ˆä¼šæœ‰ pandas UDFåœ¨è¿‡åŽ»çš„å‡ å¹´ä¸­ï¼Œpython æ­£åœ¨æˆä¸ºæ•°æ®åˆ†æžå¸ˆçš„é»˜è®¤è¯­è¨€ã€‚ä¸€äº›ç±»ä¼¼ pandas,numpy,statsmodel,scikit-learn è¢«å¤§é‡ä½¿ç”¨ï¼Œé€æ¸æˆä¸ºä¸»æµçš„å·¥å…·åŒ…ã€‚åŒæ—¶ï¼Œspark ä¹Ÿæˆä¸ºäº†å¤§æ•°æ®å¤„ç†çš„æ ‡å‡†ï¼Œä¸ºäº†è®©æ•°æ®åˆ†æžå¸ˆèƒ½å¤Ÿä½¿ç”¨ spark ï¼ŒSparkåœ¨ 0.7 ç‰ˆæœ¬å¢žåŠ äº† python apiï¼Œä¹Ÿæ”¯æŒäº† udf (user-defined functions)ã€‚ è¿™äº› udf å¯¹æ¯æ¡è®°å½•éƒ½ä¼šæ“ä½œä¸€æ¬¡ï¼ŒåŒæ—¶æ•°æ®éœ€è¦åœ¨ JVM å’Œ Python ä¸­ä¼ è¾“ï¼Œå› æ­¤æœ‰äº†é¢å¤–çš„åºåˆ—åŒ–å’Œè°ƒç”¨å¼€é”€ã€‚å› æ­¤å¾ˆå¤šæ•°æ® pipelines ç”¨ Java å’Œ Scala ä¸­å®šä¹‰ UDFï¼Œç„¶åŽåœ¨ python ä¸­è°ƒç”¨å®ƒä»¬ã€‚ Pandas Udf æž„å»ºåœ¨ Apache Arrow ä¹‹ä¸Šï¼Œå¸¦æ¥äº†ä½Žå¼€é”€ï¼Œé«˜æ€§èƒ½çš„UDFã€‚ æ¯ä¸ªç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„å­˜å‚¨æ ¼å¼ï¼Œ70%-80%çš„æ—¶é—´èŠ±è´¹åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸Š Apache Arrow ä¸€ä¸ªè·¨å¹³å°çš„æ•°æ®å±‚ï¼Œç”¨æ¥åŠ é€Ÿå¤§æ•°æ®åˆ†æžé€Ÿåº¦ã€‚ åœ¨å†…å­˜ä¸­ä»¥åˆ—å¼å­˜å‚¨ã€‚ ä¸€äº›é™åˆ¶ ä¸æ”¯æŒæ‰€æœ‰çš„ sparkSQL æ•°æ®ç±»åž‹ï¼ŒåŒ…æ‹¬ BinaryTypeï¼ŒMapType, ArrayTypeï¼ŒTimestampType å’ŒåµŒå¥—çš„ StructTypeã€‚ pandas udf å’Œ udf ä¸èƒ½æ··ç”¨ã€‚ ä½¿ç”¨æ–¹å¼1. spark df &amp; pandas dfspark df ä¸Ž pandas df ç›¸äº’è½¬åŒ–æ€§èƒ½ä¼˜åŒ–ï¼Œéœ€è¦å¼€å¯é…ç½®ï¼Œé»˜è®¤ä¸ºå…³é—­ã€‚ é…ç½®é¡¹ï¼š 1spark.sql.execution.arrow.enabled true ç›¸äº’è½¬åŒ– 123456789import numpy as npimport pandas as pd//åˆå§‹åŒ– pandas DFpdf = pd.DataFrame(np.random.rand(100000, 3))// pdf -&gt; sdf%time df = spark.createDataFrame(pdf)// sdf -&gt; pdf%time result_pdf = df.select("*").toPandas() æ€§èƒ½å¯¹æ¯”ï¼š execution.arrow.enabled pdf -&gt; sdf sdf -&gt; pdf false 4980ms 722ms true 72ms 79ms tips: å³ä¾¿æ˜¯æé«˜äº†è½¬åŒ–çš„é€Ÿåº¦ï¼Œpandas df ä¾æ—§æ˜¯å•æœºåœ¨ driver ä¸­æ‰§è¡Œçš„ï¼Œä¸åº”è¯¥è¿”å›žå¤§é‡çš„æ•°æ®ã€‚ 2. pandas UDFs(Vectorized UDFs)pandas udf çš„å…¥å‚å’Œè¿”å›žå€¼ç±»åž‹éƒ½ä¸º pandas.Series æ³¨å†Œ udfæ–¹æ³•1ï¼š 123456789from pyspark.sql.functions import pandas_udfdef plus_one(a): return a + 1//df_udfplus_one_pd_udf = pandas_udf(plus_one, returnType=LongType())//sql udfspark.udf.register('plus_one',plus_one_pd_udf) æ–¹æ³•2ï¼š 12345678910from pyspark.sql.functions import pandas_udf//é»˜è®¤ä¸º PandasUDFType.SCALAR ç±»åž‹@pandas_udf('long')def plus_one(a): return a + 1spark.udf.register('plus_one',plus_one)spark.udf.registerå¯ä»¥æŽ¥å—ä¸€ä¸ª SQL_BATCHED_UDF æˆ– SQL_SCALAR_PANDAS_UDF æ–¹æ³•ã€‚ ä½¿ç”¨ pandas udf åŽï¼Œç‰©ç†æ‰§è¡Œè®¡åˆ’ä¼šä»Ž BatchEvalPython å˜ä¸º ArrowEvalPythonï¼Œå¯ä»¥ä½¿ç”¨ explain() æ£€æŸ¥ pandas udf æ˜¯å¦ç”Ÿæ•ˆã€‚ Scalar Pandas UDFs1234567891011121314151617import pandas as pdfrom pyspark.sql.functions import col, pandas_udf,udffrom pyspark.sql.types import LongTypedef multiply_func(a, b): return a * bmultiply_pd = pandas_udf(multiply_func, returnType=LongType())multiply = udf(multiply_func, returnType=LongType())x = pd.Series([1, 2, 3] * 10000)df = spark.createDataFrame(pd.DataFrame(x, columns=["x"]))%timeit df.select(multiply_pd(col("x"), col("x"))).count()%timeit df.select(multiply(col("x"), col("x"))).count() Grouped Map Pandas UDFsè®¡ç®—å‡æ–¹å·® 1234567891011121314151617181920212223from pyspark.sql.functions import pandas_udf, PandasUDFTypedf = spark.createDataFrame( [(1, 1.0), (1, 2.0), (2, 3.0), (2, 5.0), (2, 10.0)], ("id", "v"))@pandas_udf("id long, v double", PandasUDFType.GROUPED_MAP)def substract_mean(pdf): # pdf is a pandas.DataFrame v = pdf.v return pdf.assign(v=v - v.mean())df.groupby("id").apply(substract_mean).show()+---+----+| id| v|+---+----+| 1|-0.5|| 1| 0.5|| 2|-3.0|| 2|-1.0|| 2| 4.0|+---+----+ æµ‹è¯•ç”¨ä¾‹æ•°æ®å‡†å¤‡ï¼š 10M-row DataFrame , 2åˆ—ï¼Œä¸€åˆ—Intç±»åž‹ï¼Œä¸€åˆ—Doubleç±»åž‹ 123df = spark.range(0, 10 * 1000 * 1000).withColumn('id', (col('id') / 10000).cast('integer')).withColumn('v', rand())df.cache()df.count() Plus one12345678from pyspark.sql.functions import pandas_udf, PandasUDFType# è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ doubles ç±»åž‹çš„ pandas.Series@pandas_udf('double', PandasUDFType.SCALAR)def pandas_plus_one(v): return v + 1df.withColumn('v2', pandas_plus_one(df.v)) Cumulative Probability123456789import pandas as pdfrom scipy import stats@pandas_udf('double')def cdf(v): return pd.Series(stats.norm.cdf(v))df.withColumn('cumulative_probability', cdf(df.v)) Subtract Mean123456# è¾“å…¥å’Œè¾“å‡ºç±»åž‹éƒ½æ˜¯ pandas.DataFrame@pandas_udf(df.schema, PandasUDFType.GROUPED_MAP)def subtract_mean(pdf): return pdf.assign(v=pdf.v - pdf.v.mean())df.groupby('id').apply(subtract_mean) Scalar å’Œ Grouped map çš„ä¸€äº›åŒºåˆ« â€¦ Scalar Grouped map udf å…¥å‚ç±»åž‹ pandas.Series pandas.DataFrame udf è¿”å›žç±»åž‹ pandas.Series pandas.DataFrame èšåˆè¯­ä¹‰ æ—  groupby çš„å­å¥ è¿”å›žå¤§å° ä¸Žè¾“å…¥ä¸€è‡´ rows å’Œ columns éƒ½å¯ä»¥å’Œå…¥å‚ä¸åŒ è¿”å›žç±»åž‹å£°æ˜Ž pandas.Series çš„ DataType pandas.DataFrame çš„ StructType æ€§èƒ½å¯¹æ¯” ç±»åž‹ udf pandas udf plus_one 2.54s 1.28s cdf 2min 2s 1.52s Subtract Mean 1min 8s 4.4s é…ç½®å’Œæµ‹è¯•æ–¹æ³•çŽ¯å¢ƒ Spark 2.3 Anaconda 4.4.0 (python 2.7.13) è¿è¡Œæ¨¡å¼ local[10] å‚è€ƒhttp://spark.apache.org/docs/latest/sql-programming-guide.html#grouped-map https://databricks.com/blog/2017/10/30/introducing-vectorized-udfs-for-pyspark.html https://www.slideshare.net/PyData/improving-pandas-and-pyspark-performance-and-interoperability-with-apache-arrow]]></content>
      <categories>
        <category>å¤§æ•°æ®</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Grafana mysqlä½“éªŒ]]></title>
    <url>%2F2018%2F04%2F09%2FGrafana-mysql%E4%BD%93%E9%AA%8C%2F</url>
    <content type="text"><![CDATA[ä»‹ç»åœ¨æ—¶åºåˆ†æžåŠç›‘æŽ§å±•çŽ°é¢†åŸŸï¼ŒGrafanaæ— ç–‘æ˜¯å¼€æºè§£å†³æ–¹æ¡ˆä¸­çš„ç¿˜æ¥šï¼Œå…¶çµæ´»çš„æ’ä»¶æœºåˆ¶ï¼Œæ”¯æŒå„ç§æ¼‚äº®çš„é¢æ¿ã€ä¸°å¯Œçš„æ•°æ®æºä»¥åŠå¼ºå¤§çš„åº”ç”¨ã€‚å…¸åž‹çš„é¢æ¿æœ‰Graphã€Textã€Singlestatã€PieChartã€Tableã€Histogramç­‰ï¼Œæ”¯æŒçš„æ•°æ®æºæœ‰ESã€Graphiteã€InfluxDBã€OpenTSDBã€MySQLã€Druid ã€Prometheusã€SimpleJsonç­‰ï¼Œæä¾›çš„åº”ç”¨æœ‰Zabbixã€K8sç­‰ +Elasticsearchå°è±¡ä¸­Grafanaæ˜¯ InfluxDB å¯è§†åŒ–å·¥å…·ï¼Œä½†åŸºäºŽGrafanaè‰¯å¥½çš„æž¶æž„ï¼ŒDataSourceå¯ä»¥å˜å¾—å¤šæ ·æ€§äº†ï¼ŒçŽ°åœ¨æ˜¯æ”¯æŒElasticSearchä½œä¸ºDataSourceçš„ã€‚ Grafanaçš„å®‰è£…ä¹Ÿéžå¸¸ç®€å•ï¼Œè§£åŽ‹å¯åŠ¨å°±å¯ä»¥äº†ã€‚DataSourceéƒ½æ˜¯åŠ¨æ€æ·»åŠ ä¸ŠåŽ»çš„ã€‚Grafanaä½œä¸ºä¸€ä¸ªçº¯ç²¹çš„å¯è§†åŒ–å·¥å…·ï¼Œçµæ´»æ€§åšåˆ°äº†æžè‡´ã€‚ä½¿ç”¨ElasticSearchä½œä¸ºDataSourceï¼ŒæŒ‡å®šå¯¹åº”çš„Indexï¼Œå°±å¯ä»¥å»ºç«‹DashBoardå°±è¡Œæ•°æ®å¯è§†åŒ–äº†ã€‚ç›¸æ¯”Kibanaï¼ŒGrafanaçš„templateåŠŸèƒ½èƒ½æŠŠæ•°æ®æŒ‰ç…§ä»»æ„çš„ç»´åº¦è¿›è¡Œåˆ‡åˆ†å±•ç¤ºï¼Œè¿™å°±æ˜¯å®ƒçš„å¼ºå¤§ä¹‹å¤„ã€‚ éƒ¨ç½²Githubåœ°å€ï¼šhttps://github.com/Grafana/Grafana ä¸‹è½½https://grafana.com/grafana/download macå®‰è£… | 12 | brew updatebrew install grafana || â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”- || | | http://docs.grafana.org/installation/mac/http://docs.grafana.org/installation/configuration/ å¯åŠ¨Grafana | 12345678910111213 | è¦å¯åŠ¨Grafanaä½¿ç”¨è‡ªåˆ¶æœåŠ¡é¦–å…ˆç¡®ä¿å®‰è£…äº†è‡ªåˆ¶è½¯ä»¶/æœåŠ¡ã€‚brew tap homebrew/servicesç„¶åŽå¼€å§‹Grafanaä½¿ç”¨ï¼šbrew services start grafana- é…ç½®é…ç½®æ–‡ä»¶åº”è¯¥ä½äºŽ/usr/local/etc/grafana/grafana.iniã€‚- æ—¥å¿—æ—¥å¿—æ–‡ä»¶åº”è¯¥ä½äºŽ/usr/local/var/log/grafana/grafana.logã€‚- æ’ä»¶å¦‚æžœä½ æƒ³æ‰‹åŠ¨å®‰è£…ä¸€ä¸ªæ’ä»¶æ”¾åœ¨è¿™é‡Œï¼š/usr/local/var/lib/grafana/pluginsã€‚- æ•°æ®åº“é»˜è®¤çš„sqliteæ•°æ®åº“ä½äºŽ /usr/local/var/lib/grafana || â€”â€”â€”â€”â€”â€“ | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” || | | æ±‰åŒ–(éžå¿…è¦) | 12 | git clone https://github.com/moonstack/grafana-for-chinese.gitå¤‡ä»½åŽŸæœ‰çš„ /public/app/boot.js /public/app/features/org/prefs_control.js å†å°†masterä¸­çš„ä¸¤ä¸ªæ–‡ä»¶è¦†ç›–åˆ°å¯¹åº”çš„ç›®å½• åˆ·æ–°æµè§ˆå™¨å³å¯ || â€”- | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” || | | https://github.com/moonstack/grafana-for-chinesehttps://github.com/heruihong/gf-frontend è®¿é—®http://0.0.0.0:3000/ ï¼Œé»˜è®¤è´¦å·/å¯†ç ï¼šadmin/admin æ·»åŠ æ•°æ®æºhttp://docs.grafana.org/features/datasources/elasticsearch/http://docs.grafana.org/features/datasources/mysql/ å¯¼å…¥dashboard/æŸ¥çœ‹dashboardhttps://grafana.com/dashboards?dataSource=mysqlhttps://grafana.com/dashboards?dataSource=elasticsearch åˆ¶å›¾(mysql)Grafana + mysqlæ•°æ®æº - laomei - CSDNåšå®¢http://blog.csdn.net/sweatott/article/details/78278011 å›¾è¡¨æ•°æ®å±•ç¤ºè§„åˆ™ - edit - Metrics 123456789 SELECTDATE_FORMAT(gmt_create,â€™%Y-%m-%dâ€™),UNIX_TIMESTAMP(DATE_FORMAT(gmt_create,â€™%Y-%m-%dâ€™)) as time_sec, â€“ xè½´:æ—¶é—´count(treaty_no) as value, â€“ yè½´:æ•°å€¼partner_code as metric â€“ yè½´åˆ†ç»„:æ•°æ®åˆ†ç»„FROM treatyWHERE 1=1group by DATE_FORMAT(gmt_create,â€™%Y-%m-%dâ€™)ORDER BY id ASC æ›´å¤šæ–‡æ¡£è§:http://docs.grafana.org/features/datasources/mysql/ å„æŠ¥è¡¨é¢æ¿è®¾ç½®http://docs.grafana.org/features/panels/graph/ å›¾è¡¨http://docs.grafana.org/features/panels/singlestat/ ä»ªå›¾ templating æ¨¡æ¿http://docs.grafana.org/reference/templating/http://docs.grafana.org/features/datasources/mysql/#query-variable mysqlçš„æŸ¥è¯¢è¡¨è¾¾å¼ åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨å˜é‡http://docs.grafana.org/features/datasources/mysql/#using-variables-in-queries | 123456789 | SELECTDATE_FORMAT(gmt_create,â€™%Y-%m-%dâ€™),UNIX_TIMESTAMP(DATE_FORMAT(gmt_create,â€™%Y-%m-%dâ€™)) as time_sec, â€“ xè½´:æ—¶é—´count(treaty_no) as value, â€“ yè½´:æ•°å€¼partner_code as metric â€“ yè½´åˆ†ç»„:æ•°æ®åˆ†ç»„FROM treatyWHERE 1=1 and partner_code in ($partner)group by DATE_FORMAT(gmt_create,â€™%Y-%m-%dâ€™)ORDER BY id ASC || â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” || | | æ•ˆæžœ æŠ¥è­¦http://docs.grafana.org/alerting/notifications/ Grafanaæ·»åŠ Webhook channelhttps://www.tuicool.com/articles/VZf6JjF [å›¾è¡¨-alert]è®¾ç½®æ•°æ®è§¦è­¦è§„åˆ™ [å›¾è¡¨-alert]Notifications å®šä¹‰å‘é€æ¸ é“ é—®é¢˜å®‰è£…grafana,Homebrewå‡ºçŽ°â€go: version missing for â€œgotoolsâ€ resource!â€çš„è§£å†³æ–¹æ¡ˆ 12 âžœ Desktop brew install grafanaError: go: version missing for â€œgotoolsâ€ resource! å°è¯•è§£å†³: 12 git -C â€œ$(brew â€“repo)â€ fetch â€“tagsbrew update â€“force æˆ– git -C &quot;$(brew --repo)&quot; fetch --tags brew update --forcehttp://blog.csdn.net/lanadeus/article/details/78271240https://github.com/Homebrew/homebrew-core/issues/19221https://blog.labbit.jp/%E8%AC%8E%E3%82%A8%E3%83%A9%E3%83%BCgotools%E3%81%AE%E8%A7%A3%E6%B6%88%E6%B3%95/ å®žé™…è§£å†³: é‡è£…brew 1 /usr/bin/ruby -e â€œ$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)â€ æ–°å»ºtemplate query é”™è¯¯ 12 TemplatingTemplate variables could not be initialized: sql: Scan error on column index 0: unsupported Scan, storing driver.Value type into type *string åŽŸå› : å­˜åœ¨nullå€¼è§£å†³: where column is not null å‚è€ƒåŸºäºŽGrafana+SimpleJsonçš„çµæ´»æŠ¥è¡¨è§£å†³æ–¹æ¡ˆhttps://www.tuicool.com/articles/EBjUfmi ç›‘æŽ§æ•°æ®çš„å¯è§†åŒ–åˆ†æžç¥žå™¨ Grafana - æŽ¨é…·https://www.tuicool.com/articles/VZf6JjF Kibana and Grafana - æŽ¨é…·https://www.tuicool.com/articles/rURRF3U ä½¿ç”¨Prometheus+Grafanaæ­å»ºç›‘æŽ§ç³»ç»Ÿå®žè·µ - æŽ¨é…·https://www.tuicool.com/articles/QZRjAv3 ç›‘æŽ§æ•°æ®çš„å¯è§†åŒ–åˆ†æžç¥žå™¨ Grafana - æŽ¨é…· - OneAlert äº‘å‘Šè­¦https://www.tuicool.com/articles/VZf6JjF grafana + influxdb + telegraf , æž„å»ºlinuxæ€§èƒ½ç›‘æŽ§å¹³å° - æŽ¨é…·https://www.tuicool.com/articles/nyM3qyq]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Kibana + Elasticsearchä½“éªŒ]]></title>
    <url>%2F2018%2F04%2F09%2FKibana-Elasticsearch%E4%BD%93%E9%AA%8C%2F</url>
    <content type="text"><![CDATA[å®‰è£…kibanaä¸‹è½½https://www.elastic.co/downloads/kibanawget https://artifacts.elastic.co/downloads/kibana/kibana-6.1.3-darwin-x86_64.tar.gz å‡†å¤‡elasticsearchæœåŠ¡è§: Elasticsearchç›¸å…³.md ElasticsearchKibanaå®‰è£…éžå¸¸æ–¹ä¾¿ï¼Œå®˜ç½‘ä¸‹è½½ï¼Œå¹¶é…ç½®ä¸‹ESçš„URLå°±å¯ä»¥è¿žä¸Šäº†ã€‚Kibanaä½¿ç”¨çš„æ—¶å€™ä¼šæœ‰å‰¯ä½œç”¨ï¼Œå®ƒä¼šåœ¨ä½ çš„ESé‡Œé¢åˆ›å»ºä¸€ä¸ªå®ƒæ‰€éœ€è¦çš„Indexï¼Œå¹¶ä¼šæœ‰è¾ƒä¸ºé¢‘ç¹çš„queryã€‚å¦‚æžœæ˜¯ç”Ÿäº§çŽ¯å¢ƒï¼ŒESå­˜çš„æ˜¯æ ¸å¿ƒæ•°æ®è¦æ…Žç”¨äº†ã€‚å®‰è£…å¥½å¯åŠ¨æŒ‡å®šéœ€è¦åˆ†æžçš„Indexï¼Œå°±èƒ½çœ‹åˆ°ä»¥ä¸‹å‡ ä¸ªTab é…ç½® config/kibana.yml 1234567891011 server.port: 5601# The host to bind the server to.server.host: â€œâ€# If you are running kibana behind a proxy, and want to mount it at a path,# specify that path here. The basePath canâ€™t end in a slash.# server.basePath: â€œâ€# The Elasticsearch instance to use for all your queries.elasticsearch.url: â€œhttp://0.0.0.0:9200â€œ #è¿™é‡Œæ˜¯elasticsearchçš„è®¿é—®åœ°å€ æ±‰åŒ–https://github.com/anbai-inc/Kibana_Hanizationpython main.py &lt;kibanaç›®å½•&gt; å¯åŠ¨ 12 ./kibana //ä¸èƒ½å…³é—­ç»ˆç«¯nohup ./kibana &gt; /nohub.out &amp; //å¯å…³é—­ç»ˆç«¯ï¼Œåœ¨nohup.outä¸­æŸ¥çœ‹log è®¿é—® http://0.0.0.0:5601/ ä½¿ç”¨æ–°å»ºç´¢å¼•æ¨¡å¼http://0.0.0.0:5601/app/kibana#/management/kibana/indices æ–°å»ºå›¾è¡¨&amp;è®¾ç½®xyè½´æ•°æ®åˆ—http://0.0.0.0:5601/app/kibana#/visualize/new?_g=() ä»ªè¡¨ç›˜é›†æˆå›¾è¡¨ å‚è€ƒKibana and Grafana - æŽ¨é…·https://www.tuicool.com/articles/rURRF3U kibanaä»‹ç» - CSDNåšå®¢http://blog.csdn.net/eff666/article/details/63251710?locationNum=3&amp;fps=1]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•paxos]]></title>
    <url>%2F2018%2F04%2F09%2F%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95paxos%2F</url>
    <content type="text"><![CDATA[éšç€å¤§åž‹ç½‘ç«™çš„å„ç§é«˜å¹¶å‘è®¿é—®ã€æµ·é‡æ•°æ®å¤„ç†ç­‰åœºæ™¯è¶Šæ¥è¶Šå¤šï¼Œå¦‚ä½•å®žçŽ°ç½‘ç«™çš„é«˜å¯ç”¨ã€æ˜“ä¼¸ç¼©ã€å¯æ‰©å±•ã€å®‰å…¨ç­‰ç›®æ ‡å°±æ˜¾å¾—è¶Šæ¥è¶Šé‡è¦ã€‚ä¸ºäº†è§£å†³è¿™æ ·ä¸€ç³»åˆ—é—®é¢˜ï¼Œå¤§åž‹ç½‘ç«™çš„æž¶æž„ä¹Ÿåœ¨ä¸æ–­å‘å±•ã€‚æé«˜å¤§åž‹ç½‘ç«™çš„é«˜å¯ç”¨æž¶æž„ï¼Œä¸å¾—ä¸æçš„å°±æ˜¯åˆ†å¸ƒå¼ã€‚åœ¨å…³äºŽåˆ†å¸ƒå¼äº‹åŠ¡ã€ä¸¤é˜¶æ®µæäº¤åè®®ã€ä¸‰é˜¶æäº¤åè®®ä¸€æ–‡ä¸­ä¸»è¦ç”¨äºŽè§£å†³åˆ†å¸ƒå¼ä¸€è‡´æ€§é—®é¢˜çš„é›†ä¸­åè®®ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« ä¸»è¦è®²è§£ä¸šå†…å…¬è®¤çš„æ¯”è¾ƒéš¾çš„ä¹Ÿæ˜¯æœ€è¡Œä¹‹æœ‰æ•ˆçš„paxosç®—æ³•ã€‚ æˆ‘è®¤ä¸ºå¯¹paxosç®—æ³•è®²è§£çš„æœ€æ¸…æ¥šçš„å°±æ˜¯ç»´åŸºç™¾ç§‘äº†ã€‚ä½†æ˜¯è¦çœ‹æ‡‚ç»´åŸºç™¾ç§‘ä¸­çš„ä»‹ç»éœ€è¦å¾ˆå¼ºçš„æ•°å­¦æ€ç»´ï¼ˆpaxosæ¯•ç«Ÿæ˜¯ä¸€ä¸ªç®—æ³•ï¼‰ï¼Œè€Œä¸”æœ‰å¾ˆå¤šå…³äºŽå®šç†çš„æŽ¨è®ºã€è¯æ˜Žç­‰è¿‡ç¨‹ã€‚é‚£ä¹ˆæœ¬ç¯‡æ–‡ç« ä¸»è¦ç«™åœ¨ç¨‹åºçš„è§’åº¦ï¼Œé€šä¿—çš„ï¼Œå¾ªåºæ¸è¿›çš„è®²è§£åˆ°åº•ä»€ä¹ˆæ˜¯paxosç®—æ³•ã€‚ èƒŒæ™¯Google Chubbyçš„ä½œè€…Mike Burrowsè¯´è¿‡ï¼Œ there is only one consensus protocol, and thatâ€™s Paxosâ€ â€“ all other approaches are just broken versions of Paxos. æ„å³ä¸–ä¸Šåªæœ‰ä¸€ç§ä¸€è‡´æ€§ç®—æ³•ï¼Œé‚£å°±æ˜¯Paxosï¼Œæ‰€æœ‰å…¶ä»–ä¸€è‡´æ€§ç®—æ³•éƒ½æ˜¯Paxosç®—æ³•çš„ä¸å®Œæ•´ç‰ˆã€‚ Paxosç®—æ³•æ˜¯èŽ±æ–¯åˆ©Â·å…°ä¼¯ç‰¹ï¼ˆLeslie Lamportï¼Œå°±æ˜¯ LaTeX ä¸­çš„â€Laâ€ï¼Œæ­¤äººçŽ°åœ¨åœ¨å¾®è½¯ç ”ç©¶é™¢ï¼‰äºŽ1990å¹´æå‡ºçš„ä¸€ç§åŸºäºŽæ¶ˆæ¯ä¼ é€’çš„ä¸€è‡´æ€§ç®—æ³•ã€‚ä¸ºæè¿° Paxos ç®—æ³•ï¼ŒLamport è®²è¿°äº†è¿™æ ·ä¸€ä¸ªæ•…äº‹ï¼š åœ¨å¤å¸Œè…Šæœ‰ä¸€ä¸ªå²›å±¿å«åšPaxosï¼Œè¿™ä¸ªå²›å±¿é€šè¿‡è®®ä¼šçš„å½¢å¼ä¿®è®¢æ³•å¾‹ã€‚æ‰§æ³•è€…ï¼ˆlegislatorsï¼ŒåŽé¢ç§°ä¸ºç‰§å¸ˆpriestï¼‰åœ¨è®®ä¼šå¤§åŽ…ï¼ˆchamberï¼‰ä¸­è¡¨å†³é€šè¿‡æ³•å¾‹ï¼Œå¹¶é€šè¿‡æœåŠ¡å‘˜ä¼ é€’çº¸æ¡çš„æ–¹å¼äº¤æµä¿¡æ¯ï¼Œæ¯ä¸ªæ‰§æ³•è€…ä¼šå°†é€šè¿‡çš„æ³•å¾‹è®°å½•åœ¨è‡ªå·±çš„è´¦ç›®ï¼ˆledgerï¼‰ä¸Šã€‚é—®é¢˜åœ¨äºŽæ‰§æ³•è€…å’ŒæœåŠ¡å‘˜éƒ½ä¸å¯é ï¼Œä»–ä»¬éšæ—¶ä¼šå› ä¸ºå„ç§äº‹æƒ…ç¦»å¼€è®®ä¼šå¤§åŽ…ã€æœåŠ¡å‘˜ä¹Ÿæœ‰å¯èƒ½é‡å¤ä¼ é€’æ¶ˆæ¯ï¼ˆæˆ–è€…ç›´æŽ¥å½»åº•ç¦»å¼€ï¼‰ï¼Œå¹¶éšæ—¶å¯èƒ½æœ‰æ–°çš„æ‰§æ³•è€…ï¼ˆæˆ–è€…æ˜¯åˆšæš‚æ—¶ç¦»å¼€çš„ï¼‰å›žåˆ°è®®ä¼šå¤§åŽ…è¿›è¡Œæ³•å¾‹è¡¨å†³ï¼Œå› æ­¤ï¼Œè®®ä¼šåè®®è¦æ±‚ä¿è¯ä¸Šè¿°æƒ…å†µä¸‹å¯ä»¥èƒ½å¤Ÿæ­£ç¡®çš„ä¿®è®¢æ³•å¾‹å¹¶ä¸”ä¸ä¼šäº§ç”Ÿå†²çªã€‚ ä»€ä¹ˆæ˜¯paxosç®—æ³•Paxos ç®—æ³•æ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ç”¨æ¥è§£å†³ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå¦‚ä½•å°±æŸä¸ªå€¼(å†³è®®)è¾¾æˆä¸€è‡´çš„é—®é¢˜ã€‚ äººä»¬åœ¨ç†è§£paxosç®—æ³•æ˜¯ä¼šé‡åˆ°ä¸€äº›å›°å¢ƒï¼Œé‚£ä¹ˆæŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸¦ç€ä»¥ä¸‹å‡ ä¸ªé—®é¢˜æ¥å­¦ä¹ paxosç®—æ³•ï¼š 1ã€paxosåˆ°åº•åœ¨è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ 2ã€paxosåˆ°åº•å¦‚ä½•åœ¨åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿä¸­åº”ç”¨ï¼Ÿ 3ã€paxosçš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ paxosè§£å†³äº†ä»€ä¹ˆé—®é¢˜åœ¨å…³äºŽåˆ†å¸ƒå¼ä¸€è‡´æ€§çš„æŽ¢ç©¶ä¸­æˆ‘ä»¬æåˆ°è¿‡ï¼Œåˆ†å¸ƒå¼çš„ä¸€è‡´æ€§é—®é¢˜å…¶å®žä¸»è¦æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼Œå°±è¦ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚ åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œå¦‚æžœå„èŠ‚ç‚¹çš„åˆå§‹çŠ¶æ€ä¸€è‡´ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œç›¸åŒçš„æ“ä½œåºåˆ—ï¼Œé‚£ä¹ˆä»–ä»¬æœ€åŽèƒ½å¾—åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚ä¸ºä¿è¯æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œç›¸åŒçš„å‘½ä»¤åºåˆ—ï¼Œéœ€è¦åœ¨æ¯ä¸€æ¡æŒ‡ä»¤ä¸Šæ‰§è¡Œä¸€ä¸ªâ€œä¸€è‡´æ€§ç®—æ³•â€ä»¥ä¿è¯æ¯ä¸ªèŠ‚ç‚¹çœ‹åˆ°çš„æŒ‡ä»¤ä¸€è‡´ã€‚ æ‰€ä»¥ï¼Œpaxosç®—æ³•ä¸»è¦è§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å„ä¸ªèŠ‚ç‚¹éƒ½èƒ½æ‰§è¡Œä¸€ä¸ªç›¸åŒçš„æ“ä½œåºåˆ—ã€‚ ä¸Šå›¾ä¸­ï¼ŒC1æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ŒN1ã€N2ã€N3æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„ä¸‰ä¸ªæœåŠ¡å™¨ï¼Œåˆå§‹çŠ¶æ€ä¸‹N1ã€N2ã€N3ä¸‰ä¸ªæœåŠ¡å™¨ä¸­æŸä¸ªæ•°æ®çš„çŠ¶æ€éƒ½æ˜¯S0ã€‚å½“å®¢æˆ·ç«¯è¦å‘æœåŠ¡å™¨è¯·æ±‚å¤„ç†æ“ä½œåºåˆ—ï¼šop1op2op3æ—¶ï¼ˆopè¡¨ç¤ºoperationï¼‰ï¼ˆè¿™é‡ŒæŠŠå®¢æˆ·ç«¯çš„å†™æ“ä½œç®€åŒ–æˆå‘æ‰€æœ‰æœåŠ¡å™¨å‘é€ç›¸åŒçš„è¯·æ“ä½œåºåˆ—ï¼Œå®žé™…ä¸Šå¯èƒ½é€šè¿‡Master/Slaveæ¨¡å¼å¤„ç†ï¼‰ã€‚å¦‚æžœæƒ³ä¿è¯åœ¨å¤„ç†å®Œå®¢æˆ·ç«¯çš„è¯·æ±‚ä¹‹åŽï¼ŒN1ã€N2ã€N3ä¸‰ä¸ªæœåŠ¡å™¨ä¸­çš„æ•°æ®çŠ¶æ€éƒ½èƒ½ä»ŽS0å˜æˆS1å¹¶ä¸”ä¸€è‡´çš„è¯ï¼ˆæˆ–è€…æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œè¿˜æ˜¯S0çŠ¶æ€ï¼‰ï¼Œå°±è¦ä¿è¯N1ã€N2ã€N3åœ¨æŽ¥æ”¶å¹¶å¤„ç†æ“ä½œåºåˆ—op1op2op3æ—¶ï¼Œä¸¥æ ¼æŒ‰ç…§è§„å®šçš„é¡ºåºæ­£ç¡®æ‰§è¡Œopiï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¸å°±å…¨éƒ¨éƒ½ä¸æ‰§è¡Œã€‚ æ‰€ä»¥ï¼Œé’ˆå¯¹ä¸Šé¢çš„åœºæ™¯ï¼Œpaxosè§£å†³çš„é—®é¢˜å°±æ˜¯å¦‚ä½•ä¾æ¬¡ç¡®å®šä¸å¯å˜æ“ä½œopiçš„å–å€¼ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šç¬¬iä¸ªæ“ä½œä»€ä¹ˆï¼Œåœ¨ç¡®å®šäº†opiçš„å†…å®¹ä¹‹åŽï¼Œå°±å¯ä»¥è®©å„ä¸ªå‰¯æœ¬æ‰§è¡Œopiæ“ä½œã€‚ Paxosç®—æ³•è¯¦è§£Paxosæ˜¯ä¸€ä¸ªååˆ†å·§å¦™çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œä½†æ˜¯ä»–ä¹Ÿååˆ†éš¾ä»¥ç†è§£ï¼Œå°±è¿žä»–çš„ä½œè€…Lamportéƒ½è¢«è¿«å¯¹ä»–åšè¿‡å¤šç§è®²è§£ã€‚æˆ‘è®¤ä¸ºå¯¹paxosç®—æ³•è®²è§£çš„æœ€æ¸…æ¥šçš„å°±æ˜¯ç»´åŸºç™¾ç§‘äº†ã€‚ä½†æ˜¯è¦çœ‹æ‡‚ç»´åŸºç™¾ç§‘ä¸­çš„ä»‹ç»éœ€è¦å¾ˆå¼ºçš„æ•°å­¦æ€ç»´ï¼ˆpaxosæ¯•ç«Ÿæ˜¯ä¸€ä¸ªç®—æ³•ï¼‰ï¼Œè€Œä¸”æœ‰å¾ˆå¤šå…³äºŽå®šç†çš„æŽ¨è®ºã€è¯æ˜Žç­‰è¿‡ç¨‹ã€‚é‚£ä¹ˆæœ¬ç¯‡æ–‡ç« ä¸»è¦ç«™åœ¨ç¨‹åºçš„è§’åº¦ï¼Œé€šä¿—çš„ï¼Œå¾ªåºæ¸è¿›çš„è®²è§£åˆ°åº•ä»€ä¹ˆæ˜¯paxosç®—æ³•ã€‚ æˆ‘ä»¬å…ˆæŠŠå‰é¢çš„åœºæ™¯ç®€åŒ–ï¼ŒæŠŠæˆ‘ä»¬çŽ°åœ¨è¦è§£å†³çš„é—®é¢˜ç®€åŒ–ä¸ºå¦‚ä½•ç¡®å®šä¸€ä¸ªä¸å¯å˜å˜é‡çš„å–å€¼ï¼ˆæ¯ä¸€ä¸ªä¸å¯å˜å˜é‡å¯ä»¥æ ‡è¯†ä¸€ä¸ªæ“ä½œåºåˆ—ä¸­çš„æŸä¸ªæ“ä½œï¼Œå½“ç¡®ä¿æ¯ä¸ªæ“ä½œéƒ½æ­£ç¡®ä¹‹åŽï¼Œå°±å¯ä»¥æŒ‰ç…§é¡ºåºæ‰§è¡Œè¿™äº›æ“ä½œæ¥ä¿è¯æ•°æ®èƒ½å¤Ÿå‡†ç¡®æ— è¯¯çš„ä»Žä¸€ä¸ªçŠ¶æ€è½¬å˜æˆå¦å¤–ä¸€ä¸ªçŠ¶æ€äº†ï¼‰ã€‚ æŽ¥ä¸‹æ¥ï¼Œè¯·è·Ÿæˆ‘ä¸€æ­¥ä¸€æ­¥çš„å­¦ä¹ paxosç®—æ³•ã€‚ è¦å­¦ä¹ paxosç®—æ³•ï¼Œæˆ‘ä»¬å°±è¦ä»Žä»–è¦è§£å†³çš„é—®é¢˜å‡ºå‘ï¼Œå‡å¦‚æ²¡æœ‰paxosç®—æ³•ï¼Œå½“æˆ‘ä»¬é¢å¯¹å¦‚ä½•ç¡®å®šä¸€ä¸ªä¸å¯å˜å˜é‡çš„å–å€¼è¿™æ ·ä¸€ä¸ªå»é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ è¿™é‡Œæš‚ä¸ä»‹ç»paxosä¸­çš„è§’è‰²çš„æ¦‚å¿µï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œä»Žç»´åŸºç™¾ç§‘ä¸­äº†è§£ã€‚ä¸äº†è§£çš„è¯ä¹Ÿå¯ä»¥ç›´æŽ¥å¾€ä¸‹çœ‹ï¼Œçœ‹ç€çœ‹ç€å°±äº†è§£äº†ã€‚ é—®é¢˜æŠ½è±¡æˆ‘ä»¬æŠŠç¡®å®šä¸€ä¸ªä¸å¯å˜å˜é‡çš„å–å€¼é—®é¢˜å®šä¹‰æˆï¼š è®¾è®¡ä¸€ä¸ªç³»ç»Ÿï¼Œæ¥å­˜å‚¨åç§°ä¸ºvarçš„å˜é‡ã€‚ varçš„å–å€¼å¯ä»¥æ˜¯ä»»æ„äºŒè¿›åˆ¶æ•° ç³»ç»Ÿå†…éƒ¨ç”±å¤šä¸ªAccepterç»„æˆ,è´Ÿè´£ç®¡ç†å’Œå­˜å‚¨varå˜é‡ã€‚ ç³»ç»Ÿå¯¹å¤–æä¾›api,ç”¨æ¥è®¾ç½®varå˜é‡çš„å€¼propose(var,V) =&gt; &lt;ok,f&gt; or &lt;error&gt; å°†varçš„å€¼è®¾ç½®ä¸ºVï¼Œç³»ç»Ÿä¼šè¿”å›žokå’Œç³»ç»Ÿä¸­å·²ç»ç¡®å®šçš„å–å€¼fï¼Œæˆ–è€…è¿”å›žerrorã€‚ å¤–éƒ¨æœ‰å¤šä¸ªProposeræœºå™¨ä»»æ„è¯·æ±‚ç³»ç»Ÿï¼Œè°ƒç”¨ç³»ç»ŸAPI(propose(var,V) =&gt; &lt;ok,f&gt; or &lt;error&gt;)æ¥è®¾ç½®varå˜é‡çš„å€¼ã€‚ å¦‚æžœç³»ç»ŸæˆåŠŸçš„å°†varè®¾ç½®æˆäº†Vï¼Œé‚£ä¹ˆè¿”å›žçš„fåº”è¯¥å°±æ˜¯Vçš„å€¼ã€‚å¦åˆ™ï¼Œç³»ç»Ÿè¿”å›žçš„få°±æ˜¯å…¶ä»–çš„Proposerè®¾ç½®çš„å€¼ã€‚ > ç³»ç»Ÿéœ€è¦ä¿è¯varçš„å–å€¼æ»¡è¶³ä¸€è‡´æ€§ å¦‚æžœvaræ²¡æœ‰è¢«è®¾ç½®è¿‡ï¼Œé‚£ä¹ˆä»–çš„åˆå§‹å€¼ä¸ºnull ä¸€æ—¦varçš„å€¼è¢«è®¾ç½®æˆåŠŸï¼Œåˆ™ä¸å¯è¢«æ›´æ”¹ï¼Œå¹¶ä¸”å¯ä»¥ä¸€ç›´éƒ½èƒ½èŽ·å–åˆ°è¿™ä¸ªå€¼ ç³»ç»Ÿéœ€è¦æ»¡è¶³å®¹é”™ç‰¹æ€§ å¯ä»¥å®¹å¿ä»»æ„proposerå‡ºçŽ°æ•…éšœå¯ä»¥å®¹å¿å°‘æ•°acceptoræ•…éšœï¼ˆåŠæ•°ä»¥ä¸‹ï¼‰ æš‚æ—¶å¿½ç•¥ç½‘ç»œåˆ†åŒ–é—®é¢˜å’Œacceptoræ•…éšœå¯¼è‡´varä¸¢å¤±çš„é—®é¢˜ã€‚ åˆ°è¿™é‡Œï¼Œé—®é¢˜å·²ç»æŠ½è±¡å®Œæˆäº†ï¼Œè¯»è€…å¯ä»¥å†ä»”ç»†çœ‹çœ‹ä¸Šé¢çš„ç³»ç»Ÿæè¿°ã€‚å¦‚æžœè¿™æ ·è®¾ç½®ä¸€ä¸ªç³»ç»Ÿï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¿è¯å˜é‡varçš„ä¸å¯å˜æ€§äº†å‘¢ï¼Ÿ è¿™é‡Œè¿˜æ˜¯å†ç®€å•è®²è§£ä¸€ä¸‹ï¼Œä¸Šé¢çš„ç³»ç»Ÿç¡®å®žå¯ä»¥ä¿è¯å˜é‡varçš„ä¸å¯å˜æ€§ã€‚ å› ä¸ºvarçš„åˆå§‹å€¼ä¸ºnullï¼Œå½“æœ‰proposerè¯·æ±‚æŽ¥å£proposeï¼ˆvarï¼Œvï¼‰è®¾ç½®varçš„å€¼çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå°†varè®¾ç½®ä¸ºvï¼Œå¹¶è¿”å›žfï¼ˆf==vï¼‰ã€‚ varå˜é‡è¢«åˆå§‹åŒ–ä»¥åŽï¼Œå†æœ‰proposerè¯·æ±‚propose(var,v)è®¾ç½®varçš„å€¼çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šç›´æŽ¥è¿”å›žç³»ç»Ÿä¸­å·²æœ‰çš„varçš„å€¼fï¼Œè€Œæ”¾å¼ƒproposeræä¾›çš„vã€‚ ç³»ç»Ÿéš¾ç‚¹è¦è®¾è®¡ä»¥ä¸Šç³»ç»Ÿå­˜åœ¨ä»¥ä¸‹éš¾ç‚¹ï¼š 1ã€ç®¡ç†å¤šä¸ªproposerå¹¶å‘æ‰§è¡Œ 2ã€å®¹å¿varå˜é‡çš„ä¸å¯å˜æ€§ 3ã€å®¹å¿ä»»æ„Proposerçš„æ•…éšœ 4ã€å®¹å¿åŠæ•°ä»¥ä¸‹çš„acceptorçš„æ•…éšœ è§£å†³æ–¹æ¡ˆä¸€å…ˆè€ƒè™‘æ•´ä¸ªç³»ç»Ÿç”±å•ä¸ªacceptorç»„æˆã€‚é€šè¿‡ç±»ä¼¼äº’æ–¥é”çš„æ–¹å¼æ¥ç®¡ç†å¹¶å‘çš„proposerçš„è¯·æ±‚ã€‚ proposerå‘acceptorç”³è¯·acceptorçš„äº’æ–¥è®¿é—®æƒï¼Œå½“å–å¾—äº’æ–¥è®¿é—®æƒä¹‹åŽæ‰èƒ½è°ƒç”¨apiç»™varå˜é‡èµ‹å€¼ã€‚accepterå‘proposerå‘æ”¾äº’æ–¥è®¿é—®æƒï¼Œè°å–å¾—äº†äº’æ–¥è®¿é—®æƒï¼Œacceptorå°±æŽ¥æ”¶è°çš„è¯·æ±‚ã€‚è¿™æ ·é€šè¿‡äº’æ–¥è®¿é—®çš„æœºåˆ¶ï¼Œproposerå°±è¦æŒ‰ç…§èŽ·å–äº’æ–¥è®¿é—®æƒçš„é¡ºåºæ¥è¯·æ±‚ç³»ç»Ÿã€‚ä¸€æ—¦acceptoræŽ¥æ”¶åˆ°ä¸€ä¸ªproposerè¯·æ±‚ï¼Œå¹¶æˆåŠŸç»™varå˜é‡èµ‹å€¼ä¹‹åŽï¼Œå°±ä¸å†å…è®¸å…¶ä»–çš„proposerè®¾ç½®varå˜é‡çš„å€¼ã€‚æ¯å½“å†æœ‰proposeræ¥è¯·æ±‚è®¾ç½®varå˜é‡çš„å€¼çš„æ—¶å€™ï¼Œacceptorå°±ä¼šå°†varé‡Œé¢çŽ°æœ‰çš„å€¼è¿”å›žç»™ä»–ã€‚ åŸºäºŽäº’æ–¥è®¿é—®æƒçš„acceptorçš„å®žçŽ° acceptorä¼šä¿å­˜å˜é‡varçš„å€¼å’Œä¸€ä¸ªäº’æ–¥é”Lockã€‚ æä¾›æŽ¥å£prepare() åŠ äº’æ–¥é”ï¼Œç»™äºˆvarçš„äº’æ–¥è®¿é—®æƒï¼Œå¹¶è¿”å›žå½“å‰varçš„å–å€¼ æä¾›æŽ¥å£release() ç”¨äºŽé‡Šæ”¾äº’æ–¥è®¿é—®æƒ æä¾›æŽ¥å£accept(var, v) å¦‚æžœå·²ç»åŠ é”ï¼Œå¹¶ä¸”å½“å‰varæ²¡æœ‰å€¼ï¼Œåˆ™å°†varçš„å€¼è®¾ç½®æˆvï¼Œå¹¶é‡Šæ”¾é”ã€‚ proposeré‡‡ç”¨ä¸¤é˜¶æ®µæ¥å®žçŽ° Step1ã€é€šè¿‡è°ƒç”¨prepareæŽ¥å£æ¥èŽ·å–äº’æ–¥æ€§è®¿é—®æƒå’Œå½“å‰varçš„å–å€¼ å¦‚æžœæ— æ³•èŽ·å–åˆ°äº’æ–¥æ€§è®¿é—®æƒï¼Œåˆ™è¿”å›žï¼Œå¹¶ä¸èƒ½è¿›å…¥åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œå› ä¸ºå…¶ä»–proposerèŽ·å–åˆ°äº†äº’æ–¥æ€§è®¿é—®æƒã€‚ Step2ã€æ ¹æ®å½“å‰varçš„å–å€¼fé€‰æ‹©æ‰§è¡Œ 1ã€å¦‚æžœfçš„å–å€¼ä¸ºnullï¼Œè¯´æ˜Žæ²¡æœ‰è¢«è®¾ç½®è¿‡å€¼ï¼Œåˆ™è°ƒç”¨æŽ¥å£accept(var ,v)æ¥å°†varçš„å–å€¼è®¾ç½®æˆvï¼Œå¹¶é‡Šæ”¾æŽ‰äº’æ–¥æ€§è®¿é—®æƒã€‚2ã€å¦‚æžœfçš„å–å€¼ä¸ä¸ºnullï¼Œè¯´æ˜Žvarå·²ç»è¢«å…¶ä»–proposerè®¾ç½®è¿‡å€¼ï¼Œåˆ™è°ƒç”¨releaseæŽ¥å£é‡Šæ”¾æŽ‰äº’æ–¥æ€§è®¿é—®æƒã€‚ æ€»ç»“ï¼šæ–¹æ¡ˆä¸€é€šè¿‡äº’æ–¥è®¿é—®çš„æ–¹å¼æ¥ä¿è¯æ‰€æœ‰çš„proposerèƒ½å¤Ÿä¸²è¡Œçš„è®¿é—®acceptorï¼Œè¿™æ ·å…¶å®žå¹¶æ²¡æœ‰è§£å†³å¤šä¸ªproposerå¹¶å‘æ‰§è¡Œçš„é—®é¢˜ã€‚åªæ˜¯æƒ³åŠžæ³•ç»•å¼€äº†å¹¶å‘æ‰§è¡Œã€‚è™½ç„¶å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯varå˜é‡çš„å–å€¼æ˜¯ç¡®å®šçš„ã€‚ä½†æ˜¯ä¸€æ—¦èŽ·å–åˆ°äº’æ–¥è®¿é—®æƒçš„proposeråœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºçŽ°æ•…éšœï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æ‰€æœ‰å…¶ä»–proposeræ— æ³•å†èŽ·å–åˆ°äº’æ–¥è®¿é—®æƒï¼Œå°±ä¼šå‘ç”Ÿæ­»é”ã€‚ã€‚æ‰€ä»¥ï¼Œæ–¹æ¡ˆä¸€ä¸ä»…æ•ˆçŽ‡ä½Žã€è€Œä¸”è¿˜ä¼šäº§ç”Ÿæ­»é”é—®é¢˜ï¼Œä¸èƒ½å®¹å¿ä»»æ„Proposerå‡ºçŽ°æ•…éšœã€‚åœ¨ä¹‹å‰æåˆ°çš„å››ä¸ªç³»ç»Ÿéš¾ç‚¹ä¸­ï¼Œæ–¹æ¡ˆä¸€å¯ä»¥è§£å†³éš¾ç‚¹1å’Œéš¾ç‚¹2ï¼Œä½†æ˜¯æ— æ³•è§£å†³éš¾ç‚¹3å’Œéš¾ç‚¹4ã€‚ è§£å†³æ–¹æ¡ˆäºŒé€šè¿‡å¼•å…¥æŠ¢å å¼è®¿é—®æƒæ¥å–ä»£äº’æ–¥è®¿é—®æƒã€‚acceptoræœ‰æƒè®©ä»»æ„proposerçš„è®¿é—®æƒå¤±æ•ˆï¼Œç„¶åŽå°†è®¿é—®æƒå‘æ”¾ç»™å…¶ä»–çš„proposerã€‚ åœ¨æ–¹æ¡ˆäºŒä¸­ï¼Œproposerå‘acceptorå‘å‡ºçš„æ¯æ¬¡è¯·æ±‚éƒ½è¦å¸¦ä¸€ä¸ªç¼–å·ï¼ˆepochï¼‰ï¼Œä¸”ç¼–å·é—´è¦å­˜åœ¨å…¨åºå…³ç³»ã€‚ä¸€æ—¦acceptoræŽ¥æ”¶åˆ°proposerçš„è¯·æ±‚ä¸­åŒ…å«ä¸€ä¸ªæ›´å¤§çš„epochçš„æ—¶å€™ï¼Œé©¬ä¸Šè®©æ—§çš„epochå¤±æ•ˆï¼Œä¸å†æŽ¥å—ä»–ä»¬æäº¤çš„å–å€¼ã€‚ç„¶åŽç»™æ–°çš„epochå‘æ”¾è®¿é—®æƒï¼Œè®©ä»–å¯ä»¥è®¾ç½®varå˜é‡çš„å€¼ã€‚ ä¸ºäº†ä¿è¯varå˜é‡å–å€¼çš„ä¸å˜æ€§ï¼Œä¸åŒepochçš„proposerä¹‹å‰éµå®ˆåŽè€…è®¤åŒå‰è€…çš„åŽŸåˆ™ï¼š åœ¨ç¡®ä¿æ—§çš„epochå·²ç»å¤±æ•ˆåŽï¼Œå¹¶ä¸”æ—§çš„epochæ²¡æœ‰è®¾ç½®varå˜é‡çš„å€¼ï¼Œæ–°çš„epochä¼šæäº¤è‡ªå·±çš„å€¼ã€‚å½“æ—§çš„epochå·²ç»è®¾ç½®è¿‡varå˜é‡çš„å–å€¼ï¼Œé‚£ä¹ˆæ–°çš„epochåº”è¯¥è®¤åŒæ—§çš„epochè®¾ç½®è¿‡çš„å€¼ï¼Œå¹¶ä¸åœ¨æäº¤æ–°çš„å€¼ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼ç³»ç»Ÿçš„CAPç†è®º]]></title>
    <url>%2F2018%2F04%2F09%2F%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84CAP%E7%90%86%E8%AE%BA%2F</url>
    <content type="text"><![CDATA[2000å¹´7æœˆï¼ŒåŠ å·žå¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡çš„Eric Breweræ•™æŽˆåœ¨ACM PODCä¼šè®®ä¸Šæå‡ºCAPçŒœæƒ³ã€‚2å¹´åŽï¼Œéº»çœç†å·¥å­¦é™¢çš„Seth Gilbertå’ŒNancy Lynchä»Žç†è®ºä¸Šè¯æ˜Žäº†CAPã€‚ä¹‹åŽï¼ŒCAPç†è®ºæ­£å¼æˆä¸ºåˆ†å¸ƒå¼è®¡ç®—é¢†åŸŸçš„å…¬è®¤å®šç†ã€‚ CAPç†è®ºæ¦‚è¿°ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰è¿™ä¸‰é¡¹ä¸­çš„ä¸¤é¡¹ã€‚ CAPçš„å®šä¹‰Consistency ä¸€è‡´æ€§ä¸€è‡´æ€§æŒ‡â€œall nodes see the same data at the same timeâ€ï¼Œå³æ›´æ–°æ“ä½œæˆåŠŸå¹¶è¿”å›žå®¢æˆ·ç«¯å®ŒæˆåŽï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ã€‚åˆ†å¸ƒå¼çš„ä¸€è‡´æ€§ å¯¹äºŽä¸€è‡´æ€§ï¼Œå¯ä»¥åˆ†ä¸ºä»Žå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤ä¸ªä¸åŒçš„è§†è§’ã€‚ä»Žå®¢æˆ·ç«¯æ¥çœ‹ï¼Œä¸€è‡´æ€§ä¸»è¦æŒ‡çš„æ˜¯å¤šå¹¶å‘è®¿é—®æ—¶æ›´æ–°è¿‡çš„æ•°æ®å¦‚ä½•èŽ·å–çš„é—®é¢˜ã€‚ä»ŽæœåŠ¡ç«¯æ¥çœ‹ï¼Œåˆ™æ˜¯æ›´æ–°å¦‚ä½•å¤åˆ¶åˆ†å¸ƒåˆ°æ•´ä¸ªç³»ç»Ÿï¼Œä»¥ä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´ã€‚ä¸€è‡´æ€§æ˜¯å› ä¸ºæœ‰å¹¶å‘è¯»å†™æ‰æœ‰çš„é—®é¢˜ï¼Œå› æ­¤åœ¨ç†è§£ä¸€è‡´æ€§çš„é—®é¢˜æ—¶ï¼Œä¸€å®šè¦æ³¨æ„ç»“åˆè€ƒè™‘å¹¶å‘è¯»å†™çš„åœºæ™¯ã€‚ ä»Žå®¢æˆ·ç«¯è§’åº¦ï¼Œå¤šè¿›ç¨‹å¹¶å‘è®¿é—®æ—¶ï¼Œæ›´æ–°è¿‡çš„æ•°æ®åœ¨ä¸åŒè¿›ç¨‹å¦‚ä½•èŽ·å–çš„ä¸åŒç­–ç•¥ï¼Œå†³å®šäº†ä¸åŒçš„ä¸€è‡´æ€§ã€‚å¯¹äºŽå…³ç³»åž‹æ•°æ®åº“ï¼Œè¦æ±‚æ›´æ–°è¿‡çš„æ•°æ®èƒ½è¢«åŽç»­çš„è®¿é—®éƒ½èƒ½çœ‹åˆ°ï¼Œè¿™æ˜¯å¼ºä¸€è‡´æ€§ã€‚å¦‚æžœèƒ½å®¹å¿åŽç»­çš„éƒ¨åˆ†æˆ–è€…å…¨éƒ¨è®¿é—®ä¸åˆ°ï¼Œåˆ™æ˜¯å¼±ä¸€è‡´æ€§ã€‚å¦‚æžœç»è¿‡ä¸€æ®µæ—¶é—´åŽè¦æ±‚èƒ½è®¿é—®åˆ°æ›´æ–°åŽçš„æ•°æ®ï¼Œåˆ™æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ Availability å¯ç”¨æ€§å¯ç”¨æ€§æŒ‡â€œReads and writes always succeedâ€ï¼Œå³æœåŠ¡ä¸€ç›´å¯ç”¨ï¼Œè€Œä¸”æ˜¯æ­£å¸¸å“åº”æ—¶é—´ã€‚ å¯¹äºŽä¸€ä¸ªå¯ç”¨æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ¯ä¸€ä¸ªéžæ•…éšœçš„èŠ‚ç‚¹å¿…é¡»å¯¹æ¯ä¸€ä¸ªè¯·æ±‚ä½œå‡ºå“åº”ã€‚ä¹Ÿå°±æ˜¯ï¼Œè¯¥ç³»ç»Ÿä½¿ç”¨çš„ä»»ä½•ç®—æ³•å¿…é¡»æœ€ç»ˆç»ˆæ­¢ã€‚å½“åŒæ—¶è¦æ±‚åˆ†åŒºå®¹å¿æ€§æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¼ºçš„å®šä¹‰ï¼šå³ä½¿æ˜¯ä¸¥é‡çš„ç½‘ç»œé”™è¯¯ï¼Œæ¯ä¸ªè¯·æ±‚å¿…é¡»ç»ˆæ­¢ã€‚ å¥½çš„å¯ç”¨æ€§ä¸»è¦æ˜¯æŒ‡ç³»ç»Ÿèƒ½å¤Ÿå¾ˆå¥½çš„ä¸ºç”¨æˆ·æœåŠ¡ï¼Œä¸å‡ºçŽ°ç”¨æˆ·æ“ä½œå¤±è´¥æˆ–è€…è®¿é—®è¶…æ—¶ç­‰ç”¨æˆ·ä½“éªŒä¸å¥½çš„æƒ…å†µã€‚å¯ç”¨æ€§é€šå¸¸æƒ…å†µä¸‹å¯ç”¨æ€§å’Œåˆ†å¸ƒå¼æ•°æ®å†—ä½™ï¼Œè´Ÿè½½å‡è¡¡ç­‰æœ‰ç€å¾ˆå¤§çš„å…³è”ã€‚ Partition Toleranceåˆ†åŒºå®¹é”™æ€§åˆ†åŒºå®¹é”™æ€§æŒ‡â€œthe system continues to operate despite arbitrary message loss or failure of part of the systemâ€ï¼Œå³åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°æŸèŠ‚ç‚¹æˆ–ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ã€‚ åˆ†åŒºå®¹é”™æ€§å’Œæ‰©å±•æ€§ç´§å¯†ç›¸å…³ã€‚åœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­ï¼Œå¯èƒ½å› ä¸ºä¸€äº›åˆ†å¸ƒå¼çš„åŽŸå› å¯¼è‡´ç³»ç»Ÿæ— æ³•æ­£å¸¸è¿è½¬ã€‚å¥½çš„åˆ†åŒºå®¹é”™æ€§è¦æ±‚èƒ½å¤Ÿä½¿åº”ç”¨è™½ç„¶æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè€Œçœ‹ä¸ŠåŽ»å´å¥½åƒæ˜¯åœ¨ä¸€ä¸ªå¯ä»¥è¿è½¬æ­£å¸¸çš„æ•´ä½“ã€‚æ¯”å¦‚çŽ°åœ¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰æŸä¸€ä¸ªæˆ–è€…å‡ ä¸ªæœºå™¨å®•æŽ‰äº†ï¼Œå…¶ä»–å‰©ä¸‹çš„æœºå™¨è¿˜èƒ½å¤Ÿæ­£å¸¸è¿è½¬æ»¡è¶³ç³»ç»Ÿéœ€æ±‚ï¼Œæˆ–è€…æ˜¯æœºå™¨ä¹‹é—´æœ‰ç½‘ç»œå¼‚å¸¸ï¼Œå°†åˆ†å¸ƒå¼ç³»ç»Ÿåˆ†éš”æœªç‹¬ç«‹çš„å‡ ä¸ªéƒ¨åˆ†ï¼Œå„ä¸ªéƒ¨åˆ†è¿˜èƒ½ç»´æŒåˆ†å¸ƒå¼ç³»ç»Ÿçš„è¿ä½œï¼Œè¿™æ ·å°±å…·æœ‰å¥½çš„åˆ†åŒºå®¹é”™æ€§ã€‚ CAPçš„è¯æ˜Ž å¦‚ä¸Šå›¾ï¼Œæ˜¯æˆ‘ä»¬è¯æ˜ŽCAPçš„åŸºæœ¬åœºæ™¯ï¼Œç½‘ç»œä¸­æœ‰ä¸¤ä¸ªèŠ‚ç‚¹N1å’ŒN2ï¼Œå¯ä»¥ç®€å•çš„ç†è§£N1å’ŒN2åˆ†åˆ«æ˜¯ä¸¤å°è®¡ç®—æœºï¼Œä»–ä»¬ä¹‹é—´ç½‘ç»œå¯ä»¥è¿žé€šï¼ŒN1ä¸­æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºAï¼Œå’Œä¸€ä¸ªæ•°æ®åº“Vï¼ŒN2ä¹Ÿæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºB2å’Œä¸€ä¸ªæ•°æ®åº“Vã€‚çŽ°åœ¨ï¼ŒAå’ŒBæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸¤ä¸ªéƒ¨åˆ†ï¼ŒVæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®å­˜å‚¨çš„ä¸¤ä¸ªå­æ•°æ®åº“ã€‚ åœ¨æ»¡è¶³ä¸€è‡´æ€§çš„æ—¶å€™ï¼ŒN1å’ŒN2ä¸­çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼ŒV0=V0ã€‚åœ¨æ»¡è¶³å¯ç”¨æ€§çš„æ—¶å€™ï¼Œç”¨æˆ·ä¸ç®¡æ˜¯è¯·æ±‚N1æˆ–è€…N2ï¼Œéƒ½ä¼šå¾—åˆ°ç«‹å³å“åº”ã€‚åœ¨æ»¡è¶³åˆ†åŒºå®¹é”™æ€§çš„æƒ…å†µä¸‹ï¼ŒN1å’ŒN2æœ‰ä»»ä½•ä¸€æ–¹å®•æœºï¼Œæˆ–è€…ç½‘ç»œä¸é€šçš„æ—¶å€™ï¼Œéƒ½ä¸ä¼šå½±å“N1å’ŒN2å½¼æ­¤ä¹‹é—´çš„æ­£å¸¸è¿ä½œã€‚ å¦‚ä¸Šå›¾ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ­£å¸¸è¿è½¬çš„æµç¨‹ï¼Œç”¨æˆ·å‘N1æœºå™¨è¯·æ±‚æ•°æ®æ›´æ–°ï¼Œç¨‹åºAæ›´æ–°æ•°æ®åº“Voä¸ºV1ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå°†æ•°æ®è¿›è¡ŒåŒæ­¥æ“ä½œMï¼Œå°†V1åŒæ­¥çš„N2ä¸­V0ï¼Œä½¿å¾—N2ä¸­çš„æ•°æ®V0ä¹Ÿæ›´æ–°ä¸ºV1ï¼ŒN2ä¸­çš„æ•°æ®å†å“åº”N2çš„è¯·æ±‚ã€‚ è¿™é‡Œï¼Œå¯ä»¥å®šä¹‰N1å’ŒN2çš„æ•°æ®åº“Vä¹‹é—´çš„æ•°æ®æ˜¯å¦ä¸€æ ·ä¸ºä¸€è‡´æ€§ï¼›å¤–éƒ¨å¯¹N1å’ŒN2çš„è¯·æ±‚å“åº”ä¸ºå¯ç”¨è¡Œï¼›N1å’ŒN2ä¹‹é—´çš„ç½‘ç»œçŽ¯å¢ƒä¸ºåˆ†åŒºå®¹é”™æ€§ã€‚è¿™æ˜¯æ­£å¸¸è¿ä½œçš„åœºæ™¯ï¼Œä¹Ÿæ˜¯ç†æƒ³çš„åœºæ™¯ï¼Œç„¶è€ŒçŽ°å®žæ˜¯æ®‹é…·çš„ï¼Œå½“é”™è¯¯å‘ç”Ÿçš„æ—¶å€™ï¼Œä¸€è‡´æ€§å’Œå¯ç”¨æ€§è¿˜æœ‰åˆ†åŒºå®¹é”™æ€§ï¼Œæ˜¯å¦èƒ½åŒæ—¶æ»¡è¶³ï¼Œè¿˜æ˜¯è¯´è¦è¿›è¡Œå–èˆå‘¢ï¼Ÿ ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®ƒå’Œå•æœºç³»ç»Ÿçš„æœ€å¤§åŒºåˆ«ï¼Œå°±åœ¨äºŽç½‘ç»œï¼ŒçŽ°åœ¨å‡è®¾ä¸€ç§æžç«¯æƒ…å†µï¼ŒN1å’ŒN2ä¹‹é—´çš„ç½‘ç»œæ–­å¼€äº†ï¼Œæˆ‘ä»¬è¦æ”¯æŒè¿™ç§ç½‘ç»œå¼‚å¸¸ï¼Œç›¸å½“äºŽè¦æ»¡è¶³åˆ†åŒºå®¹é”™æ€§ï¼Œèƒ½ä¸èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§å’Œå“åº”æ€§å‘¢ï¼Ÿè¿˜æ˜¯è¯´è¦å¯¹ä»–ä»¬è¿›è¡Œå–èˆã€‚ å‡è®¾åœ¨N1å’ŒN2ä¹‹é—´ç½‘ç»œæ–­å¼€çš„æ—¶å€™ï¼Œæœ‰ç”¨æˆ·å‘N1å‘é€æ•°æ®æ›´æ–°è¯·æ±‚ï¼Œé‚£N1ä¸­çš„æ•°æ®V0å°†è¢«æ›´æ–°ä¸ºV1ï¼Œç”±äºŽç½‘ç»œæ˜¯æ–­å¼€çš„ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼ç³»ç»ŸåŒæ­¥æ“ä½œMï¼Œæ‰€ä»¥N2ä¸­çš„æ•°æ®ä¾æ—§æ˜¯V0ï¼›è¿™ä¸ªæ—¶å€™ï¼Œæœ‰ç”¨æˆ·å‘N2å‘é€æ•°æ®è¯»å–è¯·æ±‚ï¼Œç”±äºŽæ•°æ®è¿˜æ²¡æœ‰è¿›è¡ŒåŒæ­¥ï¼Œåº”ç”¨ç¨‹åºæ²¡åŠžæ³•ç«‹å³ç»™ç”¨æˆ·è¿”å›žæœ€æ–°çš„æ•°æ®V1ï¼Œæ€Žä¹ˆåŠžå‘¢ï¼Ÿæœ‰äºŒç§é€‰æ‹©ï¼Œç¬¬ä¸€ï¼Œç‰ºç‰²æ•°æ®ä¸€è‡´æ€§ï¼Œå“åº”æ—§çš„æ•°æ®V0ç»™ç”¨æˆ·ï¼›ç¬¬äºŒï¼Œç‰ºç‰²å¯ç”¨æ€§ï¼Œé˜»å¡žç­‰å¾…ï¼Œç›´åˆ°ç½‘ç»œè¿žæŽ¥æ¢å¤ï¼Œæ•°æ®æ›´æ–°æ“ä½œMå®Œæˆä¹‹åŽï¼Œå†ç»™ç”¨æˆ·å“åº”æœ€æ–°çš„æ•°æ®V1ã€‚ è¿™ä¸ªè¿‡ç¨‹ï¼Œè¯æ˜Žäº†è¦æ»¡è¶³åˆ†åŒºå®¹é”™æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåªèƒ½åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¸¤è€…ä¸­ï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚ CAPæƒè¡¡é€šè¿‡CAPç†è®ºï¼Œæˆ‘ä»¬çŸ¥é“æ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªç‰¹æ€§ï¼Œé‚£è¦èˆå¼ƒå“ªä¸ªå‘¢ï¼Ÿ CA without Pï¼šå¦‚æžœä¸è¦æ±‚Pï¼ˆä¸å…è®¸åˆ†åŒºï¼‰ï¼Œåˆ™Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰æ˜¯å¯ä»¥ä¿è¯çš„ã€‚ä½†å…¶å®žåˆ†åŒºä¸æ˜¯ä½ æƒ³ä¸æƒ³çš„é—®é¢˜ï¼Œè€Œæ˜¯å§‹ç»ˆä¼šå­˜åœ¨ï¼Œå› æ­¤CAçš„ç³»ç»Ÿæ›´å¤šçš„æ˜¯å…è®¸åˆ†åŒºåŽå„å­ç³»ç»Ÿä¾ç„¶ä¿æŒCAã€‚ CP without Aï¼šå¦‚æžœä¸è¦æ±‚Aï¼ˆå¯ç”¨ï¼‰ï¼Œç›¸å½“äºŽæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åœ¨Serverä¹‹é—´å¼ºä¸€è‡´ï¼Œè€ŒPï¼ˆåˆ†åŒºï¼‰ä¼šå¯¼è‡´åŒæ­¥æ—¶é—´æ— é™å»¶é•¿ï¼Œå¦‚æ­¤CPä¹Ÿæ˜¯å¯ä»¥ä¿è¯çš„ã€‚å¾ˆå¤šä¼ ç»Ÿçš„æ•°æ®åº“åˆ†å¸ƒå¼äº‹åŠ¡éƒ½å±žäºŽè¿™ç§æ¨¡å¼ã€‚ AP wihtout Cï¼šè¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦åˆ†åŒºå‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±åŽ»è”ç³»ï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè€Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚çŽ°åœ¨ä¼—å¤šçš„NoSQLéƒ½å±žäºŽæ­¤ç±»ã€‚ å¯¹äºŽå¤šæ•°å¤§åž‹äº’è”ç½‘åº”ç”¨çš„åœºæ™¯ï¼Œä¸»æœºä¼—å¤šã€éƒ¨ç½²åˆ†æ•£ï¼Œè€Œä¸”çŽ°åœ¨çš„é›†ç¾¤è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœæ˜¯å¸¸æ€ï¼Œè€Œä¸”è¦ä¿è¯æœåŠ¡å¯ç”¨æ€§è¾¾åˆ°Nä¸ª9ï¼Œå³ä¿è¯På’ŒAï¼Œèˆå¼ƒCï¼ˆé€€è€Œæ±‚å…¶æ¬¡ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚è™½ç„¶æŸäº›åœ°æ–¹ä¼šå½±å“å®¢æˆ·ä½“éªŒï¼Œä½†æ²¡è¾¾åˆ°é€ æˆç”¨æˆ·æµç¨‹çš„ä¸¥é‡ç¨‹åº¦ã€‚ å¯¹äºŽæ¶‰åŠåˆ°é’±è´¢è¿™æ ·ä¸èƒ½æœ‰ä¸€ä¸è®©æ­¥çš„åœºæ™¯ï¼ŒCå¿…é¡»ä¿è¯ã€‚ç½‘ç»œå‘ç”Ÿæ•…éšœå®å¯åœæ­¢æœåŠ¡ï¼Œè¿™æ˜¯ä¿è¯CAï¼Œèˆå¼ƒPã€‚è²Œä¼¼è¿™å‡ å¹´å›½å†…é“¶è¡Œä¸šå‘ç”Ÿäº†ä¸ä¸‹10èµ·äº‹æ•…ï¼Œä½†å½±å“é¢ä¸å¤§ï¼ŒæŠ¥åˆ°ä¹Ÿä¸å¤šï¼Œå¹¿å¤§ç¾¤ä¼—çŸ¥é“çš„å°‘ã€‚è¿˜æœ‰ä¸€ç§æ˜¯ä¿è¯CPï¼Œèˆå¼ƒAã€‚ä¾‹å¦‚ç½‘ç»œæ•…éšœäº‹åªè¯»ä¸å†™ã€‚ å­°ä¼˜å­°ç•¥ï¼Œæ²¡æœ‰å®šè®ºï¼Œåªèƒ½æ ¹æ®åœºæ™¯å®šå¤ºï¼Œé€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[mavenä½¿ç”¨æ‰‹å†Œ]]></title>
    <url>%2F2018%2F03%2F28%2Fmaven%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C%2F</url>
    <content type="text"><![CDATA[ä¾èµ–æœºåˆ¶1ã€A-&gt;B-&gt;C-&gt;X(1.0)ï¼ŒA-&gt;D-&gt;X(2.0)ï¼Œæ­¤æ—¶ä¸¤æ¡ä¾èµ–è·¯å¾„ä¸Šæœ‰ä¸¤ä¸ªç‰ˆæœ¬çš„Xï¼Œæ­¤æ—¶éµå¾ªè·¯å¾„æœ€è¿‘è€…ä¼˜å…ˆï¼Œå› æ­¤X(2.0)å°†è¢«è§£æžä½¿ç”¨ 2ã€A-&gt;B-&gt;Y(1.0)ï¼ŒA-&gt;C-&gt;Y(2.0)ï¼ŒY(1.0)å’ŒY(2.0)çš„ä¾èµ–é•¿åº¦æ˜¯ä¸€æ ·çš„ï¼Œä»ŽMaven2.0.9å¼€å§‹ï¼Œæ­¤æ—¶éµå¾ªç¬¬ä¸€å£°æ˜Žè€…ä¼˜å…ˆï¼Œå³é¡ºåºæœ€é å‰çš„é‚£ä¸ªä¾èµ–ä¼˜å…ˆ ä¾èµ–æ ‘æŸ¥çœ‹1mvn dependency:tree -Dincludes=org.apache.httpcomponents:httpclient å‚è€ƒ http://maven.apache.org/plugins/maven-dependency-plugin/tree-mojo.html æŽ’é™¤ä¾èµ–ä¼ é€’æ€§ä¾èµ–ä¼šç»™é¡¹ç›®éšå¼åœ°å¼•å…¥å¾ˆå¤šä¾èµ–ï¼Œè¿™æžå¤§åœ°ç®€åŒ–äº†é¡¹ç›®ä¾èµ–çš„ç®¡ç†ï¼Œä½†æ˜¯æœ‰æ—¶å€™è¿™ç§ç‰¹æ€§ä¹Ÿä¼šå¸¦æ¥é—®é¢˜ã€‚æ¯”å¦‚æœ‰ç§æƒ…å†µï¼š 1å½“å‰é¡¹ç›®ä¾èµ–Aï¼ŒAç”±äºŽæŸäº›åŽŸå› ä¾èµ–äº†å¦å¤–ä¸€ä¸ªç±»åº“çš„SNAPSHOTç‰ˆæœ¬ï¼Œé‚£ä¹ˆè¿™ä¸ªSNAPSHOTå°±ä¼šæˆä¸ºå½“å‰é¡¹ç›®çš„ä¼ é€’æ€§ä¾èµ–ï¼ŒäºŒSNAPSHOTçš„ä¸ç¨³å®šæ€§å°†ç›´æŽ¥å½±å“åˆ°å½“å‰çš„é¡¹ç›®ï¼Œæ­¤æ—¶å°±éœ€è¦æŽ’é™¤è¯¥SNAPSHOTï¼Œå¹¶ä¸”åœ¨å½“å‰é¡¹ç›®ä¸­å£°æ˜Žè¯¥ç±»åº“çš„æŸä¸ªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ 1234567891011&lt;dependency&gt; &lt;groupId&gt;com.alibaba.rocketmq&lt;/groupId&gt; &lt;artifactId&gt;rocketmq-client&lt;/artifactId&gt; &lt;version&gt;3.2.7&lt;/version&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;apache-lang&lt;/groupId&gt; &lt;artifactId&gt;commons-lang&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt;&lt;/dependency&gt; settings.xmlproxyproxyè¡¨ç¤ºMavençš„ä»£ç†ï¼Œçœ‹ä¸€ä¸‹å†™æ³•ï¼š 123456789101112&lt;proxies&gt; &lt;proxy&gt; &lt;id&gt;optional&lt;/id&gt; &lt;active&gt;true&lt;/active&gt; &lt;protocol&gt;http&lt;/protocol&gt; &lt;username&gt;proxyuser&lt;/username&gt; &lt;password&gt;proxypass&lt;/password&gt; &lt;host&gt;proxy.host.net&lt;/host&gt; &lt;port&gt;80&lt;/port&gt; &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt; &lt;/proxy&gt;&lt;/proxies&gt; éœ€è¦proxyæ˜¯å› ä¸ºå¾ˆå¤šæ—¶å€™ä½ æ‰€åœ¨çš„å…¬å¸åŸºäºŽå®‰å…¨å› ç´ è€ƒè™‘ï¼Œè¦æ±‚ä½ ä½¿ç”¨é€šè¿‡å®‰å…¨è®¤è¯çš„ä»£ç†è®¿é—®å› ç‰¹ç½‘ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°±éœ€è¦ä¸ºMavené…ç½®HTTPä»£ç†ï¼Œæ‰èƒ½è®©å®ƒæ­£å¸¸è®¿é—®å¤–éƒ¨ä»“åº“ï¼Œä»¥ä¸‹è½½æ‰€éœ€è¦çš„èµ„æºã€‚proxiesä¸‹å¯ä»¥é…ç½®å¤šä¸ªproxyå…ƒç´ ï¼Œå¦‚æžœå£°æ˜Žäº†å¤šä¸ªproxyå…ƒç´ ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ç¬¬ä¸€ä¸ªè¢«æ¿€æ´»çš„proxyä¼šç”Ÿæ•ˆã€‚activeä¸ºtrueè¡¨ç¤ºæ¿€æ´»è¯¥ä»£ç†ï¼Œprotocolè¡¨ç¤ºä½¿ç”¨çš„ä»£ç†åè®®ï¼Œå½“ç„¶æœ€é‡è¦çš„æ˜¯æŒ‡å®šæ­£ç¡®çš„ä¸»æœºåï¼ˆhostï¼‰å’Œç«¯å£ï¼ˆportï¼‰ï¼Œå¦‚æžœä»£ç†æœåŠ¡å™¨éœ€è¦è®¤è¯åˆ™é…ç½®usernameå’Œpasswordï¼ŒnonProxyHostå…ƒç´ è¡¨ç¤ºæŒ‡å®šå“ªäº›ä¸»æœºåä¸éœ€è¦ä»£ç†ï¼Œå¯ä»¥ç”¨â€|â€åˆ†éš”å¤šä¸ªä¸»æœºåï¼Œä¹Ÿæ”¯æŒé€šé…ç¬¦â€*â€ã€‚ repositoryrepositoryè¡¨ç¤ºMavençš„ä¸­å¤®ä»“åº“ï¼Œå› ä¸ºå°½ç®¡é»˜è®¤çš„è¿œç¨‹ä»“åº“ä¸­çš„æž„ä»¶éžå¸¸åºžå¤§ï¼Œä½†æ˜¯æ€»å½’ä¼šæœ‰ä¸æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„æ—¶å€™ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ°åˆ«çš„ä¸­å¤®ä»“åº“äº†ã€‚çœ‹ä¸€ä¸‹å†™æ³•ï¼š 1234567891011&lt;repository&gt; &lt;id&gt;public&lt;/id&gt; &lt;name&gt;local private nexus&lt;/name&gt; &lt;url&gt;http://192.168.1.6:8081/nexus/content/groups/public&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt;&lt;/repository&gt; å¯ä»¥å£°æ˜Žå¤šä¸ªrepositoryã€‚idå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå°¤å…¶æ³¨æ„ï¼ŒMavenè‡ªå¸¦çš„ä¸­å¤®ä»“åº“ä½¿ç”¨çš„idä¸ºcentralï¼Œå¦‚æžœå…¶ä»–ä»“åº“å£°æ˜Žä¹Ÿç”¨è¯¥idï¼Œå°±ä¼šè¦†ç›–ä¸­å¤®ä»“åº“çš„é…ç½®ã€‚releaseså’Œsnapshotsæ¯”è¾ƒé‡è¦ï¼Œå‰è€…è¡¨ç¤ºå¼€å¯ä»“åº“çš„å‘å¸ƒç‰ˆæœ¬ä¸‹è½½æ”¯æŒï¼ŒåŽè€…è¡¨ç¤ºå…³é—­ä»“åº“çš„å¿«ç…§ç‰ˆæœ¬ä¸‹è½½æ”¯æŒï¼Œè¿™æ ·ä¸€æ¥ï¼ŒMavenå°±ä¼šåŽ»ä»“åº“ä¸‹è½½å‘å¸ƒç‰ˆæœ¬çš„æž„ä»¶è€Œä¸ä¼šä¸‹è½½å¿«ç…§ç‰ˆæœ¬çš„æž„ä»¶äº†ã€‚ serverå¤§éƒ¨åˆ†è¿œç¨‹ä»“åº“æ— é¡»è®¤è¯å°±å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯æœ‰æ—¶å€™å¤„äºŽå®‰å…¨æ–¹é¢çš„å› ç´ è€ƒè™‘ï¼Œéœ€è¦æä¾›è®¤è¯ä¿¡æ¯æ‰èƒ½è®¿é—®ä¸€äº›è¿œç¨‹ä»“åº“ï¼Œå¤„äºŽå®‰å…¨è€ƒè™‘ï¼Œè®¤è¯ä¿¡æ¯ä¸€èˆ¬åªæ”¾åœ¨settings.xmlä¸­ï¼Œserverå°±æ˜¯è®¤è¯å…ƒç´ ã€‚çœ‹ä¸€ä¸‹é…ç½®ï¼š 12345&lt;server&gt; &lt;id&gt;nexus-releases&lt;/id&gt; &lt;username&gt;deployment&lt;/username&gt; &lt;password&gt;deployment&lt;/password&gt;&lt;/server&gt; è¿™é‡Œçš„å…³é”®æ˜¯idï¼Œè¿™ä¸ªidå¿…é¡»ä¸Žéœ€è¦è®¤è¯çš„repositoryå…ƒç´ çš„idå®Œå…¨ä¸€è‡´æ‰è¡Œï¼Œæ¢å¥è¯è¯´ï¼Œæ­£å¼è¿™ä¸ªidå°†è®¤è¯ä¿¡æ¯å’Œä»“åº“é…ç½®è”ç³»åœ¨äº†ä¸€èµ·ã€‚ mirrorå¦‚æžœä»“åº“Xå¯ä»¥æä¾›ä»“åº“Yå­˜å‚¨çš„æ‰€æœ‰å†…å®¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸ºä»“åº“Xæ˜¯ä»“åº“Yçš„ä¸€ä¸ªé•œåƒï¼ˆmirrorï¼‰ï¼Œæ¢å¥è¯è¯´ï¼Œä»»ä½•ä¸€ä¸ªå¯ä»¥ä»ŽYä¸­èŽ·å–åˆ°çš„æž„ä»¶å¤Ÿå¯ä»¥ä»ŽXä¸­èŽ·å–åˆ°ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œâ€http://maven.net.cn/content/groups/public/&quot;æ˜¯ä¸­å¤®ä»“åº“&quot;http://repo1.maven.org/maven2/&quot;åœ¨ä¸­å›½çš„é•œåƒï¼Œç”±äºŽåœ°ç†ä½ç½®çš„å› ç´ ï¼Œè¯¥é•œåƒå¾€å¾€èƒ½å¤Ÿæä¾›æ¯”ä¸­å¤®ä»“åº“æ›´å¿«çš„æœåŠ¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦ä½¿ç”¨mirrorçš„åŽŸå› ã€‚ çœ‹ä¸€ä¸‹mirrorçš„é…ç½®ï¼š 123456&lt;mirror&gt; &lt;id&gt;nexus&lt;/id&gt; &lt;name&gt;internal nexus repository&lt;/name&gt; &lt;url&gt;http://192.168.1.6:8081/nexus/content/groups/public&lt;/url&gt; &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;&lt;/mirror&gt; è¯¥ä¾‹å­ä¸­ï¼Œmirrofä¸º*ï¼Œè¡¨ç¤ºè¯¥é…ç½®ä¸ºæ‰€æœ‰ä¸­å¤®ä»“åº“çš„é•œåƒï¼Œä»»ä½•å¯¹äºŽä¸­å¤®ä»“åº“çš„è¯·æ±‚éƒ½ä¼šè½¬è‡³è¯¥é•œåƒã€‚å¦å¤–ä¸‰ä¸ªå…ƒç´ idã€nameã€urlä¸Žä¸€èˆ¬ä»“åº“é…ç½®æ— å¼‚ï¼Œè¡¨ç¤ºè¯¥é•œåƒä»“åº“çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€åç§°ä»¥åŠåœ°å€ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æžœè¯¥é•œåƒéœ€è¦è®¤è¯ï¼Œä¹Ÿå¯ä»¥åŸºäºŽè¯¥idé…ç½®ä»“åº“è®¤è¯ã€‚ maven deployæŒ‡å®šæ–‡ä»¶deploy 1mvn clean deploy -f pom-deploy.xml]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å®‰å…¨æŠ€æœ¯--å“ˆå¸Œç®—æ³•å¯†ç ç ´è§£ä¹‹å½©è™¹è¡¨]]></title>
    <url>%2F2018%2F03%2F27%2F%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF-%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3%E4%B9%8B%E5%BD%A9%E8%99%B9%E8%A1%A8%2F</url>
    <content type="text"><![CDATA[[åŸºç¡€æŠ€èƒ½] å®‰å…¨æŠ€æœ¯â€”â€”å“ˆå¸Œç®—æ³•å¯†ç ç ´è§£ä¹‹å½©è™¹è¡¨(Rainbow Table)å­¦ä¹ 1ã€åŸºç¡€çŸ¥è¯†åˆšåˆšå­¦ä¹ è¿‡æ•°å­—ç­¾åçš„ç›¸å…³çŸ¥è¯†ï¼Œä»¥åŠæ•°å­—ç­¾åçš„ä¼ªé€ æŠ€æœ¯ï¼Œè€Œä¼ªé€ æ•°å­—ç­¾åå½’æ ¹ç»“åº•å°±æ˜¯å¯†ç ç ´è§£çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œç„¶è€Œç›´æŽ¥ç ´è§£çš„é€Ÿåº¦æ˜¯éžå¸¸ç¼“æ…¢çš„ï¼Œæ‰€ä»¥æœ‰äººæƒ³å‡ºä¸€ç§åŠžæ³•ï¼Œç›´æŽ¥å»ºç«‹å‡ºä¸€ä¸ªæ•°æ®æ–‡ä»¶ï¼Œé‡Œé¢äº‹å…ˆè®°å½•äº†é‡‡ç”¨å’Œç›®æ ‡é‡‡ç”¨åŒæ ·ç®—æ³•è®¡ç®—åŽç”Ÿæˆçš„Hashæ•£åˆ—æ•°å€¼ï¼Œåœ¨éœ€è¦ç ´è§£çš„æ—¶å€™ç›´æŽ¥è°ƒç”¨è¿™æ ·çš„æ–‡ä»¶è¿›è¡Œæ¯”å¯¹ï¼Œç ´è§£æ•ˆçŽ‡å°±å¯ä»¥å¤§å¹…åº¦åœ°ï¼Œç”šè‡³æˆç™¾è¿‘åƒè¿‘ä¸‡å€åœ°æé«˜ï¼Œè¿™æ ·äº‹å…ˆæž„é€ çš„Hashæ•£åˆ—æ•°æ®æ–‡ä»¶åœ¨å®‰å…¨ç•Œè¢«ç§°ä¹‹ä¸ºTableã€‚ å…¶å®žç®€å•ç†è§£å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå¤§åž‹æ•°æ®å­—å…¸æ¥è¿›è¡Œå¿«é€ŸåŒ¹é…æš´åŠ›ç ´è§£çš„æ–¹æ³•ï¼Œä»¥ç©ºé—´æ¥æ¢å–æ—¶é—´çš„æ–¹æ³•ã€‚ å…·ä½“çš„éœ€è¦ä¸€äº›åŸºç¡€çŸ¥è¯†åšæ”¯æ’‘ï¼š 1ã€å“ˆå¸Œç®—æ³•å“ˆå¸Œï¼ˆHashï¼‰ç®—æ³•æ˜¯å•å‘æ•£åˆ—ç®—æ³•ï¼Œå®ƒæŠŠæŸä¸ªè¾ƒå¤§çš„é›†åˆPæ˜ å°„åˆ°å¦ä¸€ä¸ªè¾ƒå°çš„é›†åˆQä¸­ï¼Œå‡å¦‚è¿™ä¸ªç®—æ³•å«Hï¼Œé‚£ä¹ˆå°±æœ‰Q = Hï¼ˆPï¼‰ã€‚å¯¹äºŽPä¸­ä»»ä½•ä¸€ä¸ªå€¼péƒ½æœ‰å”¯ä¸€ç¡®å®šçš„qä¸Žä¹‹å¯¹åº”ï¼Œä½†æ˜¯ä¸€ä¸ªqå¯ä»¥å¯¹åº”å¤šä¸ªpã€‚ä½œä¸ºä¸€ä¸ªæœ‰ç”¨çš„Hashç®—æ³•ï¼ŒHè¿˜åº”è¯¥æ»¡è¶³ï¼š H(p)é€Ÿåº¦æ¯”è¾ƒå¿«ï¼› ç»™å‡ºä¸€ä¸ªqï¼Œå¾ˆéš¾ç®—å‡ºä¸€ä¸ªpæ»¡è¶³q = H(p)ï¼›å³å•å‘æ€§ã€‚ ç»™å‡ºä¸€ä¸ªp1ï¼Œå¾ˆéš¾ç®—å‡ºä¸€ä¸ªä¸ç­‰äºŽp1çš„p2ä½¿å¾— H(p1)=H(p2)ï¼›å¼ºå¼±ç¢°æ’žæ€§ã€‚ æ­£å› ä¸ºæœ‰è¿™æ ·çš„ç‰¹æ€§ï¼ŒHashç®—æ³•ç»å¸¸è¢«ç”¨æ¥ä¿å­˜å¯†ç â€”â€”â€”â€”è¿™æ ·ä¸ä¼šæ³„éœ²å¯†ç æ˜Žæ–‡ï¼Œåˆå¯ä»¥æ ¡éªŒè¾“å…¥çš„å¯†ç æ˜¯å¦æ­£ç¡®ã€‚å¸¸ç”¨çš„ Hashç®—æ³•æœ‰MD5ã€SHA1ç­‰ã€‚ 2ã€ç ´è§£HASH ç ´è§£Hashçš„ä»»åŠ¡å°±æ˜¯ï¼Œå¯¹äºŽç»™å‡ºçš„ä¸€ä¸ªqï¼Œåç®—å‡ºä¸€ä¸ªpæ¥æ»¡è¶³q = H(p)ã€‚å³ç›´æŽ¥é‡‡ç”¨ç¢°æ’žçš„æ–¹æ³•æ¥æ‰“ç ´å®ƒçš„å¼ºå¼±ç¢°æ’žæ€§ã€‚é€šå¸¸æˆ‘ä»¬èƒ½æƒ³åˆ°çš„åŠžæ³•æœ‰ä¸¤ç§ï¼š 1ã€æš´åŠ›ç ´è§£æ³•ï¼ŒæŠŠPä¸­çš„æ¯ä¸€ä¸ªpéƒ½ç®—ä¸€ä¸‹H(p)ï¼Œç›´åˆ°ç»“æžœç­‰äºŽqï¼› 2ã€æŸ¥è¡¨æ³•ï¼Œä½¿ç”¨ä¸€ä¸ªå¤§åž‹å­—å…¸ï¼ŒæŠŠæ¯ä¸ªpå’Œå¯¹åº”çš„qéƒ½è®°å½•ä¸‹æ¥ï¼ŒæŒ‰qåšä¸€ä¸‹ç´¢å¼•ï¼Œç›´æŽ¥æŸ¥æ‰¾åŒ¹é…ã€‚ ä¸¤ç§åŠžæ³•ç†è®ºä¸Šéƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å‰ä¸€ç§éœ€è¦å¤§é‡æ—¶é—´ï¼ŒåŽä¸€ç§éœ€è¦å¤§é‡å­˜å‚¨ã€‚è¿™ç§å•çº¯çš„å¼€é”€æ˜¯å¾ˆå·¨å¤§çš„ï¼Œæ‰€ä»¥ç›®å‰æˆ‘ä»¬è®¤ä¸ºHashæ˜¯è¶³å¤Ÿå®‰å…¨çš„ï¼Œåå‡ ä½ä»¥ä¸Šçš„å¯†ç ä¹Ÿæ˜¯å¼ºåº¦è¶³å¤Ÿçš„ã€‚ 3ã€å½©è™¹è¡¨ æ—¶ç©ºçš„å¹³è¡¡ å¯¹äºŽHASHçš„ä¼ ç»Ÿåšæ³•æ˜¯æŠŠH(X)çš„æ‰€æœ‰è¾“å‡ºç©·ä¸¾ï¼ŒæŸ¥æ‰¾H(X[y])==H(P)ï¼Œå¾—å‡ºP==X[y]ã€‚è€Œå½©è™¹è¡¨åˆ™æ˜¯ä½¿ç”¨æ•£åˆ—é“¾çš„æ–¹å¼è¿›è¡Œã€‚ â€œæ•£åˆ—é“¾â€æ˜¯ä¸ºäº†é™ä½Žä¼ ç»Ÿåšæ³•ç©ºé—´è¦æ±‚çš„æŠ€æœ¯ï¼Œæƒ³æ³•æ˜¯å®šä¹‰ä¸€ä¸ªè¡°å‡å‡½æ•° R æŠŠæ•£åˆ—å€¼å˜æ¢æˆå¦ä¸€å­—ç¬¦ä¸²ã€‚é€šè¿‡äº¤æ›¿è¿ç®—Hå‡½æ•°å’ŒRå‡½æ•°ï¼Œå½¢æˆäº¤æ›¿çš„å¯†ç å’Œæ•£åˆ—å€¼é“¾æ¡ã€‚ 2ã€è¯¦è§£å½“é¢å¯¹è¦ç ´è§£çš„å“ˆå¸Œå‡½æ•°Hï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªçº¦ç®€å‡½æ•°ï¼ˆreduction functionï¼‰Rï¼Œè¯¥å‡½æ•°çš„å®šä¹‰åŸŸå’Œå€¼åŸŸéœ€è¦å’Œå“ˆå¸Œå‡½æ•°ç›¸åï¼Œé€šè¿‡è¯¥å‡½æ•°å¯ä»¥å°†å“ˆå¸Œå€¼çº¦ç®€ä¸ºä¸€ä¸ªä¸ŽåŽŸæ–‡ç›¸åŒæ ¼å¼çš„å€¼ï¼ˆâ€plain textâ€ valueï¼‰ã€‚éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œç”±äºŽå“ˆå¸Œå‡½æ•°Hæ˜¯ä¸å¯é€†çš„ï¼Œæ‰€ä»¥å¯¹äºŽå¯†æ–‡è¿›è¡ŒRè¿ç®—å‡ ä¹Žä¸å¯èƒ½å¾—åˆ°æ˜Žæ–‡åŽŸæ–‡ã€‚ä¾‹å¦‚ï¼Œäº”ä½å­—æ¯æ˜Žæ–‡â€œzhihuâ€è¿›è¡ŒHè¿ç®—åŽå¾—åˆ°äº†â€œD2A82C9Aâ€ï¼Œè€Œå¯¹â€œD2A82C9Aâ€è¿›è¡ŒRè¿ç®—åŽå¾—åˆ°å¦ä¸€ä¸ªäº”ä½å­—æ¯æ ¼å¼çš„å€¼â€œvfkkdâ€ã€‚å› ä¸ºè¿™ä¸ªå€¼è½åœ¨Hçš„å®šä¹‰åŸŸä¸­ï¼Œå› æ­¤å¯ä»¥å¯¹å®ƒç»§ç»­è¿›è¡ŒHè¿ç®—ã€‚å°±è¿™æ ·ï¼Œå°†Hè¿ç®—ã€Rè¿ç®—ã€Hè¿ç®—â€¦â€¦è¿™ä¸ªè¿‡ç¨‹åå¤åœ°é‡å¤ä¸‹åŽ»ï¼Œé‡å¤ä¸€ä¸ªç‰¹å®šçš„æ¬¡æ•° k ä»¥åŽï¼Œå°±å¾—åˆ°ä¸€æ¡å“ˆå¸Œé“¾ï¼Œä¾‹å¦‚kä¸º2æ—¶å¾—åˆ°ï¼š è¦ç”Ÿæˆä¸€ä¸ªè¡¨ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸€ç»„éšæœºçš„åˆå§‹å¯†ç ï¼Œæ¯ä¸€ä¸ªå¯†ç è®¡ç®—ä¸€ä¸ªå›ºå®šé•¿åº¦Kçš„é“¾ï¼Œå¹¶åªå­˜å‚¨æ¯ä¸€ä¸ªé“¾çš„ç¬¬ä¸€ä¸ªå’Œæœ€åŽä¸€ä¸ªå¯†ç ã€‚ç¬¬ä¸€å¯†ç è¢«ç§°ä¸ºå§‹ç‚¹ï¼Œæœ€åŽä¸€ä¸ªè¢«ç§°ä¸ºæœ«ç‚¹ã€‚åœ¨ä¸Šé¢ä¾‹ä¸¾çš„é“¾ä¸­ï¼Œâ€œzhihuâ€å°±æ˜¯å§‹ç‚¹ï¼Œâ€œcrepaâ€å°±æ˜¯æœ«ç‚¹ï¼Œå…¶ä»–å¯†ç ï¼ˆæˆ–æ•£åˆ—å€¼ï¼‰å¹¶ä¸è¢«ä¿å­˜ã€‚ é€ è¡¨è¿‡ç¨‹ï¼š æŸ¥è¡¨è¿‡ç¨‹ï¼š å‚è€ƒï¼š å½©è™¹è¡¨ç ´è§£å¼€æœºå¯†ç ã€MD5ç®—æ³•ç­‰çš„åŽŸç†http://www.91ri.org/7593.html]]></content>
      <categories>
        <category>å®‰å…¨</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[javaå·¥ç¨‹å¸ˆæˆç¥žä¹‹è·¯]]></title>
    <url>%2F2018%2F03%2F23%2Fjava%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%88%90%E7%A5%9E%E4%B9%8B%E8%B7%AF%2F</url>
    <content type="text"><![CDATA[ä¸€ã€åŸºç¡€ç¯‡JVM JVMå†…å­˜ç»“æž„å †ã€æ ˆã€æ–¹æ³•åŒºã€ç›´æŽ¥å†…å­˜ã€å †å’Œæ ˆåŒºåˆ« Javaå†…å­˜æ¨¡åž‹å†…å­˜å¯è§æ€§ã€é‡æŽ’åºã€é¡ºåºä¸€è‡´æ€§ã€volatileã€é”ã€final åžƒåœ¾å›žæ”¶å†…å­˜åˆ†é…ç­–ç•¥ã€åžƒåœ¾æ”¶é›†å™¨ï¼ˆG1ï¼‰ã€GCç®—æ³•ã€GCå‚æ•°ã€å¯¹è±¡å­˜æ´»çš„åˆ¤å®š JVMå‚æ•°åŠè°ƒä¼˜Javaå¯¹è±¡æ¨¡åž‹oop-klassã€å¯¹è±¡å¤´ HotSpotå³æ—¶ç¼–è¯‘å™¨ã€ç¼–è¯‘ä¼˜åŒ– ç±»åŠ è½½æœºåˆ¶classLoaderã€ç±»åŠ è½½è¿‡ç¨‹ã€åŒäº²å§”æ´¾ï¼ˆç ´ååŒäº²å§”æ´¾ï¼‰ã€æ¨¡å—åŒ–ï¼ˆjboss modulesã€osgiã€jigsawï¼‰ è™šæ‹Ÿæœºæ€§èƒ½ç›‘æŽ§ä¸Žæ•…éšœå¤„ç†å·¥å…·jps, jstack, jmapã€jstat, jconsole, jinfo, jhat, javap, btraceã€TProfiler ç¼–è¯‘ä¸Žåç¼–è¯‘ javac ã€javap ã€jad ã€CRF JavaåŸºç¡€çŸ¥è¯† é˜…è¯»æºä»£ç Stringã€Integerã€Longã€Enumã€BigDecimalã€ThreadLocalã€ClassLoader &amp; URLClassLoaderã€ArrayList &amp; LinkedListã€ HashMap &amp; LinkedHashMap &amp; TreeMap &amp; CouncurrentHashMapã€HashSet &amp; LinkedHashSet &amp; TreeSet Javaä¸­å„ç§å˜é‡ç±»åž‹ç†Ÿæ‚‰Java Stringçš„ä½¿ç”¨ï¼Œç†Ÿæ‚‰Stringçš„å„ç§å‡½æ•°JDK 6å’ŒJDK 7ä¸­substringçš„åŽŸç†åŠåŒºåˆ«ã€ replaceFirstã€replaceAllã€replaceåŒºåˆ«ã€ Stringå¯¹â€œ+â€çš„é‡è½½ã€ String.valueOfå’ŒInteger.toStringçš„åŒºåˆ«ã€ å­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§ è‡ªåŠ¨æ‹†è£…ç®±Integerçš„ç¼“å­˜æœºåˆ¶ ç†Ÿæ‚‰Javaä¸­å„ç§å…³é”®å­—transientã€instanceofã€volatileã€synchronizedã€finalã€staticã€const åŽŸç†åŠç”¨æ³•ã€‚ é›†åˆç±»å¸¸ç”¨é›†åˆç±»çš„ä½¿ç”¨ ArrayListå’ŒLinkedListå’ŒVectorçš„åŒºåˆ« SynchronizedListå’ŒVectorçš„åŒºåˆ« HashMapã€HashTableã€ConcurrentHashMapåŒºåˆ« Java 8ä¸­streamç›¸å…³ç”¨æ³• apacheé›†åˆå¤„ç†å·¥å…·ç±»çš„ä½¿ç”¨ ä¸åŒç‰ˆæœ¬çš„JDKä¸­HashMapçš„å®žçŽ°çš„åŒºåˆ«ä»¥åŠåŽŸå›  æžšä¸¾æžšä¸¾çš„ç”¨æ³•ã€æžšä¸¾ä¸Žå•ä¾‹ã€Enumç±» Java IO&amp;Java NIOï¼Œå¹¶å­¦ä¼šä½¿ç”¨bioã€nioå’Œaioçš„åŒºåˆ«ã€ä¸‰ç§IOçš„ç”¨æ³•ä¸ŽåŽŸç†ã€netty Javaåå°„ä¸Žjavassiståå°„ä¸Žå·¥åŽ‚æ¨¡å¼ã€ java.lang.reflect.* Javaåºåˆ—åŒ–ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸Žååºåˆ—åŒ–ã€ä¸ºä»€ä¹ˆåºåˆ—åŒ– åºåˆ—åŒ–åº•å±‚åŽŸç† åºåˆ—åŒ–ä¸Žå•ä¾‹æ¨¡å¼ protobuf ä¸ºä»€ä¹ˆè¯´åºåˆ—åŒ–å¹¶ä¸å®‰å…¨ æ³¨è§£å…ƒæ³¨è§£ã€è‡ªå®šä¹‰æ³¨è§£ã€Javaä¸­å¸¸ç”¨æ³¨è§£ä½¿ç”¨ã€æ³¨è§£ä¸Žåå°„çš„ç»“åˆ JMSä»€ä¹ˆæ˜¯Javaæ¶ˆæ¯æœåŠ¡ã€JMSæ¶ˆæ¯ä¼ é€æ¨¡åž‹ JMXjava.lang.management.*ã€ javax.management.* æ³›åž‹æ³›åž‹ä¸Žç»§æ‰¿ ç±»åž‹æ“¦é™¤ æ³›åž‹ä¸­K T V E objectç­‰çš„å«ä¹‰ã€æ³›åž‹å„ç§ç”¨æ³• å•å…ƒæµ‹è¯•junitã€mockã€mockitoã€å†…å­˜æ•°æ®åº“ï¼ˆh2ï¼‰ æ­£åˆ™è¡¨è¾¾å¼java.lang.util.regex.* å¸¸ç”¨çš„Javaå·¥å…·åº“commons.lang, commons.*... guava-libraries netty ä»€ä¹ˆæ˜¯API&amp;SPIå¼‚å¸¸å¼‚å¸¸ç±»åž‹ã€æ­£ç¡®å¤„ç†å¼‚å¸¸ã€è‡ªå®šä¹‰å¼‚å¸¸ æ—¶é—´å¤„ç†æ—¶åŒºã€æ—¶ä»¤ã€Javaä¸­æ—¶é—´API ç¼–ç æ–¹å¼è§£å†³ä¹±ç é—®é¢˜ã€å¸¸ç”¨ç¼–ç æ–¹å¼ è¯­æ³•ç³–Javaä¸­è¯­æ³•ç³–åŽŸç†ã€è§£è¯­æ³•ç³– Javaå¹¶å‘ç¼–ç¨‹ ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œä¸Žè¿›ç¨‹çš„åŒºåˆ«é˜…è¯»æºä»£ç ï¼Œå¹¶å­¦ä¼šä½¿ç”¨Threadã€Runnableã€Callableã€ReentrantLockã€ReentrantReadWriteLockã€Atomic*ã€Semaphoreã€CountDownLatchã€ã€ConcurrentHashMapã€Executors çº¿ç¨‹æ± è‡ªå·±è®¾è®¡çº¿ç¨‹æ± ã€submit() å’Œ execute() çº¿ç¨‹å®‰å…¨æ­»é”ã€æ­»é”å¦‚ä½•æŽ’æŸ¥ã€Javaçº¿ç¨‹è°ƒåº¦ã€çº¿ç¨‹å®‰å…¨å’Œå†…å­˜æ¨¡åž‹çš„å…³ç³» é”CASã€ä¹è§‚é”ä¸Žæ‚²è§‚é”ã€æ•°æ®åº“ç›¸å…³é”æœºåˆ¶ã€åˆ†å¸ƒå¼é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ã€monitorã€é”ä¼˜åŒ–ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€è‡ªæ—‹é”ã€å¯é‡å…¥é”ã€é˜»å¡žé”ã€æ­»é” æ­»é”volatilehappens-beforeã€ç¼–è¯‘å™¨æŒ‡ä»¤é‡æŽ’å’ŒCPUæŒ‡ä»¤é‡ synchronizedsynchronizedæ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Ÿ synchronizedå’Œlockä¹‹é—´å…³ç³» ä¸ä½¿ç”¨synchronizedå¦‚ä½•å®žçŽ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å•ä¾‹ sleep å’Œ waitwait å’Œ notifynotify å’Œ notifyAllThreadLocalå†™ä¸€ä¸ªæ­»é”çš„ç¨‹åºå†™ä»£ç æ¥è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜å®ˆæŠ¤çº¿ç¨‹å®ˆæŠ¤çº¿ç¨‹å’Œéžå®ˆæŠ¤çº¿ç¨‹çš„åŒºåˆ«ä»¥åŠç”¨æ³• äºŒã€ è¿›é˜¶ç¯‡Javaåº•å±‚çŸ¥è¯† å­—èŠ‚ç ã€classæ–‡ä»¶æ ¼å¼CPUç¼“å­˜ï¼ŒL1ï¼ŒL2ï¼ŒL3å’Œä¼ªå…±äº«å°¾é€’å½’ä½è¿ç®—ç”¨ä½è¿ç®—å®žçŽ°åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–ä½™ è®¾è®¡æ¨¡å¼ äº†è§£23ç§è®¾è®¡æ¨¡å¼ä¼šä½¿ç”¨å¸¸ç”¨è®¾è®¡æ¨¡å¼å•ä¾‹ã€ç­–ç•¥ã€å·¥åŽ‚ã€é€‚é…å™¨ã€è´£ä»»é“¾ã€‚ å®žçŽ°AOPå®žçŽ°IOCä¸ç”¨synchronizedå’Œlockï¼Œå®žçŽ°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼nioå’Œreactorè®¾è®¡æ¨¡å¼ç½‘ç»œç¼–ç¨‹ tcpã€udpã€httpã€httpsç­‰å¸¸ç”¨åè®®ä¸‰æ¬¡æ¡æ‰‹ä¸Žå››æ¬¡å…³é—­ã€æµé‡æŽ§åˆ¶å’Œæ‹¥å¡žæŽ§åˆ¶ã€OSIä¸ƒå±‚æ¨¡åž‹ã€tcpç²˜åŒ…ä¸Žæ‹†åŒ… http/1.0 http/1.1 http/2ä¹‹å‰çš„åŒºåˆ«Java RMIï¼ŒSocketï¼ŒHttpClientcookie ä¸Ž sessioncookieè¢«ç¦ç”¨ï¼Œå¦‚ä½•å®žçŽ°session ç”¨Javaå†™ä¸€ä¸ªç®€å•çš„é™æ€æ–‡ä»¶çš„HTTPæœåŠ¡å™¨ å®žçŽ°å®¢æˆ·ç«¯ç¼“å­˜åŠŸèƒ½ï¼Œæ”¯æŒè¿”å›ž304 å®žçŽ°å¯å¹¶å‘ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ ä½¿ç”¨nioå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ æ”¯æŒç®€å•çš„rewriteè§„åˆ™ ä¸Šè¿°åŠŸèƒ½åœ¨å®žçŽ°çš„æ—¶å€™éœ€è¦æ»¡è¶³â€œå¼€é—­åŽŸåˆ™â€ äº†è§£nginxå’ŒapacheæœåŠ¡å™¨çš„ç‰¹æ€§å¹¶æ­å»ºä¸€ä¸ªå¯¹åº”çš„æœåŠ¡å™¨ç”¨Javaå®žçŽ°FTPã€SMTPåè®®è¿›ç¨‹é—´é€šè®¯çš„æ–¹å¼ä»€ä¹ˆæ˜¯CDNï¼Ÿå¦‚æžœå®žçŽ°ï¼Ÿä»€ä¹ˆæ˜¯DNSï¼Ÿåå‘ä»£ç†æ¡†æž¶çŸ¥è¯† Servletçº¿ç¨‹å®‰å…¨é—®é¢˜Servletä¸­çš„filterå’ŒlistenerHibernateçš„ç¼“å­˜æœºåˆ¶Hiberateçš„æ‡’åŠ è½½Spring Beançš„åˆå§‹åŒ–Springçš„AOPåŽŸç†è‡ªå·±å®žçŽ°Springçš„IOCSpring MVCSpring Boot2.0Spring Bootçš„starteråŽŸç†ï¼Œè‡ªå·±å®žçŽ°ä¸€ä¸ªstarter Spring Securityåº”ç”¨æœåŠ¡å™¨ JBosstomcatjettyWeblogicå·¥å…· git &amp; svnmaven &amp; gradle ä¸‰ã€ é«˜çº§ç¯‡æ–°æŠ€æœ¯ Java 8lambdaè¡¨è¾¾å¼ã€Stream APIã€ Java 9Jigsawã€Jshellã€Reactive Streams Java 10å±€éƒ¨å˜é‡ç±»åž‹æŽ¨æ–­ã€G1çš„å¹¶è¡ŒFull GCã€ThreadLocalæ¡æ‰‹æœºåˆ¶ Spring 5å“åº”å¼ç¼–ç¨‹ Spring Boot 2.0æ€§èƒ½ä¼˜åŒ– ä½¿ç”¨å•ä¾‹ã€ä½¿ç”¨Futureæ¨¡å¼ã€ä½¿ç”¨çº¿ç¨‹æ± ã€é€‰æ‹©å°±ç»ªã€å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ã€å‡å°‘é”ç²’åº¦ã€æ•°æ®åŽ‹ç¼©ã€ç»“æžœç¼“å­˜ çº¿ä¸Šé—®é¢˜åˆ†æž dumpèŽ·å–çº¿ç¨‹Dumpã€å†…å­˜Dumpã€gcæƒ…å†µ dumpåˆ†æžåˆ†æžæ­»é”ã€åˆ†æžå†…å­˜æ³„éœ² è‡ªå·±ç¼–å†™å„ç§outofmemoryï¼Œstackoverflowç¨‹åºHeapOutOfMemoryã€ Young OutOfMemoryã€MethodArea OutOfMemoryã€ConstantPool OutOfMemoryã€DirectMemory OutOfMemoryã€Stack OutOfMemory Stack OverFlow å¸¸è§é—®é¢˜è§£å†³æ€è·¯å†…å­˜æº¢å‡ºã€çº¿ç¨‹æ­»é”ã€ç±»åŠ è½½å†²çª ä½¿ç”¨å·¥å…·å°è¯•è§£å†³ä»¥ä¸‹é—®é¢˜ï¼Œå¹¶å†™ä¸‹æ€»ç»“å½“ä¸€ä¸ªJavaç¨‹åºå“åº”å¾ˆæ…¢æ—¶å¦‚ä½•æŸ¥æ‰¾é—®é¢˜ã€ å½“ä¸€ä¸ªJavaç¨‹åºé¢‘ç¹FullGCæ—¶å¦‚ä½•è§£å†³é—®é¢˜ã€ å¦‚ä½•æŸ¥çœ‹åžƒåœ¾å›žæ”¶æ—¥å¿—ã€ å½“ä¸€ä¸ªJavaåº”ç”¨å‘ç”ŸOutOfMemoryæ—¶è¯¥å¦‚ä½•è§£å†³ã€ å¦‚ä½•åˆ¤æ–­æ˜¯å¦å‡ºçŽ°æ­»é”ã€ å¦‚ä½•åˆ¤æ–­æ˜¯å¦å­˜åœ¨å†…å­˜æ³„éœ² ç¼–è¯‘åŽŸç†çŸ¥è¯† ç¼–è¯‘ä¸Žåç¼–è¯‘Javaä»£ç çš„ç¼–è¯‘ä¸Žåç¼–è¯‘Javaçš„åç¼–è¯‘å·¥å…·è¯æ³•åˆ†æžï¼Œè¯­æ³•åˆ†æžï¼ˆLLç®—æ³•ï¼Œé€’å½’ä¸‹é™ç®—æ³•ï¼ŒLRç®—æ³•ï¼‰ï¼Œè¯­ä¹‰åˆ†æžï¼Œè¿è¡Œæ—¶çŽ¯å¢ƒï¼Œä¸­é—´ä»£ç ï¼Œä»£ç ç”Ÿæˆï¼Œä»£ç ä¼˜åŒ–æ“ä½œç³»ç»ŸçŸ¥è¯†Linuxçš„å¸¸ç”¨å‘½ä»¤è¿›ç¨‹åŒæ­¥ç¼“å†²åŒºæº¢å‡ºåˆ†æ®µå’Œåˆ†é¡µè™šæ‹Ÿå†…å­˜ä¸Žä¸»å­˜æ•°æ®åº“çŸ¥è¯†MySql æ‰§è¡Œå¼•æ“ŽMySQL æ‰§è¡Œè®¡åˆ’å¦‚ä½•æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚ä½•æ ¹æ®æ‰§è¡Œè®¡åˆ’è¿›è¡ŒSQLä¼˜åŒ– SQLä¼˜åŒ–äº‹åŠ¡äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€äº‹åŠ¡èƒ½ä¸èƒ½å®žçŽ°é”çš„åŠŸèƒ½ æ•°æ®åº“é”è¡Œé”ã€è¡¨é”ã€ä½¿ç”¨æ•°æ®åº“é”å®žçŽ°ä¹è§‚é”ã€ æ•°æ®åº“ä¸»å¤‡æ­å»ºbinlogå†…å­˜æ•°æ®åº“h2 å¸¸ç”¨çš„nosqlæ•°æ®åº“redisã€memcached åˆ†åˆ«ä½¿ç”¨æ•°æ®åº“é”ã€NoSqlå®žçŽ°åˆ†å¸ƒå¼é”æ€§èƒ½è°ƒä¼˜æ•°æ®ç»“æž„ä¸Žç®—æ³•çŸ¥è¯† ç®€å•çš„æ•°æ®ç»“æž„æ ˆã€é˜Ÿåˆ—ã€é“¾è¡¨ã€æ•°ç»„ã€å“ˆå¸Œè¡¨ã€ æ ‘äºŒå‰æ ‘ã€å­—å…¸æ ‘ã€å¹³è¡¡æ ‘ã€æŽ’åºæ ‘ã€Bæ ‘ã€B+æ ‘ã€Ræ ‘ã€å¤šè·¯æ ‘ã€çº¢é»‘æ ‘ æŽ’åºç®—æ³•å„ç§æŽ’åºç®—æ³•å’Œæ—¶é—´å¤æ‚åº¦ æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆæœç´¢ å…¨æŽ’åˆ—ã€è´ªå¿ƒç®—æ³•ã€KMPç®—æ³•ã€hashç®—æ³•ã€æµ·é‡æ•°æ®å¤„ç† å¤§æ•°æ®çŸ¥è¯†ZookeeperåŸºæœ¬æ¦‚å¿µã€å¸¸è§ç”¨æ³• Solrï¼ŒLuceneï¼ŒElasticSearchåœ¨linuxä¸Šéƒ¨ç½²solrï¼Œsolrcloudï¼Œï¼Œæ–°å¢žã€åˆ é™¤ã€æŸ¥è¯¢ç´¢å¼• Stormï¼Œæµå¼è®¡ç®—ï¼Œäº†è§£Sparkï¼ŒS4åœ¨linuxä¸Šéƒ¨ç½²stormï¼Œç”¨zookeeperåšåè°ƒï¼Œè¿è¡Œstorm hello worldï¼Œlocalå’Œremoteæ¨¡å¼è¿è¡Œè°ƒè¯•storm topologyã€‚ Hadoopï¼Œç¦»çº¿è®¡ç®—HDFSã€MapReduce åˆ†å¸ƒå¼æ—¥å¿—æ”¶é›†flumeï¼Œkafkaï¼Œlogstashæ•°æ®æŒ–æŽ˜ï¼Œmahoutç½‘ç»œå®‰å…¨çŸ¥è¯†ä»€ä¹ˆæ˜¯XSSXSSçš„é˜²å¾¡ ä»€ä¹ˆæ˜¯CSRFä»€ä¹ˆæ˜¯æ³¨å…¥æ”»å‡»SQLæ³¨å…¥ã€XMLæ³¨å…¥ã€CRLFæ³¨å…¥ ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ æ¼æ´žåŠ å¯†ä¸Žè§£å¯†MD5ï¼ŒSHA1ã€DESã€AESã€RSAã€DSA ä»€ä¹ˆæ˜¯DOSæ”»å‡»å’ŒDDOSæ”»å‡»memcachedä¸ºä»€ä¹ˆå¯ä»¥å¯¼è‡´DDosæ”»å‡»ã€ä»€ä¹ˆæ˜¯åå°„åž‹DDoS SSLã€TLSï¼ŒHTTPSå¦‚ä½•é€šè¿‡Hashç¢°æ’žè¿›è¡ŒDOSæ”»å‡»ç”¨opensslç­¾ä¸€ä¸ªè¯ä¹¦éƒ¨ç½²åˆ°apacheæˆ–nginx å››ã€æž¶æž„ç¯‡åˆ†å¸ƒå¼ æ•°æ®ä¸€è‡´æ€§ã€æœåŠ¡æ²»ç†ã€æœåŠ¡é™çº§ åˆ†å¸ƒå¼äº‹åŠ¡2PCã€3PCã€CAPã€BASEã€ å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ã€æœ€å¤§åŠªåŠ›é€šçŸ¥ã€TCC DubboæœåŠ¡æ³¨å†Œã€æœåŠ¡å‘çŽ°ï¼ŒæœåŠ¡æ²»ç† åˆ†å¸ƒå¼æ•°æ®åº“æ€Žæ ·æ‰“é€ ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ã€ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†å¸ƒå¼æ•°æ®åº“ã€mycatã€otterã€HBase åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿmfsã€fastdfs åˆ†å¸ƒå¼ç¼“å­˜ç¼“å­˜ä¸€è‡´æ€§ã€ç¼“å­˜å‘½ä¸­çŽ‡ã€ç¼“å­˜å†—ä½™ å¾®æœåŠ¡ SOAã€åº·å¨å®šå¾‹ ServiceMeshDocker &amp; KubernetsSpring BootSpring Cloudé«˜å¹¶å‘ åˆ†åº“åˆ†è¡¨CDNæŠ€æœ¯æ¶ˆæ¯é˜Ÿåˆ—ActiveMQ ç›‘æŽ§ ç›‘æŽ§ä»€ä¹ˆCPUã€å†…å­˜ã€ç£ç›˜I/Oã€ç½‘ç»œI/Oç­‰ ç›‘æŽ§æ‰‹æ®µè¿›ç¨‹ç›‘æŽ§ã€è¯­ä¹‰ç›‘æŽ§ã€æœºå™¨èµ„æºç›‘æŽ§ã€æ•°æ®æ³¢åŠ¨ ç›‘æŽ§æ•°æ®é‡‡é›†æ—¥å¿—ã€åŸ‹ç‚¹ Dapperè´Ÿè½½å‡è¡¡ tomcatè´Ÿè½½å‡è¡¡ã€Nginxè´Ÿè½½å‡è¡¡ DNS DNSåŽŸç†ã€DNSçš„è®¾è®¡ CDN æ•°æ®ä¸€è‡´æ€§ äº”ã€ æ‰©å±•ç¯‡äº‘è®¡ç®— IaaSã€SaaSã€PaaSã€è™šæ‹ŸåŒ–æŠ€æœ¯ã€openstackã€Serverlsess æœç´¢å¼•æ“Ž Solrã€Luceneã€Nutchã€Elasticsearch æƒé™ç®¡ç† Shiro åŒºå—é“¾ å“ˆå¸Œç®—æ³•ã€Merkleæ ‘ã€å…¬é’¥å¯†ç ç®—æ³•ã€å…±è¯†ç®—æ³•ã€Raftåè®®ã€Paxos ç®—æ³•ä¸Ž Raft ç®—æ³•ã€æ‹œå åº­é—®é¢˜ä¸Žç®—æ³•ã€æ¶ˆæ¯è®¤è¯ç ä¸Žæ•°å­—ç­¾å æ¯”ç‰¹å¸æŒ–çŸ¿ã€å…±è¯†æœºåˆ¶ã€é—ªç”µç½‘ç»œã€ä¾§é“¾ã€çƒ­ç‚¹é—®é¢˜ã€åˆ†å‰ ä»¥å¤ªåŠè¶…çº§è´¦æœ¬äººå·¥æ™ºèƒ½ æ•°å­¦åŸºç¡€ã€æœºå™¨å­¦ä¹ ã€äººå·¥ç¥žç»ç½‘ç»œã€æ·±åº¦å­¦ä¹ ã€åº”ç”¨åœºæ™¯ã€‚ å¸¸ç”¨æ¡†æž¶TensorFlowã€DeepLearning4J å…¶ä»–è¯­è¨€ Groovyã€Pythonã€Goã€NodeJsã€Swiftã€Rust å…­ã€ æŽ¨èä¹¦ç± ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ ã€ŠEffective Javaã€‹ ã€Šæ·±å…¥åˆ†æžJava WebæŠ€æœ¯å†…å¹•ã€‹ ã€Šå¤§åž‹ç½‘ç«™æŠ€æœ¯æž¶æž„ã€‹ ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹ ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹ ã€Šmavenå®žæˆ˜ã€‹ ã€ŠåŒºå—é“¾åŽŸç†ã€è®¾è®¡ä¸Žåº”ç”¨ã€‹ ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®žæˆ˜ã€‹ ã€Šé¸Ÿå“¥çš„Linuxç§æˆ¿èœã€‹ ã€Šä»ŽPaxosåˆ°Zookeeperã€‹ ã€Šæž¶æž„å³æœªæ¥ã€‹]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[MySQLå¼€å‘è§„èŒƒ]]></title>
    <url>%2F2018%2F03%2F13%2FMySQL%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83%2F</url>
    <content type="text"><![CDATA[ä¸€. å‘½åè§„èŒƒ åº“åã€è¡¨åã€å­—æ®µåå¿…é¡»ä½¿ç”¨å°å†™å­—æ¯ï¼Œå¹¶é‡‡ç”¨ä¸‹åˆ’çº¿åˆ†å‰² ä¸ºäº†ç»Ÿä¸€è§„èŒƒï¼Œ åº“åã€è¡¨åã€å­—æ®µåä½¿ç”¨å°å†™å­—æ¯ï¼Œç¦ç”¨å…³é”®å­—ï¼ˆindex,orderç­‰ï¼‰ã€‚ å‰ç¼€å‘½ä»¤è§„èŒƒ è§†å›¾ä»¥view_å¼€å¤´ï¼Œäº‹ä»¶ä»¥event_å¼€å¤´ï¼Œè§¦å‘å™¨ä»¥trig_å¼€å¤´ï¼Œå­˜å‚¨è¿‡ç¨‹ä»¥proc_å¼€å¤´ï¼Œå‡½æ•°ä»¥func_å¼€å¤´ï¼Œåº”ç”¨ä¸Šé¢ç¦ç”¨ æ™®é€šç´¢å¼•ä»¥idx_å„ä¸ªåˆ—åç®€ç§°ï¼Œå”¯ä¸€ç´¢å¼•ä»¥uk_å„ä¸ªåˆ—åç®€ç§°å‘½åï¼Œä¸­é—´ç”¨_éš”å¼€ã€‚å¦‚ idx_col1_col2_col3(col1,col2,col3)ï¼Œå¦‚æžœåˆ—è¿‡é•¿ï¼Œç”¨ç®€å†™ ä¸´æ—¶è¡¨ä»¥tmp_å®žä½“è¡¨åï¼Œçº¿ä¸Šç¦ç”¨ï¼Œå¤‡ä»½è¡¨ä»¥bak_æ—¥æœŸ_å®žä½“è¡¨åï¼Œå°½å¯èƒ½å¤‡ä»½è‡³HDFS åº“åã€è¡¨åã€å­—æ®µåç¦æ­¢è¶…è¿‡32ä¸ªå­—ç¬¦ï¼Œéœ€è§åçŸ¥æ„åº“åã€è¡¨åã€å­—æ®µåæ”¯æŒæœ€å¤š32ä¸ªå­—ç¬¦ï¼Œä½†ä¸ºäº†ç»Ÿä¸€è§„èŒƒã€æ˜“äºŽè¾¨è¯†ä»¥åŠå‡å°‘ä¼ è¾“é‡ï¼Œç¦æ­¢è¶…è¿‡32ä¸ªå­—ç¬¦ï¼Œä¾‹ï¼šä¸šåŠ¡åç§°/å®žä½“_è¡¨ä½œç”¨ æŒ‰æ—¥æœŸæ—¶é—´åˆ†è¡¨é¡»ç¬¦åˆ_YYYYMMDDæ ¼å¼æŒ‰æœˆæˆ–æ—¥ç”Ÿæˆçš„è¡¨ï¼Œä»¥_YYYYMM[DD]æ–¹å¼å‘½åã€‚ äºŒ. åº“è¡¨åŸºç¡€è§„èŒƒ ä½¿ç”¨Innodbå­˜å‚¨å¼•æ“Žæ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨é»˜è®¤å­˜å‚¨å¼•æ“ŽInnoDBã€‚ è¡¨ç¼–ç æ–¹å¼ç»Ÿä¸€ä½¿ç”¨UTF8æˆ–UTF8MB4çš„åˆ›å»ºç´¢å¼•æ—¶utf8æ¯”utf8mb4å°‘ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æ˜Žç¡®æ²¡æœ‰emojæ—¶ï¼Œå°½é‡ä½¿ç”¨utf8ã€‚ æ‰€æœ‰è¡¨éƒ½è¦æ·»åŠ æ³¨é‡Šæ‰€æœ‰å­—æ®µå¿…éœ€è¦æœ‰æ³¨é‡Šï¼ŒåŒ…æ‹¬è¡¨æ³¨é‡Šï¼Œå¹¶æ ‡æ³¨ç®€å•æ„ä¹‰ æŽ§åˆ¶å•è¡¨å­—æ®µæ•°é‡ å•è¡¨å­—æ®µæ•°ä¸Šé™50å·¦å³ï¼Œå†å¤šçš„è¯è€ƒè™‘åž‚ç›´åˆ†è¡¨ï¼Œä¸€æ˜¯å†·çƒ­æ•°æ®åˆ†ç¦»ï¼ŒäºŒæ˜¯å¤§å­—æ®µåˆ†ç¦»ï¼Œä¸‰æ˜¯å¸¸åœ¨ä¸€èµ·åšæ¡ä»¶å’Œè¿”å›žåˆ—çš„ä¸åˆ†ç¦»ã€‚ è¡¨å­—æ®µæŽ§åˆ¶å°‘è€Œç²¾ï¼Œå¯ä»¥æé«˜IOæ•ˆçŽ‡ï¼Œå†…å­˜ç¼“å­˜æ›´å¤šæœ‰æ•ˆæ•°æ®ï¼Œä»Žè€Œæé«˜å“åº”é€Ÿåº¦å’Œå¹¶å‘èƒ½åŠ›ï¼ŒåŽç»­ alter table ä¹Ÿæ›´å¿«ã€‚ æ‰€æœ‰è¡¨éƒ½å¿…é¡»è¦æ˜¾å¼æŒ‡å®šä¸»é”® åŒæ´»çš„è¡¨å¿…é¡»ç¦ç”¨è‡ªå¢žä¸»é”®ã€snowflakeã€‘ï¼ŒInnoDBè¡¨å®žé™…æ˜¯ä¸€æ£µç´¢å¼•ç»„ç»‡è¡¨ï¼Œé¡ºåºå­˜å‚¨å¯ä»¥æé«˜å­˜å–æ•ˆçŽ‡ï¼Œå……åˆ†åˆ©ç”¨ç£ç›˜ç©ºé—´ã€‚è¿˜æœ‰å¯¹ä¸€äº›å¤æ‚æŸ¥è¯¢å¯èƒ½éœ€è¦è‡ªè¿žæŽ¥æ¥ä¼˜åŒ–æ—¶éœ€è¦ç”¨åˆ°ã€‚ éœ€è¦å…¨å±€å”¯ä¸€ä¸»é”®æ—¶ï¼Œgmt_createè¿™ç±»çš„èƒ½ä½¿ç”¨ä¸»é”®æŽ’åºçš„å°½é‡ä½¿ç”¨ä¸»é”®åšåˆ†é¡µæŽ’åºï¼Œä¸æµªè´¹ç´¢å¼• å°‘æ•°æƒ…å†µå¯ä»¥ä½¿ç”¨è”åˆå”¯ä¸€ä¸»é”®ï¼Œéœ€ä¸ŽDBAåå•† ä¸ä½¿ç”¨å¤–é”®å¤–é”®ä¸¥é‡å½±å“æ•°æ®åº“æ€§èƒ½ï¼Œå¢žåŠ è¡¨ç»´æŠ¤å¤æ‚åº¦ï¼Œæ‰€ä»¥çº¿ä¸Šç¦ç”¨å¤–é”® å­—æ®µåç§°ç»Ÿä¸€ æ¯å¼ è¡¨åŽŸåˆ™ä¸Šå¿…é¡»å«æœ‰gmt_create,gmt_modifyï¼Œgmt_createä¸ºåˆ›å»ºæ—¶é—´ã€‚gmt_modifyå±žæ€§ä¸ºNOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMPï¼Œgmt_createå±žæ€§ä¸ºNOT NULL DEFAULT CURRENT_TIMESTAMPï¼Œç»Ÿä¸€æ”¾è‡³å­—æ®µæœ€åŽ æ‰€æœ‰ç›¸åŒæ„ä¹‰çš„è¡¨é‡‡ç”¨ç»Ÿä¸€å­—æ®µåç§°ï¼Œå¹¶ä¸”å­—æ®µç±»åž‹ä¸€è‡´ï¼Œè¿™æ ·åº”ç”¨ä¸Žç»´æŠ¤äººå‘˜è§å­—æ®µçŸ¥å…¶å«ä¹‰ï¼Œæ–¹ä¾¿ç†è§£ ç®€å•å•è¡¨æ•°æ®é‡æŽ§åˆ¶åœ¨1000wä»¥å†… å°½é‡ä¿è¯å•è¡¨å­˜å‚¨ç©ºé—´å°äºŽ10GB å»ºè¡¨æ—¶ä¸è¦åŠ å…¥COLLATEç›¸å…³å†…å®¹ ä¸‰. å­—æ®µè§„èŒƒ charã€varcharã€textç­‰å­—ç¬¦ä¸²ç±»åž‹å®šä¹‰ å¯¹äºŽé•¿åº¦åŸºæœ¬å›ºå®šçš„åˆ—ï¼Œå¦‚æžœè¯¥åˆ—æ°å¥½æ›´æ–°åˆç‰¹åˆ«é¢‘ç¹ï¼Œé€‚åˆchar varcharè™½ç„¶å­˜å‚¨å˜é•¿å­—ç¬¦ä¸²ï¼Œä½†ä¸å¯å¤ªå°ä¹Ÿä¸å¯å¤ªå¤§ã€‚UTF8æœ€å¤šèƒ½å­˜21844ä¸ªæ±‰å­—ï¼Œæˆ–65532ä¸ªè‹±æ–‡ TEXTç±»åž‹ä¸ŽVARCHARéƒ½ç±»ä¼¼ï¼Œå­˜å‚¨å¯å˜é•¿åº¦ï¼Œæœ€å¤§é™åˆ¶ä¹Ÿæ˜¯2^16ï¼Œä½†æ˜¯å®ƒ20bytesä»¥åŽçš„å†…å®¹æ˜¯åœ¨æ•°æ®é¡µä»¥å¤–çš„ç©ºé—´å­˜å‚¨ï¼ˆrow_format=dynamicï¼‰ï¼Œå¯¹å®ƒçš„ä½¿ç”¨éœ€è¦å¤šä¸€æ¬¡å¯»å€ï¼Œæ²¡æœ‰é»˜è®¤å€¼ã€‚ æŠŠtext/blobæ‹†åˆ°å¦ä¸€ä¸ªè¡¨ä¸­ï¼Œå¦‚æžœåªå­˜ä¸è¯»çš„ç¦ç”¨ï¼Œå»ºè®®ç›´æŽ¥å­˜HDFS BLOBå¯ä»¥çœ‹å‡ºvarbinaryçš„æ‰©å±•ç‰ˆæœ¬ï¼Œå†…å®¹ä»¥äºŒè¿›åˆ¶å­—ç¬¦ä¸²å­˜å‚¨ï¼Œæ— å­—ç¬¦é›†ï¼ŒåŒºåˆ†å¤§å°å†™ï¼Œæœ‰ä¸€ç§ç»å¸¸æä½†ä¸ç”¨çš„åœºæ™¯ï¼šä¸è¦åœ¨æ•°æ®åº“é‡Œå­˜å‚¨å›¾ç‰‡ã€‚ å­—ç¬¦é›†ä¸ºutf8ï¼Œvarcharç±»åž‹æœ€å¤§åªèƒ½åˆ›å»ºç´¢å¼•ä¸ºå‰255å­—èŠ‚ï¼›å­—ç¬¦é›†ä¸ºutf8mb4ï¼Œvarcharç±»åž‹æœ€å¤§åªèƒ½åˆ›å»ºç´¢å¼•ä¸ºå‰191å­—èŠ‚ã€‚æ‰€ä»¥å­—æ®µé€ åž‹æ—¶é¦–é€‰intï¼Œå¦‚æžœvarcharæ—¶å­—æ®µåšæŸ¥è¯¢çš„è¶Šå°è¶Šå¥½ï¼Œé•¿åº¦ä¸è¦è¶…è¿‡191ã€‚ intã€tinyintã€decimalç­‰æ•°å­—ç±»åž‹å®šä¹‰ ä½¿ç”¨tinyintæ¥ä»£æ›¿ enumå’ŒbooleanENUMç±»åž‹åœ¨éœ€è¦ä¿®æ”¹æˆ–å¢žåŠ æžšä¸¾å€¼æ—¶ï¼Œéœ€è¦åœ¨çº¿DDLï¼Œæˆæœ¬è¾ƒé«˜ï¼›ENUMåˆ—å€¼å¦‚æžœå«æœ‰æ•°å­—ç±»åž‹ï¼Œå¯èƒ½ä¼šå¼•èµ·é»˜è®¤å€¼æ··æ·†tinyintä½¿ç”¨1ä¸ªå­—èŠ‚ï¼Œä¸€èˆ¬ç”¨äºŽstatus,type,flagçš„åˆ— å»ºè®®ä½¿ç”¨ UNSIGNED å­˜å‚¨éžè´Ÿæ•°å€¼ç›¸æ¯”ä¸ä½¿ç”¨ unsignedï¼Œå¯ä»¥æ‰©å¤§ä¸€å€ä½¿ç”¨æ•°å€¼èŒƒå›´ intä½¿ç”¨å›ºå®š4ä¸ªå­—èŠ‚å­˜å‚¨ï¼Œint(11)ä¸Žint(4)åªæ˜¯æ˜¾ç¤ºå®½åº¦çš„åŒºåˆ« ä½¿ç”¨intå­˜å‚¨IPv4åœ°å€ï¼Œå¯èŠ‚çœ 9%+çš„æ•°æ®å­˜å‚¨ç©ºé—´ ä½¿ç”¨Decimal ä»£æ›¿float/doubleå­˜å‚¨ç²¾ç¡®æµ®ç‚¹æ•°å¯¹äºŽè´§å¸ã€é‡‘é¢è¿™æ ·çš„ç±»åž‹ï¼Œå¯ä»¥ä½¿ç”¨ï¼ˆè´§å¸ä½¿ç”¨bigint+å¸ç§+æœ€å°å•ä½ï¼‰ï¼Œå¦‚æžœç²¾åº¦ä¸é«˜ï¼Œå¯ä»¥ä½¿ç”¨decimal(9,2)ã€‚floaté»˜è®¤åªèƒ½èƒ½ç²¾ç¡®åˆ°6ä½æœ‰æ•ˆæ•°å­— timestampä¸Ždatetimeé€‰æ‹© datetime å’Œ timestampç±»åž‹æ‰€å çš„å­˜å‚¨ç©ºé—´ä¸åŒï¼Œå‰è€…8ä¸ªå­—èŠ‚ï¼ŒåŽè€…4ä¸ªå­—èŠ‚ï¼Œè¿™æ ·é€ æˆçš„åŽæžœæ˜¯ä¸¤è€…èƒ½è¡¨ç¤ºçš„æ—¶é—´èŒƒå›´ä¸åŒã€‚å‰è€…èŒƒå›´ä¸º1000-01-01 00:00:00 ~ 9999-12-31 23:59:59ï¼ŒåŽè€…èŒƒå›´ä¸º 1970-01-01 00:00:00 åˆ° 2037-12-31 23:59:59ã€‚æ‰€ä»¥ TIMESTAMP æ”¯æŒçš„èŒƒå›´æ¯” DATATIME è¦å°ã€‚ timestampå¯ä»¥åœ¨insert/updateè¡Œæ—¶ï¼Œè‡ªåŠ¨æ›´æ–°æ—¶é—´å­—æ®µï¼ˆå¦‚ NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMPï¼‰ï¼Œä½†ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªè¿™æ ·çš„å®šä¹‰ã€‚ timestampæ˜¾ç¤ºä¸Žæ—¶åŒºæœ‰å…³ï¼Œå†…éƒ¨æ€»æ˜¯ä»¥ UTC æ¯«ç§’ æ¥å­˜çš„ã€‚è¿˜å—åˆ°ä¸¥æ ¼æ¨¡å¼çš„é™åˆ¶ ä¼˜å…ˆä½¿ç”¨timestampï¼Œdatetimeä¹Ÿæ²¡é—®é¢˜ï¼Œtimestampç²¾åº¦å¯ä»¥åˆ°ç§’åŽ6ä½ï¼Œå³timestamp(6) whereæ¡ä»¶é‡Œä¸è¦å¯¹æ—¶é—´åˆ—ä¸Šä½¿ç”¨æ—¶é—´å‡½æ•° å»ºè®®å­—æ®µéƒ½å®šä¹‰ä¸ºNOT NULLåŠ ä¸Šdefaultå€¼ å¦‚æžœæ˜¯ç´¢å¼•å­—æ®µï¼Œä¸€å®šè¦å®šä¹‰ä¸ºnot null ã€‚å› ä¸ºnullå€¼ä¼šå½±å“cordinateç»Ÿè®¡ï¼Œå½±å“ä¼˜åŒ–å™¨å¯¹ç´¢å¼•çš„é€‰æ‹© å¦‚æžœä¸èƒ½ä¿è¯insertæ—¶ä¸€å®šæœ‰å€¼è¿‡æ¥ï¼Œå®šä¹‰æ—¶ä½¿ç”¨default â€˜â€™ ï¼Œæˆ– 0 ä¸Šé¢ä¸¤æ¡å¦‚æžœéœ€è¦åŒæœºæˆ¿åŒæ­¥ï¼Œé‚£åŒæ­¥çš„è¡¨æ–°å¢žæˆ–æ›´æ”¹å¿…é¡»ä¸ºNULLï¼Œå†è¡Œåˆå§‹åŒ–æ•°æ® ç±»åž‹é€‰æ‹©åŽŸåˆ™Int-&gt;char-&gt;varchar-&gt;textï¼Œä»Žå·¦åˆ°å³æ€§èƒ½è¶Šå·® å››. ç´¢å¼•è§„èŒƒ ç´¢å¼•ä¸ªæ•°é™åˆ¶ ç´¢å¼•æ˜¯åŒåˆƒå‰‘ï¼Œä¼šå¢žåŠ ç»´æŠ¤è´Ÿæ‹…ï¼Œå¢žå¤§IOåŽ‹åŠ›ï¼Œç´¢å¼•å ç”¨ç©ºé—´æ˜¯æˆå€å¢žåŠ çš„ å•å¼ è¡¨çš„ç´¢å¼•æ•°é‡æŽ§åˆ¶åœ¨5ä¸ªä»¥å†…ï¼Œç´¢å¼•çš„å¤§å°å°½é‡æ¯”è¡¨å°ã€‚è‹¥å•å¼ è¡¨å¤šä¸ªå­—æ®µåœ¨æŸ¥è¯¢éœ€æ±‚ä¸Šéƒ½è¦å•ç‹¬ç”¨åˆ°ç´¢å¼•ï¼Œéœ€è¦ç»è¿‡DBAè¯„ä¼°ã€‚ é¿å…å†—ä½™ç´¢å¼• InnoDBè¡¨æ˜¯ä¸€æ£µç´¢å¼•ç»„ç»‡è¡¨ï¼Œä¸»é”®æ˜¯å’Œæ•°æ®æ”¾åœ¨ä¸€èµ·çš„èšé›†ç´¢å¼•ï¼Œæ™®é€šç´¢å¼•æœ€ç»ˆæŒ‡å‘çš„æ˜¯ä¸»é”®åœ°å€ï¼Œæ‰€ä»¥æŠŠä¸»é”®åšæœ€åŽä¸€åˆ—æ˜¯å¤šä½™çš„ã€‚å¦‚idä½œä¸ºä¸»é”®ï¼Œè”åˆç´¢å¼•(user_id,id)ä¸Šçš„idå°±å®Œå…¨å¤šä½™ (a,b,c)ã€(a,b)ï¼ŒåŽè€…ä¸ºå†—ä½™ç´¢å¼•ã€‚å¯ä»¥åˆ©ç”¨å‰ç¼€ç´¢å¼•æ¥è¾¾åˆ°åŠ é€Ÿç›®çš„ï¼Œå‡è½»ç»´æŠ¤è´Ÿæ‹… ç´¢å¼•åˆ›å»ºåŽŸåˆ™ å°½å¯èƒ½é€‰æ‹©è¿‡æ»¤æ•ˆæžœå¥½çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼• ç´¢å¼•é€‰æ‹©æ€§è®¡ç®—æ–¹æ³•ï¼ˆåŸºæ•° Ã· æ•°æ®è¡Œæ•°ï¼‰Selectivity = Cardinality / Total Rows = select count(distinct col1)/count(*) from tbnameï¼Œè¶ŠæŽ¥è¿‘1è¯´æ˜Žcol1ä¸Šä½¿ç”¨ç´¢å¼•çš„è¿‡æ»¤æ•ˆæžœè¶Šå¥½ å¦‚æžœæŸåˆ—ä¸ºsexï¼Œæ•°æ®å€¾æ–œæ¯”è¾ƒå¤§ï¼Œmaleå æ¯”99%ï¼Œfemaleå æ¯”1%ï¼Œè€Œæ¯æ¬¡æŸ¥è¯¢éƒ½ä¸ºfemaleï¼Œåˆ™éœ€è¦åˆ›å»ºè¯¥åˆ—çš„ç´¢å¼• æœ€å·¦å‰ç¼€åŽŸåˆ™ mysqlä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œä»Žå·¦å‘å³åŒ¹é…ï¼Œé‡åˆ°æ–­å¼€æˆ–è€…èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œæ— æ³•ç”¨åˆ°åŽç»­çš„ç´¢å¼•åˆ—æ¯”å¦‚ç´¢å¼•idx_c1c2c3 (c1,c2,c3)ï¼Œç›¸å½“äºŽåˆ›å»ºäº†(c1)ã€(c1,c2)ã€(c1,c2,c3)ä¸‰ä¸ªç´¢å¼•ï¼Œwhereæ¡ä»¶åŒ…å«ä¸Šé¢ä¸‰ç§æƒ…å†µçš„å­—æ®µæ¯”è¾ƒåˆ™å¯ä»¥ç”¨åˆ°ç´¢å¼•ï¼Œä½†åƒ where c1=a and c3=c åªèƒ½ç”¨åˆ°c1åˆ—çš„ç´¢å¼•ï¼Œåƒ c2=b and c3=cç­‰æƒ…å†µå°±å®Œå…¨ç”¨ä¸åˆ°è¿™ä¸ªç´¢å¼• é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€betweenã€like)ä¹Ÿä¼šåœæ­¢ç´¢å¼•åŒ¹é…ï¼Œæ¯”å¦‚ c1=a and c2 &gt; 2 and c3=cï¼Œåªæœ‰c1,c2åˆ—ä¸Šçš„æ¯”è¾ƒèƒ½ç”¨åˆ°ç´¢å¼•ï¼Œ(c1,c2,c3)æŽ’åˆ—çš„ç´¢å¼•æ‰å¯èƒ½ä¼šéƒ½ç”¨ä¸Š whereæ¡ä»¶é‡Œé¢å­—æ®µçš„é¡ºåºä¸Žç´¢å¼•é¡ºåºæ— å…³ï¼Œmysqlä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨è°ƒæ•´é¡ºåº mysqlçš„optimizer_switchï¼Œå¯ä»¥é…ç½®icpï¼Œmrrç­‰ç‰¹æ€§ã€‚mrrä¸ºå¤šä¸ªå­—æ®µåšåˆå¹¶ï¼Œå¦‚å·²å­˜åœ¨c1,c2,c3ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶c1=â€™aâ€™ and/or c2=â€™bâ€™ï¼Œåˆ™ä¼šä½¿ç”¨åˆ°ç´¢å¼•åˆå¹¶ï¼Œå¦‚æžœå¤§éƒ¨åˆ†æŸ¥è¯¢æ²¡æœ‰c1å’Œc2åŒæ—¶å­˜åœ¨ï¼Œåˆ™å»ºè®®åˆ›å»ºå•åˆ—ç´¢å¼• å‰ç¼€ç´¢å¼• å‰ç¼€ç´¢å¼•å°½é‡ç¬¬ä¸€åˆ—åŒºåˆ†åº¦é«˜ï¼Œè¿™æ ·å¦‚æžœä¼˜åŒ–å™¨åˆ¤æ–­æ—¶ä¼šæ¯”è¾ƒå‡†ç¡® ,Aåˆ—1000ä¸ªä¸åŒå€¼ï¼ŒBåˆ—æœ‰100000ä¸ªä¸åŒå€¼ï¼Œè¿™æ ·å»ºè®®ç´¢å¼•åˆ›å»ºæ—¶idx_B_A(B,A) åˆç†ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘IOINNODBå­˜å‚¨å¼•æ“Žä¸­ï¼Œsecondary index(éžä¸»é”®ç´¢å¼•ï¼Œåˆç§°ä¸ºè¾…åŠ©ç´¢å¼•ã€äºŒçº§ç´¢å¼•)æ²¡æœ‰ç›´æŽ¥å­˜å‚¨è¡Œåœ°å€ï¼Œè€Œæ˜¯å­˜å‚¨ä¸»é”®å€¼ã€‚å¦‚æžœç”¨æˆ·éœ€è¦æŸ¥è¯¢secondary indexä¸­æ‰€ä¸åŒ…å«çš„æ•°æ®åˆ—ï¼Œåˆ™éœ€è¦å…ˆé€šè¿‡secondary indexæŸ¥æ‰¾åˆ°ä¸»é”®å€¼ï¼Œç„¶åŽå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°å…¶ä»–æ•°æ®åˆ—ï¼Œå› æ­¤éœ€è¦æŸ¥è¯¢ä¸¤æ¬¡ã€‚è¦†ç›–ç´¢å¼•åˆ™å¯ä»¥åœ¨ä¸€ä¸ªç´¢å¼•ä¸­èŽ·å–æ‰€æœ‰éœ€è¦çš„æ•°æ®åˆ—ï¼Œä»Žè€Œé¿å…å›žè¡¨è¿›è¡ŒäºŒæ¬¡æŸ¥æ‰¾ï¼ŒèŠ‚çœIOå› æ­¤æ•ˆçŽ‡è¾ƒé«˜ã€‚ä¾‹å¦‚SELECT emailï¼Œuid FROM user_email WHERE uid=xxï¼Œå¦‚æžœuidä¸æ˜¯ä¸»é”®ï¼Œé€‚å½“æ—¶å€™å¯ä»¥å°†ç´¢å¼•æ·»åŠ ä¸ºindex(uidï¼Œemail)ï¼Œä»¥èŽ·å¾—æ€§èƒ½æå‡ã€‚ ä¸è¦åœ¨é¢‘ç¹æ›´æ–°çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼• äº”. SQLè®¾è®¡ æœç»ç›´æŽ¥ SELECT * è¯»å–å…¨éƒ¨å­—æ®µå³ä½¿éœ€è¦æ‰€æœ‰å­—æ®µï¼Œå‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—ï¼Œèƒ½æœ‰æ•ˆåˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼Œè¡¨ç»“æž„å˜æ›´å¯¹ç¨‹åºåŸºæœ¬æ— å½±å“ èƒ½ç¡®å®šè¿”å›žç»“æžœåªæœ‰ä¸€æ¡æ—¶ï¼Œä½¿ç”¨ limit 1åœ¨ä¿è¯æ•°æ®ä¸ä¼šæœ‰è¯¯çš„å‰æä¸‹ï¼Œèƒ½ç¡®å®šç»“æžœé›†æ•°é‡æ—¶ï¼Œå¤šä½¿ç”¨limitï¼Œå°½å¿«çš„è¿”å›žç»“æžœã€‚ å»ºè®®ä¸è¦ä½¿ç”¨éšå¼ç±»åž‹è½¬æ¢ ç¦æ­¢åœ¨whereæ¡ä»¶åˆ—ä¸Šä½¿ç”¨å‡½æ•° ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå¦‚lower(email)ï¼Œf_qq % 4ã€‚å¯æ”¾åˆ°å³è¾¹çš„å¸¸é‡ä¸Šè®¡ç®— è¿”å›žå°ç»“æžœé›†ä¸æ˜¯å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¹è¿”å›žåˆ—ä½¿ç”¨å‡½æ•°ï¼Œç®€åŒ–ç¨‹åºå¼€å‘ï¼Œä½†å°½é‡ä¸è¦ä½¿ç”¨å‡½æ•°ç´¢å¼• ä½¿ç”¨likeæ¨¡ç³ŠåŒ¹é…ï¼Œ%ä¸è¦æ”¾é¦–ä½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œæœ‰è¿™ç§æœç´¢éœ€æ±‚æ˜¯ï¼Œè€ƒè™‘å…¶å®ƒæ–¹æ¡ˆï¼Œå¦‚eså…¨æ–‡æœç´¢ ä½¿ç”¨joinæ—¶ï¼Œwhereæ¡ä»¶å°½é‡ä½¿ç”¨å……åˆ†åˆ©ç”¨åŒä¸€è¡¨ä¸Šçš„ç´¢å¼• å¦‚ select t1.a,t2.b * from t1,t2 where t1.a=t2.a and t1.b=123 and t2.c= 4 ï¼Œå¦‚æžœt1.cä¸Žt2.cå­—æ®µç›¸åŒï¼Œé‚£ä¹ˆt1ä¸Šçš„ç´¢å¼•(b,c)å°±åªç”¨åˆ°bäº†ã€‚æ­¤æ—¶å¦‚æžœæŠŠwhereæ¡ä»¶ä¸­çš„t2.c=4æ”¹æˆt1.c=4ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨åˆ°å®Œæ•´çš„ç´¢å¼• è¿™ç§æƒ…å†µå¯èƒ½ä¼šåœ¨å­—æ®µå†—ä½™è®¾è®¡ï¼ˆåèŒƒå¼ï¼‰æ—¶å‡ºçŽ° æ­£ç¡®é€‰å–inner joinå’Œleft join å°‘ç”¨æˆ–ä¸ç”¨å­æŸ¥è¯¢ï¼Œæ”¹ç”¨joinmysql 5.6ç‰ˆæœ¬åªæ”¯æŒnest loopï¼Œè®©mysqlè‡ªå·²åˆ¤æ–­éœ€è¦ä½¿ç”¨çš„ç´¢å¼• è€ƒè™‘ä½¿ç”¨union allï¼Œå°‘ä½¿ç”¨unionï¼Œæ³¨æ„è€ƒè™‘åŽ»é‡ union allä¸åŽ»é‡ï¼Œè€Œå°‘äº†æŽ’åºæ“ä½œï¼Œé€Ÿåº¦ç›¸å¯¹æ¯”unionè¦å¿«ï¼Œå¦‚æžœæ²¡æœ‰åŽ»é‡çš„éœ€æ±‚ï¼Œä¼˜å…ˆä½¿ç”¨union all å¦‚æžœUNIONç»“æžœä¸­æœ‰ä½¿ç”¨limitï¼Œåœ¨2ä¸ªå­SQLå¯èƒ½æœ‰è®¸å¤šè¿”å›žå€¼çš„æƒ…å†µä¸‹ï¼Œå„è‡ªåŠ ä¸Šlimitã€‚å¦‚æžœè¿˜æœ‰order byï¼Œè¯·æ‰¾DBAã€‚ INçš„å†…å®¹å°½é‡ä¸è¶…è¿‡200ä¸ªè¶…è¿‡200ä¸ªå€¼ä½¿ç”¨æ‰¹é‡çš„æ–¹å¼ï¼Œå¦åˆ™ä¸€æ¬¡æ‰§è¡Œä¼šå½±å“æ•°æ®åº“çš„å¹¶å‘èƒ½åŠ›ï¼Œå› ä¸ºå•SQLåªèƒ½ä¸”ä¸€ç›´å ç”¨å•CPUï¼Œè€Œä¸”å¯èƒ½å¯¼è‡´ä¸»ä»Žå¤åˆ¶å»¶è¿Ÿ æ‹’ç»å¤§äº‹åŠ¡æ¯”å¦‚åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œè¿›è¡Œå¤šä¸ªselectï¼Œå¤šä¸ªupdateï¼Œå¦‚æžœæ˜¯é«˜é¢‘äº‹åŠ¡ï¼Œä¼šä¸¥é‡å½±å“MySQLå¹¶å‘èƒ½åŠ›ï¼Œå› ä¸ºäº‹åŠ¡æŒæœ‰çš„é”ç­‰èµ„æºåªåœ¨äº‹åŠ¡rollback/commitæ—¶æ‰èƒ½é‡Šæ”¾ã€‚ä½†åŒæ—¶ä¹Ÿè¦æƒè¡¡æ•°æ®å†™å…¥çš„ä¸€è‡´æ€§ã€‚ é¿å…ä½¿ç”¨is null, is not nullè¿™æ ·çš„æ¯”è¾ƒ æœç»å±é™©SQL åŽ»æŽ‰where 1=1 è¿™æ ·æ— æ„ä¹‰æˆ–æ’çœŸçš„æ¡ä»¶ï¼Œå¦‚æžœé‡åˆ°update/deleteæˆ–é­åˆ°sqlæ³¨å…¥å°±ææ€–äº† SQLä¸­ä¸å…è®¸å‡ºçŽ°DDLè¯­å¥ã€‚ä¸€èˆ¬ä¹Ÿä¸ç»™äºˆcreate/alterè¿™ç±»æƒé™ ç¼–å†™SQL æ…Žç”¨åˆ†ç»„ã€èšåˆ â€‹ åœ¨ç¼–å†™SQLä¸­ï¼ŒåŽŸåˆ™ä¸Šä¸èƒ½ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼Œå°½å¯èƒ½å°†è¿™äº›é€»è¾‘äº¤ç”±åº”ç”¨å®žçŽ° â€‹ 1ã€group by having2ã€count/sum/avg etc.3ã€order by éžid4ã€3å¼ åŠ3å¼ ä»¥ä¸Šè¡¨åšåµŒå¥—5ã€left join/ right join6ã€select * from7ã€æ— whereæ¡ä»¶çš„æŸ¥è¯¢ ä½¿ç”¨å»ºè®® order by .. limitè¿™ç§æŸ¥è¯¢æ›´å¤šçš„æ˜¯é€šè¿‡ç´¢å¼•åŽ»ä¼˜åŒ–ï¼Œä½†order byçš„å­—æ®µæœ‰è®²ç©¶ï¼Œæ¯”å¦‚ä¸»é”®idä¸Žgmt_createéƒ½æ˜¯é¡ºåºé€’å¢žï¼Œé‚£å°±å¯ä»¥è€ƒè™‘order by idè€Œéž gmt_create ã€‚ c1 &lt; a order by c2ä¸Žä¸Šé¢ä¸åŒçš„æ˜¯ï¼Œorder byä¹‹å‰æœ‰ä¸ªèŒƒå›´æŸ¥è¯¢ï¼Œç”±å‰é¢çš„å†…å®¹å¯çŸ¥ï¼Œç”¨ä¸åˆ°ç±»ä¼¼(c1,c2)çš„ç´¢å¼•ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨(c2,c1)ç´¢å¼•ã€‚å¦å¤–è¿˜å¯ä»¥æ”¹å†™æˆjoinçš„æ–¹å¼å®žçŽ°ã€‚ åˆ†é¡µä¼˜åŒ–å»ºè®®ä½¿ç”¨åˆç†çš„åˆ†é¡µæ–¹å¼ä»¥æé«˜åˆ†é¡µæ•ˆçŽ‡ï¼Œå¤§é¡µæƒ…å†µä¸‹ä¸ä½¿ç”¨è·³è·ƒå¼åˆ†é¡µå‡å¦‚æœ‰ç±»ä¼¼ä¸‹é¢åˆ†é¡µè¯­å¥:SELECT FROM table1 ORDER BY ftime DESC LIMIT 10000,10;è¿™ç§åˆ†é¡µæ–¹å¼ä¼šå¯¼è‡´å¤§é‡çš„ioï¼Œå› ä¸ºMySQLä½¿ç”¨çš„æ˜¯æå‰è¯»å–ç­–ç•¥ã€‚æŽ¨èåˆ†é¡µæ–¹å¼ï¼šSELECT FROM table1 WHERE ftime &lt; last_time ORDER BY ftime DESC LIMIT 10å³ä¼ å…¥ä¸Šä¸€æ¬¡åˆ†é¡µçš„ç•Œå€¼ SELECT * FROM table as t1 inner JOIN (SELECT id FROM table ORDER BY time LIMIT 10000ï¼Œ10) as t2 ON t1.id=t2.id countè®¡æ•° é¦–å…ˆcount()ã€count(1)ã€count(col1)æ˜¯æœ‰åŒºåˆ«çš„ï¼Œcount()è¡¨ç¤ºæ•´ä¸ªç»“æžœé›†æœ‰å¤šå°‘æ¡è®°å½•ï¼Œcount(1)è¡¨ç¤ºç»“æžœé›†é‡Œä»¥primary keyç»Ÿè®¡æ•°é‡ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹count()ä¸Žcount(1)æ•ˆæžœä¸€æ ·çš„ï¼Œä½†count(col1)è¡¨ç¤ºçš„æ˜¯ç»“æžœé›†é‡Œ col1 åˆ— NOT null çš„è®°å½•æ•°ã€‚ä¼˜å…ˆé‡‡ç”¨count() å¤§æ•°æ®é‡countæ˜¯æ¶ˆè€—èµ„æºçš„æ“ä½œï¼Œç”šè‡³ä¼šæ‹–æ…¢æ•´ä¸ªåº“ï¼ŒæŸ¥è¯¢æ€§èƒ½é—®é¢˜æ— æ³•è§£å†³çš„ï¼Œåº”ä»Žäº§å“è®¾è®¡ä¸Šè¿›è¡Œé‡æž„ã€‚ä¾‹å¦‚å½“é¢‘ç¹éœ€è¦countçš„æŸ¥è¯¢ï¼Œè€ƒè™‘ä½¿ç”¨æ±‡æ€»è¡¨ é‡åˆ°distinctçš„æƒ…å†µï¼Œgroup byæ–¹å¼å¯èƒ½æ•ˆçŽ‡æ›´é«˜ã€‚ delete,updateè¯­å¥æ”¹æˆselectå†explain æ¶‰åŠåˆ°å¤æ‚sqlæ—¶ï¼ŒåŠ¡å¿…å…ˆå‚è€ƒå·²æœ‰ç´¢å¼•è®¾è®¡ï¼Œå…ˆexplain ç®€å•SQLæ‹†åˆ†ï¼Œä¸ä»¥ä»£ç å¤„ç†å¤æ‚ä¸ºç”±ã€‚ æ¯”å¦‚ OR æ¡ä»¶ï¼š f_phone=â€™10000â€™ or f_mobile=â€™10000â€™ï¼Œä¸¤ä¸ªå­—æ®µå„è‡ªæœ‰ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•åˆå¹¶ä½¿ç”¨ä¸¤ä¸ªç´¢å¼•ã€‚ä¸è¿‡å»ºè®®æ‹†åˆ†æˆ2ä¸ªsqlï¼Œæˆ–è€…union allï¼Œå¦‚æžœéžè¦ç”¨mysqlç´¢å¼•å®žçŽ°ï¼Œåˆ™éœ€è¦åˆ›å»ºä¸¤åˆ—å•åˆ—ç´¢å¼•ï¼Œæ‰“å¼€index_merge_unionåŽä¼šè½¬ä¹‰æˆunionã€‚ å…ˆexplainçš„å¥½å¤„æ˜¯å¯ä»¥ä¸ºäº†åˆ©ç”¨ç´¢å¼•ï¼Œå¢žåŠ æ›´å¤šæŸ¥è¯¢é™åˆ¶æ¡ä»¶ å‡å°‘ä¸Žæ•°æ®åº“äº¤äº’çš„æ¬¡æ•°ï¼Œå°½é‡é‡‡ç”¨æ‰¹é‡SQLè¯­å¥ INSERT ... ON DUPLICATE KEY UPDATE ...ï¼Œæ’å…¥è¡ŒåŽä¼šå¯¼è‡´åœ¨ä¸€ä¸ªUNIQUEç´¢å¼•æˆ–PRIMARY KEYä¸­å‡ºçŽ°é‡å¤å€¼ï¼Œåˆ™æ‰§è¡Œæ—§è¡ŒUPDATEï¼Œå¦‚æžœä¸é‡å¤åˆ™ç›´æŽ¥æ’å…¥ï¼Œå½±å“1è¡Œã€‚ REPLACE INTOç±»ä¼¼ï¼Œä½†å®ƒæ˜¯å†²çªæ—¶åˆ é™¤æ—§è¡Œã€‚INSERT IGNOREç›¸åï¼Œä¿ç•™æ—§è¡Œï¼Œä¸¢å¼ƒè¦æ’å…¥çš„æ–°è¡Œã€‚ INSERT INTO VALUES(),(),()ï¼Œåˆå¹¶æ’å…¥ã€‚ éšå¼ç±»åž‹ä½¿ç”¨æ³¨æ„äº‹é¡¹ ä¸¤ä¸ªå‚æ•°è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯ NULL æ—¶ï¼Œæ¯”è¾ƒçš„ç»“æžœä¹Ÿæ˜¯ NULLï¼Œä¾‹å¤–æ˜¯ä½¿ç”¨ &lt;=&gt; å¯¹ä¸¤ä¸ª NULL åšæ¯”è¾ƒæ—¶ä¼šè¿”å›ž 1ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½ä¸éœ€è¦åšç±»åž‹è½¬æ¢ ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šæŒ‰ç…§å­—ç¬¦ä¸²æ¥æ¯”è¾ƒï¼Œä¸åšç±»åž‹è½¬æ¢ ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯æ•´æ•°ï¼ŒæŒ‰ç…§æ•´æ•°æ¥æ¯”è¾ƒï¼Œä¸åšç±»åž‹è½¬æ¢ åå…­è¿›åˆ¶çš„å€¼å’Œéžæ•°å­—åšæ¯”è¾ƒæ—¶ï¼Œä¼šè¢«å½“åšäºŒè¿›åˆ¶ä¸² æœ‰ä¸€ä¸ªå‚æ•°æ˜¯ TIMESTAMP æˆ– DATETIMEï¼Œå¹¶ä¸”å¦å¤–ä¸€ä¸ªå‚æ•°æ˜¯å¸¸é‡ï¼Œå¸¸é‡ä¼šè¢«è½¬æ¢ä¸º timestamp æœ‰ä¸€ä¸ªå‚æ•°æ˜¯ decimal ç±»åž‹ï¼Œå¦‚æžœå¦å¤–ä¸€ä¸ªå‚æ•°æ˜¯ decimal æˆ–è€…æ•´æ•°ï¼Œä¼šå°†æ•´æ•°è½¬æ¢ä¸º decimal åŽè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æžœå¦å¤–ä¸€ä¸ªå‚æ•°æ˜¯æµ®ç‚¹æ•°ï¼Œåˆ™ä¼šæŠŠ decimal è½¬æ¢ä¸ºæµ®ç‚¹æ•°è¿›è¡Œæ¯”è¾ƒ æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªå‚æ•°éƒ½ä¼šè¢«è½¬æ¢ä¸ºæµ®ç‚¹æ•°å†è¿›è¡Œæ¯”è¾ƒã€‚ ä¾‹ï¼šAåˆ—ä¸ºintç±»åž‹æ—¶ï¼ŒA=â€™123â€™éšå¼è½¬æ¢åŽå¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼›Aä¸ºcharç±»åž‹æ—¶ï¼ŒA=123éšå¼è½¬æ¢åŽæ— æ³•ä½¿ç”¨ç´¢å¼• ä»»ä½•æ–°çš„select,update,deleteä¸Šçº¿ï¼Œå»ºè®®éƒ½è¦å…ˆexplainï¼Œçœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µå°½é‡é¿å…extraåˆ—å‡ºçŽ°ï¼šUsing File Sortï¼ŒUsing Temporaryï¼Œrowsè¶…è¿‡1000çš„è¦è°¨æ…Žä¸Šçº¿ã€‚explainè§£è¯» typeï¼šALL, index, range, ref, eq_ref, const, systemï¼ˆä»Žå·¦åˆ°å³ï¼Œæ€§èƒ½ä»Žå·®åˆ°å¥½ï¼‰ possible_keysï¼šæŒ‡å‡ºMySQLèƒ½ä½¿ç”¨å“ªä¸ªç´¢å¼•åœ¨è¡¨ä¸­æ‰¾åˆ°è®°å½•ï¼ŒæŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢ä½¿ç”¨ keyï¼šè¡¨ç¤ºMySQLå®žé™…å†³å®šä½¿ç”¨çš„é”®ï¼ˆç´¢å¼•ï¼‰å¦‚æžœæ²¡æœ‰é€‰æ‹©ç´¢å¼•ï¼Œé”®æ˜¯NULLã€‚è¦æƒ³å¼ºåˆ¶MySQLä½¿ç”¨æˆ–å¿½è§†possible_keysåˆ—ä¸­çš„ç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨FORCE INDEXã€USE INDEXæˆ–è€…IGNORE INDEX refï¼šè¡¨ç¤ºé€‰æ‹© key åˆ—ä¸Šçš„ç´¢å¼•ï¼Œå“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºŽæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ rowsï¼šæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œä¼°ç®—çš„æ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•° Extra``Using temporaryï¼šè¡¨ç¤ºMySQLéœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨æ¥å­˜å‚¨ç»“æžœé›†ï¼Œå¸¸è§äºŽæŽ’åºå’Œåˆ†ç»„æŸ¥è¯¢Using filesortï¼šMySQLä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æŽ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æŽ’åºâ€ æŸ¥è¯¢æ¡ä»¶ï¼ˆåŒ…æ‹¬DMLä¸­çš„æ¡ä»¶ï¼‰åŠæ¯ä¸ªæ¡ä»¶å æ¯”æ•°æ®é‡ï¼š where login_id=1 100%ä¸åŒå€¼ ç®—æ³•ï¼šcount(distinct login_id) / count(1) where user_name=1 and status=1 order by id desc limit 5 80%ä¸åŒå€¼ï¼Œç®—æ³•ï¼šcount(distinct user_name,status) / count(1) åŽŸåˆ™ä¸Šå¤§äºŽ20%ä»¥ä¸Šå°±è¦åˆ›å»ºä¸‹ç´¢å¼•]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[javaèŒƒåž‹ä½¿ç”¨å°ç»“]]></title>
    <url>%2F2018%2F03%2F08%2Fjava%E8%8C%83%E5%9E%8B%E9%80%9A%E9%85%8D%E7%AC%A6%2F</url>
    <content type="text"><![CDATA[èŒƒåž‹é€šé…ç¬¦ &lt;? extends Hero&gt; ArrayList heroList&lt;? extends Hero&gt; è¡¨ç¤ºåªèƒ½æ”¾å­ç±»æ‰€ä»¥ å¯ä»¥ç¡®å‡¿çš„æ˜¯ï¼Œä»ŽheroListå–å‡ºæ¥çš„å¯¹è±¡ï¼Œä¸€å®šæ˜¯å¯ä»¥è½¬åž‹æˆHeroçš„ &lt;? super Hero&gt; ArrayList heroList&lt;? super Hero&gt; è¡¨ç¤ºheroListçš„æ³›åž‹å¯èƒ½æ˜¯HeroheroListçš„æ³›åž‹å¯èƒ½æ˜¯Objectå¯ä»¥å¾€é‡Œé¢æ’å…¥Heroä»¥åŠHeroçš„å­ç±»ä½†æ˜¯å–å‡ºæ¥æœ‰é£Žé™©ï¼Œå› ä¸ºä¸ç¡®å®šå–å‡ºæ¥æ˜¯Heroè¿˜æ˜¯Object æ³›åž‹é€šé…ç¬¦? æ³›åž‹é€šé…ç¬¦? ä»£è¡¨ä»»æ„æ³›åž‹æ—¢ç„¶?ä»£è¡¨ä»»æ„æ³›åž‹ï¼Œé‚£ä¹ˆæ¢å¥è¯è¯´ï¼Œè¿™ä¸ªå®¹å™¨ä»€ä¹ˆæ³›åž‹éƒ½æœ‰å¯èƒ½æ‰€ä»¥åªèƒ½ä»¥Objectçš„å½¢å¼å–å‡ºæ¥å¹¶ä¸”ä¸èƒ½å¾€é‡Œé¢æ”¾å¯¹è±¡ï¼Œå› ä¸ºä¸çŸ¥é“åˆ°åº•æ˜¯ä¸€ä¸ªä»€ä¹ˆæ³›åž‹çš„å®¹å™¨ ä¸€ã€æ³›åž‹ç”±æ¥Javaè¯­è¨€ç±»åž‹åŒ…æ‹¬å…«ç§åŸºæœ¬ç±»åž‹(byte short int long float double boolean char)å’Œå¤æ‚ç±»åž‹ï¼Œå¤æ‚ç±»åž‹åŒ…æ‹¬ç±»å’Œæ•°ç»„ã€‚æ—©æœŸJavaç‰ˆæœ¬ï¼ˆ1.4ä¹‹å‰ï¼‰å¦‚æžœè¦ä»£æŒ‡æŸä¸ªæ³›åŒ–ç±»å¯¹è±¡ï¼Œåªèƒ½ä½¿ç”¨Objectï¼Œè¿™æ ·å†™å‡ºæ¥çš„ä»£ç éœ€è¦å¢žåŠ å¼ºè½¬ï¼Œè€Œä¸”ç¼ºå°‘ç±»åž‹æ£€æŸ¥ï¼Œä»£ç ç¼ºå°‘å¥å£®æ€§ã€‚åœ¨1.5ä¹‹åŽï¼ŒJavaå¼•å…¥äº†æ³›åž‹(Generic)çš„æ¦‚å¿µï¼Œæä¾›äº†ä¸€å¥—æŠ½è±¡çš„ç±»åž‹è¡¨ç¤ºæ–¹æ³•ã€‚åˆ©ç”¨æ³›åž‹ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š1ã€è¡¨ç¤ºå¤šä¸ªå¯å˜ç±»åž‹ä¹‹é—´çš„ç›¸äº’å…³ç³»ï¼šHashMapè¡¨ç¤ºç±»åž‹Tä¸ŽSçš„æ˜ å°„ï¼ŒHashMapè¡¨ç¤ºTçš„å­ç±»ä¸ŽTçš„æ˜ å°„å…³ç³» 2ã€ç»†åŒ–ç±»çš„èƒ½åŠ›ï¼šArrayList å¯ä»¥å®¹çº³ä»»ä½•æŒ‡å®šç±»åž‹Tçš„æ•°æ®ï¼Œå½“Tä»£æŒ‡äººï¼Œåˆ™æ˜¯äººçš„æœ‰åºåˆ—è¡¨ï¼Œå½“Tä»£æŒ‡æ¯å­ï¼Œåˆ™æ˜¯æ¯å­çš„æœ‰åºåˆ—è¡¨ï¼Œæ‰€æœ‰å¯¹è±¡ä¸ªä½“å¯ä»¥å…±ç”¨ç›¸åŒçš„æ“ä½œè¡Œä¸º 3ã€å¤æ‚ç±»åž‹è¢«ç»†åˆ†æˆæ›´å¤šç±»åž‹ï¼šListå’ŒListæ˜¯ä¸¤ç§ä¸åŒçš„ç±»åž‹ï¼Œè¿™æ„å‘³ç€List listP = new ArrayList()æ˜¯ä¸å¯ç¼–è¯‘çš„ã€‚åŽé¢ä¼šæåˆ°ï¼Œè¿™ç§æ£€æŸ¥åŸºäºŽç¼–è¯‘è€Œéžè¿è¡Œï¼Œæ‰€ä»¥è¯´æ˜¯ä¸å¯ç¼–è¯‘å¹¶éžä¸å¯è¿è¡Œï¼Œå› ä¸ºè¿è¡Œæ—¶ArrayListä¸ä¿ç•™Cupä¿¡æ¯ã€‚å¦å¤–è¦æ³¨æ„ï¼Œå³ä½¿Peopleç»§æ‰¿è‡ªObjectï¼ŒList listO = new ArrayList()ä¹Ÿæ˜¯ä¸å¯ç¼–è¯‘çš„ï¼Œåº”ç†è§£ä¸ºä¸¤ç§ä¸åŒç±»åž‹ã€‚å› ä¸ºlistOå¯ä»¥å®¹çº³ä»»æ„ç±»åž‹ï¼Œè€Œå®žä¾‹åŒ–çš„Peopleåˆ—è¡¨åªèƒ½æŽ¥æ”¶Peopleå®žä¾‹ï¼Œè¿™ä¼šç ´åæ•°æ®ç±»åž‹å®Œæ•´æ€§ã€‚ 4ã€ç®€åŒ–ä»£ç å®žçŽ°ï¼šå‡è®¾æœ‰ä¸€ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼Œå¯¹ä¸åŒç±»åž‹çš„æ•°æ®ï¼Œè¿›è¡ŒæŸäº›æµç¨‹ä¸€è‡´çš„å¤„ç†ï¼Œä¸å¼•å…¥æ³›åž‹çš„å®žçŽ°æ–¹æ³•ä¸ºï¼š[java] view plain copypublic void addToArray(Integer data, Integer array[], int pos) { array[pos] = data;}public void addToArray(Long data, Long array[], int pos) { array[pos] = data;}è¿™æ˜¯ä¸€ç§å…¸åž‹çš„å¤šæ€è¡Œä¸ºâ€”â€”é‡è½½ï¼Œä½†æ˜¯ä¸å¤Ÿç®€åŒ–ã€‚å¼•å…¥æ³›åž‹çš„å†™æ³•æ›´ä¼˜é›…ï¼š[java] view plain copypublic void addToArray(T data, T array[], int pos) { array[pos] = data;} äºŒã€æ³›åž‹å®šä¹‰ä¸Žä½¿ç”¨ï¼ˆæ³›åž‹ç±»å’Œæ³›åž‹æ–¹æ³•ï¼‰1ã€æ³›åž‹å‚æ•°çš„å‘½åé£Žæ ¼ï¼š1ï¼‰å°½é‡ç”¨ç®€ä¾¿çš„å‘½åæ¥å‘½åæ³›åž‹ï¼Œè‹¥ç±»åž‹æ— ç‰¹å®šæ„ä¹‰ï¼Œå°½é‡ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦2ï¼‰å°½é‡ä½¿ç”¨å…¨å¤§å†™æ¥å‘½åæ³›åž‹å½¢å‚ï¼Œä»¥æ­¤ä¸Žå…¶ä»–ç±»åž‹åŒºåˆ†å¼€3ï¼‰å•å­—æ¯çš„æ³›åž‹å»ºè®®ç”¨Tå‘½åï¼Œå¦‚æžœæœ‰å¤šä¸ªæ³›åž‹ï¼Œå¯ä»¥å–Tå‘¨å›´çš„å¤§å†™å­—æ¯ï¼Œæ³¨æ„ï¼Œå¦‚æžœæ³›åž‹æœ¬èº«æœ‰æ„ä¹‰ï¼Œå¯ä»¥ä¸éµå®ˆè¿™ä¸€æ¡ï¼Œæ¯”å¦‚ç¼“å­˜ç®¡ç†CacheManagerï¼Œè¯¥ç±»è´Ÿè´£ç®¡ç†ç¼“å­˜æŸ¥è¯¢æ¡ä»¶ä¸Žæ•°æ®çš„æ˜ å°„ï¼Œç”¨å•å­—æ¯å°±ä¸å¤ªåˆé€‚ï¼Œä½¿ç”¨å¤šå­—æ¯æ›´å¥½4ï¼‰å¯¹äºŽæ³›åž‹å‡½æ•°æˆ–è€…æ³›åž‹å†…éƒ¨ç±»åœ¨æŸä¸ªæ³›åž‹ç±»ä¸­å‡ºçŽ°çš„æƒ…å†µï¼Œå»ºè®®æ³›åž‹å‡½æ•°å’Œå†…éƒ¨ç±»çš„æ³›åž‹å½¢å‚åç§°ä¸Žå¤–å±‚ç±»çš„æ³›åž‹åç§°ä¿æŒä¸åŒï¼Œå¦åˆ™å®¹æ˜“å¼•èµ·æ··æ·†ã€‚ç±»ä¼¼è¿™ç§ï¼š[java] view plain copypublic class GenericClass { public void testGenericMethod(T t) { }} å…¶å®žtestGenericMethodæ–¹æ³•çš„å½¢å‚ä¸Žå¤–é¢GenericClassçš„å½¢å‚å®Œå…¨æ²¡æœ‰å…³ç³»ã€‚æ¢å¥è¯è¯´ï¼Œæ³›åž‹æ–¹æ³•çš„æ³›åž‹æ˜¯ä¼˜å…ˆä½¿ç”¨æ–¹æ³•æ³›åž‹å®šä¹‰çš„ã€‚è¿™ç§æ›´åº”è¯¥å†™æˆï¼š[java] view plain copypublic class GenericClass { public void testGenericMethod(S s) { }} 2ã€æ³›åž‹å­˜åœ¨ä¸¤ç§ç”¨æ³•ï¼šæ³›åž‹ç±»å’Œæ³›åž‹æ–¹æ³• 1ï¼‰æ³›åž‹ç±»å®šä¹‰æ³›åž‹ç±»æ—¶ï¼Œåœ¨ç±»ååŽåŠ &lt;&gt;ï¼Œå°–æ‹¬å·å†…å¯ä»¥å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæ³›åž‹å‚æ•°ï¼Œå¹¶æŒ‡å®šæ³›åž‹å‚æ•°çš„å–å€¼èŒƒå›´ï¼Œå¤šä¸ªå‚æ•°ç”¨é€—å·(,)åˆ†å‰²æ³›åž‹ç±»ä¸­å®šä¹‰çš„æ³›åž‹å…¨ç±»å¯ç”¨ï¼ˆé™æ€æ–¹æ³•ã€é™æ€ä»£ç å—ã€é™æ€æˆå‘˜å˜é‡é™¤å¤–ï¼‰çˆ¶ç±»å®šä¹‰çš„æ³›åž‹å‚æ•°å­ç±»æ— æ³•ç»§æ‰¿ï¼Œæ‰€ä»¥å­ç±»å¾—è‡ªå·±å†™[java] view plain copypublic class GenericClass { T data; void setData(T t) { data = t; } T getData() { return data; }} 2ï¼‰æ³›åž‹æ–¹æ³•å®šä¹‰æ³›åž‹æ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¿®é¥°ç¬¦åŽï¼Œè¿”å›žå‚æ•°å‰åŠ ä¸Š&lt;&gt;ï¼Œå°–æ‹¬å·å†…å¯ä»¥å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæ³›åž‹å‚æ•°ï¼Œå¹¶æŒ‡å®šæ³›åž‹å‚æ•°å–å€¼èŒƒå›´ï¼Œå¤šä¸ªå‚æ•°ç”¨é€—å·(,)åˆ†å‰²æ³›åž‹æ–¹æ³•ä¸­å®šä¹‰çš„æ³›åž‹ä½œç”¨åŸŸåœ¨æ–¹æ³•å†…[java] view plain copypublic class GenericMethodClass { public T setData(T t, S s) { //do something return t; }} å®šä¹‰æ³›åž‹æ–¹æ³•ï¼Œæ›´å¤šæ˜¯ä¸ºäº†è¡¨è¾¾è¿”å›žå€¼å’Œæ–¹æ³•å½¢å‚é—´çš„å…³ç³»ï¼Œæœ¬ä¾‹ä¸­æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°Tç»§æ‰¿AClassï¼Œç¬¬äºŒä¸ªå‚æ•°Sç»§æ‰¿Tï¼Œè¿”å›žå€¼æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ã€‚å¦‚æžœä»…ä»…æ˜¯ä¸ºäº†å®žçŽ°äº†å¤šæ€ï¼Œåº”ä¼˜å…ˆä½¿ç”¨é€šé…ç¬¦ã€‚ç±»ä¼¼å¦‚ä¸‹ï¼š[java] view plain copypublic void addList(List&lt;?&gt; list) { //todo} 3ã€å®šä¹‰äº†å¤šä¸ªæ³›åž‹ç±»åž‹å‚æ•°æ—¶ï¼Œä¸€å®šè¦åœ¨ä½¿ç”¨æ—¶éƒ½æŒ‡å®šç±»åž‹ï¼Œå¦åˆ™ä¼šç¼–è¯‘å‡ºé”™ã€‚ 4ã€å¯¹æ³›åž‹ç±»çš„ç±»åž‹å‚æ•°èµ‹å€¼åŒ…å«ä¸¤ç§æ–¹æ³•ï¼š1ï¼‰ç±»å˜é‡æˆ–å®žä¾‹åŒ–ï¼šList listS;listS = new ArrayList(); 2ï¼‰ç»§æ‰¿public class MyList extends ArrayList implements IMyInterface {}Sæ˜¯å¯¹ArrayListå†…éƒ¨å®šä¹‰çš„æ³›åž‹Eçš„èµ‹å€¼ã€‚ 5ã€å¯¹æ³›åž‹æ–¹æ³•çš„èµ‹å€¼ï¼š[java] view plain copypublic T testMethod1(T t, List list) {} public T testMethod2(List list1, List list2){} People n = null; List list1 = null;testMethod1(n, list1);//æ­¤æ—¶æ³›åž‹å‚æ•°Tä¸ºPeople List list2 = null;testMethod2(list1, list2);//ç¼–è¯‘æŠ¥é”™ ä¸‰ã€é€šé…ç¬¦1ï¼‰ä¸Šè¿°æ³›åž‹èµ‹å€¼éƒ½æ˜¯èµ‹äºˆæ³›åž‹å‚æ•°ç¡®å®šå€¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥èµ‹äºˆæ³›åž‹å‚æ•°ä¸ç¡®å®šå€¼ï¼Œä¹Ÿå°±æ˜¯é€šé…ç¬¦?ã€‚ä½¿ç”¨é€šé…ç¬¦?è¡¨ç¤ºä¸€ä¸ªæœªçŸ¥çš„ç±»åž‹ã€‚ç±»ä¼¼å¦‚ä¸‹ï¼šList&lt;?&gt; list;å­˜æ”¾ä»»æ„çš„å¯¹è±¡List&lt;? extends AClass&gt; listSubAClass; //å­˜æ”¾AClassçš„å­ç±»List&lt;? extends BClass&gt; listSuperBClass; //å­˜æ”¾BClassçš„çˆ¶ç±» 2ï¼‰é€šé…ç¬¦é€šå¸¸ä¸Žæ³›åž‹å…³é”®å­—ä¸€èµ·ä½¿ç”¨ã€‚ 3ï¼‰åœ¨Javaé›†åˆæ¡†æž¶ä¸­ï¼Œå¯¹äºŽæœªçŸ¥ç±»åž‹çš„å®¹å™¨ç±»ï¼Œåªèƒ½è¯»å–å…¶ä¸­å…ƒç´ ï¼Œä¸èƒ½æ·»åŠ å…ƒç´ ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹ä¸ç¡®å®šçš„å‚æ•°ç±»åž‹ï¼Œç¼–è¯‘å™¨æ— æ³•è¯†åˆ«æ·»åŠ å…ƒç´ çš„ç±»åž‹å’Œå®¹å™¨çš„ç±»åž‹æ˜¯å¦å…¼å®¹ï¼Œå”¯ä¸€çš„ä¾‹å¤–æ˜¯NULLã€‚åŒæ—¶ï¼Œå…¶è¯»å–çš„å…ƒç´ åªèƒ½ç”¨Objectæ¥å­˜å‚¨ã€‚ 4ï¼‰é€šé…ç¬¦ä¸èƒ½ç”¨åœ¨æ³›åž‹ç±»å’Œæ³›åž‹æ–¹æ³•å£°æ˜Žä¸­ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š[java] view plain copypublic class GenericClass&lt;?&gt; { //ç¼–è¯‘é”™è¯¯ public &lt;?&gt; void testGenericMethod(? t) { //ç¼–è¯‘é”™è¯¯ }} å››ã€æ³›åž‹å…³é”®å­—1ã€æ³›åž‹å…³é”®å­—æœ‰äºŒä¸ª extendså’Œsuperï¼Œåˆ†åˆ«è¡¨ç¤ºç±»åž‹ä¸Šç•Œå’Œç±»åž‹ä¸‹ç•ŒT extends AClass è¡¨ç¤ºTç»§æ‰¿è‡ªAClassç±»? super AClass è¡¨ç¤º?æ˜¯AClassçš„çˆ¶ç±»ï¼Œæ³¨æ„ï¼šsuperåªèƒ½ä¸Žé€šé…ç¬¦?æ­é…ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¸èƒ½å†™ï¼špublic class GenericClass { //é”™è¯¯}æ­¤ä¾‹å­ä¸­superæ¢æˆextendsæ˜¯æ­£ç¡®çš„ï¼Œè¡¨ç¤ºæ³›åž‹Tç»§æ‰¿è‡ªAClassï¼ŒTæ¢æˆé€šé…ç¬¦?ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¡¨ç¤ºæœªçŸ¥ç±»åž‹çš„ä¸‹ç•Œæ˜¯AClassã€‚ 2ã€é€šé…ç¬¦ä¸Žæ³›åž‹å…³é”®å­—ç»„åˆä½¿ç”¨ ä¸¾ä¸¤ä¸ªä¾‹å­ï¼šä¸‹ç•Œï¼š[java] view plain copyList&lt;? super People&gt; list = new ArrayList&lt;&gt;();People people = new People();list.add(people);People data= list.get(0 ); //ç¼–è¯‘å‡ºé”™ï¼ŒæŠ¥é”™Objectä¸èƒ½è½¬ä¸ºPeople ä¸Šç•Œï¼š[java] view plain copyList&lt;? extends People&gt; list = new ArrayList&lt;&gt;();People people = new People();list.add(people);// ç¼–è¯‘å‡ºé”™ï¼Œä¸èƒ½å‘å®¹å™¨ä¸­æ·»åŠ ç¡®å®šçš„å…ƒç´ People data= list.get( 0); æ€»ç»“å°±æ˜¯ï¼šä¸Šç•Œæ·»åŠ (add)å—é™ï¼Œä¸‹ç•ŒæŸ¥è¯¢(get)å—é™ äº”ã€æ³›åž‹å®žçŽ°åŽŸç†1ã€Javaæ³›åž‹æ˜¯ç¼–è¯‘æ—¶æŠ€æœ¯ï¼Œåœ¨è¿è¡Œæ—¶ä¸åŒ…å«ç±»åž‹ä¿¡æ¯ï¼Œä»…å…¶å®žä¾‹ä¸­åŒ…å«ç±»åž‹å‚æ•°çš„å®šä¹‰ä¿¡æ¯ã€‚2ã€Javaåˆ©ç”¨ç¼–è¯‘å™¨æ“¦é™¤ï¼ˆerasureï¼Œå‰ç«¯å¤„ç†ï¼‰å®žçŽ°æ³›åž‹ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æ³›åž‹ç‰ˆæœ¬æºç åˆ°éžæ³›åž‹ç‰ˆæœ¬æºç çš„è½¬åŒ–ã€‚3ã€æ“¦é™¤åŽ»æŽ‰äº†æ‰€æœ‰çš„æ³›åž‹ç±»å†…æ‰€æœ‰çš„æ³›åž‹ç±»åž‹ä¿¡æ¯ï¼Œæ‰€æœ‰åœ¨å°–æ‹¬å·ä¹‹é—´çš„ç±»åž‹ä¿¡æ¯éƒ½è¢«æ‰”æŽ‰.ä¸¾ä¾‹æ¥è¯´ï¼šListç±»åž‹è¢«è½¬æ¢ä¸ºListï¼Œæ‰€æœ‰å¯¹ç±»åž‹å˜é‡Stringçš„å¼•ç”¨è¢«æ›¿æ¢æˆç±»åž‹å˜é‡çš„ä¸Šé™(é€šå¸¸æ˜¯Object)ã€‚è€Œä¸”ï¼Œæ— è®ºä½•æ—¶ç»“æžœä»£ç ç±»åž‹ä¸æ­£ç¡®ï¼Œä¼šæ’å…¥ä¸€ä¸ªåˆ°åˆé€‚ç±»åž‹çš„è½¬æ¢ã€‚[java] view plain copy T badCast(T t, Object o) {return (T) o; // unchecked warning}è¿™è¯´æ˜ŽStringç±»åž‹å‚æ•°åœ¨Listè¿è¡Œæ—¶å¹¶ä¸å­˜åœ¨ã€‚å®ƒä»¬ä¹Ÿå°±ä¸ä¼šæ·»åŠ ä»»ä½•çš„æ—¶é—´æˆ–è€…ç©ºé—´ä¸Šçš„è´Ÿæ‹…ã€‚ä½†åŒæ—¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€ä½ ä¸èƒ½ä¾é ä»–ä»¬è¿›è¡Œç±»åž‹è½¬æ¢ã€‚ 4ã€ä¸€ä¸ªæ³›åž‹ç±»è¢«å…¶æ‰€æœ‰è°ƒç”¨å…±äº«å¯¹äºŽä¸Šæ–‡ä¸­çš„GenericClassï¼Œåœ¨ç¼–è¯‘åŽå…¶å†…éƒ¨æ˜¯ä¸å­˜å…¥æ³›åž‹ä¿¡æ¯çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š[java] view plain copyGenericClass gclassA = new GenericClass();GenericClass gclassB = new GenericClass();gClassA.getClass() == gClassB.getClass()è¿™ä¸ªåˆ¤æ–­è¿”å›žçš„å€¼æ˜¯trueï¼Œè€Œéžfalseï¼Œå› ä¸ºä¸€ä¸ªæ³›åž‹ç±»æ‰€æœ‰å®žä¾‹è¿è¡Œæ—¶å…·æœ‰ç›¸åŒçš„è¿è¡Œæ—¶ç±»ï¼Œå…¶å®žé™…ç±»åž‹å‚æ•°è¢«æ“¦é™¤äº†ã€‚ é‚£ä¹ˆæ˜¯ä¸æ˜¯GenericClassé‡Œå®Œå…¨ä¸å­˜AClassçš„ä¿¡æ¯å‘¢ï¼Ÿè¿™ä¸ªä¹Ÿä¸æ˜¯ï¼Œå®ƒå†…éƒ¨å­˜å‚¨çš„æ˜¯æ³›åž‹å‘ä¸Šçˆ¶ç±»çš„å¼•ç”¨ï¼Œæ¯”å¦‚ï¼šGenericClass, å…¶ç¼–è¯‘åŽå†…éƒ¨å­˜å‚¨çš„æ³›åž‹æ›¿ä»£æ˜¯Charsequenceï¼Œè€Œä¸æ˜¯Objectã€‚ é‚£ä¹ˆæˆ‘ä»¬ç¼–ç æ—¶çš„æ³›åž‹çš„ç±»åž‹åˆ¤æ–­æ˜¯æ€Žä¹ˆå®žçŽ°çš„å‘¢ï¼Ÿå…¶å®žè¿™ä¸ªè¿‡ç¨‹æ˜¯ç¼–è¯‘æ—¶æ£€æŸ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é™åˆ¶gClassA.add(new BClass()) è¿™æ ·çš„ä½¿ç”¨çš„æ–¹å¼çš„ä¸»ä½“ï¼Œä¸æ˜¯è¿è¡Œæ—¶ä»£ç ï¼Œè€Œæ˜¯ç¼–è¯‘æ—¶ç›‘æµ‹ã€‚ æ³›åž‹çš„æ„ä¹‰å°±åœ¨äºŽï¼Œå¯¹æ‰€æœ‰å…¶æ”¯æŒçš„ç±»åž‹å‚æ•°ï¼Œæœ‰ç›¸åŒçš„è¡Œä¸ºï¼Œä»Žè€Œå¯ä»¥è¢«å½“ä½œä¸åŒç±»åž‹ä½¿ç”¨ï¼›ç±»çš„é™æ€å˜é‡å’Œæ–¹æ³•åœ¨æ‰€æœ‰å®žä¾‹é—´å…±äº«ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨æ³›åž‹ã€‚ 5ã€æ³›åž‹ä¸Žinstanceofæ³›åž‹æ“¦é™¤äº†ç±»åž‹ä¿¡æ¯ï¼Œæ‰€ä»¥ä½¿ç”¨instanceofæ£€æŸ¥æŸä¸ªå®žä¾‹æ˜¯å¦æ˜¯ç‰¹å®šç±»åž‹çš„æ³›åž‹ç±»æ˜¯ä¸å¯è¡Œçš„ï¼šGenericClass genericClass = new GenericClass();if (genericClass instanceof GenericClass) {} // ç¼–è¯‘é”™è¯¯ åŒæ—¶ï¼šGenericClass class1 = (GenericClass) genericClassï¼› //ä¼šæŠ¥è­¦å‘Š å…­ã€Classä¸Žæ³›åž‹ï¼ˆæ‘˜è‡ªç½‘ç»œï¼‰ä»ŽJava1.5åŽClassç±»å°±æ”¹ä¸ºäº†æ³›åž‹å®žçŽ°ï¼ŒClassç±»å†…å®šä¹‰çš„æ³›åž‹TæŒ‡çš„æ˜¯Classå¯¹è±¡ä»£è¡¨çš„ç±»åž‹ã€‚æ¯”å¦‚è¯´String.classç±»åž‹ä»£è¡¨Classï¼ŒPeople.classç±»åž‹ä»£è¡¨Classã€‚ä¸»è¦ç”¨äºŽæé«˜åå°„ä»£ç çš„ç±»åž‹å®‰å…¨ã€‚ Classç±»çš„newInstanceè¿”å›žæ³›åž‹Tçš„å¯¹è±¡ï¼Œæ•…è€Œå¯ä»¥åœ¨åå°„æ—¶åˆ›å»ºæ›´ç²¾ç¡®çš„ç±»åž‹ã€‚ä¸¾ä¾‹æ¥è¯´ï¼šå‡å®šä½ è¦å†™ä¸€ä¸ªå·¥å…·æ–¹æ³•æ¥è¿›è¡Œä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢ï¼Œç»™å®šä¸€ä¸ªSQLè¯­å¥ï¼Œå¹¶è¿”å›žä¸€ä¸ªæ•°æ®åº“ä¸­ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„å¯¹è±¡é›†åˆ(collection)ã€‚ä¸€ä¸ªæ–¹æ³•æ˜¯æ˜¾å¼çš„ä¼ é€’ä¸€ä¸ªå·¥åŽ‚å¯¹è±¡ï¼Œåƒä¸‹é¢çš„ä»£ç ï¼š[java] view plain copyinterface Factory { public T[] make();}public Collection select(Factory factory, String statement) { Collection result = new ArrayList(); / run sql query using jdbc / for ( int i=0; i&lt;10; i++ ) { / iterate over jdbc results / T item = factory.make(); / use reflection and set all of itemâ€™s fields from sql results / result.add( item ); } return result;} ä½ å¯ä»¥è¿™æ ·è°ƒç”¨ï¼š[java] view plain copyselect(new Factory() { public EmpInfo make() { return new EmpInfo(); } } , â€selection stringâ€);ä¹Ÿå¯ä»¥å£°æ˜Žä¸€ä¸ªç±» EmpInfoFactory æ¥æ”¯æŒæŽ¥å£ Factoryï¼š[java] view plain copyclass EmpInfoFactory implements Factory { â€¦ public EmpInfo make() { return new EmpInfo(); }}ç„¶åŽè°ƒç”¨ï¼š[java] view plain copyselect(getMyEmpInfoFactory(), â€œselection stringâ€); è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„ç¼ºç‚¹æ˜¯å®ƒéœ€è¦ä¸‹é¢çš„äºŒè€…ä¹‹ä¸€ï¼šè°ƒç”¨å¤„é‚£å†—é•¿çš„åŒ¿åå·¥åŽ‚ç±»ï¼Œæˆ–ä¸ºæ¯ä¸ªè¦ä½¿ç”¨çš„ç±»åž‹å£°æ˜Žä¸€ä¸ªå·¥åŽ‚ç±»å¹¶ä¼ é€’å…¶å¯¹è±¡ç»™è°ƒç”¨çš„åœ°æ–¹è¿™å¾ˆä¸è‡ªç„¶ã€‚ä½¿ç”¨classç±»åž‹å‚æ•°å€¼æ˜¯éžå¸¸è‡ªç„¶çš„ï¼Œå®ƒå¯ä»¥è¢«åå°„ä½¿ç”¨ã€‚æ²¡æœ‰æ³›åž‹çš„ä»£ç å¯èƒ½æ˜¯ï¼š[java] view plain copyCollection emps = sqlUtility.select(EmpInfo.class, â€select from empsâ€);â€¦public static Collection select(Class c, String sqlStatement) { Collection result = new ArrayList(); / run sql query using jdbc / for ( / iterate over jdbc results / ) { Object item = c.newInstance(); / use reflection and set all of itemâ€™s fields from sql results */ result.add(item); } return result; }} ä½†æ˜¯è¿™ä¸èƒ½ç»™æˆ‘ä»¬è¿”å›žä¸€ä¸ªæˆ‘ä»¬è¦çš„ç²¾ç¡®ç±»åž‹çš„é›†åˆã€‚çŽ°åœ¨Classæ˜¯æ³›åž‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥å†™ï¼š[java] view plain copyCollection emps=sqlUtility.select(EmpInfo.class, â€select from empsâ€);â€¦public static Collection select(Classc, String sqlStatement) { Collection result = new ArrayList(); / run sql query using jdbc / for ( / iterate over jdbc results / ) { T item = c.newInstance(); / use reflection and set all of itemâ€™s fields from sql results */ result.add(item); } return result;} ç±æ­¤ä»¥ç±»åž‹å®‰å…¨çš„æ–¹å¼èŽ·å–æˆ‘ä»¬éœ€è¦çš„é›†åˆã€‚è¿™é¡¹æŠ€æœ¯æ˜¯ä¸€ä¸ªéžå¸¸æœ‰ç”¨çš„æŠ€å·§ï¼Œåœ¨å¤„ç†æ³¨é‡Š(annotations)çš„æ–°APIä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚ ä¸ƒã€å®¹å™¨ä¸Žæ³›åž‹Javaæ³›åž‹çš„æœ€æ·±å…¥äººå¿ƒçš„åº”ç”¨å°±æ˜¯å®¹å™¨ï¼ˆCollectionsï¼‰äº†ã€‚å®¹å™¨ä¸éœ€è¦è€ƒè™‘å®ƒè¦è£…ä»€ä¹ˆä¸œè¥¿ï¼Œå®ƒçš„èŒè´£å°±æ˜¯è¡¨è¾¾å®ƒè£…çš„ä¸œè¥¿çš„é›†åˆæ‰€å…·æœ‰çš„åŠŸèƒ½ã€‚å› æ­¤æ˜¯å¤©ç„¶çš„æ³›åž‹æ”¯æŒè€…ã€‚åœ¨æ²¡æœ‰æ³›åž‹æ—¶ï¼Œå¦‚æžœè¦å°è£…ä¸€ä¸ªåˆ—è¡¨ï¼Œç®€åŒ–åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š[java] view plain copypublic class ArrayList { Object[] array = new Object[10]; int i = 0; public void add(Object object) { array[i++] = object; } public Object get(int index) { return array[index]; } } è¿™æ„å‘³ç€æˆ‘ä»¬æŠŠå…ƒç´ å­˜è¿›åŽ»ï¼Œå–å‡ºæ¥è¿˜è¦å¼ºè½¬ï¼Œç±»åž‹å®‰å…¨æ— æ³•ä¿è¯ï¼ˆå­˜å…¥ä¸€ä¸ªIntegerå†å­˜ä¸€ä¸ªLongï¼Œè½¬å‡ºæ—¶å¼ºè½¬æˆIntegerå°±å´©æºƒäº†ï¼‰ã€‚ç”¨æ³›åž‹å¯ä»¥åœ¨ç¼–è¯‘æ—¶ä¿è¯ä¸èƒ½å­˜å…¥éžæ³›åž‹æ”¯æŒçš„æ•°æ®ï¼Œä¿è¯ç±»åž‹å®‰å…¨ã€‚æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰è¯´çš„ï¼ŒArrayListå†…ä¸å­˜å‚¨æ³›åž‹ä¿¡æ¯ï¼Œè€Œæ˜¯å­˜å‚¨æ³›åž‹çš„æœ€è¿‘çˆ¶ç±»ï¼Œå¯¹ArrayListè€Œè¨€å°±æ˜¯Objectï¼Œæ‰€ä»¥å…¶å†…éƒ¨ä»£ç æ˜¯ï¼š[java] view plain copypublic class ArrayList { Object[] array = new Object[10]; int i = 0; public void add(T object) { array[i++] = object; } public T get(int index) { return (T)array[index]; } } ä¿è¯æˆ‘ä»¬åŠ è¿›åŽ»å’Œå–å‡ºæ¥çš„æ•°æ®éƒ½æ˜¯ç»è¿‡ç±»åž‹æ£€æŸ¥çš„ã€‚ å…«ã€æ€»ç»“1ã€æ³›åž‹æ˜¯Javaä¸ºç±»åž‹å®‰å…¨è€Œåšçš„ä¸€ä¸ªä¼˜åŒ–ï¼Œå®ƒåœ¨å†…éƒ¨ä¿è¯äº†æ•°æ®ç±»åž‹ä¸€è‡´æ€§ï¼Œç»†åŒ–äº†å¯å˜å‚æ•°çš„ç±»åž‹ï¼Œä¸”èƒ½æ›´å¥½çš„è¡¨ç¤ºç±»åž‹é—´çš„ç›¸å…³æ€§ã€‚2ã€æ³›åž‹æ˜¯ç¼–è¯‘æ—¶æŠ€æœ¯ï¼Œå…¶èµ·ä½œç”¨çš„æ—¶æœºæ˜¯ç¼–è¯‘æ—¶ï¼Œå®Œå–„çš„ç¼–è¯‘å™¨ä¼šæŠ¥å‘Šé”™è¯¯çš„æ³›åž‹ä½¿ç”¨ï¼Œä¿è¯ä»£ç ä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚3ã€å¹³å¸¸å†™ä»£ç æ—¶ï¼Œè¦è®¤çœŸæ€è€ƒæ˜¯å¦æœ‰ä½¿ç”¨æ³›åž‹çš„å¿…è¦ã€‚é€šå¸¸æ¥è®²ï¼Œå¦‚æžœæ–¹æ³•æˆ–ç±»æè¿°çš„æ˜¯æ•°æ®ç±»åž‹æ— å…³çš„é€»è¾‘ï¼Œä¸”å…¶æ•°æ®ç±»åž‹å¯å˜æ—¶ï¼Œåˆ™åº”è¯¥ä½¿ç”¨æ³›åž‹ã€‚]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[influxdbç”¨æ³•]]></title>
    <url>%2F2018%2F03%2F07%2Finfluxdb%E7%94%A8%E6%B3%95%2F</url>
    <content type="text"><![CDATA[å‰è¨€ influxdbæ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„æ—¶é—´åºåˆ—æ•°æ®åº“ã€‚ ä½•è°“æ—¶é—´åºåˆ—æ•°æ®åº“ï¼Ÿä»€ä¹ˆæ˜¯æ—¶é—´åºåˆ—æ•°æ®åº“ï¼Œæœ€ç®€å•çš„å®šä¹‰å°±æ˜¯æ•°æ®æ ¼å¼é‡ŒåŒ…å«Timestampå­—æ®µçš„æ•°æ®ï¼Œæ¯”å¦‚æŸä¸€æ—¶é—´çŽ¯å¢ƒçš„æ¸©åº¦ï¼ŒCPUçš„ä½¿ç”¨çŽ‡ç­‰ã€‚ä½†æ˜¯ï¼Œæœ‰ä»€ä¹ˆæ•°æ®ä¸åŒ…å«Timestampå‘¢ï¼Ÿå‡ ä¹Žæ‰€æœ‰çš„æ•°æ®å…¶å®žéƒ½å¯ä»¥æ‰“ä¸Šä¸€ä¸ªTimestampå­—æ®µã€‚æ—¶é—´åºåˆ—æ•°æ®çš„æ›´é‡è¦çš„ä¸€ä¸ªå±žæ€§æ˜¯å¦‚ä½•åŽ»æŸ¥è¯¢å®ƒï¼ŒåŒ…æ‹¬æ•°æ®çš„è¿‡æ»¤ï¼Œè®¡ç®—ç­‰ç­‰ã€‚ InfluxdbInfluxdbæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ—¶åºã€æ—¶é—´å’ŒæŒ‡æ ‡æ•°æ®åº“ï¼Œä½¿ç”¨goè¯­è¨€ç¼–å†™ï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–ã€‚å®ƒæœ‰ä¸‰å¤§ç‰¹æ€§ï¼š æ—¶åºæ€§ï¼ˆTime Seriesï¼‰ï¼šä¸Žæ—¶é—´ç›¸å…³çš„å‡½æ•°çš„çµæ´»ä½¿ç”¨ï¼ˆè¯¸å¦‚æœ€å¤§ã€æœ€å°ã€æ±‚å’Œç­‰ï¼‰ï¼› åº¦é‡ï¼ˆMetricsï¼‰ï¼šå¯¹å®žæ—¶å¤§é‡æ•°æ®è¿›è¡Œè®¡ç®—ï¼› äº‹ä»¶ï¼ˆEventï¼‰ï¼šæ”¯æŒä»»æ„çš„äº‹ä»¶æ•°æ®ï¼Œæ¢å¥è¯è¯´ï¼Œä»»æ„äº‹ä»¶çš„æ•°æ®æˆ‘ä»¬éƒ½å¯ä»¥åšæ“ä½œã€‚ åŒæ—¶ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ å¤§ç‰¹ç‚¹ï¼š schemaless(æ— ç»“æž„)ï¼Œå¯ä»¥æ˜¯ä»»æ„æ•°é‡çš„åˆ—ï¼› min, max, sum, count, mean, median ä¸€ç³»åˆ—å‡½æ•°ï¼Œæ–¹ä¾¿ç»Ÿè®¡ï¼› Native HTTP API, å†…ç½®httpæ”¯æŒï¼Œä½¿ç”¨httpè¯»å†™ï¼› Powerful Query Language ç±»ä¼¼sqlï¼› Built-in Explorer è‡ªå¸¦ç®¡ç†å·¥å…·ã€‚ Influxdbå®‰è£… æ³¨ï¼šæœ¬æ–‡ä½¿ç”¨çš„influxdb versionæ˜¯1.0.2 åœ¨è®²è§£å…·ä½“çš„å®‰è£…æ­¥éª¤ä¹‹å‰ï¼Œå…ˆè¯´è¯´influxdbçš„ä¸¤ä¸ªhttpç«¯å£ï¼š8083å’Œ8086 port 8083ï¼šç®¡ç†é¡µé¢ç«¯å£ï¼Œè®¿é—®localhost:8083å¯ä»¥è¿›å…¥ä½ æœ¬æœºçš„influxdbç®¡ç†é¡µé¢ï¼› port 8086ï¼šhttpè¿žæŽ¥influxdb clientç«¯å£ï¼Œä¸€èˆ¬ä½¿ç”¨è¯¥ç«¯å£å¾€æœ¬æœºçš„influxdbè¯»å†™æ•°æ®ã€‚ OS X 12brew updatebrew install influxdb Docker Image 1docker pull influxdb Ubuntu &amp; Debian 12wget https://dl.influxdata.com/influxdb/releases/influxdb_1.0.2_amd64.debsudo dpkg -i influxdb_1.0.2_amd64.deb RedHat &amp; CentOS 12wget https://dl.influxdata.com/influxdb/releases/influxdb-1.0.2.x86_64.rpmsudo yum localinstall influxdb-1.0.2.x86_64.rpm Standalone Linux Binaries (64-bit) 12wget https://dl.influxdata.com/influxdb/releases/influxdb-1.0.2_linux_amd64.tar.gztar xvfz influxdb-1.0.2_linux_amd64.tar.gz Standalone Linux Binaries (32-bit) 12wget https://dl.influxdata.com/influxdb/releases/influxdb-1.0.2_linux_i386.tar.gztar xvfz influxdb-1.0.2_linux_i386.tar.gz Standalone Linux Binaries (ARM) 12wget https://dl.influxdata.com/influxdb/releases/influxdb-1.0.2_linux_armhf.tar.gztar xvfz influxdb-1.0.2_linux_armhf.tar.gz How to startï¼Ÿå®‰è£…å®Œä¹‹åŽï¼Œå¦‚ä½•å¯åŠ¨å‘¢ï¼Ÿ 1sudo service influxdb start åˆ°è¿™é‡Œinfluxdbå®‰è£…å¯åŠ¨å®Œæˆï¼Œå¯ä»¥è®¿é—®influxdbç®¡ç†é¡µé¢ï¼šæœ¬åœ°ç®¡ç†é¡µé¢ï¼Œè¯¥ç‰ˆæœ¬æ²¡æœ‰ç™»å½•ç”¨æˆ·åŠå¯†ç ï¼Œå¯ä»¥è‡ªè¡Œè®¾ç½®è¯»å†™çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ å¦‚ä½•åœ¨å‘½ä»¤è¡Œä½¿ç”¨å®‰è£…å®Œæ¯•ä¹‹åŽï¼Œå¦‚ä½•åœ¨å‘½ä»¤è¡Œä½¿ç”¨å‘¢ï¼Ÿ influxdbåœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ influxdbåŸºæœ¬æ“ä½œ åè¯è§£é‡Šåœ¨å…·ä½“çš„è®²è§£influxdbçš„ç›¸å…³æ“ä½œä¹‹å‰å…ˆè¯´è¯´influxdbçš„ä¸€äº›ä¸“æœ‰åè¯ï¼Œè¿™äº›åè¯ä»£è¡¨ä»€ä¹ˆã€‚ influxdbç›¸å…³åè¯ databaseï¼šæ•°æ®åº“ï¼› measurementï¼šæ•°æ®åº“ä¸­çš„è¡¨ï¼› pointsï¼šè¡¨é‡Œé¢çš„ä¸€è¡Œæ•°æ®ã€‚ influxDBä¸­ç‹¬æœ‰çš„ä¸€äº›æ¦‚å¿µPointç”±æ—¶é—´æˆ³ï¼ˆtimeï¼‰ã€æ•°æ®ï¼ˆfieldï¼‰å’Œæ ‡ç­¾ï¼ˆtagsï¼‰ç»„æˆã€‚ timeï¼šæ¯æ¡æ•°æ®è®°å½•çš„æ—¶é—´ï¼Œä¹Ÿæ˜¯æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆçš„ä¸»ç´¢å¼•ï¼› fieldsï¼šå„ç§è®°å½•çš„å€¼ï¼› tagsï¼šå„ç§æœ‰ç´¢å¼•çš„å±žæ€§ã€‚ è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åè¯ï¼šseriesæ‰€æœ‰åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œéƒ½éœ€è¦é€šè¿‡å›¾è¡¨æ¥è¡¨ç¤ºï¼Œseriesè¡¨ç¤ºè¿™ä¸ªè¡¨é‡Œé¢çš„æ‰€æœ‰çš„æ•°æ®å¯ä»¥åœ¨å›¾æ ‡ä¸Šç”»æˆå‡ æ¡çº¿ï¼ˆæ³¨ï¼šçº¿æ¡çš„ä¸ªæ•°ç”±tagsæŽ’åˆ—ç»„åˆè®¡ç®—å‡ºæ¥ï¼‰ä¸¾ä¸ªç®€å•çš„å°æ —å­ï¼šæœ‰å¦‚ä¸‹æ•°æ®ï¼š error_time å®ƒçš„seriesä¸ºï¼š error_time_series influxdbåŸºæœ¬æ“ä½œ æ•°æ®åº“ä¸Žè¡¨çš„æ“ä½œå¯ä»¥ç›´æŽ¥åœ¨webç®¡ç†é¡µé¢åšæ“ä½œï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å‘½ä»¤è¡Œã€‚ 1234567891011121314#åˆ›å»ºæ•°æ®åº“create database "db_name"#æ˜¾ç¤ºæ‰€æœ‰çš„æ•°æ®åº“show databases#åˆ é™¤æ•°æ®åº“drop database "db_name"#ä½¿ç”¨æ•°æ®åº“use db_name#æ˜¾ç¤ºè¯¥æ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨show measurements#åˆ›å»ºè¡¨ï¼Œç›´æŽ¥åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™æŒ‡å®šè¡¨åinsert test,host=127.0.0.1,monitor_name=test count=1#åˆ é™¤è¡¨drop measurement "measurement_name" å¢ž â€‹ å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®ã€‚ é€šè¿‡å‘½ä»¤è¡Œ 12use testDbinsert test,host=127.0.0.1,monitor_name=test count=1 é€šè¿‡httpæŽ¥å£ 1curl -i -XPOST 'http://127.0.0.1:8086/write?db=testDb' --data-binary 'test,host=127.0.0.1,monitor_name=test count=1' è¯»è€…çœ‹åˆ°è¿™é‡Œå¯èƒ½ä¼šè§‚å¯Ÿåˆ°æ’å…¥çš„æ•°æ®çš„æ ¼å¼è²Œä¼¼æ¯”è¾ƒå¥‡æ€ªï¼Œè¿™æ˜¯å› ä¸ºinfluxDBå­˜å‚¨æ•°æ®é‡‡ç”¨çš„æ˜¯Line Protocolæ ¼å¼ã€‚é‚£ä¹ˆä½•è°“Line Protocoæ ¼å¼ï¼Ÿ Line Protocolæ ¼å¼ï¼šå†™å…¥æ•°æ®åº“çš„Pointçš„å›ºå®šæ ¼å¼ã€‚åœ¨ä¸Šé¢çš„ä¸¤ç§æ’å…¥æ•°æ®çš„æ–¹æ³•ä¸­éƒ½æœ‰è¿™æ ·çš„ä¸€éƒ¨åˆ†ï¼š 1test,host=127.0.0.1,monitor_name=test count=1 å…¶ä¸­ï¼š testï¼šè¡¨åï¼› host=127.0.0.1,monitor_name=testï¼štagï¼› count=1ï¼šfield æƒ³å¯¹æ­¤æ ¼å¼æœ‰è¯¦ç»†çš„äº†è§£å‚è§å®˜æ–¹æ–‡æ¡£ æŸ¥ â€‹ æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚ é€šè¿‡å‘½ä»¤è¡Œ 1select * from test order by time desc é€šè¿‡httpæŽ¥å£ 1curl -G 'http://localhost:8086/query?pretty=true' --data-urlencode "db=testDb" --data-urlencode "q=select * from test order by time desc" influxDBæ˜¯æ”¯æŒç±»sqlè¯­å¥çš„ï¼Œå…·ä½“çš„æŸ¥è¯¢è¯­æ³•éƒ½å·®ä¸å¤šï¼Œè¿™é‡Œå°±ä¸å†åšè¯¦ç»†çš„èµ˜è¿°äº†ã€‚ æ•°æ®ä¿å­˜ç­–ç•¥ï¼ˆRetention Policiesï¼‰influxDBæ˜¯æ²¡æœ‰æä¾›ç›´æŽ¥åˆ é™¤æ•°æ®è®°å½•çš„æ–¹æ³•ï¼Œä½†æ˜¯æä¾›æ•°æ®ä¿å­˜ç­–ç•¥ï¼Œä¸»è¦ç”¨äºŽæŒ‡å®šæ•°æ®ä¿ç•™æ—¶é—´ï¼Œè¶…è¿‡æŒ‡å®šæ—¶é—´ï¼Œå°±åˆ é™¤è¿™éƒ¨åˆ†æ•°æ®ã€‚ æŸ¥çœ‹å½“å‰æ•°æ®åº“Retention Policies 1show retention policies on "db_name" retention_policies åˆ›å»ºæ–°çš„Retention Policies 1create retention policy "rp_name" on "db_name" duration 3w replication 1 default 12345- rp_nameï¼šç­–ç•¥åï¼›- db_nameï¼šå…·ä½“çš„æ•°æ®åº“åï¼›- 3wï¼šä¿å­˜3å‘¨ï¼Œ3å‘¨ä¹‹å‰çš„æ•°æ®å°†è¢«åˆ é™¤ï¼Œinfluxdbå…·æœ‰å„ç§äº‹ä»¶å‚æ•°ï¼Œæ¯”å¦‚ï¼šhï¼ˆå°æ—¶ï¼‰ï¼Œdï¼ˆå¤©ï¼‰ï¼Œwï¼ˆæ˜ŸæœŸï¼‰ï¼›- replication 1ï¼šå‰¯æœ¬ä¸ªæ•°ï¼Œä¸€èˆ¬ä¸º1å°±å¯ä»¥äº†ï¼›- defaultï¼šè®¾ç½®ä¸ºé»˜è®¤ç­–ç•¥ ä¿®æ”¹Retention Policies 1alter retention policy "rp_name" on "db_name" duration 30d default åˆ é™¤Retention Policies 1drop retention policy "rp_name" è¿žç»­æŸ¥è¯¢ï¼ˆContinous Queriesï¼‰ â€‹ å½“æ•°æ®è¶…è¿‡ä¿å­˜ç­–ç•¥é‡ŒæŒ‡å®šçš„æ—¶é—´ä¹‹åŽå°±ä¼šè¢«åˆ é™¤ï¼Œä½†æ˜¯è¿™æ—¶å€™å¯èƒ½å¹¶ä¸æƒ³æ•°æ®è¢«å®Œå…¨åˆ æŽ‰ï¼Œæ€Žä¹ˆåŠžï¼Ÿ â€‹ influxdbæä¾›äº†è”ç³»æŸ¥è¯¢ï¼Œå¯ä»¥åšæ•°æ®ç»Ÿè®¡é‡‡æ ·ã€‚ æŸ¥çœ‹æ•°æ®åº“çš„Continous Queries 1show continuous queries continuous_queries. åˆ›å»ºæ–°çš„Continous Queries 1create continous query cq_name on db_name begin select sum(count) into new_table_name from table_name group by time(30m) end 123456- cq_nameï¼šè¿žç»­æŸ¥è¯¢åå­—ï¼›- db_nameï¼šæ•°æ®åº“åå­—ï¼›- sum(count)ï¼šè®¡ç®—æ€»å’Œï¼›- table_nameï¼šå½“å‰è¡¨åï¼›- new_table_nameï¼šå­˜æ–°çš„æ•°æ®çš„è¡¨åï¼›- 30mï¼šæ—¶é—´é—´éš”ä¸º30åˆ†é’Ÿ åˆ é™¤Continous Queries 1drop continous query cp_name on db_name ç”¨æˆ·ç®¡ç†å¯ä»¥ç›´æŽ¥åœ¨webç®¡ç†é¡µé¢åšæ“ä½œï¼Œä¹Ÿå¯ä»¥å‘½ä»¤è¡Œã€‚ 1234567#æ˜¾ç¤ºç”¨æˆ·show users#åˆ›å»ºç”¨æˆ·create user "username" with password 'password'#åˆ›å»ºç®¡ç†å‘˜æƒé™ç”¨æˆ·create user "username" with password 'password' with all privileges#åˆ é™¤ç”¨æˆ·drop user "username"]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>influxdb</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡åž‹FAQ]]></title>
    <url>%2F2018%2F03%2F06%2FJava%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯å†…å­˜æ¨¡åž‹http://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html åœ¨å¤šæ ¸ç³»ç»Ÿä¸­ï¼Œå¤„ç†å™¨ä¸€èˆ¬æœ‰ä¸€å±‚æˆ–è€…å¤šå±‚çš„ç¼“å­˜ï¼Œè¿™äº›çš„ç¼“å­˜é€šè¿‡åŠ é€Ÿæ•°æ®è®¿é—®ï¼ˆå› ä¸ºæ•°æ®è·ç¦»å¤„ç†å™¨æ›´è¿‘ï¼‰å’Œé™ä½Žå…±äº«å†…å­˜åœ¨æ€»çº¿ä¸Šçš„é€šè®¯ï¼ˆå› ä¸ºæœ¬åœ°ç¼“å­˜èƒ½å¤Ÿæ»¡è¶³è®¸å¤šå†…å­˜æ“ä½œï¼‰æ¥æé«˜CPUæ€§èƒ½ã€‚ç¼“å­˜èƒ½å¤Ÿå¤§å¤§æå‡æ€§èƒ½ï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿå¸¦æ¥äº†è®¸å¤šæŒ‘æˆ˜ã€‚ä¾‹å¦‚ï¼Œå½“ä¸¤ä¸ªCPUåŒæ—¶æ£€æŸ¥ç›¸åŒçš„å†…å­˜åœ°å€æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿåœ¨ä»€ä¹ˆæ ·çš„æ¡ä»¶ä¸‹å®ƒä»¬ä¼šçœ‹åˆ°ç›¸åŒçš„å€¼ï¼Ÿ åœ¨å¤„ç†å™¨å±‚é¢ä¸Šï¼Œå†…å­˜æ¨¡åž‹å®šä¹‰äº†ä¸€ä¸ªå……è¦æ¡ä»¶ï¼Œâ€œè®©å½“å‰çš„å¤„ç†å™¨å¯ä»¥çœ‹åˆ°å…¶ä»–å¤„ç†å™¨å†™å…¥åˆ°å†…å­˜çš„æ•°æ®â€ä»¥åŠå…¶ä»–å¤„ç†å™¨å¯ä»¥çœ‹åˆ°å½“å‰å¤„ç†å™¨å†™å…¥åˆ°å†…å­˜çš„æ•°æ®â€ã€‚æœ‰äº›å¤„ç†å™¨æœ‰å¾ˆå¼ºçš„å†…å­˜æ¨¡åž‹(strong memory model)ï¼Œèƒ½å¤Ÿè®©æ‰€æœ‰çš„å¤„ç†å™¨åœ¨ä»»ä½•æ—¶å€™ä»»ä½•æŒ‡å®šçš„å†…å­˜åœ°å€ä¸Šéƒ½å¯ä»¥çœ‹åˆ°å®Œå…¨ç›¸åŒçš„å€¼ã€‚è€Œå¦å¤–ä¸€äº›å¤„ç†å™¨åˆ™æœ‰è¾ƒå¼±çš„å†…å­˜æ¨¡åž‹ï¼ˆweaker memory modelï¼‰ï¼Œåœ¨è¿™ç§å¤„ç†å™¨ä¸­ï¼Œå¿…é¡»ä½¿ç”¨å†…å­˜å±éšœï¼ˆä¸€ç§ç‰¹æ®Šçš„æŒ‡ä»¤ï¼‰æ¥åˆ·æ–°æœ¬åœ°å¤„ç†å™¨ç¼“å­˜å¹¶ä½¿æœ¬åœ°å¤„ç†å™¨ç¼“å­˜æ— æ•ˆï¼Œç›®çš„æ˜¯ä¸ºäº†è®©å½“å‰å¤„ç†å™¨èƒ½å¤Ÿçœ‹åˆ°å…¶ä»–å¤„ç†å™¨çš„å†™æ“ä½œæˆ–è€…è®©å…¶ä»–å¤„ç†å™¨èƒ½çœ‹åˆ°å½“å‰å¤„ç†å™¨çš„å†™æ“ä½œã€‚è¿™äº›å†…å­˜å±éšœé€šå¸¸åœ¨lockå’Œunlockæ“ä½œçš„æ—¶å€™å®Œæˆã€‚å†…å­˜å±éšœåœ¨é«˜çº§è¯­è¨€ä¸­å¯¹ç¨‹åºå‘˜æ˜¯ä¸å¯è§çš„ã€‚ åœ¨å¼ºå†…å­˜æ¨¡åž‹ä¸‹ï¼Œæœ‰æ—¶å€™ç¼–å†™ç¨‹åºå¯èƒ½ä¼šæ›´å®¹æ˜“ï¼Œå› ä¸ºå‡å°‘äº†å¯¹å†…å­˜å±éšœçš„ä¾èµ–ã€‚ä½†æ˜¯å³ä½¿åœ¨ä¸€äº›æœ€å¼ºçš„å†…å­˜æ¨¡åž‹ä¸‹ï¼Œå†…å­˜å±éšœä»ç„¶æ˜¯å¿…é¡»çš„ã€‚è®¾ç½®å†…å­˜å±éšœå¾€å¾€ä¸Žæˆ‘ä»¬çš„ç›´è§‰å¹¶ä¸ä¸€è‡´ã€‚è¿‘æ¥å¤„ç†å™¨è®¾è®¡çš„è¶‹åŠ¿æ›´å€¾å‘äºŽå¼±çš„å†…å­˜æ¨¡åž‹ï¼Œå› ä¸ºå¼±å†…å­˜æ¨¡åž‹å‰Šå¼±äº†ç¼“å­˜ä¸€è‡´æ€§ï¼Œæ‰€ä»¥åœ¨å¤šå¤„ç†å™¨å¹³å°å’Œæ›´å¤§å®¹é‡çš„å†…å­˜ä¸‹å¯ä»¥å®žçŽ°æ›´å¥½çš„å¯ä¼¸ç¼©æ€§ â€œä¸€ä¸ªçº¿ç¨‹çš„å†™æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹å¯è§â€è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºç¼–è¯‘å™¨å¯¹ä»£ç è¿›è¡Œé‡æŽ’åºå¯¼è‡´çš„ã€‚ä¾‹å¦‚ï¼Œåªè¦ä»£ç ç§»åŠ¨ä¸ä¼šæ”¹å˜ç¨‹åºçš„è¯­ä¹‰ï¼Œå½“ç¼–è¯‘å™¨è®¤ä¸ºç¨‹åºä¸­ç§»åŠ¨ä¸€ä¸ªå†™æ“ä½œåˆ°åŽé¢ä¼šæ›´æœ‰æ•ˆçš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å°±ä¼šå¯¹ä»£ç è¿›è¡Œç§»åŠ¨ã€‚å¦‚æžœç¼–è¯‘å™¨æŽ¨è¿Ÿæ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œå…¶ä»–çº¿ç¨‹å¯èƒ½åœ¨è¿™ä¸ªæ“ä½œæ‰§è¡Œå®Œä¹‹å‰éƒ½ä¸ä¼šçœ‹åˆ°è¯¥æ“ä½œçš„ç»“æžœï¼Œè¿™åæ˜ äº†ç¼“å­˜çš„å½±å“ã€‚ æ­¤å¤–ï¼Œå†™å…¥å†…å­˜çš„æ“ä½œèƒ½å¤Ÿè¢«ç§»åŠ¨åˆ°ç¨‹åºé‡Œæ›´å‰çš„æ—¶å€™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶ä»–çš„çº¿ç¨‹åœ¨ç¨‹åºä¸­å¯èƒ½çœ‹åˆ°ä¸€ä¸ªæ¯”å®ƒå®žé™…å‘ç”Ÿæ›´æ—©çš„å†™æ“ä½œã€‚æ‰€æœ‰çš„è¿™äº›çµæ´»æ€§çš„è®¾è®¡æ˜¯ä¸ºäº†é€šè¿‡ç»™ç¼–è¯‘å™¨ï¼Œè¿è¡Œæ—¶æˆ–ç¡¬ä»¶çµæ´»æ€§ä½¿å…¶èƒ½åœ¨æœ€ä½³é¡ºåºçš„æƒ…å†µä¸‹æ¥æ‰§è¡Œæ“ä½œã€‚åœ¨å†…å­˜æ¨¡åž‹çš„é™å®šä¹‹å†…ï¼Œæˆ‘ä»¬èƒ½å¤ŸèŽ·å–åˆ°æ›´é«˜çš„æ€§èƒ½ã€‚ 123456789101112Class Reordering &#123; int x = 0, y = 0; public void writer() &#123; x = 1; y = 2; &#125; public void reader() &#123; int r1 = y; int r2 = x; &#125;&#125; è®©æˆ‘ä»¬çœ‹åœ¨ä¸¤ä¸ªå¹¶å‘çº¿ç¨‹ä¸­æ‰§è¡Œè¿™æ®µä»£ç ï¼Œè¯»å–Yå˜é‡å°†ä¼šå¾—åˆ°2è¿™ä¸ªå€¼ã€‚å› ä¸ºè¿™ä¸ªå†™å…¥æ¯”å†™åˆ°Xå˜é‡æ›´æ™šä¸€äº›ï¼Œç¨‹åºå‘˜å¯èƒ½è®¤ä¸ºè¯»å–Xå˜é‡å°†è‚¯å®šä¼šå¾—åˆ°1ã€‚ä½†æ˜¯ï¼Œå†™å…¥æ“ä½œå¯èƒ½è¢«é‡æŽ’åºè¿‡ã€‚å¦‚æžœé‡æŽ’åºå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆï¼Œå°±èƒ½å‘ç”Ÿå¯¹Yå˜é‡çš„å†™å…¥æ“ä½œï¼Œè¯»å–ä¸¤ä¸ªå˜é‡çš„æ“ä½œç´§éšå…¶åŽï¼Œè€Œä¸”å†™å…¥åˆ°Xè¿™ä¸ªæ“ä½œèƒ½å‘ç”Ÿã€‚ç¨‹åºçš„ç»“æžœå¯èƒ½æ˜¯r1å˜é‡çš„å€¼æ˜¯2ï¼Œä½†æ˜¯r2å˜é‡çš„å€¼ä¸º0ã€‚ Javaå†…å­˜æ¨¡åž‹æè¿°äº†åœ¨å¤šçº¿ç¨‹ä»£ç ä¸­å“ªäº›è¡Œä¸ºæ˜¯åˆæ³•çš„ï¼Œä»¥åŠçº¿ç¨‹å¦‚ä½•é€šè¿‡å†…å­˜è¿›è¡Œäº¤äº’ã€‚å®ƒæè¿°äº†â€œç¨‹åºä¸­çš„å˜é‡â€œ å’Œ â€ä»Žå†…å­˜æˆ–è€…å¯„å­˜å™¨èŽ·å–æˆ–å­˜å‚¨å®ƒä»¬çš„åº•å±‚ç»†èŠ‚â€ä¹‹é—´çš„å…³ç³»ã€‚Javaå†…å­˜æ¨¡åž‹é€šè¿‡ä½¿ç”¨å„ç§å„æ ·çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨çš„ä¼˜åŒ–æ¥æ­£ç¡®å®žçŽ°ä»¥ä¸Šäº‹æƒ…ã€‚ JavaåŒ…å«äº†å‡ ä¸ªè¯­è¨€çº§åˆ«çš„å…³é”®å­—ï¼ŒåŒ…æ‹¬ï¼švolatile, finalä»¥åŠsynchronizedï¼Œç›®çš„æ˜¯ä¸ºäº†å¸®åŠ©ç¨‹åºå‘˜å‘ç¼–è¯‘å™¨æè¿°ä¸€ä¸ªç¨‹åºçš„å¹¶å‘éœ€æ±‚ã€‚Javaå†…å­˜æ¨¡åž‹å®šä¹‰äº†volatileå’Œsynchronizedçš„è¡Œä¸ºï¼Œæ›´é‡è¦çš„æ˜¯ä¿è¯äº†åŒæ­¥çš„javaç¨‹åºåœ¨æ‰€æœ‰çš„å¤„ç†å™¨æž¶æž„ä¸‹é¢éƒ½èƒ½æ­£ç¡®çš„è¿è¡Œã€‚ å…¶ä»–è¯­è¨€ï¼ŒåƒC++ï¼Œä¹Ÿæœ‰å†…å­˜æ¨¡åž‹å—å¤§éƒ¨åˆ†å…¶ä»–çš„è¯­è¨€ï¼ŒåƒCå’ŒC++ï¼Œéƒ½æ²¡æœ‰è¢«è®¾è®¡æˆç›´æŽ¥æ”¯æŒå¤šçº¿ç¨‹ã€‚è¿™äº›è¯­è¨€å¯¹äºŽå‘ç”Ÿåœ¨ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¹³å°æž¶æž„çš„é‡æŽ’åºè¡Œä¸ºçš„ä¿æŠ¤æœºåˆ¶ä¼šä¸¥é‡çš„ä¾èµ–äºŽç¨‹åºä¸­æ‰€ä½¿ç”¨çš„çº¿ç¨‹åº“ï¼ˆä¾‹å¦‚pthreadsï¼‰ï¼Œç¼–è¯‘å™¨ï¼Œä»¥åŠä»£ç æ‰€è¿è¡Œçš„å¹³å°æ‰€æä¾›çš„ä¿éšœã€‚ #JSR133æ˜¯ä»€ä¹ˆ ä»Ž1997å¹´ä»¥æ¥ï¼Œäººä»¬ä¸æ–­å‘çŽ°Javaè¯­è¨€è§„èŒƒçš„17ç« å®šä¹‰çš„Javaå†…å­˜æ¨¡åž‹ä¸­çš„ä¸€äº›ä¸¥é‡çš„ç¼ºé™·ã€‚è¿™äº›ç¼ºé™·ä¼šå¯¼è‡´ä¸€äº›ä½¿äººè¿·æƒ‘çš„è¡Œä¸ºï¼ˆä¾‹å¦‚finalå­—æ®µä¼šè¢«è§‚å¯Ÿåˆ°å€¼çš„æ”¹å˜ï¼‰å’Œç ´åç¼–è¯‘å™¨å¸¸è§çš„ä¼˜åŒ–èƒ½åŠ›ã€‚ Javaå†…å­˜æ¨¡åž‹æ˜¯ä¸€ä¸ªé›„å¿ƒå‹ƒå‹ƒçš„è®¡åˆ’ï¼Œå®ƒæ˜¯ç¼–ç¨‹è¯­è¨€è§„èŒƒç¬¬ä¸€æ¬¡å°è¯•åˆå¹¶ä¸€ä¸ªèƒ½å¤Ÿåœ¨å„ç§å¤„ç†å™¨æž¶æž„ä¸­ä¸ºå¹¶å‘æä¾›ä¸€è‡´è¯­ä¹‰çš„å†…å­˜æ¨¡åž‹ã€‚ä¸è¿‡ï¼Œå®šä¹‰ä¸€ä¸ªæ—¢ä¸€è‡´åˆç›´è§‚çš„å†…å­˜æ¨¡åž‹è¿œæ¯”æƒ³è±¡è¦æ›´éš¾ã€‚JSR133ä¸ºJavaè¯­è¨€å®šä¹‰äº†ä¸€ä¸ªæ–°çš„å†…å­˜æ¨¡åž‹ï¼Œå®ƒä¿®å¤äº†æ—©æœŸå†…å­˜æ¨¡åž‹ä¸­çš„ç¼ºé™·ã€‚ä¸ºäº†å®žçŽ°JSR133ï¼Œfinalå’Œvolatileçš„è¯­ä¹‰éœ€è¦é‡æ–°å®šä¹‰ã€‚ å®Œæ•´çš„è¯­ä¹‰è§ï¼šhttp://www.cs.umd.edu/users/pugh/java/memoryModelï¼Œä½†æ˜¯æ­£å¼çš„è¯­ä¹‰ä¸æ˜¯å°å¿ƒç¿¼ç¿¼çš„ï¼Œå®ƒæ˜¯ä»¤äººæƒŠè®¶å’Œæ¸…é†’çš„ï¼Œç›®çš„æ˜¯è®©äººæ„è¯†åˆ°ä¸€äº›çœ‹ä¼¼ç®€å•çš„æ¦‚å¿µï¼ˆå¦‚åŒæ­¥ï¼‰å…¶å®žæœ‰å¤šå¤æ‚ã€‚å¹¸è¿çš„æ˜¯ï¼Œä½ ä¸éœ€è¦æ‡‚å¾—è¿™äº›æ­£å¼è¯­ä¹‰çš„ç»†èŠ‚â€”â€”JSR133çš„ç›®çš„æ˜¯åˆ›å»ºä¸€ç»„æ­£å¼è¯­ä¹‰ï¼Œè¿™äº›æ­£å¼è¯­ä¹‰æä¾›äº†volatileã€synchronziedå’Œfinalå¦‚ä½•å·¥ä½œçš„ç›´è§‚æ¡†æž¶ã€‚ JSR 133çš„ç›®æ ‡åŒ…å«äº†ï¼š ä¿ç•™å·²ç»å­˜åœ¨çš„å®‰å…¨ä¿è¯ï¼ˆåƒç±»åž‹å®‰å…¨ï¼‰ä»¥åŠå¼ºåŒ–å…¶ä»–çš„å®‰å…¨ä¿è¯ã€‚ä¾‹å¦‚ï¼Œå˜é‡å€¼ä¸èƒ½å‡­ç©ºåˆ›å»ºï¼šçº¿ç¨‹è§‚å¯Ÿåˆ°çš„æ¯ä¸ªå˜é‡çš„å€¼å¿…é¡»æ˜¯è¢«å…¶ä»–çº¿ç¨‹åˆç†çš„è®¾ç½®çš„ã€‚ æ­£ç¡®åŒæ­¥çš„ç¨‹åºçš„è¯­ä¹‰åº”è¯¥å°½é‡ç®€å•å’Œç›´è§‚ã€‚ åº”è¯¥å®šä¹‰æœªå®Œæˆæˆ–è€…æœªæ­£ç¡®åŒæ­¥çš„ç¨‹åºçš„è¯­ä¹‰ï¼Œä¸»è¦æ˜¯ä¸ºäº†æŠŠæ½œåœ¨çš„å®‰å…¨å±å®³é™åˆ°æœ€ä½Žã€‚ ç¨‹åºå‘˜åº”è¯¥èƒ½å¤Ÿè‡ªä¿¡çš„æŽ¨æ–­å¤šçº¿ç¨‹ç¨‹åºå¦‚ä½•åŒå†…å­˜è¿›è¡Œäº¤äº’çš„ã€‚ èƒ½å¤Ÿåœ¨çŽ°åœ¨è®¸å¤šæµè¡Œçš„ç¡¬ä»¶æž¶æž„ä¸­è®¾è®¡æ­£ç¡®ä»¥åŠé«˜æ€§èƒ½çš„JVMå®žçŽ°ã€‚ åº”è¯¥èƒ½æä¾› å®‰å…¨åœ°åˆå§‹åŒ–çš„ä¿è¯ã€‚å¦‚æžœä¸€ä¸ªå¯¹è±¡æ­£ç¡®çš„æž„å»ºäº†ï¼ˆæ„æ€æ˜¯å®ƒçš„å¼•ç”¨æ²¡æœ‰åœ¨æž„å»ºçš„æ—¶å€™é€¸å‡ºï¼Œé‚£ä¹ˆæ‰€æœ‰èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨çš„çº¿ç¨‹ï¼Œåœ¨ä¸è¿›è¡ŒåŒæ­¥çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå°†èƒ½çœ‹åˆ°åœ¨æž„é€ æ–¹æ³•ä¸­ä¸­è®¾ç½®çš„finalå­—æ®µçš„å€¼ã€‚ åº”è¯¥å°½é‡ä¸å½±å“çŽ°æœ‰çš„ä»£ç  é‡æŽ’åºæ„å‘³ç€ä»€ä¹ˆï¼Ÿåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œè®¿é—®ä¸€ä¸ªç¨‹åºå˜é‡ï¼ˆå¯¹è±¡å®žä¾‹å­—æ®µï¼Œç±»é™æ€å­—æ®µå’Œæ•°ç»„å…ƒç´ ï¼‰å¯èƒ½ä¼šä½¿ç”¨ä¸åŒçš„é¡ºåºæ‰§è¡Œï¼Œè€Œä¸æ˜¯ç¨‹åºè¯­ä¹‰æ‰€æŒ‡å®šçš„é¡ºåºæ‰§è¡Œã€‚ç¼–è¯‘å™¨èƒ½å¤Ÿè‡ªç”±çš„ä»¥ä¼˜åŒ–çš„åä¹‰åŽ»æ”¹å˜æŒ‡ä»¤é¡ºåºã€‚åœ¨ç‰¹å®šçš„çŽ¯å¢ƒä¸‹ï¼Œå¤„ç†å™¨å¯èƒ½ä¼šæ¬¡åºé¢ å€’çš„æ‰§è¡ŒæŒ‡ä»¤ã€‚æ•°æ®å¯èƒ½åœ¨å¯„å­˜å™¨ï¼Œå¤„ç†å™¨ç¼“å†²åŒºå’Œä¸»å†…å­˜ä¸­ä»¥ä¸åŒçš„æ¬¡åºç§»åŠ¨ï¼Œè€Œä¸æ˜¯æŒ‰ç…§ç¨‹åºæŒ‡å®šçš„é¡ºåºã€‚ ä¾‹å¦‚ï¼Œå¦‚æžœä¸€ä¸ªçº¿ç¨‹å†™å…¥å€¼åˆ°å­—æ®µaï¼Œç„¶åŽå†™å…¥å€¼åˆ°å­—æ®µbï¼Œè€Œä¸”bçš„å€¼ä¸ä¾èµ–äºŽaçš„å€¼ï¼Œé‚£ä¹ˆï¼Œå¤„ç†å™¨å°±èƒ½å¤Ÿè‡ªç”±çš„è°ƒæ•´å®ƒä»¬çš„æ‰§è¡Œé¡ºåºï¼Œè€Œä¸”ç¼“å†²åŒºèƒ½å¤Ÿåœ¨aä¹‹å‰åˆ·æ–°bçš„å€¼åˆ°ä¸»å†…å­˜ã€‚æœ‰è®¸å¤šæ½œåœ¨çš„é‡æŽ’åºçš„æ¥æºï¼Œä¾‹å¦‚ç¼–è¯‘å™¨ï¼ŒJITä»¥åŠç¼“å†²åŒºã€‚ ç¼–è¯‘å™¨ï¼Œè¿è¡Œæ—¶å’Œç¡¬ä»¶è¢«æœŸæœ›ä¸€èµ·ååŠ›åˆ›å»ºå¥½åƒæ˜¯é¡ºåºæ‰§è¡Œçš„è¯­ä¹‰çš„å‡è±¡ï¼Œè¿™æ„å‘³ç€åœ¨å•çº¿ç¨‹çš„ç¨‹åºä¸­ï¼Œç¨‹åºåº”è¯¥æ˜¯ä¸èƒ½å¤Ÿè§‚å¯Ÿåˆ°é‡æŽ’åºçš„å½±å“çš„ã€‚ä½†æ˜¯ï¼Œé‡æŽ’åºåœ¨æ²¡æœ‰æ­£ç¡®åŒæ­¥äº†çš„å¤šçº¿ç¨‹ç¨‹åºä¸­å¼€å§‹èµ·ä½œç”¨ï¼Œåœ¨è¿™äº›å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè§‚å¯Ÿåˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“ï¼Œä¹Ÿå¯èƒ½æ£€æµ‹åˆ°å…¶ä»–çº¿ç¨‹å°†ä¼šä»¥ä¸€ç§ä¸åŒäºŽç¨‹åºè¯­ä¹‰æ‰€è§„å®šçš„æ‰§è¡Œé¡ºåºæ¥è®¿é—®å˜é‡ã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸ä¼šå…³æ³¨å…¶ä»–çº¿ç¨‹æ­£åœ¨åšä»€ä¹ˆï¼Œä½†æ˜¯å½“å®ƒéœ€è¦å…³æ³¨çš„æ—¶å€™ï¼Œè¿™æ—¶å€™å°±éœ€è¦åŒæ­¥äº†ã€‚ æ—§çš„å†…å­˜æ¨¡åž‹æœ‰ä»€ä¹ˆé—®é¢˜æ—§çš„å†…å­˜æ¨¡åž‹ä¸­æœ‰å‡ ä¸ªä¸¥é‡çš„é—®é¢˜ã€‚è¿™äº›é—®é¢˜å¾ˆéš¾ç†è§£ï¼Œå› æ­¤è¢«å¹¿æ³›çš„è¿èƒŒã€‚ä¾‹å¦‚ï¼Œæ—§çš„å­˜å‚¨æ¨¡åž‹åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä¸å…è®¸JVMå‘ç”Ÿå„ç§é‡æŽ’åºè¡Œä¸ºã€‚æ—§çš„å†…å­˜æ¨¡åž‹ä¸­è®©äººäº§ç”Ÿå›°æƒ‘çš„å› ç´ é€ å°±äº†JSR-133è§„èŒƒçš„è¯žç”Ÿã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªè¢«å¹¿æ³›è®¤å¯çš„æ¦‚å¿µå°±æ˜¯ï¼Œå¦‚æžœä½¿ç”¨finalå­—æ®µï¼Œé‚£ä¹ˆå°±æ²¡æœ‰å¿…è¦åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨åŒæ­¥æ¥ä¿è¯å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸ªå­—æ®µçš„å€¼ã€‚å°½ç®¡è¿™æ˜¯ä¸€ä¸ªåˆç†çš„å‡è®¾å’Œæ˜Žæ˜¾çš„è¡Œä¸ºï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ‰€æœŸå¾…çš„ç»“æžœã€‚å®žé™…ä¸Šï¼Œåœ¨æ—§çš„å†…å­˜æ¨¡åž‹ä¸­ï¼Œæˆ‘ä»¬æƒ³è®©ç¨‹åºæ­£ç¡®è¿è¡Œèµ·æ¥å´æ˜¯ä¸è¡Œçš„ã€‚åœ¨æ—§çš„å†…å­˜æ¨¡åž‹ä¸­ï¼Œfinalå­—æ®µå¹¶æ²¡æœ‰åŒå…¶ä»–å­—æ®µè¿›è¡ŒåŒºåˆ«å¯¹å¾…â€”â€”è¿™æ„å‘³ç€åŒæ­¥æ˜¯ä¿è¯æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°ä¸€ä¸ªåœ¨æž„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–çš„finalå­—æ®µçš„å”¯ä¸€æ–¹æ³•ã€‚ç»“æžœâ€”â€”å¦‚æžœæ²¡æœ‰æ­£ç¡®åŒæ­¥çš„è¯ï¼Œå¯¹ä¸€ä¸ªçº¿ç¨‹æ¥è¯´ï¼Œå®ƒå¯èƒ½çœ‹åˆ°ä¸€ä¸ªå­—æ®µçš„é»˜è®¤å€¼ï¼Œç„¶åŽåœ¨ç¨åŽçš„æ—¶é—´é‡Œï¼Œåˆèƒ½å¤Ÿçœ‹åˆ°æž„é€ æ–¹æ³•ä¸­è®¾ç½®çš„å€¼ã€‚è¿™æ„å‘³ç€ï¼Œä¸€äº›ä¸å¯å˜çš„å¯¹è±¡ï¼Œä¾‹å¦‚Stringï¼Œèƒ½å¤Ÿæ”¹å˜å®ƒä»¬å€¼â€”â€”è¿™å®žåœ¨å¾ˆè®©äººéƒé—·ã€‚ æ—§çš„å†…å­˜æ¨¡åž‹å…è®¸volatileå˜é‡çš„å†™æ“ä½œå’Œéžvolaitleå˜é‡çš„è¯»å†™æ“ä½œä¸€èµ·è¿›è¡Œé‡æŽ’åºï¼Œè¿™å’Œå¤§å¤šæ•°çš„å¼€å‘äººå‘˜å¯¹äºŽvolatileå˜é‡çš„ç›´è§‚æ„Ÿå—æ˜¯ä¸ä¸€è‡´çš„ï¼Œå› æ­¤ä¼šé€ æˆè¿·æƒ‘ã€‚ æœ€åŽï¼Œæˆ‘ä»¬å°†çœ‹åˆ°çš„æ˜¯ï¼Œç¨‹åºå‘˜å¯¹äºŽç¨‹åºæ²¡æœ‰è¢«æ­£ç¡®åŒæ­¥çš„æƒ…å†µä¸‹å°†ä¼šå‘ç”Ÿä»€ä¹ˆçš„ç›´è§‚æ„Ÿå—é€šå¸¸æ˜¯é”™è¯¯çš„ã€‚JSR-133çš„ç›®çš„ä¹‹ä¸€å°±æ˜¯è¦å¼•èµ·è¿™æ–¹é¢çš„æ³¨æ„ã€‚ There were several serious problems with the old memory model. It was difficult to understand, and therefore widely violated. For example, the old model did not, in many cases, allow the kinds of reorderings that took place in every JVM. This confusion about the implications of the old model was what compelled the formation of JSR-133. One widely held belief, for example, was that if final fields were used, then synchronization between threads was unnecessary to guarantee another thread would see the value of the field. While this is a reasonable assumption and a sensible behavior, and indeed how we would want things to work, under the old memory model, it was simply not true. Nothing in the old memory model treated final fields differently from any other field â€” meaning synchronization was the only way to ensure that all threads see the value of a final field that was written by the constructor. As a result, it was possible for a thread to see the default value of the field, and then at some later time see its constructed value. This means, for example, that immutable objects like String can appear to change their value â€” a disturbing prospect indeed. The old memory model allowed for volatile writes to be reordered with nonvolatile reads and writes, which was not consistent with most developers intuitions about volatile and therefore caused confusion. Finally, as we shall see, programmersâ€™ intuitions about what can occur when their programs are incorrectly synchronized are often mistaken. One of the goals of JSR-133 is to call attention to this fact. æ²¡æœ‰æ­£ç¡®åŒæ­¥çš„å«ä¹‰æ˜¯ä»€ä¹ˆæ²¡æœ‰æ­£ç¡®åŒæ­¥çš„ä»£ç å¯¹äºŽä¸åŒçš„äººæ¥è¯´å¯èƒ½ä¼šæœ‰ä¸åŒçš„ç†è§£ã€‚åœ¨Javaå†…å­˜æ¨¡åž‹è¿™ä¸ªè¯­ä¹‰çŽ¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬è°ˆåˆ°â€œæ²¡æœ‰æ­£ç¡®åŒæ­¥â€ï¼Œæˆ‘ä»¬çš„æ„æ€æ˜¯ï¼š ä¸€ä¸ªçº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªå¯¹å˜é‡çš„å†™æ“ä½œï¼Œ å¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå˜é‡æœ‰è¯»æ“ä½œï¼Œ è€Œä¸”å†™æ“ä½œå’Œè¯»æ“ä½œæ²¡æœ‰é€šè¿‡åŒæ­¥æ¥ä¿è¯é¡ºåºã€‚ å½“è¿™äº›è§„åˆ™è¢«è¿åçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¯´åœ¨è¿™ä¸ªå˜é‡ä¸Šæœ‰ä¸€ä¸ªâ€œæ•°æ®ç«žäº‰â€(data race)ã€‚ä¸€ä¸ªæœ‰æ•°æ®ç«žäº‰çš„ç¨‹åºå°±æ˜¯ä¸€ä¸ªæ²¡æœ‰æ­£ç¡®åŒæ­¥çš„ç¨‹åºã€‚ Incorrectly synchronized code can mean different things to different people. When we talk about incorrectly synchronized code in the context of the Java Memory Model, we mean any code where there is a write of a variable by one thread, there is a read of the same variable by another thread and the write and read are not ordered by synchronization When these rules are violated, we say we have a data race on that variable. A program with a data race is an incorrectly synchronized program. åŒæ­¥ä¼šå¹²äº›ä»€ä¹ˆå‘¢åŒæ­¥æœ‰å‡ ä¸ªæ–¹é¢çš„ä½œç”¨ã€‚æœ€å¹¿ä¸ºäººçŸ¥çš„å°±æ˜¯äº’æ–¥ â€”â€”ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸèŽ·å¾—ä¸€ä¸ªç›‘è§†å™¨ï¼Œå› æ­¤ï¼Œåœ¨ä¸€ä¸ªç›‘è§†å™¨ä¸Šé¢åŒæ­¥æ„å‘³ç€ä¸€æ—¦ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åˆ°ç›‘è§†å™¨ä¿æŠ¤çš„åŒæ­¥å—ä¸­ï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½ä¸èƒ½è¿›å…¥åˆ°åŒä¸€ä¸ªç›‘è§†å™¨ä¿æŠ¤çš„å—ä¸­é—´ï¼Œé™¤éžç¬¬ä¸€ä¸ªçº¿ç¨‹é€€å‡ºäº†åŒæ­¥å—ã€‚ ä½†æ˜¯åŒæ­¥çš„å«ä¹‰æ¯”äº’æ–¥æ›´å¹¿ã€‚åŒæ­¥ä¿è¯äº†ä¸€ä¸ªçº¿ç¨‹åœ¨åŒæ­¥å—ä¹‹å‰æˆ–è€…åœ¨åŒæ­¥å—ä¸­çš„ä¸€ä¸ªå†…å­˜å†™å…¥æ“ä½œä»¥å¯é¢„çŸ¥çš„æ–¹å¼å¯¹å…¶ä»–æœ‰ç›¸åŒç›‘è§†å™¨çš„çº¿ç¨‹å¯è§ã€‚å½“æˆ‘ä»¬é€€å‡ºäº†åŒæ­¥å—ï¼Œæˆ‘ä»¬å°±é‡Šæ”¾äº†è¿™ä¸ªç›‘è§†å™¨ï¼Œè¿™ä¸ªç›‘è§†å™¨æœ‰åˆ·æ–°ç¼“å†²åŒºåˆ°ä¸»å†…å­˜çš„æ•ˆæžœï¼Œå› æ­¤è¯¥çº¿ç¨‹çš„å†™å…¥æ“ä½œèƒ½å¤Ÿä¸ºå…¶ä»–çº¿ç¨‹æ‰€è§ã€‚åœ¨æˆ‘ä»¬è¿›å…¥ä¸€ä¸ªåŒæ­¥å—ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦èŽ·å–ç›‘è§†å™¨ï¼Œç›‘è§†å™¨æœ‰ä½¿æœ¬åœ°å¤„ç†å™¨ç¼“å­˜å¤±æ•ˆçš„åŠŸèƒ½ï¼Œå› æ­¤å˜é‡ä¼šä»Žä¸»å­˜é‡æ–°åŠ è½½ï¼ŒäºŽæ˜¯å…¶å®ƒçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å½“å‰çº¿ç¨‹æ¥è¯´å°±å˜å¾—å¯è§äº†ã€‚ ä¾æ®ç¼“å­˜æ¥è®¨è®ºåŒæ­¥ï¼Œå¯èƒ½å¬èµ·æ¥è¿™äº›è§‚ç‚¹ä»…ä»…ä¼šå½±å“åˆ°å¤šå¤„ç†å™¨çš„ç³»ç»Ÿã€‚ä½†æ˜¯ï¼Œé‡æŽ’åºæ•ˆæžœèƒ½å¤Ÿåœ¨å•ä¸€å¤„ç†å™¨ä¸Šé¢å¾ˆå®¹æ˜“è§åˆ°ã€‚å¯¹ç¼–è¯‘å™¨æ¥è¯´ï¼Œåœ¨èŽ·å–ä¹‹å‰æˆ–è€…é‡Šæ”¾ä¹‹åŽç§»åŠ¨ä½ çš„ä»£ç æ˜¯ä¸å¯èƒ½çš„ã€‚å½“æˆ‘ä»¬è°ˆåˆ°åœ¨ç¼“å†²åŒºä¸Šé¢è¿›è¡Œçš„èŽ·å–å’Œé‡Šæ”¾æ“ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç®€è¿°çš„æ–¹å¼æ¥æè¿°å¤§é‡å¯èƒ½çš„å½±å“ã€‚ æ–°çš„å†…å­˜æ¨¡åž‹è¯­ä¹‰åœ¨å†…å­˜æ“ä½œï¼ˆè¯»å–å­—æ®µï¼Œå†™å…¥å­—æ®µï¼Œé”ï¼Œè§£é”ï¼‰ä»¥åŠå…¶ä»–çº¿ç¨‹çš„æ“ä½œï¼ˆstart å’Œ joinï¼‰ä¸­åˆ›å»ºäº†ä¸€ä¸ªéƒ¨åˆ†æŽ’åºï¼Œåœ¨è¿™äº›æ“ä½œä¸­ï¼Œä¸€äº›æ“ä½œè¢«ç§°ä¸ºhappen beforeå…¶ä»–æ“ä½œã€‚å½“ä¸€ä¸ªæ“ä½œåœ¨å¦å¤–ä¸€ä¸ªæ“ä½œä¹‹å‰å‘ç”Ÿï¼Œç¬¬ä¸€ä¸ªæ“ä½œä¿è¯èƒ½å¤ŸæŽ’åˆ°å‰é¢å¹¶ä¸”å¯¹ç¬¬äºŒä¸ªæ“ä½œå¯è§ã€‚è¿™äº›æŽ’åºçš„è§„åˆ™å¦‚ä¸‹ï¼š çº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œhappens beforeè¯¥çº¿ç¨‹ä¸­åœ¨ç¨‹åºé¡ºåºä¸ŠåŽç»­çš„æ¯ä¸ªæ“ä½œã€‚ è§£é”ä¸€ä¸ªç›‘è§†å™¨çš„æ“ä½œhappens beforeéšåŽå¯¹ç›¸åŒç›‘è§†å™¨è¿›è¡Œé”çš„æ“ä½œã€‚ å¯¹volatileå­—æ®µçš„å†™æ“ä½œhappens **beforeåŽç»­å¯¹ç›¸åŒvolatileå­—æ®µçš„è¯»å–æ“ä½œã€‚ çº¿ç¨‹ä¸Šè°ƒç”¨start()æ–¹æ³•happens **beforeè¿™ä¸ªçº¿ç¨‹å¯åŠ¨åŽçš„ä»»ä½•æ“ä½œã€‚ ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½happens beforeä»Žè¿™ä¸ªçº¿ç¨‹join()æ–¹æ³•æˆåŠŸè¿”å›žçš„ä»»ä½•å…¶ä»–çº¿ç¨‹ã€‚ï¼ˆæ³¨æ„æ€æ˜¯å…¶ä»–çº¿ç¨‹ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹çš„jion()æ–¹æ³•å®Œæˆï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œhappens **beforeå…¶ä»–çº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œï¼‰ è¿™æ„å‘³ç€ï¼šä»»ä½•å†…å­˜æ“ä½œï¼Œè¿™ä¸ªå†…å­˜æ“ä½œåœ¨é€€å‡ºä¸€ä¸ªåŒæ­¥å—å‰å¯¹ä¸€ä¸ªçº¿ç¨‹æ˜¯å¯è§çš„ï¼Œå¯¹ä»»ä½•çº¿ç¨‹åœ¨å®ƒè¿›å…¥ä¸€ä¸ªè¢«ç›¸åŒçš„ç›‘è§†å™¨ä¿æŠ¤çš„åŒæ­¥å—åŽéƒ½æ˜¯å¯è§çš„ï¼Œå› ä¸ºæ‰€æœ‰å†…å­˜æ“ä½œhappens beforeé‡Šæ”¾ç›‘è§†å™¨ä»¥åŠé‡Šæ”¾ç›‘è§†å™¨happens beforeèŽ·å–ç›‘è§†å™¨ã€‚ å…¶ä»–å¦‚ä¸‹æ¨¡å¼çš„å®žçŽ°è¢«ä¸€äº›äººç”¨æ¥å¼ºè¿«å®žçŽ°ä¸€ä¸ªå†…å­˜å±éšœçš„ï¼Œä¸ä¼šç”Ÿæ•ˆï¼š 1synchronized (new Object()) &#123;&#125; è¿™æ®µä»£ç å…¶å®žä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼Œä½ çš„ç¼–è¯‘å™¨ä¼šæŠŠå®ƒå®Œå…¨ç§»é™¤æŽ‰ï¼Œå› ä¸ºç¼–è¯‘å™¨çŸ¥é“æ²¡æœ‰å…¶ä»–çš„çº¿ç¨‹ä¼šä½¿ç”¨ç›¸åŒçš„ç›‘è§†å™¨è¿›è¡ŒåŒæ­¥ã€‚è¦çœ‹åˆ°å…¶ä»–çº¿ç¨‹çš„ç»“æžœï¼Œä½ å¿…é¡»ä¸ºä¸€ä¸ªçº¿ç¨‹å»ºç«‹happens beforeå…³ç³»ã€‚ é‡ç‚¹æ³¨æ„ï¼šå¯¹ä¸¤ä¸ªçº¿ç¨‹æ¥è¯´ï¼Œä¸ºäº†æ­£ç¡®å»ºç«‹happens beforeå…³ç³»è€Œåœ¨ç›¸åŒç›‘è§†å™¨ä¸Šé¢è¿›è¡ŒåŒæ­¥æ˜¯éžå¸¸é‡è¦çš„ã€‚ä»¥ä¸‹è§‚ç‚¹æ˜¯é”™è¯¯çš„ï¼šå½“çº¿ç¨‹Aåœ¨å¯¹è±¡Xä¸Šé¢åŒæ­¥çš„æ—¶å€™ï¼Œæ‰€æœ‰ä¸œè¥¿å¯¹çº¿ç¨‹Aå¯è§ï¼Œçº¿ç¨‹Båœ¨å¯¹è±¡Yä¸Šé¢è¿›è¡ŒåŒæ­¥çš„æ—¶å€™ï¼Œæ‰€æœ‰ä¸œè¥¿å¯¹çº¿ç¨‹Bä¹Ÿæ˜¯å¯è§çš„ã€‚é‡Šæ”¾ç›‘è§†å™¨å’ŒèŽ·å–ç›‘è§†å™¨å¿…é¡»åŒ¹é…ï¼ˆä¹Ÿå°±æ˜¯è¯´è¦åœ¨ç›¸åŒçš„ç›‘è§†å™¨ä¸Šé¢å®Œæˆè¿™ä¸¤ä¸ªæ“ä½œï¼‰ï¼Œå¦åˆ™ï¼Œä»£ç å°±ä¼šå­˜åœ¨â€œæ•°æ®ç«žäº‰â€ã€‚ Synchronization has several aspects. The most well-understood is mutual exclusion â€” only one thread can hold a monitor at once, so synchronizing on a monitor means that once one thread enters a synchronized block protected by a monitor, no other thread can enter a block protected by that monitor until the first thread exits the synchronized block. But there is more to synchronization than mutual exclusion. Synchronization ensures that memory writes by a thread before or during a synchronized block are made visible in a predictable manner to other threads which synchronize on the same monitor. After we exit a synchronized block, we release the monitor, which has the effect of flushing the cache to main memory, so that writes made by this thread can be visible to other threads. Before we can enter a synchronized block, we acquire the monitor, which has the effect of invalidating the local processor cache so that variables will be reloaded from main memory. We will then be able to see all of the writes made visible by the previous release. Discussing this in terms of caches, it may sound as if these issues only affect multiprocessor machines. However, the reordering effects can be easily seen on a single processor. It is not possible, for example, for the compiler to move your code before an acquire or after a release. When we say that acquires and releases act on caches, we are using shorthand for a number of possible effects. The new memory model semantics create a partial ordering on memory operations (read field, write field, lock, unlock) and other thread operations (start and join), where some actions are said to happen before other operations. When one action happens before another, the first is guaranteed to be ordered before and visible to the second. The rules of this ordering are as follows: Each action in a thread happens before every action in that thread that comes later in the programâ€™s order. An unlock on a monitor happens before every subsequent lock on that same monitor. A write to a volatile field happens before every subsequent read of that same volatile. A call to start() on a thread happens before any actions in the started thread. All actions in a thread happen before any other thread successfully returns from a join()on that thread. This means that any memory operations which were visible to a thread before exiting a synchronized block are visible to any thread after it enters a synchronized block protected by the same monitor, since all the memory operations happen before the release, and the release happens before the acquire. Another implication is that the following pattern, which some people use to force a memory barrier, doesnâ€™t work: 1synchronized (new Object()) &#123;&#125; This is actually a no-op, and your compiler can remove it entirely, because the compiler knows that no other thread will synchronize on the same monitor. You have to set up a happens-before relationship for one thread to see the results of another. Important Note: Note that it is important for both threads to synchronize on the same monitor in order to set up the happens-before relationship properly. It is not the case that everything visible to thread A when it synchronizes on object X becomes visible to thread B after it synchronizes on object Y. The release and acquire have to â€œmatchâ€ (i.e., be performed on the same monitor) to have the right semantics. Otherwise, the code has a data race. åœ¨æ–°çš„Javaå†…å­˜æ¨¡åž‹ä¸­ï¼Œfinalå­—æ®µæ˜¯å¦‚ä½•å·¥ä½œçš„How can final fields appear to change their values?One of the best examples of how final fieldsâ€™ values can be seen to change involves one particular implementation of the String class. A String can be implemented as an object with three fields â€” a character array, an offset into that array, and a length. The rationale for implementing String this way, instead of having only the character array, is that it lets multiple String and StringBufferobjects share the same character array and avoid additional object allocation and copying. So, for example, the method String.substring() can be implemented by creating a new string which shares the same character array with the original String and merely differs in the length and offset fields. For a String, these fields are all final fields. 12String s1 = "/usr/tmp";String s2 = s1.substring(4); The string s2 will have an offset of 4 and a length of 4. But, under the old model, it was possible for another thread to see the offset as having the default value of 0, and then later see the correct value of 4, it will appear as if the string â€œ/usrâ€ changes to â€œ/tmpâ€. The original Java Memory Model allowed this behavior; several JVMs have exhibited this behavior. The new Java Memory Model makes this illegal. ä¸€ä¸ªå¯¹è±¡çš„finalå­—æ®µå€¼æ˜¯åœ¨å®ƒçš„æž„é€ æ–¹æ³•é‡Œé¢è®¾ç½®çš„ã€‚å‡è®¾å¯¹è±¡è¢«æ­£ç¡®çš„æž„é€ äº†ï¼Œä¸€æ—¦å¯¹è±¡è¢«æž„é€ ï¼Œåœ¨æž„é€ æ–¹æ³•é‡Œé¢è®¾ç½®ç»™finalå­—æ®µçš„çš„å€¼åœ¨æ²¡æœ‰åŒæ­¥çš„æƒ…å†µä¸‹å¯¹æ‰€æœ‰å…¶ä»–çš„çº¿ç¨‹éƒ½ä¼šå¯è§ã€‚å¦å¤–ï¼Œå¼•ç”¨è¿™äº›finalå­—æ®µçš„å¯¹è±¡æˆ–æ•°ç»„éƒ½å°†ä¼šçœ‹åˆ°finalå­—æ®µçš„æœ€æ–°å€¼ã€‚ å¯¹ä¸€ä¸ªå¯¹è±¡æ¥è¯´ï¼Œè¢«æ­£ç¡®çš„æž„é€ æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿç®€å•æ¥è¯´ï¼Œå®ƒæ„å‘³ç€è¿™ä¸ªæ­£åœ¨æž„é€ çš„å¯¹è±¡çš„å¼•ç”¨åœ¨æž„é€ æœŸé—´æ²¡æœ‰è¢«å…è®¸é€¸å‡ºã€‚ï¼ˆå‚è§å®‰å…¨æž„é€ æŠ€æœ¯ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œä¸è¦è®©å…¶ä»–çº¿ç¨‹åœ¨å…¶ä»–åœ°æ–¹èƒ½å¤Ÿçœ‹è§ä¸€ä¸ªæž„é€ æœŸé—´çš„å¯¹è±¡å¼•ç”¨ã€‚ä¸è¦æŒ‡æ´¾ç»™ä¸€ä¸ªé™æ€å­—æ®µï¼Œä¸è¦ä½œä¸ºä¸€ä¸ªlisteneræ³¨å†Œç»™å…¶ä»–å¯¹è±¡ç­‰ç­‰ã€‚è¿™äº›æ“ä½œåº”è¯¥åœ¨æž„é€ æ–¹æ³•ä¹‹åŽå®Œæˆï¼Œè€Œä¸æ˜¯æž„é€ æ–¹æ³•ä¸­æ¥å®Œæˆã€‚ 1234567891011121314151617181920class FinalFieldExample &#123; final int x; int y; static FinalFieldExample f; public FinalFieldExample() &#123; x = 3; y = 4; &#125; static void writer() &#123; f = new FinalFieldExample(); &#125; static void reader() &#123; if (f != null) &#123; int i = f.x; int j = f.y; &#125; &#125;&#125; ä¸Šé¢çš„ç±»å±•ç¤ºäº†finalå­—æ®µåº”è¯¥å¦‚ä½•ä½¿ç”¨ã€‚ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œreaderæ–¹æ³•çš„çº¿ç¨‹ä¿è¯çœ‹åˆ°f.xçš„å€¼ä¸º3ï¼Œå› ä¸ºå®ƒæ˜¯finalå­—æ®µã€‚å®ƒä¸ä¿è¯çœ‹åˆ°f.yçš„å€¼ä¸º4ï¼Œå› ä¸ºf.yä¸æ˜¯finalå­—æ®µã€‚å¦‚æžœFinalFieldExampleçš„æž„é€ æ–¹æ³•åƒè¿™æ ·ï¼š 123456public FinalFieldExample() &#123; // bad! x = 3; y = 4; // bad construction - allowing this to escape global.obj = this;&#125; é‚£ä¹ˆï¼Œä»Žglobal.objä¸­è¯»å–thisçš„å¼•ç”¨çº¿ç¨‹ä¸ä¼šä¿è¯è¯»å–åˆ°çš„xçš„å€¼ä¸º3ã€‚ èƒ½å¤Ÿçœ‹åˆ°å­—æ®µçš„æ­£ç¡®çš„æž„é€ å€¼å›ºç„¶ä¸é”™ï¼Œä½†æ˜¯ï¼Œå¦‚æžœå­—æ®µæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆï¼Œä½ è¿˜æ˜¯å¸Œæœ›ä½ çš„ä»£ç èƒ½å¤Ÿçœ‹åˆ°å¼•ç”¨æ‰€æŒ‡å‘çš„è¿™ä¸ªå¯¹è±¡ï¼ˆæˆ–è€…æ•°ç»„ï¼‰çš„æœ€æ–°å€¼ã€‚å¦‚æžœä½ çš„å­—æ®µæ˜¯finalå­—æ®µï¼Œé‚£ä¹ˆè¿™æ˜¯èƒ½å¤Ÿä¿è¯çš„ã€‚å› æ­¤ï¼Œå½“ä¸€ä¸ªfinalæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ•°ç»„ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°å¼•ç”¨çš„æœ€æ–°å€¼å´çœ‹ä¸åˆ°å¼•ç”¨æ‰€æŒ‡å‘çš„æ•°ç»„çš„æœ€æ–°å€¼ã€‚é‡å¤ä¸€ä¸‹ï¼Œè¿™å„¿çš„â€œæ­£ç¡®çš„â€çš„æ„æ€æ˜¯â€œå¯¹è±¡æž„é€ æ–¹æ³•ç»“å°¾çš„æœ€æ–°çš„å€¼â€è€Œä¸æ˜¯â€œæœ€æ–°å¯ç”¨çš„å€¼â€ã€‚ çŽ°åœ¨ï¼Œåœ¨è®²äº†å¦‚ä¸Šçš„è¿™æ®µä¹‹åŽï¼Œå¦‚æžœåœ¨ä¸€ä¸ªçº¿ç¨‹æž„é€ äº†ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ä¹‹åŽï¼ˆå¯¹è±¡ä»…åŒ…å«finalå­—æ®µï¼‰ï¼Œä½ å¸Œæœ›ä¿è¯è¿™ä¸ªå¯¹è±¡è¢«å…¶ä»–çº¿ç¨‹æ­£ç¡®çš„æŸ¥çœ‹ï¼Œä½ ä»ç„¶éœ€è¦ä½¿ç”¨åŒæ­¥æ‰è¡Œã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰å…¶ä»–çš„æ–¹å¼å¯ä»¥ä¿è¯ä¸å¯å˜å¯¹è±¡çš„å¼•ç”¨å°†è¢«ç¬¬äºŒä¸ªçº¿ç¨‹çœ‹åˆ°ã€‚ä½¿ç”¨finalå­—æ®µçš„ç¨‹åºåº”è¯¥ä»”ç»†çš„è°ƒè¯•ï¼Œè¿™éœ€è¦æ·±å…¥è€Œä¸”ä»”ç»†çš„ç†è§£å¹¶å‘åœ¨ä½ çš„ä»£ç ä¸­æ˜¯å¦‚ä½•è¢«ç®¡ç†çš„ã€‚ å¦‚æžœä½ ä½¿ç”¨JNIæ¥æ”¹å˜ä½ çš„finalå­—æ®µï¼Œè¿™æ–¹é¢çš„è¡Œä¸ºæ˜¯æ²¡æœ‰å®šä¹‰çš„ã€‚]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>javaå†…å­˜æ¨¡åž‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mac ä¸­æ–‡ç‰ˆmanå®‰è£…]]></title>
    <url>%2F2018%2F03%2F05%2Fmac-%E4%B8%AD%E6%96%87%E7%89%88man%E5%AE%89%E8%A3%85%2F</url>
    <content type="text"><![CDATA[Mac 10.13 å®‰è£…ä¸­æ–‡ç‰ˆ man å‘½ä»¤æœ¬æ–‡å‚è€ƒäºŽ ã€ŠMac å®‰è£…manå‘½ä»¤ä¸­æ–‡æ–‡æ¡£ã€‹ï¼Œä½†åŽŸæ–‡æä¾›çš„é“¾æŽ¥ä»¥åŠå®‰è£…çš„ç‰ˆæœ¬æ¯”è¾ƒè€æ—§ã€‚å› æ­¤é‡æ–°æ•´ç†æ–°ç‰ˆåœ¨è¿™è¾¹æä¾›ç»™å¤§å®¶ã€‚ ä¸ºä»€ä¹ˆéœ€è¦ man ä»¥åŠ man æ€Žä¹ˆä½¿ç”¨linux æˆ–è€… mac ç³»ç»Ÿçš„å‘½ä»¤è¡Œå·¥å…·éžå¸¸å¤šï¼Œå¯æ˜¯æˆ‘ä»¬ä¸èƒ½è®°ä½æ‰€æœ‰çš„è¿™äº›å‘½ä»¤ï¼Œé€šå¸¸åªèƒ½è®°ä½ä¸€äº›æˆ‘ä»¬å¸¸ç”¨çš„ã€‚é‡åˆ°ä¸å¸¸ç”¨çš„æˆ‘ä»¬éœ€è¦æ¥æŸ¥è¯¢ä¸€ä¸‹è¿™ä¸ªå‘½ä»¤æ˜¯æ€Žä¹ˆä½¿ç”¨çš„ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ° man å‘½ä»¤äº†ã€‚ ä½¿ç”¨æ–¹æ³•ä¹Ÿéžå¸¸ç®€å•ï¼Œä¾‹å¦‚æˆ‘ä»¬ä¸æ¸…æ¥š ls è¿™ä¸ªå‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ 1man ls1 æ¥æŸ¥çœ‹è¿™ä¸ªå‘½ä»¤çš„è¯¦æƒ…ã€‚ ä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œè¾“å‡ºçš„å†…å®¹æ˜¯è‹±æ–‡çš„ã€‚å¯èƒ½å¾ˆå¤šè‹±æ–‡ä¸å¥½çš„æœ‹å‹å¸Œæœ›æœ‰ä¸­æ–‡ç‰ˆæœ¬çš„ man ï¼Œè¿™ç¯‡åšæ–‡å°±æ˜¯å‘Šè¯‰å¤§å®¶ï¼Œå¦‚ä½•åœ¨ macä¸Šå®‰è£…ä¸­æ–‡ç‰ˆæœ¬çš„çš„ manã€‚ è‡³äºŽ linux ç³»ç»Ÿåˆ™éžå¸¸ç®€å•ï¼ŒæŸ¥çœ‹ https://github.com/man-pages-zh/manpages-zh ä¸­å¯¹åº”çš„ç‰ˆæœ¬ï¼Œå³å¯ç”¨ç®€å•çš„å‘½ä»¤å®‰è£…ã€‚ ä¸‹è½½ manpages-zh ç¼–è¾‘å®‰è£…é¦–å…ˆï¼Œæˆ‘ä»¬æ‰“å¼€ä¸Šé¢çš„ github åœ°å€ï¼Œç‚¹å‡» releases ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ tar.gz æºç åŒ…ã€‚ç›®å‰æˆ‘ä¸‹è½½åˆ°çš„æ˜¯ 1.6.3.2 ç‰ˆæœ¬çš„ã€‚ å› ä¸ºéœ€è¦ç¼–è¯‘å®‰è£…ï¼Œæ‰€ä»¥ä½ ç”µè„‘ä¸Šéœ€è¦æœ‰ç¼–è¯‘å·¥å…·ï¼Œè¿è¡Œä¸‹é¢ä¸¤ä¸ªå‘½ä»¤å®‰è£… 12brew install automakebrew install opencc12 æˆ‘è¿™è¾¹æ˜¯éœ€è¦å®‰è£…è¿™ä¸¤ä¸ªç¼–è¯‘å·¥å…·ï¼Œå¦‚æžœä½ ä¸‹é¢ç¼–è¯‘å‡ºé”™ï¼Œä¼šæç¤ºä½ éœ€è¦å®‰è£…è¯´æ˜Žç¼–è¾‘å·¥å…·çš„ã€‚åˆ©ç”¨ brew å®‰è£…å³å¯ã€‚ å¦‚æžœä½ ç”µè„‘æ²¡æœ‰å®‰è£… brew å·¥å…·ï¼Œè¯·å‚è€ƒ http://blog.csdn.net/FungLeo/article/details/57567538 è¿™ç¯‡åšæ–‡å®‰è£… å¥½ï¼Œå‡†å¤‡å·¥ä½œåšå¥½ï¼Œæˆ‘ä»¬æŽ¥ç€æ¥ã€‚ 12345678910111213141516171819202122# è¿›å…¥ä¸‹è½½ç›®å½•cd ~/Downloads/# ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„æºç åŒ…wget https://github.com/man-pages-zh/manpages-zh/archive/v1.6.3.2.tar.gz# è§£åŽ‹æºç åŒ…(atoolå‘½ä»¤ï¼ŒæŽ¨èå®‰è£…è¿™ä¸ªå·¥å…·ï¼Œç»Ÿä¸€æ‰€æœ‰åŽ‹ç¼©æ–‡æ¡£çš„å‘½ä»¤ï¼‰atool -x v1.6.3.2.tar.gz# æˆ–è€…ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è§£åŽ‹tar zxvf v1.6.3.2.tar.gz# è¿›å…¥æºç åŒ…æ–‡ä»¶å¤¹cd manpages-zh-1.6.3.2/# ç¼–è¯‘å®‰è£… 1autoreconf --install --force# ç¼–è¯‘å®‰è£… 2./configure# ç¼–è¯‘å®‰è£… 3make# ç¼–è¯‘å®‰è£… 4sudo make install# é…ç½®åˆ«åecho "alias cman='man -M /usr/local/share/man/zh_CN'" &gt;&gt; ~/.bash_profile# ä½¿åˆ«åç”Ÿæ•ˆ. ~/.bash_profile12345678910111213141516171819202122 è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®‰è£…ä¸Šäº†ä¸­æ–‡ç‰ˆæœ¬çš„ man å·¥å…·äº†ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ 1cman ls1 æ¥æŸ¥çœ‹ä¸­æ–‡ç‰ˆæœ¬çš„è§£é‡Šäº†ã€‚ä½†æ˜¯ç”±äºŽ mac ä¸Šçš„ groff å·¥å…·æ¯”è¾ƒè€ï¼Œæ‰€ä»¥ä¸­æ–‡ä¼šå‡ºçŽ°ä¹±ç ã€‚æˆ‘ä»¬æ¥è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚ å®‰è£… groff æ–°ç‰ˆæœ¬è§£å†³ä¸­æ–‡ä¹±ç çš„é—®é¢˜é¦–å…ˆï¼Œæˆ‘ä»¬åˆ° http://git.savannah.gnu.org/cgit/groff.git è¿™ä¸ªé¡µé¢ä¸‹è½½ 1.22 ç‰ˆæœ¬çš„ groff å®‰è£…åŒ…ã€‚æˆ‘è¿™è¾¹ç”¨å‘½ä»¤è¡Œä¸‹è½½ï¼Œä½ å¦‚æžœç›´æŽ¥å¤åˆ¶æˆ‘çš„å‘½ä»¤ï¼Œä¸èƒ½ä¸‹è½½ï¼Œè¯·åˆ°ä¸Šé¢çš„åœ°å€åŽ»çœ‹çœ‹ä¸‹è½½åœ°å€æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚ 1234567891011121314# è¿›å…¥ä¸‹è½½ç›®å½•cd ~/Downloads/# ä¸‹è½½1.22ç‰ˆæœ¬çš„æºç åŒ…wget http://git.savannah.gnu.org/cgit/groff.git/snapshot/groff-1.22.tar.gz# è§£åŽ‹atool -x groff-1.22.tar.gz# è¿›å…¥ç›®å½•cd groff-1.22# ç¼–è¯‘å®‰è£…./configuresudo makesudo make install# æ·»åŠ é…ç½®sudo vim /etc/man.conf1234567891011121314 è¿›å…¥ç¼–è¾‘ä¹‹åŽï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  1NROFF preconv -e UTF8 | /usr/local/bin/nroff -Tutf8 -mandoc -c1 æœ€åŽ :wq ä¿å­˜é€€å‡º ç„¶åŽï¼Œæˆ‘ä»¬åœ¨è¾“å…¥ 1cman ls1 å°±å¯ä»¥çœ‹åˆ°ä¸­æ–‡ç‰ˆæœ¬çš„å‘½ä»¤ä»‹ç»äº†ã€‚]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[JFRä½¿ç”¨æ–¹æ³•]]></title>
    <url>%2F2018%2F02%2F07%2Fjmc%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%2F</url>
    <content type="text"><![CDATA[JFRä½¿ç”¨æ–¹å¼æŒ‰ç…§ä¸‹é¢ä¸‰ä¸ªæ­¥éª¤æ“ä½œï¼› é€‰å®šä¸€å°æœºå™¨ï¼Œç™»é™†ä¸ŠåŽ»ï¼Œå¹¶æ‰¾åˆ°è¦ç›‘æŽ§çš„è¿›ç¨‹PID å°†é™„ä»¶æ–‡ä»¶(*.jfc)æ”¾å…¥åˆ° /usr/install/java/jdk1.8.0_60/jre/lib/jfr ç›®å½•ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯åœ¨å®˜æ–¹é…ç½®ä¸Šå¢žåŠ äº†å¯¹å¼‚å¸¸æ•°æ®çš„é‡‡é›†ã€‚æŽ¨èä½¿ç”¨ã€‚ æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼Œå…¶ä¸­è¯·è‡ªè¡Œæ›¿æ¢ï¼š è¿™æ ·å°±å¥½äº†ï¼Œå¦‚ä¸Šï¼Œç­‰å¾…2åˆ†é’Ÿï¼‹20ç§’ï¼Œ/tmp/pid.jfræ–‡ä»¶å°±ç”Ÿæˆå¥½äº†ï¼Œè¿™ä¸ªæ–‡ä»¶ç›´æŽ¥å¯¼å…¥JMCå·¥å…·å³å¯ 12345678jcmd &lt;pid&gt; VM.unlock_commercial_features #å…ˆè§£é”æŠ€èƒ½jcmd &lt;pid&gt; JFR.start name=myrec settings=tongdun delay=20s duration=2m filename=/tmp/pid.jfr#å…¶ä¸­ï¼Œdelayå‚æ•°è¡¨ç¤ºprofileå»¶è¿Ÿå¯åŠ¨æ—¶é—´ï¼Œdurationè¡¨ç¤ºæŒç»­é‡‡é›†æ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®ä¸º2åˆ†é’Ÿ#settingsè¡¨ç¤ºä½¿ç”¨å“ªç§é‡‡é›†é…ç½®ï¼Œè¿™é‡Œç”¨çš„å°±æ˜¯ç¬¬äºŒæ­¥ä¸­æ”¾å…¥çš„tongdun.jfcé…ç½®ï¼Œå®ƒé»˜è®¤æœ‰ä¸€ä¸ªåä¸ºprofileçš„é…ç½®ï¼Œå¦‚æžœä¸æƒ³é‡‡é›†å¼‚å¸¸ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥ç”¨å®ƒã€‚#æ³¨æ„ï¼Œé‡‡é›†æ•°æ®ç”ŸæˆåŽè¯·æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ç§»é™¤è¿™ä¸ªé‡‡é›†jcmd &lt;pid&gt; JFR.stop name=myrec]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[jdkä¹‹çº¿ä¸Šé«˜å†…å­˜å ç”¨]]></title>
    <url>%2F2018%2F02%2F07%2Fjdk%E4%B9%8B%E7%BA%BF%E4%B8%8A%E9%AB%98%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%2F</url>
    <content type="text"><![CDATA[123456789101112131415161718192021#æ‰¾åˆ°å ç”¨å†…å­˜é«˜çš„javaè¿›ç¨‹top#æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µjmp -heap [pid]#æŸ¥çœ‹å ç”¨å†…å­˜é«˜çš„å¯¹è±¡jmp -histo:live [pid] | head -n 100#æŸ¥çœ‹å ç”¨å†…å­˜é«˜çš„å¯¹è±¡,dumpæˆæ–‡ä»¶ï¼Œçº¿ä¸‹åˆ†æžjmap -dump:live,format=b,file=xxx.xxx [pid]#æŸ¥çœ‹è¿›ç¨‹çš„çº¿ç¨‹æƒ…å†µps p [pid] -L -o pcpu,pmem,pid,tid,time,tname,cmd#çº¿ç¨‹idæ‰“å°æˆ16è¿›åˆ¶printf "%x\n" [tid]#è¾“å‡ºjavaè¿›ç¨‹å †æ ˆåˆ°æ–‡ä»¶jstack -l [pid] &gt; jstack.log#vim æŸ¥æ‰¾16è¿›åˆ¶çš„tidï¼Œ runnableæ­£å¸¸çŠ¶æ€ï¼ŒWAITINGä¸€ç›´ç­‰é‚£ä¸ªæ¡ä»¶å‘ç”Ÿï¼ŒTIMED_WAITINGå®šæ—¶çš„é‚£ä¸ªæ¡ä»¶ä¸åˆ°æ¥ä¹Ÿå°†å®šæ—¶å”¤é†’è‡ªå·±vim jstack.log jmapå‘½ä»¤æœ‰ä¸‹é¢å‡ ç§å¸¸ç”¨çš„ç”¨æ³•ï¼š â€¢jmap [pid] â€¢jmap -histo:live [pid] &gt;a.log â€¢jmap -dump:live,format=b,file=xxx.xxx [pid] ç”¨å¾—æœ€å¤šæ˜¯åŽé¢ä¸¤ä¸ªã€‚å…¶ä¸­ï¼Œjmap -histo:live [pid] å¯ä»¥æŸ¥çœ‹å½“å‰Javaè¿›ç¨‹åˆ›å»ºçš„æ´»è·ƒå¯¹è±¡æ•°ç›®å’Œå ç”¨å†…å­˜å¤§å°ã€‚ jmap -dump:live,format=b,file=xxx.xxx [pid] åˆ™å¯ä»¥å°†å½“å‰Javaè¿›ç¨‹çš„å†…å­˜å ç”¨æƒ…å†µå¯¼å‡ºæ¥ï¼Œæ–¹ä¾¿ç”¨ä¸“é—¨çš„å†…å­˜åˆ†æžå·¥å…·ï¼ˆä¾‹å¦‚ï¼šMATï¼‰æ¥åˆ†æžã€‚ è¿™ä¸ªå‘½ä»¤å¯¹äºŽåˆ†æžæ˜¯å¦æœ‰å†…å­˜æ³„æ¼å¾ˆæœ‰å¸®åŠ©ã€‚å…·ä½“æ€Žä¹ˆä½¿ç”¨å¯ä»¥æŸ¥çœ‹æœ¬åšçš„å¦ä¸€ç¯‡æ–‡ç« ï¼šåˆ©ç”¨Eclipse Memory Analyzer Toolï¼ˆMATï¼‰åˆ†æžå†…å­˜æ³„æ¼ é¦–å…ˆçœ‹ä¸€ä¸‹ä¸€ä¸ªjavaè¿›ç¨‹çš„jmapè¾“å‡ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748[lex@chou ~]$ jmap -heap 837Attaching to process ID 837, please wait...Debugger attached successfully.Server compiler detected.JVM version is 20.10-b01using thread-local object allocation.Parallel GC with 2 thread(s)Heap Configuration: MinHeapFreeRatio = 40 MaxHeapFreeRatio = 70 MaxHeapSize = 4294967296 (4096.0MB) NewSize = 1310720 (1.25MB) MaxNewSize = 17592186044415 MB OldSize = 5439488 (5.1875MB) NewRatio = 2 SurvivorRatio = 8 PermSize = 21757952 (20.75MB) MaxPermSize = 85983232 (82.0MB)Heap Usage:PS Young GenerationEden Space: capacity = 41025536 (39.125MB) used = 18413552 (17.560531616210938MB) free = 22611984 (21.564468383789062MB) 44.883147900858624% usedFrom Space: capacity = 4325376 (4.125MB) used = 3702784 (3.53125MB) free = 622592 (0.59375MB) 85.60606060606061% usedTo Space: capacity = 4521984 (4.3125MB) used = 0 (0.0MB) free = 4521984 (4.3125MB) 0.0% usedPS Old Generation capacity = 539820032 (514.8125MB) used = 108786168 (103.74657440185547MB) free = 431033864 (411.06592559814453MB) 20.152302906758376% usedPS Perm Generation capacity = 85983232 (82.0MB) used = 60770232 (57.95500946044922MB) free = 25213000 (24.04499053955078MB) 70.67684080542588% used ç„¶åŽå†ç”¨psçœ‹çœ‹ï¼š 123[lex@chou ~]$ ps -p 837 -o vsz,rss VSZ RSS7794992 3047320 å…³äºŽè¿™é‡Œçš„å‡ ä¸ªgenerationç½‘ä¸Šèµ„æ–™ä¸€å¤§æŠŠå°±ä¸ç»†è¯´äº†ï¼Œè¿™é‡Œç®—ä¸€ä¸‹æ±‚å’Œå¯ä»¥å¾—çŸ¥å‰è€…æ€»å…±ç»™JavaçŽ¯å¢ƒåˆ†é…äº†644Mçš„å†…å­˜ï¼Œè€Œpsè¾“å‡ºçš„VSZå’ŒRSSåˆ†åˆ«æ˜¯7.4Gå’Œ2.9Gï¼Œè¿™åˆ°åº•æ˜¯æ€Žä¹ˆå›žäº‹å‘¢ï¼Ÿå‰é¢jmapè¾“å‡ºçš„å†…å®¹é‡Œï¼ŒMaxHeapSize æ˜¯åœ¨å‘½ä»¤è¡Œä¸Šé…çš„ï¼Œ-Xmx4096mï¼Œè¿™ä¸ªjavaç¨‹åºå¯ä»¥ç”¨åˆ°çš„æœ€å¤§å †å†…å­˜ã€‚VSZæ˜¯æŒ‡å·²åˆ†é…çš„çº¿æ€§ç©ºé—´å¤§å°ï¼Œè¿™ä¸ªå¤§å°é€šå¸¸å¹¶ä¸ç­‰äºŽç¨‹åºå®žé™…ç”¨åˆ°çš„å†…å­˜å¤§å°ï¼Œäº§ç”Ÿè¿™ä¸ªçš„å¯èƒ½æ€§å¾ˆå¤šï¼Œæ¯”å¦‚å†…å­˜æ˜ å°„ï¼Œå…±äº«çš„åŠ¨æ€åº“ï¼Œæˆ–è€…å‘ç³»ç»Ÿç”³è¯·äº†æ›´å¤šçš„å †ï¼Œéƒ½ä¼šæ‰©å±•çº¿æ€§ç©ºé—´å¤§å°ï¼Œè¦æŸ¥çœ‹ä¸€ä¸ªè¿›ç¨‹æœ‰å“ªäº›å†…å­˜æ˜ å°„ï¼Œå¯ä»¥ä½¿ç”¨ pmap å‘½ä»¤æ¥æŸ¥çœ‹ï¼š 12345678910111213141516[lex@chou ~]$ pmap -x 837837: javaAddress Kbytes RSS Dirty Mode Mapping0000000040000000 36 4 0 r-x-- java0000000040108000 8 8 8 rwx-- java00000000418c9000 13676 13676 13676 rwx-- [ anon ]00000006fae00000 83968 83968 83968 rwx-- [ anon ]0000000700000000 527168 451636 451636 rwx-- [ anon ]00000007202d0000 127040 0 0 ----- [ anon ]......00007f55ee124000 4 4 0 r-xs- az.png00007fff017ff000 4 4 0 r-x-- [ anon ]ffffffffff600000 4 0 0 r-x-- [ anon ]---------------- ------ ------ ------total kB 7796020 3037264 3023928 è¿™é‡Œå¯ä»¥çœ‹åˆ°å¾ˆå¤šanonï¼Œè¿™äº›è¡¨ç¤ºè¿™å—å†…å­˜æ˜¯ç”±mmapåˆ†é…çš„ã€‚ RSZæ˜¯Resident Set Sizeï¼Œå¸¸é©»å†…å­˜å¤§å°ï¼Œå³è¿›ç¨‹å®žé™…å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œ åœ¨çŽ°åœ¨è¿™ä¸ªä¾‹å­å½“ä¸­ï¼ŒRSZå’Œå®žé™…å †å†…å­˜å ç”¨å·®äº†2.3Gï¼Œè¿™2.3Gçš„å†…å­˜ç»„æˆåˆ†åˆ«ä¸ºï¼š JVMæœ¬èº«éœ€è¦çš„å†…å­˜ï¼ŒåŒ…æ‹¬å…¶åŠ è½½çš„ç¬¬ä¸‰æ–¹åº“ä»¥åŠè¿™äº›åº“åˆ†é…çš„å†…å­˜ NIOçš„DirectBufferæ˜¯åˆ†é…çš„native memory å†…å­˜æ˜ å°„æ–‡ä»¶ï¼ŒåŒ…æ‹¬JVMåŠ è½½çš„ä¸€äº›JARå’Œç¬¬ä¸‰æ–¹åº“ï¼Œä»¥åŠç¨‹åºå†…éƒ¨ç”¨åˆ°çš„ã€‚ä¸Šé¢ pmap è¾“å‡ºçš„å†…å®¹é‡Œï¼Œæœ‰ä¸€äº›é™æ€æ–‡ä»¶æ‰€å ç”¨çš„å¤§å°ä¸åœ¨Javaçš„heapé‡Œï¼Œå› æ­¤ä½œä¸ºä¸€ä¸ªWebæœåŠ¡å™¨ï¼Œèµ¶ç´§æŠŠé™æ€æ–‡ä»¶ä»Žè¿™ä¸ªWebæœåŠ¡å™¨ä¸­äººç§»å¼€å§ï¼Œæ”¾åˆ°nginxæˆ–è€…CDNé‡ŒåŽ»å§ã€‚ JITï¼Œ JVMä¼šå°†Classç¼–è¯‘æˆnativeä»£ç ï¼Œè¿™äº›å†…å­˜ä¹Ÿä¸ä¼šå°‘ï¼Œå¦‚æžœä½¿ç”¨äº†Springçš„AOPï¼ŒCGLIBä¼šç”Ÿæˆæ›´å¤šçš„ç±»ï¼ŒJITçš„å†…å­˜å¼€é”€ä¹Ÿä¼šéšä¹‹å˜å¤§ï¼Œè€Œä¸”Classæœ¬èº«JVMçš„GCä¼šå°†å…¶æ”¾åˆ°Perm Generationé‡ŒåŽ»ï¼Œå¾ˆéš¾è¢«å›žæ”¶æŽ‰ï¼Œé¢å¯¹è¿™ç§æƒ…å†µï¼Œåº”è¯¥è®©JVMä½¿ç”¨ConcurrentMarkSweep GCï¼Œå¹¶å¯ç”¨è¿™ä¸ªGCçš„ç›¸å…³å‚æ•°å…è®¸å°†ä¸ä½¿ç”¨çš„classä»ŽPerm Generationä¸­ç§»é™¤ï¼Œ å‚æ•°é…ç½®ï¼š -XX:+UseConcMarkSweepGC -X:+CMSPermGenSweepingEnabled -X:+CMSClassUnloadingEnabledï¼Œå¦‚æžœä¸éœ€è¦ç§»é™¤è€ŒPerm Generationç©ºé—´ä¸å¤Ÿï¼Œå¯ä»¥åŠ å¤§ä¸€ç‚¹ï¼š -X:PermSize=256M -X:MaxPermSize=512M JNIï¼Œä¸€äº›JNIæŽ¥å£è°ƒç”¨çš„nativeåº“ä¹Ÿä¼šåˆ†é…ä¸€äº›å†…å­˜ï¼Œå¦‚æžœé‡åˆ°JNIåº“çš„å†…å­˜æ³„éœ²ï¼Œå¯ä»¥ä½¿ç”¨valgrindç­‰å†…å­˜æ³„éœ²å·¥å…·æ¥æ£€æµ‹ çº¿ç¨‹æ ˆï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è‡ªå·±çš„æ ˆç©ºé—´ï¼Œå¦‚æžœçº¿ç¨‹ä¸€å¤šï¼Œè¿™ä¸ªçš„å¼€é”€å°±å¾ˆæ˜Žæ˜¾äº† jmap/jstack é‡‡æ ·ï¼Œé¢‘ç¹çš„é‡‡æ ·ä¹Ÿä¼šå¢žåŠ å†…å­˜å ç”¨ï¼Œå¦‚æžœä½ æœ‰æœåŠ¡å™¨å¥åº·ç›‘æŽ§ï¼Œè®°å¾—è¿™ä¸ªé¢‘çŽ‡åˆ«å¤ªé«˜ï¼Œå¦åˆ™å¥åº·ç›‘æŽ§å˜æˆè‡´ç—…ç›‘æŽ§äº†ã€‚ å…³äºŽJVMçš„å‡ ä¸ªGCå †å’ŒGCçš„æƒ…å†µï¼Œå¯ä»¥ç”¨jstatæ¥ç›‘æŽ§ï¼Œä¾‹å¦‚ç›‘æŽ§è¿›ç¨‹837æ¯éš”1000æ¯«ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œè¾“å‡º20æ¬¡ï¼š 1234[lex@chou ~]$ jstat -gcutil 837 1000 20 S0 S1 E O P YGC YGCT FGC FGCT GCT 0.00 80.43 24.62 87.44 98.29 7101 119.652 40 19.719 139.371 0.00 80.43 33.14 87.44 98.29 7101 119.652 40 19.719 139.371 å‡ ä¸ªå­—æ®µåˆ†åˆ«å«ä¹‰å¦‚ä¸‹ï¼š S0 å¹´è½»ä»£ä¸­ç¬¬ä¸€ä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” S1 å¹´è½»ä»£ä¸­ç¬¬äºŒä¸ªsurvivorï¼ˆå¹¸å­˜åŒºï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” E å¹´è½»ä»£ä¸­Edenï¼ˆä¼Šç”¸å›­ï¼‰å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” O oldä»£å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” P permä»£å·²ä½¿ç”¨çš„å å½“å‰å®¹é‡ç™¾åˆ†æ¯” YGC ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ¬¡æ•° YGCT ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­gcæ‰€ç”¨æ—¶é—´(s) FGC ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ¬¡æ•° FGCT ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶oldä»£(å…¨gc)gcæ‰€ç”¨æ—¶é—´(s) GCT ä»Žåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶gcç”¨çš„æ€»æ—¶é—´(s) ç»“è®ºå› æ­¤å¦‚æžœæ­£å¸¸æƒ…å†µä¸‹jmapè¾“å‡ºçš„å†…å­˜å ç”¨è¿œå°äºŽ RSZï¼Œå¯ä»¥ä¸ç”¨å¤ªæ‹…å¿ƒï¼Œé™¤éžå‘ç”Ÿä¸€äº›ä¸¥é‡é”™è¯¯ï¼Œæ¯”å¦‚PermGenç©ºé—´æ»¡äº†å¯¼è‡´OutOfMemoryErrorå‘ç”Ÿï¼Œæˆ–è€…RSZå¤ªé«˜å¯¼è‡´å¼•èµ·ç³»ç»Ÿå…¬æ„¤è¢«OOM Killerç»™å¹²æŽ‰ï¼Œå°±å¾—æ³¨æ„äº†ï¼Œè¯¥åŠ å†…å­˜åŠ å†…å­˜ï¼Œæ²¡é’±ä¹°å†…å­˜åŠ äº¤æ¢ç©ºé—´ï¼Œæˆ–è€…æŒ‰ä¸Šé¢åˆ—çš„ç»„æˆéƒ¨åˆ†é€ä¸€æŽ’é™¤ã€‚è¿™å‡ ä¸ªå†…å­˜æŒ‡æ ‡ä¹‹é—´çš„å…³ç³»æ˜¯ï¼šVSZ &gt;&gt; RSZ &gt;&gt; Javaç¨‹åºå®žé™…ä½¿ç”¨çš„å †å¤§å° 12 ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œå‘½ä»¤ï¼š top å¦‚å›¾å¯ä»¥çœ‹åˆ°javaçš„è¿›ç¨‹å†…å­˜ä½¿ç”¨çŽ‡è¾ƒé«˜ï¼Œjavaè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨çŽ‡è¾¾åˆ°äº†70%+ 2.å®šä½çº¿ç¨‹é—®é¢˜ï¼ˆé€šè¿‡å‘½ä»¤æŸ¥çœ‹9718è¿›ç¨‹çš„çº¿ç¨‹æƒ…å†µï¼‰ï¼Œå‘½ä»¤ï¼š ps p 9718 -L -o pcpu,pmem,pid,tid,time,tname,cmd ç”±æ­¤å¯ä»¥çœ‹åˆ°è¿™PIDï¼š9718çš„è¿›ç¨‹äº§ç”Ÿäº†å¾ˆå¤šçº¿ç¨‹ã€‚æŽ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡jstackæŸ¥çœ‹å†…å­˜ä½¿ç”¨çš„å †æ ˆã€‚ æŸ¥çœ‹å†…å­˜ä½¿ç”¨çš„å †æ ˆï¼šåœ¨è¿™é‡Œæˆ‘ä»¬æŒ‘é€‰äº†TID=9720çš„çº¿ç¨‹è¿›è¡Œåˆ†æžï¼Œé¦–å…ˆéœ€è¦å°†9731è¿™ä¸ªidè½¬æ¢ä¸º16è¿›åˆ¶ã€‚éœ€è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œ printf â€œ%x\nâ€ 9731 æŽ¥ä¸‹éœ€è¦ä½¿ç”¨16è¿›åˆ¶çš„2603 å°†PIDä¸º9718çš„å †æ ˆä¿¡æ¯æ‰“å°åˆ°jstack.logä¸­ï¼Œå‘½ä»¤ï¼š jstack -l 9718 &gt; jstack.log 5. æŸ¥çœ‹å †æ ˆä¿¡æ¯æ–‡ä»¶ï¼Œå‘½ä»¤ï¼švim jstack.log åœ¨è¿›è¡Œæœç´¢TIDä¸º2603çš„ç›¸å…³ä¿¡æ¯ã€‚å¦‚å›¾ï¼š å¯ä»¥çœ‹åˆ°è¿™ä¸ªçº¿ç¨‹çŠ¶æ€ä¸ºï¼šWAITINGã€‚é€šè¿‡æŸ¥çœ‹æ–‡ä»¶åˆ†æž çœ‹åˆ°å¤§é‡ Java Thread Stateã€‚ è¯´æ˜Žå®ƒåœ¨ç­‰å¾…å¦ä¸€ä¸ªæ¡ä»¶çš„å‘ç”Ÿï¼Œæ¥æŠŠè‡ªå·±å”¤é†’ï¼Œæˆ–è€…å¹²è„†å®ƒæ˜¯è°ƒç”¨äº† sleep(N)ã€‚ æ­¤æ—¶çº¿ç¨‹çŠ¶æ€å¤§è‡´ä¸ºä»¥ä¸‹å‡ ç§ï¼š java.lang.Thread.State: WAITING (parking)ï¼šä¸€ç›´ç­‰é‚£ä¸ªæ¡ä»¶å‘ç”Ÿï¼› java.lang.Thread.State: TIMED_WAITING (parkingæˆ–sleeping)ï¼šå®šæ—¶çš„ï¼Œé‚£ä¸ªæ¡ä»¶ä¸åˆ°æ¥ï¼Œä¹Ÿå°†å®šæ—¶å”¤é†’è‡ªå·±ã€‚ 6.ä»£ç ä¼˜åŒ–ï¼šå°†æ–‡ä»¶å‘é€ç»™å¼€å‘ã€‚ä¼˜åŒ–ä¸‹çº¿ç¨‹]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>ops</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[kubernetesä¹‹ä½¿ç”¨minikubeæœ¬åœ°éƒ¨ç½²]]></title>
    <url>%2F2018%2F01%2F30%2Fkubernetes%E4%B9%8B%E4%BD%BF%E7%94%A8minikube%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%2F</url>
    <content type="text"><![CDATA[ç›®å½• kubernetes ä»‹ç» çŽ¯å¢ƒã€è½¯ä»¶å‡†å¤‡ kubectl å®‰è£… minikube å®‰è£… éƒ¨ç½²è¿è¡Œå®žä¾‹ 1ã€kubernetes ä»‹ç» Kubernetes æ˜¯ Google å¼€æºçš„å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œå®ƒæž„å»ºåœ¨ç›®å‰æµè¡Œçš„ Docker æŠ€æœ¯ä¹‹ä¸Šï¼Œä¸ºå®¹å™¨åŒ–çš„åº”ç”¨æä¾›èµ„æºè°ƒåº¦ã€éƒ¨ç½²è¿è¡Œã€æœåŠ¡å‘çŽ°ã€æ‰©å®¹ç¼©å®¹ç­‰ä¸€æ•´å¥—åŠŸèƒ½ã€‚è€Œå°±åœ¨æ—¥å‰ DockerCon æ¬§æ´²å¤§ä¼šä¸Šï¼Œ Docker å®£å¸ƒæ‹¥æŠ±æ”¯æŒ Kubernetesï¼ŒDocker å…¬å¸è®¡åˆ’æä¾›ä¸€ä¸ªæ— ç¼å¹³å°ï¼ŒåŒæ—¶æ”¯æŒåŒ…å« Swarm å’Œ Kubernetes é›†ç¾¤çš„å¼‚æž„éƒ¨ç½²ã€‚minikube æ˜¯ä¸€ä¸ªä½¿æˆ‘ä»¬å¾ˆå®¹æ˜“åœ¨æœ¬åœ°è¿è¡Œ kubernetes çš„å·¥å…·ï¼Œä»–æ˜¯é€šè¿‡åœ¨æœ¬æœº VM é‡Œè¿è¡Œä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤ï¼Œå¤§å¤§æ–¹ä¾¿å­¦ä¹ å’Œä½¿ç”¨ kubernetesã€‚ 2ã€çŽ¯å¢ƒã€è½¯ä»¶å‡†å¤‡ æœ¬æ¬¡æ¼”ç¤ºçŽ¯å¢ƒï¼Œæˆ‘æ˜¯åœ¨æœ¬æœº MAC OS ä»¥åŠè™šæ‹Ÿæœº Linux Centos7 ä¸Šæ“ä½œï¼Œä»¥ä¸‹æ˜¯å®‰è£…çš„è½¯ä»¶åŠç‰ˆæœ¬ï¼š Docker: version 17.09.0-ce Oracle VirtualBox: version 5.1.20 r114628 (Qt5.6.2) Minikube: version v0.22.2 Kuberctl: Client Version: v1.8.1 Server Version: v1.7.5 æ³¨æ„ï¼šMinikube å¯åŠ¨çš„å•èŠ‚ç‚¹ k8s Node å®žä¾‹æ˜¯éœ€è¦è¿è¡Œåœ¨æœ¬æœºçš„ VM è™šæ‹Ÿæœºé‡Œé¢ï¼Œæ‰€ä»¥éœ€è¦æå‰å®‰è£…å¥½ VMï¼Œè¿™é‡Œæˆ‘é€‰æ‹© Oracle VirtualBoxã€‚k8s è¿è¡Œåº•å±‚ä½¿ç”¨ Docker å®¹å™¨ï¼Œæ‰€ä»¥æœ¬æœºéœ€è¦å®‰è£…å¥½ Docker çŽ¯å¢ƒï¼Œè¿™é‡Œå¿½ç•¥ Dockerã€VirtualBox çš„å®‰è£…è¿‡ç¨‹ï¼Œç€é‡ä»‹ç»ä¸‹ Minikube å’Œ Kuberctl çš„å®‰è£…ã€‚ 3ã€ kubectl å®‰è£… kubectl æ˜¯ Kubernetes çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å·¥å…·æŸ¥çœ‹é›†ç¾¤èµ„æºï¼Œåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤å„ä¸ªç»„ä»¶ç­‰ç­‰ï¼ŒåŒæ—¶æä¾›äº†éžå¸¸è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ï¼Œéžå¸¸æ–¹ä¾¿ï¼Œé‚£æˆ‘ä»¬åœ¨æœ¬æœº Mac ä¸Šå®‰è£…ä¸€ä¸‹ã€‚ å®‰è£…æ–¹å¼æœ‰ä¸¤ç§ï¼š ä¸€ã€é€šè¿‡ curl å®‰è£… 12345678910111ã€å®‰è£…æœ€æ–°ç‰ˆcurl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/darwin/amd64/kubectl# å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œä¾‹å¦‚ v1.8.0curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.8.0/bin/darwin/amd64/kubectl2ã€èµ‹äºŒè¿›åˆ¶æ–‡ä»¶æ‰§è¡Œæƒé™chmod +x ./kubectl3ã€å°†äºŒè¿›åˆ¶æ–‡ä»¶ç§»åˆ° PATH ä¸­sudo mv ./kubectl /usr/local/bin/kubectl1234567891011 äºŒã€é€šè¿‡ Homebrew å®‰è£… 1brew install kubectl1 å®‰è£…å®Œæ¯•åŽï¼Œæ‰§è¡Œ kubectl version æŸ¥çœ‹ç‰ˆæœ¬ä»¥åŠæ˜¯å¦å®‰è£…æˆåŠŸã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ kubectl help æŸ¥çœ‹è¯´æ˜Žæ–‡æ¡£ã€‚ 4ã€minikube å®‰è£… minikube æ˜¯ä¸€ä¸ªä½¿æˆ‘ä»¬å¾ˆå®¹æ˜“åœ¨æœ¬åœ°è¿è¡Œ kubernetes çš„å·¥å…·ï¼Œä»–æ˜¯é€šè¿‡åœ¨æœ¬æœº VM é‡Œè¿è¡Œä¸€ä¸ªå•èŠ‚ç‚¹ kubernetes é›†ç¾¤ï¼Œè¿™å¯¹äºŽæ–°æ‰‹æƒ³äº†è§£å’Œå­¦ä¹  kubernetes æä¾›äº†å¾ˆå¤§çš„å¸®åŠ©ã€‚æ‰€ä»¥åœ¨å®‰è£… minikube ä¹‹å‰æˆ‘ä»¬éœ€è¦åœ¨æœ¬æœºå…ˆå®‰è£… VMï¼Œè¿™é‡Œæˆ‘é€‰æ‹© VirtualBox å¿½ç•¥å®‰è£…è¿‡ç¨‹ï¼Œä»¥ä¸‹æ˜¯å¯é€‰ VM åˆ—è¡¨ï¼š OS X: xhyve driver, VirtualBox, VMware Fusion. Linux: VirtualBox, KVM Windows: VirtualBox, Hyper-V minikube çš„å®‰è£…ä¹Ÿå¾ˆç®€å•ã€‚ 1ã€curl æ–¹å¼å®‰è£… 12345OSX ç³»ç»Ÿï¼šcurl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.22.3/minikube-darwin-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/Linux ç³»ç»Ÿï¼šcurl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.22.3/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/12345 2ã€è‹¥ä¸Šè¾¹åœ°å€è¢«å¢™äº†ï¼Œå¯ä»¥åŽ» GitHub ä¸Šä¸‹è½½å®‰è£…åŒ…ï¼Œåœ¨æ‰§è¡Œã€‚ ä¸‹è½½æœ€æ–°ç‰ˆå®‰è£…åŒ…ï¼Œå„ç³»ç»Ÿå¯¹åº”åœ°å€å¦‚ä¸‹ï¼š minikube-darwin-amd64 minikube-linux-amd64 minikube-installer.exe ç„¶åŽæ‰§è¡Œ chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/ï¼Œå³å¯å®Œæˆå®‰è£…ã€‚å®‰è£…å®Œæ¯•åŽï¼Œæ‰§è¡Œ minikube version æŸ¥çœ‹ç‰ˆæœ¬ä»¥åŠæ˜¯å¦å®‰è£…æˆåŠŸã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ minikube help æŸ¥çœ‹è¯´æ˜Žæ–‡æ¡£ã€‚ 5ã€éƒ¨ç½²è¿è¡Œå®žä¾‹ å¥½äº†ï¼ŒçŽ¯å¢ƒæˆ‘ä»¬å·²ç»å®‰è£…å®Œæ¯•ï¼ŒçŽ°åœ¨æ¥æ¼”ç¤ºè¿è¡Œä¸€ä¸ªå®žä¾‹ï¼Œè¿™é‡Œæˆ‘å·² tomcat é•œåƒä¸ºä¾‹ï¼Œæ¼”ç¤ºéƒ¨ç½²æœåŠ¡ï¼Œå‘å¸ƒæœåŠ¡ï¼Œæ‰©å®¹ç¼©å®¹æœåŠ¡ç­‰æ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233341ã€åˆ›å»ºå¹¶å¯åŠ¨ minikube è™šæ‹Ÿæœº$ minikube startStarting local Kubernetes cluster...Running pre-create checks...Creating machine...Starting local Kubernetes cluster...2ã€åˆ›å»º hello-minikube éƒ¨ç½²$ kubectl run hello-minikube --image=tomcat:8.0 --port=8080deployment "hello-minikube" created3ã€å‘å¸ƒæœåŠ¡ hello-minikube$ kubectl expose deployment hello-minikube --type=NodePortservice "hello-minikube" exposed4ã€æŸ¥çœ‹ pods$ kubectl get podsNAME READY STATUS RESTARTS AGEhello-minikube-598805112-3bzmf 1/1 ContainerCreating 0 5sæ³¨æ„ï¼šåˆšå¼€å§‹æ—¶ï¼Œpod æ²¡æœ‰å®Œå…¨åˆ›å»ºå¥½çš„æ—¶å€™ï¼ŒçŠ¶æ€æ˜¯ ContainerCreatingï¼Œå½“éƒ¨ç½²å®ŒæˆåŽï¼ŒçŠ¶æ€å°±å˜æˆ Runningã€‚$ kubectl get podsNAME READY STATUS RESTARTS AGEhello-minikube-598805112-3bzmf 1/1 Running 0 25s5ã€èŽ·å–æœåŠ¡åœ°å€$ minikube service hello-minikube --urlhttp://192.168.99.102:30724$ minikube service hello-minikube å°†ç›´æŽ¥æ‰“å¼€åœ°å€åˆ°é»˜è®¤æµè§ˆå™¨ä¸Šã€‚6ã€åœæ­¢ minikube è™šæ‹Ÿæœº$ minikube stopStopping local Kubernetes cluster...Stopping "minikube"...12345678910111213141516171819202122232425262728293031323334 æ³¨æ„ï¼šåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºçŽ°é—®é¢˜ï¼Œå¤§éƒ¨åˆ†è·Ÿç½‘ç»œç›¸å…³ï¼Œä¸‹è½½ images æ—¶ä¼šè¶…æ—¶æŠ¥é”™ï¼Œè§£å†³åŠžæ³•æ˜¯ä¸€å®‰è£…ç¿»å¢™å·¥å…·ï¼ŒäºŒæ˜¯æ›¿ä»£éœ€è¦ç¿»å¢™ä¸‹è½½çš„ imagesã€‚ä»¥ä¸‹æ˜¯æˆ‘æœ¬æœºå®žéªŒé‡åˆ°çš„é—®é¢˜ï¼Œä»¥åŠè§£å†³æ–¹æ³•ã€‚ é—®é¢˜ä¸€ï¼šå‘½ä»¤è¡Œä¸‹è½½ tomcat:8.0 é•œåƒï¼Œæ‰§è¡Œ docker pull tomcat:8.0 æ²¡æœ‰ä»»ä½•ååº”ï¼Œåˆæ­¥åˆ†æžå¯èƒ½æ˜¯ minikube è™šæ‹Ÿæœºé‡Œæ²¡æœ‰è¿žæŽ¥åˆ°æœ¬åœ° docker æœåŠ¡ã€‚ 12345$ minikube docker-envexport DOCKER_TLS_VERIFY="1"export DOCKER_HOST="tcp://192.168.99.102:2376"export DOCKER_CERT_PATH="/Users/wanyang3/.minikube/certs"export DOCKER_API_VERSION="1.23"12345 æ‰§è¡Œ eval $(minikube docker-env)ï¼Œå³è®¾ç½® minikube è™šæ‹Ÿæœºçš„ docker çŽ¯å¢ƒå˜é‡å³å¯ã€‚ é—®é¢˜äºŒï¼šæ‰§è¡Œå®Œæ¯•ä¸Šè¾¹ 2 å’Œ 3 æ­¥éª¤åŽï¼Œå‘çŽ° hello-minikube æœåŠ¡å¹¶æ²¡æœ‰æˆåŠŸå¯åŠ¨ã€‚ 123$ kubectl get podsNAME READY STATUS RESTARTS AGEhello-minikube-598805112-3bzmf 0/1 ContainerCreating 0 15s123 å‘çŽ° hello-minikube çš„çŠ¶æ€ä¸€ç›´æ˜¯ ContainerCreatingï¼Œå¹¶ä¸” READY ä¸º 0/1ï¼Œé€šè¿‡ minikube logs æŸ¥çœ‹æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œæœ‰ä¸€ä¸ªé•œåƒ gcr.io/google_containers/pause-amd64:3.0 æ˜¾ç¤ºæ‹‰å–å¤±è´¥ï¼Œåˆ†æžåŽŸå› åº”è¯¥æ˜¯ gcr.io è¿™ä¸ªåœ°å€è¢«å¢™äº†ã€‚ 123456# æ›¿æ¢é•œåƒ$ docker pull visenzek8s/pause-amd64:3.0$ docker tag visenzek8s/pause-amd64:3.0 gcr.io/google_containers/pause-amd64:3.0# æ˜¾å¼è®¾ç½®æ‹‰å–ç­–ç•¥ä¸º IfNotPresent$ kubectl run hello-minikube --image=tomcat:8.0 --port=8080 --image-pull-policy=IfNotPresent 123456 æ–¹æ¡ˆå°±æ˜¯æ›¿æ¢è¯¥é•œåƒï¼Œç„¶åŽå¯ä»¥è®¾ç½®æ‹‰å–ç­–ç•¥ä¸ºä¼˜å…ˆæœ¬åœ°èŽ·å–ï¼Œæœ¬åœ°æ²¡æœ‰å†åŽ»è¿œç¨‹èŽ·å–ã€‚å› ä¸ºè¿™é‡ŒæœåŠ¡å¯åŠ¨ç­–ç•¥ä¸º alwaysï¼Œä¼šå®šæ—¶è‡ªåŠ¨é‡æ–°æ‹‰å–ï¼Œæ‰€ä»¥ä¸€æ—¦æœ¬åœ°æ‹‰å–è¯¥é•œåƒåŽï¼Œæˆ‘ä»¬ä¼šå‘çŽ°ä¸Šè¾¹ hello-minikube ä¸€ä¼šå°±å¯åŠ¨æˆåŠŸäº†ã€‚ ä¸‹è¾¹ä»‹ç»ä¸€ä¸‹ kubectl ä¸€äº›å…¶ä»–å¸¸ç”¨æ“ä½œã€‚ 1ã€åˆ›å»ºèµ„æºçš„ä¸¤ç§æ–¹å¼ 1.1 é€šè¿‡ Yaml æˆ– Json æ–‡ä»¶åˆ›å»º 12$ kubectl create -f &lt;file_path&gt;/xxx.yaml | &lt;file_path&gt;/xxx.json --[options]egï¼škubectl create -f ./redis.yaml12 ç®€å•çš„ redis.yaml ç¤ºä¾‹ï¼š 123456789101112131415161718192021222324252627282930313233apiVersion: extensions/v1beta1kind: Deploymentmetadata: name: hello-redis namespace: my-kubespec: replicas: 2 template: metadata: labels: group: hello-scm my-kube: hello-redis k8s-app: redis spec: containers: - name: redis image: redis:latest---apiVersion: v1kind: Servicemetadata: labels: group: hello-scm kubernetes.io/cluster-service: 'true' kubernetes.io/name: hello-redis name: hello-redis namespace: my-kubespec: ports: - port: 6379 targetPort: 6379 selector: k8s-app: redis123456789101112131415161718192021222324252627282930313233 yaml æ–‡ä»¶è¦ç¬¦åˆ kubernetes çš„è§„èŒƒï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘å¯¹ yaml è¯­æ³•å®šä¹‰ï¼Œå¯ä»¥è‡ªå­¦ä¸€ä¸‹ï¼Œè¿™é‡Œå°±ä¸å±•å¼€æ¥è¯´äº†ã€‚ 1.2 æŒ‡å®šé•œåƒå¯åŠ¨ 12$ kubectl run --image=xxxx:xx --[options]eg: kubectl run hello-minikube --image=tomcat:8.0 --port=8080 12 2ã€å¤åˆ¶å¤šä¸ªéƒ¨ç½² pod 12345678910$ kubectl scale --replicas=3 deployment/hello-minikubedeployment "hello-minikube" scaled$ kubectl get podsNAME READY STATUS RESTARTS AGEhello-minikube-598805112-3bzmf 1/1 Running 1 1dhello-minikube-598805112-vrskz 1/1 Running 1 1dhello-minikube-598805112-xwq55 1/1 Running 1 1dä¹Ÿå¯ä»¥åœ¨å¯åŠ¨æ—¶ï¼ŒæŒ‡å®šå¤åˆ¶æ•°é‡$ kubectl run hello-minikube --image=tomcat:8.0 --port=8080 --replicas=312345678910 3ã€æš´éœ² pod (po), service (svc), replicationcontroller (rc), deployment (deploy), replicaset (rs) æˆæ–°çš„æœåŠ¡ 123456789$ kubectl expose po | svc | rc | delpoy | rs --[options]egï¼škubectl expose deployment hello-minikube --type=NodePort # æš´éœ²åç§°ä¸º hello-minikube éƒ¨ç½²ä¸ºç±»åž‹ä¸º NodePort çš„æœåŠ¡egï¼škubectl expose rc hello-nginx --port=80 --target-port=8000 --type=NodePort # æš´æ¼åç§°ä¸º nginx çš„å‰¯æœ¬ä¸ºæŒ‡å®šæœåŠ¡ç«¯å£80ï¼Œè¿žæŽ¥è¯¥æœåŠ¡ç«¯å£8000ï¼Œç±»åž‹ä¸º NodePort çš„æœåŠ¡$ kubectl get serviceNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEhello-minikube NodePort 10.0.0.176 &lt;none&gt; 8080:30724/TCP 1dhello-nginx NodePort 10.0.0.94 &lt;none&gt; 80:8000/TCP 1dkubernetes ClusterIP 10.0.0.1 &lt;none&gt; 443/TCP 1d123456789 4ã€é‡æ–°åŠ è½½æŸä¸ªèµ„æº 12$ kubectl apply -f &lt;file_path&gt;/xxx.yaml | &lt;file_path&gt;/xxx.json --[options]egï¼škubectl apply -f ./redis.yaml12 5ã€æŸ¥çœ‹ pod, service, replicationcontroller, deployment, replicaset å„ç§ç±»åž‹èµ„æºä¿¡æ¯åˆ—è¡¨ 12$ kubectl get po | svc | rc | deploy | rs # æŸ¥çœ‹é»˜è®¤ namespace ä¸‹å„ç±»åž‹èµ„æºä¿¡æ¯åˆ—è¡¨$ kubectl get po | svc | rc | deploy | rs --all-namespaces # æŸ¥çœ‹æ‰€æœ‰ namespace ä¸‹å„ç±»åž‹èµ„æºä¿¡æ¯åˆ—è¡¨12 6ã€æŸ¥çœ‹ pod, service, replicationcontroller, deployment, replicaset å„ç§ç±»åž‹èµ„æºæ—¥å¿—ä¿¡æ¯æˆ–æè¿°ä¿¡æ¯ 12345678$ kubectl logs &lt;resource_type&gt;/&lt;resource_name&gt; [options]egï¼škubectl logs -f po/hello-minikube-598805112-3bzmf # æŸ¥çœ‹æŒ‡å®š pod çš„æ—¥å¿—egï¼škubectl logs deploy/hello-nginx -n my-kube # æŸ¥çœ‹æŒ‡å®š delpoy å’Œ namespace çš„æ—¥å¿—$ kubectl describe &lt;resource_type&gt;/&lt;resource_name&gt; [options]egï¼škubectl describe pods # æŸ¥çœ‹æ‰€æœ‰ pod çš„æè¿°ä¿¡æ¯egï¼škubectl describe po/hello-minikube-598805112-3bzmf # æŸ¥çœ‹æŒ‡å®š pod çš„æè¿°ä¿¡æ¯egï¼škubectl describe deploy/hello-nginx -n my-kube # æŸ¥çœ‹æŒ‡å®š delpoy å’Œ namespace çš„æè¿°ä¿¡æ¯12345678 7ã€æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ 12$ kubectl cluster-infoKubernetes master is running at https://192.168.99.102:844312 å¥½äº†ï¼Œå…ˆä»‹ç»è¿™ä¹ˆå¤šï¼Œä¸‹ä¸€ç¯‡ç»§ç»­ä»‹ç»ä¸‹é€šè¿‡ minikube å®‰è£… Kubernetes Dashboard å¹¶é›†æˆ Heapster æ’ä»¶ã€‚ å‚è€ƒèµ„æ–™ Running Kubernetes Locally via Minikube Install Minikube Install and Set Up kubectl github minikube]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[kubernates docker å¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2018%2F01%2F27%2Fkubernates-docker-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[minikubeå‘½ä»¤1234#å¯åŠ¨è™šæ‹Ÿæœºminikube startminikube stop k8så‘½ä»¤123456789101112131415161718192021222324252627282930kubectl podkubectl get podkubectl get pod XXX &gt; aavim aakubectl get pod hello-minikube-5df766f774-ws8fk -o yamlkubectl edit pod hello-minikube-5df766f774-ws8fkkubectl describe pod XXX //ç»“åˆpodå’Œeventkubectl get eventkubectl get serviceskubectl get services hello-minikube -o yamlkubectl get rskubectl describe rskubectl config rename-context mini minikube2kubectl create -f ./**.yaml -f ***.yamlwget https://.../k8s.tar.gzexample guestbooksudo docker imagesfront-images æ¢æˆnginx 12345678910111213141516171819202122232425262728293031323334353637383940414243444546471 api service ã€2etcd æ­¥ create_timestamp3 schedule -&gt; api service6 å¯åŠ¨docker1. 3 node 1node down load balancer -&gt; api server åˆ†å‘åˆ°å¦å¤–ä¸¤å° etcd2. scheduler/CM æ­»çš„nodeä¸»ï¼Œéœ€è¦é€‰ä¸¾3. kubelet sysmtem è¿›ç¨‹æ­»æŽ‰è‡ªåŠ¨æ‹‰èµ·vimdiff aa bbkubectl get rskubectl get deployment##æ‰©å®¹æˆ–ç¼©å®¹kubectl scale --replicas=2 deployment/frontendsudo docker run XXXkubectl get pod --all-name-spacekubectl logs xxx##å¯»å–å¸®åŠ©kubectl logs -h## busyboxç»ˆç«¯kubectl run -i --tty busyboxkubectl attach XXX -ikubectl top podkubectl delete deployment XXXkubectl delete pod XXXç”¨äºŽæŸ¥é”™skubectl cluster-info dump --out-directory=tmp k8s å®‰è£…docker https://docs.docker.com/install/linux/docker-ce/ubuntu/ ä»Žgithubä¸Šä¸‹è½½minikubeäºŒè¿›åˆ¶ https://github.com/kubernetes/minikube/releases å¢™å†…å®‰è£…kubectl https://www.kubernetes.org.cn/installkubectl 123bin dpkg-deb -x kubelet.deb tmpcd tmpcp ./usr/bin/kubectl /usr/local/bin å¯åŠ¨minikubeï¼Œç»•è¿‡gcr.ioä¸‹æ— æ³•ä¸‹è½½é•œåƒçš„é—®é¢˜ ï® è§‚å¯Ÿæ—¥å¿—/var/lib/localkube/*.err ï® docker pull kubernetes/pause ï® docker pull grrywlsn/kubernetes-addon-manager:v1.8.0 Kubectlã€Kubeadmå›½å†…ä¸‹è½½åœ°å€ï¼š https://mirrors.ustc.edu.cn/kubernetes/apt/pool/ å®‰è£…å’Œè®¾ç½®kubectl https://www.kubernetes.org.cn/installkubectl # Kubectl å®¢æˆ·ç«¯çš„ä¸‹è½½å’Œé…ç½®http://blog.csdn.net/csdn_duomaomao/article/details/76159874 dockerquick start https://docs.docker.com/docker-for-mac/#explore-the-application-and-run-examples 1234567891011121314docker infodocker versiondocker psdocker imagesdocker run hello-worlddocker run -d -p 80:80 --name webserver nginxdocker stop webserverdocker start webserverdocker ps -a#åˆ é™¤å®¹å™¨ stop and remove the running containerdocker rm -f webserver#åˆ é™¤é•œåƒdocker rmi nginx Some good commands to try are docker version to check that you have the latest release installed, and docker ps and docker run hello-world to verify that Docker is running. docker ä¸­æ–‡é•œåƒå®‰è£…çŽ¯å¢ƒï¼šApple macOS Sierra 10.12.3å®‰è£…æ­¥éª¤ï¼š1. ä¸‹è½½Docker for Macã€‚å®˜æ–¹ä¸‹è½½é“¾æŽ¥ï¼šhttps://download.docker.com/mac/stable/Docker.dmg 2. å®‰è£…Docker for Macå¹¶å¯åŠ¨ã€‚3. æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯ã€‚1$ docker --version1 4. é…ç½®é˜¿é‡Œäº‘Dockeré•œåƒåŠ é€Ÿå™¨ã€‚Dockeråœ¨å›½å†…ä¸‹è½½é•œåƒçš„é€Ÿåº¦å¤ªæ…¢ï¼Œç»å¸¸å¤±è´¥ï¼Œæ‰€ä»¥ä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„å®¹å™¨é•œåƒä»“åº“æœåŠ¡ã€‚å¦‚æžœä¸æ„¿æ„é…ç½®é•œåƒï¼Œç›´æŽ¥è¿›å…¥https://dev.aliyun.com/search.htmlä¸­å¯»æ‰¾é•œåƒä½¿ç”¨ã€‚ æŽ¥ä¸‹æ¥ä»‹ç»é˜¿é‡Œäº‘Dockeré•œåƒåŠ é€Ÿå™¨ï¼Œä½¿ç”¨åŠ é€Ÿå™¨å°†ä¼šæå‡æ‚¨åœ¨å›½å†…èŽ·å–Dockerå®˜æ–¹é•œåƒçš„é€Ÿåº¦ï¼ è¿›å…¥é˜¿é‡Œäº‘å®¹å™¨HubæœåŠ¡çš„æŽ§åˆ¶å°ï¼Œå¹¶ç”³è¯·æˆä¸ºå¼€å‘è€…ã€‚ ç‚¹å‡»å·¦ä¾§çš„åŠ é€Ÿå™¨å¸®åŠ©é¡µé¢å°±ä¼šæ˜¾ç¤ºæ‚¨çš„ä¸“å±žåŠ é€Ÿå™¨åœ°å€ã€‚ å¤åˆ¶åœ°å€æ‚¨çš„ä¸“å±žåŠ é€Ÿå™¨åœ°å€ï¼Œå°†åœ°å€å¡«å…¥Dockerçš„é…ç½®ä¸­ï¼Œè·¯å¾„å¦‚ä¸‹ï¼šPreferencesâ€“&gt;Daemonâ€“&gt;Basicâ€“&gt;Registry mirrorsï¼Œç„¶åŽé‡å¯ã€‚ åˆ†äº«ä¸¤ä¸ªè‡ªå·±çš„åŠ é€Ÿå™¨åœ°å€ï¼šhttps://7r4uvc15.mirror.aliyuncs.comhttp://5ae05a04.m.daocloud.io 7. ç¡®è®¤Dockeræ˜¯å¦å®‰è£…æˆåŠŸã€‚1$ sudo docker run hello-world1 è¿™ä¸ªå‘½ä»¤ä¼šä¸‹è½½ä¸€ä¸ªæµ‹è¯•ç”¨çš„é•œåƒå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨è¿è¡Œå®ƒã€‚ quick start###docker container 12345678910111213141516docker build -t friendlyhello . # Create image using this directory's Dockerfiledocker run -p 4000:80 friendlyhello # Run "friendlyname" mapping port 4000 to 80docker run -d -p 4000:80 friendlyhello # Same thing, but in detached modedocker container ls # List all running containersdocker container ls -a # List all containers, even those not runningdocker container stop &lt;hash&gt; # Gracefully stop the specified containerdocker container kill &lt;hash&gt; # Force shutdown of the specified containerdocker container rm &lt;hash&gt; # Remove specified container from this machinedocker container rm $(docker container ls -a -q) # Remove all containersdocker image ls -a # List all images on this machinedocker image rm &lt;image id&gt; # Remove specified image from this machinedocker image rm $(docker image ls -a -q) # Remove all images from this machinedocker login # Log in this CLI session using your Docker credentialsdocker tag &lt;image&gt; username/repository:tag # Tag &lt;image&gt; for upload to registrydocker push username/repository:tag # Upload tagged image to registrydocker run username/repository:tag # Run image from a registry ###docker service 12345678docker stack ls # List stacks or appsdocker stack deploy -c &lt;composefile&gt; &lt;appname&gt; # Run the specified Compose filedocker service ls # List running services associated with an appdocker service ps &lt;service&gt; # List tasks associated with an appdocker inspect &lt;task or container&gt; # Inspect task or containerdocker container ls -q # List container IDsdocker stack rm &lt;appname&gt; # Tear down an applicationdocker swarm leave --force # Take down a single node swarm from the manager éœ€è¦https://api.github.com/repos/boot2docker/boot2docker/releases/latest ä¸‹è½½ï¼Œâ€html_urlâ€: â€œhttps://github.com/boot2docker/boot2docker/releases/tag/v17.07.0-ceâ€œ ###swarmé›†ç¾¤ 1234567891011121314151617181920212223242526272829docker-machine create --virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso manager1mv boot2docker.iso /Users/zhouxiaowu/.docker/machine/cache/docker-machine create --virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso myvm1docker-machine create --virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso myvm210513 docker-machine ssh myvm1 "docker swarm init --advertise-addr 192.168.99.101"10514 docker-machine ls10515 docker-machine ssh myvm2 " docker swarm join --token SWMTKN-1-13x2fyyubrz6b0k0p86bpt0rjydu59ze8a7g4q6n4yn1aip7so-96zlikwtz3h7mmpa18ilu0i6g 192.168.99.101:2377"10516 docker-machine ssh myvm1 "docker node ls"10520 docker-machine env myvm110521 eval $(docker-machine env myvm1)10526 docker stack deploy -c docker-compose.yml getstartedlab10527 docker stack ls10529 docker stack ps getstartedlab10530 docker container ls10569 docker stack ls10570 docker stack rm getstartedlab10571 docker-machine env -u10572 eval $(docker-machine env -u) ç¬”è®°1234567891011find namelsoflsof -p 2951viewulimit -n 1000cd var/logminikube logs &gt;aavim aakubectl get pods --all-namespaces]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[mybatisä¸­#å’Œ$çš„åŒºåˆ«]]></title>
    <url>%2F2018%2F01%2F15%2Fmybatis%E4%B8%AD-%E5%92%8C-%E7%9A%84%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©åœ¨å·¥ä½œä¸­æœ‰ä¸ªç‚¹å‡»æŽ’åºçš„åŠŸèƒ½è°ƒè¯•äº†è®¸ä¹…ï¼Œç»ˆå¯»å› ï¼Œæ€»ç»“ä¹‹ã€‚ éœ€æ±‚æ˜¯è¿™æ ·çš„ï¼Œé¡µé¢æœ‰ä¸ªtableï¼Œæœ‰ä¸€åˆ—çš„ä¸Šä¸‹ç®­å¤´å¯ç‚¹å‡»å¹¶æŽ’åºã€‚å¯¹äºŽè¿™ç§éœ€æ±‚ï¼Œæˆ‘çš„mybatis.xmlçš„sqlé…ç½®å†™æˆäº†å¦‚ä¸‹ï¼š ORDER BY columnName #{map.ColumnNameSort} ColumnNameSortå³å‰ç«¯ä¼ çš„æŽ’åºæ–¹å¼ï¼Œascæˆ–è€…descã€‚ ç„¶åŽï¼Œé¢„è®¡å®ƒçš„è¾“å‡ºåº”è¯¥æ˜¯ç±»ä¼¼äºŽä¸‹é¢è¿™æ ·çš„ ORDER BY columnName desc ä½†æ˜¯ï¼ŒçœŸæ­£è·‘èµ·æ¥æ—¶ï¼ŒæŽ’åºçš„æ•ˆæžœä¸€ç›´æ²¡å‡ºçŽ°ï¼Œç»å¸¸ä¸€ç•ªæŸ¥æ‰¾ï¼Œå‘çŽ°æ˜¯mybatis çš„â€™#{}â€™ä¼ å€¼çš„é—®é¢˜ï¼Œå®ƒå°†sqlè¯­å¥ç¼–è¯‘æˆäº†å¦‚ä¸‹ ORDER BY columnName â€˜descâ€™ æˆ–è€… ORDER BY columnName â€˜ascâ€™ è¿™æ ·ï¼Œdescæˆ–è€…ascå°±æˆäº†å­—ç¬¦ä¸²è€Œä¸æ˜¯å…³é”®å­—ï¼Œsqlè¯­å¥çš„æ„æ€æ˜¯columnNameçš„åˆ«åæ˜¯descæˆ–è€…ascï¼Œæ²¡åŠ æŽ’åºå…³é”®å­—æ—¶é»˜è®¤æ˜¯æ­£åºæŽ’åºï¼Œæˆäº†å¦‚ä¸‹ ORDER BY columnName â€œdescâ€ asc æˆ–è€… ORDER BY columnName â€œascâ€ asc æŽ’åºæ²¡æ•ˆæžœçš„é—®é¢˜æ‰¾åˆ°åŽŸå› äº†ï¼Œè§£å†³ä¹‹ï¼Œmybatisæä¾›äº†å¦ä¸€ç§ç»‘å®šå‚æ•°çš„æ–¹å¼â€“${param}ï¼Œå°†sqlé…ç½®æ”¹ä¸º ORDER BY columnName ${map.ColumnNameSort} è¿™æ ·ä¸€æ¥ï¼Œmybatisä¼šç›´æŽ¥å°†ColumnNameSortçš„å€¼åŠ å…¥sqlä¸­ï¼Œä¸ä¼šè½¬ä¹‰ã€‚æ­£ç¡®ç»“æžœï¼š ORDER BY columnName desc æœ€åŽï¼Œå¯¹äºŽmybatisä¸­#å’Œ$ç»‘å®šå‚æ•°çš„åŒºåˆ«åšä¸ªæ€»ç»“ï¼Œé¿å…ä»¥åŽç±»ä¼¼çš„é—®é¢˜å‘ç”Ÿã€‚ ï¼ƒ{}å°†ä¼ å…¥çš„æ•°æ®éƒ½å½“æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šå¯¹è‡ªåŠ¨ä¼ å…¥çš„æ•°æ®åŠ ä¸€ä¸ªåŒå¼•å·ã€‚å¦‚ï¼šorder by #{id}ï¼Œå¦‚æžœä¼ å…¥çš„å€¼æ˜¯111,é‚£ä¹ˆè§£æžæˆsqlæ—¶çš„å€¼ä¸ºorder by â€œ111â€, å¦‚æžœä¼ å…¥çš„å€¼æ˜¯idï¼Œåˆ™è§£æžæˆçš„sqlä¸ºorder by â€œidâ€ã€‚ ${}å°†ä¼ å…¥çš„æ•°æ®ç›´æŽ¥æ˜¾ç¤ºç”Ÿæˆåœ¨sqlä¸­ã€‚å¦‚ï¼šorder by ${id}ï¼Œå¦‚æžœä¼ å…¥çš„å€¼æ˜¯111,é‚£ä¹ˆè§£æžæˆsqlæ—¶çš„å€¼ä¸ºorder by 111, å¦‚æžœä¼ å…¥çš„å€¼æ˜¯idï¼Œåˆ™è§£æžæˆçš„sqlä¸ºorder by idã€‚ â€˜#â€™æ–¹å¼ èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦é˜²æ­¢sqlæ³¨å…¥ã€‚ $æ–¹å¼æ— æ³•é˜²æ­¢Sqlæ³¨å…¥ã€‚ $æ–¹å¼ä¸€èˆ¬ç”¨äºŽä¼ å…¥æ•°æ®åº“å¯¹è±¡ï¼Œä¾‹å¦‚ä¼ å…¥è¡¨å. ä¸€èˆ¬èƒ½ç”¨#çš„å°±åˆ«ç”¨$. ps:åœ¨ä½¿ç”¨mybatisä¸­è¿˜é‡åˆ°&lt;![CDATA[]]&gt;çš„ç”¨æ³•ï¼Œåœ¨è¯¥ç¬¦å·å†…çš„è¯­å¥ï¼Œå°†ä¸ä¼šè¢«å½“æˆå­—ç¬¦ä¸²æ¥å¤„ç†ï¼Œè€Œæ˜¯ç›´æŽ¥å½“æˆsqlè¯­å¥ï¼Œæ¯”å¦‚è¦æ‰§è¡Œä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ã€‚]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mysql updateä½¿ç”¨å­æŸ¥è¯¢]]></title>
    <url>%2F2018%2F01%2F11%2FMysql-update%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2%2F</url>
    <content type="text"><![CDATA[ä»Šå¤©æˆ‘åƒä»¥å‰æ“ä½œOracleå†™äº†ä¸€ä¸ªupdate sql: 12update device_user a set a.scene_id=nullwhere a.id not in(select min(t.id) from device_user t group by t.device_id);12 æ ¹æ®å­æŸ¥è¯¢çš„ç»“æžœï¼Œæ›´æ–°è¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚ åœ¨mysqlæ•°æ®åº“ä¸­æ‰§è¡ŒåŽæŠ¥é”™ï¼š 12Error Code: 1093. You can't specify target table 'a' for update in FROM clause12 ä¸€ç›´æ²¡å¼„æ˜Žç™½è¿™ä¸ªé”™è¯¯ï¼Œç„¶åŽç»è¿‡å¤šæ¬¡åº¦å¨˜åŽï¼Œå‘çŽ°mysql updateæ—¶ï¼Œæ›´æ–°çš„è¡¨ä¸èƒ½åœ¨setå’Œwhereä¸­ç”¨äºŽå­æŸ¥è¯¢ã€‚ ä¿®æ”¹ä¸Šé¢çš„sqlä¸ºmysqlæ•°æ®åº“æ”¯æŒçš„æ–¹å¼ï¼š 1234update device_user du,(select id from device_user where id not in(select min(t.id) from device_user t group by t.device_id)) bset du.scene_id=nullwhere du.id=b.id;]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVMå †å†…å­˜å’Œéžå †å†…å­˜]]></title>
    <url>%2F2018%2F01%2F02%2FJVM%E5%A0%86%E5%86%85%E5%AD%98%E5%92%8C%E9%9D%9E%E5%A0%86%E5%86%85%E5%AD%98%2F</url>
    <content type="text"><![CDATA[å †å’Œéžå †å†…å­˜ æŒ‰ç…§å®˜æ–¹çš„è¯´æ³•ï¼šâ€œJava è™šæ‹Ÿæœºå…·æœ‰ä¸€ä¸ªå †(Heap)ï¼Œå †æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œæ‰€æœ‰ç±»å®žä¾‹å’Œæ•°ç»„çš„å†…å­˜å‡ä»Žæ­¤å¤„åˆ†é…ã€‚å †æ˜¯åœ¨ Java è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºçš„ã€‚â€â€œåœ¨JVMä¸­å †ä¹‹å¤–çš„å†…å­˜ç§°ä¸ºéžå †å†…å­˜(Non-heap memory)â€ã€‚ JVMä¸»è¦ç®¡ç†ä¸¤ç§ç±»åž‹çš„å†…å­˜ï¼šå †å’Œéžå †ã€‚ Heap memory Code Cache Eden Space Survivor Space Tenured Gen non-heap memory Perm Gen native heap?(I guess) å †å†…å­˜ Java è™šæ‹Ÿæœºå…·æœ‰ä¸€ä¸ªå †ï¼Œå †æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºåŸŸï¼Œæ‰€æœ‰ç±»å®žä¾‹å’Œæ•°ç»„çš„å†…å­˜å‡ä»Žæ­¤å¤„åˆ†é…ã€‚å †æ˜¯åœ¨ Java è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºçš„ã€‚å¯¹è±¡çš„å †å†…å­˜ç”±ç§°ä¸ºåžƒåœ¾å›žæ”¶å™¨çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿå›žæ”¶ã€‚ å †çš„å¤§å°å¯ä»¥å›ºå®šï¼Œä¹Ÿå¯ä»¥æ‰©å¤§å’Œç¼©å°ã€‚å †çš„å†…å­˜ä¸éœ€è¦æ˜¯è¿žç»­ç©ºé—´ã€‚ éžå †å†…å­˜ Java è™šæ‹Ÿæœºç®¡ç†å †ä¹‹å¤–çš„å†…å­˜ï¼ˆç§°ä¸ºéžå †å†…å­˜ï¼‰ã€‚ Java è™šæ‹Ÿæœºå…·æœ‰ä¸€ä¸ªç”±æ‰€æœ‰çº¿ç¨‹å…±äº«çš„æ–¹æ³•åŒºã€‚æ–¹æ³•åŒºå±žäºŽéžå †å†…å­˜ã€‚å®ƒå­˜å‚¨æ¯ä¸ªç±»ç»“æž„ï¼Œå¦‚è¿è¡Œæ—¶å¸¸æ•°æ± ã€å­—æ®µå’Œæ–¹æ³•æ•°æ®ï¼Œä»¥åŠæ–¹æ³•å’Œæž„é€ æ–¹æ³•çš„ä»£ç ã€‚å®ƒæ˜¯åœ¨ Java è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºçš„ã€‚ æ–¹æ³•åŒºåœ¨é€»è¾‘ä¸Šå±žäºŽå †ï¼Œä½† Java è™šæ‹Ÿæœºå®žçŽ°å¯ä»¥é€‰æ‹©ä¸å¯¹å…¶è¿›è¡Œå›žæ”¶æˆ–åŽ‹ç¼©ã€‚ä¸Žå †ç±»ä¼¼ï¼Œæ–¹æ³•åŒºçš„å¤§å°å¯ä»¥å›ºå®šï¼Œä¹Ÿå¯ä»¥æ‰©å¤§å’Œç¼©å°ã€‚æ–¹æ³•åŒºçš„å†…å­˜ä¸éœ€è¦æ˜¯è¿žç»­ç©ºé—´ã€‚ é™¤äº†æ–¹æ³•åŒºå¤–ï¼ŒJava è™šæ‹Ÿæœºå®žçŽ°å¯èƒ½éœ€è¦ç”¨äºŽå†…éƒ¨å¤„ç†æˆ–ä¼˜åŒ–çš„å†…å­˜ï¼Œè¿™ç§å†…å­˜ä¹Ÿæ˜¯éžå †å†…å­˜ã€‚ä¾‹å¦‚ï¼ŒJIT ç¼–è¯‘å™¨éœ€è¦å†…å­˜æ¥å­˜å‚¨ä»Ž Java è™šæ‹Ÿæœºä»£ç è½¬æ¢è€Œæ¥çš„æœ¬æœºä»£ç ï¼Œä»Žè€ŒèŽ·å¾—é«˜æ€§èƒ½ã€‚ å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ PermGen spaceï¼šå…¨ç§°æ˜¯Permanent Generation spaceï¼Œå³æ°¸ä¹…ä»£ã€‚å°±æ˜¯è¯´æ˜¯æ°¸ä¹…ä¿å­˜çš„åŒºåŸŸ,ç”¨äºŽå­˜æ”¾Classå’ŒMetaä¿¡æ¯ï¼ŒClassåœ¨è¢«Loadçš„æ—¶å€™è¢«æ”¾å…¥è¯¥åŒºåŸŸï¼ŒGC(Garbage Collection)åº”è¯¥ä¸ä¼šå¯¹PermGen spaceè¿›è¡Œæ¸…ç†ï¼Œæ‰€ä»¥å¦‚æžœä½ çš„APPä¼šLOADå¾ˆå¤šCLASSçš„è¯ï¼Œå°±å¾ˆå¯èƒ½å‡ºçŽ°PermGen spaceé”™è¯¯ã€‚ Heap spaceï¼šå­˜æ”¾Instanceã€‚ Java Heapåˆ†ä¸º3ä¸ªåŒºï¼ŒYoungå³æ–°ç”Ÿä»£ï¼ŒOldå³è€ç”Ÿä»£å’ŒPermanentã€‚ Youngä¿å­˜åˆšå®žä¾‹åŒ–çš„å¯¹è±¡ã€‚å½“è¯¥åŒºè¢«å¡«æ»¡æ—¶ï¼ŒGCä¼šå°†å¯¹è±¡ç§»åˆ°OldåŒºã€‚PermanentåŒºåˆ™è´Ÿè´£ä¿å­˜åå°„å¯¹è±¡ã€‚ å †å†…å­˜åˆ†é… JVMåˆå§‹åˆ†é…çš„å †å†…å­˜ç”±-XmsæŒ‡å®šï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼› JVMæœ€å¤§åˆ†é…çš„å †å†…å­˜ç”±-XmxæŒ‡å®šï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚ é»˜è®¤ç©ºä½™å †å†…å­˜å°äºŽ40%æ—¶ï¼ŒJVMå°±ä¼šå¢žå¤§å †ç›´åˆ°-Xmxçš„æœ€å¤§é™åˆ¶ï¼› ç©ºä½™å †å†…å­˜å¤§äºŽ70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ°-Xmsçš„æœ€å°é™åˆ¶ã€‚ å› æ­¤æœåŠ¡å™¨ä¸€èˆ¬è®¾ç½®-Xmsã€-Xmx ç›¸ç­‰ä»¥é¿å…åœ¨æ¯æ¬¡GC åŽè°ƒæ•´å †çš„å¤§å°ã€‚ è¯´æ˜Žï¼šå¦‚æžœ-Xmx ä¸æŒ‡å®šæˆ–è€…æŒ‡å®šåå°ï¼Œåº”ç”¨å¯èƒ½ä¼šå¯¼è‡´java.lang.OutOfMemoryé”™è¯¯ï¼Œæ­¤é”™è¯¯æ¥è‡ªJVMï¼Œä¸æ˜¯Throwableçš„ï¼Œæ— æ³•ç”¨tryâ€¦catchæ•æ‰ã€‚ éžå †å†…å­˜åˆ†é… \1. JVMä½¿ç”¨-XX:PermSizeè®¾ç½®éžå †å†…å­˜åˆå§‹å€¼ï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼› \2. ç”±XX:MaxPermSizeè®¾ç½®æœ€å¤§éžå †å†…å­˜çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚ è¿˜æœ‰ä¸€è¯´ï¼šMaxPermSizeç¼ºçœå€¼å’Œ-server -clienté€‰é¡¹ç›¸å…³ï¼Œ-serveré€‰é¡¹ä¸‹é»˜è®¤MaxPermSizeä¸º64mï¼Œ-clienté€‰é¡¹ä¸‹é»˜è®¤MaxPermSizeä¸º32mã€‚è¿™ä¸ªæˆ‘æ²¡æœ‰å®žéªŒã€‚ \3. XX:MaxPermSizeè®¾ç½®è¿‡å°ä¼šå¯¼è‡´java.lang.OutOfMemoryError: PermGen space å°±æ˜¯å†…å­˜ç›Šå‡ºã€‚ \4. ä¸ºä»€ä¹ˆä¼šå†…å­˜ç›Šå‡ºï¼š è¿™ä¸€éƒ¨åˆ†å†…å­˜ç”¨äºŽå­˜æ”¾Classå’ŒMetaçš„ä¿¡æ¯ï¼ŒClassåœ¨è¢« Loadçš„æ—¶å€™è¢«æ”¾å…¥PermGen spaceåŒºåŸŸï¼Œå®ƒå’Œå­˜æ”¾Instanceçš„HeapåŒºåŸŸä¸åŒã€‚ GC(Garbage Collection)ä¸ä¼šåœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸå¯¹PermGen spaceè¿›è¡Œæ¸…ç†ï¼Œæ‰€ä»¥å¦‚æžœä½ çš„APPä¼šLOADå¾ˆå¤šCLASS çš„è¯,å°±å¾ˆå¯èƒ½å‡ºçŽ°PermGen spaceé”™è¯¯ã€‚ \5. è¿™ç§é”™è¯¯å¸¸è§åœ¨webæœåŠ¡å™¨å¯¹JSPè¿›è¡Œpre compileçš„æ—¶å€™ã€‚ JVMå†…å­˜é™åˆ¶(æœ€å¤§å€¼) \1. é¦–å…ˆJVMå†…å­˜é™åˆ¶äºŽå®žé™…çš„æœ€å¤§ç‰©ç†å†…å­˜ï¼Œå‡è®¾ç‰©ç†å†…å­˜æ— é™å¤§çš„è¯ï¼ŒJVMå†…å­˜çš„æœ€å¤§å€¼è·Ÿæ“ä½œç³»ç»Ÿæœ‰å¾ˆå¤§çš„å…³ç³»ã€‚ç®€å•çš„è¯´å°±32ä½å¤„ç†å™¨è™½ç„¶å¯æŽ§å†…å­˜ç©ºé—´æœ‰4GB,ä½†æ˜¯å…·ä½“çš„æ“ä½œç³»ç»Ÿä¼šç»™ä¸€ä¸ªé™åˆ¶ï¼Œè¿™ä¸ªé™åˆ¶ä¸€èˆ¬æ˜¯2GB-3GBï¼ˆä¸€èˆ¬æ¥è¯´Windowsç³»ç»Ÿä¸‹ä¸º1.5G-2Gï¼ŒLinuxç³»ç»Ÿä¸‹ä¸º2G-3Gï¼‰ï¼Œè€Œ64bitä»¥ä¸Šçš„å¤„ç†å™¨å°±ä¸ä¼šæœ‰é™åˆ¶äº†ã€‚ \2. ä¸ºä»€ä¹ˆæœ‰çš„æœºå™¨æˆ‘å°†-Xmxå’Œ-XX:MaxPermSizeéƒ½è®¾ç½®ä¸º512Mä¹‹åŽEclipseå¯ä»¥å¯åŠ¨ï¼Œè€Œæœ‰äº›æœºå™¨æ— æ³•å¯åŠ¨ï¼Ÿ é€šè¿‡ä¸Šé¢å¯¹JVMå†…å­˜ç®¡ç†çš„ä»‹ç»æˆ‘ä»¬å·²ç»äº†è§£åˆ°JVMå†…å­˜åŒ…å«ä¸¤ç§ï¼šå †å†…å­˜å’Œéžå †å†…å­˜ï¼Œå¦å¤–JVMæœ€å¤§å†…å­˜é¦–å…ˆå–å†³äºŽå®žé™…çš„ç‰©ç†å†…å­˜å’Œæ“ä½œç³»ç»Ÿã€‚æ‰€ä»¥è¯´è®¾ç½®VMå‚æ•°å¯¼è‡´ç¨‹åºæ— æ³•å¯åŠ¨ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§åŽŸå› ï¼š å‚æ•°ä¸­-Xmsçš„å€¼å¤§äºŽ-Xmxï¼Œæˆ–è€…-XX:PermSizeçš„å€¼å¤§äºŽ-XX:MaxPermSizeï¼› -Xmxçš„å€¼å’Œ-XX:MaxPermSizeçš„æ€»å’Œè¶…è¿‡äº†JVMå†…å­˜çš„æœ€å¤§é™åˆ¶ï¼Œæ¯”å¦‚å½“å‰æ“ä½œç³»ç»Ÿæœ€å¤§å†…å­˜é™åˆ¶ï¼Œæˆ–è€…å®žé™…çš„ç‰©ç†å†…å­˜ç­‰ç­‰ã€‚è¯´åˆ°å®žé™…ç‰©ç†å†…å­˜è¿™é‡Œéœ€è¦è¯´æ˜Žä¸€ç‚¹çš„æ˜¯ï¼Œå¦‚æžœä½ çš„å†…å­˜æ˜¯1024MBï¼Œä½†å®žé™…ç³»ç»Ÿä¸­ç”¨åˆ°çš„å¹¶ä¸å¯èƒ½æ˜¯1024MBï¼Œå› ä¸ºæœ‰ä¸€éƒ¨åˆ†è¢«ç¡¬ä»¶å ç”¨äº†ã€‚ \3. å¦‚æžœä½ æœ‰ä¸€ä¸ªåŒæ ¸çš„CPUï¼Œä¹Ÿè®¸å¯ä»¥å°è¯•è¿™ä¸ªå‚æ•°: -XX:+UseParallelGC è®©GCå¯ä»¥æ›´å¿«çš„æ‰§è¡Œã€‚ï¼ˆåªæ˜¯JDK 5é‡Œå¯¹GCæ–°å¢žåŠ çš„å‚æ•°ï¼‰ \4. å¦‚æžœä½ çš„WEB APPä¸‹éƒ½ç”¨äº†å¤§é‡çš„ç¬¬ä¸‰æ–¹jarï¼Œå…¶å¤§å°è¶…è¿‡äº†æœåŠ¡å™¨jvmé»˜è®¤çš„å¤§å°ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå†…å­˜ç›Šå‡ºé—®é¢˜äº†ã€‚è§£å†³æ–¹æ³•ï¼š è®¾ç½®MaxPermSizeå¤§å°ã€‚ å¢žåŠ æœåŠ¡å™¨å¯åŠ¨çš„JVMå‚æ•°è®¾ç½®ï¼š -Xms128m -Xmx256m -XX:PermSize=128M -XX:MaxNewSize=256m -XX:MaxPermSize=256m å¦‚tomcatï¼Œä¿®æ”¹TOMCAT_HOME/bin/catalina.shï¼Œåœ¨echo â€œUsing CATALINA_BASE: $CATALINA_BASEâ€ä¸Šé¢åŠ å…¥ä»¥ä¸‹è¡Œï¼šJAVA_OPTS=â€-server -XX:PermSize=64M -XX:MaxPermSize=128m \5. å»ºè®®ï¼šå°†ç›¸åŒçš„ç¬¬ä¸‰æ–¹jaræ–‡ä»¶ç§»ç½®åˆ°tomcat/shared/libç›®å½•ä¸‹ï¼Œè¿™æ ·å¯ä»¥å‡å°‘jar æ–‡æ¡£é‡å¤å ç”¨å†…å­˜ JVMå†…å­˜è®¾ç½®å‚æ•° å†…å­˜è®¾ç½®å‚æ•° è¯´æ˜Žï¼š å¦‚æžœ-Xmxä¸æŒ‡å®šæˆ–è€…æŒ‡å®šåå°ï¼Œåº”ç”¨å¯èƒ½ä¼šå¯¼è‡´java.lang.OutOfMemoryé”™è¯¯ï¼Œæ­¤é”™è¯¯æ¥è‡ªJVMä¸æ˜¯Throwableçš„ï¼Œæ— æ³•ç”¨tryâ€¦catchæ•æ‰ã€‚ PermSizeå’ŒMaxPermSizeæŒ‡æ˜Žè™šæ‹Ÿæœºä¸ºjavaæ°¸ä¹…ç”Ÿæˆå¯¹è±¡ï¼ˆPermanate generationï¼‰å¦‚ï¼Œclasså¯¹è±¡ã€æ–¹æ³•å¯¹è±¡è¿™äº›å¯åå°„ï¼ˆreflectiveï¼‰å¯¹è±¡åˆ†é…å†…å­˜é™åˆ¶ï¼Œè¿™äº›å†…å­˜ä¸åŒ…æ‹¬åœ¨Heapï¼ˆå †å†…å­˜ï¼‰åŒºä¹‹ä¸­ã€‚ -XX:MaxPermSizeåˆ†é…è¿‡å°ä¼šå¯¼è‡´ï¼šjava.lang.OutOfMemoryError: PermGen spaceã€‚ MaxPermSizeç¼ºçœå€¼å’Œ-server -clienté€‰é¡¹ç›¸å…³ï¼š-serveré€‰é¡¹ä¸‹é»˜è®¤MaxPermSizeä¸º64mã€-clienté€‰é¡¹ä¸‹é»˜è®¤MaxPermSizeä¸º32mã€‚ ç”³è¯·ä¸€å—å†…å­˜çš„è¿‡ç¨‹ JVMä¼šè¯•å›¾ä¸ºç›¸å…³Javaå¯¹è±¡åœ¨Edenä¸­åˆå§‹åŒ–ä¸€å—å†…å­˜åŒºåŸŸ å½“Edenç©ºé—´è¶³å¤Ÿæ—¶ï¼Œå†…å­˜ç”³è¯·ç»“æŸã€‚å¦åˆ™åˆ°ä¸‹ä¸€æ­¥ JVMè¯•å›¾é‡Šæ”¾åœ¨Edenä¸­æ‰€æœ‰ä¸æ´»è·ƒçš„å¯¹è±¡ï¼ˆè¿™å±žäºŽ1æˆ–æ›´é«˜çº§çš„åžƒåœ¾å›žæ”¶ï¼‰ï¼›é‡Šæ”¾åŽè‹¥Edenç©ºé—´ä»ç„¶ä¸è¶³ä»¥æ”¾å…¥æ–°å¯¹è±¡ï¼Œåˆ™è¯•å›¾å°†éƒ¨åˆ†Edenä¸­æ´»è·ƒå¯¹è±¡æ”¾å…¥SurvivoråŒº/OLDåŒº SurvivoråŒºè¢«ç”¨æ¥ä½œä¸ºEdenåŠOLDçš„ä¸­é—´äº¤æ¢åŒºåŸŸï¼Œå½“OLDåŒºç©ºé—´è¶³å¤Ÿæ—¶ï¼ŒSurvivoråŒºçš„å¯¹è±¡ä¼šè¢«ç§»åˆ°OldåŒºï¼Œå¦åˆ™ä¼šè¢«ä¿ç•™åœ¨SurvivoråŒº å½“OLDåŒºç©ºé—´ä¸å¤Ÿæ—¶ï¼ŒJVMä¼šåœ¨OLDåŒºè¿›è¡Œå®Œå…¨çš„åžƒåœ¾æ”¶é›†ï¼ˆ0çº§ï¼‰ å®Œå…¨åžƒåœ¾æ”¶é›†åŽï¼Œè‹¥SurvivoråŠOLDåŒºä»ç„¶æ— æ³•å­˜æ”¾ä»ŽEdenå¤åˆ¶è¿‡æ¥çš„éƒ¨åˆ†å¯¹è±¡ï¼Œå¯¼è‡´JVMæ— æ³•åœ¨EdenåŒºä¸ºæ–°å¯¹è±¡åˆ›å»ºå†…å­˜åŒºåŸŸï¼Œåˆ™å‡ºçŽ°â€out of memoryé”™è¯¯â€ resinæœåŠ¡å™¨å…¸åž‹çš„å“åº”æ—¶é—´ä¼˜å…ˆåž‹çš„jvmé…ç½®ï¼š -Xmx2000M -Xms2000M -Xmn500M -XX:PermSize=250M -XX:MaxPermSize=250M -Xss256K -XX:+DisableExplicitGC -XX:SurvivorRatio=1 -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:+CMSParallelRemarkEnabled -XX:+UseCMSCompactAtFullCollection -XX:CMSFullGCsBeforeCompaction=0 -XX:+CMSClassUnloadingEnabled -XX:LargePageSizeInBytes=128M -XX:+UseFastAccessorMethods -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=60 -XX:SoftRefLRUPolicyMSPerMB=0 -XX:+PrintClassHistogram -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintHeapAtGC -Xloggc:log/gc.log å†…å­˜å›žæ”¶ç®—æ³• Javaä¸­æœ‰å››ç§ä¸åŒçš„å›žæ”¶ç®—æ³•ï¼Œå¯¹åº”çš„å¯åŠ¨å‚æ•°ä¸º: â€“XX:+UseSerialGC â€“XX:+UseParallelGC â€“XX:+UseParallelOldGC â€“XX:+UseConcMarkSweepGC Serial Collector å¤§éƒ¨åˆ†å¹³å°æˆ–è€…å¼ºåˆ¶ java -client é»˜è®¤ä¼šä½¿ç”¨è¿™ç§ã€‚ young generationç®—æ³• = serial old generationç®—æ³• = serial (mark-sweep-compact) è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹å¾ˆæ˜Žæ˜¾, stop-the-world, é€Ÿåº¦æ…¢ã€‚æœåŠ¡å™¨åº”ç”¨ä¸æŽ¨èä½¿ç”¨ã€‚ Parallel Collector åœ¨linux x64ä¸Šé»˜è®¤æ˜¯è¿™ç§ï¼Œå…¶ä»–å¹³å°è¦åŠ  java -server å‚æ•°æ‰ä¼šé»˜è®¤é€‰ç”¨è¿™ç§ã€‚ young = parallelï¼Œå¤šä¸ªthreadåŒæ—¶copy old = mark-sweep-compact = 1 ä¼˜ç‚¹ï¼šæ–°ç”Ÿä»£å›žæ”¶æ›´å¿«ã€‚å› ä¸ºç³»ç»Ÿå¤§éƒ¨åˆ†æ—¶é—´åšçš„gcéƒ½æ˜¯æ–°ç”Ÿä»£çš„ï¼Œè¿™æ ·æé«˜äº†throughput(cpuç”¨äºŽéžgcæ—¶é—´) ç¼ºç‚¹ï¼šå½“è¿è¡Œåœ¨8G/16G serverä¸Šold generation live objectå¤ªå¤šæ—¶å€™pause timeè¿‡é•¿ Parallel Compact Collector (ParallelOld) young = parallel = 2 old = parallelï¼Œåˆ†æˆå¤šä¸ªç‹¬ç«‹çš„å•å…ƒï¼Œå¦‚æžœå•å…ƒä¸­live objectå°‘åˆ™å›žæ”¶ï¼Œå¤šåˆ™è·³è¿‡ ä¼˜ç‚¹ï¼šold old generationä¸Šæ€§èƒ½è¾ƒ parallel æ–¹å¼æœ‰æé«˜ ç¼ºç‚¹ï¼šå¤§éƒ¨åˆ†serverç³»ç»Ÿold generationå†…å­˜å ç”¨ä¼šè¾¾åˆ°60%-80%, æ²¡æœ‰é‚£ä¹ˆå¤šç†æƒ³çš„å•å…ƒlive objectå¾ˆå°‘æ–¹ä¾¿è¿…é€Ÿå›žæ”¶ï¼ŒåŒæ—¶compactæ–¹é¢å¼€é”€æ¯”èµ·parallelå¹¶æ²¡æ˜Žæ˜¾å‡å°‘ã€‚ Concurrent Mark-Sweep(CMS) Collector young generation = parallel collector = 2 old = cms åŒæ—¶ä¸åš compact æ“ä½œã€‚ ä¼˜ç‚¹ï¼špause timeä¼šé™ä½Ž, pauseæ•æ„Ÿä½†CPUæœ‰ç©ºé—²çš„åœºæ™¯éœ€è¦å»ºè®®ä½¿ç”¨ç­–ç•¥4. ç¼ºç‚¹ï¼šcpuå ç”¨è¿‡å¤šï¼Œcpuå¯†é›†åž‹æœåŠ¡å™¨ä¸é€‚åˆã€‚å¦å¤–ç¢Žç‰‡å¤ªå¤šï¼Œæ¯ä¸ªobjectçš„å­˜å‚¨éƒ½è¦é€šè¿‡é“¾è¡¨è¿žç»­è·³nä¸ªåœ°æ–¹ï¼Œç©ºé—´æµªè´¹é—®é¢˜ä¹Ÿä¼šå¢žå¤§ã€‚ å†…å­˜ç›‘æŽ§æ–¹æ³• jmap -heap æŸ¥çœ‹java å †ï¼ˆheapï¼‰ä½¿ç”¨æƒ…å†µ jmap -heap pid using thread-local object allocation. Parallel GC with 4 thread(s) #GC æ–¹å¼ Heap Configuration: #å †å†…å­˜åˆå§‹åŒ–é…ç½® MinHeapFreeRatio=40 #å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MinHeapFreeRatioè®¾ç½®JVMå †æœ€å°ç©ºé—²æ¯”çŽ‡(default 40) MaxHeapFreeRatio=70 #å¯¹åº”jvmå¯åŠ¨å‚æ•° -XX:MaxHeapFreeRatioè®¾ç½®JVMå †æœ€å¤§ç©ºé—²æ¯”çŽ‡(default 70) MaxHeapSize=512.0MB #å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxHeapSize=è®¾ç½®JVMå †çš„æœ€å¤§å¤§å° NewSize = 1.0MB #å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:NewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„é»˜è®¤å¤§å° MaxNewSize =4095MB #å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxNewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„æœ€å¤§å¤§å° OldSize = 4.0MB #å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:OldSize=:è®¾ç½®JVMå †çš„â€˜è€ç”Ÿä»£â€™çš„å¤§å° NewRatio = 8 #å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:NewRatio=:â€˜æ–°ç”Ÿä»£â€™å’Œâ€˜è€ç”Ÿä»£â€™çš„å¤§å°æ¯”çŽ‡ SurvivorRatio = 8 #å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:SurvivorRatio=è®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸ŽSurvivoråŒºçš„å¤§å°æ¯”å€¼ PermSize= 16.0MB #å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:PermSize=:è®¾ç½®JVMå †çš„â€˜æ°¸ç”Ÿä»£â€™çš„åˆå§‹å¤§å° MaxPermSize=64.0MB #å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxPermSize=:è®¾ç½®JVMå †çš„â€˜æ°¸ç”Ÿä»£â€™çš„æœ€å¤§å¤§å° Heap Usage: #å †å†…å­˜åˆ†æ­¥ PS Young Generation Eden Space: #EdenåŒºå†…å­˜åˆ†å¸ƒ capacity = 20381696 (19.4375MB) #EdenåŒºæ€»å®¹é‡ used = 20370032 (19.426376342773438MB) #EdenåŒºå·²ä½¿ç”¨ free = 11664 (0.0111236572265625MB) #EdenåŒºå‰©ä½™å®¹é‡ 99.94277218147106% used #EdenåŒºä½¿ç”¨æ¯”çŽ‡ From Space: #å…¶ä¸­ä¸€ä¸ªSurvivoråŒºçš„å†…å­˜åˆ†å¸ƒ capacity = 8519680 (8.125MB) used = 32768 (0.03125MB) free = 8486912 (8.09375MB) 0.38461538461538464% used To Space: #å¦ä¸€ä¸ªSurvivoråŒºçš„å†…å­˜åˆ†å¸ƒ capacity = 9306112 (8.875MB) used = 0 (0.0MB) free = 9306112 (8.875MB) 0.0% used PS Old Generation #å½“å‰çš„OldåŒºå†…å­˜åˆ†å¸ƒ capacity = 366280704 (349.3125MB) used = 322179848 (307.25464630126953MB) free = 44100856 (42.05785369873047MB) 87.95982001825573% used PS Perm Generation #å½“å‰çš„ â€œæ°¸ç”Ÿä»£â€ å†…å­˜åˆ†å¸ƒ capacity = 32243712 (30.75MB) used = 28918584 (27.57891082763672MB) free = 3325128 (3.1710891723632812MB) 89.68751488662348% used JVMå†…å­˜ç›‘æŽ§å·¥å…· &lt;%@ page import=â€java.lang.management.*â€ %&gt; &lt;%@ page import=â€java.util.*â€ %&gt; JVM Memory Monitorâ€‹ Memory MXBeanâ€‹ Heap Memory Usage&lt;%=ManagementFactory.getMemoryMXBean().getHeapMemoryUsage()%&gt;â€‹ Non-Heap Memory Usage&lt;%=ManagementFactory.getMemoryMXBean().getNonHeapMemoryUsage()%&gt;â€‹ â€‹ Memory Pool MXBeans&lt;%â€‹ Iterator iter = ManagementFactory.getMemoryPoolMXBeans().iterator();â€‹ while (iter.hasNext()) {â€‹ MemoryPoolMXBean item = (MemoryPoolMXBean) iter.next();%&gt;â€‹ â€‹ &lt;%= item.getName() %&gt;â€‹ Type&lt;%= item.getType() %&gt;â€‹ Usage&lt;%= item.getUsage() %&gt;â€‹ Peak Usage&lt;%= item.getPeakUsage() %&gt;â€‹ Collection Usage&lt;%= item.getCollectionUsage() %&gt;â€‹ &lt;%} %&gt;]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL selectå­æŸ¥è¯¢å¼•ç”¨å˜é‡]]></title>
    <url>%2F2017%2F12%2F28%2FMySQL-select%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%BC%95%E7%94%A8%E5%8F%98%E9%87%8F%2F</url>
    <content type="text"><![CDATA[ç¤ºä¾‹ä¸€å‰å‡ å¤©çœ‹åˆ«äººçš„ä»£ç ä¸­çœ‹åˆ°åœ¨å­—æ®µä¸­ä½¿ç”¨selectå­æŸ¥è¯¢çš„æ–¹æ³•ï¼Œç¬¬ä¸€æ¬¡è§è¿™ç§å†™æ³•ï¼Œç„¶åŽç ”ç©¶äº†ä¸€ä¸‹ï¼Œè®°å½•ä¸‹æ¥ å¤§æ¦‚çš„å½¢å¼æ˜¯è¿™æ ·çš„: 1select a .*,(select b.another_field from b where a.id=b.aid) another_field from a where 1 limit 10; ä¸‹é¢è¿˜æ˜¯ä»¥å®žä¾‹æ¥è¯´æ˜Žï¼Œè¦ä¸ç„¶ä¸å¥½ç†è§£ï¼Œæ–°å»ºä¸¤å¼ è¡¨ï¼Œä¸€å¼ æ˜¯å•†å“è¡¨ï¼Œå¦å¤–ä¸€å¼ æ˜¯å•†å“çš„è¯„è®ºè¡¨ å•†å“è¡¨ï¼š 123456CREATE TABLE `product` ( `id` int(11) NOT NULL AUTO_INCREMENT, `product_name` varchar(30) CHARACTER SET utf8 NOT NULL, `price` float NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB; è¯„è®ºè¡¨ï¼š 1234567CREATE TABLE `comment` ( `id` int(11) NOT NULL AUTO_INCREMENT, `entity_id` int(11) NOT NULL, `content` varchar(100) CHARACTER SET utf8 NOT NULL, PRIMARY KEY (`id`)) ENGINE=InnoDB; ç„¶åŽæ’å…¥ä¸€äº›æ•°æ®ï¼š 123456789INSERT INTO `product` (`id`, `product_name`, `price`) VALUES(1, 'è‚‰æ¾é¥¼', 5),(2, 'å¯ä¹', 5),(3, 'é¸¡ç¿…', 12),(4, 'æ¯å­', 42);INSERT INTO `comment` (`id`, `entity_id`, `content`) VALUES(1, 1, 'å‘³é“è¿˜ä¸é”™'),(2, 1, 'è¿˜è¡Œå•Š'),(3, 3, 'å¾ˆå®žç”¨å“¦'); ä¸‹é¢æˆ‘ä»¬ç”¨å­æŸ¥è¯¢çš„æ–¹å¼æ¥æŸ¥å‡ºå•†å“çš„ä¿¡æ¯ä»¥åŠæ¯ä¸ªå•†å“çš„è¯„è®ºæ•°é‡ 1SELECT product.*,(select count(comment.id) from comment where product.id=comment.entity_id) comment_count FROM `product` limit 5; æŸ¥è¯¢ç»“æžœå¦‚ä¸‹ï¼š id product_name price comment_count 1 è‚‰æ¾é¥¼ 5 2 2 å¯ä¹ 5 0 3 é¸¡ç¿… 12 1 4 æ¯å­ 42 0 å¯¹äºŽè¿™ç§æŸ¥è¯¢ï¼Œå¯ä»¥åˆ†æˆä¸¤éƒ¨æ¥ç†è§£ï¼Œé¦–å…ˆå¿½ç•¥æ•´ä¸ªselectå­æŸ¥è¯¢ï¼ŒæŸ¥å‡ºå•†å“è¡¨ä¸­çš„æ•°æ®ï¼Œç„¶åŽæ ¹æ®å•†å“çš„idæ‰§è¡Œå­æŸ¥è¯¢ï¼Œå¯¹äºŽä¸€ä¸ªå•†å“id,å­æŸ¥è¯¢åªèƒ½è¿”å›žä¸€æ¡æ•°æ®ï¼Œå¦‚æžœå­æŸ¥è¯¢è¿”å›žå¤šæ¡æ•°æ®åˆ™ä¼šå‡ºé”™ï¼Œå¦å¤–ï¼Œæ¯ä¸€æ¡selectå­æŸ¥è¯¢åªèƒ½æŸ¥è¯¢ä¸€ä¸ªå­—æ®µã€‚ å¦å¤–çš„åˆ—å­ï¼ŒæŸ¥å‡ºæ¯ä¸ªå•†å“ä¿¡æ¯ä»¥åŠå•†å“çš„æœ€æ–°è¯„è®ºå†…å®¹ï¼š 1SELECT product.*,(select comment.content from comment where product.id=comment.entity_id order by comment.id desc limit 1) comment_count FROM `product` limit 5; æŸ¥è¯¢ç»“æžœå¦‚ä¸‹ï¼š id product_name price last_comment 1 è‚‰æ¾é¥¼ 5 è¿˜è¡Œå•Š 2 å¯ä¹ 5 NULL 3 é¸¡ç¿… 12 å¾ˆå®žç”¨å“¦ 4 æ¯å­ 42 NULL ç¤ºä¾‹äºŒ billingåˆ†ä¸¤æ­¥çœ‹ï¼Œ ä¸çœ‹å­—æŸ¥è¯¢bi.id not in () , ç›¸å½“äºŽæŸ¥è¯¢å‡ºæ‰€æœ‰çš„statusä¸º1çš„idï¼Œå’Œè®°å½• SELECT substring_index(group_concat(id ORDER BY product_start_time desc) , â€˜,â€™ , 1)â€‹ FROM cash_billing_itemâ€‹ WHERE status = 1â€‹ GROUP BY product_no, customer_no SELECT SUBSTRING_INDEX(â€˜15,151,152,16â€™,â€™,â€™,1); ==&gt;å¾—åˆ°ç»“æžœä¸ºï¼š 15 ç„¶åŽæ¯ä¸€æ¡è®°å½•çš„bi.product_no å’Œbi.customer_noï¼Œåˆ†åˆ«å’Œselectçš„ç»“æžœæ¯”è¾ƒ 123456789101112131415161718192021222324252627SELECT bi.idFROM cash_billing_item biWHERE bi.id and bi.status = 1 and bi.id not in ( SELECT substring_index(group_concat(id ORDER BY product_start_time desc) , ',' , 1) FROM cash_billing_item WHERE product_no = bi.product_no AND customer_no = bi.customer_no and status = 1 GROUP BY product_no, customer_no ); UPDATE cash_billing_item bi, ( SELECT bi.id FROM cash_billing_item bi WHERE bi.id and bi.status = 1 and bi.id not in ( SELECT group_concat(id ORDER BY product_start_time desc) FROM cash_billing_item WHERE product_no = bi.product_no AND customer_no = bi.customer_no and status = 1 GROUP BY product_no, customer_no ) ) temp SET bi.status = 2 WHERE bi.id = temp.id; cash_billing_item_copy 123456789101112131415161718192021222324252627282930313233343536373839404142create table cash_billing_item_copy( id bigint(11) unsigned auto_increment comment 'è‡ªå¢žid' primary key, customer_no varchar(64) null comment 'å®¢æˆ·ç¼–å·', product_id int not null comment 'äº§å“è¡¨pk', product_start_time timestamp null comment 'äº§å“ç”Ÿæ•ˆæ—¶é—´', gmt_create timestamp default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´', gmt_modify timestamp default CURRENT_TIMESTAMP not null comment 'ä¿®æ”¹æ—¶é—´') comment 'ä»Žè´¦åŠ¡ç³»ç»ŸæŽ¨æ¥çš„è®¡è´¹é¡¹';INSERT INTO cash_billing_item_copy (customer_no, product_id, product_start_time) VALUES ('ct2',1,'2017-12-27 00:00:00');SELECT * FROM cash_billing_item_copy;SELECT group_concat(id ORDER BY product_start_time DESC), customer_no , product_idFROM cash_billing_item_copyGROUP BY customer_no , product_id;SELECT c.id FROM cash_billing_item_copy cWHERE c.id AND c.id NOT IN ( SELECT substring_index(group_concat(id ORDER BY product_start_time DESC), ',', 1) FROM cash_billing_item_copy GROUP BY customer_no, product_id );SELECT SUBSTRING_INDEX('15,151,152,16',',',1);]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Reactç”Ÿå‘½å‘¨æœŸ]]></title>
    <url>%2F2017%2F12%2F27%2FReact%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%2F</url>
    <content type="text"><![CDATA[å‰è¨€å­¦ä¹ Reactï¼Œç”Ÿå‘½å‘¨æœŸå¾ˆé‡è¦ï¼Œæˆ‘ä»¬äº†è§£å®Œç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªç»„ä»¶ï¼Œå¯¹å†™é«˜æ€§èƒ½ç»„ä»¶ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©. Ractç”Ÿå‘½å‘¨æœŸReact ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä¸‰ç§çŠ¶æ€ 1. åˆå§‹åŒ– 2.æ›´æ–° 3.é”€æ¯ åˆå§‹åŒ– 1ã€getDefaultProps() è®¾ç½®é»˜è®¤çš„propsï¼Œä¹Ÿå¯ä»¥ç”¨dufaultPropsè®¾ç½®ç»„ä»¶çš„é»˜è®¤å±žæ€§. 2ã€getInitialState() åœ¨ä½¿ç”¨es6çš„classè¯­æ³•æ—¶æ˜¯æ²¡æœ‰è¿™ä¸ªé’©å­å‡½æ•°çš„ï¼Œå¯ä»¥ç›´æŽ¥åœ¨constructorä¸­å®šä¹‰this.stateã€‚æ­¤æ—¶å¯ä»¥è®¿é—®this.props 3ã€componentWillMount() ç»„ä»¶åˆå§‹åŒ–æ—¶åªè°ƒç”¨ï¼Œä»¥åŽç»„ä»¶æ›´æ–°ä¸è°ƒç”¨ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸåªè°ƒç”¨ä¸€æ¬¡ï¼Œæ­¤æ—¶å¯ä»¥ä¿®æ”¹stateã€‚ 4ã€ render() reactæœ€é‡è¦çš„æ­¥éª¤ï¼Œåˆ›å»ºè™šæ‹Ÿdomï¼Œè¿›è¡Œdiffç®—æ³•ï¼Œæ›´æ–°domæ ‘éƒ½åœ¨æ­¤è¿›è¡Œã€‚æ­¤æ—¶å°±ä¸èƒ½æ›´æ”¹stateäº†ã€‚ 5ã€componentDidMount() ç»„ä»¶æ¸²æŸ“ä¹‹åŽè°ƒç”¨ï¼Œåªè°ƒç”¨ä¸€æ¬¡ã€‚ æ›´æ–° 6ã€componentWillReceiveProps(nextProps) ç»„ä»¶åˆå§‹åŒ–æ—¶ä¸è°ƒç”¨ï¼Œç»„ä»¶æŽ¥å—æ–°çš„propsæ—¶è°ƒç”¨ã€‚ 7ã€shouldComponentUpdate(nextProps, nextState) reactæ€§èƒ½ä¼˜åŒ–éžå¸¸é‡è¦çš„ä¸€çŽ¯ã€‚ç»„ä»¶æŽ¥å—æ–°çš„stateæˆ–è€…propsæ—¶è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®åœ¨æ­¤å¯¹æ¯”å‰åŽä¸¤ä¸ªpropså’Œstateæ˜¯å¦ç›¸åŒï¼Œå¦‚æžœç›¸åŒåˆ™è¿”å›žfalseé˜»æ­¢æ›´æ–°ï¼Œå› ä¸ºç›¸åŒçš„å±žæ€§çŠ¶æ€ä¸€å®šä¼šç”Ÿæˆç›¸åŒçš„domæ ‘ï¼Œè¿™æ ·å°±ä¸éœ€è¦åˆ›é€ æ–°çš„domæ ‘å’Œæ—§çš„domæ ‘è¿›è¡Œdiffç®—æ³•å¯¹æ¯”ï¼ŒèŠ‚çœå¤§é‡æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨domç»“æž„å¤æ‚çš„æ—¶å€™ 8ã€componentWillUpdata(nextProps, nextState) ç»„ä»¶åˆå§‹åŒ–æ—¶ä¸è°ƒç”¨ï¼Œåªæœ‰åœ¨ç»„ä»¶å°†è¦æ›´æ–°æ—¶æ‰è°ƒç”¨ï¼Œæ­¤æ—¶å¯ä»¥ä¿®æ”¹state 9ã€render() ç»„ä»¶æ¸²æŸ“ 10ã€componentDidUpdate() ç»„ä»¶åˆå§‹åŒ–æ—¶ä¸è°ƒç”¨ï¼Œç»„ä»¶æ›´æ–°å®ŒæˆåŽè°ƒç”¨ï¼Œæ­¤æ—¶å¯ä»¥èŽ·å–domèŠ‚ç‚¹ã€‚ å¸è½½ 11ã€componentWillUnmount() ç»„ä»¶å°†è¦å¸è½½æ—¶è°ƒç”¨ï¼Œä¸€äº›äº‹ä»¶ç›‘å¬å’Œå®šæ—¶å™¨éœ€è¦åœ¨æ­¤æ—¶æ¸…é™¤ã€‚ ç»“æŸè¯­ä»¥ä¸Šå°±æ˜¯React çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå†™ä¸‹codeæµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨è¿™é‡Œæˆ‘å°±ä¸è´´code äº†ã€‚ ä¸‹é¢æ‰€å†™çš„ï¼Œåªé€‚åˆå‰ç«¯çš„Reactã€‚ï¼ˆReactä¹Ÿæ”¯æŒåŽç«¯æ¸²æŸ“ï¼Œè€Œä¸”å’Œå‰ç«¯æœ‰ç‚¹å°åŒºåˆ«ï¼Œä¸è¿‡æˆ‘æ²¡ç”¨è¿‡ã€‚ï¼‰ ç›¸å…³å‡½æ•°ç®€å•åœ°è¯´ï¼ŒReact Componenté€šè¿‡å…¶å®šä¹‰çš„å‡ ä¸ªå‡½æ•°æ¥æŽ§åˆ¶ç»„ä»¶åœ¨ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªé˜¶æ®µçš„åŠ¨ä½œã€‚ åœ¨ES6ä¸­ï¼Œä¸€ä¸ªReactç»„ä»¶æ˜¯ç”¨ä¸€ä¸ªclassæ¥è¡¨ç¤ºçš„ï¼ˆå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰ï¼Œå¦‚ä¸‹ï¼š 1234// å®šä¹‰ä¸€ä¸ªTodoListçš„Reactç»„ä»¶ï¼Œé€šè¿‡ç»§æ‰¿React.Componentæ¥å®žçŽ°class TodoList extends React.Component &#123; ...&#125; è¿™å‡ ä¸ªç”Ÿå‘½å‘¨æœŸç›¸å…³çš„å‡½æ•°æœ‰ï¼š 1constructor(props, context) æž„é€ å‡½æ•°ï¼Œåœ¨åˆ›å»ºç»„ä»¶çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ã€‚ 1void componentWillMount() åœ¨ç»„ä»¶æŒ‚è½½ä¹‹å‰è°ƒç”¨ä¸€æ¬¡ã€‚å¦‚æžœåœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢è°ƒç”¨setStateï¼Œæœ¬æ¬¡çš„renderå‡½æ•°å¯ä»¥çœ‹åˆ°æ›´æ–°åŽçš„stateï¼Œå¹¶ä¸”åªæ¸²æŸ“ä¸€æ¬¡ã€‚ 1void componentDidMount() åœ¨ç»„ä»¶æŒ‚è½½ä¹‹åŽè°ƒç”¨ä¸€æ¬¡ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå­ä¸»é”®ä¹Ÿéƒ½æŒ‚è½½å¥½äº†ï¼Œå¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨refsã€‚ 1void componentWillReceiveProps(nextProps) propsæ˜¯çˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶çš„ã€‚çˆ¶ç»„ä»¶å‘ç”Ÿrenderçš„æ—¶å€™å­ç»„ä»¶å°±ä¼šè°ƒç”¨componentWillReceivePropsï¼ˆä¸ç®¡propsæœ‰æ²¡æœ‰æ›´æ–°ï¼Œä¹Ÿä¸ç®¡çˆ¶å­ç»„ä»¶ä¹‹é—´æœ‰æ²¡æœ‰æ•°æ®äº¤æ¢ï¼‰ã€‚ 1bool shouldComponentUpdate(nextProps, nextState) ç»„ä»¶æŒ‚è½½ä¹‹åŽï¼Œæ¯æ¬¡è°ƒç”¨setStateåŽéƒ½ä¼šè°ƒç”¨shouldComponentUpdateåˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚é»˜è®¤è¿”å›žtrueï¼Œéœ€è¦é‡æ–°renderã€‚åœ¨æ¯”è¾ƒå¤æ‚çš„åº”ç”¨é‡Œï¼Œæœ‰ä¸€äº›æ•°æ®çš„æ”¹å˜å¹¶ä¸å½±å“ç•Œé¢å±•ç¤ºï¼Œå¯ä»¥åœ¨è¿™é‡Œåšåˆ¤æ–­ï¼Œä¼˜åŒ–æ¸²æŸ“æ•ˆçŽ‡ã€‚ 1void componentWillUpdate(nextProps, nextState) shouldComponentUpdateè¿”å›žtrueæˆ–è€…è°ƒç”¨forceUpdateä¹‹åŽï¼ŒcomponentWillUpdateä¼šè¢«è°ƒç”¨ã€‚ 1void componentDidUpdate() é™¤äº†é¦–æ¬¡renderä¹‹åŽè°ƒç”¨componentDidMountï¼Œå…¶å®ƒrenderç»“æŸä¹‹åŽéƒ½æ˜¯è°ƒç”¨componentDidUpdateã€‚ componentWillMountã€componentDidMountå’ŒcomponentWillUpdateã€componentDidUpdateå¯ä»¥å¯¹åº”èµ·æ¥ã€‚åŒºåˆ«åœ¨äºŽï¼Œå‰è€…åªæœ‰åœ¨æŒ‚è½½çš„æ—¶å€™ä¼šè¢«è°ƒç”¨ï¼›è€ŒåŽè€…åœ¨ä»¥åŽçš„æ¯æ¬¡æ›´æ–°æ¸²æŸ“ä¹‹åŽéƒ½ä¼šè¢«è°ƒç”¨ã€‚ 1ReactElement render() renderæ˜¯ä¸€ä¸ªReactç»„ä»¶æ‰€å¿…ä¸å¯å°‘çš„æ ¸å¿ƒå‡½æ•°ï¼ˆä¸Šé¢çš„å…¶å®ƒå‡½æ•°éƒ½ä¸æ˜¯å¿…é¡»çš„ï¼‰ã€‚è®°ä½ï¼Œä¸è¦åœ¨renderé‡Œé¢ä¿®æ”¹stateã€‚ 1void componentWillUnmount() ç»„ä»¶è¢«å¸è½½çš„æ—¶å€™è°ƒç”¨ã€‚ä¸€èˆ¬åœ¨componentDidMounté‡Œé¢æ³¨å†Œçš„äº‹ä»¶éœ€è¦åœ¨è¿™é‡Œåˆ é™¤ã€‚ æ›´æ–°æ–¹å¼åœ¨reactä¸­ï¼Œè§¦å‘renderçš„æœ‰4æ¡è·¯å¾„ã€‚ ä»¥ä¸‹å‡è®¾shouldComponentUpdateéƒ½æ˜¯æŒ‰ç…§é»˜è®¤è¿”å›žtrueçš„æ–¹å¼ã€‚ é¦–æ¬¡æ¸²æŸ“Initial Render è°ƒç”¨this.setState ï¼ˆå¹¶ä¸æ˜¯ä¸€æ¬¡setStateä¼šè§¦å‘ä¸€æ¬¡renderï¼ŒReactå¯èƒ½ä¼šåˆå¹¶æ“ä½œï¼Œå†ä¸€æ¬¡æ€§è¿›è¡Œrenderï¼‰ çˆ¶ç»„ä»¶å‘ç”Ÿæ›´æ–°ï¼ˆä¸€èˆ¬å°±æ˜¯propså‘ç”Ÿæ”¹å˜ï¼Œä½†æ˜¯å°±ç®—propsæ²¡æœ‰æ”¹å˜æˆ–è€…çˆ¶å­ç»„ä»¶ä¹‹é—´æ²¡æœ‰æ•°æ®äº¤æ¢ä¹Ÿä¼šè§¦å‘renderï¼‰ è°ƒç”¨this.forceUpdate ä¸‹é¢æ˜¯æˆ‘å¯¹Reactç»„ä»¶å››æ¡æ›´æ–°è·¯å¾„åœ°æ€»ç»“ï¼š Reactç»„ä»¶æ›´æ–°è·¯å¾„.png æ³¨æ„ï¼Œå¦‚æžœåœ¨shouldComponentUpdateé‡Œé¢è¿”å›žfalseå¯ä»¥æå‰é€€å‡ºæ›´æ–°è·¯å¾„ã€‚ ä¸€ä¸ªReactç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æµ‹è¯•ä¾‹å­ä»£ç æ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰é€»è¾‘ï¼Œåªæ˜¯åœ¨æ¯ä¸ªç›¸å…³å‡½æ•°é‡Œé¢alertä¸€ä¸‹ã€‚ç‚¹å‡»é“¾æŽ¥æ¥è¯•è¯•è¿™ä¸ªä¾‹å­ã€‚æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112class LifeCycle extends React.Component &#123; constructor(props) &#123; super(props); alert("Initial render"); alert("constructor"); this.state = &#123;str: "hello"&#125;; &#125; componentWillMount() &#123; alert("componentWillMount"); &#125; componentDidMount() &#123; alert("componentDidMount"); &#125; componentWillReceiveProps(nextProps) &#123; alert("componentWillReceiveProps"); &#125; shouldComponentUpdate() &#123; alert("shouldComponentUpdate"); return true; // è®°å¾—è¦è¿”å›žtrue &#125; componentWillUpdate() &#123; alert("componentWillUpdate"); &#125; componentDidUpdate() &#123; alert("componentDidUpdate"); &#125; componentWillUnmount() &#123; alert("componentWillUnmount"); &#125; setTheState() &#123; let s = "hello"; if (this.state.str === s) &#123; s = "HELLO"; &#125; this.setState(&#123; str: s &#125;); &#125; forceItUpdate() &#123; this.forceUpdate(); &#125; render() &#123; alert("render"); return( &lt;div&gt; &lt;span&gt;&#123;"Props:"&#125;&lt;h2&gt;&#123;parseInt(this.props.num)&#125;&lt;/h2&gt;&lt;/span&gt; &lt;br /&gt; &lt;span&gt;&#123;"State:"&#125;&lt;h2&gt;&#123;this.state.str&#125;&lt;/h2&gt;&lt;/span&gt; &lt;/div&gt; ); &#125;&#125;class Container extends React.Component &#123; constructor(props) &#123; super(props); this.state = &#123; num: Math.random() * 100 &#125;; &#125; propsChange() &#123; this.setState(&#123; num: Math.random() * 100 &#125;); &#125; setLifeCycleState() &#123; this.refs.rLifeCycle.setTheState(); &#125; forceLifeCycleUpdate() &#123; this.refs.rLifeCycle.forceItUpdate(); &#125; unmountLifeCycle() &#123; // è¿™é‡Œå¸è½½çˆ¶ç»„ä»¶ä¹Ÿä¼šå¯¼è‡´å¸è½½å­ç»„ä»¶ React.unmountComponentAtNode(document.getElementById("container")); &#125; parentForceUpdate() &#123; this.forceUpdate(); &#125; render() &#123; return ( &lt;div&gt; &lt;a href="javascript:;" className="weui_btn weui_btn_primary" onClick=&#123;this.propsChange.bind(this)&#125;&gt;propsChange&lt;/a&gt; &lt;a href="javascript:;" className="weui_btn weui_btn_primary" onClick=&#123;this.setLifeCycleState.bind(this)&#125;&gt;setState&lt;/a&gt; &lt;a href="javascript:;" className="weui_btn weui_btn_primary" onClick=&#123;this.forceLifeCycleUpdate.bind(this)&#125;&gt;forceUpdate&lt;/a&gt; &lt;a href="javascript:;" className="weui_btn weui_btn_primary" onClick=&#123;this.unmountLifeCycle.bind(this)&#125;&gt;unmount&lt;/a&gt; &lt;a href="javascript:;" className="weui_btn weui_btn_primary" onClick=&#123;this.parentForceUpdate.bind(this)&#125;&gt;parentForceUpdateWithoutChange&lt;/a&gt; &lt;LifeCycle ref="rLifeCycle" num=&#123;this.state.num&#125;&gt;&lt;/LifeCycle&gt; &lt;/div&gt; ); &#125;&#125;ReactDom.render( &lt;Container&gt;&lt;/Container&gt;, document.getElementById('container'));]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>react</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‰ç«¯æŒ‡å—-reactå¿«é€Ÿå¼€å‘]]></title>
    <url>%2F2017%2F12%2F23%2F%E5%89%8D%E7%AB%AF%E6%8C%87%E5%8D%97-react%E5%BF%AB%E9%80%9F%E5%BC%80%E5%8F%91%2F</url>
    <content type="text"><![CDATA[Reacté¡¹ç›®å¼€å‘é€šè¿‡ npm ä½¿ç”¨ Reactå¦‚æžœä½ çš„ç³»ç»Ÿè¿˜ä¸æ”¯æŒ Node.js åŠ NPM å¯ä»¥å‚è€ƒæˆ‘ä»¬çš„ Node.js æ•™ç¨‹ã€‚ æˆ‘ä»¬å»ºè®®åœ¨ React ä¸­ä½¿ç”¨ CommonJS æ¨¡å—ç³»ç»Ÿï¼Œæ¯”å¦‚ browserify æˆ– webpackï¼Œæœ¬æ•™ç¨‹ä½¿ç”¨ webpackã€‚ å›½å†…ä½¿ç”¨ npm é€Ÿåº¦å¾ˆæ…¢ï¼Œä½ å¯ä»¥ä½¿ç”¨æ·˜å®å®šåˆ¶çš„ cnpm (gzip åŽ‹ç¼©æ”¯æŒ) å‘½ä»¤è¡Œå·¥å…·ä»£æ›¿é»˜è®¤çš„ npm: 12$ npm install -g cnpm --registry=https://registry.npm.taobao.org$ npm config set registry https://registry.npm.taobao.org è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ cnpm å‘½ä»¤æ¥å®‰è£…æ¨¡å—äº†ï¼š 1$ cnpm install [name] æ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥é˜…ï¼šhttp://npm.taobao.org/ã€‚ ä½¿ç”¨ create-react-app å¿«é€Ÿæž„å»º React å¼€å‘çŽ¯å¢ƒcreate-react-app æ˜¯æ¥è‡ªäºŽ Facebookï¼Œé€šè¿‡è¯¥å‘½ä»¤æˆ‘ä»¬æ— éœ€é…ç½®å°±èƒ½å¿«é€Ÿæž„å»º React å¼€å‘çŽ¯å¢ƒã€‚ create-react-app è‡ªåŠ¨åˆ›å»ºçš„é¡¹ç›®æ˜¯åŸºäºŽ Webpack + ES6 ã€‚ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºé¡¹ç›®ï¼š 12345678$ cnpm install -g create-react-app$ create-react-app my-app$ cd my-app/$ npm startyarn startyarn build 1234567891011121314151617 yarn start Starts the development server. yarn build Bundles the app into static files for production. yarn test Starts the test runner. yarn eject Removes this tool and copies build dependencies, configuration files and scripts into the app directory. If you do this, you canâ€™t go back!We suggest that you begin by typing: cd billing-monitor-web yarn start ä½¿ç”¨yarnæž„å»ºå‰ç«¯1234563425 npm install yarn -g //å…¨å±€å®‰è£…yarn,ä¸åœ¨package.jsonæ–‡ä»¶3426 ls3427 yarn add serve -g //å…¨å±€å®‰è£…serve,æœ‰ä¸ªæœåŠ¡å®¹å™¨3428 lsysq3429 yarn start //å¯åŠ¨é¡¹ç›®yarn build æž„å»ºå‰ç«¯ nodeé¡¹ç›®å¼€å‘##è¿›å…¥å·¥ç¨‹ç›®å½• 1cd $&#123;project_path&#125; ##ä»Žgitä¸­èŽ·å–æœ€æ–°ä»£ç  12git pullgit checkout $&#123;tag_name&#125; ##è¿è¡Œnpm install 1npm install æŸ¥çœ‹pm2è¿›ç¨‹id1pm2 list åœæ­¢åŽŸæœåŠ¡ 1pm2 delete $&#123;pm2_ID&#125; å¯åŠ¨æœåŠ¡ åˆ‡æ¢NODE_VERSION 1nvm use $&#123;node_version&#125; å¯åŠ¨æœåŠ¡ 1NODE_ENV=$&#123;env&#125; pm2 start $&#123;main_script&#125; æ£€æŸ¥æœåŠ¡è¿è¡Œæƒ…å†µ 12pm2 list #æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿è¡ŒæœåŠ¡pm2 logs $&#123;pm2_ID&#125; #æŸ¥çœ‹æŸæœåŠ¡çš„æ—¥å¿— 123456$&#123;project_path&#125;: ~/lss_core$&#123;tag_name&#125;: release-20160705-GATEWAY-40$&#123;pm2_ID&#125;: // Get by pm2 list$&#123;node_version&#125;: 0.10.44$&#123;env&#125;: prod // dev | test | uat | prod$&#123;main_script&#125;: lss-core.js 123npm install xxx â€”savepm2 logs 39pm2 list]]></content>
      <categories>
        <category>å‰ç«¯</category>
        <category>react</category>
      </categories>
      <tags>
        <tag>å‰ç«¯æŒ‡å—</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LinuxæŽ¢ç©¶-ç¡¬è¿žæŽ¥ä¸Žç¬¦å·è¿žæŽ¥]]></title>
    <url>%2F2017%2F12%2F20%2FLinux%E6%8E%A2%E7%A9%B6-%E7%A1%AC%E8%BF%9E%E6%8E%A5%E4%B8%8E%E7%AC%A6%E5%8F%B7%E8%BF%9E%E6%8E%A5%2F</url>
    <content type="text"><![CDATA[åˆ›å»ºç¡¬è¿žæŽ¥1234mkdit aa.txtvim aa.txtln aa.txt aa-hard æ³¨æ„æ— è®ºä¿®æ”¹aa.txt aa-hardä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œå†…å®¹éƒ½ä¼šåŒæ—¶å˜åŒ–ã€‚ åˆ é™¤å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªè¿˜ä¼šå­˜åœ¨ã€‚ 12345# æŸ¥çœ‹å½“å‰ç›®å½•çš„å­—èŠ‚æ•°du -sb# æŸ¥çœ‹iNodeä¼šæŒ‡å‘åŒä¸€ä¸ªls -i åˆ›å»ºç¬¦å·è¿žæŽ¥Symbolic1ln -s aa.txt aa-symbolic æ³¨æ„ç¬¦å·è¿žæŽ¥å¦‚æžœæŒ‡å‘ç›®å½•ï¼Œä¼šç›´æŽ¥å¯¹åŽŸç›®å½•çš„å†…å®¹æ“ä½œï¼Œå¢žåˆ æ”¹ï¼Œè¦å°å¿ƒã€‚ ###]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Tomcatè§£æƒ‘ ä¹‹ CATALINA_HOMEä¸ŽCATALINA_BASE]]></title>
    <url>%2F2017%2F12%2F19%2FTomcat%E8%A7%A3%E6%83%91-%E4%B9%8B-CATALINA-HOME%E4%B8%8ECATALINA-BASE%2F</url>
    <content type="text"><![CDATA[çœ‹Tomcatæºç ä¸€æ®µæ—¶é—´ä¸€ç›´å¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆæœ‰CATALINA_HOMEå’ŒCATALINA_BASEåŒºåˆ«ï¼š åˆ†CATALINA_HOMEå’ŒCATALINA_BASEæ¦‚å¿µæ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„åœºæ™¯ï¼š ä½ éœ€è¦åœ¨ä¸€å°æœºå™¨ä¸Šé¢éƒ¨ç½²å¤šä¸ªTomcatå®žä¾‹ï¼Œä½†æ˜¯ä½ åˆä¸æƒ³åˆ›å»ºå¤šä¸ªTomcatçš„å‰¯æœ¬ï¼Œæ¢å¥è¯è¯´å°±æ˜¯è®©è¿™äº›Tomcatå‰¯æœ¬æ‹¥æœ‰è‡ªå·±çš„å·¥ä½œç›®å½•ä½†æ˜¯å…±äº«Tomcatçš„ä»£ç ã€‚ å…³äºŽCATALINA_HOMEå’ŒCATALINA_BASEå®˜æ–¹æ–‡æ¡£ä¸Šé¢æ˜¯è¿™æ ·è§£é‡Šçš„ï¼š [html] view plain copy Throughout the docs, youâ€™ll notice there are numerous references to $CATALINA_HOME. This represents the root of your Tomcat installation. When we say, â€œThis information can be found in your $CATALINA_HOME/README.txt fileâ€ we mean to look at the README.txt file at the root of your Tomcat install. Optionally, Tomcat may be configured for multiple instances by defining $CATALINA_BASE for each instance. If multiple instances are not configured, $CATALINA_BASE is the same as $CATALINA_HOME. ç¿»è¯‘è¿‡æ¥å°±æ˜¯CATALINA_HOMEæ˜¯Tomcatçš„å®‰è£…ç›®å½•ï¼ŒCATALINA_BASEæ˜¯Tomcatçš„å·¥ä½œç›®å½• CATALINA_BASEæ˜¯å’Œæ¯ä¸ªTomcatå®žä¾‹ç›¸å…³çš„ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸€èµ·çŽ©ä¸€ä¸‹ä¸Šé¢æè¿°çš„é‚£ä¸ªåœºæ™¯ æè¿°:CATALINA_HOMEæ˜¯Tomcatçš„å®‰è£…ç›®å½•ï¼ŒCATALINA_BASEæ˜¯Tomcatçš„å·¥ä½œç›®å½•ä½œç”¨:é€šè¿‡å¤šå·¥ä½œç›®å½•(CATALINA_BASE),å•å®‰è£…ç›®å½•(CATALINA_HOME). å¯å®žçŽ°æ¯ä¸ªåº”ç”¨å…±ç”¨ä¸€ä¸ªtomcatä½†ä¸å…¥ä¾µå®‰è£…ç›®å½•,å¯ä»¥åˆ†åˆ«é…ç½®. å…ˆä¸‹ä¸€ä¸ªTomcatçš„zipå‘å¸ƒç‰ˆæœ¬å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½ï¼šhttp://archive.apache.org/dist/tomcat/tomcat-7/v7.0.69/bin/ è§£åŽ‹åˆ°Fç›˜ï¼Œç„¶åŽæ–°å»ºä¸¤ä¸ªç›®å½• åˆ†åˆ«ä¸ºtomcat ins1å’Œtomcat ins2 æŠŠTomcatçš„å…±äº«æ–‡ä»¶å¤¹åˆ†åˆ«æ‹·è´åˆ°tomcat ins1å’Œtomcat ins2ä¸­ï¼Œæœ‰ ç„¶åŽåœ¨ ç„¶åŽåœ¨tomcat ins1çš„æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºstartup.bat æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š [plain] view plain copy set â€œCATALINA_BASE=%cd%â€ set â€œCATALINA_HOME=F:\apache-tomcat-7.0.69â€ set â€œEXECUTABLE=%CATALINA_HOME%\bin\catalina.batâ€4.5. call â€œ%EXECUTABLE%â€ start ç„¶åŽæˆ‘ä»¬å¯ä»¥åœ¨tomcat ins1ä¸‹çš„confä¸­çš„server.xmlä¸­ä¿®æ”¹httpç«¯å£å·åˆ†åˆ«ä¸º7070 tomcat ins2çš„åšæ³•å’Œtomcat ins1ä¸€æ ·åªä¸è¿‡ç«¯å£å·æ”¹ä¸º9090 åˆ†åˆ«åŒå‡»startup.bat ç„¶åŽè®¿é—®Tomcatä½ ä¼šçœ‹åˆ°ï¼š]]></content>
      <categories>
        <category>tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç²¾ç»†åŒ–JVMåº”ç”¨æ€§èƒ½å‰–æžå·¥å…·]]></title>
    <url>%2F2017%2F12%2F19%2F%E7%B2%BE%E7%BB%86%E5%8C%96JVM%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E5%89%96%E6%9E%90%E5%B7%A5%E5%85%B7%2F</url>
    <content type="text"><![CDATA[ä½•ä¸ºç²¾ç»†åŒ–ï¼Ÿé•¿æœŸä»¥æ¥å„ä¸ªä¸šåŠ¡çº¿å¼€å‘é¥±å—æ€§èƒ½é—®é¢˜çš„å›°æ‰°ã€‚ ä»Žåé¦ˆå’Œè§‚å¯Ÿæ¥çœ‹ï¼Œæˆ‘ä»¬é¢ä¸´ä¸‹é¢ä¸€ç³»åˆ—çš„é—®é¢˜ï¼š ä¸æ¸…æ¥šåº”ç”¨çš„è¿è¡Œæƒ…å†µï¼ŒåŒ…æ‹¬ä½†ä¸é™äºŽGCæƒ…å†µã€çƒ­ç‚¹ä»£ç ã€çº¿ç¨‹ã€å¼‚å¸¸ï¼ˆç‰¹åˆ«æ˜¯è¢«åžæ²¡çš„å¼‚å¸¸ï¼‰ï¼› ä¸æ¸…æ¥šåº”ç”¨ä»£ç æ‰§è¡Œæƒ…å†µï¼Œç”šè‡³ä¸çŸ¥é“æŸä¸ªæ¨¡å—æ˜¯å¦è¿˜å¯èƒ½ä¼šè¿è¡Œï¼Œå°¤å…¶æ˜¯å¯¹äºŽæœ‰ç€ä¸€å®šåŽ†å²çš„åº”ç”¨ï¼Œå¯èƒ½å·²ç»æœ‰å¾ˆå¤šå¼€å‘åœ¨ä¸Šé¢è´¡çŒ®è¿‡ä»£ç ï¼Œä½†éšç€ä¸šåŠ¡å‘å±•è¿™äº›åŠŸèƒ½å¯èƒ½å·²ç»ä¸å†è¢«ä½¿ç”¨ï¼› ä¸æ¸…æ¥šåº”ç”¨çš„IOæƒ…å†µï¼Œæ³¨æ„ï¼Œè¿™é‡Œè¯´çš„ç»å¯¹ä¸ä»…ä»…æ˜¯zabbixä¸Šçš„â€ç£ç›˜IOâ€ï¼Œè€Œæ˜¯å…·ä½“åˆ°æŸä¸ªæ–‡ä»¶ã€æŸä¸ªç«¯å£ã€æŸä¸ªçº¿ç¨‹çš„IOæƒ…å†µï¼› è¿™äº›é—®é¢˜å¯¼è‡´çš„ç›´æŽ¥åŽæžœå°±æ˜¯ï¼šå¯¹äºŽæ€§èƒ½ä¼˜åŒ–ï¼Œæ— ä»Žä¸‹æ‰‹ï¼Œåªèƒ½å‡­ç»éªŒå’Œç›´è§‰åŽ»çŒœæµ‹ã€åŸ‹ç‚¹ã€ä¼˜åŒ–ï¼Œå½“ç„¶ï¼Œæœ€ç»ˆç»“æžœä¸€èˆ¬å°±æ˜¯â€œåŠ æœºå™¨æ‰©å®¹â€ã€‚ æ˜¯æ—¶å€™ç»“æŸè¿™ç§ç²—æ”¾é‡Žè›®çš„æ€§èƒ½åˆ†æžè°ƒä¼˜äº†ï¼ å€¼å¾—é«˜å…´çš„æ˜¯çŽ°åœ¨æ‰€æœ‰çš„JDK7ä»¥ä¸Šç‰ˆæœ¬å·²ç»å†…ç½®äº†ä¸€æ¬¾æ–°åž‹çš„æ€§èƒ½å‰–æžå·¥å…·ï¼Œä¹Ÿå°±æ˜¯ä»Šå¤©è¦é‡ç‚¹ä»‹ç»çš„ï¼Java Flight Recorderï¼Œç®€ç§°JFRã€‚ JFRç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼ŸJava Flight Recorderï¼ˆJFRï¼‰æœ¬æ¥æ˜¯ä¸€ä¸ªå•†ä¸šç‰¹æ€§ï¼Œç”¨åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸Šæ˜¯éœ€è¦å•†ä¸šè®¸å¯ï¼ˆè¿™å…¶å®žæ˜¯åºŸè¯ï¼Œå› ä¸ºçŽ°åœ¨ä¸éœ€è¦è®¸å¯ä¹Ÿå¯ä»¥ç›´æŽ¥ç”¨ï¼‰ã€‚ JFR è®°å½•äº†å…³äºŽ Java è¿è¡Œæ—¶åŠè¿è¡Œåœ¨å…¶å†…çš„ Java åº”ç”¨ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯ï¼Œè®°å½•ç”¨å°‘é‡çš„å¼€é”€å®Œæˆã€‚æ•°æ®æ˜¯ä½œä¸ºæ—¶é—´ä¸Šçš„æ•°æ®ç‚¹ï¼ˆç§°ä¸ºäº‹ä»¶ï¼‰è®°å½•çš„ã€‚å…¸åž‹çš„äº‹ä»¶å¯ä»¥æ˜¯çº¿ç¨‹ç­‰å¾…é”ã€GCã€CPU å‘¨æœŸä½¿ç”¨æ•°æ®ç­‰ã€‚ åœ¨åˆ›å»ºé£žè¡Œè®°å½•æ—¶ï¼Œä½ å¯ä»¥é€‰æ‹©å“ªäº›äº‹ä»¶åº”å½“ä¿å­˜ï¼Œè¿™å«åšè®°å½•æ¨¡æ¿ã€‚æœ‰äº›æ¨¡æ¿åªä¿å­˜åŸºæœ¬äº‹ä»¶ï¼Œå¯¹æ€§èƒ½å‡ ä¹Žæ²¡æœ‰å½±å“ã€‚å…¶ä»–æ¨¡æ¿å¯èƒ½æœ‰è½»å¾®çš„æ€§èƒ½å¼€é”€ï¼Œè¿˜å¯èƒ½è§¦å‘ GC æ¥æ”¶é›†æ›´å¤šä¿¡æ¯ã€‚é€šå¸¸ï¼Œè¶…è¿‡ç™¾åˆ†ä¹‹å‡ çš„å¼€é”€æ˜¯å¾ˆç½•è§ã€‚é£žè¡Œè®°å½•å¯ç”¨äºŽè°ƒè¯•å¾ˆå¤§èŒƒå›´çš„é—®é¢˜ï¼Œä»Žæ€§èƒ½é—®é¢˜åˆ°å†…å­˜æ³„æ¼æˆ–ä¸¥é‡çš„é”ç«žäº‰ã€‚ æ³¨æ„ï¼ŒJFRæ˜¯ä¸€ä¸ªæ€§èƒ½æ•°æ®é‡‡é›†å·¥å…·ï¼Œå®ƒæŠŠæœ€ç»ˆé‡‡é›†åˆ°çš„æ•°æ®å­˜åœ¨ä¸€ä¸ªæ ¼å¼ä¸ºjfrçš„æ–‡ä»¶ä¸­ï¼Œç”±äºŽæœ¬èº«å¹¶ä¸å…·å¤‡æ•°æ®åˆ†æžæˆ–è€…å¯è§†åŒ–åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬éœ€è¦é…åˆJDKå¦å¤–ä¸€ä¸ªå†…ç½®å·¥å…·ï¼Œå³JMCä¸€èµ·ä½¿ç”¨ã€‚ JMCåˆæ˜¯ä»€ä¹ˆï¼Ÿå®ƒæ˜¯åœ¨ JAVA 7u40 å‘å¸ƒä¸­åŠ å…¥çš„å›¾å½¢åŒ–æ€§èƒ½ç›‘æŽ§å·¥å…·ï¼Œå®ƒå¯ä»¥ç›´æŽ¥æ‰“å¼€ç”±jfrç”Ÿæˆçš„åŽŸå§‹æ•°æ®é‡‡é›†æ–‡ä»¶ï¼Œ è¯·åœ¨è‡ªå·±æœºå™¨çš„å‘½ä»¤è¡Œè¾“å…¥ jmc æ¥ä½“éªŒã€‚ ç›¸æ¯”å…¶å®ƒProfileå·¥å…·æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿåœ¨å¼€å‘çŽ¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ç”¨VisualVMã€JProfilerç­‰ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå›¾å½¢åŒ–ç•Œé¢æ“ä½œï¼Œå¯ä»¥å¾ˆå¿«å®šä½ä»£ç é—®é¢˜ã€‚ ä½†æ˜¯ä»–ä»¬å¯¹åº”ç”¨æ€§èƒ½çš„å½±å“ä¹Ÿéžå¸¸å¤§ï¼Œæ‰€ä»¥ä¸é€‚åˆåœ¨ç”Ÿäº§çŽ¯å¢ƒä¸‹ä½¿ç”¨ã€‚è¿˜æœ‰è¿™äº›è½¯ä»¶è¦attachåˆ°jvmè¿›ç¨‹ä¸Šï¼Œç”Ÿäº§çŽ¯å¢ƒä¸€èˆ¬ç½‘ç»œéš”ç¦»ï¼Œå¾ˆéš¾åšåˆ°ã€‚ åœ¨ç”Ÿäº§çŽ¯å¢ƒæˆ‘ä»¬æœ€å¸¸ç”¨çš„profilingå·¥å…·å°±æ˜¯java/binä¸‹çš„jstackï¼Œå¤šåšå‡ æ¬¡jstackï¼Œä¹Ÿç›¸å½“äºŽprofilingäº†ã€‚ jstackæ–¹ä¾¿æ˜“ç”¨ï¼Œä½†å¹¶ä¸æ˜¯ç‰¹åˆ«é€‚åˆæ¥åšprofilingï¼Œæ“ä½œé¢‘çŽ‡ä½Žï¼Œä¼šå¯¼è‡´safepointæŒ‡æ ‡æ€¥å‰§å¢žé•¿ç­‰ç­‰ã€‚ é‡ç‚¹æ¥äº†ï¼Œä½¿ç”¨jfrä¸éœ€è¦åœ¨çŽ°æœ‰åº”ç”¨ä¸Šé¢å¤–æ·»åŠ ä»»ä½•å‚æ•°ã€é‡å¯è¿›ç¨‹ç­‰ï¼Œç›´æŽ¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œå³å¯ï¼Œå®žæ—¶ç”Ÿæ•ˆï¼Œ100%æ— å…¥ä¾µï¼Œä¸”ç¨³å®šå¯é ï¼Œä¸å½±å“çº¿ä¸Šåº”ç”¨è¿è¡Œã€‚ å®‰å…¨æ€§å¦‚ä½•ï¼Ÿç”±äºŽè¿™ä¸ªå·¥å…·å¯ä»¥ç›´æŽ¥åœ¨çº¿ä¸Šä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒä¼šæœ‰å®‰å…¨æ€§é—®é¢˜å—ï¼Ÿä¼šé€ æˆå®¢æˆ·æ•°æ®æ³„éœ²å—ï¼Ÿ ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œå› ä¸ºjfré‡‡é›†çš„æ€§èƒ½æ•°æ®å…¶å®žå¯ä»¥çœ‹ä½œæ˜¯JVMæœ¬èº«çš„å…ƒæ•°æ®è€Œä¸æ˜¯ä¸šåŠ¡æ•°æ®ï¼Œå› æ­¤ä¸å­˜åœ¨ä»»ä½•å®‰å…¨æ€§é—®é¢˜ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚ ä½¿ç”¨æ–¹å¼çœ‹äº†ä»¥ä¸Šè¿™ä¹ˆå¤šç†ï¼ˆåºŸï¼‰è®ºï¼ˆè¯ï¼‰ç›¸ä¿¡å„ä½å·²ç»è·ƒè·ƒæ¬²è¯•ï¼Œé‚£ä¹ˆï¼ŒJFRè¯¥å¦‚ä½•ä½¿ç”¨ï¼Ÿå¾ˆç®€å•ï¼ŒæŒ‰ç…§ä¸‹é¢ä¸‰ä¸ªæ­¥éª¤æ“ä½œï¼› é€‰å®šä¸€å°æœºå™¨ï¼Œç™»é™†ä¸ŠåŽ»ï¼Œå¹¶æ‰¾åˆ°è¦ç›‘æŽ§çš„è¿›ç¨‹PID å°†é™„ä»¶æ–‡ä»¶(tongdun.jfc)æ”¾å…¥åˆ° /usr/install/java/jdk1.8.0_60/jre/lib/jfr ç›®å½•ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯åœ¨å®˜æ–¹é…ç½®ä¸Šå¢žåŠ äº†å¯¹å¼‚å¸¸æ•°æ®çš„é‡‡é›†ã€‚æŽ¨èä½¿ç”¨ã€‚ æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼Œå…¶ä¸­è¯·è‡ªè¡Œæ›¿æ¢ï¼š è¿™æ ·å°±å¥½äº†ï¼Œå¦‚ä¸Šï¼Œç­‰å¾…2åˆ†é’Ÿï¼‹20ç§’ï¼Œ/tmp/pid.jfræ–‡ä»¶å°±ç”Ÿæˆå¥½äº†ï¼Œè¿™ä¸ªæ–‡ä»¶ç›´æŽ¥å¯¼å…¥JMCå·¥å…·å³å¯ JMCä¿¡æ¯]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>jvm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[intelliJ è¿œç¨‹è°ƒè¯•]]></title>
    <url>%2F2017%2F12%2F18%2FintelliJ-%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95%2F</url>
    <content type="text"><![CDATA[æŸ¥çœ‹addressä¸º9996 1ps -ef | grep java | grep address 1admin 3052 1 19 19:02 ? 00:02:10 /usr/install/jdk1.8.0_60/bin/java -Djava.util.logging.config.file=/home/admin/billing/deploy/tomcat/conf/logging.properties -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager -server -Xms2g -Xmx2g -XX:PermSize=512m -XX:SurvivorRatio=2 -XX:+UseParallelOldGC -Dtrace.flag=true -Dtrace.output.dir=/home/admin/billing/deploy/trace/ -server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,address=9996,server=y,suspend=n -Djava.awt.headless=true -Djava.net.preferIPv4Stack=true -Dfile.encoding=UTF-8 -DdisableIntlRMIStatTask=true -Ddubbo.application.logger=slf4j -Djdk.tls.ephemeralDHKeySize=2048 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=10.57.19.253 -Djava.endorsed.dirs=/usr/install/tomcat/endorsed -classpath /usr/install/tomcat/bin/bootstrap.jar:/usr/install/tomcat/bin/tomcat-juli.jar -Dcatalina.base=/home/admin/billing/deploy/tomcat -Dcatalina.home=/usr/install/tomcat -Djava.io.tmpdir=/home/admin/billing/deploy/tomcat/temp org.apache.catalina.startup.Bootstrap start æŸ¥çœ‹å½“å‰è¿›ç¨‹è¿œç¨‹æˆåŠŸ 1netstat -an | grep 9996 1tcp 0 0 10.57.19.253:9996 10.57.241.56:62655 ESTABLISHED]]></content>
      <categories>
        <category>çº¿ä¸Šæ•…éšœæŽ’æŸ¥</category>
      </categories>
      <tags>
        <tag>debug</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>%2F2017%2F12%2F13%2Fvi-vim%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C%2F</url>
    <content type="text"><![CDATA[viçŠ¶æ€æ‰§è¡Œå‘½ä»¤1:! echo $JAVA_HOME å…‰æ ‡ç§»åŠ¨å•è¯ç§»åŠ¨å‘åŽç§»åŠ¨å•è¯1w å‘å‰ç§»åŠ¨å•è¯1b ç§»åŠ¨åˆ°è¡Œé¦–10 ç§»åŠ¨åˆ°è¡Œå°¾ 1$ åˆ é™¤å•è¡Œåˆ é™¤ åˆ è‡³è¡Œé¦–1d0 åˆ è‡³è¡Œå°¾1d$ åˆ é™¤å½“å‰è¡Œ 1dd å¤šè¡Œåˆ é™¤ ndd åˆ é™¤ä»¥å½“å‰è¡Œå¼€å§‹çš„nè¡Œ 13dd å¤šè¡Œåˆ é™¤ï¼Œåˆ é™¤1åˆ°10è¡Œ 1: 1,10d ä»Žå½“å‰è¡Œåˆ é™¤åˆ°å€’æ•°æœ€åŽä¸€è¡Œ 1: .,$-1d ä»ŽæŸè¡Œå¼€å§‹è‡³æ–‡æœ¬æœ«å°¾å…¨éƒ¨åˆ é™¤ï¼Œåˆ é™¤ç¬¬8è¡Œè‡³æœ«å°¾ 1: 8ï¼Œ$d åˆ é™¤å…¨éƒ¨ 1ä»£è¡¨å¼€å§‹ç¬¬ä¸€è¡Œï¼Œ$æ ‡è¯†ç»“æŸè¡Œï¼Œdåˆ é™¤å‘½ä»¤ 1: 1,$d æŸ¥æ‰¾ä½ç½® è·³åˆ°é¦–è¡Œ 1gg è·³åˆ°å°¾ä¸€è¡Œ 1GG è·³è½¬åˆ°æ–‡æœ¬çš„ç¬¬12è¡Œ 1212gg / 12G:12 æŸ¥æ‰¾ å‘ä¸‹æŸ¥æ‰¾ 1/text å‘ä¸ŠæŸ¥æ‰¾ 1?text né‡å¤ä¸Šä¸€æ¬¡çš„æŸ¥æ‰¾å‘½ä»¤ shift n åå‘é‡å¤ä¸Šä¸€æ¬¡çš„æŸ¥æ‰¾å‘½ä»¤ æ–‡æœ¬ä¸­æƒ³æŸ¥çœ‹å½“å‰è¡Œä¿¡æ¯ï¼Œå¯è¾“å…¥ï¼š ctrl + g]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>vi</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[guavaé›†åˆapiå­¦ä¹ ]]></title>
    <url>%2F2017%2F11%2F30%2Fguava%E9%9B%86%E5%90%88api%E5%AD%A6%E4%B9%A0%2F</url>
    <content type="text"><![CDATA[1ï¼Œå¤§çº² è®©æˆ‘ä»¬æ¥ç†Ÿæ‚‰ç“œå¨ƒï¼Œå¹¶ä½“éªŒä¸‹å®ƒçš„ä¸€äº›API,åˆ†æˆå¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š Introduction Guava Collection API Guava Basic Utilities IO API Cache API 2ï¼Œä¸ºç¥žé©¬é€‰æ‹©ç“œå¨ƒï¼Ÿ ç“œå¨ƒæ˜¯java APIè›‹ç³•ä¸Šçš„å†°æ¿€å‡Œï¼ˆç²¾åŽï¼‰ é«˜æ•ˆè®¾è®¡è‰¯å¥½çš„API. è¢«googleçš„å¼€å‘è€…è®¾è®¡ï¼Œå®žçŽ°å’Œä½¿ç”¨ã€‚ éµå¾ªé«˜æ•ˆçš„javaè¿™æœ¬ä¹¦çš„å¥½çš„è¯­æ³•å®žè·µã€‚ ä½¿ä»£ç æ›´åˆ»åº¦ï¼Œç®€æ´ï¼Œç®€å•ã€‚ ä½¿ç”¨java 1.5çš„ç‰¹æ€§ï¼Œ æµè¡Œçš„APIï¼ŒåŠ¨æ€çš„å¼€å‘ å®ƒæä¾›äº†å¤§é‡ç›¸å…³çš„åº”ç”¨ç±»ï¼Œé›†åˆï¼Œå¤šçº¿ç¨‹ï¼Œæ¯”è¾ƒï¼Œå­—ç¬¦ä¸²ï¼Œè¾“å…¥è¾“å‡ºï¼Œç¼“å­˜ï¼Œç½‘ç»œï¼ŒåŽŸç”Ÿç±»åž‹ï¼Œæ•°å­¦ï¼Œåå°„ç­‰ç­‰ ç™¾åˆ†ç™¾çš„å•å…ƒæµ‹è¯•ï¼Œè¢«å¾ˆå¤šçš„é¡¹ç›®ä½¿ç”¨ï¼Œå¸®åŠ©å¼€å‘è€…ä¸“æ³¨ä¸šåŠ¡é€»è¾‘è€Œä¸æ˜¯å†™javaåº”ç”¨ç±» èŠ‚çœæ—¶é—´ï¼Œèµ„æºï¼Œæé«˜ç”Ÿäº§åŠ› æˆ‘çš„ç›®çš„æ˜¯ä¸ºåŸºæœ¬çš„javaç‰¹å¾æä¾›å¼€æºä»£ç çš„æ”¯æŒï¼Œè€Œä¸æ˜¯è‡ªå·±å†å†™ä¸€ä¸ª Apache Commonåº“-Apacheæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æˆç†Ÿçš„åº“ï¼Œä½†æ˜¯ä¸æ”¯æŒæ³›åž‹ï¼ŒApacheå¯¹æ—©èµ·çš„javaç‰ˆæœ¬å¾ˆæœ‰ç”¨ï¼Œï¼ˆ1.5ä¹‹å‰çš„ï¼‰ java7ï¼Œjava8 æœ€æ–°çš„javaæ”¯æŒä¸€äº›guavaçš„API guavaæœ€æ–°çš„æ­£å¼ç‰ˆæœ¬æ˜¯14.0-rc2ï¼Œè¿™ä¸ªç‰ˆæœ¬éœ€è¦java1.6æ”¯æŒ. æœ€æ–°çš„mavenåæ ‡æ˜¯ï¼š com.google.guavaguava14.0-rc2 3,é›†åˆAPIçš„ä½¿ç”¨ 3.1ç®€åŒ–å·¥ä½œ å¯ä»¥ç®€åŒ–é›†åˆçš„åˆ›å»ºå’Œåˆå§‹åŒ–ï¼› ç±»åˆ« åŽŸæ¥çš„å†™æ³• guavaçš„å†™æ³• é›†åˆåˆ›å»º Map]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>guava</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[zookeeperè¯¦è§£]]></title>
    <url>%2F2017%2F11%2F26%2Fzookeeper%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[start123bin/zkServer.sh start$ bin/zkCli.sh -server 127.0.0.1:2181 zk client æ“ä½œstat path [watch] set path data [version] ls path [watch] delquota [-n|-b] path ls2 path [watch] setAcl path acl setquota -n|-b val path history redo cmdno printwatches on|off delete path [version] sync path listquota path rmr path get path [watch] create [-s] [-e] path data acl addauth scheme auth quit getAcl path close connect host:port ä¼ªé›†ç¾¤æ­å»ºå‚è€ƒï¼šhttp://zookeeper.apache.org/doc/trunk/zookeeperStarted.html é›†ç¾¤é…ç½®ï¼š 1ã€é…ç½®æ–‡ä»¶conf/zoo.cfgï¼Œé™¤äº†å•æœºæ¨¡å¼çš„é…ç½®ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ–°åŠ server.xä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ 12345678tickTime=2000dataDir=D:\09tmp\zookeeper\dataclientPort=2181initLimit=5syncLimit=2server.1=zoo1:2888:3888server.2=zoo2:2888:3888server.3=zoo3:2888:3888 â€‹ zooxè¡¨ç¤ºçš„æ˜¯zookeeperæœåŠ¡å™¨çš„IPåœ°å€ï¼Œç¬¬ä¸€ä¸ªç«¯å£2888ï¼šåœ¨zookeeperæœåŠ¡å™¨ä¹‹é—´åŠå’Œleaderè¿žæŽ¥æ—¶ä½¿ç”¨ï¼Œç¬¬äºŒä¸ªç«¯å£å·ï¼š3888æ˜¯åœ¨è¿›è¡Œleaderé€‰ä¸¾æ—¶ä½¿ç”¨ã€‚ 2ã€åŒæ—¶éœ€è¦åœ¨é…ç½®é¡¹dataDiræ‰€æŒ‡ç¤ºç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶myidæ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸ºè¯¥1ä¸­server.xä¸­çš„xï¼Œè¡¨ç¤ºè¯¥zookeeperæœåŠ¡å™¨çš„ç¼–å·ã€‚ 3ã€ä¸ºäº†é™ä½Žæ›´æ–°çš„å»¶è¿Ÿï¼Œéœ€è¦ä¸ºäº‹ç‰©æ—¥å¿—çš„å­˜æ”¾ä¸“é—¨æŒ‡å®šå­˜å‚¨è·¯å¾„ï¼Œè¯¥é…ç½®é¡¹ä¸ºï¼šdataLogDir 12345678910111213# The number of milliseconds of each ticktickTime=2000# The number of ticks that the initial# synchronization phase can takeinitLimit=10# The number of ticks that can pass between# sending a request and getting an acknowledgementsyncLimit=5# the directory where the snapshot is stored.# do not use /tmp for storage, /tmp here is just# example sakes.dataDir=D:\\09tmp\\zookeeper\\datadataLogDir=D:\\09tmp\\zookeeper\\log ä¼ªé›†ç¾¤é…ç½®ï¼š 1ã€ç”±äºŽæ‰€æœ‰zookeeperæœåŠ¡å™¨éƒ½åœ¨ä¸€å°ç‰©ç†æœºå™¨ä¸Šï¼Œå› æ­¤zoo1.cfgä¸­é…ç½®é¡¹server.xçš„ç«¯å£ä¿¡æ¯ï¼Œä¸èƒ½ç›¸åŒã€‚ä¸”é…ç½®é¡¹dataDirå’ŒdataLogDirä¹Ÿéœ€è¦ä¸ºä¼ªæœåŠ¡å™¨å•ç‹¬æŒ‡å®šã€‚é…ç½®é¡¹clientPortåœ¨ä¸‰ä¸ªæœåŠ¡å™¨ä¸­ä¹Ÿè¦é…ç½®ä¸åŒçš„å€¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š 123456789tickTime=2000dataDir=D:\09tmp\zookeeper\data\\1dataLogDir=D:\09tmp\zookeeper\log\\1clientPort=2181initLimit=5syncLimit=2server.1=localhost:2888:3888server.2=localhost:2889:3889server.3=localhost:2890:3890 2ã€åŒæ—¶éœ€è¦å‡†å¤‡zoo2.cfgå’Œzoo3.cfgé…ç½®æ–‡ä»¶ï¼Œå‚è€ƒ1è¿›è¡Œé…ç½® 3ã€åœ¨D:\09tmp\zookeeper\data\1ã€D:\09tmp\zookeeper\data\2å’ŒD:\09tmp\zookeeper\data\3ä¸­åˆ†åˆ«åˆ›å»ºæ–‡ä»¶myidï¼Œé‡Œé¢å¡«å†™å¯¹åº”çš„zookeeperæœåŠ¡å™¨ç¼–å·ã€‚ 4ã€åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶ï¼šzkEnv1.cmdã€zkEnv2.cmdå’ŒzkEnv3.cmdåˆ†åˆ«ç”¨æ¥æŒ‡å®šä½¿ç”¨ä¸åŒçš„zoo.cfgã€‚ 5ã€åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶ï¼šzkServer1.cmdã€zkServer2.cmdå’ŒzkServer3.cmdåˆ†åˆ«ç”¨æ¥æŒ‡å®šä¸åŒçš„æ–‡ä»¶zkEnv.cmdã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mockitoæµ…è°ˆ]]></title>
    <url>%2F2017%2F11%2F25%2FMockito%E6%B5%85%E8%B0%88%2F</url>
    <content type="text"><![CDATA[Mockitoç®€ä»‹ ä»€ä¹ˆæ˜¯mockï¼Ÿåœ¨è½¯ä»¶å¼€å‘çš„ä¸–ç•Œä¹‹å¤–, â€œmockâ€ä¸€è¯æ˜¯æŒ‡æ¨¡ä»¿æˆ–è€…æ•ˆä»¿ã€‚ å› æ­¤å¯ä»¥å°†â€œmockâ€ç†è§£ä¸ºä¸€ä¸ªæ›¿èº«ï¼Œæ›¿ä»£è€…. åœ¨è½¯ä»¶å¼€å‘ä¸­æåŠâ€mockâ€ï¼Œé€šå¸¸ç†è§£ä¸ºæ¨¡æ‹Ÿå¯¹è±¡æˆ–è€…Fakeã€‚ ä¸ºä»€ä¹ˆéœ€è¦Mock?Mockæ˜¯ä¸ºäº†è§£å†³unitsä¹‹é—´ç”±äºŽè€¦åˆè€Œéš¾äºŽè¢«æµ‹è¯•çš„é—®é¢˜ã€‚æ‰€ä»¥mock objectæ˜¯unit testçš„ä¸€éƒ¨åˆ†ã€‚ Mockçš„å¥½å¤„æ˜¯ä»€ä¹ˆ? æå‰åˆ›å»ºæµ‹è¯•ï¼ŒTDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰ è¿™æ˜¯ä¸ªæœ€å¤§çš„å¥½å¤„å§ã€‚å¦‚æžœä½ åˆ›å»ºäº†ä¸€ä¸ªMocké‚£ä¹ˆä½ å°±å¯ä»¥åœ¨serviceæŽ¥å£åˆ›å»ºä¹‹å‰å†™Service Testsäº†ï¼Œè¿™æ ·ä½ å°±èƒ½åœ¨å¼€å‘è¿‡ç¨‹ä¸­æŠŠæµ‹è¯•æ·»åŠ åˆ°ä½ çš„è‡ªåŠ¨åŒ–æµ‹è¯•çŽ¯å¢ƒä¸­äº†ã€‚æ¢å¥è¯è¯´ï¼Œæ¨¡æ‹Ÿä½¿ä½ èƒ½å¤Ÿä½¿ç”¨æµ‹è¯•é©±åŠ¨å¼€å‘ã€‚ å›¢é˜Ÿå¯ä»¥å¹¶è¡Œå·¥ä½œ è¿™ç±»ä¼¼äºŽä¸Šé¢çš„é‚£ç‚¹ï¼›ä¸ºä¸å­˜åœ¨çš„ä»£ç åˆ›å»ºæµ‹è¯•ã€‚ä½†å‰é¢è®²çš„æ˜¯å¼€å‘äººå‘˜ç¼–å†™æµ‹è¯•ç¨‹åºï¼Œè¿™é‡Œè¯´çš„æ˜¯æµ‹è¯•å›¢é˜Ÿæ¥åˆ›å»ºã€‚å½“è¿˜æ²¡æœ‰ä»»ä½•ä¸œè¥¿è¦æµ‹çš„æ—¶å€™æµ‹è¯•å›¢é˜Ÿå¦‚ä½•æ¥åˆ›å»ºæµ‹è¯•å‘¢ï¼Ÿæ¨¡æ‹Ÿå¹¶é’ˆå¯¹æ¨¡æ‹Ÿæµ‹è¯•ï¼è¿™æ„å‘³ç€å½“serviceå€Ÿå£éœ€è¦æµ‹è¯•æ—¶ï¼Œå®žé™…ä¸ŠQAå›¢é˜Ÿå·²ç»æœ‰äº†ä¸€å¥—å®Œæ•´çš„æµ‹è¯•ç»„ä»¶ï¼›æ²¡æœ‰å‡ºçŽ°ä¸€ä¸ªå›¢é˜Ÿç­‰å¾…å¦ä¸€ä¸ªå›¢é˜Ÿå®Œæˆçš„æƒ…å†µã€‚è¿™ä½¿å¾—æ¨¡æ‹Ÿçš„æ•ˆç›Šåž‹å°¤ä¸ºçªå‡ºäº†ã€‚ ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªéªŒè¯æˆ–è€…æ¼”ç¤ºç¨‹åºã€‚ ç”±äºŽMockséžå¸¸é«˜æ•ˆï¼ŒMockså¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ¦‚å¿µè¯æ˜Žï¼Œä½œä¸ºä¸€ä¸ªç¤ºæ„å›¾ï¼Œæˆ–è€…ä½œä¸ºä¸€ä¸ªä½ æ­£è€ƒè™‘æž„å»ºé¡¹ç›®çš„æ¼”ç¤ºç¨‹åºã€‚è¿™ä¸ºä½ å†³å®šé¡¹ç›®æŽ¥ä¸‹æ¥æ˜¯å¦è¦è¿›è¡Œæä¾›äº†æœ‰åŠ›çš„åŸºç¡€ï¼Œä½†æœ€é‡è¦çš„è¿˜æ˜¯æä¾›äº†å®žé™…çš„è®¾è®¡å†³ç­–ã€‚ ä¸ºæ— æ³•è®¿é—®çš„èµ„æºç¼–å†™æµ‹è¯• è¿™ä¸ªå¥½å¤„ä¸å±žäºŽå®žé™…æ•ˆç›Šçš„ä¸€ç§ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªå¿…è¦æ—¶çš„â€œæ•‘ç”Ÿåœˆâ€ã€‚æœ‰æ²¡æœ‰é‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Ÿå½“ä½ æƒ³è¦æµ‹è¯•ä¸€ä¸ªserviceæŽ¥å£ï¼Œä½†serviceéœ€è¦ç»è¿‡é˜²ç«å¢™è®¿é—®ï¼Œé˜²ç«å¢™ä¸èƒ½ä¸ºä½ æ‰“å¼€æˆ–è€…ä½ éœ€è¦è®¤è¯æ‰èƒ½è®¿é—®ã€‚é‡åˆ°è¿™æ ·æƒ…å†µæ—¶ï¼Œä½ å¯ä»¥åœ¨ä½ èƒ½è®¿é—®çš„åœ°æ–¹ä½¿ç”¨MockServiceæ›¿ä»£ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªâ€œæ•‘ç”Ÿåœˆâ€åŠŸèƒ½ã€‚ Mock å¯ä»¥äº¤ç»™ç”¨æˆ· åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼ŒæŸç§åŽŸå› ä½ éœ€è¦å…è®¸ä¸€äº›å¤–éƒ¨æ¥æºè®¿é—®ä½ çš„æµ‹è¯•ç³»ç»Ÿï¼Œåƒåˆä½œä¼™ä¼´æˆ–è€…å®¢æˆ·ã€‚è¿™äº›åŽŸå› å¯¼è‡´åˆ«äººä¹Ÿå¯ä»¥è®¿é—®ä½ çš„æ•æ„Ÿä¿¡æ¯ï¼Œè€Œä½ æˆ–è®¸åªæ˜¯æƒ³å…è®¸è®¿é—®éƒ¨åˆ†æµ‹è¯•çŽ¯å¢ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚ä½•å‘åˆä½œä¼™ä¼´æˆ–è€…å®¢æˆ·æä¾›ä¸€ä¸ªæµ‹è¯•ç³»ç»Ÿæ¥å¼€å‘æˆ–è€…åšæµ‹è¯•å‘¢ï¼Ÿæœ€ç®€å•çš„å°±æ˜¯æä¾›ä¸€ä¸ªmockï¼Œæ— è®ºæ˜¯æ¥è‡ªäºŽä½ çš„ç½‘ç»œæˆ–è€…å®¢æˆ·çš„ç½‘ç»œã€‚soapUI mockéžå¸¸å®¹æ˜“é…ç½®ï¼Œä»–å¯ä»¥è¿è¡Œåœ¨soapUIæˆ–è€…ä½œä¸ºä¸€ä¸ªwaråŒ…å‘å¸ƒåˆ°ä½ çš„javaæœåŠ¡å™¨é‡Œé¢ã€‚ éš”ç¦»ç³»ç»Ÿ æœ‰æ—¶ï¼Œä½ å¸Œæœ›åœ¨æ²¡æœ‰ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†çš„å½±å“ä¸‹æµ‹è¯•ç³»ç»Ÿå•ç‹¬çš„ä¸€éƒ¨åˆ†ã€‚ç”±äºŽå…¶ä»–ç³»ç»Ÿéƒ¨åˆ†ä¼šç»™æµ‹è¯•æ•°æ®é€ æˆå¹²æ‰°ï¼Œå½±å“æ ¹æ®æ•°æ®æ”¶é›†å¾—åˆ°çš„æµ‹è¯•ç»“è®ºã€‚ä½¿ç”¨mockä½ å¯ä»¥ç§»é™¤æŽ‰é™¤äº†éœ€è¦æµ‹è¯•éƒ¨åˆ†çš„ç³»ç»Ÿä¾èµ–çš„æ¨¡æ‹Ÿã€‚å½“éš”ç¦»è¿™äº›mocksåŽï¼Œmockså°±å˜å¾—éžå¸¸ç®€å•å¯é ï¼Œå¿«é€Ÿå¯é¢„è§ã€‚è¿™ä¸ºä½ æä¾›äº†ä¸€ä¸ªç§»é™¤äº†éšæœºè¡Œä¸ºï¼Œæœ‰é‡å¤æ¨¡å¼å¹¶ä¸”å¯ä»¥ç›‘æŽ§ç‰¹æ®Šç³»ç»Ÿçš„æµ‹è¯•çŽ¯å¢ƒã€‚ Mockitoä½¿ç”¨ç¤ºä¾‹æ¨¡æ‹Ÿå¯¹è±¡1234// æ¨¡æ‹ŸLinkedList çš„ä¸€ä¸ªå¯¹è±¡LinkedList mockedList = mock(LinkedList.class);// æ­¤æ—¶è°ƒç”¨getæ–¹æ³•ï¼Œä¼šè¿”å›žnullï¼Œå› ä¸ºè¿˜æ²¡æœ‰å¯¹æ–¹æ³•è°ƒç”¨çš„è¿”å›žå€¼åšæ¨¡æ‹ŸSystem.out.println(mockedList.get(0)); æ¨¡æ‹Ÿæ–¹æ³•è°ƒç”¨çš„è¿”å›žå€¼1234// æ¨¡æ‹ŸèŽ·å–ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¿”å›žå­—ç¬¦ä¸²firstã€‚ ç»™ç‰¹å®šçš„æ–¹æ³•è°ƒç”¨è¿”å›žå›ºå®šå€¼åœ¨å®˜æ–¹è¯´æ³•ä¸­ç§°ä¸ºstubã€‚when(mockedList.get(0)).thenReturn("first");// æ­¤æ—¶æ‰“å°è¾“å‡ºfirstSystem.out.println(mockedList.get(0)); æ¨¡æ‹Ÿæ–¹æ³•è°ƒç”¨æŠ›å‡ºå¼‚å¸¸1234// æ¨¡æ‹ŸèŽ·å–ç¬¬äºŒä¸ªå…ƒç´ æ—¶ï¼ŒæŠ›å‡ºRuntimeExceptionwhen(mockedList.get(1)).thenThrow(new RuntimeException());// æ­¤æ—¶å°†ä¼šæŠ›å‡ºRuntimeExceptionSystem.out.println(mockedList.get(1)); å¦‚æžœä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›žå€¼ç±»åž‹ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æ¨¡æ‹Ÿå¼‚å¸¸æŠ›å‡º 12doThrow(new RuntimeException("clear exception")).when(mockedList).clear();mockedList.clear(); æ¨¡æ‹Ÿè°ƒç”¨æ–¹æ³•æ—¶çš„å‚æ•°åŒ¹é…1234// anyInt()åŒ¹é…ä»»ä½•intå‚æ•°ï¼Œè¿™æ„å‘³ç€å‚æ•°ä¸ºä»»æ„å€¼ï¼Œå…¶è¿”å›žå€¼å‡æ˜¯elementwhen(mockedList.get(anyInt())).thenReturn("element");// æ­¤æ—¶æ‰“å°æ˜¯elementSystem.out.println(mockedList.get(999)); æ¨¡æ‹Ÿæ–¹æ³•è°ƒç”¨æ¬¡æ•°12345// è°ƒç”¨addä¸€æ¬¡mockedList.add("once");// ä¸‹é¢ä¸¤ä¸ªå†™æ³•éªŒè¯æ•ˆæžœä¸€æ ·ï¼Œå‡éªŒè¯addæ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨äº†ä¸€æ¬¡verify(mockedList).add("once");verify(mockedList, times(1)).add("once"); æ ¡éªŒè¡Œä¸º12345678// mock creationList mockedList = mock(List.class);// using mock objectmockedList.add("one");mockedList.clear();//verificationverify(mockedList).add("one");verify(mockedList).clear(); æ¨¡æ‹Ÿæ–¹æ³•è°ƒç”¨(Stubbing)12345678910111213//You can mock concrete classes, not just interfacesLinkedList mockedList = mock(LinkedList.class);//stubbingwhen(mockedList.get(0)).thenReturn("first");when(mockedList.get(1)).thenThrow(new RuntimeException());//following prints "first"System.out.println(mockedList.get(0));//following throws runtime exceptionSystem.out.println(mockedList.get(1));//following prints "null" because get(999) was not stubbedSystem.out.println(mockedList.get(999));verify(mockedList).get(0); å‚æ•°åŒ¹é…12345678910//stubbing using built-in anyInt() argument matcherwhen(mockedList.get(anyInt())).thenReturn("element");//stubbing using custom matcher (let's say isValid() returns your own matcher implementation):when(mockedList.contains(argThat(isValid()))).thenReturn("element");//following prints "element"System.out.println(mockedList.get(999));//you can also verify using an argument matcherverify(mockedList).get(anyInt());//argument matchers can also be written as Java 8 Lambdasverify(mockedList).add(someString -&gt; someString.length() &gt; 5); æ ¡éªŒæ–¹æ³•è°ƒç”¨æ¬¡æ•°123456789101112131415161718192021//using mockmockedList.add("once");mockedList.add("twice");mockedList.add("twice");mockedList.add("three times");mockedList.add("three times");mockedList.add("three times");//following two verifications work exactly the same - times(1) is used by defaultverify(mockedList).add("once");verify(mockedList, times(1)).add("once");//exact number of invocations verificationverify(mockedList, times(2)).add("twice");verify(mockedList, times(3)).add("three times");//verification using never(). never() is an alias to times(0)verify(mockedList, never()).add("never happened");//verification using atLeast()/atMost()verify(mockedList, atLeastOnce()).add("three times");verify(mockedList, atLeast(2)).add("five times");verify(mockedList, atMost(5)).add("three times"); æ¨¡æ‹Ÿæ— è¿”å›žæ–¹æ³•æŠ›å‡ºå¼‚å¸¸123doThrow(new RuntimeException()).when(mockedList).clear();//following throws RuntimeException:mockedList.clear(); æ ¡éªŒæ–¹æ³•è°ƒç”¨é¡ºåº1234567891011121314151617181920212223// A. Single mock whose methods must be invoked in a particular orderList singleMock = mock(List.class);//using a single mocksingleMock.add("was added first");singleMock.add("was added second");//create an inOrder verifier for a single mockInOrder inOrder = inOrder(singleMock);//following will make sure that add is first called with "was added first, then with "was added second"inOrder.verify(singleMock).add("was added first");inOrder.verify(singleMock).add("was added second");// B. Multiple mocks that must be used in a particular orderList firstMock = mock(List.class);List secondMock = mock(List.class);//using mocksfirstMock.add("was called first");secondMock.add("was called second");//create inOrder object passing any mocks that need to be verified in orderInOrder inOrder = inOrder(firstMock, secondMock);//following will make sure that firstMock was called before secondMockinOrder.verify(firstMock).add("was called first");inOrder.verify(secondMock).add("was called second");// Oh, and A + B can be mixed together at will æ ¡éªŒæ–¹æ³•æ˜¯å¦ä»Žæœªè°ƒç”¨12345678//using mocks - only mockOne is interactedmockOne.add("one");//ordinary verificationverify(mockOne).add("one");//verify that method was never called on a mockverify(mockOne, never()).add("two");//verify that other mocks were not interactedverifyZeroInteractions(mockTwo, mockThree); å¿«é€Ÿåˆ›å»ºMockå¯¹è±¡123456789public class ArticleManagerTest &#123; @Mock private ArticleCalculator calculator; @Mock private ArticleDatabase database; @Mock private UserProvider userProvider; @Before public void before()&#123; MockitoAnnotations.initMocks(this); &#125;&#125; è‡ªå®šä¹‰è¿”å›žä¸åŒç»“æžœ123456789when(mock.someMethod("some arg")) .thenThrow(new RuntimeException()) // ç¬¬ä¸€æ¬¡ä¼šæŠ›å‡ºå¼‚å¸¸ .thenReturn("foo"); // ç¬¬äºŒæ¬¡ä¼šè¿”å›žè¿™ä¸ªç»“æžœ//First call: throws runtime exception:mock.someMethod("some arg"); // ç¬¬ä¸€æ¬¡//Second call: prints "foo"System.out.println(mock.someMethod("some arg")); // ç¬¬äºŒæ¬¡//Any consecutive call: prints "foo" as well (last stubbing wins).System.out.println(mock.someMethod("some arg")); // ç¬¬næ¬¡(n&gt; 2)ï¼Œä¾æ—§ä»¥æœ€åŽè¿”å›žæœ€åŽä¸€ä¸ªé…ç½® å¯¹è¿”å›žç»“æžœè¿›è¡Œæ‹¦æˆª123456789when(mock.someMethod(anyString())).thenAnswer(new Answer() &#123; Object answer(InvocationOnMock invocation) &#123; Object[] args = invocation.getArguments(); Object mock = invocation.getMock(); return "called with arguments: " + args; &#125;&#125;);//the following prints "called with arguments: foo"System.out.println(mock.someMethod("foo")); Mockå‡½æ•°æ“ä½œå¯ä»¥é€šè¿‡doThrow(), doAnswer(), doNothing(), doReturn() and doCallRealMethod() æ¥è‡ªå®šä¹‰å‡½æ•°æ“ä½œã€‚ æš—ä¸­è°ƒç”¨çœŸå®žå¯¹è±¡1234567891011121314List list = new LinkedList();List spy = spy(list);//optionally, you can stub out some methods:when(spy.size()).thenReturn(100);//using the spy calls *real* methodsspy.add("one");spy.add("two");//prints "one" - the first element of a listSystem.out.println(spy.get(0));//size() method was stubbed - 100 is printedSystem.out.println(spy.size());//optionally, you can verifyverify(spy).add("one"); verify(spy).add("two"); æ”¹å˜é»˜è®¤è¿”å›žå€¼12Foo mock = mock(Foo.class, Mockito.RETURNS_SMART_NULLS);Foo mockTwo = mock(Foo.class, new YourOwnAnswer()); æ•èŽ·å‡½æ•°çš„å‚æ•°å€¼123ArgumentCaptor&lt;Person&gt; argument = ArgumentCaptor.forClass(Person.class);verify(mock).doSomething(argument.capture());assertEquals("John", argument.getValue().getName()); éƒ¨åˆ†Mock1234567//you can create partial mock with spy() method:List list = spy(new LinkedList());//you can enable partial mock capabilities selectively on mocks:Foo mock = mock(Foo.class);//Be sure the real implementation is 'safe'.//If real implementation throws exceptions or depends on specific state of the object then you're in trouble.when(mock.someMethod()).thenCallRealMethod(); é‡ç½®Mock12345List mock = mock(List.class);when(mock.size()).thenReturn(10);mock.add(1);reset(mock);//at this point the mock forgot any interactions &amp; stubbing åºåˆ—åŒ–12345List&lt;Object&gt; list = new ArrayList&lt;Object&gt;();List&lt;Object&gt; spy = mock(ArrayList.class, withSettings() .spiedInstance(list) .defaultAnswer(CALLS_REAL_METHODS) .serializable()); æ£€æŸ¥è¶…æ—¶1234567891011//passes when someMethod() is called within given time spanverify(mock, timeout(100)).someMethod();//above is an alias to:verify(mock, timeout(100).times(1)).someMethod();//passes when som`eMethod() is called *exactly* 2 times within given time spanverify(mock, timeout(100).times(2)).someMethod();//passes when someMethod() is called *at least* 2 times within given time spanverify(mock, timeout(100).atLeast(2)).someMethod();//verifies someMethod() within given time span using given verification mode//useful only if you have your own custom verification modes.verify(mock, new Timeout(100, yourOwnVerificationMode)).someMethod(); Mockè¯¦æƒ…12Mockito.mockingDetails(someObject).isMock();Mockito.mockingDetails(someObject).isSpy();]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>test</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mysql group_cat]]></title>
    <url>%2F2017%2F11%2F16%2Fmysql-group-cat%2F</url>
    <content type="text"><![CDATA[group_concat()å‡½æ•°çš„å‚æ•°æ˜¯å¯ä»¥ç›´æŽ¥ä½¿ç”¨order byæŽ’åºçš„ã€‚666ã€‚ã€‚ä¸‹é¢é€šè¿‡ä¾‹å­æ¥è¯´æ˜Žï¼Œé¦–å…ˆçœ‹ä¸‹é¢çš„t1è¡¨ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦æŸ¥çœ‹æ¯ä¸ªäººçš„å¤šä¸ªåˆ†æ•°ï¼Œå°†è¯¥äººå¯¹åº”çš„å¤šä¸ªåˆ†æ•°æ˜¾ç¤ºåœ¨ä¸€èµ·ï¼Œåˆ†æ•°è¦ä»Žé«˜åˆ°åº•æŽ’åºã€‚å¯ä»¥è¿™æ ·å†™ï¼š SELECT username,GROUP_CONCAT(score ORDER BY score DESC) AS myScore FROM t1 GROUP BY username; æ•ˆæžœå¦‚ä¸‹ï¼š 12345678910111213141516UPDATE cash_billing_item bi, ( SELECT bi.id FROM cash_billing_item bi WHERE bi.id and bi.status = 1 and bi.id not in ( SELECT group_concat(id ORDER BY product_start_time desc) FROM cash_billing_item WHERE product_no = bi.product_no AND customer_no = bi.customer_no and status = 1 GROUP BY product_no, customer_no ) ) tempSET bi.status = 2WHERE bi.id = temp.id; group_catä¹‹åŽç›¸å½“äºŽè¿˜æœ‰ä¸€ä¸ªSELECT substring_index(â€˜10,3,4,5â€™,â€™,â€™,1); è¿”å›žç¬¬ä¸€ä¸ª10]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLä¸­decimalç±»åž‹è¯¦è§£åŠç±»åž‹è½¬æ¢]]></title>
    <url>%2F2017%2F11%2F16%2FMySQL%E4%B8%ADdecimal%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3%E5%8F%8A%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%2F</url>
    <content type="text"><![CDATA[1select name,cast(age/(select sum(age) from boss) as decimal(32,2)) as age from boss; å…¶ä¸­castæ˜¯ç±»åž‹è½¬æ¢å‡½æ•°ï¼Œdecimalä¸ºä¸€ä¸ªç±»åž‹ 1.é¦–å…ˆï¼Œå¯¹äºŽç²¾åº¦æ¯”è¾ƒé«˜çš„ä¸œè¥¿ï¼Œæ¯”å¦‚moneyï¼Œæˆ‘ä¼šç”¨decimalç±»åž‹ï¼Œä¸ä¼šè€ƒè™‘float,double,å› ä¸ºä»–ä»¬å®¹æ˜“äº§ç”Ÿè¯¯å·®ï¼Œnumericå’ŒdecimalåŒä¹‰ï¼Œnumericå°†è‡ªåŠ¨è½¬æˆdecimalã€‚ DECIMALä»ŽMySQL 5.1å¼•å…¥ï¼Œåˆ—çš„å£°æ˜Žè¯­æ³•æ˜¯DECIMAL(M,D)ã€‚åœ¨MySQL 5.1ä¸­ï¼Œå‚é‡çš„å–å€¼èŒƒå›´å¦‚ä¸‹ï¼š Â·Mæ˜¯æ•°å­—çš„æœ€å¤§æ•°ï¼ˆç²¾åº¦ï¼‰ã€‚å…¶èŒƒå›´ä¸º1ï½ž65ï¼ˆåœ¨è¾ƒæ—§çš„MySQLç‰ˆæœ¬ä¸­ï¼Œå…è®¸çš„èŒƒå›´æ˜¯1ï½ž254ï¼‰ï¼ŒM çš„é»˜è®¤å€¼æ˜¯10ã€‚ Â·Dæ˜¯å°æ•°ç‚¹å³ä¾§æ•°å­—çš„æ•°ç›®ï¼ˆæ ‡åº¦ï¼‰ã€‚å…¶èŒƒå›´æ˜¯0ï½ž30ï¼Œä½†ä¸å¾—è¶…è¿‡Mã€‚ è¯´æ˜Žï¼šfloatå 4ä¸ªå­—èŠ‚ï¼Œdoubleå 8ä¸ªå­—èŠ‚ï¼Œdecimail(M,D)å M+2ä¸ªå­—èŠ‚ã€‚ å¦‚DECIMAL(5,2) çš„æœ€å¤§å€¼ä¸º9 9 9 9 . 9 9ï¼Œå› ä¸ºæœ‰7 ä¸ªå­—èŠ‚å¯ç”¨ã€‚ M ä¸ŽD å¯¹DECIMAL(M, D) å–å€¼èŒƒå›´çš„å½±å“ ç±»åž‹è¯´æ˜Žå–å€¼èŒƒå›´ï¼ˆMySQL &lt; 3.23ï¼‰å–å€¼èŒƒå›´ï¼ˆMySQL &gt;= 3.23ï¼‰ MySQL &lt; 3.23 MySQL &gt;=3.23DECIMAL(4, 1) -9.9 åˆ° 99.9 -999.9 åˆ° 9999.9 DECIMAL(5,1) -99.9 åˆ° 999.9 -9999.9 åˆ° 99999.9 DECIMAL(6,1) -999.9 åˆ° 9999.9 -99999.9 åˆ° 999999.9 DECIMAL(6,2) -99.99 åˆ° 999.99 -9999.99 åˆ° 99999.99 DECIMAL(6,3) -9.999 åˆ° 99.999 -999.999 åˆ° 9999.999 åœ¨MySQL 3.23 åŠä»¥åŽçš„ç‰ˆæœ¬ä¸­ï¼ŒDECIMAL(M, D) çš„å–å€¼èŒƒå›´ç­‰äºŽæ—©æœŸç‰ˆæœ¬ä¸­çš„DECIMAL(M + 2, D) çš„å–å€¼èŒƒå›´ã€‚ ç»“è®ºï¼š å½“æ•°å€¼åœ¨å…¶å–å€¼èŒƒå›´ä¹‹å†…ï¼Œå°æ•°ä½å¤šäº†ï¼Œåˆ™ç›´æŽ¥æˆªæ–­å°æ•°ä½ã€‚ è‹¥æ•°å€¼åœ¨å…¶å–å€¼èŒƒå›´ä¹‹å¤–ï¼Œåˆ™ç”¨æœ€å¤§(å°)å€¼å¯¹å…¶å¡«å……ã€‚]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Dubboç›´è¿žè°ƒè¯•]]></title>
    <url>%2F2017%2F11%2F14%2FDubbo%E7%9B%B4%E8%BF%9E%E8%B0%83%E8%AF%95%2F</url>
    <content type="text"><![CDATA[æœåŠ¡ç«¯ï¼š 123456789101112131415161718192021222324252627&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:dubbo="http://code.alibabatech.com/schema/dubbo" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd" default-autowire="byName"&gt; &lt;dubbo:provider group="xxx"/&gt;&lt;!-- æä¾›æ–¹åº”ç”¨ä¿¡æ¯ï¼Œç”¨äºŽè®¡ç®—ä¾èµ–å…³ç³» --&gt; &lt;dubbo:application name="sports-basic-provider"/&gt; &lt;!-- ä½¿ç”¨zookeeperæ³¨å†Œä¸­å¿ƒæš´éœ²æœåŠ¡åœ°å€ --&gt; &lt;dubbo:registry protocol="zookeeper" address="$&#123;dubbo.registry.address&#125;"/&gt; &lt;!-- ä½¿ç”¨dubboåè®®åœ¨20880ç«¯å£æš´éœ²æœåŠ¡ --&gt; &lt;dubbo:protocol name="dubbo" port="20880"/&gt; &lt;!-- basic start --&gt; &lt;dubbo:service interface="com.xxx.basic.manage.service.OrganizationService" ref="organizationService" timeout="10000"/&gt; &lt;dubbo:service interface="com.xxx.basic.manage.service.ResourceService" ref="resourceService" timeout="10000"/&gt; &lt;dubbo:service interface="com.xxx.basic.manage.service.SysRoleService" ref="sysRoleService" timeout="10000"/&gt; &lt;dubbo:service interface="com.xxx.basic.manage.service.SysUserService" ref="sysUserService" timeout="10000"/&gt;&lt;/beans&gt; æ¶ˆè´¹ç«¯ï¼š å¢žåŠ url=â€dubbo://localhost:20880â€å³å¯ã€‚ 1234567891011121314151617181920&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dubbo="http://code.alibabatech.com/schema/dubbo" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd" default-autowire="byName"&gt; &lt;dubbo:application name="$&#123;dubbo.application.name&#125;"/&gt; &lt;dubbo:registry address="$&#123;dubbo.registry.address&#125;" timeout="$&#123;dubbo.consumer.timeout&#125;" /&gt; &lt;dubbo:consumer retries="$&#123;dubbo.consumer.retries&#125;" group="oa" /&gt; &lt;!-- basic start --&gt; &lt;dubbo:reference interface="com.xxx.basic.manage.service.SysRoleService" id="sysRoleService" check="false" url="dubbo://localhost:20880"/&gt; &lt;dubbo:reference interface="com.xxx.basic.manage.service.ResourceService" id="resourceService" check="false" url="dubbo://localhost:20880" /&gt; &lt;dubbo:reference interface="com.xxx.basic.manage.service.OrganizationService" id="organizationService" check="false" url="dubbo://localhost:20880" /&gt; &lt;dubbo:reference interface="com.xxx.basic.manage.service.SysUserService" id="sysUserService" check="false" url="dubbo://localhost:20880"/&gt;&lt;/beans&gt; å¼€å‘è°ƒè¯• æˆ‘ä»¬å¯åŠ¨è¿œç¨‹æœåŠ¡æä¾›è€… æˆ‘å¯åŠ¨web-bossï¼Œè¿™é‡Œè°ƒç”¨æ˜¯è¿œç¨‹æä¾›è€…æœåŠ¡ æŸ¥çœ‹user-service,provideræ–¹çš„é…ç½® é…ç½®consumeræ–¹è°ƒç”¨æœ¬åœ°dubboæœåŠ¡ï¼Œè¿›è¡Œç›´è¿žè°ƒè¯• æˆ‘ä»¬å¯åŠ¨æœ¬åœ° dubboæœåŠ¡,ä»¥debugæ¨¡å¼å¯åŠ¨ åœ¨dubboç®¡ç†æŽ§åˆ¶å°æŸ¥çœ‹dubboæœåŠ¡ å¯åŠ¨æ¶ˆè´¹ç«¯ï¼Œweb-bossæˆ‘ä»¬è¿›è¡Œç›´è¿žè°ƒè¯• consumeræŽ§åˆ¶å°ä¿¡æ¯ æˆ‘ä»¬å†è®¿é—®ç™»å½•ï¼Œä¼šå‘çŽ°å·²è°ƒç”¨æœ¬åœ°dubboæ¨¡å¼ï¼Œè¿›å…¥debugè°ƒè¯•æ¨¡å¼ æˆ‘ä»¬åœ¨Dubboç®¡ç†æŽ§åˆ¶å°æŠŠproviderç¦ç”¨ï¼Œå‘çŽ°ä¹Ÿæ˜¯è°ƒç”¨æœ¬åœ°dubboæœåŠ¡ï¼Œç»•è¿‡äº†æ³¨å†Œä¸­å¿ƒï¼Œè¿™å°±æ˜¯ç›´è¿žæä¾›è€… æˆ‘ä»¬åœ¨${user.home}ä¸‹é…ç½®ç›´æŽ¥æä¾›è€…å±žæ€§ä¹Ÿæ˜¯å¯ä»¥çš„(æŽ¨èä½¿ç”¨ï¼‰ dubbo-resolve.properties å†…å®¹ ï¼š edu.facade.user.service.PmsUserFacade=dubbo://localhost:20880 æ³¨æ„ç‚¹ï¼š 1ã€ ç›´è¿žæä¾›è€…åªéœ€è¦åœ¨æ¶ˆè´¹ç«¯è®¾ç½® 2ã€ ${user.home}æŒ‡çš„æ˜¯å½“å‰æ“ä½œç³»ç»Ÿç”¨æˆ·ç›®å½•ï¼Œå¦‚ Win7ç³»ç»Ÿ Administratorçš„ç”¨æˆ·ç›®å½•å°±æ˜¯ C:\Users\Administrator]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JedisCommandsè¯´æ˜Ž]]></title>
    <url>%2F2017%2F11%2F13%2FJedisCommands%E8%AF%B4%E6%98%8E%2F</url>
    <content type="text"><![CDATA[https://redis.io/commands/incr 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952953954955956957958959960961962963964965966967968969970971972973974975976977978979980981982983984985986987988989990991992993994995996997998999100010011002100310041005100610071008100910101011101210131014101510161017101810191020102110221023102410251026102710281029103010311032103310341035103610371038103910401041104210431044104510461047104810491050105110521053105410551056105710581059106010611062106310641065106610671068106910701071107210731074107510761077107810791080108110821083108410851086108710881089109010911092109310941095109610971098109911001101110211031104110511061107110811091110111111121113111411151116111711181119112011211122112311241125112611271128112911301131113211331134113511361137113811391140114111421143114411451146114711481149115011511152115311541155115611571158115911601161116211631164116511661167116811691170117111721173117411751176117711781179118011811182118311841185118611871188118911901191119211931194119511961197119811991200120112021203120412051206120712081209121012111212121312141215121612171218121912201221122212231224122512261227122812291230import java.util.List;import java.util.Map;import java.util.Set;/** * Common interface for sharded and non-sharded Jedis */public interface JedisCommands &#123; /** * å­˜å‚¨æ•°æ®åˆ°ç¼“å­˜ä¸­ï¼Œè‹¥keyå·²å­˜åœ¨åˆ™è¦†ç›– valueçš„é•¿åº¦ä¸èƒ½è¶…è¿‡1073741824 bytes (1 GB) * * @param key * @param value * @return */ String set(String key, String value); /** * å­˜å‚¨æ•°æ®åˆ°ç¼“å­˜ä¸­ï¼Œå¹¶åˆ¶å®šè¿‡æœŸæ—¶é—´å’Œå½“Keyå­˜åœ¨æ—¶æ˜¯å¦è¦†ç›–ã€‚ * * @param key * @param value * @param nxxx * nxxxçš„å€¼åªèƒ½å–NXæˆ–è€…XXï¼Œå¦‚æžœå–NXï¼Œåˆ™åªæœ‰å½“keyä¸å­˜åœ¨æ˜¯æ‰è¿›è¡Œsetï¼Œå¦‚æžœå–XXï¼Œåˆ™åªæœ‰å½“keyå·²ç»å­˜åœ¨æ—¶æ‰è¿›è¡Œset * * @param expx expxçš„å€¼åªèƒ½å–EXæˆ–è€…PXï¼Œä»£è¡¨æ•°æ®è¿‡æœŸæ—¶é—´çš„å•ä½ï¼ŒEXä»£è¡¨ç§’ï¼ŒPXä»£è¡¨æ¯«ç§’ã€‚ * @param time è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ˜¯expxæ‰€ä»£è¡¨çš„å•ä½ã€‚ * @return */ String set(String key, String value, String nxxx, String expx, long time); /** * ä»Žç¼“å­˜ä¸­æ ¹æ®keyå–å¾—å…¶Stringç±»åž‹çš„å€¼ï¼Œå¦‚æžœkeyä¸å­˜åœ¨åˆ™è¿”å›žnullï¼Œå¦‚æžœkeyå­˜åœ¨ä½†valueä¸æ˜¯stringç±»åž‹çš„ï¼Œ * åˆ™è¿”å›žä¸€ä¸ªerrorã€‚è¿™ä¸ªæ–¹æ³•åªèƒ½ä»Žç¼“å­˜ä¸­å–å¾—valueä¸ºstringç±»åž‹çš„å€¼ã€‚ * * @param key * @return */ String get(String key); /** * æ£€æŸ¥æŸä¸ªkeyæ˜¯å¦åœ¨ç¼“å­˜ä¸­å­˜åœ¨ï¼Œå¦‚æžœå­˜åœ¨è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalseï¼›éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿è¯¥keyæ‰€å¯¹åº”çš„valueæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œ * ä¹Ÿä¾ç„¶ä¼šè¿”å›žtrueã€‚ * * @param key * @return */ Boolean exists(String key); /** * * å¦‚æžœä¸€ä¸ªkeyè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œåˆ™å–æ¶ˆå…¶è¿‡æœŸæ—¶é—´ï¼Œä½¿å…¶æ°¸ä¹…å­˜åœ¨ã€‚ * * @param key * @return è¿”å›ž1æˆ–è€…0,1ä»£è¡¨å–æ¶ˆè¿‡æœŸæ—¶é—´æˆåŠŸï¼Œ0ä»£è¡¨ä¸æˆåŠŸ(åªæœ‰å½“keyä¸å­˜åœ¨æ—¶è¿™ç§æƒ…å†µæ‰ä¼šå‘ç”Ÿ) */ Long persist(String key); /** * è¿”å›žæŸä¸ªkeyæ‰€å­˜å‚¨çš„æ•°æ®ç±»åž‹ï¼Œè¿”å›žçš„æ•°æ®ç±»åž‹æœ‰å¯èƒ½æ˜¯"none", "string", "list", "set", "zset", * "hash". "none"ä»£è¡¨keyä¸å­˜åœ¨ã€‚ * * @param key * @return */ String type(String key); /** * ä¸ºkeyè®¾ç½®ä¸€ä¸ªç‰¹å®šçš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚è¿‡æœŸæ—¶é—´ä¸€åˆ°ï¼Œrediså°†ä¼šä»Žç¼“å­˜ä¸­åˆ é™¤æŽ‰è¯¥keyã€‚ * å³ä½¿æ˜¯æœ‰è¿‡æœŸæ—¶é—´çš„keyï¼Œredisä¹Ÿä¼šåœ¨æŒä¹…åŒ–æ—¶å°†å…¶å†™åˆ°ç¡¬ç›˜ä¸­ï¼Œå¹¶æŠŠç›¸å¯¹è¿‡æœŸæ—¶é—´æ”¹ä¸ºç»å¯¹çš„Unixè¿‡æœŸæ—¶é—´ã€‚ * åœ¨ä¸€ä¸ªæœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„keyä¸Šé‡å¤è®¾ç½®è¿‡æœŸæ—¶é—´å°†ä¼šè¦†ç›–åŽŸå…ˆè®¾ç½®çš„è¿‡æœŸæ—¶é—´ã€‚ * * @param key * @param seconds * @return è¿”å›ž1è¡¨ç¤ºæˆåŠŸè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿”å›ž0è¡¨ç¤ºkeyä¸å­˜åœ¨ã€‚ */ Long expire(String key, int seconds); /** * æœºåˆ¶åŒ&#123;@link expire&#125;ä¸€æ ·ï¼Œåªæ˜¯æ—¶é—´å•ä½æ”¹ä¸ºæ¯«ç§’ã€‚ * * @param key * @param milliseconds * @return è¿”å›žå€¼åŒ &#123;@link expire&#125;ä¸€æ ·ã€‚ */ Long pexpire(String key, long milliseconds); /** * ä¸Ž&#123;@link expire&#125;ä¸ä¸€æ ·ï¼ŒexpireAtè®¾ç½®çš„æ—¶é—´ä¸æ˜¯èƒ½å­˜æ´»å¤šä¹…ï¼Œè€Œæ˜¯å›ºå®šçš„UNIXæ—¶é—´ï¼ˆä»Ž1970å¹´å¼€å§‹ç®—èµ·ï¼‰ï¼Œå•ä½ä¸ºç§’ã€‚ * * @param key * @param unixTime * @return */ Long expireAt(String key, long unixTime); /** * åŒ&#123;@link expireAt&#125;æœºåˆ¶ç›¸åŒï¼Œä½†å•ä½ä¸ºæ¯«ç§’ã€‚ * * @param key * @param millisecondsTimestamp * @return */ Long pexpireAt(String key, long millisecondsTimestamp); /** * è¿”å›žä¸€ä¸ªkeyè¿˜èƒ½æ´»å¤šä¹…ï¼Œå•ä½ä¸ºç§’ * * @param key * @return å¦‚æžœè¯¥keyæœ¬æ¥å¹¶æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ™è¿”å›ž-1ï¼Œå¦‚æžœè¯¥keyä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ž-2 */ Long ttl(String key); /** * è®¾ç½®æˆ–è€…æ¸…é™¤æŒ‡å®škeyçš„valueä¸Šçš„æŸä¸ªä½ç½®çš„æ¯”ç‰¹ä½ï¼Œå¦‚æžœè¯¥keyåŽŸå…ˆä¸å­˜åœ¨ï¼Œåˆ™æ–°åˆ›å»ºä¸€ä¸ªkeyï¼Œå…¶valueå°†ä¼šè‡ªåŠ¨åˆ†é…å†…å­˜ï¼Œ * ç›´åˆ°å¯ä»¥æ”¾ä¸‹æŒ‡å®šä½ç½®çš„bitå€¼ã€‚ * * @param key * @param offset * @param value trueä»£è¡¨1ï¼Œfalseä»£è¡¨0 * @return è¿”å›žåŽŸæ¥ä½ç½®çš„bitå€¼æ˜¯å¦æ˜¯1ï¼Œå¦‚æžœæ˜¯1ï¼Œåˆ™è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalseã€‚ */ Boolean setbit(String key, long offset, boolean value); /** * è®¾ç½®æˆ–è€…æ¸…é™¤æŒ‡å®škeyçš„valueä¸Šçš„æŸä¸ªä½ç½®çš„æ¯”ç‰¹ä½ï¼Œå¦‚æžœè¯¥keyåŽŸå…ˆä¸å­˜åœ¨ï¼Œåˆ™æ–°åˆ›å»ºä¸€ä¸ªkeyï¼Œå…¶valueå°†ä¼šè‡ªåŠ¨åˆ†é…å†…å­˜ï¼Œ * ç›´åˆ°å¯ä»¥æ”¾ä¸‹æŒ‡å®šä½ç½®çš„bitå€¼ã€‚ * * @param key * @param offset * @param value åªèƒ½æ˜¯"1"æˆ–è€…"0" * @return è¿”å›žåŽŸæ¥ä½ç½®çš„bitå€¼æ˜¯å¦æ˜¯1ï¼Œå¦‚æžœæ˜¯1ï¼Œåˆ™è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalseã€‚ */ Boolean setbit(String key, long offset, String value); /** * å–å¾—åç§»é‡ä¸ºoffsetçš„bitå€¼ã€‚ * * @param key * @param offset * @return trueä»£è¡¨1ï¼Œfalseä»£è¡¨0 */ Boolean getbit(String key, long offset); /** * è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯è¦†ç›–keyå¯¹åº”çš„stringçš„ä¸€éƒ¨åˆ†ï¼Œä»ŽæŒ‡å®šçš„offsetå¤„å¼€å§‹ï¼Œè¦†ç›–valueçš„é•¿åº¦ã€‚ * å¦‚æžœoffsetæ¯”å½“å‰keyå¯¹åº”stringè¿˜è¦é•¿ï¼Œ * é‚£è¿™ä¸ªstringåŽé¢å°±è¡¥0ä»¥è¾¾åˆ°offsetã€‚ä¸å­˜åœ¨çš„keysè¢«è®¤ä¸ºæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™ä¸ªå‘½ä»¤å¯ä»¥ç¡®ä¿keyæœ‰ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å­—ç¬¦ä¸² * èƒ½åœ¨offsetå¤„è®¾ç½®valueã€‚ * * @param key * @param offset * @param value * @return è¯¥å‘½ä»¤ä¿®æ”¹åŽçš„å­—ç¬¦ä¸²é•¿åº¦ */ Long setrange(String key, long offset, String value); /** * èŽ·å¾—start - endä¹‹é—´çš„å­å­—ç¬¦ä¸²ï¼Œè‹¥åç§»é‡ä¸ºè´Ÿæ•°ï¼Œä»£è¡¨ä»Žæœ«å°¾å¼€å§‹è®¡ç®—ï¼Œä¾‹å¦‚-1ä»£è¡¨å€’æ•°ç¬¬ä¸€ä¸ªï¼Œ-2ä»£è¡¨å€’æ•°ç¬¬äºŒä¸ª * * @param key * @param startOffset * @param endOffset * @return */ String getrange(String key, long startOffset, long endOffset); /** * è‡ªåŠ¨å°†keyå¯¹åº”åˆ°valueå¹¶ä¸”è¿”å›žåŽŸæ¥keyå¯¹åº”çš„valueã€‚å¦‚æžœkeyå­˜åœ¨ä½†æ˜¯å¯¹åº”çš„valueä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°±è¿”å›žé”™è¯¯ã€‚ * * @param key * @param value * @return */ String getSet(String key, String value); /** * å‚è€ƒ &#123;@link set(String key, String value, String nxxx, String expx, long * time)&#125; * * @param key * @param value * @return */ Long setnx(String key, String value); /** * å‚è€ƒ &#123;@link set(String key, String value, String nxxx, String expx, long * time)&#125; * * @param key * @param seconds * @param value * @return */ String setex(String key, int seconds, String value); /** * å°†æŒ‡å®škeyçš„å€¼å‡å°‘æŸä¸ªå€¼ * * @param key * @param integer * @return è¿”å›žå‡å°‘åŽçš„æ–°å€¼ */ Long decrBy(String key, long integer); /** * å°†æŒ‡å®šKeyçš„å€¼å‡å°‘1 * * @param key * @return è¿”å›žå‡å°‘åŽçš„æ–°å€¼ */ Long decr(String key); /** * å°†æŒ‡å®šçš„keyçš„å€¼å¢žåŠ æŒ‡å®šçš„å€¼ * * @param key * @param integer * @return è¿”å›žå¢žåŠ åŽçš„æ–°å€¼ */ Long incrBy(String key, long integer); /** * å°†æŒ‡å®šçš„keyçš„å€¼å¢žåŠ æŒ‡å®šçš„å€¼(æµ®ç‚¹æ•°) * * @param key * @param value * @return è¿”å›žå¢žåŠ åŽçš„æ–°å€¼ */ Double incrByFloat(String key, double value); /** * å°†æŒ‡å®šçš„keyçš„å€¼å¢žåŠ 1 * * @param key * @return è¿”å›žå¢žåŠ åŽçš„æ–°å€¼ */ Long incr(String key); /** * è‹¥keyå­˜åœ¨ï¼Œå°†valueè¿½åŠ åˆ°åŽŸæœ‰å­—ç¬¦ä¸²çš„æœ«å°¾ã€‚è‹¥keyä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå­—ç¬¦ä¸²ã€‚ * * @param key * @param value * @return è¿”å›žå­—ç¬¦ä¸²çš„æ€»é•¿åº¦ */ Long append(String key, String value); /** * è¿”å›žstart - end ä¹‹é—´çš„å­å­—ç¬¦ä¸²(start å’Œ endå¤„çš„å­—ç¬¦ä¹ŸåŒ…æ‹¬åœ¨å†…) * * @param key * @param start * @param end * @return è¿”å›žå­å­—ç¬¦ä¸² */ String substr(String key, int start, int end); /** * è®¾ç½®hashè¡¨é‡Œfieldå­—æ®µçš„å€¼ä¸ºvalueã€‚å¦‚æžœkeyä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„hashè¡¨ * * @param key * @param field * @param value * @return å¦‚æžœè¯¥å­—æ®µå·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆå°†ä¼šæ›´æ–°è¯¥å­—æ®µçš„å€¼ï¼Œè¿”å›ž0.å¦‚æžœå­—æ®µä¸å­˜åœ¨ï¼Œåˆ™æ–°åˆ›å»ºä¸€ä¸ªå¹¶ä¸”è¿”å›ž1. */ Long hset(String key, String field, String value); /** * å¦‚æžœè¯¥keyå¯¹åº”çš„å€¼æ˜¯ä¸€ä¸ªHashè¡¨ï¼Œåˆ™è¿”å›žå¯¹åº”å­—æ®µçš„å€¼ã€‚ å¦‚æžœä¸å­˜åœ¨è¯¥å­—æ®µï¼Œæˆ–è€…keyä¸å­˜åœ¨ï¼Œåˆ™è¿”å›žä¸€ä¸ª"nil"å€¼ã€‚ * * @param key * @param field * @return */ String hget(String key, String field); /** * å½“å­—æ®µä¸å­˜åœ¨æ—¶ï¼Œæ‰è¿›è¡Œsetã€‚ * * @param key * @param field * @param value * @return å¦‚æžœè¯¥å­—æ®µå·²ç»å­˜åœ¨ï¼Œåˆ™è¿”å›ž0.è‹¥å­—æ®µä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºåŽsetï¼Œè¿”å›ž1. */ Long hsetnx(String key, String field, String value); /** * è®¾ç½®å¤šä¸ªå­—æ®µå’Œå€¼ï¼Œå¦‚æžœå­—æ®µå­˜åœ¨ï¼Œåˆ™è¦†ç›–ã€‚ * * @param key * @param hash * @return è®¾ç½®æˆåŠŸè¿”å›žOKï¼Œè®¾ç½®ä¸æˆåŠŸåˆ™è¿”å›žEXCEPTION */ String hmset(String key, Map&lt;String, String&gt; hash); /** * åœ¨hashä¸­èŽ·å–å¤šä¸ªå­—æ®µçš„å€¼ï¼Œè‹¥å­—æ®µä¸å­˜åœ¨ï¼Œåˆ™å…¶å€¼ä¸ºnilã€‚ * * @param key * @param fields * @return æŒ‰é¡ºåºè¿”å›žå¤šä¸ªå­—æ®µçš„å€¼ã€‚ */ List&lt;String&gt; hmget(String key, String... fields); /** * å¯¹hashä¸­æŒ‡å®šå­—æ®µçš„å€¼å¢žåŠ æŒ‡å®šçš„å€¼ * * @param key * @param field * @param value * @return è¿”å›žå¢žåŠ åŽçš„æ–°å€¼ */ Long hincrBy(String key, String field, long value); /** * åˆ¤æ–­hashä¸­æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨ * * @param key * @param field * @return è‹¥å­˜åœ¨è¿”å›ž1ï¼Œè‹¥ä¸å­˜åœ¨è¿”å›ž0 */ Boolean hexists(String key, String field); /** * åˆ é™¤hashä¸­æŒ‡å®šå­—æ®µ * * @param key * @param field * @return åˆ é™¤æˆåŠŸè¿”å›ž1ï¼Œ åˆ é™¤ä¸æˆåŠŸè¿”å›ž0 */ Long hdel(String key, String... field); /** * è¿”å›ž key æŒ‡å®šçš„å“ˆå¸Œé›†åŒ…å«çš„å­—æ®µçš„æ•°é‡ * * @param key * @return å“ˆå¸Œé›†ä¸­å­—æ®µçš„æ•°é‡ï¼Œå½“ key æŒ‡å®šçš„å“ˆå¸Œé›†ä¸å­˜åœ¨æ—¶è¿”å›ž 0 */ Long hlen(String key); /** * è¿”å›ž key æŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æ‰€æœ‰å­—æ®µçš„åå­—ã€‚ * * @param key * @return å“ˆå¸Œé›†ä¸­çš„å­—æ®µåˆ—è¡¨ï¼Œå½“ key æŒ‡å®šçš„å“ˆå¸Œé›†ä¸å­˜åœ¨æ—¶è¿”å›žç©ºåˆ—è¡¨ã€‚ */ Set&lt;String&gt; hkeys(String key); /** * è¿”å›ž key æŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æ‰€æœ‰å­—æ®µçš„å€¼ã€‚ * * @param key * @return å“ˆå¸Œé›†ä¸­çš„å€¼çš„åˆ—è¡¨ï¼Œå½“ key æŒ‡å®šçš„å“ˆå¸Œé›†ä¸å­˜åœ¨æ—¶è¿”å›žç©ºåˆ—è¡¨ã€‚ */ List&lt;String&gt; hvals(String key); /** * è¿”å›ž key æŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æ‰€æœ‰çš„å­—æ®µå’Œå€¼ * * @param key * @return è¿”å›ž key æŒ‡å®šçš„å“ˆå¸Œé›†ä¸­æ‰€æœ‰çš„å­—æ®µå’Œå€¼,è‹¥keyä¸å­˜åœ¨è¿”å›žç©ºmapã€‚ */ Map&lt;String, String&gt; hgetAll(String key); /** * å‘å­˜äºŽ key çš„åˆ—è¡¨çš„å°¾éƒ¨æ’å…¥æ‰€æœ‰æŒ‡å®šçš„å€¼ã€‚å¦‚æžœ key ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„åˆ—è¡¨ç„¶åŽå†è¿›è¡Œ push æ“ä½œã€‚ å½“ key * ä¿å­˜çš„ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œé‚£ä¹ˆä¼šè¿”å›žä¸€ä¸ªé”™è¯¯ã€‚ * * å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‘½ä»¤æŠŠå¤šä¸ªå…ƒç´ æ‰“å…¥é˜Ÿåˆ—ï¼Œåªéœ€è¦åœ¨å‘½ä»¤åŽé¢æŒ‡å®šå¤šä¸ªå‚æ•°ã€‚å…ƒç´ æ˜¯ä»Žå·¦åˆ°å³ä¸€ä¸ªæŽ¥ä¸€ä¸ªä»Žåˆ—è¡¨å°¾éƒ¨æ’å…¥ã€‚ æ¯”å¦‚å‘½ä»¤ RPUSH mylist a * b c ä¼šè¿”å›žä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ a ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ b ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯ cã€‚ * * @param key * @param string * @return åœ¨ push æ“ä½œåŽçš„åˆ—è¡¨é•¿åº¦ã€‚ */ Long rpush(String key, String... string); /** * å°†æ‰€æœ‰æŒ‡å®šçš„å€¼æ’å…¥åˆ°å­˜äºŽ key çš„åˆ—è¡¨çš„å¤´éƒ¨ã€‚å¦‚æžœ key ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œ push æ“ä½œå‰ä¼šåˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ å¦‚æžœ key * å¯¹åº”çš„å€¼ä¸æ˜¯ä¸€ä¸ª list çš„è¯ï¼Œé‚£ä¹ˆä¼šè¿”å›žä¸€ä¸ªé”™è¯¯ã€‚ * * å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‘½ä»¤æŠŠå¤šä¸ªå…ƒç´  push è¿›å…¥åˆ—è¡¨ï¼Œåªéœ€åœ¨å‘½ä»¤æœ«å°¾åŠ ä¸Šå¤šä¸ªæŒ‡å®šçš„å‚æ•°ã€‚å…ƒç´ æ˜¯ä»Žæœ€å·¦ç«¯çš„åˆ°æœ€å³ç«¯çš„ã€ä¸€ä¸ªæŽ¥ä¸€ä¸ªè¢«æ’å…¥åˆ° list * çš„å¤´éƒ¨ã€‚ æ‰€ä»¥å¯¹äºŽè¿™ä¸ªå‘½ä»¤ä¾‹å­ LPUSH mylist a b cï¼Œè¿”å›žçš„åˆ—è¡¨æ˜¯ c ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ b ä¸ºç¬¬äºŒä¸ªå…ƒç´ ï¼Œ a ä¸ºç¬¬ä¸‰ä¸ªå…ƒç´ ã€‚ * * @param key * @param string * @return åœ¨ push æ“ä½œåŽçš„åˆ—è¡¨é•¿åº¦ã€‚ */ Long lpush(String key, String... string); /** * è¿”å›žå­˜å‚¨åœ¨ key é‡Œçš„listçš„é•¿åº¦ã€‚ å¦‚æžœ key ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±è¢«çœ‹ä½œæ˜¯ç©ºlistï¼Œå¹¶ä¸”è¿”å›žé•¿åº¦ä¸º 0ã€‚ å½“å­˜å‚¨åœ¨ key * é‡Œçš„å€¼ä¸æ˜¯ä¸€ä¸ªlistçš„è¯ï¼Œä¼šè¿”å›žerrorã€‚ * * @param key * @return keyå¯¹åº”çš„listçš„é•¿åº¦ã€‚ */ Long llen(String key); /** * è¿”å›žå­˜å‚¨åœ¨ key çš„åˆ—è¡¨é‡ŒæŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ã€‚ start å’Œ end * åç§»é‡éƒ½æ˜¯åŸºäºŽ0çš„ä¸‹æ ‡ï¼Œå³listçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸‹æ ‡æ˜¯0ï¼ˆlistçš„è¡¨å¤´ï¼‰ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸‹æ ‡æ˜¯1ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ * * åç§»é‡ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œè¡¨ç¤ºåç§»é‡æ˜¯ä»Žlistå°¾éƒ¨å¼€å§‹è®¡æ•°ã€‚ ä¾‹å¦‚ï¼Œ -1 è¡¨ç¤ºåˆ—è¡¨çš„æœ€åŽä¸€ä¸ªå…ƒç´ ï¼Œ-2 æ˜¯å€’æ•°ç¬¬äºŒä¸ªï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ * * @param key * @param start * @param end * @return æŒ‡å®šèŒƒå›´é‡Œçš„åˆ—è¡¨å…ƒç´ ã€‚ */ List&lt;String&gt; lrange(String key, long start, long end); /** * ä¿®å‰ª(trim)ä¸€ä¸ªå·²å­˜åœ¨çš„ listï¼Œè¿™æ · list å°±ä¼šåªåŒ…å«æŒ‡å®šèŒƒå›´çš„æŒ‡å®šå…ƒç´ ã€‚start å’Œ stop éƒ½æ˜¯ç”±0å¼€å§‹è®¡æ•°çš„ï¼Œ è¿™é‡Œçš„ 0 * æ˜¯åˆ—è¡¨é‡Œçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆè¡¨å¤´ï¼‰ï¼Œ1 æ˜¯ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ * * @param key * @param start * @param end * @return */ String ltrim(String key, long start, long end); /** * è¿”å›žåˆ—è¡¨é‡Œçš„å…ƒç´ çš„ç´¢å¼• index å­˜å‚¨åœ¨ key é‡Œé¢ã€‚ ä¸‹æ ‡æ˜¯ä»Ž0å¼€å§‹ç´¢å¼•çš„ï¼Œæ‰€ä»¥ 0 æ˜¯è¡¨ç¤ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ 1 è¡¨ç¤ºç¬¬äºŒä¸ªå…ƒç´ ï¼Œå¹¶ä»¥æ­¤ç±»æŽ¨ã€‚ * è´Ÿæ•°ç´¢å¼•ç”¨äºŽæŒ‡å®šä»Žåˆ—è¡¨å°¾éƒ¨å¼€å§‹ç´¢å¼•çš„å…ƒç´ ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸‹ï¼Œ-1 è¡¨ç¤ºæœ€åŽä¸€ä¸ªå…ƒç´ ï¼Œ-2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå¹¶ä»¥æ­¤å¾€å‰æŽ¨ã€‚ * * å½“ key ä½ç½®çš„å€¼ä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„æ—¶å€™ï¼Œä¼šè¿”å›žä¸€ä¸ªerrorã€‚ * * @param key * @param index * @return è¯·æ±‚çš„å¯¹åº”å…ƒç´ ï¼Œæˆ–è€…å½“ index è¶…è¿‡èŒƒå›´çš„æ—¶å€™è¿”å›ž nilã€‚ */ String lindex(String key, long index); /** * è®¾ç½® index ä½ç½®çš„listå…ƒç´ çš„å€¼ä¸º valueã€‚ * * å½“indexè¶…å‡ºèŒƒå›´æ—¶ä¼šè¿”å›žä¸€ä¸ªerrorã€‚ * * @param key * @param index * @param value * @return çŠ¶æ€æ¢å¤ */ String lset(String key, long index, String value); /** * ä»Žå­˜äºŽ key çš„åˆ—è¡¨é‡Œç§»é™¤å‰ count æ¬¡å‡ºçŽ°çš„å€¼ä¸º value çš„å…ƒç´ ã€‚ è¿™ä¸ª count å‚æ•°é€šè¿‡ä¸‹é¢å‡ ç§æ–¹å¼å½±å“è¿™ä¸ªæ“ä½œï¼š * * count &gt; 0: ä»Žå¤´å¾€å°¾ç§»é™¤å€¼ä¸º value çš„å…ƒç´ ã€‚ count &lt; 0: ä»Žå°¾å¾€å¤´ç§»é™¤å€¼ä¸º value çš„å…ƒç´ ã€‚ count = 0: * ç§»é™¤æ‰€æœ‰å€¼ä¸º value çš„å…ƒç´ ã€‚ * * æ¯”å¦‚ï¼Œ LREM list -2 "hello" ä¼šä»Žå­˜äºŽ list çš„åˆ—è¡¨é‡Œç§»é™¤æœ€åŽä¸¤ä¸ªå‡ºçŽ°çš„ "hello"ã€‚ * * éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœlisté‡Œæ²¡æœ‰å­˜åœ¨keyå°±ä¼šè¢«å½“ä½œç©ºlistå¤„ç†ï¼Œæ‰€ä»¥å½“ key ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šè¿”å›ž 0ã€‚ * * @param key * @param count * @param value * @return è¿”å›žåˆ é™¤çš„ä¸ªæ•° */ Long lrem(String key, long count, String value); /** * ç§»é™¤å¹¶ä¸”è¿”å›ž key å¯¹åº”çš„ list çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ * * @param key * @return è¿”å›žç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œæˆ–è€…å½“ key ä¸å­˜åœ¨æ—¶è¿”å›ž nilã€‚ */ String lpop(String key); /** * ç§»é™¤å¹¶è¿”å›žå­˜äºŽ key çš„ list çš„æœ€åŽä¸€ä¸ªå…ƒç´ ã€‚ * * @param key * @return æœ€åŽä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œæˆ–è€…å½“ key ä¸å­˜åœ¨çš„æ—¶å€™è¿”å›ž nilã€‚ */ String rpop(String key); /** * æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šçš„memberå…ƒç´ åˆ°é›†åˆçš„ keyä¸­.æŒ‡å®šçš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ member å¦‚æžœå·²ç»åœ¨é›†åˆkeyä¸­å­˜åœ¨åˆ™å¿½ç•¥.å¦‚æžœé›†åˆkey * ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºé›†åˆkey,å¹¶æ·»åŠ memberå…ƒç´ åˆ°é›†åˆkeyä¸­. * * å¦‚æžœkey çš„ç±»åž‹ä¸æ˜¯é›†åˆåˆ™è¿”å›žé”™è¯¯. * * @param key * @param member * @return è¿”å›žæ–°æˆåŠŸæ·»åŠ åˆ°é›†åˆé‡Œå…ƒç´ çš„æ•°é‡ï¼Œä¸åŒ…æ‹¬å·²ç»å­˜åœ¨äºŽé›†åˆä¸­çš„å…ƒç´ . */ Long sadd(String key, String... member); /** * è¿”å›žkeyé›†åˆæ‰€æœ‰çš„å…ƒç´ . * * è¯¥å‘½ä»¤çš„ä½œç”¨ä¸Žä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„SINTER å‘½ä»¤ä½œç”¨ç›¸åŒ. * * @param key * @return é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ . */ Set&lt;String&gt; smembers(String key); /** * åœ¨keyé›†åˆä¸­ç§»é™¤æŒ‡å®šçš„å…ƒç´ . å¦‚æžœæŒ‡å®šçš„å…ƒç´ ä¸æ˜¯keyé›†åˆä¸­çš„å…ƒç´ åˆ™å¿½ç•¥ å¦‚æžœkeyé›†åˆä¸å­˜åœ¨åˆ™è¢«è§†ä¸ºä¸€ä¸ªç©ºçš„é›†åˆï¼Œè¯¥å‘½ä»¤è¿”å›ž0. * * å¦‚æžœkeyçš„ç±»åž‹ä¸æ˜¯ä¸€ä¸ªé›†åˆ,åˆ™è¿”å›žé”™è¯¯. * * @param key * @param member * @return ä»Žé›†åˆä¸­ç§»é™¤å…ƒç´ çš„ä¸ªæ•°ï¼Œä¸åŒ…æ‹¬ä¸å­˜åœ¨çš„æˆå‘˜. */ Long srem(String key, String... member); /** * ç§»é™¤å¹¶è¿”å›žä¸€ä¸ªé›†åˆä¸­çš„éšæœºå…ƒç´  * * è¯¥å‘½ä»¤ä¸Ž SRANDMEMBERç›¸ä¼¼,ä¸åŒçš„æ˜¯srandmemberå‘½ä»¤è¿”å›žä¸€ä¸ªéšæœºå…ƒç´ ä½†æ˜¯ä¸ç§»é™¤. * * @param key * @return è¢«ç§»é™¤çš„å…ƒç´ , å½“keyä¸å­˜åœ¨çš„æ—¶å€™è¿”å›ž nil . */ String spop(String key); /** * ç§»é™¤å¹¶è¿”å›žå¤šä¸ªé›†åˆä¸­çš„éšæœºå…ƒç´  * * @param key * @param count * @return è¢«ç§»é™¤çš„å…ƒç´ , å½“keyä¸å­˜åœ¨çš„æ—¶å€™å€¼ä¸º nil . */ Set&lt;String&gt; spop(String key, long count); /** * è¿”å›žé›†åˆå­˜å‚¨çš„keyçš„åŸºæ•° (é›†åˆå…ƒç´ çš„æ•°é‡). * * @param key * @return é›†åˆçš„åŸºæ•°(å…ƒç´ çš„æ•°é‡),å¦‚æžœkeyä¸å­˜åœ¨,åˆ™è¿”å›ž 0. */ Long scard(String key); /** * è¿”å›žæˆå‘˜ member æ˜¯å¦æ˜¯å­˜å‚¨çš„é›†åˆ keyçš„æˆå‘˜. * * @param key * @param member * @return å¦‚æžœmemberå…ƒç´ æ˜¯é›†åˆkeyçš„æˆå‘˜ï¼Œåˆ™è¿”å›ž1.å¦‚æžœmemberå…ƒç´ ä¸æ˜¯keyçš„æˆå‘˜ï¼Œæˆ–è€…é›†åˆkeyä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ž0 */ Boolean sismember(String key, String member); /** * ä»…æä¾›keyå‚æ•°,é‚£ä¹ˆéšæœºè¿”å›žkeyé›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ .è¯¥å‘½ä»¤ä½œç”¨ç±»ä¼¼äºŽSPOPå‘½ä»¤, ä¸åŒçš„æ˜¯SPOPå‘½ä»¤ä¼šå°†è¢«é€‰æ‹©çš„éšæœºå…ƒç´ ä»Žé›†åˆä¸­ç§»é™¤, * è€ŒSRANDMEMBERä»…ä»…æ˜¯è¿”å›žè¯¥éšè®°å…ƒç´ ,è€Œä¸åšä»»ä½•æ“ä½œ. * * @param key * @return è¿”å›žéšæœºçš„å…ƒç´ ,å¦‚æžœkeyä¸å­˜åœ¨åˆ™è¿”å›žnil */ String srandmember(String key); /** * å¦‚æžœcountæ˜¯æ•´æ•°ä¸”å°äºŽå…ƒç´ çš„ä¸ªæ•°ï¼Œè¿”å›žå«æœ‰ count * ä¸ªä¸åŒçš„å…ƒç´ çš„æ•°ç»„,å¦‚æžœcountæ˜¯ä¸ªæ•´æ•°ä¸”å¤§äºŽé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°æ—¶,ä»…è¿”å›žæ•´ä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´  * ,å½“countæ˜¯è´Ÿæ•°,åˆ™ä¼šè¿”å›žä¸€ä¸ªåŒ…å«countçš„ç»å¯¹å€¼çš„ä¸ªæ•°å…ƒç´ çš„æ•°ç»„ * ï¼Œå¦‚æžœcountçš„ç»å¯¹å€¼å¤§äºŽå…ƒç´ çš„ä¸ªæ•°,åˆ™è¿”å›žçš„ç»“æžœé›†é‡Œä¼šå‡ºçŽ°ä¸€ä¸ªå…ƒç´ å‡ºçŽ°å¤šæ¬¡çš„æƒ…å†µ. * * @param key * @param count * @return è¿”å›žä¸€ä¸ªéšæœºçš„å…ƒç´ æ•°ç»„,å¦‚æžœkeyä¸å­˜åœ¨åˆ™è¿”å›žä¸€ä¸ªç©ºçš„æ•°ç»„. */ List&lt;String&gt; srandmember(String key, int count); /** * è¿”å›žkeyçš„stringç±»åž‹valueçš„é•¿åº¦ã€‚å¦‚æžœkeyå¯¹åº”çš„éžstringç±»åž‹ï¼Œå°±è¿”å›žé”™è¯¯ã€‚ * * @param key * @return keyå¯¹åº”çš„å­—ç¬¦ä¸²valueçš„é•¿åº¦ï¼Œæˆ–è€…0ï¼ˆkeyä¸å­˜åœ¨ï¼‰ */ Long strlen(String key); /** * è¯¥å‘½ä»¤æ·»åŠ æŒ‡å®šçš„æˆå‘˜åˆ°keyå¯¹åº”çš„æœ‰åºé›†åˆä¸­ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æœ‰ä¸€ä¸ªåˆ†æ•°ã€‚ä½ å¯ä»¥æŒ‡å®šå¤šä¸ªåˆ†æ•°/æˆå‘˜ç»„åˆã€‚å¦‚æžœä¸€ä¸ªæŒ‡å®šçš„æˆå‘˜å·²ç»åœ¨å¯¹åº”çš„æœ‰åºé›†åˆä¸­äº†ï¼Œ * é‚£ä¹ˆå…¶åˆ†æ•°å°±ä¼šè¢«æ›´æ–°æˆæœ€æ–°çš„ * ï¼Œå¹¶ä¸”è¯¥æˆå‘˜ä¼šé‡æ–°è°ƒæ•´åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œä»¥ç¡®ä¿é›†åˆæœ‰åºã€‚å¦‚æžœkeyä¸å­˜åœ¨ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå«æœ‰è¿™äº›æˆå‘˜çš„æœ‰åºé›†åˆï¼Œå°±å¥½åƒå¾€ä¸€ä¸ªç©ºçš„é›†åˆä¸­æ·»åŠ ä¸€æ · * ã€‚å¦‚æžœkeyå­˜åœ¨ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæœ‰åºé›†åˆï¼Œé‚£ä¹ˆå°±è¿”å›žä¸€ä¸ªé”™è¯¯ã€‚ * * åˆ†æ•°çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¡¨ç¤ºæ•°å­—çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å¯ä»¥æ˜¯doubleç±»åž‹çš„æµ®ç‚¹æ•°ã€‚ * * @param key * @param score * @param member * @return è¿”å›žæ·»åŠ åˆ°æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œä¸åŒ…æ‹¬é‚£ç§å·²ç»å­˜åœ¨åªæ˜¯æ›´æ–°åˆ†æ•°çš„å…ƒç´ ã€‚ */ Long zadd(String key, double score, String member); /** * è¯¥å‘½ä»¤æ·»åŠ æŒ‡å®šçš„æˆå‘˜åˆ°keyå¯¹åº”çš„æœ‰åºé›†åˆä¸­ï¼Œæ¯ä¸ªæˆå‘˜éƒ½æœ‰ä¸€ä¸ªåˆ†æ•°ã€‚ä½ å¯ä»¥æŒ‡å®šå¤šä¸ªåˆ†æ•°/æˆå‘˜ç»„åˆã€‚å¦‚æžœä¸€ä¸ªæŒ‡å®šçš„æˆå‘˜å·²ç»åœ¨å¯¹åº”çš„æœ‰åºé›†åˆä¸­äº†ï¼Œ * é‚£ä¹ˆå…¶åˆ†æ•°å°±ä¼šè¢«æ›´æ–°æˆæœ€æ–°çš„ * ï¼Œå¹¶ä¸”è¯¥æˆå‘˜ä¼šé‡æ–°è°ƒæ•´åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œä»¥ç¡®ä¿é›†åˆæœ‰åºã€‚å¦‚æžœkeyä¸å­˜åœ¨ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå«æœ‰è¿™äº›æˆå‘˜çš„æœ‰åºé›†åˆï¼Œå°±å¥½åƒå¾€ä¸€ä¸ªç©ºçš„é›†åˆä¸­æ·»åŠ ä¸€æ · * ã€‚å¦‚æžœkeyå­˜åœ¨ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªæœ‰åºé›†åˆï¼Œé‚£ä¹ˆå°±è¿”å›žä¸€ä¸ªé”™è¯¯ã€‚ * * åˆ†æ•°çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¡¨ç¤ºæ•°å­—çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”å¯ä»¥æ˜¯doubleç±»åž‹çš„æµ®ç‚¹æ•°ã€‚ * * @param key * @param scoreMembers * @return è¿”å›žæ·»åŠ åˆ°æœ‰åºé›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œä¸åŒ…æ‹¬é‚£ç§å·²ç»å­˜åœ¨åªæ˜¯æ›´æ–°åˆ†æ•°çš„å…ƒç´ ã€‚ */ Long zadd(String key, Map&lt;String, Double&gt; scoreMembers); /** * è¿”å›žæœ‰åºé›†keyä¸­ï¼ŒæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚å…¶ä¸­æˆå‘˜æŒ‰scoreå€¼é€’å¢ž(ä»Žå°åˆ°å¤§)æ¥æŽ’åºã€‚å…·æœ‰ç›¸åŒscoreå€¼çš„æˆå‘˜æŒ‰å­—å…¸åºæ¥æŽ’åˆ—ã€‚ * * å¦‚æžœä½ éœ€è¦æˆå‘˜æŒ‰scoreå€¼é€’å‡(scoreç›¸ç­‰æ—¶æŒ‰å­—å…¸åºé€’å‡)æ¥æŽ’åˆ—ï¼Œè¯·ä½¿ç”¨ZREVRANGEå‘½ä»¤ã€‚ * ä¸‹æ ‡å‚æ•°startå’Œstopéƒ½ä»¥0ä¸ºåº•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥0è¡¨ç¤ºæœ‰åºé›†ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œä»¥1è¡¨ç¤ºæœ‰åºé›†ç¬¬äºŒä¸ªæˆå‘˜ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ * ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è´Ÿæ•°ä¸‹æ ‡ï¼Œä»¥-1è¡¨ç¤ºæœ€åŽä¸€ä¸ªæˆå‘˜ï¼Œ-2è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªæˆå‘˜ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ * * è¶…å‡ºèŒƒå›´çš„ä¸‹æ ‡å¹¶ä¸ä¼šå¼•èµ·é”™è¯¯ã€‚å¦‚æžœstartçš„å€¼æ¯”æœ‰åºé›†çš„æœ€å¤§ä¸‹æ ‡è¿˜è¦å¤§ï¼Œæˆ–æ˜¯start &gt; * stopæ—¶ï¼ŒZRANGEå‘½ä»¤åªæ˜¯ç®€å•åœ°è¿”å›žä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ * å¦ä¸€æ–¹é¢ï¼Œå‡å¦‚stopå‚æ•°çš„å€¼æ¯”æœ‰åºé›†çš„æœ€å¤§ä¸‹æ ‡è¿˜è¦å¤§ï¼Œé‚£ä¹ˆRediså°†stopå½“ä½œæœ€å¤§ä¸‹æ ‡æ¥å¤„ç†ã€‚ * * @param key * @param start * @param end * @return æŒ‡å®šèŒƒå›´çš„å…ƒç´ åˆ—è¡¨ */ Set&lt;String&gt; zrange(String key, long start, long end); /** * ä»Žé›†åˆä¸­åˆ é™¤æŒ‡å®šmemberå…ƒç´ ï¼Œå½“keyå­˜åœ¨ï¼Œä½†æ˜¯å…¶ä¸æ˜¯æœ‰åºé›†åˆç±»åž‹ï¼Œå°±è¿”å›žä¸€ä¸ªé”™è¯¯ã€‚ * * @param key * @param member * @return è¿”å›žçš„æ˜¯ä»Žæœ‰åºé›†åˆä¸­åˆ é™¤çš„æˆå‘˜ä¸ªæ•°ï¼Œä¸åŒ…æ‹¬ä¸å­˜åœ¨çš„æˆå‘˜ã€‚ */ Long zrem(String key, String... member); /** * ä¸ºæœ‰åºé›†keyçš„æˆå‘˜memberçš„scoreå€¼åŠ ä¸Šå¢žé‡incrementã€‚å¦‚æžœkeyä¸­ä¸å­˜åœ¨memberï¼Œå°±åœ¨keyä¸­æ·»åŠ ä¸€ä¸ªmemberï¼Œ * scoreæ˜¯incrementï¼ˆå°±å¥½åƒå®ƒä¹‹å‰çš„scoreæ˜¯0.0ï¼‰ã€‚å¦‚æžœkeyä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºä¸€ä¸ªåªå«æœ‰æŒ‡å®šmemberæˆå‘˜çš„æœ‰åºé›†åˆã€‚ * * å½“keyä¸æ˜¯æœ‰åºé›†ç±»åž‹æ—¶ï¼Œè¿”å›žä¸€ä¸ªé”™è¯¯ã€‚ * * scoreå€¼å¿…é¡»æ•´æ•°å€¼æˆ–åŒç²¾åº¦æµ®ç‚¹æ•°ã€‚ä¹Ÿæœ‰å¯èƒ½ç»™ä¸€ä¸ªè´Ÿæ•°æ¥å‡å°‘scoreçš„å€¼ã€‚ * * @param key * @param score * @param member * @return memberæˆå‘˜çš„æ–°scoreå€¼. */ Double zincrby(String key, double score, String member); /** * è¿”å›žæœ‰åºé›†keyä¸­æˆå‘˜memberçš„æŽ’åã€‚å…¶ä¸­æœ‰åºé›†æˆå‘˜æŒ‰scoreå€¼é€’å¢ž(ä»Žå°åˆ°å¤§)é¡ºåºæŽ’åˆ—ã€‚æŽ’åä»¥0ä¸ºåº•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ * scoreå€¼æœ€å°çš„æˆå‘˜æŽ’åä¸º0ã€‚ * * ä½¿ç”¨ZREVRANKå‘½ä»¤å¯ä»¥èŽ·å¾—æˆå‘˜æŒ‰scoreå€¼é€’å‡(ä»Žå¤§åˆ°å°)æŽ’åˆ—çš„æŽ’åã€‚ * * @param key * @param member * @return å¦‚æžœmemberæ˜¯æœ‰åºé›†keyçš„æˆå‘˜ï¼Œè¿”å›žmemberçš„æŽ’åçš„æ•´æ•°ã€‚ å¦‚æžœmemberä¸æ˜¯æœ‰åºé›†keyçš„æˆå‘˜ï¼Œè¿”å›ž nilã€‚ */ Long zrank(String key, String member); /** * è¿”å›žæœ‰åºé›†keyä¸­æˆå‘˜memberçš„æŽ’åï¼Œå…¶ä¸­æœ‰åºé›†æˆå‘˜æŒ‰scoreå€¼ä»Žå¤§åˆ°å°æŽ’åˆ—ã€‚æŽ’åä»¥0ä¸ºåº•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œscoreå€¼æœ€å¤§çš„æˆå‘˜æŽ’åä¸º0ã€‚ * * ä½¿ç”¨ZRANKå‘½ä»¤å¯ä»¥èŽ·å¾—æˆå‘˜æŒ‰scoreå€¼é€’å¢ž(ä»Žå°åˆ°å¤§)æŽ’åˆ—çš„æŽ’åã€‚ * * @param key * @param member * @return å¦‚æžœmemberæ˜¯æœ‰åºé›†keyçš„æˆå‘˜ï¼Œè¿”å›žmemberçš„æŽ’åã€‚æ•´åž‹æ•°å­—ã€‚ å¦‚æžœmemberä¸æ˜¯æœ‰åºé›†keyçš„æˆå‘˜ï¼Œè¿”å›žBulk * reply: nil. */ Long zrevrank(String key, String member); /** * è¿”å›žæœ‰åºé›†keyä¸­ï¼ŒæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚å…¶ä¸­æˆå‘˜çš„ä½ç½®æŒ‰scoreå€¼é€’å‡(ä»Žå¤§åˆ°å°)æ¥æŽ’åˆ—ã€‚å…·æœ‰ç›¸åŒscoreå€¼çš„æˆå‘˜æŒ‰å­—å…¸åºçš„ååºæŽ’åˆ—ã€‚ * é™¤äº†æˆå‘˜æŒ‰scoreå€¼é€’å‡çš„æ¬¡åºæŽ’åˆ—è¿™ä¸€ç‚¹å¤–ï¼ŒZREVRANGEå‘½ä»¤çš„å…¶ä»–æ–¹é¢å’ŒZRANGEå‘½ä»¤ä¸€æ ·ã€‚ * * @param key * @param start * @param end * @return æŒ‡å®šèŒƒå›´çš„å…ƒç´ åˆ—è¡¨(å¯é€‰æ˜¯å¦å«æœ‰åˆ†æ•°)ã€‚ */ Set&lt;String&gt; zrevrange(String key, long start, long end); /** * è¿”å›žæœ‰åºé›†keyä¸­ï¼ŒæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚å…¶ä¸­æˆå‘˜æŒ‰scoreå€¼é€’å¢ž(ä»Žå°åˆ°å¤§)æ¥æŽ’åºã€‚å…·æœ‰ç›¸åŒscoreå€¼çš„æˆå‘˜æŒ‰å­—å…¸åºæ¥æŽ’åˆ—ã€‚ * * å¦‚æžœä½ éœ€è¦æˆå‘˜æŒ‰scoreå€¼é€’å‡(scoreç›¸ç­‰æ—¶æŒ‰å­—å…¸åºé€’å‡)æ¥æŽ’åˆ—ï¼Œè¯·ä½¿ç”¨ZREVRANGEå‘½ä»¤ã€‚ * ä¸‹æ ‡å‚æ•°startå’Œstopéƒ½ä»¥0ä¸ºåº•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥0è¡¨ç¤ºæœ‰åºé›†ç¬¬ä¸€ä¸ªæˆå‘˜ï¼Œä»¥1è¡¨ç¤ºæœ‰åºé›†ç¬¬äºŒä¸ªæˆå‘˜ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ * ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è´Ÿæ•°ä¸‹æ ‡ï¼Œä»¥-1è¡¨ç¤ºæœ€åŽä¸€ä¸ªæˆå‘˜ï¼Œ-2è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªæˆå‘˜ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ * * è¶…å‡ºèŒƒå›´çš„ä¸‹æ ‡å¹¶ä¸ä¼šå¼•èµ·é”™è¯¯ã€‚å¦‚æžœstartçš„å€¼æ¯”æœ‰åºé›†çš„æœ€å¤§ä¸‹æ ‡è¿˜è¦å¤§ï¼Œæˆ–æ˜¯start &gt; * stopæ—¶ï¼ŒZRANGEå‘½ä»¤åªæ˜¯ç®€å•åœ°è¿”å›žä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ * å¦ä¸€æ–¹é¢ï¼Œå‡å¦‚stopå‚æ•°çš„å€¼æ¯”æœ‰åºé›†çš„æœ€å¤§ä¸‹æ ‡è¿˜è¦å¤§ï¼Œé‚£ä¹ˆRediså°†stopå½“ä½œæœ€å¤§ä¸‹æ ‡æ¥å¤„ç†ã€‚ * * ä½¿ç”¨WITHSCORESé€‰é¡¹ï¼Œæ¥è®©æˆå‘˜å’Œå®ƒçš„scoreå€¼ä¸€å¹¶è¿”å›žï¼Œè¿”å›žåˆ—è¡¨ä»¥value1,score1, ..., * valueN,scoreNçš„æ ¼å¼è¡¨ç¤ºï¼Œè€Œä¸æ˜¯value1,...,valueNã€‚å®¢æˆ·ç«¯åº“å¯èƒ½ä¼šè¿”å›žä¸€äº›æ›´å¤æ‚çš„æ•°æ®ç±»åž‹ï¼Œæ¯”å¦‚æ•°ç»„ã€å…ƒç»„ç­‰ã€‚ * * @param key * @param start * @param end * @return æŒ‡å®šèŒƒå›´çš„å…ƒç´ åˆ—è¡¨(ä»¥å…ƒç»„é›†åˆçš„å½¢å¼)ã€‚ */ Set&lt;Tuple&gt; zrangeWithScores(String key, long start, long end); /** * è¿”å›žæœ‰åºé›†keyä¸­ï¼ŒæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚å…¶ä¸­æˆå‘˜çš„ä½ç½®æŒ‰scoreå€¼é€’å‡(ä»Žå¤§åˆ°å°)æ¥æŽ’åˆ—ã€‚å…·æœ‰ç›¸åŒscoreå€¼çš„æˆå‘˜æŒ‰å­—å…¸åºçš„ååºæŽ’åˆ—ã€‚ * é™¤äº†æˆå‘˜æŒ‰scoreå€¼é€’å‡çš„æ¬¡åºæŽ’åˆ—è¿™ä¸€ç‚¹å¤–ï¼ŒZREVRANGEå‘½ä»¤çš„å…¶ä»–æ–¹é¢å’ŒZRANGEå‘½ä»¤ä¸€æ ·ã€‚ * * @param key * @param start * @param end * @return æŒ‡å®šèŒƒå›´çš„å…ƒç´ åˆ—è¡¨(å¯é€‰æ˜¯å¦å«æœ‰åˆ†æ•°)ã€‚ */ Set&lt;Tuple&gt; zrevrangeWithScores(String key, long start, long end); /** * è¿”å›žkeyçš„æœ‰åºé›†å…ƒç´ ä¸ªæ•°ã€‚ * * @param key * @return keyå­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å›žæœ‰åºé›†çš„å…ƒç´ ä¸ªæ•°ï¼Œå¦åˆ™è¿”å›ž0ã€‚ */ Long zcard(String key); /** * è¿”å›žæœ‰åºé›†keyä¸­ï¼Œæˆå‘˜memberçš„scoreå€¼ã€‚ * * å¦‚æžœmemberå…ƒç´ ä¸æ˜¯æœ‰åºé›†keyçš„æˆå‘˜ï¼Œæˆ–keyä¸å­˜åœ¨ï¼Œè¿”å›žnilã€‚ * * @param key * @param member * @return memberæˆå‘˜çš„scoreå€¼ï¼ˆdoubleåž‹æµ®ç‚¹æ•°ï¼‰ */ Double zscore(String key, String member); /** * å¯¹ä¸€ä¸ªé›†åˆæˆ–è€…ä¸€ä¸ªåˆ—è¡¨æŽ’åº * * å¯¹é›†åˆï¼Œæœ‰åºé›†åˆï¼Œæˆ–è€…åˆ—è¡¨çš„valueè¿›è¡ŒæŽ’åºã€‚é»˜è®¤æƒ…å†µä¸‹æŽ’åºåªå¯¹æ•°å­—æŽ’åºï¼ŒåŒç²¾åº¦æµ®ç‚¹æ•°ã€‚ * * @see #sort(String, String) * @see #sort(String, SortingParams) * @see #sort(String, SortingParams, String) * @param key * @return å‡è®¾é›†åˆæˆ–åˆ—è¡¨åŒ…å«çš„æ˜¯æ•°å­—å…ƒç´ ï¼Œé‚£ä¹ˆè¿”å›žçš„å°†ä¼šæ˜¯ä»Žå°åˆ°å¤§æŽ’åˆ—çš„ä¸€ä¸ªåˆ—è¡¨ã€‚ */ List&lt;String&gt; sort(String key); /** * æ ¹æ®æŒ‡å®šå‚æ•°æ¥å¯¹åˆ—è¡¨æˆ–é›†åˆè¿›è¡ŒæŽ’åº. * &lt;p&gt; * &lt;b&gt;examples:&lt;/b&gt; * &lt;p&gt; * ä¸€ä¸‹æ˜¯ä¸€äº›ä¾‹å­åˆ—è¡¨æˆ–è€…key-value: * * &lt;pre&gt; * x = [1, 2, 3] * y = [a, b, c] * * k1 = z * k2 = y * k3 = x * * w1 = 9 * w2 = 8 * w3 = 7 * &lt;/pre&gt; * * æŽ’åº: * * &lt;pre&gt; * sort(x) or sort(x, sp.asc()) * -&gt; [1, 2, 3] * * sort(x, sp.desc()) * -&gt; [3, 2, 1] * * sort(y) * -&gt; [c, a, b] * * sort(y, sp.alpha()) * -&gt; [a, b, c] * * sort(y, sp.alpha().desc()) * -&gt; [c, b, a] * &lt;/pre&gt; * * Limit (e.g. for Pagination): * * &lt;pre&gt; * sort(x, sp.limit(0, 2)) * -&gt; [1, 2] * * sort(y, sp.alpha().desc().limit(1, 2)) * -&gt; [b, a] * &lt;/pre&gt; * * ä½¿ç”¨å¤–éƒ¨é”®æ¥æŽ’åº: * * &lt;pre&gt; * sort(x, sb.by(w*)) * -&gt; [3, 2, 1] * * sort(x, sb.by(w*).desc()) * -&gt; [1, 2, 3] * &lt;/pre&gt; * * Getting external keys: * * &lt;pre&gt; * sort(x, sp.by(w*).get(k*)) * -&gt; [x, y, z] * * sort(x, sp.by(w*).get(#).get(k*)) * -&gt; [3, x, 2, y, 1, z] * &lt;/pre&gt; * * @see #sort(String) * @see #sort(String, SortingParams, String) * @param key * @param sortingParameters * @return a list of sorted elements. */ List&lt;String&gt; sort(String key, SortingParams sortingParameters); /** * è¿”å›žæœ‰åºé›†keyä¸­ï¼Œscoreå€¼åœ¨minå’Œmaxä¹‹é—´(é»˜è®¤åŒ…æ‹¬scoreå€¼ç­‰äºŽminæˆ–max)çš„æˆå‘˜ã€‚ * * @param key * @param min * @param max * @return æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ ä¸ªæ•°ã€‚ */ Long zcount(String key, double min, double max); /** * è¿”å›žæœ‰åºé›†keyä¸­ï¼Œscoreå€¼åœ¨minå’Œmaxä¹‹é—´(é»˜è®¤åŒ…æ‹¬scoreå€¼ç­‰äºŽminæˆ–max)çš„æˆå‘˜ã€‚ * * @param key * @param min * @param max * @return æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ ä¸ªæ•°ã€‚ */ Long zcount(String key, String min, String max); /** * è¿”å›žkeyçš„æœ‰åºé›†åˆä¸­çš„åˆ†æ•°åœ¨minå’Œmaxä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬åˆ†æ•°ç­‰äºŽmaxæˆ–è€…minçš„å…ƒç´ ï¼‰ã€‚å…ƒç´ è¢«è®¤ä¸ºæ˜¯ä»Žä½Žåˆ†åˆ°é«˜åˆ†æŽ’åºçš„ã€‚ * å…·æœ‰ç›¸åŒåˆ†æ•°çš„å…ƒç´ æŒ‰å­—å…¸åºæŽ’åˆ— * * @param key * @param min * @param max * @return æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ åˆ—è¡¨ */ Set&lt;String&gt; zrangeByScore(String key, double min, double max); /** * è¿”å›žkeyçš„æœ‰åºé›†åˆä¸­çš„åˆ†æ•°åœ¨minå’Œmaxä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬åˆ†æ•°ç­‰äºŽmaxæˆ–è€…minçš„å…ƒç´ ï¼‰ã€‚å…ƒç´ è¢«è®¤ä¸ºæ˜¯ä»Žä½Žåˆ†åˆ°é«˜åˆ†æŽ’åºçš„ã€‚ * å…·æœ‰ç›¸åŒåˆ†æ•°çš„å…ƒç´ æŒ‰å­—å…¸åºæŽ’åˆ— * * @param key * @param min * @param max * @return æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ åˆ—è¡¨ */ Set&lt;String&gt; zrangeByScore(String key, String min, String max); /** * è¿”å›žkeyçš„æœ‰åºé›†åˆä¸­çš„åˆ†æ•°åœ¨minå’Œmaxä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬åˆ†æ•°ç­‰äºŽmaxæˆ–è€…minçš„å…ƒç´ ï¼‰ã€‚å…ƒç´ è¢«è®¤ä¸ºæ˜¯ä»Žä½Žåˆ†åˆ°é«˜åˆ†æŽ’åºçš„ã€‚ * å…·æœ‰ç›¸åŒåˆ†æ•°çš„å…ƒç´ æŒ‰å­—å…¸åºæŽ’åˆ—, æŒ‡å®šè¿”å›žç»“æžœçš„æ•°é‡åŠåŒºé—´ã€‚ * * @param key * @param min * @param max * @param offset * @param count * @return æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ åˆ—è¡¨ */ Set&lt;String&gt; zrangeByScore(String key, double min, double max, int offset, int count); /** * è¿”å›žkeyçš„æœ‰åºé›†åˆä¸­çš„åˆ†æ•°åœ¨minå’Œmaxä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬åˆ†æ•°ç­‰äºŽmaxæˆ–è€…minçš„å…ƒç´ ï¼‰ã€‚å…ƒç´ è¢«è®¤ä¸ºæ˜¯ä»Žä½Žåˆ†åˆ°é«˜åˆ†æŽ’åºçš„ã€‚ * å…·æœ‰ç›¸åŒåˆ†æ•°çš„å…ƒç´ æŒ‰å­—å…¸åºæŽ’åˆ—, æŒ‡å®šè¿”å›žç»“æžœçš„æ•°é‡åŠåŒºé—´ã€‚ * * @param key * @param min * @param max * @param offset * @param count * @return æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ åˆ—è¡¨ */ Set&lt;String&gt; zrangeByScore(String key, String min, String max, int offset, int count); /** * è¿”å›žkeyçš„æœ‰åºé›†åˆä¸­çš„åˆ†æ•°åœ¨minå’Œmaxä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬åˆ†æ•°ç­‰äºŽmaxæˆ–è€…minçš„å…ƒç´ ï¼‰ã€‚å…ƒç´ è¢«è®¤ä¸ºæ˜¯ä»Žä½Žåˆ†åˆ°é«˜åˆ†æŽ’åºçš„ã€‚ * å…·æœ‰ç›¸åŒåˆ†æ•°çš„å…ƒç´ æŒ‰å­—å…¸åºæŽ’åˆ—ã€‚è¿”å›žå…ƒç´ å’Œå…¶åˆ†æ•°ï¼Œè€Œä¸åªæ˜¯å…ƒç´ ã€‚ * * @param key * @param min * @param max * @return */ Set&lt;Tuple&gt; zrangeByScoreWithScores(String key, double min, double max); /** * è¿”å›žkeyçš„æœ‰åºé›†åˆä¸­çš„åˆ†æ•°åœ¨minå’Œmaxä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬åˆ†æ•°ç­‰äºŽmaxæˆ–è€…minçš„å…ƒç´ ï¼‰ã€‚å…ƒç´ è¢«è®¤ä¸ºæ˜¯ä»Žä½Žåˆ†åˆ°é«˜åˆ†æŽ’åºçš„ã€‚ * å…·æœ‰ç›¸åŒåˆ†æ•°çš„å…ƒç´ æŒ‰å­—å…¸åºæŽ’åˆ—, æŒ‡å®šè¿”å›žç»“æžœçš„æ•°é‡åŠåŒºé—´ã€‚ è¿”å›žå…ƒç´ å’Œå…¶åˆ†æ•°ï¼Œè€Œä¸åªæ˜¯å…ƒç´ ã€‚ * * @param key * @param min * @param max * @param offset * @param count * @return */ Set&lt;Tuple&gt; zrangeByScoreWithScores(String key, double min, double max, int offset, int count); /** * è¿”å›žkeyçš„æœ‰åºé›†åˆä¸­çš„åˆ†æ•°åœ¨minå’Œmaxä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬åˆ†æ•°ç­‰äºŽmaxæˆ–è€…minçš„å…ƒç´ ï¼‰ã€‚å…ƒç´ è¢«è®¤ä¸ºæ˜¯ä»Žä½Žåˆ†åˆ°é«˜åˆ†æŽ’åºçš„ã€‚ * å…·æœ‰ç›¸åŒåˆ†æ•°çš„å…ƒç´ æŒ‰å­—å…¸åºæŽ’åˆ—ã€‚è¿”å›žå…ƒç´ å’Œå…¶åˆ†æ•°ï¼Œè€Œä¸åªæ˜¯å…ƒç´ ã€‚ * * @param key * @param min * @param max * @return */ Set&lt;Tuple&gt; zrangeByScoreWithScores(String key, String min, String max); /** * è¿”å›žkeyçš„æœ‰åºé›†åˆä¸­çš„åˆ†æ•°åœ¨minå’Œmaxä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…æ‹¬åˆ†æ•°ç­‰äºŽmaxæˆ–è€…minçš„å…ƒç´ ï¼‰ã€‚å…ƒç´ è¢«è®¤ä¸ºæ˜¯ä»Žä½Žåˆ†åˆ°é«˜åˆ†æŽ’åºçš„ã€‚ * å…·æœ‰ç›¸åŒåˆ†æ•°çš„å…ƒç´ æŒ‰å­—å…¸åºæŽ’åˆ—, æŒ‡å®šè¿”å›žç»“æžœçš„æ•°é‡åŠåŒºé—´ã€‚ è¿”å›žå…ƒç´ å’Œå…¶åˆ†æ•°ï¼Œè€Œä¸åªæ˜¯å…ƒç´ ã€‚ * * @param key * @param min * @param max * @param offset * @param count * @return */ Set&lt;Tuple&gt; zrangeByScoreWithScores(String key, String min, String max, int offset, int count); /** * æœºåˆ¶ä¸ŽzrangeByScoreä¸€æ ·ï¼Œåªæ˜¯è¿”å›žç»“æžœä¸ºé™åºæŽ’åºã€‚ * * @param key * @param max * @param min * @return */ Set&lt;String&gt; zrevrangeByScore(String key, double max, double min); /** * æœºåˆ¶ä¸ŽzrangeByScoreä¸€æ ·ï¼Œåªæ˜¯è¿”å›žç»“æžœä¸ºé™åºæŽ’åºã€‚ * * @param key * @param max * @param min * @return */ Set&lt;String&gt; zrevrangeByScore(String key, String max, String min); /** * æœºåˆ¶ä¸ŽzrangeByScoreä¸€æ ·ï¼Œåªæ˜¯è¿”å›žç»“æžœä¸ºé™åºæŽ’åºã€‚ * * @param key * @param max * @param min * @param offset * @param count * @return */ Set&lt;String&gt; zrevrangeByScore(String key, double max, double min, int offset, int count); /** * æœºåˆ¶ä¸ŽzrangeByScoreWithScoresä¸€æ ·ï¼Œåªæ˜¯è¿”å›žç»“æžœä¸ºé™åºæŽ’åºã€‚ * * @param key * @param max * @param min * @return */ Set&lt;Tuple&gt; zrevrangeByScoreWithScores(String key, double max, double min); /** * æœºåˆ¶ä¸ŽzrangeByScoreä¸€æ ·ï¼Œåªæ˜¯è¿”å›žç»“æžœä¸ºé™åºæŽ’åºã€‚ * * @param key * @param max * @param min * @param offset * @param count * @return */ Set&lt;String&gt; zrevrangeByScore(String key, String max, String min, int offset, int count); /** * æœºåˆ¶ä¸ŽzrangeByScoreWithScoresä¸€æ ·ï¼Œåªæ˜¯è¿”å›žç»“æžœä¸ºé™åºæŽ’åºã€‚ * * @param key * @param max * @param min * @return */ Set&lt;Tuple&gt; zrevrangeByScoreWithScores(String key, String max, String min); /** * æœºåˆ¶ä¸ŽzrangeByScoreWithScoresä¸€æ ·ï¼Œåªæ˜¯è¿”å›žç»“æžœä¸ºé™åºæŽ’åºã€‚ * * @param key * @param max * @param min * @param offset * @param count * @return */ Set&lt;Tuple&gt; zrevrangeByScoreWithScores(String key, double max, double min, int offset, int count); /** * æœºåˆ¶ä¸ŽzrangeByScoreWithScoresä¸€æ ·ï¼Œåªæ˜¯è¿”å›žç»“æžœä¸ºé™åºæŽ’åºã€‚ * * @param key * @param max * @param min * @param offset * @param count * @return */ Set&lt;Tuple&gt; zrevrangeByScoreWithScores(String key, String max, String min, int offset, int count); /** * ç§»é™¤æœ‰åºé›†keyä¸­ï¼ŒæŒ‡å®šæŽ’å(rank)åŒºé—´å†…çš„æ‰€æœ‰æˆå‘˜ã€‚ä¸‹æ ‡å‚æ•°startå’Œstopéƒ½ä»¥0ä¸ºåº•ï¼Œ0å¤„æ˜¯åˆ†æ•°æœ€å°çš„é‚£ä¸ªå…ƒç´ ã€‚è¿™äº›ç´¢å¼•ä¹Ÿå¯æ˜¯è´Ÿæ•°ï¼Œ * è¡¨ç¤ºä½ç§»ä»Žæœ€é«˜åˆ†å¤„å¼€å§‹æ•°ã€‚ä¾‹å¦‚ï¼Œ-1æ˜¯åˆ†æ•°æœ€é«˜çš„å…ƒç´ ï¼Œ-2æ˜¯åˆ†æ•°ç¬¬äºŒé«˜çš„ï¼Œä¾æ¬¡ç±»æŽ¨ã€‚ * * @param key * @param start * @param end * @return è¢«ç§»é™¤æˆå‘˜çš„æ•°é‡ã€‚ */ Long zremrangeByRank(String key, long start, long end); /** * ç§»é™¤æœ‰åºé›†keyä¸­ï¼Œæ‰€æœ‰scoreå€¼ä»‹äºŽminå’Œmaxä¹‹é—´(åŒ…æ‹¬ç­‰äºŽminæˆ–max)çš„æˆå‘˜ã€‚ * * è‡ªç‰ˆæœ¬2.1.6å¼€å§‹ï¼Œscoreå€¼ç­‰äºŽminæˆ–maxçš„æˆå‘˜ä¹Ÿå¯ä»¥ä¸åŒ…æ‹¬åœ¨å†…ï¼Œè¯­æ³•è¯·å‚è§ZRANGEBYSCOREå‘½ä»¤ã€‚ * * @param key * @param start * @param end * @return åˆ é™¤çš„å…ƒç´ çš„ä¸ªæ•° */ Long zremrangeByScore(String key, double start, double end); /** * ç§»é™¤æœ‰åºé›†keyä¸­ï¼Œæ‰€æœ‰scoreå€¼ä»‹äºŽminå’Œmaxä¹‹é—´(åŒ…æ‹¬ç­‰äºŽminæˆ–max)çš„æˆå‘˜ã€‚ * * è‡ªç‰ˆæœ¬2.1.6å¼€å§‹ï¼Œscoreå€¼ç­‰äºŽminæˆ–maxçš„æˆå‘˜ä¹Ÿå¯ä»¥ä¸åŒ…æ‹¬åœ¨å†…ï¼Œè¯­æ³•è¯·å‚è§ZRANGEBYSCOREå‘½ä»¤ã€‚ * * @param key * @param start * @param end * @return åˆ é™¤çš„å…ƒç´ çš„ä¸ªæ•° */ Long zremrangeByScore(String key, String start, String end); /** * å½“æ’å…¥åˆ°æœ‰åºé›†åˆä¸­çš„å…ƒç´ éƒ½å…·æœ‰ç›¸åŒçš„åˆ†æ•°æ—¶ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥è¿”å›žminå’ŒmaxæŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ çš„æ•°é‡ã€‚ * * @param key * @param min * @param max * @return */ Long zlexcount(final String key, final String min, final String max); /** * æŠŠ value æ’å…¥å­˜äºŽ key çš„åˆ—è¡¨ä¸­åœ¨åŸºå‡†å€¼ pivot çš„å‰é¢æˆ–åŽé¢ã€‚ * * å½“ key ä¸å­˜åœ¨æ—¶ï¼Œè¿™ä¸ªlistä¼šè¢«çœ‹ä½œæ˜¯ç©ºlistï¼Œä»»ä½•æ“ä½œéƒ½ä¸ä¼šå‘ç”Ÿã€‚ * * å½“ key å­˜åœ¨ï¼Œä½†ä¿å­˜çš„ä¸æ˜¯ä¸€ä¸ªlistçš„æ—¶å€™ï¼Œä¼šè¿”å›žerrorã€‚ * * @param key * @param where * @param pivot å‰æˆ–åŽ * @param value * @return åœ¨ insert æ“ä½œåŽçš„ list é•¿åº¦ã€‚ */ Long linsert(String key, Client.LIST_POSITION where, String pivot, String value); /** * åªæœ‰å½“ key å·²ç»å­˜åœ¨å¹¶ä¸”å­˜ç€ä¸€ä¸ª list çš„æ—¶å€™ï¼Œåœ¨è¿™ä¸ª key ä¸‹é¢çš„ list çš„å¤´éƒ¨æ’å…¥ valueã€‚ ä¸Ž LPUSH ç›¸åï¼Œå½“ * key ä¸å­˜åœ¨çš„æ—¶å€™ä¸ä¼šè¿›è¡Œä»»ä½•æ“ä½œã€‚ * * @param key * @param string * @return åœ¨ push æ“ä½œåŽçš„ list é•¿åº¦ã€‚ */ Long lpushx(String key, String... string); /** * å°†å€¼ value æ’å…¥åˆ°åˆ—è¡¨ key çš„è¡¨å°¾, å½“ä¸”ä»…å½“ key å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚ å’Œ RPUSH å‘½ä»¤ç›¸å, å½“ key * ä¸å­˜åœ¨æ—¶ï¼ŒRPUSHX å‘½ä»¤ä»€ä¹ˆä¹Ÿä¸åšã€‚ * * @param key * @param string * @return åœ¨Pushæ“ä½œåŽListçš„é•¿åº¦ */ Long rpushx(String key, String... string); /** * @deprecated unusable command, this will be removed in 3.0.0. */ @Deprecated List&lt;String&gt; blpop(String arg); /** * BLPOP æ˜¯é˜»å¡žå¼åˆ—è¡¨çš„å¼¹å‡ºåŽŸè¯­ã€‚ å®ƒæ˜¯å‘½ä»¤ LPOP çš„é˜»å¡žç‰ˆæœ¬ï¼Œè¿™æ˜¯å› ä¸ºå½“ç»™å®šåˆ—è¡¨å†…æ²¡æœ‰ä»»ä½•å…ƒç´ å¯ä¾›å¼¹å‡ºçš„æ—¶å€™ï¼Œ è¿žæŽ¥å°†è¢« BLPOP * å‘½ä»¤é˜»å¡žã€‚ å½“ç»™å®šå¤šä¸ª key å‚æ•°æ—¶ï¼ŒæŒ‰å‚æ•° key çš„å…ˆåŽé¡ºåºä¾æ¬¡æ£€æŸ¥å„ä¸ªåˆ—è¡¨ï¼Œå¼¹å‡ºç¬¬ä¸€ä¸ªéžç©ºåˆ—è¡¨çš„å¤´å…ƒç´ ã€‚ &#123;@link http * ://www.redis.cn/commands/blpop.html&#125; * * @param timeout * @param key * @return */ List&lt;String&gt; blpop(int timeout, String key); /** * @deprecated unusable command, this will be removed in 3.0.0. */ @Deprecated List&lt;String&gt; brpop(String arg); /** * BRPOP æ˜¯ä¸€ä¸ªé˜»å¡žçš„åˆ—è¡¨å¼¹å‡ºåŽŸè¯­ã€‚ å®ƒæ˜¯ RPOP çš„é˜»å¡žç‰ˆæœ¬ï¼Œå› ä¸ºè¿™ä¸ªå‘½ä»¤ä¼šåœ¨ç»™å®šlistæ— æ³•å¼¹å‡ºä»»ä½•å…ƒç´ çš„æ—¶å€™é˜»å¡žè¿žæŽ¥ã€‚ * è¯¥å‘½ä»¤ä¼šæŒ‰ç…§ç»™å‡ºçš„ key é¡ºåºæŸ¥çœ‹ listï¼Œå¹¶åœ¨æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªéžç©º list çš„å°¾éƒ¨å¼¹å‡ºä¸€ä¸ªå…ƒç´ ã€‚ * * è¯·åœ¨ BLPOP æ–‡æ¡£ ä¸­æŸ¥çœ‹è¯¥å‘½ä»¤çš„å‡†ç¡®è¯­ä¹‰ï¼Œå› ä¸º BRPOP å’Œ BLPOP * åŸºæœ¬æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œé™¤äº†å®ƒä»¬ä¸€ä¸ªæ˜¯ä»Žå°¾éƒ¨å¼¹å‡ºå…ƒç´ ï¼Œè€Œå¦ä¸€ä¸ªæ˜¯ä»Žå¤´éƒ¨å¼¹å‡ºå…ƒç´ ã€‚ &#123;@link http * ://www.redis.cn/commands/brpop.html&#125; * * * @param timeout * @param key * @return */ List&lt;String&gt; brpop(int timeout, String key); /** * åˆ é™¤ä¸€ä¸ªKey,å¦‚æžœåˆ é™¤çš„keyä¸å­˜åœ¨ï¼Œåˆ™ç›´æŽ¥å¿½ç•¥ã€‚ * * @param key * @return è¢«åˆ é™¤çš„keysçš„æ•°é‡ */ Long del(String key); /** * å›žæ˜¾ * * @param string * @return å›žæ˜¾è¾“å…¥çš„å­—ç¬¦ä¸² */ String echo(String string); /** * å°†å½“å‰æ•°æ®åº“çš„ key ç§»åŠ¨åˆ°ç»™å®šçš„æ•°æ®åº“ db å½“ä¸­ã€‚ * * å¦‚æžœå½“å‰æ•°æ®åº“(æºæ•°æ®åº“)å’Œç»™å®šæ•°æ®åº“(ç›®æ ‡æ•°æ®åº“)æœ‰ç›¸åŒåå­—çš„ç»™å®š key ï¼Œæˆ–è€… key ä¸å­˜åœ¨äºŽå½“å‰æ•°æ®åº“ï¼Œé‚£ä¹ˆ MOVE æ²¡æœ‰ä»»ä½•æ•ˆæžœã€‚ * * å› æ­¤ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå°† MOVE å½“ä½œé”(locking)åŽŸè¯­(primitive)ã€‚ * * @param key * @param dbIndex * @return ç§»åŠ¨æˆåŠŸè¿”å›ž 1 å¤±è´¥åˆ™è¿”å›ž 0 */ Long move(String key, int dbIndex); /** * ç»Ÿè®¡å­—ç¬¦ä¸²çš„å­—èŠ‚æ•° * * @param key * @return å­—èŠ‚æ•° */ Long bitcount(final String key); /** * ç»Ÿè®¡å­—ç¬¦ä¸²æŒ‡å®šèµ·å§‹ä½ç½®çš„å­—èŠ‚æ•° * * @param key * @param start * @param end * @return */ Long bitcount(final String key, long start, long end); /** * è¿­ä»£hashé‡Œé¢çš„å…ƒç´  * * @param key * @param cursor * @return */ ScanResult&lt;Map.Entry&lt;String, String&gt;&gt; hscan(final String key, final String cursor); /** * è¿­ä»£seté‡Œé¢çš„å…ƒç´  * * @param key * @param cursor * @return */ ScanResult&lt;String&gt; sscan(final String key, final String cursor); /** * è¿­ä»£zseté‡Œé¢çš„å…ƒç´  * * @param key * @param cursor * @return */ ScanResult&lt;Tuple&gt; zscan(final String key, final String cursor);&#125;]]></content>
      <categories>
        <category>ç¼“å­˜</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[elastic-jobçš„åŽŸç†ç®€ä»‹å’Œä½¿ç”¨]]></title>
    <url>%2F2017%2F11%2F12%2Felastic-job%E7%9A%84%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B%E5%92%8C%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[elastic-jobæ˜¯å½“å½“å¼€æºçš„ä¸€æ¬¾éžå¸¸å¥½ç”¨çš„ä½œä¸šæ¡†æž¶ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å¼€å‘å®šæ—¶ä»»åŠ¡ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨quartzæˆ–è€…spring-taskï¼ˆScheduledExecutorServiceï¼‰ï¼Œæ— è®ºæ˜¯ä½¿ç”¨quartzè¿˜æ˜¯spring-taskï¼Œæˆ‘ä»¬éƒ½ä¼šè‡³å°‘é‡åˆ°ä¸¤ä¸ªç—›ç‚¹ï¼š 1.ä¸æ•¢è½»æ˜“è·Ÿç€åº”ç”¨æœåŠ¡å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œå¯èƒ½ä¼šé‡å¤å¤šæ¬¡æ‰§è¡Œè€Œå¼•å‘ç³»ç»Ÿé€»è¾‘çš„é”™è¯¯ã€‚ 2.quartzçš„é›†ç¾¤ä»…ä»…åªæ˜¯ç”¨æ¥HAï¼ŒèŠ‚ç‚¹æ•°é‡çš„å¢žåŠ å¹¶ä¸èƒ½ç»™æˆ‘ä»¬çš„æ¯æ¬¡æ‰§è¡Œæ•ˆçŽ‡å¸¦æ¥æå‡ï¼Œå³ä¸èƒ½å®žçŽ°æ°´å¹³æ‰©å±•ã€‚ æœ¬ç¯‡åšæ–‡å°†ä¼šè‡ªé¡¶å‘ä¸‹åœ°ä»‹ç»elastic-jobï¼Œè®©å¤§å®¶è®¤è¯†äº†è§£å¹¶ä¸”å¿«é€Ÿæ­å»ºèµ·çŽ¯å¢ƒã€‚ elastic-jobäº§å“çº¿è¯´æ˜Želastic-jobåœ¨2.xä¹‹åŽï¼Œå‡ºäº†ä¸¤ä¸ªäº§å“çº¿ï¼šElastic-Job-Liteå’ŒElastic-Job-Cloudã€‚æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨Elastic-Job-Liteå°±èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ï¼Œæœ¬æ–‡ä¹Ÿæ˜¯ä»¥Elastic-Job-Liteä¸ºä¸»ã€‚1.xç³»åˆ—å¯¹åº”çš„å°±åªæœ‰Elastic-Job-Liteï¼Œå¹¶ä¸”åœ¨2.xé‡Œä¿®æ”¹äº†ä¸€äº›æ ¸å¿ƒç±»åï¼Œå·®åˆ«è™½å¤§ï¼ŒåŽŸç†ç±»ä¼¼ï¼Œå»ºè®®ä½¿ç”¨2.xç³»åˆ—ã€‚å†™æ­¤åšæ–‡ï¼Œæœ€æ–°releaseç‰ˆæœ¬ä¸º2.0.5ã€‚ elastic-job-liteåŽŸç†ä¸¾ä¸ªå…¸åž‹çš„jobåœºæ™¯ï¼Œæ¯”å¦‚ä½™é¢å®é‡Œçš„æ˜¨æ—¥æ”¶ç›Šï¼Œç³»ç»Ÿéœ€è¦jobåœ¨æ¯å¤©æŸä¸ªæ—¶é—´ç‚¹å¼€å§‹ï¼Œç»™æ‰€æœ‰ä½™é¢å®ç”¨æˆ·è®¡ç®—æ”¶ç›Šã€‚å¦‚æžœç”¨æˆ·æ•°é‡ä¸å¤šï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“ä½¿ç”¨quartzæ¥å®Œæˆï¼Œæˆ‘ä»¬è®©è®¡æ¯jobåœ¨æŸä¸ªæ—¶é—´ç‚¹å¼€å§‹æ‰§è¡Œï¼Œå¾ªçŽ¯éåŽ†æ‰€æœ‰ç”¨æˆ·è®¡ç®—åˆ©æ¯ï¼Œè¿™æ²¡é—®é¢˜ã€‚å¯æ˜¯ï¼Œå¦‚æžœç”¨æˆ·ä½“é‡ç‰¹åˆ«å¤§ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé¢ä¸´ç€åœ¨ç¬¬äºŒå¤©ä¹‹å‰å¤„ç†ä¸å®Œè¿™ä¹ˆå¤šç”¨æˆ·ã€‚å¦å¤–ï¼Œæˆ‘ä»¬éƒ¨ç½²jobçš„æ—¶å€™ä¹Ÿå¾—æ³¨æ„ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæŠŠjobç›´æŽ¥æ”¾åœ¨æˆ‘ä»¬çš„webappé‡Œï¼Œwebappé€šå¸¸æ˜¯å¤šèŠ‚ç‚¹éƒ¨ç½²çš„ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬çš„jobä¹Ÿå°±æ˜¯å¤šèŠ‚ç‚¹ï¼Œå¤šä¸ªjobåŒæ—¶æ‰§è¡Œï¼Œå¾ˆå®¹æ˜“é€ æˆé‡å¤æ‰§è¡Œï¼Œæ¯”å¦‚ç”¨æˆ·é‡å¤è®¡æ¯ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¯¹jobçš„æ‰§è¡ŒåŠ é”ï¼Œä¿è¯å§‹ç»ˆåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹èƒ½æ‰§è¡Œï¼Œæˆ–è€…å¹²è„†è®©jobä»Žwebappé‡Œå‰¥ç¦»å‡ºæ¥ï¼Œç‹¬è‡ªéƒ¨ç½²ä¸€ä¸ªèŠ‚ç‚¹ã€‚elastic-jobå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œelasticåº•å±‚çš„ä»»åŠ¡è°ƒåº¦è¿˜æ˜¯ä½¿ç”¨çš„quartzï¼Œé€šè¿‡zookeeperæ¥åŠ¨æ€ç»™jobèŠ‚ç‚¹åˆ†ç‰‡ã€‚æˆ‘ä»¬æ¥çœ‹ï¼šå¾ˆå¤§ä½“é‡çš„ç”¨æˆ·éœ€è¦åœ¨ç‰¹å®šçš„æ—¶é—´æ®µå†…è®¡æ¯å®Œæˆæˆ‘ä»¬è‚¯å®šæ˜¯å¸Œæœ›æˆ‘ä»¬çš„ä»»åŠ¡å¯ä»¥é€šè¿‡é›†ç¾¤è¾¾åˆ°æ°´å¹³æ‰©å±•ï¼Œé›†ç¾¤é‡Œçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¤„ç†éƒ¨åˆ†ç”¨æˆ·ï¼Œä¸ç®¡ç”¨æˆ·æ•°é‡æœ‰å¤šåºžå¤§ï¼Œæˆ‘ä»¬åªè¦å¢žåŠ æœºå™¨å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚å•å°æœºå™¨ç‰¹å®šæ—¶é—´èƒ½å¤„ç†nä¸ªç”¨æˆ·ï¼Œ2å°æœºå™¨å¤„ç†2nä¸ªç”¨æˆ·ï¼Œ3å°3nï¼Œ4å°4nâ€¦ï¼Œå†å¤šçš„ç”¨æˆ·ä¹Ÿä¸æ€•äº†ã€‚ä½¿ç”¨elastic-jobå¼€å‘çš„ä½œä¸šéƒ½æ˜¯zookeeperçš„å®¢æˆ·ç«¯ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ›3å°æœºå™¨è·‘jobï¼Œæˆ‘ä»¬å°†ä»»åŠ¡åˆ†æˆ3ç‰‡ï¼Œæ¡†æž¶é€šè¿‡zkçš„åè°ƒï¼Œæœ€ç»ˆä¼šè®©3å°æœºå™¨åˆ†åˆ«åˆ†é…åˆ°0,1,2çš„ä»»åŠ¡ç‰‡ï¼Œæ¯”å¦‚server0â€“&gt;0ï¼Œserver1â€“&gt;1ï¼Œserver2â€“&gt;2ï¼Œå½“server0æ‰§è¡Œæ—¶ï¼Œå¯ä»¥åªæŸ¥è¯¢id%3==0çš„ç”¨æˆ·ï¼Œserver1æ‰§è¡Œæ—¶ï¼ŒåªæŸ¥è¯¢id%3==1çš„ç”¨æˆ·ï¼Œserver2æ‰§è¡Œæ—¶ï¼ŒåªæŸ¥è¯¢id%3==2çš„ç”¨æˆ·ã€‚ä»»åŠ¡éƒ¨ç½²å¤šèŠ‚ç‚¹å¼•å‘é‡å¤æ‰§è¡Œåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å†å¢žåŠ server3ï¼Œæ­¤æ—¶ï¼Œserver3åˆ†ä¸åˆ°ä»»åŠ¡åˆ†ç‰‡ï¼Œå› ä¸ºåªæœ‰3ç‰‡ï¼Œå·²ç»åˆ†å®Œäº†ã€‚æ²¡æœ‰åˆ†åˆ°ä»»åŠ¡åˆ†ç‰‡çš„ä½œä¸šç¨‹åºå°†ä¸æ‰§è¡Œã€‚å¦‚æžœæ­¤æ—¶server2æŒ‚äº†ï¼Œé‚£ä¹ˆserver2çš„åˆ†ç‰‡é¡¹ä¼šåˆ†é…ç»™server3ï¼Œserver3æœ‰äº†åˆ†ç‰‡ï¼Œå°±ä¼šæ›¿ä»£server2æ‰§è¡Œã€‚å¦‚æžœæ­¤æ—¶server3ä¹ŸæŒ‚äº†ï¼Œåªå‰©ä¸‹server0å’Œserver1äº†ï¼Œæ¡†æž¶ä¹Ÿä¼šè‡ªåŠ¨æŠŠserver3çš„åˆ†ç‰‡éšæœºåˆ†é…ç»™server0æˆ–è€…server1ï¼Œå¯èƒ½ä¼šè¿™æ ·ï¼Œserver0â€“&gt;0ï¼Œserver1â€“&gt;1,2ã€‚è¿™ç§ç‰¹æ€§ç§°ä¹‹ä¸ºå¼¹æ€§æ‰©å®¹ï¼Œå³elastic-jobåç§°çš„ç”±æ¥ã€‚ ä»£ç æ¼”ç¤ºæˆ‘ä»¬æ­å»ºçŽ¯å¢ƒé€šè¿‡ç¤ºä¾‹ä»£ç æ¥æ¼”ç¤ºä¸Šé¢çš„ä¾‹å­ï¼Œelastic-jobæ˜¯ä¸æ”¯æŒå•æœºå¤šå®žä¾‹çš„ï¼Œé€šè¿‡zkçš„åè°ƒåˆ†ç‰‡æ˜¯ä»¥ipä¸ºå•å…ƒçš„ã€‚å¾ˆå¤šåŒå­¦ä¸Šæ¥å¯èƒ½å°±æ˜¯é€šè¿‡å•æœºå¤šå®žä¾‹æ¥å­¦ä¹ ï¼Œç»“æžœå¯¼è‡´åˆ†ç‰‡å’Œé¢„æœŸä¸ä¸€è‡´ã€‚è¿™é‡Œæ²¡åŠžæ³•ï¼Œåªèƒ½é€šè¿‡å¤šæœºå™¨æˆ–è€…è™šæ‹Ÿæœºï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨è™šæ‹Ÿæœºï¼Œå¦å¤–ï¼Œç”±äºŽèµ„æºæœ‰é™ï¼Œæˆ‘ä»¬è¿™é‡Œä»…ä»…åªæ¨¡æ‹Ÿä¸¤å°æœºå™¨ã€‚ èŠ‚ç‚¹è¯´æ˜Žï¼šæœ¬åœ°å®¿ä¸»æœºå™¨zookeeperã€job192.168.241.1è™šæ‹Ÿæœºjob192.168.241.128çŽ¯å¢ƒè¯´æ˜Žï¼šJavaè¯·ä½¿ç”¨JDK1.7åŠå…¶ä»¥ä¸Šç‰ˆæœ¬ã€‚Zookeeperè¯·ä½¿ç”¨Zookeeper3.4.6åŠå…¶ä»¥ä¸Šç‰ˆæœ¬Elastic-Job-Lite2.0.5ï¼ˆ2.xç³»åˆ—å³å¯ï¼Œæœ€å¥½æ˜¯2.0.4åŠå…¶ä»¥ä¸Šï¼‰éœ€æ±‚è¯´æ˜Žï¼šé€šè¿‡ä¸¤å°æœºå™¨æ¼”ç¤ºåŠ¨æ€åˆ†ç‰‡ step1. å¼•å…¥æ¡†æž¶çš„jaråŒ… 123456789101112&lt;!-- å¼•å…¥elastic-job-liteæ ¸å¿ƒæ¨¡å— --&gt;&lt;dependency&gt; &lt;groupId&gt;com.dangdang&lt;/groupId&gt; &lt;artifactId&gt;elastic-job-lite-core&lt;/artifactId&gt; &lt;version&gt;2.0.5&lt;/version&gt;&lt;/dependency&gt;&lt;!-- ä½¿ç”¨springframeworkè‡ªå®šä¹‰å‘½åç©ºé—´æ—¶å¼•å…¥ --&gt;&lt;dependency&gt; &lt;groupId&gt;com.dangdang&lt;/groupId&gt; &lt;artifactId&gt;elastic-job-lite-spring&lt;/artifactId&gt; &lt;version&gt;2.0.5&lt;/version&gt;&lt;/dependency&gt; step2. ç¼–å†™job 123456789101112131415161718192021package com.fanfan.sample001;import com.dangdang.ddframe.job.api.ShardingContext;import com.dangdang.ddframe.job.api.simple.SimpleJob;import java.util.Date;/** * Created by fanfan on 2016/12/20. */public class MySimpleJob implements SimpleJob &#123; @Override public void execute(ShardingContext shardingContext) &#123; System.out.println(String.format("------Thread ID: %s, ä»»åŠ¡æ€»ç‰‡æ•°: %s, å½“å‰åˆ†ç‰‡é¡¹: %s", Thread.currentThread().getId(), shardingContext.getShardingTotalCount(), shardingContext.getShardingItem())); /** * å®žé™…å¼€å‘ä¸­ï¼Œæœ‰äº†ä»»åŠ¡æ€»ç‰‡æ•°å’Œå½“å‰åˆ†ç‰‡é¡¹ï¼Œå°±å¯ä»¥å¯¹ä»»åŠ¡è¿›è¡Œåˆ†ç‰‡æ‰§è¡Œäº† * æ¯”å¦‚ SELECT * FROM user WHERE status = 0 AND MOD(id, shardingTotalCount) = shardingItem */ &#125;&#125; Step3. Springé…ç½® 123456789101112131415161718192021&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:reg="http://www.dangdang.com/schema/ddframe/reg" xmlns:job="http://www.dangdang.com/schema/ddframe/job" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.dangdang.com/schema/ddframe/reg http://www.dangdang.com/schema/ddframe/reg/reg.xsd http://www.dangdang.com/schema/ddframe/job http://www.dangdang.com/schema/ddframe/job/job.xsd"&gt; &lt;!--é…ç½®ä½œä¸šæ³¨å†Œä¸­å¿ƒ --&gt; &lt;reg:zookeeper id="regCenter" server-lists="192.168.241.1:2181" namespace="dd-job" base-sleep-time-milliseconds="1000" max-sleep-time-milliseconds="3000" max-retries="3" /&gt; &lt;!-- é…ç½®ä½œä¸š--&gt; &lt;job:simple id="mySimpleJob" class="com.fanfan.sample001.MySimpleJob" registry-center-ref="regCenter" sharding-total-count="2" cron="0/2 * * * * ?" overwrite="true" /&gt;&lt;/beans&gt; Case1. å•èŠ‚ç‚¹ Case2. å¢žåŠ ä¸€ä¸ªèŠ‚ç‚¹ Case3. æ–­å¼€ä¸€ä¸ªèŠ‚ç‚¹ ä½œä¸šç±»åž‹elastic-jobæä¾›äº†ä¸‰ç§ç±»åž‹çš„ä½œä¸šï¼šSimpleç±»åž‹ä½œä¸šã€Dataflowç±»åž‹ä½œä¸šã€Scriptç±»åž‹ä½œä¸šã€‚è¿™é‡Œä¸»è¦è®²è§£å‰ä¸¤è€…ã€‚Scriptç±»åž‹ä½œä¸šæ„ä¸ºè„šæœ¬ç±»åž‹ä½œä¸šï¼Œæ”¯æŒshellï¼Œpythonï¼Œperlç­‰æ‰€æœ‰ç±»åž‹è„šæœ¬ï¼Œä½¿ç”¨ä¸å¤šï¼Œå¯ä»¥å‚è§githubæ–‡æ¡£ã€‚SimpleJobéœ€è¦å®žçŽ°SimpleJobæŽ¥å£ï¼Œæ„ä¸ºç®€å•å®žçŽ°ï¼Œæœªç»è¿‡ä»»ä½•å°è£…ï¼Œä¸ŽquartzåŽŸç”ŸæŽ¥å£ç›¸ä¼¼ï¼Œæ¯”å¦‚ç¤ºä¾‹ä»£ç ä¸­æ‰€ä½¿ç”¨çš„jobã€‚Dataflowç±»åž‹ç”¨äºŽå¤„ç†æ•°æ®æµï¼Œéœ€å®žçŽ°DataflowJobæŽ¥å£ã€‚è¯¥æŽ¥å£æä¾›2ä¸ªæ–¹æ³•å¯ä¾›è¦†ç›–ï¼Œåˆ†åˆ«ç”¨äºŽæŠ“å–(fetchData)å’Œå¤„ç†(processData)æ•°æ®ã€‚å¯é€šè¿‡DataflowJobConfigurationé…ç½®æ˜¯å¦æµå¼å¤„ç†ã€‚æµå¼å¤„ç†æ•°æ®åªæœ‰fetchDataæ–¹æ³•çš„è¿”å›žå€¼ä¸ºnullæˆ–é›†åˆé•¿åº¦ä¸ºç©ºæ—¶ï¼Œä½œä¸šæ‰åœæ­¢æŠ“å–ï¼Œå¦åˆ™ä½œä¸šå°†ä¸€ç›´è¿è¡Œä¸‹åŽ»ï¼› éžæµå¼å¤„ç†æ•°æ®åˆ™åªä¼šåœ¨æ¯æ¬¡ä½œä¸šæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰§è¡Œä¸€æ¬¡fetchDataæ–¹æ³•å’ŒprocessDataæ–¹æ³•ï¼Œéšå³å®Œæˆæœ¬æ¬¡ä½œä¸šã€‚å®žé™…å¼€å‘ä¸­ï¼ŒDataflowç±»åž‹çš„jobè¿˜æ˜¯å¾ˆæœ‰å¥½ç”¨çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839package com.fanfan.sample001;import com.dangdang.ddframe.job.api.ShardingContext;import com.dangdang.ddframe.job.api.dataflow.DataflowJob;import java.util.ArrayList;import java.util.List;/** * Created by fanfan on 2016/12/23. */public class MyDataFlowJob implements DataflowJob&lt;User&gt; &#123; /* status 0ï¼šå¾…å¤„ç† 1ï¼šå·²å¤„ç† */ @Override public List&lt;User&gt; fetchData(ShardingContext shardingContext) &#123; List&lt;User&gt; users = null; /** * users = SELECT * FROM user WHERE status = 0 AND MOD(id, shardingTotalCount) = shardingItem Limit 0, 30 */ return users; &#125; @Override public void processData(ShardingContext shardingContext, List&lt;User&gt; data) &#123; for (User user: data) &#123; System.out.println(String.format("ç”¨æˆ· %s å¼€å§‹è®¡æ¯", user.getUserId())); user.setStatus(1); /** * update user */ &#125; &#125;&#125; 123&lt;job:dataflow id="myDataFlowJob" class="com.fanfan.sample001.MyDataFlowJob" registry-center-ref="regCenter" sharding-total-count="2" cron="0 0 02 * * ?" streaming-process="true" overwrite="true" /&gt; å…¶å®ƒåŠŸèƒ½ä¸Šè¿°ä»‹ç»çš„æ˜¯æœ€ç²¾ç®€å¸¸ç”¨çš„åŠŸèƒ½ã€‚elastic-jobçš„åŠŸèƒ½é›†è¿˜ä¸æ­¢è¿™äº›ï¼Œæ¯”å¦‚åƒä½œä¸šäº‹ä»¶è¿½è¸ªã€ä»»åŠ¡ç›‘å¬ç­‰ï¼Œå¦å¤–ï¼Œelastic-job-lite-consoleä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„è¿ç»´å¹³å°è¿˜æä¾›äº†ç”¨æ¥æŸ¥è¯¢å’Œæ“ä½œä»»åŠ¡çš„webé¡µé¢ã€‚è¿™äº›å¢žå¼ºçš„åŠŸèƒ½è¯»è€…å¯ä»¥åœ¨github/elastic-jobä¸Šè‡ªè¡Œå­¦ä¹ ï¼Œç›¸ä¿¡æœ‰äº†æœ¬ç¯‡åšæ–‡çš„åŸºç¡€ï¼Œå†é˜…è¯»é‚£äº›æ–‡æ¡£å°±ç‰¹åˆ«ç®€å•äº†ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>elastic-job</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[cronè¯¦è§£]]></title>
    <url>%2F2017%2F11%2F10%2Fcron%E8%AF%A6%E8%A7%A3%2F</url>
    <content type="text"><![CDATA[Cronè¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä»¥5æˆ–6ä¸ªç©ºæ ¼éš”å¼€ï¼Œåˆ†ä¸º6æˆ–7ä¸ªåŸŸï¼Œæ¯ä¸€ä¸ªåŸŸä»£è¡¨ä¸€ä¸ªå«ä¹‰ï¼ŒCronæœ‰å¦‚ä¸‹ä¸¤ç§è¯­æ³•æ ¼å¼ï¼š Seconds Minutes Hours DayofMonth Month DayofWeek Year æˆ– Seconds Minutes Hours DayofMonth Month DayofWeek æ¯ä¸€ä¸ªåŸŸå¯å‡ºçŽ°çš„å­—ç¬¦å¦‚ä¸‹ï¼šSeconds:å¯å‡ºçŽ°â€, - /â€œå››ä¸ªå­—ç¬¦ï¼Œæœ‰æ•ˆèŒƒå›´ä¸º0-59çš„æ•´æ•°Minutes:å¯å‡ºçŽ°â€, - /â€œå››ä¸ªå­—ç¬¦ï¼Œæœ‰æ•ˆèŒƒå›´ä¸º0-59çš„æ•´æ•°Hours:å¯å‡ºçŽ°â€, - /â€œå››ä¸ªå­—ç¬¦ï¼Œæœ‰æ•ˆèŒƒå›´ä¸º0-23çš„æ•´æ•°DayofMonth:å¯å‡ºçŽ°â€, - / ? L W Câ€å…«ä¸ªå­—ç¬¦ï¼Œæœ‰æ•ˆèŒƒå›´ä¸º0-31çš„æ•´æ•°Month:å¯å‡ºçŽ°â€, - /â€œå››ä¸ªå­—ç¬¦ï¼Œæœ‰æ•ˆèŒƒå›´ä¸º1-12çš„æ•´æ•°æˆ–JAN-DEcDayofWeek:å¯å‡ºçŽ°â€, - / ? L C #â€å››ä¸ªå­—ç¬¦ï¼Œæœ‰æ•ˆèŒƒå›´ä¸º1-7çš„æ•´æ•°æˆ–SUN-SATä¸¤ä¸ªèŒƒå›´ã€‚1è¡¨ç¤ºæ˜ŸæœŸå¤©ï¼Œ2è¡¨ç¤ºæ˜ŸæœŸä¸€ï¼Œ ä¾æ¬¡ç±»æŽ¨Year:å¯å‡ºçŽ°â€, - * /â€œå››ä¸ªå­—ç¬¦ï¼Œæœ‰æ•ˆèŒƒå›´ä¸º1970-2099å¹´ æ¯ä¸€ä¸ªåŸŸéƒ½ä½¿ç”¨æ•°å­—ï¼Œä½†è¿˜å¯ä»¥å‡ºçŽ°å¦‚ä¸‹ç‰¹æ®Šå­—ç¬¦ï¼Œå®ƒä»¬çš„å«ä¹‰æ˜¯ï¼š(1)ï¼šè¡¨ç¤ºåŒ¹é…è¯¥åŸŸçš„ä»»æ„å€¼ï¼Œå‡å¦‚åœ¨MinutesåŸŸä½¿ç”¨, å³è¡¨ç¤ºæ¯åˆ†é’Ÿéƒ½ä¼šè§¦å‘äº‹ä»¶ã€‚ (2)?:åªèƒ½ç”¨åœ¨DayofMonthå’ŒDayofWeekä¸¤ä¸ªåŸŸã€‚å®ƒä¹ŸåŒ¹é…åŸŸçš„ä»»æ„å€¼ï¼Œä½†å®žé™…ä¸ä¼šã€‚å› ä¸ºDayofMonthå’Œ DayofWeekä¼šç›¸äº’å½±å“ã€‚ä¾‹å¦‚æƒ³åœ¨æ¯æœˆçš„20æ—¥è§¦å‘è°ƒåº¦ï¼Œä¸ç®¡20æ—¥åˆ°åº•æ˜¯æ˜ŸæœŸå‡ ï¼Œåˆ™åªèƒ½ä½¿ç”¨å¦‚ä¸‹å†™æ³•ï¼š 13 13 15 20 ?, å…¶ä¸­æœ€åŽä¸€ä½åªèƒ½ç”¨ï¼Ÿï¼Œè€Œä¸èƒ½ä½¿ç”¨ï¼Œå¦‚æžœä½¿ç”¨*è¡¨ç¤ºä¸ç®¡æ˜ŸæœŸå‡ éƒ½ä¼šè§¦å‘ï¼Œå®žé™…ä¸Šå¹¶ä¸æ˜¯è¿™æ ·ã€‚(3)-:è¡¨ç¤ºèŒƒå›´ï¼Œä¾‹å¦‚åœ¨MinutesåŸŸä½¿ç”¨5-20ï¼Œè¡¨ç¤ºä»Ž5åˆ†åˆ°20åˆ†é’Ÿæ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡(4)/ï¼šè¡¨ç¤ºèµ·å§‹æ—¶é—´å¼€å§‹è§¦å‘ï¼Œç„¶åŽæ¯éš”å›ºå®šæ—¶é—´è§¦å‘ä¸€æ¬¡ï¼Œä¾‹å¦‚åœ¨MinutesåŸŸä½¿ç”¨5/20,åˆ™æ„å‘³ç€5åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ï¼Œè€Œ25ï¼Œ45ç­‰åˆ†åˆ«è§¦å‘ä¸€æ¬¡.(5),:è¡¨ç¤ºåˆ—å‡ºæžšä¸¾å€¼å€¼ã€‚ä¾‹å¦‚ï¼šåœ¨MinutesåŸŸä½¿ç”¨5,20ï¼Œåˆ™æ„å‘³ç€åœ¨5å’Œ20åˆ†æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ã€‚(6)L:è¡¨ç¤ºæœ€åŽï¼Œåªèƒ½å‡ºçŽ°åœ¨DayofWeekå’ŒDayofMonthåŸŸï¼Œå¦‚æžœåœ¨DayofWeekåŸŸä½¿ç”¨5L,æ„å‘³ç€åœ¨æœ€åŽçš„ä¸€ä¸ªæ˜ŸæœŸå››è§¦å‘ã€‚(7)W: è¡¨ç¤ºæœ‰æ•ˆå·¥ä½œæ—¥(å‘¨ä¸€åˆ°å‘¨äº”),åªèƒ½å‡ºçŽ°åœ¨DayofMonthåŸŸï¼Œç³»ç»Ÿå°†åœ¨ç¦»æŒ‡å®šæ—¥æœŸçš„æœ€è¿‘çš„æœ‰æ•ˆå·¥ä½œæ—¥è§¦å‘äº‹ä»¶ã€‚ä¾‹å¦‚ï¼šåœ¨ DayofMonthä½¿ç”¨5Wï¼Œå¦‚æžœ5æ—¥æ˜¯æ˜ŸæœŸå…­ï¼Œåˆ™å°†åœ¨æœ€è¿‘çš„å·¥ä½œæ—¥ï¼šæ˜ŸæœŸäº”ï¼Œå³4æ—¥è§¦å‘ã€‚å¦‚æžœ5æ—¥æ˜¯æ˜ŸæœŸå¤©ï¼Œåˆ™åœ¨6æ—¥(å‘¨ä¸€)è§¦å‘ï¼›å¦‚æžœ5æ—¥åœ¨æ˜ŸæœŸä¸€ åˆ°æ˜ŸæœŸäº”ä¸­çš„ä¸€å¤©ï¼Œåˆ™å°±åœ¨5æ—¥è§¦å‘ã€‚å¦å¤–ä¸€ç‚¹ï¼ŒWçš„æœ€è¿‘å¯»æ‰¾ä¸ä¼šè·¨è¿‡æœˆä»½(8)LW:è¿™ä¸¤ä¸ªå­—ç¬¦å¯ä»¥è¿žç”¨ï¼Œè¡¨ç¤ºåœ¨æŸä¸ªæœˆæœ€åŽä¸€ä¸ªå·¥ä½œæ—¥ï¼Œå³æœ€åŽä¸€ä¸ªæ˜ŸæœŸäº”ã€‚(9)#:ç”¨äºŽç¡®å®šæ¯ä¸ªæœˆç¬¬å‡ ä¸ªæ˜ŸæœŸå‡ ï¼Œåªèƒ½å‡ºçŽ°åœ¨DayofMonthåŸŸã€‚ä¾‹å¦‚åœ¨4#2ï¼Œè¡¨ç¤ºæŸæœˆçš„ç¬¬äºŒä¸ªæ˜ŸæœŸä¸‰ã€‚ ä¸¾å‡ ä¸ªä¾‹å­:0 0 2 1 ? è¡¨ç¤ºåœ¨æ¯æœˆçš„1æ—¥çš„å‡Œæ™¨2ç‚¹è°ƒåº¦ä»»åŠ¡0 15 10 ? * MON-FRI è¡¨ç¤ºå‘¨ä¸€åˆ°å‘¨äº”æ¯å¤©ä¸Šåˆ10ï¼š15æ‰§è¡Œä½œä¸š0 15 10 ? 6L 2002-2006 è¡¨ç¤º2002-2006å¹´çš„æ¯ä¸ªæœˆçš„æœ€åŽä¸€ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15æ‰§è¡Œä½œ]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Git æ•™ç¨‹]]></title>
    <url>%2F2017%2F11%2F08%2FGit-%E6%95%99%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[é…ç½®ä½œè€…é‚®ä»¶1234 git config --global --edit git config --global user.name "your name"git config --global user.email "your email" å›žé€€åˆ°æŸæ¬¡commitï¼Œæäº¤è¿œç¨‹åˆ†æ”¯123456789101112æŸ¥çœ‹commit idgit loggit log --pretty=onelineæœ¬åœ°å›žé€€git reset --hard commit_idgit reset --hard HEAD^ å›žé€€åˆ°ä¸Šä¸ªç‰ˆæœ¬å¼ºæŽ¨åˆ°è¿œç¨‹ï¼šgit push origin HEAD --forcegit push -f HEADæŒ‡å‘çš„ç‰ˆæœ¬å°±æ˜¯å½“å‰ç‰ˆæœ¬ï¼Œå› æ­¤ï¼ŒGitå…è®¸æˆ‘ä»¬åœ¨ç‰ˆæœ¬çš„åŽ†å²ä¹‹é—´ç©¿æ¢­ï¼Œä½¿ç”¨å‘½ä»¤ git reset --hard commit_idã€‚ git reset --hard HEAD^ ç©¿æ¢­å‰ï¼Œç”¨git logå¯ä»¥æŸ¥çœ‹æäº¤åŽ†å²ï¼Œä»¥ä¾¿ç¡®å®šè¦å›žé€€åˆ°å“ªä¸ªç‰ˆæœ¬ã€‚ git log --pretty=oneline è¦é‡è¿”æœªæ¥ï¼Œç”¨git reflogæŸ¥çœ‹å‘½ä»¤åŽ†å²ï¼Œä»¥ä¾¿ç¡®å®šè¦å›žåˆ°æœªæ¥çš„å“ªä¸ªç‰ˆæœ¬ã€‚ git reflog æœ¬åœ°åˆ†æ”¯è¢«è¿œç¨‹è¦†ç›–123git fetch --allgit reset --hard origin/master (è¿™é‡Œmasterè¦ä¿®æ”¹ä¸ºå¯¹åº”çš„åˆ†æ”¯å)git pull git åŒæ­¥githubä¸Šforkçš„é¡¹ç›®123456git checkout mastergit remote -vgit remote add leader git@github.com:MyCATApache/tcp-proxy.gitgit fetch leadergit merge leader/mastergit push origin master åŒæ­¥è¿œç¨‹æœåŠ¡å™¨ï¼Œæœ¬åœ°å¤åˆ¶ä¸€ä»½origin git fetch origin å»ºç«‹æœ¬åœ°åˆ†æ”¯ dev -&gt; origin/dev git checkout -b dev origin/dev git checkout -b [åˆ†æ”¯å] [è¿œç¨‹å]/[åˆ†æ”¯å]ã€‚ å¦‚æžœä½ æœ‰ 1.6.2 ä»¥ä¸Šç‰ˆæœ¬çš„ Gitï¼Œè¿˜å¯ä»¥ç”¨ â€“track é€‰é¡¹ç®€åŒ–ï¼š $ git checkout --track origin/serverfix åˆ›å»ºåˆ†æ”¯(remeber) git branch iss53 checkoutåˆ†æ”¯(remeber) git checkout iss53 åˆ›å»ºå¹¶checkoutåˆ†æ”¯ git branch -b iss53 æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ git branch -a æŽ¨é€æœ¬åœ°åˆ†æ”¯åˆ°æœåŠ¡å™¨åˆ†æ”¯git push [è¿œç¨‹å] [æœ¬åœ°åˆ†æ”¯]:[è¿œç¨‹åˆ†æ”¯] åˆ é™¤è¿œç¨‹åˆ†æ”¯ git branch -r -d origin/branch-name git push origin :branch-name åˆ é™¤æœ¬åœ°åˆ†æ”¯git branch -d iss53 å½“ä½ åœ¨ master ä¸‹ $ git pull # ç­‰äºŽ fetch originï¼Œç„¶åŽ merge origin/master å½“ä½ åœ¨ develop ä¸‹ $ git pull # ç­‰äºŽ fetch originï¼Œç„¶åŽ merge origin/develop åœ¨masteråˆ†æ”¯ä¸­ $ git checkout -b hotfix $ vim index.html $ git commit -a -m &apos;fixed the broken email address&apos; $ git checkout master $ git merge hotfix $ git branch -d hotfix git checkout iss53 Vim index.html Git commit -a -m â€˜your messageâ€™ git merge master. å¯ä»¥åˆå¹¶masterä¸­hotfixçš„æ›´æ–° git checkout master git merge iss53 å¯ä»¥ç”¨git statusæŸ¥çœ‹åˆå¹¶äº§ç”Ÿå†²çªçš„æ–‡ä»¶ git addè¡¨ç¤ºè§£å†³ï¼Œä¿å­˜åˆ°æš‚å­˜åŒºï¼Œå†git commitå³å¯ git branch -d is53 ç›¸æ¯”git resetï¼Œå®ƒä¸ä¼šæ”¹å˜çŽ°åœ¨çš„æäº¤åŽ†å²ã€‚å› æ­¤ï¼Œgit revertå¯ä»¥ç”¨åœ¨å…¬å…±åˆ†æ”¯ä¸Šï¼Œgit resetåº”è¯¥ç”¨åœ¨ç§æœ‰åˆ†æ”¯ä¸Šã€‚ä½ ä¹Ÿå¯ä»¥æŠŠgit revertå½“ä½œæ’¤é”€å·²ç»æäº¤çš„æ›´æ”¹ï¼Œè€Œgit reset HEADç”¨æ¥æ’¤é”€æ²¡æœ‰æäº¤çš„æ›´æ”¹ã€‚å°±åƒgit checkout ä¸€æ ·ï¼Œgit revert ä¹Ÿæœ‰å¯èƒ½ä¼šé‡å†™æ–‡ä»¶ã€‚æ‰€ä»¥ï¼ŒGitä¼šåœ¨ä½ æ‰§è¡Œrevertä¹‹å‰è¦æ±‚ä½ æäº¤æˆ–è€…ç¼“å­˜ä½ å·¥ä½œç›®å½•ä¸­çš„æ›´æ”¹ã€‚ å¼ºåˆ¶é‡å†™æœ¬åœ°masteråˆ†æ”¯ git fetch origin master git reset --hard FETCH_HEAD git clean -df å¼ºåˆ¶åˆ é™¤è¿œç¨‹åˆ†æ”¯çš„æŸä¸ªæ–‡ä»¶ git rm --cached --force .idea/libraries/Maven__org_springframework_spring_core_4_1_6_RELEASE.xml â€‹â€‹ git ä¿®æ”¹remoteåœ°å€12345678 æ–¹æ³•æœ‰ä¸‰ç§ï¼š1.ä¿®æ”¹å‘½ä»¤git remote set-url origin [url]ä¾‹å¦‚ï¼šGit remote set-url origin gitlab@gitlab.chumob.com:PHP/hasoffer.git2.å…ˆåˆ åŽåŠ git remote rm origingit remote add origin [url]3.ç›´æŽ¥ä¿®æ”¹configæ–‡ä»¶ git diffæ—§çš„åœ¨å‰ï¼Œæ–°çš„åœ¨åŽ git diff d1afe9 b588527d &gt; ~/Desktop/patch.diff git apply --reject ~/Desktop/patch.diff $ git diff 608e120 4abe32e --name-only $ git diff 608e120 4abe32e --name-only | xargs zip update.zip git mergetool12345678910ä¸‹è½½diffmergeï¼ˆhttp://download.sourcegear.com/DiffMerge/4.2.1/DiffMerge.4.2.1.1013.intel.stable.pkgï¼‰é…ç½®gitç¡®ä¿/usr/local/bin/diffmergeå­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œå»ºç«‹ç¬¦å·é“¾æŽ¥ï¼ˆln /Applications/DiffMerge.app/Contents/MacOS/DiffMerge /usr/local/bin/diffmergeï¼‰git config --global diff.tool diffmergegit config --global difftool.diffmerge.cmd "/usr/local/bin/diffmerge \"\$LOCAL\" \"\$REMOTE\""git config --global merge.tool diffmergegit config --global mergetool.diffmerge.trustExitCode truegit config --global mergetool.diffmerge.cmd "/usr/local/bin/diffmerge --merge --result=\"\$MERGED\" \"\$LOCAL\" \"\$BASE\" \"\$REMOTE\""å†²çªå‘ç”ŸåŽä½¿ç”¨ git mergetool è¿›è¡Œmerge git tag$ git tag -a v1.4 -m &apos;my version 1.4&apos; $ git tag v0.1 v1.3 v1.4 git mergeGit merge â€“no-ff å¯ä»¥ä¿å­˜ä½ ä¹‹å‰çš„åˆ†æ”¯åŽ†å²ã€‚èƒ½å¤Ÿæ›´å¥½çš„æŸ¥çœ‹ mergeåŽ†å²ï¼Œä»¥åŠbranch çŠ¶æ€ã€‚ git merge åˆ™ä¸ä¼šæ˜¾ç¤º featureï¼Œåªä¿ç•™å•æ¡åˆ†æ”¯è®°å½•ã€‚ ####æ·»åŠ å­é¡¹ç›®12345git submodule add --name tools --force http://git.zenzet.com/lss-server/lss-data-mining-toolscd toolsgit submodule initgit submodule updategit clone --recursive https://github.com/chaconinc/MainProject git stash git stash ä¿å­˜å½“å‰çš„å·¥ä½œè¿›åº¦ã€‚ä¼šåˆ†åˆ«å¯¹æš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„çŠ¶æ€è¿›è¡Œä¿å­˜ git stash save â€œmessageâ€¦â€ è¿™æ¡å‘½ä»¤å®žé™…ä¸Šæ˜¯ç¬¬ä¸€æ¡ git stash å‘½ä»¤çš„å®Œæ•´ç‰ˆ git stash list æ˜¾ç¤ºè¿›åº¦åˆ—è¡¨ã€‚æ­¤å‘½ä»¤æ˜¾ç„¶æš—ç¤ºäº†git stash å¯ä»¥å¤šæ¬¡ä¿å­˜å·¥ä½œè¿›åº¦ï¼Œå¹¶ç”¨åœ¨æ¢å¤æ—¶å€™è¿›è¡Œé€‰æ‹© git stash pop [â€“index] [] å¦‚æžœä¸ä½¿ç”¨ä»»ä½•å‚æ•°ï¼Œä¼šæ¢å¤æœ€æ–°ä¿å­˜çš„å·¥ä½œè¿›åº¦ï¼Œå¹¶å°†æ¢å¤çš„å·¥ä½œè¿›åº¦ä»Žå­˜å‚¨çš„å·¥ä½œè¿›åº¦åˆ—è¡¨ä¸­æ¸…é™¤ã€‚ å¦‚æžœæä¾›å‚æ•°ï¼ˆæ¥è‡ª git stash list æ˜¾ç¤ºçš„åˆ—è¡¨ï¼‰ï¼Œåˆ™ä»Žè¯¥ &lt;stash&gt; ä¸­æ¢å¤ã€‚æ¢å¤å®Œæ¯•ä¹Ÿå°†ä»Žè¿›åº¦åˆ—è¡¨ä¸­åˆ é™¤ &lt;stash&gt;ã€‚ é€‰é¡¹â€“index é™¤äº†æ¢å¤å·¥ä½œåŒºçš„æ–‡ä»¶å¤–ï¼Œè¿˜å°è¯•æ¢å¤æš‚å­˜åŒºã€‚ git stash apply [â€“index] [] é™¤äº†ä¸åˆ é™¤æ¢å¤çš„è¿›åº¦ä¹‹å¤–ï¼Œå…¶ä½™å’Œ git stash pop å‘½ä»¤ä¸€æ · git stash clear åˆ é™¤æ‰€æœ‰å­˜å‚¨çš„è¿›åº¦ 123456789101112131415git stash [save message] [-k|--no-keep-index] [--patch]è¿™æ˜¯git stashä¿å­˜è¿›åº¦çš„å®Œæ•´å‘½ä»¤å½¢å¼ä½¿ç”¨saveå¯ä»¥å¯¹è¿›åº¦æ·»åŠ å¤‡æ³¨# git stash save "è¿™æ˜¯ä¿å­˜çš„è¿›åº¦"git stash apply stash@&#123;2&#125;çŽ°åœ¨æ‰§è¡Œlistï¼Œä¼šå‘çŽ°åŽé¢ä¼šå‡ºçŽ°è‡ªå®šä¹‰çš„è¢«åˆç§Ÿ# git stash liststash@&#123;0&#125;: On master: è¿™æ˜¯ä¿å­˜çš„è¿›åº¦-kå’Œ--no-keep-indexæŒ‡å®šä¿å­˜è¿›åº¦åŽï¼Œæ˜¯å¦é‡ç½®æš‚å­˜åŒº--patch ä¼šæ˜¾ç¤ºå·¥ä½œåŒºå’ŒHEADçš„å·®å¼‚,é€šè¿‡ç¼–è¾‘å·®å¼‚æ–‡ä»¶ï¼ŒæŽ’é™¤ä¸éœ€è¦ä¿å­˜çš„å†…å®¹ã€‚å’Œgit add -på‘½ä»¤ç±»ä¼¼ 123456789git stash å¯¹å½“å‰çš„æš‚å­˜åŒºå’Œå·¥ä½œåŒºçŠ¶æ€è¿›è¡Œä¿å­˜ã€‚git stash list åˆ—å‡ºæ‰€æœ‰ä¿å­˜çš„è¿›åº¦åˆ—è¡¨ã€‚git stash pop [--index] [&lt;stash&gt;] æ¢å¤å·¥ä½œè¿›åº¦--index å‚æ•°ï¼šä¸ä»…æ¢å¤å·¥ä½œåŒºï¼Œè¿˜æ¢å¤æš‚å­˜åŒº&lt;stash&gt; æŒ‡å®šæ¢å¤æŸä¸€ä¸ªå…·ä½“è¿›åº¦ã€‚å¦‚æžœæ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œé»˜è®¤æ¢å¤æœ€æ–°è¿›åº¦å¦‚ï¼šä»¥ä¸‹å‘½ä»¤æ¢å¤ç¼–å·ä¸º0çš„è¿›åº¦çš„å·¥ä½œåŒºå’Œæš‚å­˜åŒº# git stash pop --index stash@&#123;0&#125; git rebaseåœ¨ä½¿ç”¨ Git ä½œä¸ºç‰ˆæœ¬æŽ§åˆ¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”±äºŽå„ç§å„æ ·çš„åŽŸå› æäº¤äº†è®¸å¤šä¸´æ—¶çš„ commitï¼Œè€Œè¿™äº› commit æ‹¼æŽ¥èµ·æ¥æ‰æ˜¯å®Œæ•´çš„ä»»åŠ¡ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸ºäº†é¿å…å¤ªå¤šçš„ commit è€Œé€ æˆç‰ˆæœ¬æŽ§åˆ¶çš„æ··ä¹±ï¼Œé€šå¸¸æˆ‘ä»¬æŽ¨èå°†è¿™äº› commit åˆå¹¶æˆä¸€ä¸ªã€‚ 1,æŸ¥çœ‹æäº¤åŽ†å²ï¼Œgit log é¦–å…ˆä½ è¦çŸ¥é“è‡ªå·±æƒ³åˆå¹¶çš„æ˜¯å“ªå‡ ä¸ªæäº¤ï¼Œå¯ä»¥ä½¿ç”¨git logå‘½ä»¤æ¥æŸ¥çœ‹æäº¤åŽ†å²ï¼Œå‡å¦‚æœ€è¿‘4æ¡åŽ†å²å¦‚ä¸‹ï¼š 1234567commit 3ca6ec340edc66df13423f36f52919dfa3......commit 1b4056686d1b494a5c86757f9eaed844......commit 53f244ac8730d33b353bee3b24210b07......commit 3a4226b4a0b6fa68783b07f1cee7b688....... åŽ†å²è®°å½•æ˜¯æŒ‰ç…§æ—¶é—´æŽ’åºçš„ï¼Œæ—¶é—´è¿‘çš„æŽ’åœ¨å‰é¢ã€‚ 2,git rebase æƒ³è¦åˆå¹¶1-3æ¡ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³• 1.ä»ŽHEADç‰ˆæœ¬å¼€å§‹å¾€è¿‡åŽ»æ•°3ä¸ªç‰ˆæœ¬ 1git rebase -i HEAD~3 2.æŒ‡åè¦åˆå¹¶çš„ç‰ˆæœ¬ä¹‹å‰çš„ç‰ˆæœ¬å· 1git rebase -i 3a4226b è¯·æ³¨æ„3a4226bè¿™ä¸ªç‰ˆæœ¬æ˜¯ä¸å‚ä¸Žåˆå¹¶çš„ï¼Œå¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªåæ ‡ 3,é€‰å–è¦åˆå¹¶çš„æäº¤ 1.æ‰§è¡Œäº†rebaseå‘½ä»¤ä¹‹åŽï¼Œä¼šå¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œå¤´å‡ è¡Œå¦‚ä¸‹ï¼š 12345pick 3ca6ec3 'æ³¨é‡Š**********'pick 1b40566 'æ³¨é‡Š*********'pick 53f244a 'æ³¨é‡Š**********' 2.å°†pickæ”¹ä¸ºsquashæˆ–è€…s,ä¹‹åŽä¿å­˜å¹¶å…³é—­æ–‡æœ¬ç¼–è¾‘çª—å£å³å¯ã€‚æ”¹å®Œä¹‹åŽæ–‡æœ¬å†…å®¹å¦‚ä¸‹ï¼š 12345pick 3ca6ec3 'æ³¨é‡Š**********'s 1b40566 'æ³¨é‡Š*********'s 53f244a 'æ³¨é‡Š**********' 3.ç„¶åŽä¿å­˜é€€å‡ºï¼ŒGitä¼šåŽ‹ç¼©æäº¤åŽ†å²ï¼Œå¦‚æžœæœ‰å†²çªï¼Œéœ€è¦ä¿®æ”¹ï¼Œä¿®æ”¹çš„æ—¶å€™è¦æ³¨æ„ï¼Œä¿ç•™æœ€æ–°çš„åŽ†å²ï¼Œä¸ç„¶æˆ‘ä»¬çš„ä¿®æ”¹å°±ä¸¢å¼ƒäº†ã€‚ä¿®æ”¹ä»¥åŽè¦è®°å¾—æ•²ä¸‹é¢çš„å‘½ä»¤ï¼š 123git add .git rebase --continue å¦‚æžœä½ æƒ³æ”¾å¼ƒè¿™æ¬¡åŽ‹ç¼©çš„è¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1git rebase --abort 4.å¦‚æžœæ²¡æœ‰å†²çªï¼Œæˆ–è€…å†²çªå·²ç»è§£å†³ï¼Œåˆ™ä¼šå‡ºçŽ°å¦‚ä¸‹çš„ç¼–è¾‘çª—å£ï¼š 12345678# This is a combination of 4 commits.#The first commitâ€™s message is:æ³¨é‡Š......# The 2nd commitâ€™s message is:æ³¨é‡Š......# The 3rd commitâ€™s message is:æ³¨é‡Š......# Please enter the commit message for your changes. Lines starting # with â€˜#â€™ will be ignored, and an empty message aborts the commit. 5.è¾“å…¥wqä¿å­˜å¹¶æŽ¨å‡º, å†æ¬¡è¾“å…¥git logæŸ¥çœ‹ commit åŽ†å²ä¿¡æ¯ï¼Œä½ ä¼šå‘çŽ°è¿™ä¸¤ä¸ª commit å·²ç»åˆå¹¶äº†ã€‚ git review èŽ·å–å½“å‰åˆ†æ”¯ 1git symbolic-ref -q --short HEAD åœ¨gitåˆ«åé‡Œä½¿ç”¨shellå‡½æ•°ï¼Œ$1èŽ·å–ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œ$2â€¦â€¦$nä¾æ¬¡ç±»æŽ¨ï¼Œæ ¹æ®è‡ªå·±ä¹ æƒ¯éœ€è¦å®šåˆ¶ æäº¤reviewçš„æ­£ç¡®è¯­å¥æ˜¯ï¼š git push origin HEAD:refs/for/destination_branch æ„æ€æ˜¯â€”æŠŠå½“å‰åˆ†æ”¯çš„ä»£ç æŽ¨é€åˆ°è¿œç¨‹originä»“åº“çš„reviewåˆ†æ”¯destination_branchä¸ŠåŽ» â€‹ originè¡¨ç¤ºè¿œç¨‹gitæœåŠ¡å™¨åœ°å€ï¼›HEADè¡¨ç¤ºå½“å‰åˆ†æ”¯ï¼›refs/for/destination_branch è¡¨ç¤ºè¿œç¨‹reviewåˆ†æ”¯ ä¸‹é¢é…ç½®çš„å«ä¹‰ï¼š æ‰§è¡Œgit reviewç­‰ä»·äºŽgit push origin HEAD:refs/for/current_branch æ‰§è¡Œgit review destination_branchç­‰ä»·äºŽgit push origin HEAD:refs/for/destination_branch 1`review = ``"!f() &#123; if [ -z $1 ];then currBra=`git symbolic-ref -q --short HEAD`;else currBra=$1;fi;git push origin HEAD:refs/for/$currBra; &#125;; f"` å…¨éƒ¨é…ç½®ï¼š 1`[core]`` ``repositoryformatversion = ``0`` ``filemode = ``true`` ``bare = ``false`` ``logallrefupdates = ``true`` ``ignorecase = ``true`` ``precomposeunicode = ``true``[remote ``"origin"``]`` ``url = ssh:``//depu.shen@gerrit.tongdun.me:29418/ganghui.zeng/gerrit_test`` ``fetch = +refs/heads/*:refs/remotes/origin/*``[branch ``"master"``]`` ``remote = origin`` ``merge = refs/heads/master``[branch ``"gerrit_test1811052223a"``]`` ``remote = origin`` ``merge = refs/heads/gerrit_test1811052223``[branch ``"gerrit_test1811052223"``]`` ``remote = origin`` ``merge = refs/heads/gerrit_test1811052223``[alias]`` ``st = status`` ``review = ``"!f() &#123; if [ -z $1 ];then currBra=`git symbolic-ref -q --short HEAD`;else currBra=$1;fi;git push origin HEAD:refs/for/$currBra; &#125;; f"` é…ç½®ç”Ÿæ•ˆçš„åœ°æ–¹ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼š é¡¹ç›®é…ç½®ï¼Œä½äºŽé¡¹ç›®ä¸‹çš„.git/config æŸ¥çœ‹git config â€“local â€“list ç¼–è¾‘git config â€“local -e æŸä¸ªç”¨æˆ·ä¸‹çš„æ‰€æœ‰é¡¹ç›®é…ç½®ï¼š~/.gitconfig æŸ¥çœ‹git config â€“global â€“list ç¼–è¾‘git config â€“global -e å½“å‰ç³»ç»Ÿä¸‹çš„æ‰€æœ‰ç”¨æˆ·æ‰€æœ‰é¡¹ç›®é…ç½®ï¼š/etc/gitconfig æŸ¥çœ‹git config â€“system â€“list ç¼–è¾‘git config â€“system -e https://hellomin.github.io/2018/09/11/%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E7%9A%84Git%E5%88%AB%E5%90%8D/ git diff1ã€å·¥ä½œåŒºå’Œæœ¬åœ°ç‰ˆæœ¬åº“å¯¹æ¯” git diff HEAD æŸ¥çœ‹å·¥ä½œåŒºå’Œç‰ˆæœ¬åº“é‡Œé¢æœ€æ–°ç‰ˆæœ¬çš„æ‰€æœ‰æ–‡ä»¶çš„åŒºåˆ« git diff HEAD â€“ file1æŸ¥çœ‹å·¥ä½œåŒºå’Œç‰ˆæœ¬åº“é‡Œé¢æœ€æ–°ç‰ˆæœ¬çš„æ–‡ä»¶file1çš„åŒºåˆ« git diff HEAD^ æŸ¥çœ‹å·¥ä½œåŒºå’Œç‰ˆæœ¬åº“é‡Œé¢ä¸Šä¸ªç‰ˆæœ¬çš„æ‰€æœ‰æ–‡ä»¶çš„åŒºåˆ« git diff commitId â€“ ./lib æŸ¥çœ‹å½“å‰å·¥ä½œåŒºå’ŒæŸä¸ªåŽ†å²ç‰ˆæœ¬commitIdçš„ç›®å½•libçš„åŒºåˆ« 2ã€æš‚å­˜åŒºå’Œæœ¬åœ°ç‰ˆæœ¬åº“å¯¹æ¯” git diff â€“cached æŸ¥çœ‹æš‚å­˜åŒºå’Œæœ¬åœ°ç‰ˆæœ¬åº“æœ€æ–°ç‰ˆæœ¬æ‰€æœ‰æ–‡ä»¶çš„åŒºåˆ« git diff â€“cached â€“ file1 æŸ¥çœ‹æš‚å­˜åŒºå’Œæœ¬åœ°ç‰ˆæœ¬åº“æœ€æ–°ç‰ˆæœ¬æ–‡ä»¶file1çš„åŒºåˆ« git diff â€“cached commitId file1 æŸ¥çœ‹å·²ç» add è¿›æš‚å­˜åŒºä½†æ˜¯å°šæœª commit çš„å†…å®¹åŒæŸä¸€æ¬¡ commit æ—¶çš„å†…å®¹çš„å·®å¼‚ ä¹Ÿå¯ä»¥ä½¿ç”¨git diff â€“staged 3ã€å·¥ä½œåŽ»å’Œæš‚å­˜åŒºå¯¹æ¯” git diff æŸ¥çœ‹å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸¤ä¸ªç‰ˆæœ¬æ‰€æœ‰æ–‡ä»¶çš„åŒºåˆ« git diff â€“ file1 æŸ¥çœ‹å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸¤ä¸ªç‰ˆæœ¬æ–‡ä»¶file1çš„åŒºåˆ« 4ã€æ¯”è¾ƒä¸¤ä¸ªåŽ†å²ç‰ˆæœ¬ç›´æŽ¥çš„åŒºåˆ« git dff commitId1 commitId2 æ¯”è¾ƒä¸¤ä¸ªåŽ†å²ç‰ˆæœ¬ä¹‹é—´çš„åŒºåˆ« git diff commitId1:file1 commidId2:file2 æ¯”è¾ƒä¸¤ä¸ªåŽ†å²ç‰ˆæœ¬ä¹‹é—´æ–‡ä»¶çš„åŒºåˆ« 5ã€è¾“å‡ºè‡ªtopicå’Œmasteråˆ†åˆ«å¼€å‘ä»¥æ¥ï¼Œmasteråˆ†æ”¯ä¸Šçš„changedã€‚ â€‹ git diff topicâ€¦master Changes that occurred on the master branch since when the topic branch was started off it git diffæ˜¾ç¤ºå†…å®¹è§£è¯»ï¼šhttp://www.ruanyifeng.com/blog/2012/08/how_to_read_diff.html git resetgit reset HEAD file ä½¿æš‚å­˜åŒºå’Œæœ¬åœ°ç‰ˆæœ¬åº“ä¿æŒä¸€è‡´ï¼Œå·¥ä½œåŒºä¸å—å½±å“ã€‚å¯ä»¥ç†è§£ä½git addçš„åæ“ä½œ git reset â€“hard xxx ä½¿å·¥ä½œåŒºå’Œå½“åœ°ç‰ˆæœ¬åº“ä¿æŒä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯ä¸¢å¼ƒä½ åœ¨å·¥ä½œåŒºåšçš„å·¥ä½œ(è¿˜æ²¡æœ‰æäº¤åˆ°å½“åœ°ç‰ˆæœ¬åº“çš„å†…å®¹) xxxå¯ä»¥æ˜¯ï¼šHEADè¡¨ç¤ºå½“å‰ç‰ˆæœ¬ï¼ŒHEAD^è¡¨ç¤ºä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ŒHEAD^^è¡¨ç¤ºä¸Šä¸Šä¸ªç‰ˆæœ¬ï¼ŒHEAD~10è¡¨ç¤ºä¸Š10ä¸ªç‰ˆæœ¬ï¼›ä¹Ÿå¯ä»¥æ˜¯commitId å¦‚å›¾æ‰€ç¤ºï¼Œæœ¬åœ°ä¿®æ”¹äº†ä¸¤ä¸ªæ–‡ä»¶ï¼ŒçŽ°åœ¨æƒ³æ¢å¤æ–‡ä»¶ï¼Œå¦‚æžœæƒ³ä¸€æ¬¡æ€§å®Œæˆï¼Œä½¿ç”¨å‘½ä»¤git reset â€“hard HEAD,ç›´æŽ¥ä»Žå½“åœ°ç‰ˆæœ¬åº“æ¢å¤ï¼Œç”¨ç‰ˆæœ¬åº“çš„å†…å®¹è¦†ç›–å·¥ä½œåŒºï¼Œè¿™ç§æ“ä½œåªèƒ½å¯¹æ‰€æœ‰æ–‡ä»¶æ“ä½œï¼Œä¸èƒ½é’ˆå¯¹å•ä¸ªæ–‡ä»¶æ“ä½œã€‚å¦‚æžœæƒ³æ¢å¤å•ä¸ªæ–‡ä»¶æˆ–å¤šä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨å‘½ä»¤git checkout â€“ a.txt b.txtã€‚ è¿™ç±»æ“ä½œè¦æ…Žé‡ï¼Œä¸€æ—¦å®Œæˆï¼Œå°±ä¼šä¸¢å¼ƒä¹‹å‰çš„ä¿®æ”¹ï¼Œæ— æ³•æ¢å¤ git checkoutgit checkout â€“ file ä¿æŒå·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶å†…å®¹ä¸€è‡´ï¼Œä»¥æš‚å­˜åŒºä¸ºæ¨¡æ¿ï¼Œæ’¤é”€å·¥ä½œåŒºçš„ä¿®æ”¹ git statusç»“æžœå¦‚å›¾ï¼Œè¡¨ç¤ºæš‚å­˜åŒºçš„å†…å®¹å’Œç‰ˆæœ¬åº“çš„å†…å®¹ä¸€è‡´ï¼Œæ‰€ä»¥git diff â€“cachedæ—¶ï¼Œæš‚å­˜åŒºå’Œæœ¬åœ°ç‰ˆæœ¬åº“å†…å®¹ä¸€è‡´ï¼Œæ²¡æœ‰å·®å¼‚ã€‚ å½“é€šè¿‡git add file1å¾€æš‚å­˜åŒºæ·»åŠ æ–‡ä»¶file1æ—¶ï¼Œæš‚å­˜åŒºå°±æ¯”æœ¬åœ°ç‰ˆæœ¬åº“å¤šäº†ä¸ªæ–‡ä»¶file1çš„æ›´æ”¹ã€‚ æ‰€ä»¥è¦ç†è§£ï¼Œä¸‹å›¾å¹¶ä¸æ˜¯è¯´æš‚å­˜åŒºæ˜¯ç©ºçš„ï¼Œåªæ˜¯è¯´æ˜Žæš‚å­˜åŒºç›¸å¯¹äºŽæœ¬åœ°ç‰ˆæœ¬åº“æ²¡æœ‰å·®å¼‚ï¼Œå³å’Œç‰ˆæœ¬åº“å†…å®¹ä¸€è‡´ git stashï¼šhttps://gist.github.com/subchen/3409a16cb46327ca7691ä¿å­˜å½“å‰çš„å·¥ä½œè¿›åº¦ï¼Œåˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯ç»§ç»­å·¥ä½œï¼Œç„¶åŽåˆ‡å›žåŽŸæ¥çš„åˆ†æ”¯ï¼Œæ¢å¤ä¹‹å‰çš„å·¥ä½œ git stash listæŸ¥çœ‹å½“å‰å­˜å‚¨çš„ä¸´æ—¶çŠ¶æ€ã€‚ git stash pop â€“index 1æ¢å¤ç›¸åº”å­˜å‚¨åŒºçš„å†…å®¹ï¼ŒåŒæ—¶ä»Žè¿™ä¸ªå­˜å‚¨åŒºåˆ é™¤è¿™ä¸ªå­˜å‚¨ã€‚ ä¸‹å›¾indexå€¼åˆ†åˆ«ä¸º0ã€1 æ³¨æ„ï¼šå¤šä¸ªåˆ†æ”¯åˆ‡æ¢æ—¶ï¼Œè¦æ¢å¤ç›¸åº”çš„å­˜å‚¨åŒºå†…å®¹ï¼ŒæŒ‡å®šç›¸åº”çš„ç´¢å¼•å€¼æ¢å¤ã€‚åªä½¿ç”¨å‘½ä»¤git stash popæœ‰å¯èƒ½æ¢å¤æˆå…¶ä»–åˆ†æ”¯çš„å·¥ä½œã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼æŠŠå…¶ä»–åˆ†æ”¯çš„å·¥ä½œçŠ¶æ€å¤åˆ¶åˆ°å½“å‰åˆ†æ”¯ã€‚ åˆ†æ”¯é‡å‘½ågit branch -M new_branch_name git branch -m old_name new_name ä½¿ç”¨git statuså‘½ä»¤æŸ¥çœ‹ï¼šå¯ä»¥çŸ¥é“æœ¬åœ°çš„åˆ†æ”¯æ¯”æœ¬åœ°çš„è¿œç¨‹åˆ†æ”¯å¤šäº†ä¸€æ¬¡æäº¤ã€‚ä½¿ç”¨git pullï¼ˆgit fetch+ git mergeï¼‰æ‹‰å–è¿œç¨‹åˆ†æ”¯ï¼Œå¹¶è¯•å›¾åˆå¹¶æœ¬åœ°åˆ†æ”¯å’Œåˆšåˆšæ›´æ–°çš„å­˜å‚¨åœ¨æœ¬åœ°çš„è¿œç¨‹åˆ†æ”¯æ—¶ï¼Œå‡ºçŽ°å†²çª ä¸‹å›¾è¡¨ç¤ºä»Žæœ¬åœ°å’Œè¿œç¨‹çš„å…±åŒçˆ¶æäº¤ç®—èµ·ï¼Œæœ¬åœ°æœ‰ä¸€æ¬¡æäº¤ï¼Œè¿œç¨‹åˆ†æ”¯æœ‰ä¸‰æ¬¡æäº¤ æ›´åŠ ä¸Šå›¾çš„çŠ¶æ€ï¼Œè¿™é‡Œå…¶å®žä½¿ç”¨git mergeæ›´ä¸ºå‡†ç¡®ã€‚ åˆ°è¿™ä¸€æ­¥ï¼Œä½ å¯ä»¥å–æ¶ˆè¿™æ¬¡git mergeæ“ä½œï¼šgit merge â€“abortã€‚æˆ–è€…è§£å†³å†²çªåŽcommitï¼Œç„¶åŽgit push HEAD:refs/for/xxx_branché‡æ–°æäº¤review git branch æ–°å»ºåˆ†æ”¯ï¼šgit branch branch_name: ä»¥å½“å‰åˆ†æ”¯çš„æœ€åŽä¸€æ¬¡æäº¤ä½œä¸ºæ–°å»ºåˆ†æ”¯çš„æœ€åŽä¸€æ¬¡æäº¤ï¼Œå°±æ˜¯å½“å‰åˆ†æ”¯çš„å¤åˆ¶ï¼Œæäº¤åŽ†å²/ç‰ˆæœ¬åŽ†å²çš„å¤åˆ¶ git branch branch_name commitIdï¼šä»¥å½“å‰åˆ†æ”¯çš„æŸä¸€æ¬¡æäº¤ä½œä¸ºæ–°å»ºåˆ†æ”¯çš„æœ€åŽä¸€æ¬¡æäº¤ï¼Œå°±æ˜¯å½“å‰åˆ†æ”¯æŸæ¬¡æäº¤åŠä¹‹å‰æäº¤åŽ†å²çš„å¤åˆ¶ã€‚æ–¹ä¾¿ä»Žä»»ä½•ä¸€ä¸ªæäº¤ç‚¹æ£€å‡ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ã€‚ è¿™ä¸ªåŠŸèƒ½å¾ˆå¥½ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨å½“å‰åˆ†æ”¯å¼€å‘äº†ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä½†æ˜¯åˆæƒ³å°è¯•è¿™ä¸ªåŠŸèƒ½çš„å¦ä¸€ç§å®žçŽ°æ–¹æ³•ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»Žæ–°åŠŸèƒ½æäº¤çš„å‰ä¸€æ¬¡æäº¤çš„åœ°æ–¹æ£€å‡ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œé‡æ–°å¼€å‘ï¼Œè€Œä¸å¿…æŠŠå½“å‰å·²ç»å¼€å‘çš„æ–°åŠŸèƒ½ä¿®æ”¹ä¸ºå¦ä¸€ç§å®žçŽ°ã€‚ # æ‰¹é‡ä¿®æ”¹commité‡Œé¢çš„ç”¨æˆ·ä¿¡æ¯å’Œæäº¤è€…ä¿¡æ¯ä»¥ä¸‹ä»£ç å¯ä»¥ä¿®æ”¹æ‰€æœ‰commitçš„Authoré‚®ç®±ï¼šgit filter-branch â€“env-filter â€˜export GIT_AUTHOR_EMAIL=new_author_emailâ€™ â€“ã€‚æ•ˆæžœæƒŠäººå“¦ é™¤äº†GIT_AUTHOR_EMAIL, è¿˜æœ‰GIT_AUTHOR_NAME, GIT_COMMITTER_EMAIL, GIT_COMMITTER_NAMEç­‰å‚æ•°å¯ä»¥ä¿®æ”¹. è°¨æ…Žæ“ä½œï¼šå¯¹äºŽå·²ç»æäº¤çš„ä¿®æ”¹ï¼Œä¼šé€ æˆæœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯å­˜åœ¨åˆ†æ­§ git checkout åˆ‡æ¢åˆ†æ”¯æˆ–è€…æ–°å»ºåˆ†æ”¯git checkout branch_name åˆ‡æ¢åˆ°å·²ç»åˆ›å»ºçš„åˆ†æ”¯ä¸Š git checkout commitId åˆ‡æ¢åˆ°æŸæ¬¡æäº¤ä¸Šï¼Œè®°å¾—åˆ‡æ¢åŽçš„çŠ¶æ€æ˜¯ä¸ªä¸´æ—¶çŠ¶æ€ï¼Œä½ æ‰€åšçš„æ‰€æœ‰ä¿®æ”¹å¦‚æžœä¸ä¿å­˜åˆ°æŸä¸ªåˆ†æ”¯ä¸Šï¼Œå½“ä½ åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯æ—¶ï¼Œå°±å¯èƒ½ä¸¢å¤±ã€‚ é˜²æ­¢ä¸¢å¤±çš„æ–¹æ³•æ˜¯ï¼š 1ã€åˆ‡æ¢å‰æ‰§è¡Œå‘½ä»¤ git branch branch_nameï¼Œç­‰äºŽå¯¹å½“å‰çš„æäº¤åŽ†å²å¤åˆ¶ä¸€ä»½ï¼Œæ–°åˆ†æ”¯å¤‡ä»½åŽï¼Œä»ç„¶åœ¨å½“å‰ä¸´æ—¶åˆ†æ”¯æ“ä½œ 2ã€åˆ‡æ¢å‰æ‰§è¡Œå‘½ä»¤ git checkout -b branch_name, ç­‰äºŽå¯¹å½“å‰çš„æäº¤åŽ†å²å¤åˆ¶ä¸€ä»½ï¼Œå¹¶åŒæ—¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ 3ã€åˆ‡æ¢åŽæ‰§è¡Œå‘½ä»¤ git branch branch_name commitIdï¼Œå…¶ä¸­commitIdæ˜¯åˆ‡æ¢å‰åˆ†æ”¯çš„æœ€åŽä¸€æ¬¡æäº¤commitIdï¼Œåˆ‡æ¢åŽï¼Œå‘½ä»¤è¡Œä¼šæç¤ºç»™ä½ ï¼šå¦‚ä¸‹å›¾æ‰€ç¤ºçš„â€œ6c91c0aâ€ git checkout -b branch_name æ–°å»ºåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¿™ä¸ªåˆ†æ”¯ï¼Œæ–°åˆ†æ”¯ç›¸å½“äºŽåŽŸæ¥åˆ†æ”¯çš„ä¸€ä¸ªå‰¯æœ¬ git checkout -b branch_name commitId æ–°å»ºåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¿™ä¸ªåˆ†æ”¯ï¼Œæ–°åˆ†æ”¯ç›¸å½“äºŽåŽŸæ¥åˆ†æ”¯ä»ŽæŸæ¬¡æäº¤å¼€å§‹å¾€å‰çš„æ‰€æœ‰æäº¤åŽ†å²çš„ä¸€ä¸ªå‰¯æœ¬ å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå½“æˆ‘ä»¬åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸Šä¿®æ”¹å®Œï¼Œå¦‚æžœæ²¡æœ‰git add/git commitæäº¤åŽï¼Œæˆ–è€…git stashä¿æŒå½“å‰çŠ¶æ€ï¼Œæ˜¯æ— æ³•è¿›è¡Œåˆ†æ”¯åˆ‡æ¢çš„ã€‚å½“æ—¶å¯¹äºŽä¸´æ—¶åˆ†æ”¯æ˜¯å¯ä»¥çš„ï¼Œè€Œä¸”ä¼šæŠŠåŽ†å²åˆ†æ”¯çš„ä¿®æ”¹å¸¦åˆ°åˆ‡æ¢åŽçš„åˆ†æ”¯ä¸Šï¼Œæ›´åŠ æœ‰æ„æ€çš„æ˜¯ï¼Œå¯ä»¥æŠŠä¿®æ”¹å¸¦åˆ°ä»»ä½•ä¸€ä¸ªå…¶ä»–å·²ç»å­˜åœ¨çš„åˆ†æ”¯æˆ–è€…æŸä¸€æ¬¡æäº¤commitIdä¸Šæˆ–è€…æ–°å»ºçš„åˆ†æ”¯ä¸Š git checkout â€“ file1 æ£€æŸ¥æ–‡ä»¶file1ï¼Œæ³¨æ„æ ¼å¼ â€œâ€“â€ ä½œç”¨æ˜¯æ˜Žæ˜¾çš„ï¼Œå› ä¸ºå¦‚æžœå­˜åœ¨å’Œfile1åŒåçš„åˆ†æ”¯ï¼Œé‚£ä¹ˆä¼šè¢«è®¤ä¸ºæ˜¯åˆ‡æ¢åˆ†æ”¯æ“ä½œï¼Œè€Œä¸æ˜¯æ£€å‡ºæ–‡ä»¶æ“ä½œã€‚å¦‚å›¾ï¼šåŒæ—¶å­˜åœ¨æ–‡ä»¶testå’Œåˆ†æ”¯test git checkout commitId â€“ test æ£€æŸ¥æŸä¸ªæ–‡ä»¶æŸæ¬¡æäº¤æ—¶çš„å†…å®¹ã€‚è¿™ä¸ªåŠŸèƒ½æŒºæœ‰ç”¨çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å¼€å‘äº†å¾ˆä¹…ï¼Œä¸­é—´æäº¤äº†å¤šæ¬¡ï¼Œç„¶åŽå¿½ç„¶å‘çŽ°æŸä¸ªæ–‡ä»¶ä¿®æ”¹é”™äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶æ¢å¤åˆ°ä»¥å‰æŸæ¬¡æäº¤çš„çŠ¶æ€ï¼Œè€Œä¸ç”¨ä¿®æ”¹å…¶ä»–æ–‡ä»¶çš„ä¿®æ”¹ã€‚æ—§çš„æ–‡ä»¶ç‰ˆæœ¬ä¼šæ˜¾ç¤ºä¸ºã€Œéœ€è¦æäº¤çš„æ›´æ”¹ã€ï¼Œå…è®¸ä½ å›žæ»šåˆ°æ–‡ä»¶ä¹‹å‰çš„ç‰ˆæœ¬ã€‚ å‚è€ƒï¼šhttps://github.com/geeeeeeeeek/git-recipes/wiki/2.5-%E6%A3%80%E5%87%BA%E4%B9%8B%E5%89%8D%E7%9A%84%E6%8F%90%E4%BA%A4 git logæ ¼å¼åŒ–Logè¾“å‡ºï¼šgit log â€“oneline åªæ˜¾ç¤ºæäº¤IDå’Œæäº¤ä¿¡æ¯çš„ç¬¬ä¸€è¡Œ git log â€“decorate å¾ˆå¤šæ—¶å€™ï¼ŒçŸ¥é“æ¯ä¸ªæäº¤å…³è”çš„åˆ†æ”¯æˆ–è€…æ ‡ç­¾å¾ˆæœ‰ç”¨ã€‚--decorate æ ‡è®°è®© git log æ˜¾ç¤ºæŒ‡å‘è¿™ä¸ªæäº¤çš„æ‰€æœ‰å¼•ç”¨ï¼ˆæ¯”å¦‚è¯´åˆ†æ”¯ã€æ ‡ç­¾ç­‰ï¼‰ git log â€“all æ˜¾ç¤ºæ‰€æœ‰åˆ†æ”¯çš„æäº¤ git log â€“stat / git log -p æä¾›äº†å¾ˆå¤šé€‰é¡¹æ¥æ˜¾ç¤ºä¸¤ä¸ªæäº¤ä¹‹é—´çš„å·®å¼‚ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ˜¯ --stat å’Œ -pã€‚ git shortlog æ˜¯ä¸€ç§ç‰¹æ®Šçš„ git logï¼Œå®ƒæ˜¯ä¸ºåˆ›å»ºå‘å¸ƒå£°æ˜Žè®¾è®¡çš„ã€‚å®ƒæŠŠæ¯ä¸ªæäº¤æŒ‰ä½œè€…åˆ†ç±»ï¼Œæ˜¾ç¤ºæäº¤ä¿¡æ¯çš„ç¬¬ä¸€è¡Œã€‚è¿™æ ·å¯ä»¥å®¹æ˜“åœ°çœ‹åˆ°è°åšäº†ä»€ä¹ˆã€‚ git log --graph é€‰é¡¹ç»˜åˆ¶ä¸€ä¸ª ASCII å›¾åƒæ¥å±•ç¤ºæäº¤åŽ†å²çš„åˆ†æ”¯ç»“æž„ã€‚å®ƒç»å¸¸å’Œ --oneline å’Œ --decorate ä¸¤ä¸ªé€‰é¡¹ä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·ä¼šæ›´å®¹æ˜“æŸ¥çœ‹å“ªä¸ªæäº¤å±žäºŽå“ªä¸ªåˆ†æ”¯ï¼š git log branch_name/comitId æ˜¾ç¤ºæŸä¸ªåˆ†æ”¯æˆ–è€…æŸä¸ªæäº¤çš„log è¿‡æ»¤æäº¤åŽ†å²1234git log -3 åªæ˜¾ç¤ºæœ€æ–°çš„3æ¬¡æäº¤git log --after="2014-7-1" --before="2014-7-4"git log --author="John"git log -- foo.py bar.py `` 1git log master..feature å…¶ä¸­çš„ master..feature èŒƒå›´åŒ…å«äº†åœ¨ feature åˆ†æ”¯è€Œä¸åœ¨ master åˆ†æ”¯ä¸­æ‰€æœ‰çš„æäº¤ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥çœ‹å‡ºä»Ž master åˆ†æ”¯ fork åˆ° feature åˆ†æ”¯åŽå‘ç”Ÿäº†å“ªäº›å˜åŒ– è¿‡æ»¤åˆå¹¶æäº¤git log è¾“å‡ºæ—¶é»˜è®¤åŒ…æ‹¬åˆå¹¶æäº¤ã€‚ä½†æ˜¯ï¼Œå¦‚æžœä½ çš„å›¢é˜Ÿé‡‡ç”¨å¼ºåˆ¶åˆå¹¶ç­–ç•¥ï¼ˆæ„æ€æ˜¯ merge ä½ ä¿®æ”¹çš„ä¸Šæ¸¸åˆ†æ”¯è€Œä¸æ˜¯å°†ä½ çš„åˆ†æ”¯ rebase åˆ°ä¸Šæ¸¸åˆ†æ”¯ï¼‰ï¼Œä½ çš„é¡¹ç›®åŽ†å²ä¸­ä¼šæœ‰å¾ˆå¤šå¤–æ¥çš„æäº¤ã€‚ ä½ å¯ä»¥é€šè¿‡ --no-merges æ ‡è®°æ¥æŽ’é™¤è¿™äº›æäº¤ï¼š 1git log --no-merges å¦ä¸€æ–¹é¢ï¼Œå¦‚æžœä½ åªå¯¹åˆå¹¶æäº¤æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥ä½¿ç”¨ --merges æ ‡è®°ï¼š 1git log --merges å®ƒä¼šè¿”å›žæ‰€æœ‰åŒ…å«ä¸¤ä¸ªçˆ¶èŠ‚ç‚¹çš„æäº¤ã€‚ 1git log --graph --decorate --oneline --simplify-by-decoration --all è¯´æ˜Žï¼š â€“decorate æ ‡è®°ä¼šè®©git logæ˜¾ç¤ºæ¯ä¸ªcommitçš„å¼•ç”¨(å¦‚:åˆ†æ”¯ã€tagç­‰) â€“oneline ä¸€è¡Œæ˜¾ç¤º â€“simplify-by-decoration åªæ˜¾ç¤ºè¢«branchæˆ–tagå¼•ç”¨çš„commit â€“all è¡¨ç¤ºæ˜¾ç¤ºæ‰€æœ‰çš„branchï¼Œè¿™é‡Œä¹Ÿå¯ä»¥é€‰æ‹©ï¼Œæ¯”å¦‚æˆ‘åªæƒ³æ˜¾ç¤ºåˆ†æ”¯ABCçš„å…³ç³»ï¼Œåˆ™å°†â€“allæ›¿æ¢ä¸ºbranchA branchB branchC gitç•Œé¢git gui gitkä¸æŒ‰ç…§æ—¶é—´æŽ’åºçš„æäº¤ gitk -dä¸æŒ‰ç…§æ—¶é—´æŽ’åºçš„æäº¤ å‚è€ƒï¼šhttps://github.com/geeeeeeeeek/git-recipes/wiki/5.3-Git-log-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95 git rebase# git rebase -i HEAD~3 å¯¹æœ€è¿‘ä¸‰æ¬¡çš„æäº¤åŽ†å²è¿›è¡Œå˜åŸº è¿™é‡Œé¡ºå¸¦è®²ä¸‹æ¯æ¬¡commitçš„æ„æ€ï¼šæ¯æ¬¡commitéƒ½è®°å½•äº†è¿™æ¬¡commit(æˆ–è€…è¿™ä¸ªç‰ˆæœ¬)æ‰€åšçš„æ›´æ”¹ï¼Œå¦‚æžœåˆ é™¤äº†æŸæ¬¡çš„commitï¼Œé‚£ä¹ˆè¿™æ¬¡commitæ‰€åšçš„æ›´æ”¹å°±ä¼šä¸¢å¤±ã€‚ä¸¾ä¸ªä¾‹å­ï¼š åˆ›å»ºå¹¶ç¼–å†™æ–‡ä»¶1.txtçš„å†…å®¹ï¼Œgit add 1.txtï¼Œgit commit -m â€˜add 1.txt and edit itâ€™ï¼Œäº§ç”ŸcommitId1 åˆ›å»ºå¹¶ç¼–å†™æ–‡ä»¶2.txtçš„å†…å®¹ï¼Œgit add 2.txtï¼Œgit commit -m â€˜add 2.txt and edit itâ€™ï¼Œäº§ç”ŸcommitId2 ä¿®æ”¹æ–‡ä»¶1.txtçš„å†…å®¹ï¼Œgit commit -am â€˜modify 1.txtâ€™ï¼Œäº§ç”ŸcommitId3 æ‰§è¡Œå‘½ä»¤git rebase -i HEAD~3ï¼Œåˆ é™¤å‰ä¸¤æ¬¡æäº¤commitId1å’ŒcommitId2ï¼Œç»“æžœå°±æ˜¯ï¼š2.txtæ–‡ä»¶ç›´æŽ¥è¢«åˆ é™¤ï¼Œä½†æ˜¯1.txtå­˜åœ¨å†²çªï¼ŒåŽŸå› æ˜¯commitId1çš„æ—¶å€™åˆ›å»ºäº†ï¼Œé‚£ä¹ˆåˆ é™¤è¿™ä¸ªcommitId1çš„æ—¶å€™ï¼Œè‡ªç„¶ä¹Ÿä¼šæŠŠè¿™ä¸ªæ–‡ä»¶åˆ é™¤ï¼Œå¯ä»¥æ˜¯commitId3çš„æ—¶å€™åˆä¿®æ”¹äº†è¿™ä¸ªæ–‡ä»¶ï¼Œè€Œä¸”å¹¶æ²¡æœ‰åˆ é™¤commitId3ï¼Œå› æ­¤å­˜åœ¨ä¿®æ”¹äº†ä¸€ä¸ªå·²ç»åˆ é™¤çš„æ–‡ä»¶çš„å†²çª æŸ¥çœ‹çŠ¶æ€ï¼šè§£å†³åŠžæ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯git rebase â€“skipä¸¢å¼ƒcommitId3æ‰€åšçš„ä¿®æ”¹ï¼Œè¿™æ ·1.txtæ–‡ä»¶ä¹Ÿè¢«åˆ é™¤ï¼›å¦ä¸€ç§æ˜¯git add 1.txtï¼Œè¿™æ ·commitId1åˆ›å»ºå¹¶ä¿®æ”¹çš„1.txtçš„å†…å®¹å’ŒcommitId3ä¿®æ”¹çš„å†…å®¹éƒ½ä¼šä¿ç•™ä¸‹æ¥ã€‚ä½ å¯ä»¥æ ¹æ®æç¤ºä½¿ç”¨å‘½ä»¤git reset HEAD 1.txtå’Œå‘½ä»¤git rm 1.txtè§£å†³å†²çªï¼Œæ•ˆæžœæ˜¯ï¼Œgit reset HEAD 1.txtä¿ç•™äº†æ–‡ä»¶1.txtä»¥åŠ1.txtçš„å†…å®¹åœ¨å·¥ä½œåŒºã€‚git rm 1.txtåˆ™æ˜¯åˆ é™¤äº†1.txtæ–‡ä»¶ã€‚ æ‰€æœ‰ä½¿ç”¨å‘½ä»¤git rebase -i HEAD~næ—¶æ…Žé‡ä½¿ç”¨é€‰é¡¹d, drop = remove commitï¼Œä¼šåˆ é™¤æäº¤åŽ†å²é‡Œçš„æ–‡ä»¶ä»¥åŠä¿®æ”¹å†…å®¹ã€‚äº§ç”Ÿç ´åï¼Œé™¤éžä½ æ¸…æ¥šä½ åœ¨åšä»€ä¹ˆã€‚ é€‰é¡¹s, squash = use commit, but meld into previous commitçš„ä½œç”¨æ˜¯åˆå¹¶åŽ†å²æäº¤ï¼ŒæŠŠå¤šä¸ªcommitIdåˆå¹¶ä½ä¸€ä¸ªï¼Œå‡å°‘æ— ç”¨commitIdçš„æ•°é‡ã€‚ä¿ç•™è¢«åˆå¹¶æäº¤çš„æäº¤ä¿¡æ¯å†…å®¹ã€‚ é€‰é¡¹f, fixup = like â€˜squashâ€™, but discard this commitâ€™s log messageçš„ä½œç”¨æ˜¯åˆå¹¶åŽ†å²æäº¤ï¼ŒæŠŠå¤šä¸ªcommitIdåˆå¹¶ä½ä¸€ä¸ªï¼Œå‡å°‘æ— ç”¨commitIdçš„æ•°é‡ã€‚å’Œsquashçš„åŒºåˆ«æ˜¯ï¼Œä¸ä¿å­˜è¢«åˆå¹¶çš„æäº¤çš„æäº¤ä¿¡æ¯å†…å®¹ï¼Œç›´æŽ¥åˆ é™¤ã€‚ å¦å¤–git rebase -i HEAD~nä¼šé‡æ–°å¯¹æ¶‰åŠçš„commitIdå€¼è¿›è¡Œä¿®æ”¹ git showgit show commitId æ˜¾ç¤ºæŸä¸€æ¬¡æäº¤çš„å†…å®¹ git diff commitId^! æ˜¾ç¤ºæŸä¸€æ¬¡æäº¤çš„å†…å®¹ git log -p -n æŸ¥çœ‹æœ€è¿‘næ¬¡æäº¤çš„ä¿®æ”¹ git update-refgit update-ref refs/heads/test cac0ca ä½¿åˆ†æ”¯testæŒ‡å‘commitId=cac0ca æœ‰ç‚¹git reset cac0caçš„æ•ˆæžœ git symbolic-refæœ‰ç‚¹git checkout branch_name åˆ‡æ¢åˆ†æ”¯çš„æ„Ÿè§‰ git symbolic-ref HEAD refs/heads/test æŠŠHEADé‡Œçš„å†…å®¹å˜ä¸ºrefs/heads/test git cherry-pickgit cherry-pick commitId æŠŠæŸä¸ªåˆ†æ”¯çš„æŸæ¬¡æäº¤çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ git cherry-pick -m 1 commitId æŠŠæŸä¸ªåˆ†æ”¯çš„æŸæ¬¡åˆå¹¶æäº¤çš„å†…å®¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚æ„æ€æ˜¯commitIdæœ‰mergeæ“ä½œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯¦ç»†ä»‹ç»å‚è€ƒï¼šhttps://segmentfault.com/q/1010000010185984ï¼›https://blog.csdn.net/zhangxiaoyang0/article/details/79299203 git rev-parsegit rev-parse â€“git-dir æ˜¾ç¤ºç‰ˆæœ¬åº“.gitç›®å½•æ‰€åœ¨ä½ç½®git rev-parse â€“show-toplevel æ˜¾ç¤ºå·¥ä½œåŒºæ ¹ç›®å½•git rev-parse â€“show-prefix æ‰€åœ¨ç›®å½•ç›¸å¯¹äºŽå·¥ä½œåŒºæ ¹ç›®å½•çš„ç›¸å¯¹ç›®å½•git rev-parse â€“show-cdup æ˜¾ç¤ºä»Žå½“å‰ç›®å½•åŽé€€åˆ°å·¥ä½œåŒºçš„æ ¹çš„èº«åº¦ 12git rev-parse origin/ivs180926115904^&#123;commit&#125;git rev-parse ivs180926115904^&#123;commit&#125; å¦‚æžœä½ æƒ³çŸ¥é“æŸä¸ªåˆ†æ”¯æŒ‡å‘å“ªä¸ªç‰¹å®šçš„ SHAï¼Œæˆ–è€…æƒ³çœ‹ä»»ä½•ä¸€ä¸ªä¾‹å­ä¸­è¢«ç®€å†™çš„ SHA-1ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš rev-parse çš„ Git æŽ¢æµ‹å·¥å…·ã€‚ç®€å•æ¥è¯´ï¼Œrev-parse æ˜¯ä¸ºäº†åº•å±‚æ“ä½œè€Œä¸æ˜¯æ—¥å¸¸æ“ä½œè®¾è®¡çš„ã€‚ä¸è¿‡ï¼Œæœ‰æ—¶ä½ æƒ³çœ‹ Git çŽ°åœ¨åˆ°åº•å¤„äºŽä»€ä¹ˆçŠ¶æ€æ—¶ï¼Œå®ƒå¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚è¿™é‡Œä½ å¯ä»¥å¯¹ä½ çš„åˆ†æ”¯è¿æ‰§è¡Œ rev-parseã€‚ 12$ git rev-parse topic1ca82a6dff817ec66f44342007202690a93763949 git grepgit grep â€“help git grep -in wwwåœ¨å½“å‰ä»“åº“æ‰€æœ‰æ–‡ä»¶ä¸­æœç´¢å†…å®¹â€˜wwwwâ€™ï¼Œ-iè¡¨ç¤ºå¿½ç•¥å¤§å°å†™ï¼Œ-nè¡¨ç¤ºæ˜¾ç¤ºæœç´¢å†…å®¹æ‰€åœ¨çš„è¡Œ 12git ``grep` `--name-only www æœç´¢åˆ°çš„å†…å®¹åªæ˜¾ç¤ºæ–‡ä»¶ågit ``grep` `-c www æ˜¾ç¤ºæœç´¢åˆ°çš„å†…å®¹çš„åŒ¹é…çš„ä¸ªæ•° git grep www commit_id é’ˆå¯¹æŸä¸ªç‰ˆæœ¬è¿›è¡Œæœç´¢ 123git ``grep` `-e å†…å®¹1 --and/--or -e å†…å®¹2 æ¡ä»¶æœç´¢git ``grep` `-e å†…å®¹1 --and \( -e ant -e å†…å®¹2 \)git ``grep` `--all-match -e å†…å®¹1 --or -e å†…å®¹2 --all-matchè¡¨ç¤ºå…¨åŒ¹é…ï¼Œ å…¨åŒ¹é…å’Œæ™®é€šåŒ¹é…çš„åŒºåˆ«åœ¨äºŽï¼Œå…¨åŒ¹é…å¿…é¡»åœ¨å…¨æ–‡æ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ã€‚å¦‚æžœæ˜¯å…¨åŒ¹é…ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶å…·æœ‰â€å†…å®¹1â€å’Œâ€å†…å®¹2â€ï¼ˆæ²¡è¦åŒä¸€è¡Œï¼‰ã€‚è€Œæ™®é€šåŒ¹é…ï¼Œåªè¦åœ¨æ–‡ä»¶ä¸­å…·æœ‰â€å†…å®¹1â€æˆ–è€…â€å†…å®¹2â€ä¸­çš„ä¸€ä¸ªå³å¯ã€‚ http://www.softwhy.com/article-8652-1.html git cat-file -p hash_idæŸ¥çœ‹æŸæ¬¡hashå€¼å¾—å†…å®¹ git ls-tree commit_idæŸ¥çœ‹æŸæ¬¡æäº¤åŒ…å«çš„å†…å®¹çš„hashå€¼]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è½¯ä»¶ç³»ç»Ÿå¿«æ·é”®]]></title>
    <url>%2F2017%2F11%2F08%2FMac%E7%AC%94%E8%AE%B0%E6%9C%AC%E5%BF%AB%E6%8D%B7%E9%94%AE%2F</url>
    <content type="text"><![CDATA[macç³»ç»Ÿ12Command + K æ¸…å±Control + C é€€å‡ºå‘½ä»¤ 123456789101112131415161718âŒ˜ Commandâ‡§ ShiftâŒ¥ OptionâŒƒ Controlâ†©ï¸Ž Return/EnterâŒ« DeleteâŒ¦ å‘å‰åˆ é™¤é”®ï¼ˆFn+Deleteï¼‰â†‘ ä¸Šç®­å¤´â†“ ä¸‹ç®­å¤´â† å·¦ç®­å¤´â†’ å³ç®­å¤´â‡ž Page Upï¼ˆFn+â†‘ï¼‰â‡Ÿ Page Downï¼ˆFn+â†“ï¼‰Home Fn + â†End Fn + â†’â‡¥ å³åˆ¶è¡¨ç¬¦ï¼ˆTabé”®ï¼‰â‡¤ å·¦åˆ¶è¡¨ç¬¦ï¼ˆShift+Tabï¼‰âŽ‹ Escape (Esc) chromeå¿«æ·é”®(mac)12command + R åˆ·æ–°command shift R å¼ºåˆ¶åˆ·æ–°]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>å¿«æ·é”®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[java å‘½ä»¤]]></title>
    <url>%2F2017%2F11%2F08%2Fjava-%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[12java -jar å¯åŠ¨jaråŒ… æŒ‡å®šspring profilejava -jar microservice-discovery-eureka-0.0.1-SNAPSHOT.jar --spring.profiles.active=peer1]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MacOSX10.5+å¿«æ·é”®æ•´ç†-é‡è¦]]></title>
    <url>%2F2017%2F11%2F05%2FMacOSX10.5%2B%E5%BF%AB%E6%8D%B7%E9%94%AE%E6%95%B4%E7%90%86-%E9%87%8D%E8%A6%81%2F</url>
    <content type="text"><![CDATA[ä»£ç ç¼–è¾‘(é‡è¦çš„ï¼Œä¼˜å…ˆçº§é«˜)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869 1. shift é…åˆå·¦å³é”®ï¼Œç”¨äºŽé€‰ä¸­ 2. Control M ç§»åŠ¨åˆ°æ‹¬å·çš„å¼€å§‹ç»“æŸ 3. Alter command [ ] ç§»åŠ¨åˆ°ä»£ç å—çš„å¼€å§‹å’Œç»“æŸ , å†åŠ ä¸Šshiftå¯ä»¥é€‰ä¸­å­—ç¬¦ 4 command åŠ ä¸Šå·¦å³é”®ï¼Œç§»åŠ¨åˆ°è¡Œçš„ç»“æŸæˆ–å¼€å¤´ã€‚å¸¦ä¸Šshiftå¯ä»¥é€‰ä¸­å­—ç¬¦ 5 Alter åŠ ä¸Šå·¦å³é”®ï¼Œç§»åŠ¨åˆ°ä¸Šä¸€ä¸‹æˆ–ä¸‹ä¸€ä¸ªå•è¯ã€‚å¸¦ä¸Šshiftå¯ä»¥é€‰æ‹©å­—ç¬¦ Shitft command u åˆ‡æ¢å¤§å°å†™ alter command u åˆ‡æ¢é©¼å³° toggle camel case command N ç”ŸæˆmapperåŠdao command alter T ç”Ÿæˆtry catchä»£ç å— command L è·³åˆ°æŒ‡å®šè¡Œ Alt + F8 è®¡ç®—å˜é‡è¡¨è¾¾å¼ 1.Alt+â¬†ï¸/â¬‡ï¸ ---------------- é€‰ä¸­ä»£ç  2.option+shift +â¬†ï¸/â¬‡ï¸ -------------- ä¸Šä¸‹ç§»åŠ¨ä»£ç è¡Œ shitft command + ä¸Šä¸‹ç§»åŠ¨é€‰ä¸­çš„ä»£ç  3.cmd+d -------------- å¤åˆ¶å½“å‰è¡Œåˆ°ä¸‹ä¸€è¡Œ- â‡ž Page Upï¼ˆFn+â†‘ï¼‰- â‡Ÿ Page Downï¼ˆFn+â†“ï¼‰ äºŒ ä»£ç çš„ç§»åŠ¨ 1.Alt+â¬†ï¸/â¬‡ï¸ ---------------- é€‰ä¸­ä»£ç  2.option+shift +â¬†ï¸/â¬‡ï¸ -------------- ä¸Šä¸‹ç§»åŠ¨ä»£ç  3.cmd+d -------------- å¤åˆ¶å½“å‰è¡Œåˆ°ä¸‹ä¸€è¡Œ 4.cmd+x -------------- å‰ªåˆ‡ 5.ctrl+k -------------- åˆ é™¤è¡Œ 6.cmd+option+l ------------- æ ¼å¼åŒ–ä»£ç  7.ctrl+alt+o -------------- æ¸…é™¤æ— æ•ˆçš„å¼•ç”¨åŒ… ä¸‰ ä»£ç æ³¨é‡Š 1.cmd+/ --------------- å•è¡Œæ³¨é‡Š 2.cmd+option+/ ------------- å¤šè¡Œæ³¨é‡Š 3.ctrl+alt+/ ------------ ä¸ºæ–¹æ³•æˆ–å˜é‡æ·»åŠ æ³¨é‡Šè¯´æ˜Ž(ä¸ªäººè®¾ç½®çš„,å¤§å®¶æ ¹æ®è‡ªå·±ä¹ æƒ¯è‡ªè¡Œè®¾ç½®) å›› ä»£ç æŸ¥çœ‹ 1.cmd+f ----------- æŸ¥æ‰¾ 2.cmd+r ----------- æŸ¥æ‰¾/æ›¿æ¢ 3.ctrl+o ----------- æŸ¥çœ‹è¯¥ç±»ä¸­å¯ä»¥é‡å†™çš„æ–¹æ³• 4.cmd+y ------------ æŸ¥çœ‹æ–¹æ³•çš„æ–¹æ³•ä½“ï¼Œåœ¨é¢„è§ˆæ¡†ä¸­æ˜¾ç¤º 5.cmd+â¬…ï¸/â†’ ---------- å¿«æ·å®šä½åˆ°è¡Œé¦–å’Œè¡Œå°¾ 6.cmd+/- ----------- å±•å¼€æˆ–è€…æŠ˜å  7.ctrl+option+h ----------- è·Ÿè¸ªæŸä¸ªæ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½® 8.cmd+option_â¬…ï¸ ------------ ä»£ç è¿”å›ž(æŸ¥çœ‹ä¹‹å‰çœ‹çš„ä½ç½®) 9.ctrl+h ----------- æŸ¥çœ‹ç»“æž„ç±»å›¾ 10.cmd+alt+b --------- æŸ¥çœ‹å½“å‰ç±»çš„å®žçŽ°ç±» 11.âŒ˜O:åœ¨å½“å‰project(ä¸€ä¸ªprojectå¯ä»¥å«å¤šä¸ªmoudle)ä¸­æœç´¢class,å†æŒ‰ä¸€æ¬¡âŒ˜Oï¼Œæœç´¢ç»“æžœå¯åŒ…å«éžprojectä¸­çš„classï¼Œå¦‚external librariesä¸­çš„android.jaré‡Œçš„classå¯ä»¥åœ¨æœç´¢æ–‡æœ¬åŽè·Ÿ:lineNumber ä»Žè€Œå®šä½åˆ°æŸè¡Œ. 12.âŒ˜O:åœ¨å½“å‰project(ä¸€ä¸ªprojectå¯ä»¥å«å¤šä¸ªmoudle)ä¸­æœç´¢class,å†æŒ‰ä¸€æ¬¡âŒ˜Oï¼Œæœç´¢ç»“æžœå¯åŒ…å«éžprojectä¸­çš„classï¼Œå¦‚external librariesä¸­çš„android.jaré‡Œçš„classå¯ä»¥åœ¨æœç´¢æ–‡æœ¬åŽè·Ÿ:lineNumber,ä»Žè€Œå®šä½åˆ°æŸè¡Œ. 13.â‡§âŒ˜O:åœ¨å½“å‰projectä¸­æœç´¢file(åŒ…å«ä¸Šé¢çš„classç»“æžœ),å†æŒ‰ä¸€æ¬¡â‡§âŒ˜O,æœç´¢ç»“æžœå¯åŒ…å«éžprojectä¸­çš„flieï¼Œå¦‚external librariesä¸­çš„resé‡Œçš„fileå¯ä»¥åœ¨æœç´¢æ–‡æœ¬åŽè·Ÿ:lineNumber,ä»Žè€Œå®šä½åˆ°æŸè¡Œ. 14.âŒ¥âŒ˜O:åœ¨å½“å‰projectä¸­æœç´¢file(åŒ…å«ä¸Šé¢çš„classã€fileç»“æžœåŠmethod) äº” ä»£ç ç”Ÿæˆ 1.cmd+n å¿«æ·ç”Ÿæˆ get/setæ–¹æ³• æž„é€ å™¨ç­‰ 2.cmd+j ä»£ç æ¨¡æ¿ç”Ÿæˆ(if for foreach findViewById VIew.Gone Toast ç­‰) 3.cmd+t try_catch if_else for ç­‰è‡ªåŠ¨ç”Ÿæˆ å…­ å…¶ä»– 1.cmd+shift+u ------------ å¤§å°å†™æ ¼å¼åŒ– 2.ctrl+d ------------ debug è°ƒè¯•APP 3.ctrl+r ------------ run APP 4.ctrl+v ------------ ç‰ˆæœ¬æŽ§åˆ¶ 1.ä»£ç ç›¸å…³ï¼š1.åˆ é™¤å½“å‰è¡Œ command+delete/command+x2.å¤åˆ¶å½“å‰è¡Œ command+d3.ç§»åŠ¨å½“å‰è¡Œ shift+command+â†‘4.æŸ¥æ‰¾å˜é‡ä½¿ç”¨çš„åœ°æ–¹ alt+f75.ç”Ÿæˆtry/catchä»£ç  alt+command+f76.è·³è‡³ä¸Šæ–¹(çˆ¶ç±»)çš„å±‚çº§ common+u7.è·³è‡³ä¸‹æ–¹(å­ç±»)çš„å±‚çº§ alt+commond+b8.æŸ¥æ‰¾é€‰ä¸­çš„å­—ç¬¦åœ¨å·¥ç¨‹ä¸­å‡ºçŽ°çš„åœ°æ–¹ command+alt+f79.é€‰ä¸­æ–‡æœ¬ï¼Œé«˜äº®æ˜¾ç¤ºæ‰€æœ‰è¯¥æ–‡æœ¬ï¼ŒæŒ‰Escé«˜äº®æ¶ˆå¤± command+shift+F710.å‡ºçŽ°ç”Ÿæˆget,setæ–¹æ³•çš„ç•Œé¢ ctrl+enter11.åœ¨å½“å‰æ–‡ä»¶ä¸­æ›¿æ¢ commond+r12.åœ¨æ•´ä¸ªå·¥ç¨‹ä¸­æ›¿æ¢ commond+shift+r13.æŠŠå¤šè¡Œè¿žæŽ¥æˆä¸€è¡Œï¼Œä¼šåŽ»æŽ‰ç©ºæ ¼çš„è¡Œ control+shift+J14.å¯¼å…¥åŒ…ï¼Œè‡ªåŠ¨ä¿®æ”¹ alt+enter15.æ ¼å¼åŒ–ä»£ç  command+alt+L16.å¤§å°å†™è½¬æ¢ command+shift+U17.æ³¨é‡Š/å–æ¶ˆä¸€è¡Œæˆ–ç€å¤šè¡Œ command+/18.æ³¨é‡Š/â€¦/æˆ–å–æ¶ˆ command+alt+/19.è¿”å›žæœ€å·¦è¾¹æœ€å³è¾¹ command+å·¦å³ç®­å¤´20.è°ƒå‡ºIDEAçš„ç¥žå™¨live template commond+J21.è°ƒå‡ºIDEAå¯„å­˜å™¨ä¸­ä¿å­˜çš„æœ€è¿‘å¤åˆ¶çš„Nä»½å†…å®¹ï¼Œå¯é€‰æ‹©æ€§ç²˜è´´ shift + cmd + v22.ç¥žå™¨ï¼Œè¡¥å…¨å½“å‰è¡Œï¼Œæœ€å¸¸ç”¨çš„åœºæ™¯æ—¶è¡¥å…¨å½“å‰è¡ŒåŽçš„ï¼›å·ï¼Œå¹¶å°†å…‰æ ‡å®šä½åˆ°ä¸‹ä¸€è¡Œ shift + cmd + enter 2.æ–‡ä»¶ç›¸å…³ï¼š1.æŸ¥æ‰¾æ–‡ä»¶ shift+shift2.æ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„ç»“æž„ Cmd+F123.è·³è½¬åˆ°å¯¼èˆªæ ï¼ŒæŸ¥çœ‹é¡¹ç›®æ ‘ Cmd+å‘ä¸Šé”®4.æŸ¥çœ‹æœ‰å…³æ‰€æœ‰å®žçŽ°æˆ–è€…è¦†å†™äº†å½“å‰æ–¹æ³•çš„ç±»çš„ç»“æž„å›¾ shift+commond+h5.æœ€è¿‘ç¼–è¾‘è¿‡çš„æ–‡ä»¶ shift+commond+e6.æ˜¾ç¤ºæœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶ command + E7.æ·»åŠ ä¹¦ç­¾ F38.æ˜¾ç¤ºä¹¦ç­¾ command + F3 9.ç§»åŠ¨æ–‡ä»¶åˆ°å…¶å®ƒåœ°æ–¹ F610.æ‹·è´æ–‡ä»¶åˆ°å…¶å®ƒåœ°æ–¹ F511.æ–°å»ºæ–‡ä»¶ï¼ˆé€‰ä¸­æ ¹ç›®å½•ï¼‰ commond+N12.é€‰ä¸­æ–‡ä»¶æ¥é‡å‘½å shift+f6 3.ç•Œé¢çª—å£ç›¸å…³ï¼š1.éšè—å½“å‰è§†å›¾ shift ï¼‹ esc2.è°ƒå‡ºsettingç•Œé¢ cmd + ,3.è°ƒå‡ºé¡¹ç›®settingç•Œé¢ cmd + ;4.å…³é—­å½“å‰æ–‡ä»¶ commond+w5.é€€å‡ºIdea commond+Q6.ä¸‡èƒ½å¿«æ·é”®ï¼šshift + command + Aï¼ˆé€‚ç”¨äºŽä¸çŸ¥é“å¿«æ·é”®ï¼Œä½†æ˜¯çŸ¥é“æ“ä½œçš„éƒ¨åˆ†åŠ¨ä½œã€‚å¦‚ï¼Œè¾“å…¥â€openâ€ä¼šåˆ—å‡ºä¸€ç³»åˆ—å’Œæ‰“å¼€ç›¸å…³çš„æ“ä½œã€‚ï¼‰ mac é”®ç›˜ç¬¦å· âŒ˜ Command â‡§ Shift âŒ¥ Option âŒƒ Control â†©ï¸Ž Return/Enter âŒ« Delete âŒ¦ å‘å‰åˆ é™¤é”®ï¼ˆFn+Deleteï¼‰ â†‘ ä¸Šç®­å¤´ â†“ ä¸‹ç®­å¤´ â† å·¦ç®­å¤´ â†’ å³ç®­å¤´ â‡ž Page Upï¼ˆFn+â†‘ï¼‰ â‡Ÿ Page Downï¼ˆFn+â†“ï¼‰ Home Fn + â† End Fn + â†’ â‡¥ å³åˆ¶è¡¨ç¬¦ï¼ˆTabé”®ï¼‰ â‡¤ å·¦åˆ¶è¡¨ç¬¦ï¼ˆShift+Tabï¼‰ âŽ‹ Escape (Esc)]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>å¿«æ·é”®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mac chrome å¿«æ·é”®]]></title>
    <url>%2F2017%2F08%2F29%2Fmac-chrome%E5%BF%AB%E6%8D%B7%E9%94%AE%2F</url>
    <content type="text"><![CDATA[12345678910111213141516âŒ˜-Shift-J æ‰“å¼€â€œä¸‹è½½å†…å®¹â€é¡µã€‚âŒ˜-Shift-Delete æ‰“å¼€â€œæ¸…é™¤æµè§ˆæ•°æ®â€å¯¹è¯æ¡†ã€‚âŒ˜-R é‡æ–°è½½å…¥å½“å‰ç½‘é¡µã€‚âŒ˜-, åœæ­¢è½½å…¥å½“å‰ç½‘é¡µã€‚âŒ˜-Option-I æ‰“å¼€â€œå¼€å‘äººå‘˜å·¥å…·â€ã€‚âŒ˜-Option-J æ‰“å¼€â€œJavaScript æŽ§åˆ¶å°â€ã€‚âŒ˜-Option-U æ‰“å¼€å½“å‰ç½‘é¡µçš„æºä»£ç ã€‚âŒ˜-D å°†å½“å‰ç½‘é¡µä¿å­˜ä¸ºä¹¦ç­¾ã€‚âŒ˜-Shift-D å°†æ‰€æœ‰æ‰“å¼€çš„æ ‡ç­¾é¡µä»¥ä¹¦ç­¾çš„å½¢å¼ä¿å­˜åœ¨æ–°æ–‡ä»¶å¤¹ä¸­ã€‚âŒ˜-Shift-F åœ¨å…¨å±æ¨¡å¼ä¸‹æ‰“å¼€ç½‘é¡µã€‚å†æŒ‰ä¸€æ¬¡ âŒ˜-Shift-F å¯é€€å‡ºå…¨å±æ¨¡å¼ã€‚âŒ˜-+ æ”¾å¤§ç½‘é¡µä¸Šçš„æ‰€æœ‰å†…å®¹ã€‚âŒ˜ å’Œ - ç¼©å°ç½‘é¡µä¸Šçš„æ‰€æœ‰å†…å®¹ã€‚âŒ˜-0 å°†ç½‘é¡µä¸Šçš„æ‰€æœ‰å†…å®¹æ¢å¤åˆ°æ­£å¸¸å¤§å°ã€‚âŒ˜-Shift-H åœ¨å½“å‰æ ‡ç­¾é¡µä¸­æ‰“å¼€ä¸»é¡µã€‚ç©ºæ ¼é”® å‘ä¸‹æ»šåŠ¨ç½‘é¡µã€‚âŒ˜-Option-F æœç´¢ç½‘é¡µã€‚]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>å¿«æ·é”®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AngularJS æ•™ç¨‹]]></title>
    <url>%2F2017%2F08%2F23%2FAngularJS%E6%95%99%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[æ–°å»ºå‰ç«¯é¡¹ç›®1234567891011121314cnpm install -g @angular/cliwebstrom new empty project 601 ng new demo --skip-install --style=sass --routing 604 ls 605 cd demo 606 ls 608 cnpm install 609 ls 611 ng serve 612 ls 613 cd demo 614 ls 615 ng serve å¸¸ç”¨æŒ‡ä»¤12345ng-app æŒ‡ä»¤åˆå§‹åŒ–ä¸€ä¸ª AngularJS åº”ç”¨ç¨‹åºã€‚ng-init æŒ‡ä»¤åˆå§‹åŒ–åº”ç”¨ç¨‹åºæ•°æ®ã€‚ng-model æŒ‡ä»¤æŠŠå…ƒç´ å€¼ï¼ˆæ¯”å¦‚è¾“å…¥åŸŸçš„å€¼ï¼‰ç»‘å®šåˆ°åº”ç”¨ç¨‹åºã€‚&#123;&#123;4*5&#125;&#125; è¡¨è¾¾å¼ng-repeat é‡å¤å…ƒç´  è‡ªå®šä¹‰æŒ‡ä»¤ä½¿ç”¨é©¼å³°æ³•æ¥å‘½åä¸€ä¸ªæŒ‡ä»¤ï¼Œ ä½†åœ¨ä½¿ç”¨å®ƒæ—¶éœ€è¦ä»¥ - åˆ†å‰² 123456789101112131415161718&lt;runoob-directive&gt;&lt;/runoob-directive&gt;&lt;script&gt;var app = angular.module("myApp", []);app.directive("runoobDirective", function() &#123; return &#123; restrict : "A", template : "&lt;h1&gt;è‡ªå®šä¹‰æŒ‡ä»¤!&lt;/h1&gt;" &#125;;&#125;);&lt;/script&gt;restrict å€¼å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§:E ä½œä¸ºå…ƒç´ åä½¿ç”¨A ä½œä¸ºå±žæ€§ä½¿ç”¨C ä½œä¸ºç±»åä½¿ç”¨M ä½œä¸ºæ³¨é‡Šä½¿ç”¨restrict é»˜è®¤å€¼ä¸º EA, å³å¯ä»¥é€šè¿‡å…ƒç´ åå’Œå±žæ€§åæ¥è°ƒç”¨æŒ‡ä»¤ã€‚]]></content>
      <tags>
        <tag>AngularJS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Sublime macå¿«æ·é”®]]></title>
    <url>%2F2017%2F08%2F16%2FSublime%E5%BF%AB%E6%8D%B7%E9%94%AE%2F</url>
    <content type="text"><![CDATA[json format 1cmd+ctrl+j package install 123æŒ‰ä¸‹CTRL + SHIFT + På¹¶ä¸”è¾“å…¥Package Control: Install Packageå†è¾“å…¥Pretty JSONï¼ŒæŒ‰ä¸‹ENTERå®Œæˆå®‰è£ æŸ¥æ‰¾æ–‡ä»¶å 1cmd + P]]></content>
      <categories>
        <category>è¿ç»´</category>
      </categories>
      <tags>
        <tag>å¿«æ·é”®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³•ç›¸å…³(java)]]></title>
    <url>%2F2017%2F08%2F10%2F%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3(java)%2F</url>
    <content type="text"><![CDATA[å¸¸è§çš„å†…éƒ¨æŽ’åºç®—æ³•æ’å…¥æŽ’åºã€å¸Œå°”æŽ’åºã€é€‰æ‹©æŽ’åºã€å†’æ³¡æŽ’åºã€å½’å¹¶æŽ’åºã€å¿«é€ŸæŽ’åºã€å †æŽ’åºã€åŸºæ•°æŽ’åºç­‰123456789101112131415161718192021public class SortingDemo &#123; public static void main(String[] args) &#123; /* ç®€å•æŽ’åº */ EasySort.bubbleList();// å†’æ³¡ EasySort.bubbleArray();// å†’æ³¡ EasySort.xuanze();// é€‰æ‹© EasySort.charu();// æ’å…¥ /* é«˜æ•ˆæŽ’åº */ QuickSort.quickSort();// å¿«æŽ’ MergeSort.mergeSort();// å½’å¹¶æŽ’åº(åˆ†æ²»é€’å½’æ€æƒ³) ShellSort.shellSort();// å¸Œå°”æŽ’åº(æ’å…¥æŽ’åºçš„ä¸€ç§é«˜æ•ˆçŽ‡çš„å®žçŽ°ï¼Œä¹Ÿå«ç¼©å°å¢žé‡æŽ’åº) // å †æŽ’åº(å‡åºæŽ’åºå°±ä½¿ç”¨å¤§é¡¶å †ï¼Œåä¹‹ä½¿ç”¨å°é¡¶å †) /* çº¿æ€§æŽ’åº */ // è®¡æ•°æŽ’åº // æ¡¶æŽ’åº // åŸºæ•°æŽ’åº &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116/*** ç®€å•æŽ’åº*/class EasySort &#123; /** * å†’æ³¡æŽ’åº List * &lt;p&gt; * ç®—æ³•æ€æƒ³ï¼šéåŽ†å¾…æŽ’åºçš„æ•°ç»„ï¼Œæ¯æ¬¡éåŽ†æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æžœä»–ä»¬çš„æŽ’åˆ—é¡ºåºé”™è¯¯å°±äº¤æ¢ä»–ä»¬çš„ä½ç½®ï¼Œ * ç»è¿‡ä¸€è¶ŸæŽ’åºåŽï¼Œæœ€å¤§çš„å…ƒç´ ä¼šæµ®ç½®æ•°ç»„çš„æœ«ç«¯ã€‚é‡å¤æ“ä½œï¼Œç›´åˆ°æŽ’åºå®Œæˆã€‚ */ static void bubbleList() &#123; List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9); Collections.shuffle(list);// listéšæœºæ‰“ä¹± System.out.println(list); for (int i = 0; i &lt; list.size(); i++) &#123; for (int j = 0; j &lt; list.size() - 1 - i; j++) &#123; int current = list.get(j); int comp = list.get(j + 1); if (current &gt; comp) &#123; int temp = list.get(j + 1); list.set(j + 1, list.get(j)); list.set(j, temp); &#125; &#125; System.out.println(list); &#125; &#125; /** * å†’æ³¡æŽ’åº Array (å¾ªçŽ¯æœ€å¤§å€¼ç½®é¡¶) * &lt;p&gt; * ç®—æ³•æ€æƒ³ï¼šéåŽ†å¾…æŽ’åºçš„æ•°ç»„ï¼Œæ¯æ¬¡éåŽ†æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æžœä»–ä»¬çš„æŽ’åˆ—é¡ºåºé”™è¯¯å°±äº¤æ¢ä»–ä»¬çš„ä½ç½®ï¼Œ * ç»è¿‡ä¸€è¶ŸæŽ’åºåŽï¼Œæœ€å¤§çš„å…ƒç´ ä¼šæµ®ç½®æ•°ç»„çš„æœ«ç«¯ã€‚é‡å¤æ“ä½œï¼Œç›´åˆ°æŽ’åºå®Œæˆã€‚ */ static void bubbleArray() &#123; List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9); Collections.shuffle(list);// listéšæœºæ‰“ä¹± Integer[] values = (Integer[]) list.toArray(); System.out.println(Arrays.asList(values)); for (int i = 0; i &lt; values.length; i++) &#123; for (int j = 0; j &lt; values.length - 1 - i; j++) &#123; int current = values[j]; int comp = values[j + 1]; if (current &gt; comp) &#123; int temp = values[j + 1]; values[j + 1] = values[j]; values[j] = temp; &#125; &#125; System.out.println(Arrays.asList(values)); &#125; &#125; /** * é€‰æ‹©æŽ’åº * &lt;p&gt; * ç®—æ³•æ€æƒ³ï¼šé‡å¾…æŽ’åºçš„æ•°ç»„ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å°çš„å…ƒç´ ï¼Œå°†å®ƒä¸Žæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®çš„å…ƒç´ äº¤æ¢ä½ç½®ã€‚ * ç„¶åŽä»Žå‰©ä¸‹çš„å…ƒç´ ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å°çš„å…ƒç´ ï¼Œå°†å®ƒä¸Žç¬¬äºŒä¸ªä½ç½®çš„å…ƒç´ äº¤æ¢ä½ç½®ï¼Œ * å¦‚æžœæœ€å°å…ƒç´ å°±æ˜¯è¯¥ä½ç½®çš„å…ƒç´ ï¼Œå°±å°†å®ƒå’Œè‡ªèº«äº¤æ¢ä½ç½®ï¼Œä¾æ¬¡ç±»æŽ¨ï¼Œç›´åˆ°æŽ’åºå®Œæˆã€‚ */ static void xuanze() &#123; List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9); Collections.shuffle(list);// listéšæœºæ‰“ä¹± Integer[] values = (Integer[]) list.toArray(); System.out.println(Arrays.asList(values)); Integer[] array = values; for (int i = 0; i &lt; values.length; i++) &#123; int courrentMinIndex = i;// å½“å‰æœ€å°å€¼ä¸‹æ ‡ // ä»Žå½“å‰ä¸‹æ ‡åˆ°æœ€åŽçš„èŒƒå›´,æ‰¾å‡ºæœ€å°çš„å€¼ for (int j = i + 1; j &lt; values.length; j++) &#123; if (values[j] &lt; values[courrentMinIndex]) &#123; courrentMinIndex = j; &#125; &#125; // å½“å‰ä½ä¸Žæœ€å°å€¼ä½äº¤æ¢ int temp = values[i]; values[i] = values[courrentMinIndex]; values[courrentMinIndex] = temp; System.out.println(Arrays.asList(array)); &#125; &#125; /** * æ’å…¥æŽ’åº(ä¼˜å…ˆä¿éšœcurrentIndexå‰ç½®æœ‰åº) * &lt;p&gt; * ç®—æ³•æ€æƒ³:ä»Žæ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹éåŽ†ï¼Œå°†è¯¥å…ƒç´ ä¸Žå‰é¢çš„å…ƒç´ æ¯”è¾ƒï¼Œå¦‚æžœè¯¥å…ƒç´ æ¯”å‰é¢çš„å…ƒç´ å°ï¼Œ * å°†è¯¥å…ƒç´ ä¿å­˜è¿›ä¸´æ—¶å˜é‡ä¸­ï¼Œä¾æ¬¡å°†å‰é¢çš„å…ƒç´ åŽç§»ï¼Œç„¶åŽå°†è¯¥å…ƒç´ æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚ * æ¯æ¬¡æŽ’åºå®ŒæˆåŽï¼Œç´¢å¼•å·¦è¾¹çš„å…ƒç´ ä¸€å®šæ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯è¿˜å¯ä»¥ç§»åŠ¨ã€‚å¯¹äºŽå€’ç½®è¶Šå°‘çš„æ•°ç»„ï¼Œè¯¥ç®—æ³•çš„æŽ’åºæ•ˆçŽ‡è¶Šé«˜ã€‚ */ static void charu() &#123; List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9); Collections.shuffle(list);// listéšæœºæ‰“ä¹± Integer[] values = (Integer[]) list.toArray(); System.out.println(Arrays.asList(values)); for (int i = 1; i &lt; values.length; i++) &#123; for (int j = 0; j &lt; i; j++) &#123; int current = values[i]; int comp = values[j]; if (current &lt; comp) &#123; int third = values[i]; values[i] = values[j]; values[j] = third; &#125; &#125; System.out.println(Arrays.asList(values)); &#125; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110/*** å¿«é€ŸæŽ’åº*/class QuickSort &#123; /** * å¿«é€ŸæŽ’åºçš„åŸºæœ¬æ€æƒ³ï¼šé€šè¿‡ä¸€è¶ŸæŽ’åºå°†å¾…æŽ’åºè®°å½•åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è®°å½•çš„å…³é”®å­—å‡æ¯”å¦ä¸€éƒ¨åˆ†å…³é”®å­—å°ï¼Œ * åˆ™åˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†ç»§ç»­è¿›è¡ŒæŽ’åºï¼Œç›´åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚ */ static void quickSort() &#123; List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9); Collections.shuffle(list);// listéšæœºæ‰“ä¹± System.out.println("======(åˆ†åŒº)"); Integer[] values = (Integer[]) list.toArray(); System.out.println(Arrays.asList(values)); quickSortEasy(values, 0, values.length - 1); System.out.println("======(äº¤æ¢)"); values = (Integer[]) list.toArray(); System.out.println(Arrays.asList(values)); quickSortSwap(values, 0, values.length - 1); &#125; /** * åˆ†æ²»æ³•-åˆ†åŒº(æ–¹ä¾¿ç†è§£) * * @param values * @param begin * @param end */ static void quickSortEasy(Integer[] values, int begin, int end) &#123; if (begin &gt;= end) return; int middleIndex = quickSortMiddleEasy(values, begin, end); System.out.printf("begin:%d end:%d middleIndex:%d(value=%d) %n", begin, end, middleIndex, values[middleIndex]); System.out.println(Arrays.asList(values));// å®šä½ä¸­ä½æ•°æ—¶,å·²ç»å®Œæˆåˆ†æ²» quickSortEasy(values, begin, middleIndex - 1); quickSortEasy(values, middleIndex + 1, end); &#125; static int quickSortMiddleEasy(Integer[] values, int begin, int end) &#123; // ç¬¬ä¸€æ­¥,ä»¥æœ€ä½Žä½å€¼ä½œä¸ºä¸­è½´,å°†å…¶å®ƒæ•°è¿›è¡Œä¸¤è¾¹åˆ†æ²»æ³•.ç»“æŸåŽ,ä¸­è½´ä½ä¸å†å‚ä¸ŽåŽç»­æŽ’åº(å› ä¸ºä½ç½®å·²ç»ç¡®å®šäº†) // ç¤ºä¾‹:[6, 2, 1, 8, 5, 4, 9, 3, 7]ä¸­è½´å€¼ä¸º6,åˆ†æ²»æ³•ç»“æžœ[32145]6[987](äº¤æ¢)/[21543]6[897](åˆ†åŒº) int middleValue = values[begin]; // ç¬¬äºŒæ­¥,åˆ†æ²»æ³•.å…ˆè…¾å‡ºä¸­è½´å€¼ä½ç½®[0],å¹¶ä¿æŒä¸­è½´å€¼. List&lt;Integer&gt; left = new ArrayList&lt;&gt;(); List&lt;Integer&gt; right = new ArrayList&lt;&gt;(); left.addAll(Arrays.asList(Arrays.copyOfRange(values, 0, begin)));// æŽ’åºåŒºé—´å‰ for (int i = begin; i &lt; end + 1; i++) &#123; if (values[i] &lt; middleValue) &#123; left.add(values[i]); // æŽ’åºåŒºé—´å·¦åŒº &#125; else if (values[i] &gt; middleValue) &#123; right.add(values[i]);// æŽ’åºåŒºé—´å³åŒº &#125; &#125; left.add(middleValue);// æŽ’åºåŒºé—´ä¸­è½´ int middleIndex = left.size() - 1; left.addAll(right);// æŽ’åºåŒºé—´å³åŒºä¹Ÿåˆå¹¶åˆ°å•ä¸ªé›†åˆ left.addAll(Arrays.asList(Arrays.copyOfRange(values, end + 1, values.length)));// æŽ’åºåŒºé—´åŽ values = left.toArray(values);// é‡å†™åŽŸæ•°ç»„ return middleIndex; &#125; /** * åˆ†æ²»æ³•-äº¤æ¢(èŠ‚çœå†…å­˜ç©ºé—´) * @param values * @param begin * @param end */ static void quickSortSwap(Integer[] values, int begin, int end) &#123; if (begin &gt;= end) return; int middleIndex = getMiddle(values, begin, end); System.out.printf("begin:%d end:%d middleIndex:%d(value=%d) %n", begin, end, middleIndex, values[middleIndex]); System.out.println(Arrays.asList(values));// å®šä½ä¸­ä½æ•°æ—¶,å·²ç»å®Œæˆåˆ†æ²» quickSortSwap(values, begin, middleIndex - 1); quickSortSwap(values, middleIndex + 1, end); &#125; public static int getMiddle(Integer[] numbers, int low, int high) &#123; // ç¤ºä¾‹:[6, 2, 1, 8, 5, 4, 9, 3, 7]ä¸­è½´å€¼ä¸º6,åˆ†æ²»æ³•ç»“æžœ[32145]6[987](äº¤æ¢)/[21543]6[897](åˆ†åŒº) int temp = numbers[low]; // æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½œä¸ºä¸­è½´ numbers[low] = null;// åŽŸä½ç½®å€¼å·²ç»è½¬ç§»,æœªæ¥ä¹Ÿä¼šè¢«åˆ†æ²»æ³•çš„æ–°å€¼è¦†ç›–,å¯çœç•¥.ä½†æ ‡è®°null,æ–¹ä¾¿ç†è§£ while (low &lt; high) &#123; while (low &lt; high &amp;&amp; numbers[high] &gt; temp) &#123;// å…ˆæœ€é«˜ä½ä¸Žä¸­è½´å€¼æ¯”è¾ƒ high--; &#125; numbers[low] = numbers[high];// æ¯”ä¸­è½´å°çš„è®°å½•ç§»åˆ°ä½Žç«¯ numbers[high] = null;// åŽŸä½ç½®å€¼å·²ç»è½¬ç§»,æœªæ¥ä¹Ÿä¼šè¢«åˆ†æ²»æ³•çš„æ–°å€¼è¦†ç›–,å¯çœç•¥.ä½†æ ‡è®°null,æ–¹ä¾¿ç†è§£ while (low &lt; high &amp;&amp; numbers[low] &lt; temp) &#123; low++; &#125; numbers[high] = numbers[low]; //æ¯”ä¸­è½´å¤§çš„è®°å½•ç§»åˆ°é«˜ç«¯ numbers[low] = null;// åŽŸä½ç½®å€¼å·²ç»è½¬ç§»,æœªæ¥ä¹Ÿä¼šè¢«åˆ†æ²»æ³•çš„æ–°å€¼è¦†ç›–,å¯çœç•¥.ä½†æ ‡è®°null,æ–¹ä¾¿ç†è§£ &#125; numbers[low] = temp; //ä¸­è½´è®°å½•åˆ°å°¾ return low; // è¿”å›žä¸­è½´çš„ä½ç½® &#125;&#125; å½’å¹¶æŽ’åº åŸºæœ¬æ€æƒ³:å…ˆé€’å½’åˆ’åˆ†å­é—®é¢˜ï¼Œç„¶åŽåˆå¹¶ç»“æžœã€‚æŠŠå¾…æŽ’åºåˆ—çœ‹æˆç”±ä¸¤ä¸ªæœ‰åºçš„å­åºåˆ—ï¼Œç„¶åŽåˆå¹¶ä¸¤ä¸ªå­åºåˆ—ï¼Œç„¶åŽæŠŠå­åºåˆ—çœ‹æˆç”±ä¸¤ä¸ªæœ‰åºåºåˆ—ã€‚å€’ç€æ¥çœ‹ï¼Œå…¶å®žå°±æ˜¯å…ˆä¸¤ä¸¤åˆå¹¶ï¼Œç„¶åŽå››å››åˆå¹¶ï¼Œæœ€ç»ˆå½¢æˆæœ‰åºåºåˆ—ã€‚ åšæ³•(å»ºè®®sublimeä¸­ç¼–è¾‘,æ–¹ä¾¿ç¬¦å·å¯¹å…¶):123int mid = (beginIndex + endIndex) / 2;// å–ä¸­ä½indexmiddleSort(values, beginIndex, mid);// å·¦ä¾§é€’å½’å†åˆ†,åˆ°ä¸å¯å†åˆ†middleSort(values, mid + 1, endIndex);// å³ä¾§é€’å½’å†åˆ†,åˆ°ä¸å¯å†åˆ† 1234567897, 6, 5, 2, 1, 3, 4, 9, 8- - - - - - - - -8- - - - -4- - -2- -1 - -3 - - - -7 - -5 - -6 æ¯”è¾ƒäº¤æ¢,æ–¹æ³•ä¸€:midå·¦ä¾§ç¬¬ä¸€ä½å¼€å§‹ä¸Žmidå³ä¾§ç¬¬ä¸€ä½å¼€å§‹æ¯”è¾ƒ,å°çš„æ·»åŠ åˆ°æ–°array.æœ€åŽå†æŒ‰åŒºé—´æ›´æ–°åŽŸarrayå¦‚:[5, 6, 7, 1, 2](ä¸­ä½æ•°ä¸¤ä¾§äº‹å‰å·²ç»ç»è¿‡æŽ’åº)ä¼šæ‹†ä½[5,6,7][1,2](è¿›è¡Œåˆå¹¶)5&lt;&gt;1 =&gt; 1(å°) tempArray=[1]5&lt;&gt;2 =&gt; 2(å°) tempArray=[1,2]æŠŠæ²¡æœ‰åˆ°tempArrayçš„å¤§å€¼æ·»åŠ è¿›åŽ»: tempArray=[1,2,5,6,7] è§: â˜…é¢è¯•ä¸­çš„æŽ’åºç®—æ³•æ€»ç»“ - ç®€ä¹¦ - å½’å¹¶æŽ’åº`http://www.jianshu.com/p/c360a58db21d æ¯”è¾ƒäº¤æ¢,æ–¹æ³•äºŒ(æŽ¨è): å¯¹å¾…åˆå¹¶æ•°æ®[5, 6, 7][1, 2]ç›´æŽ¥ä»…éœ€æ’å…¥æŽ’åº.123456789101112// å¾…åˆå¹¶çš„äºŒåˆ†æ•°æ®,å·²ç»åŸºæœ¬æœ‰åº,æ‰€æœ‰ä½¿ç”¨`æ’å…¥æŽ’åº`è¿›è¡Œåˆå¹¶,å…·å¤‡æ›´é«˜çš„æ€§èƒ½(å› ä¸ºç§»åŠ¨çš„ä½ç½®è¾ƒå°‘)ä¸”ä¸éœ€è¦æ›´å¤šçš„å†…å­˜ä»…éœ€ä¸€ä¸ªäº¤æ¢å˜é‡.for (int i = beginIndex + 1; i &lt; endIndex; i++) &#123; for (int j = beginIndex; j &lt; i; j++) &#123; if (values[i] &lt; values[j]) &#123; int temp = values[j]; values[j] = values[i]; values[i] = temp; System.out.println("markNum:"+markNum++); &#125; &#125;&#125;System.out.println(Arrays.asList(values)); è§: myServer/@java/demo-sorting/SortingDemo.java12345678910111213141516171819202122232425262728293031323334353637383940/*** å½’å¹¶æŽ’åº*/class MergeSort &#123; static void mergeSort() &#123; List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9); Collections.shuffle(list);// listéšæœºæ‰“ä¹± Integer[] values = (Integer[]) list.toArray(); System.out.println(Arrays.asList(values)); middleSort(values, 0, values.length); &#125; static int markNum=0; static void middleSort(Integer[] values, int beginIndex, int endIndex) &#123; if (!(beginIndex &lt; endIndex)) return; int mid = (beginIndex + endIndex) / 2;// å–ä¸­ä½index middleSort(values, beginIndex, mid);// å·¦ä¾§é€’å½’å†åˆ†,åˆ°ä¸å¯å†åˆ† middleSort(values, mid + 1, endIndex);// å³ä¾§é€’å½’å†åˆ†,åˆ°ä¸å¯å†åˆ† // å¯¹æœ€è¿‘çš„äºŒåˆ†æ•°æ®è¿›è¡Œåˆå¹¶. å¦‚:[5,6,7][1,2] // å¾…åˆå¹¶çš„äºŒåˆ†æ•°æ®,å·²ç»åŸºæœ¬æœ‰åº,æ‰€æœ‰ä½¿ç”¨`æ’å…¥æŽ’åº`è¿›è¡Œåˆå¹¶,å…·å¤‡æ›´é«˜çš„æ€§èƒ½(å› ä¸ºç§»åŠ¨çš„ä½ç½®è¾ƒå°‘)ä¸”ä¸éœ€è¦æ›´å¤šçš„å†…å­˜ä»…éœ€ä¸€ä¸ªäº¤æ¢å˜é‡. for (int i = beginIndex + 1; i &lt; endIndex; i++) &#123; for (int j = beginIndex; j &lt; i; j++) &#123; if (values[i] &lt; values[j]) &#123; int temp = values[j]; values[j] = values[i]; values[i] = temp; System.out.println("markNum:"+markNum++); &#125; &#125; &#125; System.out.println(Arrays.asList(values)); &#125;&#125; å¸Œå°”æŽ’åºåŸºæœ¬æ€æƒ³æ˜¯ï¼šå…ˆå°†æ•´ä¸ªå¾…æŽ’è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—ï¼Œåˆ†åˆ«è¿›è¡Œç›´æŽ¥æ’å…¥æŽ’åºã€‚å¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•åŸºæœ¬æœ‰åºæ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¸€æ¬¡ç›´æŽ¥æ’å…¥æŽ’åºã€‚12345678910111213141516171819202122232425262728293031323334353637383940418, 7, 4, 1, 3, 5, 6, 2, 9length/2=4- - - - - - - - - -3, 5, 4, 1, 8, 7, 6, 2, 94/2=2- - - - - - - - - - - - - - - - - -x x 1 5 x 8 x 7 x 6 8 2 5 7 x x x 93, 1, 4, 2, 6, 5, 8, 7, 92/2=1- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -1 3 i=1 x x i=2 2 3 4 i=3 x x x 6 i=4 x x x 5 6 i=5 x x x x X 8 i=6 x x x x X 7 8 i=7 x x x x X x x x 9 i=8 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556/*** å¸Œå°”æŽ’åº*/class ShellSort &#123; static void shellSort() &#123; List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6, 7, 8, 9); Collections.shuffle(list);// listéšæœºæ‰“ä¹± Integer[] values = (Integer[]) list.toArray();// List è½¬ Array System.out.println(Arrays.asList(values)); int[] valuesI = new int[values.length]; Arrays.stream(values).forEachOrdered(i -&gt; valuesI[i - 1] = values[i - 1].intValue());// å°è£…æ•°ç»„è½¬åŸºç¡€æ•°ç»„(Integer[] è½¬ int[]) Arrays.stream(valuesI).forEach(value -&gt; System.out.print(value + ", "));// æ‰“å°åŸºç¡€ç±»åž‹æ•°ç»„(int[]) System.out.println(); int[] valuesI2 = new int[]&#123;8, 7, 4, 1, 3, 5, 6, 2, 9&#125;;// è‡ªå®šä¹‰ shellSort(valuesI2); Arrays.stream(valuesI2).forEach(value -&gt; System.out.print(value + ", "));// æ‰“å°åŸºç¡€ç±»åž‹æ•°ç»„(int[]) &#125; /** * å¸Œå°”æŽ’åºçš„ä¸€è¶Ÿæ’å…¥ * * @param arr å¾…æŽ’æ•°ç»„ * @param d å¢žé‡ */ public static void shellInsert(int[] arr, int d) &#123; System.out.println("d:" + d); for (int i = d; i &lt; arr.length; i++) &#123; int j = i - d; int temp = arr[i]; //è®°å½•è¦æ’å…¥çš„æ•°æ® while (j &gt;= 0 &amp;&amp; arr[j] &gt; temp) &#123; //ä»ŽåŽå‘å‰ï¼Œæ‰¾åˆ°æ¯”å…¶å°çš„æ•°çš„ä½ç½® arr[j + d] = arr[j]; //å‘åŽæŒªåŠ¨ j -= d; &#125; if (j != i - d) //å­˜åœ¨æ¯”å…¶å°çš„æ•° arr[j + d] = temp; Arrays.stream(arr).forEach(value -&gt; System.out.print(value + ", "));// æ‰“å°åŸºç¡€ç±»åž‹æ•°ç»„(int[]) System.out.println(); &#125; &#125; public static void shellSort(int[] arr) &#123; if (arr == null || arr.length == 0) return; int d = arr.length / 2; while (d &gt;= 1) &#123; shellInsert(arr, d); d /= 2; &#125; &#125;&#125; æ—¶é—´å¤æ‚åº¦,ç©ºé—´å¤æ‚åº¦,ç¨³å®šæ€§ å…³äºŽæ—¶é—´å¤æ‚åº¦ï¼šå¹³æ–¹é˜¶(O(n2))æŽ’åºï¼šå„ç±»ç®€å•æŽ’åº:ç›´æŽ¥æ’å…¥ã€ç›´æŽ¥é€‰æ‹©å’Œå†’æ³¡æŽ’åºã€‚çº¿æ€§å¯¹æ•°é˜¶(O(nlog2n))æŽ’åºï¼šå¿«é€ŸæŽ’åºã€å †æŽ’åºå’Œå½’å¹¶æŽ’åºã€‚O(n1+Â§))æŽ’åºï¼šÂ§æ˜¯ä»‹äºŽ0å’Œ1ä¹‹é—´çš„å¸¸æ•°ã€‚çº¿æ€§é˜¶(O(n))æŽ’åºï¼šåŸºæ•°æŽ’åºï¼Œæ­¤å¤–è¿˜æœ‰æ¡¶ã€ç®±æŽ’åºã€‚ å…³äºŽç¨³å®šæ€§ï¼šç¨³å®šçš„æŽ’åºç®—æ³•ï¼šå†’æ³¡æŽ’åºã€æ’å…¥æŽ’åºã€å½’å¹¶æŽ’åºå’ŒåŸºæ•°æŽ’åºï¼›ä¸æ˜¯ç¨³å®šçš„æŽ’åºç®—æ³•ï¼šé€‰æ‹©æŽ’åºã€å¿«é€ŸæŽ’åºã€å¸Œå°”æŽ’åºã€å †æŽ’åºã€‚ å¹³å‡æ—¶é—´,æœ€åæƒ…å†µ,è¾…åŠ©å­˜å‚¨ å¹³å‡æ—¶é—´æ¥çœ‹ï¼Œå¿«é€ŸæŽ’åºæ˜¯æ•ˆçŽ‡æœ€é«˜çš„ã€‚ä½†å¿«é€ŸæŽ’åºåœ¨æœ€åæƒ…å†µä¸‹çš„æ—¶é—´æ€§èƒ½ï¼Œä¸å¦‚å †æŽ’åºå’Œå½’å¹¶æŽ’åºã€‚è€ŒåŽè€…ç›¸æ¯”è¾ƒçš„ç»“æžœæ˜¯åœ¨nè¾ƒå¤§æ—¶ï¼Œå½’å¹¶æŽ’åºä½¿ç”¨æ—¶é—´è¾ƒå°‘ï¼Œä½†ä½¿ç”¨è¾…åŠ©ç©ºé—´è¾ƒå¤šã€‚ ç®€å•æŽ’åºï¼ŒåŒ…æ‹¬é™¤å¸Œå°”æŽ’åºä¹‹å¤–çš„æ‰€æœ‰å†’æ³¡æŽ’åºã€æ’å…¥æŽ’åºã€ç®€å•é€‰æ‹©æŽ’åºã€‚å…¶ä¸­ç›´æŽ¥æ’å…¥æŽ’åºæœ€ç®€å•ã€‚ä½†åºåˆ—åŸºæœ¬æœ‰åºæˆ–è€…nè¾ƒå°æ—¶ï¼Œç›´æŽ¥æ’å…¥æŽ’åºæ˜¯å¥½çš„æ–¹æ³•ã€‚å› æ­¤å¸¸å°†å®ƒå’Œå…¶ä»–çš„æŽ’åºæ–¹æ³•ï¼Œå¦‚å¿«é€ŸæŽ’åºã€å½’å¹¶æŽ’åºç­‰ç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚ åŸºæ•°æŽ’åºçš„æ—¶é—´å¤æ‚åº¦ä¹Ÿå¯ä»¥å†™æˆO(d*n)ã€‚å› æ­¤å®ƒæœ€ä½¿ç”¨äºŽnå€¼å¾ˆå¤§è€Œå…³é”®å­—è¾ƒå°çš„çš„åºåˆ—ã€‚è‹¥å…³é”®å­—ä¹Ÿå¾ˆå¤§ï¼Œè€Œåºåˆ—ä¸­å¤§å¤šæ•°è®°å½•çš„æœ€é«˜å…³é”®å­—å‡ä¸åŒï¼Œåˆ™äº¦å¯å…ˆæŒ‰æœ€é«˜å…³é”®å­—ä¸åŒï¼Œå°†åºåˆ—åˆ†æˆè‹¥å¹²å°çš„å­åºåˆ—ï¼Œè€ŒåŽè¿›è¡Œç›´æŽ¥æ’å…¥æŽ’åºã€‚ ä»Žæ–¹æ³•çš„ç¨³å®šæ€§æ¥æ¯”è¾ƒï¼ŒåŸºæ•°æŽ’åºæ˜¯ç¨³å®šçš„å†…æŽ’æ–¹æ³•ï¼Œæ‰€æœ‰æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2)çš„ç®€å•æŽ’åºä¹Ÿæ˜¯ç¨³å®šçš„ã€‚ä½†æ˜¯å¿«é€ŸæŽ’åºã€å †æŽ’åºã€å¸Œå°”æŽ’åºç­‰æ—¶é—´æ€§èƒ½è¾ƒå¥½çš„æŽ’åºæ–¹æ³•éƒ½æ˜¯ä¸ç¨³å®šçš„ã€‚ç¨³å®šæ€§éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©ã€‚ ä¸Šé¢çš„ç®—æ³•å®žçŽ°å¤§å¤šæ•°æ˜¯ä½¿ç”¨çº¿æ€§å­˜å‚¨ç»“æž„ï¼Œåƒæ’å…¥æŽ’åºè¿™ç§ç®—æ³•ï¼Œç”¨é“¾è¡¨å®žçŽ°æ›´å¥½ï¼ŒçœåŽ»äº†ç§»åŠ¨å…ƒç´ çš„æ—¶é—´ã€‚å…·ä½“çš„å­˜å‚¨ç»“æž„ï¼Œåœ¨å…·ä½“çš„å®žçŽ°ç‰ˆæœ¬ä¸­ä¹Ÿæ˜¯ä¸åŒçš„ã€‚ å‚è€ƒâ˜…é¢è¯•ä¸­çš„æŽ’åºç®—æ³•æ€»ç»“ - ç®€ä¹¦http://www.jianshu.com/p/c360a58db21d æŽ’åºç®—æ³•å›¾å½¢åŒ–æ¯”è¾ƒï¼šå¿«é€ŸæŽ’åºã€æ’å…¥æŽ’åºã€é€‰æ‹©æŽ’åºã€å†’æ³¡æŽ’åº - ç®€ä¹¦http://www.jianshu.com/p/70619984fbc6å®Œå…¨äºŒå‰æ ‘å®žçŽ°ä¼˜å…ˆé˜Ÿåˆ—ä¸Žå †æŽ’åº - ç®€ä¹¦http://www.jianshu.com/p/9a456d1b59b5 8å¤§æŽ’åºç®—æ³•å›¾æ–‡è®²è§£http://www.jianshu.com/p/e6ad4423efcd å…«å¤§æŽ’åºç®—æ³• - guisuï¼Œç¨‹åºäººç”Ÿã€‚ é€†æ°´è¡ŒèˆŸï¼Œä¸è¿›åˆ™é€€ã€‚ - CSDNåšå®¢http://blog.csdn.net/hguisu/article/details/7776068]]></content>
      <categories>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>æŽ’åºç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å†…ç½‘dockeré›†ç¾¤çŽ¯å¢ƒ]]></title>
    <url>%2F2017%2F08%2F03%2F%E5%86%85%E7%BD%91docker%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%2F</url>
    <content type="text"><![CDATA[Nodeä¸€é”®æŽ¥å…¥é›†ç¾¤ï¼Œå»ºè®®åˆå§‹é•œåƒä½¿ç”¨å†…ç½‘centos7.2åˆå§‹é•œåƒ 12345678910111213141516curl -sSL https://shipyard-project.com/deploy | ACTION=node DISCOVERY=etcd://192.168.10.165:4001 bash -å†…ç½‘dockeré›†ç¾¤docker registry : dr.zenzet.comdocker console : shipyard.zenzet.comdocker nodes : 192.168.10.113~115ç›¸å…³dockerå‘½ä»¤docker build -t gateway .docker run -d -p 6500:6500 gatewaydocker tag gateway dr.zenzet.com/gatewaydocker push dr.zenzet.com/gatewaydocker exec -it 198eb84bf118 /bin/shdocker kill 372f0742488adocker rmi -f b537edc85f45docker run -d -p 80:5000 -v /opt/registry:/tmp/registry-dev registrydocker run -d -p 6500:6500 dr.zenzet.com/gateway]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Beançš„åˆå§‹åŒ–å¯åŠ¨æ–¹å¼]]></title>
    <url>%2F2017%2F08%2F01%2FSpring%20Bean%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[æ–¹å¼ä¸€: xml &lt;bean init-method=&quot;init&quot;1234&lt;bean class="cn.fraudmetrix.billing.consumer.FlowConsumer" init-method="init" destroy-method="destroy"&gt; &lt;property name="kafkaTopics" value="$&#123;billing.kafka.topics&#125;"/&gt; &lt;property name="debug" value="$&#123;billing.flow.consumer.debug&#125;"/&gt;&lt;/bean&gt; æ–¹å¼äºŒ: implements InitializingBean12345678public class DisconfPropertiesFactory implements FactoryBean&lt;Properties&gt;, InitializingBean &#123; ... public void afterPropertiesSet() throws Exception &#123; if (this.singleton) &#123; this.singletonInstance = this.createProperties(); &#125; &#125; ... æ–¹å¼ä¸‰:æ³¨è§£@PostConstruct @PreDestroy12345678910111213141516171819202122232425262728package com.myapp.core.annotation.init;import javax.annotation.PostConstruct;import javax.annotation.PreDestroy;public class PersonService &#123; private String message; public String getMessage() &#123; return message; &#125; public void setMessage(String message) &#123; this.message = message; &#125; @PostConstruct public void init()&#123; System.out.println("I'm init method using @PostConstrut...."+message); &#125; @PreDestroy public void dostory()&#123; System.out.println("I'm destory method using @PreDestroy....."+message); &#125;&#125; bean factoryè´Ÿè´£beanåˆ›å»ºçš„æœ€åˆå››æ­¥ï¼Œç„¶åŽç§»äº¤ç»™åº”ç”¨ä¸Šä¸‹æ–‡åšåŽç»­åˆ›å»ºè¿‡ç¨‹ï¼š 1.Springåˆå§‹åŒ–bean 2.Springå°†å€¼å’Œå…¶ä»–beançš„å¼•ç”¨æ³¨å…¥ï¼ˆinjectï¼‰åˆ°å½“å‰beançš„å¯¹åº”å±žæ€§ä¸­ï¼› 3.å¦‚æžœBeanå®žçŽ°äº†BeanNameAwareæŽ¥å£ï¼ŒSpringä¼šä¼ å…¥beançš„IDæ¥è°ƒç”¨setBeanNameæ–¹æ³•ï¼› 4.å¦‚æžœBeanå®žçŽ°äº†BeanFactoryAwareæŽ¥å£ï¼ŒSpringä¼ å…¥bean factoryçš„å¼•ç”¨æ¥è°ƒç”¨setBeanFactoryæ–¹æ³•ï¼› 5.å¦‚æžœBeanå®žçŽ°äº†ApplicationContextAwareæŽ¥å£ï¼ŒSpringå°†ä¼ å…¥åº”ç”¨ä¸Šä¸‹æ–‡çš„å¼•ç”¨æ¥è°ƒç”¨setApplicationContextæ–¹æ³•ï¼› 6.å¦‚æžœBeanå®žçŽ°äº†BeanPostProcessoræŽ¥å£ï¼Œåˆ™Springè°ƒç”¨postProcessBeforeInitializationæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨åˆå§‹åŒ–å’Œå±žæ€§æ³¨å…¥ä¹‹åŽè°ƒç”¨ï¼Œåœ¨ä»»ä½•åˆå§‹åŒ–ä»£ç ä¹‹å‰è°ƒç”¨ï¼› 7.å¦‚æžœBeanå®žçŽ°äº†InitializingBeanæŽ¥å£ï¼Œåˆ™éœ€è¦è°ƒç”¨è¯¥æŽ¥å£çš„afterPropertiesSetæ–¹æ³•ï¼›å¦‚æžœåœ¨beanå®šä¹‰çš„æ—¶å€™è®¾ç½®äº†init-methodå±žæ€§ï¼Œåˆ™éœ€è¦è°ƒç”¨è¯¥å±žæ€§æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•ï¼› 8.å¦‚æžœBeanå®žçŽ°äº†BeanPostProcessoræŽ¥å£ï¼Œåˆ™Springè°ƒç”¨postProcessAfterInitializationæ–¹æ³• 9.åœ¨è¿™ä¸ªæ—¶å€™beanå°±å¯ä»¥ç”¨äºŽåœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨äº†ï¼Œå½“ä¸Šä¸‹æ–‡é€€å‡ºæ—¶beanä¹Ÿä¼šè¢«é”€æ¯ï¼› 10.å¦‚æžœBeanå®žçŽ°äº†DisposableBeanæŽ¥å£ï¼ŒSpringä¼šè°ƒç”¨destroy()æ–¹æ³•;å¦‚æžœåœ¨beanå®šä¹‰çš„æ—¶å€™è®¾ç½®äº†destroy-methodï¼Œ åˆ™æ­¤æ—¶éœ€è¦è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•ã€‚ Springå®žæˆ˜1ï¼šSpringåˆæŽ¢ - ç®€ä¹¦http://www.jianshu.com/p/9370707091ef å‚è€ƒ13 Spring Bean init-method å’Œ destroy-methodå®žä¾‹ - ç®€ä¹¦http://www.jianshu.com/p/30a0a74cd31f é€šè¿‡Spring @PostConstruct å’Œ @PreDestroy æ–¹æ³• å®žçŽ°åˆå§‹åŒ–å’Œé”€æ¯beanä¹‹å‰è¿›è¡Œçš„æ“ä½œ - å®‰å¾·é‡Œäºšçš„æˆé•¿ - CSDNåšå®¢http://blog.csdn.net/topwqp/article/details/8681497]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVMå‚æ•°é…ç½®]]></title>
    <url>%2F2015%2F10%2F07%2FJVM%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%2F</url>
    <content type="text"><![CDATA[å¸¸è§é…ç½®12# 4Gå†…å­˜:JAVA_OPTS="$JAVA_OPTS -server -Xms2500m -Xmx2500m -XX:PermSize=256M -XX:MaxPermSize=512m" 1234567891011# æœºå™¨å†…å­˜åˆ†é…ç»“æž„ï¼š# æ ¸å¿ƒåº”ç”¨å ç”¨å†…å­˜ï¼ˆå¯é€šè¿‡ç›‘æŽ§æŸ¥çœ‹å‡ºåˆé€‚çš„å¤§å°ï¼Œé…ç½®å¤ªé«˜ç”¨ä¸åˆ°ä¹Ÿæ˜¯æµªè´¹ï¼‰# ç³»ç»ŸåŠéžæ ¸å¿ƒåº”ç”¨å ç”¨å†…å­˜ï¼ˆåœ¨æ ¸å¿ƒåº”ç”¨æœªå¯ç”¨æ—¶ï¼Œtopæ‰€å ç”¨å†…å­˜ã€‚æ­¤åŸºç¡€ä¸Šè¿˜éœ€å¼¹æ€§ç©ºé—´ï¼‰# æ³¨:æ—¥å¸¸çŠ¶æ€å†…å­˜å°½é‡æŽ§åˆ¶åœ¨70%ä»¥å†…,é¢„ç•™å†…å­˜ä»¥å¤‡å¤„ç†â€˜å†…å­˜é’ˆåˆºâ€™çš„ä¸šåŠ¡# (æœåŠ¡å™¨ä¸€èˆ¬è®¾ç½®-Xmsã€-Xmxç›¸ç­‰ä»¥é¿å…åœ¨æ¯æ¬¡GCåŽè°ƒæ•´å †çš„å¤§å°)-Xms128m #JVMåˆå§‹åˆ†é…çš„å †å†…å­˜-Xmx512m #JVMæœ€å¤§å…è®¸åˆ†é…çš„å †å†…å­˜ï¼ŒæŒ‰éœ€åˆ†é…-XX:PermSize=64M #JVMåˆå§‹åˆ†é…çš„éžå †å†…å­˜-XX:MaxPermSize=128M #JVMæœ€å¤§å…è®¸åˆ†é…çš„éžå †å†…å­˜ï¼ŒæŒ‰éœ€åˆ†é… tomcat jvmé…ç½®12345678910111213141516171819202122232425# æœåŠ¡ç«¯é…ç½®è¿œç¨‹è°ƒè¯•CATALINA_OPTS="$CATALINA_OPTS -server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5888"# jconsoleï¼ŒVisualVMï¼ŒJMC ç›‘æŽ§é…ç½®ï¼ˆrmiï¼‰# -Dcom.sun.management.jmxremote.authenticate=false ä¸º JMC å…³é—­é£žè¡Œæ¨¡å¼JAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote=true -Djava.rmi.server.hostname=121.40.84.8 -Dcom.sun.management.jmxremote.port=8999 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.managementote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false"# é…ç½®tomcatï¼Œæ—¥å¸¸GCæ—¥å¿—. å¯è®°å½•ä¸‹æœåŠ¡å™¨åŽ†å²çš„GCæƒ…å†µ# æ³¨æ„ï¼štomcatå¯åŠ¨åŽå¦‚æžœwebappsä¸‹æœªè‡ªåŠ¨åˆ›å»ºsysç›®å½•ï¼Œè¯·æ‰‹åŠ¨åˆ›å»º */webapps&gt;mkdir sys# é…ç½®è·¯å¾„åˆ°webappsä¸‹ï¼Œæ–¹ä¾¿æ—¥å¿—æ–‡ä»¶çš„ä¸‹è½½å’Œç›´æŽ¥å®šä½ï¼š# è®¿é—®ï¼š# http://121.40.87.121:8080/sys/gc.log# http://121.40.84.8:8080/sys/gc.log# å¯è§†åŒ–å·¥å…·:GCViewerå¯ä»¥ä½¿ç”¨ç½‘ç»œåœ°å€ç›´æŽ¥æŸ¥çœ‹CATALINA_OPTS="$CATALINA_OPTS -Xloggc:webapps/sys/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps"# jprofileæœåŠ¡å™¨ç«¯é…ç½®CATALINA_OPTS="$CATALINA_OPTS -agentlib:jprofilerti=port=8849,nowait -Xbootclasspath/a:/usr/local/jprofile/jprofiler9/bin/agent.jar"# jvm shut downæ—¶,è¾“å‡ºdumpæ–‡ä»¶CATALINA_OPTS="$CATALINA_OPTS -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/usr/local/apache-tomcat-7.0.59/logs/heap.dump" windows é…ç½®12345# æœåŠ¡ç«¯é…ç½®è¿œç¨‹è°ƒè¯•SET CATALINA_OPTS=-server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5888# jprofileæœåŠ¡å™¨ç«¯é…ç½®set CATALINA_OPTS=%CATALINA_OPTS% -agentpath:G:\workTool\jprofiler9\bin\windows-x64\jprofilerti.dll=port=8849,nowait]]></content>
      <categories>
        <category>javaåŸºç¡€</category>
      </categories>
  </entry>
</search>
