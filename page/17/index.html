<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="xiaowu&#39;s blog">
<meta property="og:url" content="http://yoursite.com/page/17/index.html">
<meta property="og:site_name" content="xiaowu&#39;s blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="xiaowu&#39;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/17/"/>





  <title>xiaowu's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">xiaowu's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/03/自定义服务端口存活监控/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/03/自定义服务端口存活监控/" itemprop="url">自定义服务端口存活监控</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T16:18:41+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/03/自定义服务端口存活监控/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/03/自定义服务端口存活监控/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote><p>content</p>
<footer><strong>[author[</strong><cite>source]] [link] [source_link_title]</cite></footer></blockquote>
<p>目前zabbix停用，使用自定义脚本监控端口存活，使用mutt+msmtp发送告警信息，稍后将短信通道也接入进来</p>
<p>monitor.sh脚本如下,读取的服务文件为server.list</p>
<p>变更记录</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>一次轮循监听时间由<span class="number">60</span>s改为<span class="number">5</span>s</span><br><span class="line"><span class="number">2.</span>监听异常连续三次才定义为告警，同时监听连续成功三次才定义为恢复。</span><br><span class="line"><span class="number">3.</span>nc替换为nmap</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#this script test UP to other host.</span></span><br><span class="line">LOGFILE=<span class="string">"/root/nz/nz.log"</span></span><br><span class="line">count=0</span><br><span class="line">n=0</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> server ip port</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;count&#125;</span> -eq 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    norepeat[<span class="variable">$n</span>]=1</span><br><span class="line">    unusual[<span class="variable">$n</span>]=0</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$&#123;norepeat[$n]&#125;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">nmap -Pn -p<span class="variable">$port</span> <span class="variable">$ip</span> | awk <span class="string">"\$1 ~ /<span class="variable">$port</span>/ &#123;print \$2&#125;"</span> | grep open &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;norepeat[$n]&#125;</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$&#123;unusual[$n]&#125;</span> -eq 0 ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            NOWOK=`date <span class="string">'+%G-%m-%d %H:%M:%S'</span>`</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$NOWOK</span>\|ok\|<span class="variable">$server</span>\|<span class="variable">$ip</span>\|<span class="variable">$port</span> &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1 &amp;</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$NOWOK</span>\|ok\|<span class="variable">$server</span>\|<span class="variable">$ip</span>\|<span class="variable">$port</span> |mutt -s <span class="string">"服务端口监听异常恢复"</span> op@zenzet.com</span><br><span class="line">            norepeat[<span class="variable">$n</span>]=1</span><br><span class="line">            <span class="comment">#echo "aaa" &gt;&gt; $LOGFILE 2&gt;&amp;1 &amp;</span></span><br><span class="line">        <span class="keyword">else</span>   </span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$server</span>:ok &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">            ((unusual[<span class="variable">$n</span>]--))</span><br><span class="line">            <span class="comment">#echo "bbb" &gt;&gt; $LOGFILE 2&gt;&amp;1 &amp;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span>   </span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$server</span>:ok &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">        <span class="comment">#echo "ccc" &gt;&gt; $LOGFILE 2&gt;&amp;1 &amp;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$&#123;norepeat[$n]&#125;</span> -eq 0 ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$server</span>:fail &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">        <span class="comment">#echo "ddd" &gt;&gt; $LOGFILE 2&gt;&amp;1 &amp;</span></span><br><span class="line">    <span class="keyword">else</span>   </span><br><span class="line">        <span class="keyword">if</span> [ <span class="variable">$&#123;unusual[$n]&#125;</span> -eq 3 ]</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            NOWFAIL=`date <span class="string">'+%G-%m-%d %H:%M:%S'</span>`</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$NOWFAIL</span>\|fail\|<span class="variable">$server</span>\|<span class="variable">$ip</span>\|<span class="variable">$port</span>\|<span class="variable">$&#123;unusual[$n]&#125;</span> &gt;&gt; <span class="variable">$LOGFILE</span> 2&gt;&amp;1 &amp;</span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$NOWFAIL</span>\|fail\|<span class="variable">$server</span>\|<span class="variable">$ip</span>\|<span class="variable">$port</span> |mutt -s <span class="string">"服务端口监听异常告警"</span> op@zenzet.com</span><br><span class="line">            norepeat[<span class="variable">$n</span>]=0</span><br><span class="line">            <span class="comment">#echo "eee" &gt;&gt; $LOGFILE 2&gt;&amp;1 &amp;</span></span><br><span class="line">        <span class="keyword">else</span>   </span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$server</span>:fail &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">            ((unusual[<span class="variable">$n</span>]++))</span><br><span class="line">            <span class="comment">#echo "fff" &gt;&gt; $LOGFILE 2&gt;&amp;1 &amp;</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">((n++))</span><br><span class="line"><span class="keyword">done</span> &lt; server.list</span><br><span class="line">n=0</span><br><span class="line">count=1</span><br><span class="line">sleep 5</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/03/服务配置集中管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/03/服务配置集中管理/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T16:17:26+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/03/服务配置集中管理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/03/服务配置集中管理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###目前适用于Java服务</p>
<p>TODO:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">内网etcd cluster</span><br><span class="line">etcd <span class="keyword">shell</span><span class="bash"></span></span><br><span class="line"><span class="bash">阿里云环境etcd</span></span><br></pre></td></tr></table></figure>
<p>OP-32 - 配置服务集中管理shell接入 关闭</p>
<p>脚本已在centos上验证通过，以lss-access服务为例子, 目前lss-access的开发、测试和UAT环境已生效此配置</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.设置/etc<span class="built_in">/profile </span>环境变量<span class="attribute">LSS_ENV</span>=dev或qa或uat或prod</span><br><span class="line">2.服务器需要root下安装jq，centos6的代码如下(centos7将代码块中的6改成7)</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm</span></span><br><span class="line">rpm -ivh epel-release-latest-<span class="number">6</span><span class="selector-class">.noarch</span><span class="selector-class">.rpm</span></span><br><span class="line">yum install jq -y</span><br></pre></td></tr></table></figure>
<p>3.启动脚本startServer.sh最前部分加入，将原有的一个SERVER_NAME=lss-access删除<br>启动参数加入第二个可选项 remote_conf ，加入此参数时候会走远程配置流程，不加入此参数会走原先流程读取本地配置</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./startServer<span class="selector-class">.sh</span> restart remote_conf</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">SERVER_NAME=lss-access</span><br><span class="line">RELOAD_CONF=<span class="variable">$2</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$RELOAD_CONF</span>"</span> = <span class="string">"remote_conf"</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">source</span> /etc/profile</span><br><span class="line">    APP_PATH=$(<span class="built_in">echo</span> <span class="variable">$PWD</span>)</span><br><span class="line">    APP_ENV=$(<span class="built_in">echo</span> <span class="variable">$LSS_ENV</span>)</span><br><span class="line">    CONF_ARR=(<span class="string">"app"</span> <span class="string">"log4j"</span>)</span><br><span class="line">    <span class="keyword">for</span> CONF_I <span class="keyword">in</span> <span class="variable">$&#123;CONF_ARR[@]&#125;</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">            CONF_FILE=<span class="variable">$&#123;APP_PATH&#125;</span><span class="string">"/conf/"</span><span class="variable">$&#123;CONF_I&#125;</span><span class="string">".properties"</span></span><br><span class="line">            CONF_KEY=<span class="variable">$&#123;APP_ENV&#125;</span><span class="string">"."</span><span class="variable">$SERVER_NAME</span><span class="string">"."</span><span class="variable">$&#123;CONF_I&#125;</span></span><br><span class="line">            CONF_URL=<span class="string">"http://conf.zenzet.com:2379/v2/keys/"</span><span class="variable">$CONF_KEY</span></span><br><span class="line">            REMOTE_CONF=<span class="string">"<span class="variable">$(curl -sf $CONF_URL \ | jq -r '.node.value')</span>"</span></span><br><span class="line">            <span class="keyword">if</span> [ ! <span class="string">"<span class="variable">$REMOTE_CONF</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"REMOTE_CONF is NULL,Use local config"</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                OLD_CONF_MD5SUM=`md5sum <span class="variable">$CONF_FILE</span> | sed <span class="string">'s/ /\n/g'</span>| sed -n 1p`</span><br><span class="line">                NEW_CONF_MD5SUM=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$REMOTE_CONF</span>"</span> | md5sum | sed <span class="string">'s/ /\n/g'</span>| sed -n 1p`</span><br><span class="line">                <span class="keyword">if</span> [ <span class="string">"<span class="variable">$NEW_CONF_MD5SUM</span>"</span> != <span class="string">"<span class="variable">$OLD_CONF_MD5SUM</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">                        <span class="built_in">echo</span> $(date)<span class="string">":MD5("</span><span class="variable">$&#123;CONF_I&#125;</span><span class="string">".properties) Version is not same,updated"</span></span><br><span class="line">                        <span class="built_in">echo</span> <span class="string">"<span class="variable">$REMOTE_CONF</span>"</span> &gt; <span class="variable">$CONF_FILE</span> 2&gt;&amp;1 &amp;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                        <span class="built_in">echo</span> $(date)<span class="string">":MD5("</span><span class="variable">$&#123;CONF_I&#125;</span><span class="string">".properties) Version is same"</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/03/实例启停自动化示例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/03/实例启停自动化示例/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T16:13:23+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/03/实例启停自动化示例/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/03/实例启停自动化示例/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>拿finalspeed 在内网Centos7下的运行情况做个例子</p>
<p>1.将脚本finalspeed放倒目录 /etc/init.d 下 注册为服务</p>
<p>使用service finalspeed start|stop|restart 命令启动服务</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment"># chkconfig: - 85 15</span></span><br><span class="line"><span class="comment">#description: agent is the itsm base thing</span></span><br><span class="line">case <span class="string">"$1"</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">  echo -n <span class="string">"starting finalspeed"</span></span><br><span class="line">cd <span class="regexp">/root/</span>fs</span><br><span class="line">nohup java -jar client.jar &gt;<span class="regexp">/dev/</span>null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line">echo <span class="string">" OK "</span></span><br><span class="line"> ;;</span><br><span class="line">stop)</span><br><span class="line">echo -n <span class="string">"shutdown finalspeed:"</span></span><br><span class="line">pid=`ps -ef|grep client.jar |grep -v grep |awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line">  kill -<span class="number">9</span> <span class="variable">$pid</span></span><br><span class="line">echo <span class="string">"OK"</span></span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line"><span class="variable">$0</span> stop</span><br><span class="line"><span class="variable">$0</span> start</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">echo <span class="string">"Usage: `basename $0` start|stop|restart"</span></span><br><span class="line"><span class="keyword">exit</span> <span class="number">1</span></span><br><span class="line">esac</span><br><span class="line"><span class="keyword">exit</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>2.如需开启随机启动 chkconfig finalspeed on</p>
<p>3.如需定制定时重启等计划<br>编辑crontab -e<br>查看crontab -l</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/03/centos7一键部署mysql-postgresql-redis-mongodb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/03/centos7一键部署mysql-postgresql-redis-mongodb/" itemprop="url">centos7一键部署mysql-postgresql-redis-mongodb</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T16:10:45+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/03/centos7一键部署mysql-postgresql-redis-mongodb/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/03/centos7一键部署mysql-postgresql-redis-mongodb/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>root下执行：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o- <span class="keyword">ftp</span>://<span class="keyword">ftp</span>@<span class="keyword">ftp</span>.zenzet.com/<span class="built_in">shell</span>/MPRM.sh | bash</span><br></pre></td></tr></table></figure>
<p>脚本结束后记得关闭重连一次ssh</p>
<p>MPRM.sh内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author: ristory</span></span><br><span class="line"><span class="comment">###########install redis###########install redis###########install redis###########install redis###########install redis###########</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">wget http://download.redis.io/releases/redis-3.2.8.tar.gz</span><br><span class="line">tar zxvf redis-3.2.8.tar.gz</span><br><span class="line">rm -rf redis-3.2.8.tar.gz</span><br><span class="line">mv redis-3.2.8 /usr/<span class="built_in">local</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/redis-3.2.8</span><br><span class="line">make</span><br><span class="line">sed -i <span class="string">'/bind 127.0.0.1/s/bind 127.0.0.1/bind 0.0.0.0/'</span> /usr/<span class="built_in">local</span>/redis-3.2.8/redis.conf</span><br><span class="line">sed -i <span class="string">'/daemonize no/s/no/yes/'</span> /usr/<span class="built_in">local</span>/redis-3.2.8/redis.conf</span><br><span class="line">sed -i <span class="string">'/# requirepass foobared/s/# requirepass foobared/requirepass Dryg-dEb-maf-jErj-eG-Ew-/'</span> /usr/<span class="built_in">local</span>/redis-3.2.8/redis.conf</span><br><span class="line"><span class="comment">#启动redis</span></span><br><span class="line">/usr/<span class="built_in">local</span>/redis-3.2.8/src/redis-server /usr/<span class="built_in">local</span>/redis-3.2.8/redis.conf</span><br><span class="line"><span class="comment">###########install mongo###########install mongo###########install mongo###########install mongo###########install mongo###########</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-3.4.1.tgz</span><br><span class="line">tar -zxvf mongodb-linux-x86_64-rhel70-3.4.1.tgz</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/</span><br><span class="line">mkdir -p mongodb</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mongodb</span><br><span class="line">mv /root/mongodb-linux-x86_64-rhel70-3.4.1/* /usr/<span class="built_in">local</span>/mongodb</span><br><span class="line">rm -rf /root/mongo*</span><br><span class="line">mkdir -p data</span><br><span class="line">mkdir -p logs</span><br><span class="line">sudo tee bin/mongodb.conf &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">dbpath = /usr/<span class="built_in">local</span>/mongodb/data</span><br><span class="line">logpath = /usr/<span class="built_in">local</span>/mongodb/logs/mongodb.log</span><br><span class="line">bind_ip = 0.0.0.0   </span><br><span class="line">port = 27017 </span><br><span class="line">fork = <span class="literal">true</span> </span><br><span class="line">nohttpinterface = <span class="literal">true</span></span><br><span class="line">EOF</span><br><span class="line"><span class="comment">#启动mongodb程序（使用配置文件mongodb.conf定义的参数启动）：</span></span><br><span class="line">/usr/<span class="built_in">local</span>/mongodb/bin/mongod --config /usr/<span class="built_in">local</span>/mongodb/bin/mongodb.conf</span><br><span class="line"><span class="comment">#新建数据库和用户密码</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mongodb/bin</span><br><span class="line">./mongo &lt;&lt;EOF</span><br><span class="line">use testdb;</span><br><span class="line">db.usr.insert(&#123;<span class="string">'name'</span>:<span class="string">'tompig'</span>&#125;);</span><br><span class="line">db.usr.insert(&#123;<span class="string">'name'</span>:<span class="string">'tompig1'</span>,<span class="string">'id'</span>:1&#125;);</span><br><span class="line">db.createUser( </span><br><span class="line"> &#123; </span><br><span class="line">     user: <span class="string">"zenzet"</span>, </span><br><span class="line">     <span class="built_in">pwd</span>: <span class="string">"dYjUnqcdoGZ48sHfLrRZ"</span>, </span><br><span class="line">     roles: </span><br><span class="line">     [ </span><br><span class="line">       &#123; </span><br><span class="line">         role: <span class="string">"readWrite"</span>, </span><br><span class="line">         db: <span class="string">"testdb"</span> </span><br><span class="line">       &#125; </span><br><span class="line">     ] </span><br><span class="line">   &#125; </span><br><span class="line"> )  ;</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">EOF</span><br><span class="line"><span class="comment">#配置开机自启动mongodb</span></span><br><span class="line"><span class="comment">#vi /etc/rc.d/rc.local </span></span><br><span class="line"><span class="comment">#在文件中加入：</span></span><br><span class="line"><span class="comment">#/usr/local/mongodb/bin/mongod --config /usr/local/mongodb/bin/mongodb.conf </span></span><br><span class="line"><span class="comment">###########install postgresql###########install postgresql###########install postgresql###########install postgresql###########</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">sed -i <span class="string">'/\[base\]/a\exclude=postgresql*'</span> /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">sed -i <span class="string">'/\[updates\]/a\exclude=postgresql*'</span> /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line"><span class="comment">#http://yum.postgresql.org/repopackages.php</span></span><br><span class="line">yum -y localinstall https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-centos96-9.6-3.noarch.rpm</span><br><span class="line"><span class="comment">#yum list postgres*</span></span><br><span class="line">yum -y install postgresql96-server</span><br><span class="line"><span class="comment">#initdb</span></span><br><span class="line">su - postgres -c /usr/pgsql-9.6/bin/initdb</span><br><span class="line"><span class="comment">#/usr/pgsql-9.6/bin/pg_ctl -D /var/lib/pgsql/9.6/data -l logfile start</span></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/pgsql/9.6/data</span><br><span class="line">sed -i <span class="string">'/#listen_addresses/s/#listen_addresses/listen_addresses/'</span> /var/lib/pgsql/9.6/data/postgresql.conf</span><br><span class="line">sed -i <span class="string">'/listen_addresses/s/localhost/*/'</span> /var/lib/pgsql/9.6/data/postgresql.conf</span><br><span class="line">sed -i <span class="string">'/#port = 5432/s/#port = 5432/port = 1921/'</span> /var/lib/pgsql/9.6/data/postgresql.conf</span><br><span class="line"><span class="comment">#修改访问控制文件</span></span><br><span class="line">sed -i <span class="string">'/# IPv4 local connections:/a\host    all    all    0.0.0.0/0    md5'</span> /var/lib/pgsql/9.6/data/pg_hba.conf</span><br><span class="line"><span class="comment">#systemctl enable|disable|start|stop|restart postgresql-9.6</span></span><br><span class="line">systemctl restart postgresql-9.6</span><br><span class="line"><span class="comment">#创建数据库</span></span><br><span class="line">su -l postgres -c <span class="string">"psql -U postgres -w -p 1921  -c \"create database lss_log;\""</span></span><br><span class="line"><span class="comment">#修改postgres密码</span></span><br><span class="line">su -l postgres -c <span class="string">"psql -U postgres -w -p 1921  -c \"ALTER USER postgres WITH PASSWORD 'uhP6BdZCVdhwAizywg6t';\""</span></span><br><span class="line"><span class="comment">###########install mysql###########install mysql###########install mysql###########install mysql###########install mysql###########</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">wget http://repo.mysql.com/mysql-community-release-el7-7.noarch.rpm</span><br><span class="line">rpm -ivh mysql-community-release-el7-7.noarch.rpm</span><br><span class="line">rm -rf mysql-community-release-el7-7.noarch.rpm</span><br><span class="line">yum -y install mysql-server</span><br><span class="line">sed -i <span class="string">'/sql_mode/a\collation-server=utf8_general_ci'</span> /etc/my.cnf</span><br><span class="line">sed -i <span class="string">'/sql_mode/a\character_set_server=utf8'</span> /etc/my.cnf</span><br><span class="line">sed -i <span class="string">'/sql_mode/a\lower_case_table_names=1'</span> /etc/my.cnf</span><br><span class="line">systemctl <span class="built_in">disable</span> mysqld</span><br><span class="line">systemctl restart mysqld</span><br><span class="line">mysql -uroot &lt;&lt;EOF</span><br><span class="line">SET PASSWORD FOR <span class="string">'root'</span>@<span class="string">'localhost'</span> = PASSWORD(<span class="string">'pgsJDBtkR9xuUQD3tiwv'</span>);</span><br><span class="line">create database openserver character <span class="built_in">set</span> UTF8;</span><br><span class="line">grant all on openserver.* to openserver@<span class="string">"%"</span> identified by <span class="string">"3wBc8@NZRG6dL3BYY4g4"</span>;</span><br><span class="line">grant all on openserver.* to openserver@<span class="string">"localhost"</span> identified by <span class="string">"3wBc8@NZRG6dL3BYY4g4"</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">EOF</span><br><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/03/centos7一键部署java和node环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/03/centos7一键部署java和node环境/" itemprop="url">centos7一键部署java和node环境</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-03T16:09:15+08:00">
                2017-08-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/03/centos7一键部署java和node环境/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/03/centos7一键部署java和node环境/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>root下执行<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -o- <span class="keyword">ftp</span>://<span class="keyword">ftp</span>@<span class="keyword">ftp</span>.zenzet.com/<span class="built_in">shell</span>/initCentos7.sh | bash</span><br></pre></td></tr></table></figure></p>
<h4 id="initCentos7-sh内容"><a href="#initCentos7-sh内容" class="headerlink" title="initCentos7.sh内容"></a>initCentos7.sh内容</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author: ristory</span></span><br><span class="line"><span class="comment">#modified: Sun Yu @2016-11-24</span></span><br><span class="line"><span class="comment">#description: init development environment</span></span><br><span class="line">yum update -y</span><br><span class="line">yum install -y lrzsz wget curl unzip net-tools gcc.x86_64 gcc-c++ </span><br><span class="line"><span class="comment">#jdk env(jdk8+jce8)</span></span><br><span class="line">mkdir -p /root/java</span><br><span class="line"><span class="built_in">cd</span> /root/java</span><br><span class="line">wget ftp://ftp@ftp.zenzet.com/docker/jdk-8u102-linux-x64.rpm</span><br><span class="line">rpm -ivh jdk-8u102-linux-x64.rpm</span><br><span class="line">rm jdk-8u102-linux-x64.rpm</span><br><span class="line">sed -i <span class="string">'$a #set java environment'</span> /etc/profile</span><br><span class="line">sed -i <span class="string">'$a export JAVA_HOME=/usr/java/latest'</span> /etc/profile</span><br><span class="line">sed -i <span class="string">'$a export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar'</span> /etc/profile</span><br><span class="line">sed -i <span class="string">'$a export PATH=$PATH:$JAVA_HOME/bin'</span> /etc/profile</span><br><span class="line">sed -i <span class="string">'$a export NVM_DIR=/root/.nvm'</span> /etc/profile</span><br><span class="line">sed -i <span class="string">'$a export NVM_DIR JAVA_HOME CLASSPATH PATH'</span> /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">cd</span> /usr/bin</span><br><span class="line">ln -s -f /usr/java/latest/bin/java</span><br><span class="line">java -version</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========================================="</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"===				JDK8 ok				==="</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========================================="</span></span><br><span class="line"><span class="built_in">cd</span> /root/java</span><br><span class="line">wget ftp://ftp@ftp.zenzet.com/docker/jce_policy-8.zip</span><br><span class="line">unzip jce_policy-8.zip</span><br><span class="line"><span class="built_in">cd</span> /usr/java/latest/jre/lib/security</span><br><span class="line">mv local_policy.jar local_policy.jar.bak</span><br><span class="line">mv US_export_policy.jar US_export_policy.jar.bak</span><br><span class="line">cp /root/java/UnlimitedJCEPolicyJDK8/local_policy.jar /usr/java/latest/jre/lib/security</span><br><span class="line">cp /root/java/UnlimitedJCEPolicyJDK8/US_export_policy.jar /usr/java/latest/jre/lib/security</span><br><span class="line">rm -rf /root/java/UnlimitedJCEPolicyJDK8</span><br><span class="line">rm -rf jce_policy-8.zip</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========================================="</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"===				JCE8 ok				==="</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========================================="</span></span><br><span class="line">su - deployer -c <span class="string">"curl -o- ftp://ftp@ftp.zenzet.com/shell/initNodeJS.sh | bash"</span></span><br><span class="line">rm -rf install.sh</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========================================="</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"===		    Stop firewall ok    	==="</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========================================="</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========================================="</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"===	 100% Done. Pls reconnect ssh  	==="</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"========================================="</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#author: Sun Yu</span></span><br><span class="line"><span class="comment">#description: init development environment#node env(v0.10.48+v6.9.1withcnpm+pm2)</span></span><br><span class="line">cd /home/deployer</span><br><span class="line">wget -O- https://raw.githubusercontent.com/aliyun-<span class="keyword">node</span><span class="title">/tnvm</span>/<span class="literal">master</span>/install.sh | bash</span><br><span class="line">source /home/deployer/.bashrc</span><br><span class="line">tnvm install <span class="keyword">node</span><span class="title">-v0</span>.<span class="number">10.48</span></span><br><span class="line">tnvm use <span class="keyword">node</span><span class="title">-v0</span>.<span class="number">10.48</span></span><br><span class="line">echo <span class="string">"========================================="</span></span><br><span class="line">echo <span class="string">"===           Node v0.10.48 ok        ==="</span></span><br><span class="line">echo <span class="string">"========================================="</span></span><br><span class="line">tnvm install <span class="keyword">node</span><span class="title">-v6</span>.<span class="number">9.1</span></span><br><span class="line">tnvm use <span class="keyword">node</span><span class="title">-v6</span>.<span class="number">9.1</span></span><br><span class="line">npm install cnpm -g --<span class="attr">registry=</span>https://registry.npm.taobao.org</span><br><span class="line">cnpm install -g pm2</span><br><span class="line">echo <span class="string">"========================================="</span></span><br><span class="line">echo <span class="string">"===    Node v6.9.1 + cnpm + pm2 ok    ==="</span></span><br><span class="line">echo <span class="string">"========================================="</span></span><br><span class="line">rm -rf install.sh</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/01/Spring Bean的初始化启动方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/01/Spring Bean的初始化启动方式/" itemprop="url">Spring Bean的初始化启动方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-01T00:00:00+08:00">
                2017-08-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/01/Spring Bean的初始化启动方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/01/Spring Bean的初始化启动方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="方式一-xml-lt-bean-init-method-quot-init-quot"><a href="#方式一-xml-lt-bean-init-method-quot-init-quot" class="headerlink" title="方式一: xml &lt;bean init-method=&quot;init&quot;"></a>方式一: <code>xml &lt;bean init-method=&quot;init&quot;</code></h1><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.fraudmetrix.billing.consumer.FlowConsumer"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"destroy"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"kafkaTopics"</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;billing.kafka.topics&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"debug"</span> <span class="attr">value</span>=<span class="string">"$</span></span></span><span class="template-variable">&#123;billing.flow.consumer.debug&#125;</span><span class="xml"><span class="tag"><span class="string">"</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h1 id="方式二-implements-InitializingBean"><a href="#方式二-implements-InitializingBean" class="headerlink" title="方式二: implements InitializingBean"></a>方式二: <code>implements InitializingBean</code></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DisconfPropertiesFactory</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Properties</span>&gt;, <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.singleton) &#123;</span><br><span class="line">            <span class="keyword">this</span>.singletonInstance = <span class="keyword">this</span>.createProperties();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h1 id="方式三-注解-PostConstruct-PreDestroy"><a href="#方式三-注解-PostConstruct-PreDestroy" class="headerlink" title="方式三:注解@PostConstruct @PreDestroy"></a>方式三:<code>注解@PostConstruct @PreDestroy</code></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myapp.core.annotation.init;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;  </span><br><span class="line"><span class="keyword">import</span> javax.annotation.PreDestroy;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonService</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;  </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> message;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>.message = message;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"I'm init method using @PostConstrut...."</span>+message);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dostory</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"I'm destory method using @PreDestroy....."</span>+message);  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="bean-factory负责bean创建的最初四步，然后移交给应用上下文做后续创建过程："><a href="#bean-factory负责bean创建的最初四步，然后移交给应用上下文做后续创建过程：" class="headerlink" title="bean factory负责bean创建的最初四步，然后移交给应用上下文做后续创建过程："></a>bean factory负责bean创建的最初四步，然后移交给应用上下文做后续创建过程：</h2><ul>
<li>1.Spring初始化bean</li>
<li>2.Spring将值和其他bean的引用注入（inject）到当前bean的对应属性中；</li>
<li>3.如果Bean实现了BeanNameAware接口，Spring会传入bean的ID来调用setBeanName方法；</li>
<li>4.如果Bean实现了BeanFactoryAware接口，Spring传入bean factory的引用来调用setBeanFactory方法；</li>
<li>5.如果Bean实现了ApplicationContextAware接口，Spring将传入应用上下文的引用来调用setApplicationContext方法；</li>
<li>6.如果Bean实现了BeanPostProcessor接口，则Spring调用postProcessBeforeInitialization方法，这个方法在初始化和属性注入之后调用，在任何初始化代码之前调用；</li>
<li>7.如果Bean实现了InitializingBean接口，则需要调用该接口的afterPropertiesSet方法；如果在bean定义的时候设置了init-method属性，则需要调用该属性指定的初始化方法；</li>
<li>8.如果Bean实现了BeanPostProcessor接口，则Spring调用postProcessAfterInitialization方法</li>
<li>9.在这个时候bean就可以用于在应用上下文中使用了，当上下文退出时bean也会被销毁；</li>
<li>10.如果Bean实现了DisposableBean接口，Spring会调用destroy()方法;如果在bean定义的时候设置了destroy-method， 则此时需要调用指定的方法。</li>
</ul>
<p><code>Spring实战1：Spring初探 - 简书</code><br><a href="http://www.jianshu.com/p/9370707091ef" target="_blank" rel="external">http://www.jianshu.com/p/9370707091ef</a></p>
<hr>
<p><strong>参考</strong><br><code>13 Spring Bean init-method 和 destroy-method实例 - 简书</code><br><a href="http://www.jianshu.com/p/30a0a74cd31f" target="_blank" rel="external">http://www.jianshu.com/p/30a0a74cd31f</a></p>
<p><code>通过Spring @PostConstruct 和 @PreDestroy 方法 实现初始化和销毁bean之前进行的操作 - 安德里亚的成长 - CSDN博客</code><br><a href="http://blog.csdn.net/topwqp/article/details/8681497" target="_blank" rel="external">http://blog.csdn.net/topwqp/article/details/8681497</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/19/面试第一题 - HashMap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/19/面试第一题 - HashMap/" itemprop="url">面试第一题 - HashMap</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-19T00:00:00+08:00">
                2017-07-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/19/面试第一题 - HashMap/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/07/19/面试第一题 - HashMap/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="考察"><a href="#考察" class="headerlink" title="考察"></a>考察</h1><ul>
<li><p>集合类的<code>日常 使用</code>及场景理解：</p>
<ul>
<li>数组/link双向链表/Tree/ statck ：数据结构差异带来的<code>有序无序</code>，<code>可否重复</code>，<code>查询与删除效率</code>，<code>先进后出</code> 差异</li>
<li><p>线程安全的并发支持差异： Vector- Stack   、HashTable、Properties</p>
</li>
<li><p>快速失败、安全失败的差异</p>
</li>
</ul>
</li>
<li><p><code>技术实现原理认识</code>：</p>
<ul>
<li><p>默认 hash 数组长度及增长因子</p>
</li>
<li><p>hash数组的定位-位运算 (size-1) 取模</p>
</li>
<li>hash冲突的处理机制（拉链，Tree）</li>
<li>resize的hash数组的扩容和元素位移策略-位运算size取模</li>
</ul>
</li>
<li><p><code>思想利用（举一反三）</code></p>
<ul>
<li>hash table 通用的hash索引技术</li>
<li><p>（size-1）取模，范围内随机定位的最高效方法</p>
</li>
<li><p>数据结构：红黑树，优秀的最坏情况排序方法</p>
</li>
</ul>
</li>
<li><p><code>进阶探索</code></p>
<ul>
<li><p><code>线程安全( java.util.concurrent )</code>：hashTable，ConcurrentHashMap</p>
<ul>
<li>并发锁，分段锁，CAS锁</li>
</ul>
<ul>
<li><p><code>skiplist（跳表）</code>： ConcurrentSkipListMap， ConcurrentSkipListSet    </p>
<ul>
<li>数据结构： SkipList跳表，接近红黑树的排序性能，但具备更简单的数据结构</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>总结</code>：<br>不同层次的技术员，会要求不同层次的认知。更重要的是， 其它掌握的技术要求深度会于此等同。<br>作为一个技术员，因及时评估自己掌握或触及的知识，是否过于浅薄。把学习心态做的日常</p>
<hr>
<h1 id="HashMap-数据结构、扩展策略-Hash-冲突攻击如何防范-如何实现线程安全的-HashMap"><a href="#HashMap-数据结构、扩展策略-Hash-冲突攻击如何防范-如何实现线程安全的-HashMap" class="headerlink" title="HashMap 数据结构、扩展策略,Hash 冲突攻击如何防范,如何实现线程安全的 HashMap?"></a>HashMap 数据结构、扩展策略,Hash 冲突攻击如何防范,如何实现线程安全的 HashMap?</h1><p>结构: <code>数组加链表</code>(java8 中链表长度超过8 时, 会改成平衡树实现)<br>扩展: <code>resize</code> , 当超过loadfactor 因子时,默认 0.75 , 触发扩展,rehash , 将旧的元素迁移到新的<br>hash collision attack : 修改hash 非随机算法, 限制post 参数个数,大小 , 防火前检测异常请求<br>使用 ConcurrentHashMap : <code>CHM 实现采用了 segment 锁</code> , 8 之后采用的<code>CAS 技术</code><br>哈希冲突解决方法: <code>链表法</code>(java 当前实现),建立公共溢出区 , 开发<code>定址法</code>。</p>
<h2 id="双hash"><a href="#双hash" class="headerlink" title="双hash"></a>双hash</h2><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> hash(<span class="keyword">Object</span> <span class="built_in">key</span>) &#123;</span><br><span class="line">    <span class="built_in">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">key</span> == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = <span class="built_in">key</span>.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对Object的hashCode进行16位的<code>无符号右移&gt;&gt;&gt;</code> 再与hashCode进行<code>位异（^）10&gt;1</code>运算<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">计算<span class="keyword">key</span>.hashCode（）和扩展（<span class="keyword">XOR</span>）更高的散列比特到较低。 由于该表使用二次幂掩蔽，所以仅在当前掩码之上的位数变化的散列集将总是相冲突。 （其中已知的例子是在小型表格中保持连续整数的浮点键集合）。因此，我们应用一种将高位的影响向下扩展的变换。 速度，效用和位扩展质量之间存在权衡。 因为许多常见的散列集合已经合理分配（因此不会受益于扩散），并且因为我们使用树来处理大量的冲突，所以我们只是以最便宜的方式将<span class="keyword">XOR</span>移位，以减少系统损失， 以及包含由于表格界限而无法在索引计算中使用的最高位的影响。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Integer i=<span class="number">100</span>;</span><br><span class="line"><span class="keyword">int</span> ihc =i.hashCode();</span><br><span class="line">System.out.<span class="built_in">println</span>(ihc);</span><br><span class="line">System.out.<span class="built_in">println</span>((ihc&gt;&gt;&gt;<span class="number">16</span>) ^ ihc);<span class="comment">// 仅会影响到高16位存在数值的对象 </span></span><br><span class="line"><span class="comment">// 作用：jdk的hashCode算法原因,有可能存在大量对象hashcode的变化体现在高16位,而低16位相对稳定,如此会造成hash表分配的不均匀</span></span><br></pre></td></tr></table></figure>
<p>jdk1.8 这样设计保证了对象的hashCode的高16位的变化能反应到低16位中，相比较而言减少了过多的位运算，是一种折中的设计。</p>
<p><code>Java中hashCode()方法以及HashMap()中hash()方法 - TonyLuis - 博客园</code><br><a href="http://www.cnblogs.com/tonyluis/p/5671873.html" target="_blank" rel="external">http://www.cnblogs.com/tonyluis/p/5671873.html</a></p>
<p><code>HashMap hash方法分析 - Java综合 - Java - ITeye论坛</code><br><a href="http://www.iteye.com/topic/709945" target="_blank" rel="external">http://www.iteye.com/topic/709945</a></p>
<h2 id="数组定位"><a href="#数组定位" class="headerlink" title="数组定位"></a>数组定位</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HashMap.Node&lt;K,V&gt;[] <span class="built_in">tab</span>; HashMap.Node&lt;K,V&gt; p; int n, i;</span><br><span class="line"><span class="keyword">if</span> ((<span class="built_in">tab</span> = table) == <span class="built_in">null</span> || (n = <span class="built_in">tab</span>.length) == <span class="number">0</span>)</span><br><span class="line">    n = (<span class="built_in">tab</span> = resize()).length;</span><br><span class="line"><span class="keyword">if</span> ((p = <span class="built_in">tab</span>[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="built_in">null</span>)</span><br><span class="line">    <span class="built_in">tab</span>[i] = newNode(hash, <span class="built_in">key</span>, value, <span class="built_in">null</span>);</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br></pre></td></tr></table></figure>
<p>关键：<code>tab[i = (n - 1) &amp; hash])</code><br>数字长度与hash进行<code>位与( &amp; 11&gt;1 )</code> 运算（取模运算） ，作用：结果值一定会在（n-1）的范围以内<br>分配均匀，通过利用hashCode的高16位和低16位的<code>位异(^)</code>来保障。如下图示意：</p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-8-12/15348420.jpg" alt=""></p>
<h2 id="数组位已经占用，处理机制"><a href="#数组位已经占用，处理机制" class="headerlink" title="数组位已经占用，处理机制"></a>数组位已经占用，处理机制</h2><ul>
<li><p>hash相同，key内存地址相同或key值equals相同则覆盖</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (<span class="name">p</span>.hash == hash <span class="symbol">&amp;&amp;</span></span><br><span class="line">        ((<span class="name">k</span> = p.key) == key || (<span class="name">key</span> != null <span class="symbol">&amp;&amp;</span> key.equals(<span class="name">k</span>))))</span><br><span class="line">    e = p<span class="comment">;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果对象类型是TreeNode类型，说明已经是红黑树代替了链表，并向其中插入结点</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, <span class="built_in">key</span>, value);</span><br></pre></td></tr></table></figure>
</li>
<li><p>非空，非树，那么就是链表，将新值插入到next中。逐个比较，hash相同，key内存地址相同或key值equals相关进行替换，为null时直接存放。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (int binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((e = p.next) == <span class="built_in">null</span>) &#123;</span><br><span class="line">            p.next = newNode(hash, <span class="built_in">key</span>, value, <span class="built_in">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                treeifyBin(<span class="built_in">tab</span>, hash);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                ((k = e.<span class="built_in">key</span>) == <span class="built_in">key</span> || (<span class="built_in">key</span> != <span class="built_in">null</span> &amp;&amp; <span class="built_in">key</span>.equals(k))))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        p = e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="resize"><a href="#resize" class="headerlink" title="resize"></a>resize</h2><ul>
<li><p><code>调用 时机</code>：超出负载值</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="comment">(++size &gt; threshold)</span></span><br><span class="line">    resize<span class="comment">()</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>处理内容</code>：计算扩容大小 - 新建hash表 - 将老数据填充过去<br><code>技巧</code>：扩容前后的hash 位与(<code>&amp;</code>)运算，结果为0即位置不变，否则位置+原hash表length</p>
</li>
</ul>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">int threshold; </span><br><span class="line"><span class="keyword">static</span> final int MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>; </span><br><span class="line"><span class="keyword">static</span> final int DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16 </span></span><br><span class="line"><span class="keyword">static</span> final float DEFAULT_LOAD_FACTOR = <span class="number">0.75</span>f; </span><br><span class="line">final float loadFactor; </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 扩容方法，不能被重写 </span></span><br><span class="line">     final Node&lt;K, V&gt;[] resize() &#123; </span><br><span class="line">           Node&lt;K, V&gt;[] oldTab = table; </span><br><span class="line">           <span class="comment">// 获取当前容量 </span></span><br><span class="line">           int oldCap = (oldTab == <span class="literal">null</span>) ? <span class="number">0</span> : <span class="type">oldTab</span>.length; </span><br><span class="line">           <span class="comment">// 获取扩容阀值，默认0 </span></span><br><span class="line">           int oldThr = threshold; </span><br><span class="line">           <span class="comment">// newCap 新容量 newThr 新阀值 </span></span><br><span class="line">           int <span class="keyword">new</span><span class="type">Cap</span>, <span class="keyword">new</span><span class="type">Thr</span> = <span class="number">0</span>; </span><br><span class="line"> </span><br><span class="line">           <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123; </span><br><span class="line">                <span class="comment">// 判断其容量如果大于最大值就将扩容阀值设置为Integer最大值 </span></span><br><span class="line">                <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123; </span><br><span class="line">                      threshold = Integer.MAX_VALUE; </span><br><span class="line">                      <span class="keyword">return</span> oldTab; </span><br><span class="line">                      <span class="comment">// 判断当前容量的两倍是否小于最大容量限定，并且当前容量是否大于等于默认的16 ，满足条件就将当前容量扩大一倍 </span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="keyword">new</span><span class="type">Cap</span> = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) </span><br><span class="line">                      <span class="keyword">new</span><span class="type">Thr</span> = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold </span></span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold </span></span><br><span class="line">                <span class="keyword">new</span><span class="type">Cap</span> = oldThr; </span><br><span class="line">           <span class="comment">// 走到这代表是个新map首次创建 </span></span><br><span class="line">           <span class="keyword">else</span> &#123; <span class="comment">// zero initial threshold signifies using defaults </span></span><br><span class="line">                      <span class="comment">// 初始化容量16 </span></span><br><span class="line">                <span class="keyword">new</span><span class="type">Cap</span> = DEFAULT_INITIAL_CAPACITY; </span><br><span class="line">                <span class="comment">// 初始化计算扩容阀值12 </span></span><br><span class="line">                <span class="keyword">new</span><span class="type">Thr</span> = (int) (DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); </span><br><span class="line">           &#125; </span><br><span class="line">           <span class="keyword">if</span> (<span class="keyword">new</span><span class="type">Thr</span> == <span class="number">0</span>) &#123; </span><br><span class="line">                float ft = <span class="keyword">new</span><span class="type">Cap</span> * loadFactor; </span><br><span class="line">                <span class="keyword">new</span><span class="type">Thr</span> = (<span class="keyword">new</span><span class="type">Cap</span> &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY ? (int) ft : <span class="type">Integer</span>.MAX_VALUE); </span><br><span class="line">           &#125; </span><br><span class="line">           threshold = <span class="keyword">new</span><span class="type">Thr</span>; </span><br><span class="line">           @SuppressWarnings(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;) </span><br><span class="line">           Node&lt;K, V&gt;[] <span class="keyword">new</span><span class="type">Tab</span> = <span class="keyword">new</span> <span class="type">Node</span>[<span class="keyword">new</span><span class="type">Cap</span>]; </span><br><span class="line">           <span class="comment">// 赋值扩容完的node[]给teble </span></span><br><span class="line">           table = <span class="keyword">new</span><span class="type">Tab</span>; </span><br><span class="line">           <span class="comment">// 判断当前table是否为空，如果为null说明是新建，否则为扩容 </span></span><br><span class="line">           <span class="keyword">if</span> (oldTab != <span class="literal">null</span>) &#123; </span><br><span class="line">                <span class="comment">// 根据当前容量循环Node </span></span><br><span class="line">                <span class="keyword">for</span> (int j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123; </span><br><span class="line">                      Node&lt;K, V&gt; e; </span><br><span class="line">                      <span class="comment">// 先将老对象赋值给成员变量，然后判断其是否为null </span></span><br><span class="line">                      <span class="keyword">if</span> ((e = oldTab[j]) != <span class="literal">null</span>) &#123; </span><br><span class="line">                           <span class="comment">// 将老对象设置为null，方便垃圾回收 </span></span><br><span class="line">                           oldTab[j] = <span class="literal">null</span>; </span><br><span class="line">                           <span class="comment">// 如果当前元素没有下一个元素，计算出其index并赋值给新node[] </span></span><br><span class="line">                           <span class="keyword">if</span> (e.next == <span class="literal">null</span>) </span><br><span class="line">                                 <span class="keyword">new</span><span class="type">Tab</span>[e.hash &amp; (<span class="keyword">new</span><span class="type">Cap</span> - <span class="number">1</span>)] = e; </span><br><span class="line">                           <span class="comment">// 判断其是否为红黑树 </span></span><br><span class="line">                           <span class="keyword">else</span> <span class="keyword">if</span> (e instanceof TreeNode) </span><br><span class="line">                                 ((TreeNode&lt;K, V&gt;) e).split(<span class="built_in">this</span>, <span class="keyword">new</span><span class="type">Tab</span>, j, oldCap); </span><br><span class="line">                           <span class="keyword">else</span> &#123; <span class="comment">// preserve order 保持顺序 </span></span><br><span class="line">                                 Node&lt;K, V&gt; loHead = <span class="literal">null</span>, loTail = <span class="literal">null</span>; </span><br><span class="line">                                 Node&lt;K, V&gt; hiHead = <span class="literal">null</span>, hiTail = <span class="literal">null</span>; </span><br><span class="line">                                 Node&lt;K, V&gt; next; </span><br><span class="line">                                 <span class="keyword">do</span> &#123; </span><br><span class="line">                                      next = e.next; </span><br><span class="line">                                      <span class="comment">// 根据hash oldCap计算出结果，将符合结果的元素组建成为新的链表lo </span></span><br><span class="line">                                      <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123; </span><br><span class="line">                                            <span class="keyword">if</span> (loTail == <span class="literal">null</span>) </span><br><span class="line">                                                 loHead = e; </span><br><span class="line">                                            <span class="keyword">else</span> </span><br><span class="line">                                                 loTail.next = e; </span><br><span class="line">                                            loTail = e; </span><br><span class="line">                                      &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                                            <span class="comment">// 将不为0的元素组建成为链表hi </span></span><br><span class="line">                                            <span class="keyword">if</span> (hiTail == <span class="literal">null</span>) </span><br><span class="line">                                                 hiHead = e; </span><br><span class="line">                                            <span class="keyword">else</span> </span><br><span class="line">                                                 hiTail.next = e; </span><br><span class="line">                                            hiTail = e; </span><br><span class="line">                                      &#125; </span><br><span class="line">                                 &#125; <span class="keyword">while</span> ((e = next) != <span class="literal">null</span>); </span><br><span class="line">                                 <span class="comment">// 将链表放到原位 </span></span><br><span class="line">                                 <span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123; </span><br><span class="line">                                      loTail.next = <span class="literal">null</span>; </span><br><span class="line">                                      <span class="keyword">new</span><span class="type">Tab</span>[j] = loHead; </span><br><span class="line">                                 &#125; </span><br><span class="line">                                 <span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123; </span><br><span class="line">                                      hiTail.next = <span class="literal">null</span>; </span><br><span class="line">                                      <span class="keyword">new</span><span class="type">Tab</span>[j + oldCap] = hiHead; </span><br><span class="line">                                 &#125; </span><br><span class="line">                           &#125; </span><br><span class="line">                      &#125; </span><br><span class="line">                &#125; </span><br><span class="line">           &#125; </span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span><span class="type">Tab</span>; </span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p><code>基础知识(一) HashMap 源码详解 - 我勒个去啊_强 - CSDN博客</code></p>
<p><a href="http://blog.csdn.net/luqiang81191293/article/details/62417147" target="_blank" rel="external">http://blog.csdn.net/luqiang81191293/article/details/62417147</a></p>
<ul>
<li>链表位置重新计算<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">do &#123;</span><br><span class="line">    <span class="attr">next</span> = e.next;</span><br><span class="line">    <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="attr">loTail</span> == <span class="literal">null</span>)</span><br><span class="line">            <span class="attr">loHead</span> = e;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            loTail.<span class="attr">next</span> = e;</span><br><span class="line">        <span class="attr">loTail</span> = e;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="attr">hiTail</span> == <span class="literal">null</span>)</span><br><span class="line">            <span class="attr">hiHead</span> = e;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hiTail.<span class="attr">next</span> = e;</span><br><span class="line">        <span class="attr">hiTail</span> = e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; while ((<span class="attr">e</span> = next) != <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">if</span> (loTail != <span class="literal">null</span>) &#123;</span><br><span class="line">    loTail.<span class="attr">next</span> = <span class="literal">null</span>;</span><br><span class="line">    newTab[j] = loHead;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (hiTail != <span class="literal">null</span>) &#123;</span><br><span class="line">    hiTail.<span class="attr">next</span> = <span class="literal">null</span>;</span><br><span class="line">    newTab[j + oldCap] = hiHead;</span><br><span class="line">&#125;</span><br><span class="line">``` ` <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) `  </span><br><span class="line">作用：判断是否会在下次扩容后，重新去摸hash表位置是否会发生变化。巧妙之处可见下文分析二进制位运算。理解还在进行中. 原来的hash值新增的那个bit是<span class="number">1</span>还是<span class="number">0</span>就好了，是<span class="number">0</span>的话索引没变，是<span class="number">1</span>的话索引变成“原索引+oldCap”</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">由于`新增的<span class="number">1</span>bit是<span class="number">0</span>还是<span class="number">1</span>可以认为是随机的`，因此resize的过程，`均匀的把之前的冲突的节点分散到新的bucket了`。这一块就是JDK1.<span class="number">8</span>新增的优化点。有一点注意区别，JDK1.<span class="number">7</span>中rehash的时候，旧链表迁移新链表的时候，如果在新表的数组索引位置相同，则链表元素会倒置，但是从上图可以看出，JDK1.<span class="number">8</span>不会倒置。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">- 对`<span class="number">16</span>-<span class="number">32</span>-<span class="number">64</span>-<span class="number">128</span>-<span class="number">256</span>`几次扩容的位运算解析</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Integer i=100;<br>int ihc =i.hashCode();<br>System.out.println(“            “+Integer.toBinaryString(ihc));// 1100100<br>System.out.println(“hash表分配(15):”+Integer.toBinaryString(15)+” “+(ihc&amp;15)+” “+Integer.toBinaryString((ihc&amp;15)));    // hash表分配(15):1111 4 100<br>System.out.println(“resize分配(16):”+Integer.toBinaryString(16)+” “+(ihc&amp;16)+” “+Integer.toBinaryString((ihc&amp;16)));// resize分配(16):10000 0 0<br>System.out.println(“hash表分配(31):”+Integer.toBinaryString(31)+” “+(ihc&amp;31)+” “+Integer.toBinaryString((ihc&amp;31)));// hash表分配(31):11111 4 100<br>System.out.println(“resize分配(32):”+Integer.toBinaryString(32)+” “+(ihc&amp;32)+” “+Integer.toBinaryString((ihc&amp;32)));// resize分配(32):100000 32 100000<br>System.out.println(“resize分配(63):”+Integer.toBinaryString(63)+” “+(ihc&amp;63)+” “+Integer.toBinaryString((ihc&amp;63)));// resize分配(63):111111 36 100100<br>System.out.println(“resize分配(64):”+Integer.toBinaryString(64)+” “+(ihc&amp;64)+” “+Integer.toBinaryString((ihc&amp;64)));// resize分配(64):1000000 64 1000000<br>System.out.println(“resize分配(127):”+Integer.toBinaryString(127)+” “+(ihc&amp;127)+” “+Integer.toBinaryString((ihc&amp;127)));// resize分配(127):1111111 100 1100100<br>System.out.println(“resize分配(128):”+Integer.toBinaryString(128)+” “+(ihc&amp;128)+” “+Integer.toBinaryString((ihc&amp;128)));// resize分配(128):10000000 0 0<br>System.out.println(“resize分配(255):”+Integer.toBinaryString(255)+” “+(ihc&amp;255)+” “+Integer.toBinaryString((ihc&amp;255)));// resize分配(255):11111111 100 1100100<br>System.out.println(“resize分配(256):”+Integer.toBinaryString(256)+” “+(ihc&amp;256)+” “+Integer.toBinaryString((ihc&amp;256)));// resize分配(256):100000000 0 0<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">- 随机测试，hashMap在大于12位后resize扩容。`观察新老数据的重新去摸定位hash表情况`</span><br></pre></td></tr></table></figure></p>
<p>HashMap hashMap=new HashMap();<br>for (int i = 0; i &lt; 50; i++) {<br>    int kv = (int)(Math.random()*10000);<br>    System.out.println(i+” “+kv);<br>    hashMap.put(kv,kv);<br>}<br>```</p>
<hr>
<p><strong>参考</strong><br><code>Java 8系列之重新认识HashMap - 简书</code><br><a href="http://www.jianshu.com/p/24f5bd05b860" target="_blank" rel="external">http://www.jianshu.com/p/24f5bd05b860</a><br><a href="http://www.jianshu.com/p/30bffabb2e5c" target="_blank" rel="external">http://www.jianshu.com/p/30bffabb2e5c</a></p>
<p><code>Java集合干货系列-（三）HashMap源码解析 - 简书</code><br><a href="http://www.jianshu.com/p/e6536af1018f" target="_blank" rel="external">http://www.jianshu.com/p/e6536af1018f</a></p>
<p><code>java的一份面试题 - 今日头条(www.toutiao.com)</code><br><a href="http://www.toutiao.com/i6442518207210193421/" target="_blank" rel="external">http://www.toutiao.com/i6442518207210193421/</a></p>
<p><code>5分钟快速实现一个哈希表 - longmon的个人页面</code><br><a href="https://my.oschina.net/longmon/blog/804684" target="_blank" rel="external">https://my.oschina.net/longmon/blog/804684</a></p>
<p><code>Java集合中那些类是线程安全的 - Mexican的博客 - CSDN博客</code><br><a href="http://blog.csdn.net/mexican_ok/article/details/12859351" target="_blank" rel="external">http://blog.csdn.net/mexican_ok/article/details/12859351</a></p>
<p><code>Java集合（实现类线程安全性） - yuyibinggooo的博客 - CSDN博客</code><br><a href="http://blog.csdn.net/yuyibing888/article/details/50565021" target="_blank" rel="external">http://blog.csdn.net/yuyibing888/article/details/50565021</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/07/饿加载单例的误解-类加载机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/07/饿加载单例的误解-类加载机制/" itemprop="url">饿加载单例的误解-类加载机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-07T00:00:03+08:00">
                2017-07-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/07/饿加载单例的误解-类加载机制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/07/07/饿加载单例的误解-类加载机制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="饿加载单例-期望是系统启动就自动初始化类-实际并不然"><a href="#饿加载单例-期望是系统启动就自动初始化类-实际并不然" class="headerlink" title="饿加载单例-期望是系统启动就自动初始化类(实际并不然)"></a>饿加载单例-期望是<code>系统启动就自动初始化类</code>(实际并不然)</h1><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">MySingleton_Static</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化时机：当任意static被被访问时,会初始化实例(建议initInstall)。否则将在getInstall访问时才创建(非饿加载)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> initInstall = <span class="number">1</span>;<span class="comment">// (理解并不直观,所以不见得好/ 避免此类影响可结合内部类实例化当前类,getInstall中触发.如下文)</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* 考虑类加载机制的初始化条件(被new或内部static被访问),所以启动时并不会实例化*/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MySingleton_Static mySingleton = <span class="keyword">new</span> MySingleton_Static();</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MySingleton_Static</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"Loader"</span>);<span class="comment">// 监控实例化时机</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MySingleton_Static <span class="title">getInstance</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mySingleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title">MySingleton_Static_test</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"test classLoader "</span>);<span class="comment">// test classLoader (并非第一时间初始化对象)</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"test classLoader "</span> + MySingleton_Static.initInstall);<span class="comment">// Loader &gt; test classLoader 1</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"test classLoader "</span> + MySingleton_Static.getInstance());<span class="comment">// [Loader] &gt; test classLoader **@14ae5a5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="通过内部类，避免访问静态变量，导致实例被动初始化"><a href="#通过内部类，避免访问静态变量，导致实例被动初始化" class="headerlink" title="通过内部类，避免访问静态变量，导致实例被动初始化"></a>通过内部类，避免访问静态变量，导致实例被动初始化</h1><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Singleton</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"Loader"</span>);<span class="comment">// 监控实例化时机</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 注意：static属性不是对象信息,而是在`方法区-运行时常量池`中。与类对象无关(同理类的序列化也不包含static属性)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> initInstall = <span class="number">1</span>;<span class="comment">// 避免访问static触发类的初始化(仅能通过getInstance方法初始化)</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> final Singleton INSTANCE = <span class="keyword">new</span> Singleton();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title">Singleton_test</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"test classLoader "</span>);<span class="comment">// test classLoader (此时还没有初始化,如上文是合理的)</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"test classLoader "</span> + Singleton.initInstall);<span class="comment">// test classLoader 1 (没有触发类的初始化,因为没有new)</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"test classLoader "</span> + Singleton.getInstance());<span class="comment">// Loader &gt; test classLoader **@14ae5a5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="结论："><a href="#结论：" class="headerlink" title="结论："></a>结论：</h1><p>类在<code>堆中的实例化</code>依赖<code>虚拟机栈</code>的执行，而<code>虚拟机栈的执行</code>依赖<code>类的初始化</code>。<code>饿加载单例</code>本身已经违背了<code>类的初始化条件</code>，所以基本不存在真正意义的饿加载。</p>
<hr>
<h1 id="饿加载-与-懒加载的区别"><a href="#饿加载-与-懒加载的区别" class="headerlink" title="饿加载  与 懒加载的区别"></a>饿加载  与 懒加载的区别</h1><p><code>饿加载</code> - 实例化交给了<code>static</code>，static的指令在<code>访问前并不会执行</code>，当<code>任意static</code>被访问时 <code>虚拟机</code>会将先初始化该类的<code>运行时常量池</code>执行该类中所有的static属性指令。其中如有<code>new Object()</code>也将被执行 ，并通过   <code>虚拟机栈-动态链接</code>  获得类的<code>具体实例</code></p>
<p><code>懒加载</code> - 在static方法getInstance()访问时， 先是通过 <code>虚拟机栈-动态链接</code>找到<code>方法区-flags: ACC_STATIC mathod</code>并立即执行.其中指令将被<code>虚拟机-操作栈</code>执行, 并通过   <code>虚拟机栈-动态链接</code>  获得类的<code>具体实例</code></p>
<ul>
<li><code>flags: ACC_STATIC   mathod</code> (如main/ utilMathod )<br>static归属于方法区,虚拟机允许static方法在没有类的初始化前直接访问.<br>作用: <ul>
<li>[main,getInstance]-用于类的初始化</li>
<li>[utilMathod]-<code>无状态要求</code>的代码集(<code>调用方法本身,无需产生新对象  性能更好</code>.  直接从方法区中获取指令代码-当然初始化的对象也是从方法区获取指令代码)</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/07/饿加载单例的危险-jvm操作数栈/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/07/饿加载单例的危险-jvm操作数栈/" itemprop="url">饿加载单例的危险-jvm操作数栈</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-07T00:00:02+08:00">
                2017-07-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/07/饿加载单例的危险-jvm操作数栈/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/07/07/饿加载单例的危险-jvm操作数栈/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="疑惑性强的示例"><a href="#疑惑性强的示例" class="headerlink" title="疑惑性强的示例"></a>疑惑性强的示例</h1><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">SingleTon</span> &#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleTon singleTon = <span class="keyword">new</span> SingleTon(); </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> count1; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> count2 = <span class="number">0</span>; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        count1++; </span><br><span class="line">        count2++; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> singleTon; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> &#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123; </span><br><span class="line">        SingleTon singleTon = SingleTon.getInstance(); </span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"count1="</span> + singleTon.count1); <span class="comment">// 1</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"count2="</span> + singleTon.count2); <span class="comment">// 0</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单构想的结果应该是: <code>count=1</code> <code>count2=1</code> 实际的结果是:  <code>count=1</code> <code>count2=0</code></p>
<hr>
<h1 id="方便的看懂原理-要换个例子"><a href="#方便的看懂原理-要换个例子" class="headerlink" title="方便的看懂原理,要换个例子"></a>方便的看懂原理,要换个例子</h1><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingleTon</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> count1 = <span class="number">170</span>;<span class="comment">// 在第5行(即类初始化)前,将数值加入`方法区-运行时常量池`</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleTon singleTon = <span class="keyword">new</span> SingleTon();</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> count;<span class="comment">// 此时虽然已经完成了初始化,但无赋值操作,将保持`方法区-运行时常量池`中的数值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> count2 = <span class="number">188</span>;<span class="comment">// 此时已经完成了类初始化,再将188赋值,将会覆盖原值</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">" count++; "</span> + count);<span class="comment">// 1</span></span><br><span class="line">        count1++;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">" count1++; "</span> + count1);<span class="comment">// 171</span></span><br><span class="line">        count2++;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">" count2++; "</span> + count2);<span class="comment">// 1(栈帧中的操作数栈,此时还在第5行,还未执行count2的赋值)</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> singleTon;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title">SingleTon_Test</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"count ="</span> + SingleTon.count);<span class="comment">// 1 因无赋值操作,所以保持了`方法区-运行时常量池`中的数值</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"count1="</span> + SingleTon.count1);<span class="comment">// 171 count1已经在类初始化前将数值放入了`方法区-运行时常量池`,所以感觉无恙</span></span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"count2="</span> + SingleTon.count2);<span class="comment">// 188 在已经完成了类初始化后,再将188赋值到 `方法区-运行时常量池` ,将会覆盖原值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单构想的结果应该是:    <code>count=1</code>  <code>count1  =171</code>   <code>count2=189</code><br>实际上 <code>count2=188</code> 为什么?</p>
<ul>
<li>通过构造函数的日志可以推断,影响到<code>count2数值</code>的关键确定<code>count2=188</code>是否在类实例化后进行了覆盖<br>如何确定? 这时就可以想到<code>方法区-操作数栈信息</code>这里能直接体现程序在实际运行中 (<code>虚拟机栈-栈帧-操作数帧</code>)的轨迹.</li>
</ul>
<ul>
<li>如图(方法区信息) :<br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-7-7/95411964.jpg" alt=""></li>
</ul>
<ul>
<li>new SingleTon()何时被执行? [即 <code>static属性在方法区的结构</code> ]<br>情况一:<code>所有的static变量</code>在方法区会包装成一个<code>static{}方法</code>,会有自己的<code>虚拟机-操作栈</code>,当其中任何变量被访问.<br>就会执行整个<code>static方法</code>,最终再将返回原访问的<code>static变量</code><br>情况二:主动<code>new Object()</code>时,在执行构造方法前,会先执行<code>static变量的static{}方法</code>.</li>
</ul>
<ul>
<li>完整方法区信息<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">G:\liuxiang_code_git\myServer\@jvm\demo<span class="params">-classLoader</span>\target\classes&gt;javap <span class="params">-v</span> SingleTon.class</span><br><span class="line">Classfile /G:/liuxiang_code_git/myServer/@jvm/demo<span class="params">-classLoader</span>/target/classes/SingleTon.class</span><br><span class="line">  Last modified <span class="number">2017</span><span class="number">-7</span><span class="number">-7</span>; size <span class="number">1023</span> <span class="built_in">bytes</span></span><br><span class="line">  MD5 checksum afb31d9e86dc5fe19907b4d4d78d38e9</span><br><span class="line">  Compiled from <span class="string">"SingleTon.java"</span></span><br><span class="line"><span class="keyword">public</span> class SingleTon</span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #18.#36        <span class="comment">// java/lang/Object."&lt;init&gt;":()V</span></span><br><span class="line">   #2 = Fieldref           #16.#37        <span class="comment">// SingleTon.count:I</span></span><br><span class="line">   #3 = Fieldref           #38.#39        <span class="comment">// java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">   #4 = Class              #40            <span class="comment">// java/lang/StringBuilder</span></span><br><span class="line">   #5 = Methodref          #4.#36         <span class="comment">// java/lang/StringBuilder."&lt;init&gt;":()V</span></span><br><span class="line">   #6 = <span class="built_in">String</span>             #41            <span class="comment">//  count++;</span></span><br><span class="line">   #7 = Methodref          #4.#42         <span class="comment">// java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span><br><span class="line">   #8 = Methodref          #4.#43         <span class="comment">// java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span></span><br><span class="line">   #9 = Methodref          #4.#44         <span class="comment">// java/lang/StringBuilder.toString:()Ljava/lang/String;</span></span><br><span class="line">  #10 = Methodref          #45.#46        <span class="comment">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">  #11 = Fieldref           #16.#47        <span class="comment">// SingleTon.count1:I</span></span><br><span class="line">  #12 = <span class="built_in">String</span>             #48            <span class="comment">//  count1++;</span></span><br><span class="line">  #13 = Fieldref           #16.#49        <span class="comment">// SingleTon.count2:I</span></span><br><span class="line">  #14 = <span class="built_in">String</span>             #50            <span class="comment">//  count2++;</span></span><br><span class="line">  #15 = Fieldref           #16.#51        <span class="comment">// SingleTon.singleTon:LSingleTon;</span></span><br><span class="line">  #16 = Class              #52            <span class="comment">// SingleTon</span></span><br><span class="line">  #17 = Methodref          #16.#36        <span class="comment">// SingleTon."&lt;init&gt;":()V</span></span><br><span class="line">  #18 = Class              #53            <span class="comment">// java/lang/Object</span></span><br><span class="line">  #19 = Utf8               count1</span><br><span class="line">  #20 = Utf8               I</span><br><span class="line">  #21 = Utf8               singleTon</span><br><span class="line">  #22 = Utf8               LSingleTon;</span><br><span class="line">  #23 = Utf8               count</span><br><span class="line">  #24 = Utf8               count2</span><br><span class="line">  #25 = Utf8               &lt;init&gt;</span><br><span class="line">  #26 = Utf8               ()V</span><br><span class="line">  #27 = Utf8               Code</span><br><span class="line">  #28 = Utf8               LineNumberTable</span><br><span class="line">  #29 = Utf8               LocalVariableTable</span><br><span class="line">  #30 = Utf8               this</span><br><span class="line">  #31 = Utf8               getInstance</span><br><span class="line">  #32 = Utf8               ()LSingleTon;</span><br><span class="line">  #33 = Utf8               &lt;clinit&gt;</span><br><span class="line">  #34 = Utf8               SourceFile</span><br><span class="line">  #35 = Utf8               SingleTon.java</span><br><span class="line">  #36 = NameAndType        #25:#26        <span class="comment">// "&lt;init&gt;":()V</span></span><br><span class="line">  #37 = NameAndType        #23:#20        <span class="comment">// count:I</span></span><br><span class="line">  #38 = Class              #54            <span class="comment">// java/lang/System</span></span><br><span class="line">  #39 = NameAndType        #55:#56        <span class="comment">// out:Ljava/io/PrintStream;</span></span><br><span class="line">  #40 = Utf8               java/lang/StringBuilder</span><br><span class="line">  #41 = Utf8                count++;</span><br><span class="line">  #42 = NameAndType        #57:#58        <span class="comment">// append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></span><br><span class="line">  #43 = NameAndType        #57:#59        <span class="comment">// append:(I)Ljava/lang/StringBuilder;</span></span><br><span class="line">  #44 = NameAndType        #60:#61        <span class="comment">// toString:()Ljava/lang/String;</span></span><br><span class="line">  #45 = Class              #62            <span class="comment">// java/io/PrintStream</span></span><br><span class="line">  #46 = NameAndType        #63:#64        <span class="comment">// println:(Ljava/lang/String;)V</span></span><br><span class="line">  #47 = NameAndType        #19:#20        <span class="comment">// count1:I</span></span><br><span class="line">  #48 = Utf8                count1++;</span><br><span class="line">  #49 = NameAndType        #24:#20        <span class="comment">// count2:I</span></span><br><span class="line">  #50 = Utf8                count2++;</span><br><span class="line">  #51 = NameAndType        #21:#22        <span class="comment">// singleTon:LSingleTon;</span></span><br><span class="line">  #52 = Utf8               SingleTon</span><br><span class="line">  #53 = Utf8               java/lang/Object</span><br><span class="line">  #54 = Utf8               java/lang/System</span><br><span class="line">  #55 = Utf8               out</span><br><span class="line">  #56 = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #57 = Utf8               append</span><br><span class="line">  #58 = Utf8               (Ljava/lang/<span class="built_in">String</span>;)Ljava/lang/StringBuilder;</span><br><span class="line">  #59 = Utf8               (I)Ljava/lang/StringBuilder;</span><br><span class="line">  #60 = Utf8               toString</span><br><span class="line">  #61 = Utf8               ()Ljava/lang/<span class="built_in">String</span>;</span><br><span class="line">  #62 = Utf8               java/io/PrintStream</span><br><span class="line">  #63 = Utf8               println</span><br><span class="line">  #64 = Utf8               (Ljava/lang/<span class="built_in">String</span>;)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> static int count1;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">public</span> static int count;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">public</span> static int count2;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">public</span> static SingleTon getInstance();</span><br><span class="line">    descriptor: ()LSingleTon;</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      <span class="built_in">stack</span>=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: getstatic     #15                 <span class="comment">// Field singleTon:LSingleTon;</span></span><br><span class="line">         <span class="number">3</span>: areturn</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">20</span>: <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      <span class="built_in">stack</span>=<span class="number">2</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: sipush        <span class="number">170</span></span><br><span class="line">         <span class="number">3</span>: putstatic     #11                 <span class="comment">// Field count1:I</span></span><br><span class="line">         <span class="number">6</span>: <span class="literal">new</span>           #16                 <span class="comment">// class SingleTon</span></span><br><span class="line">         <span class="number">9</span>: dup</span><br><span class="line">        <span class="number">10</span>: invokespecial #17                 <span class="comment">// Method "&lt;init&gt;":()V</span></span><br><span class="line">        <span class="number">13</span>: putstatic     #15                 <span class="comment">// Field singleTon:LSingleTon;</span></span><br><span class="line">        <span class="number">16</span>: sipush        <span class="number">188</span></span><br><span class="line">        <span class="number">19</span>: putstatic     #13                 <span class="comment">// Field count2:I</span></span><br><span class="line">        <span class="number">22</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">3</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">5</span>: <span class="number">6</span></span><br><span class="line">        line <span class="number">8</span>: <span class="number">16</span></span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">"SingleTon.java"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/13/Java IDEA Maven搭建多模块项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/05/13/Java IDEA Maven搭建多模块项目/" itemprop="url">Java IDEA Maven搭建多模块项目</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-13T00:00:00+08:00">
                2017-05-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/13/Java IDEA Maven搭建多模块项目/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/13/Java IDEA Maven搭建多模块项目/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="主工程"><a href="#主工程" class="headerlink" title="主工程"></a>主工程</h1><p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-5-31/95754311.jpg" alt=""></p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-5-31/54843808.jpg" alt=""></p>
<h1 id="子模块（web-或不选）"><a href="#子模块（web-或不选）" class="headerlink" title="子模块（web/或不选）"></a>子模块（web/或不选）</h1><p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-5-31/87323924.jpg" alt=""></p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-5-31/42850945.jpg" alt=""></p>
<h1 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h1><p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-5-31/1742924.jpg" alt=""></p>
<p><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-5-31/17956154.jpg" alt=""></p>
<hr>
<h1 id="Maven-多模块项目参考-iBase4J"><a href="#Maven-多模块项目参考-iBase4J" class="headerlink" title="Maven 多模块项目参考 iBase4J"></a>Maven 多模块项目参考 iBase4J</h1><p><a href="http://git.oschina.net/iBase4J/iBase4J" target="_blank" rel="external">http://git.oschina.net/iBase4J/iBase4J</a></p>
<p><code>#32 iBase4J 架构研究 [置顶]</code> <a href="http://git.oschina.net/iBase4J/iBase4J/issues/32" target="_blank" rel="external">http://git.oschina.net/iBase4J/iBase4J/issues/32</a><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-5-31/85002761.jpg" alt=""></p>
<h1 id="快速构建"><a href="#快速构建" class="headerlink" title="快速构建"></a>快速构建</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 启动命令：</span><br><span class="line">     clean package -P build tomcat7:run-war-only -f pom-sys-service-server.xml</span><br><span class="line">     clean package -P build tomcat7:run-war-only -f pom-sys-web-server.xml</span><br><span class="line">* 打包命令：</span><br><span class="line">     clean package -P build -f pom-sys-service-server.xml</span><br><span class="line">     clean package -P build -f pom-sys-service-server.xml</span><br><span class="line">* 生产环境打包命令：</span><br><span class="line">     clean package -P product -f pom-sys-service-server.xml</span><br><span class="line">     clean package -P product -f pom-sys-service-server.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>pom-sys-service-server.xml (方便在主项目iBase4j中指定具体模块的构建)<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span></span><br><span class="line"><span class="xml">xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>iBase4J-SYS-Service-Server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">name</span>&gt;</span>$</span><span class="template-variable">&#123;project.artifactId&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.ibase4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>iBase4J<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>./<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">module</span>&gt;</span>iBase4J-Common<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">module</span>&gt;</span>iBase4J-SYS-Facade<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">module</span>&gt;</span>iBase4J-SYS-Service<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- clean package -P build tomcat7:run-war-only -f pom-sys-service-server.xml --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h1 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h1><p>功能搜索<code>Ctrl+shift+A</code>-<code>reim</code> 选择<code>Reimport</code>即可<code>刷新 工程 maven</code><br><img src="http://7xnbs3.com1.z0.glb.clouddn.com/17-7-21/41633512.jpg" alt=""></p>
<hr>
<p><strong>参考</strong><br><code>Java一步一步构建web系统 在IDEA下用Maven搭建多模块项目 - 推酷</code>  <code>★</code><br><a href="http://www.tuicool.com/articles/FZfiYfF" target="_blank" rel="external">http://www.tuicool.com/articles/FZfiYfF</a></p>
<p><code>[工具资源] Intellij IDEA 2016 学习系列之 (一) 创建 maven 多模块项目 - 推酷</code>  <code>★</code><br><a href="http://www.tuicool.com/articles/z6ZZzuR" target="_blank" rel="external">http://www.tuicool.com/articles/z6ZZzuR</a></p>
<p><code>每日一博 | Maven 多模块项目介绍及搭建 - 推酷</code> <code>★</code><br><a href="http://www.tuicool.com/articles/yiIra2" target="_blank" rel="external">http://www.tuicool.com/articles/yiIra2</a></p>
<p><code>Maven提高篇系列之（一）——多模块 vs 继承</code></p>
<p>www.tuicool.com/articles/RJBZb2z</p>
<p><code>使用命令行快速创建Maven多模块项目 - 推酷</code><br><a href="http://www.tuicool.com/articles/Y3Ab2uJ" target="_blank" rel="external">http://www.tuicool.com/articles/Y3Ab2uJ</a></p>
<hr>
<p><code>用idea创建一个maven web项目 - Coder Wu的博客 - 博客频道 - CSDN.NET</code><br><a href="http://blog.csdn.net/sinat_34596644/article/details/52891274" target="_blank" rel="external">http://blog.csdn.net/sinat_34596644/article/details/52891274</a></p>
<p><code>使用IntelliJ IDEA 15和Maven创建Java Web项目 - MyArrow的专栏 - 博客频道 - CSDN.NET</code><br><a href="http://blog.csdn.net/myarrow/article/details/50824793" target="_blank" rel="external">http://blog.csdn.net/myarrow/article/details/50824793</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/xiaowu_avatar.jpg"
                alt="周小伍 Joey" />
            
              <p class="site-author-name" itemprop="name">周小伍 Joey</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">175</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">51</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">周小伍 Joey</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://joeyblog.disqus.com/count.js" async></script>
    

    

  




	





  










  





  

  

  

  

  

  

</body>
</html>
