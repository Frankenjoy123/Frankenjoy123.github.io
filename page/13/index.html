<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="xiaowu&#39;s blog">
<meta property="og:url" content="https://zhouxiaowu.coding.me/page/13/index.html">
<meta property="og:site_name" content="xiaowu&#39;s blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="xiaowu&#39;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://zhouxiaowu.coding.me/page/13/"/>





  <title>xiaowu's blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3da41265a1a0042eebe5413c0d6c76f5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">xiaowu's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-dubbo">
          <a href="/categories/Dubbo" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            Dubbo
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2018/01/15/mybatis中-和-的区别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/15/mybatis中-和-的区别/" itemprop="url">mybatis中#和$的区别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-15T10:29:33+08:00">
                2018-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/15/mybatis中-和-的区别/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/15/mybatis中-和-的区别/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  553
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　今天在工作中有个点击排序的功能调试了许久，终寻因，总结之。<br>　　需求是这样的，页面有个table，有一列的上下箭头可点击并排序。对于这种需求，我的mybatis.xml的sql配置写成了如下：</p>
<if test="map.ColumnNameSort!=null and map.ColumnNameSort!=''"><br>　　ORDER BY columnName #{map.ColumnNameSort}<br></if>

<p>　　ColumnNameSort即前端传的排序方式，asc或者desc。</p>
<p>　　然后，预计它的输出应该是类似于下面这样的</p>
<p>ORDER BY columnName desc</p>
<p>　　但是，真正跑起来时，排序的效果一直没出现，经常一番查找，发现是mybatis 的’#{}’传值的问题，它将sql语句编译成了如下</p>
<p>ORDER BY columnName ‘desc’ 或者 ORDER BY columnName ‘asc’</p>
<p>　　这样，desc或者asc就成了字符串而不是关键字，sql语句的意思是columnName的别名是desc或者asc，没加排序关键字时默认是正序排序，成了如下</p>
<p>ORDER BY columnName “desc” asc 或者 ORDER BY columnName “asc” asc</p>
<p>　　排序没效果的问题找到原因了，解决之，mybatis提供了另一种绑定参数的方式–${param}，将sql配置改为</p>
<p>ORDER BY columnName ${map.ColumnNameSort}</p>
<p>　　这样一来，mybatis会直接将ColumnNameSort的值加入sql中，不会转义。正确结果：</p>
<p>ORDER BY columnName desc</p>
<p>　　<strong>最后，对于mybatis中#和$绑定参数的区别做个总结，避免以后类似的问题发生。</strong></p>
<ul>
<li>＃{}将传入的数据都当成一个字符串，会对自动传入的数据加一个双引号。如：order by #{id}，如果传入的值是111,那么解析成sql时的值为order by “111”, 如果传入的值是id，则解析成的sql为order by “id”。</li>
<li>${}将传入的数据直接显示生成在sql中。如：order by ${id}，如果传入的值是111,那么解析成sql时的值为order by 111, 如果传入的值是id，则解析成的sql为order by id。</li>
</ul>
<ul>
<li>‘#’方式 能够很大程度防止sql注入。</li>
</ul>
<ul>
<li>$方式无法防止Sql注入。</li>
<li>$方式一般用于传入数据库对象，例如传入表名.</li>
<li>一般能用#的就别用$.</li>
</ul>
<p>ps:在使用mybatis中还遇到&lt;![CDATA[]]&gt;的用法，在该符号内的语句，将不会被当成字符串来处理，而是直接当成sql语句，比如要执行一个存储过程。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2018/01/11/Mysql-update使用子查询/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/11/Mysql-update使用子查询/" itemprop="url">Mysql update使用子查询</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-11T15:20:54+08:00">
                2018-01-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/11/Mysql-update使用子查询/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/11/Mysql-update使用子查询/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  164
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天我像以前操作Oracle写了一个update sql:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update device_user a <span class="builtin-name">set</span> a.<span class="attribute">scene_id</span>=<span class="literal">null</span></span><br><span class="line">where a.id <span class="keyword">not</span> <span class="keyword">in</span>(select min(t.id) <span class="keyword">from</span> device_user t<span class="built_in"> group </span>by t.device_id);12</span><br></pre></td></tr></table></figure>
<p>根据子查询的结果，更新表中的一个字段。</p>
<p>在mysql数据库中执行后报错：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Error </span>Code: 1093. You can't specify target table 'a' for update in FROM clause</span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<p>一直没弄明白这个错误，然后经过多次度娘后，发现mysql update时，更新的表不能在set和where中用于子查询。</p>
<p>修改上面的sql为mysql数据库支持的方式：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update device_user du,</span><br><span class="line">(select id <span class="keyword">from</span> device_user where id <span class="keyword">not</span> <span class="keyword">in</span>(select min(t.id) <span class="keyword">from</span> device_user t<span class="built_in"> group </span>by t.device_id)) b</span><br><span class="line"><span class="builtin-name">set</span> du.<span class="attribute">scene_id</span>=<span class="literal">null</span></span><br><span class="line">where du.<span class="attribute">id</span>=b.id;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2018/01/02/JVM堆内存和非堆内存/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/02/JVM堆内存和非堆内存/" itemprop="url">JVM堆内存和非堆内存</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-02T11:04:25+08:00">
                2018-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java基础/" itemprop="url" rel="index">
                    <span itemprop="name">java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/02/JVM堆内存和非堆内存/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/02/JVM堆内存和非堆内存/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.9k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>堆和非堆内存</strong></p>
<p>按照官方的说法：“Java 虚拟机具有一个堆(Heap)，堆是运行时数据区域，所有类实例和数组的内存均从此处分配。堆是在 Java 虚拟机启动时创建的。”“在JVM中堆之外的内存称为非堆内存(Non-heap memory)”。</p>
<p>JVM主要管理两种类型的内存：堆和非堆。</p>
<p>Heap memory Code Cache</p>
<p>Eden Space</p>
<p>Survivor Space</p>
<p>Tenured Gen</p>
<p>non-heap memory Perm Gen</p>
<p>native heap?(I guess)</p>
<p><strong>堆内存</strong></p>
<p>Java 虚拟机具有一个堆，堆是运行时数据区域，所有类实例和数组的内存均从此处分配。堆是在 Java 虚拟机启动时创建的。对象的堆内存由称为垃圾回收器的自动内存管理系统回收。</p>
<p>堆的大小可以固定，也可以扩大和缩小。堆的内存不需要是连续空间。</p>
<p><strong>非堆内存</strong></p>
<p>Java 虚拟机管理堆之外的内存（称为非堆内存）。</p>
<p>Java 虚拟机具有一个由所有线程共享的方法区。方法区属于非堆内存。它存储每个类结构，如运行时常数池、字段和方法数据，以及方法和构造方法的代码。它是在 Java 虚拟机启动时创建的。</p>
<p>方法区在逻辑上属于堆，但 Java 虚拟机实现可以选择不对其进行回收或压缩。与堆类似，方法区的大小可以固定，也可以扩大和缩小。方法区的内存不需要是连续空间。</p>
<p>除了方法区外，Java 虚拟机实现可能需要用于内部处理或优化的内存，这种内存也是非堆内存。例如，JIT 编译器需要内存来存储从 Java 虚拟机代码转换而来的本机代码，从而获得高性能。</p>
<p><strong>几个基本概念</strong></p>
<p>PermGen space：全称是Permanent Generation space，即永久代。就是说是永久保存的区域,用于存放Class和Meta信息，Class在被Load的时候被放入该区域，GC(Garbage Collection)应该不会对PermGen space进行清理，所以如果你的APP会LOAD很多CLASS的话，就很可能出现PermGen space错误。</p>
<p>Heap space：存放Instance。</p>
<p>Java Heap分为3个区，Young即新生代，Old即老生代和Permanent。</p>
<p>Young保存刚实例化的对象。当该区被填满时，GC会将对象移到Old区。Permanent区则负责保存反射对象。</p>
<p><strong>堆内存分配</strong></p>
<ul>
<li>JVM初始分配的堆内存由-Xms指定，默认是物理内存的1/64；</li>
<li>JVM最大分配的堆内存由-Xmx指定，默认是物理内存的1/4。</li>
<li>默认空余堆内存小于40%时，JVM就会增大堆直到-Xmx的最大限制；</li>
<li>空余堆内存大于70%时，JVM会减少堆直到-Xms的最小限制。</li>
<li>因此服务器一般设置-Xms、-Xmx 相等以避免在每次GC 后调整堆的大小。</li>
<li>说明：如果-Xmx 不指定或者指定偏小，应用可能会导致java.lang.OutOfMemory错误，此错误来自JVM，不是Throwable的，无法用try…catch捕捉。</li>
</ul>
<p><strong>非堆内存分配</strong></p>
<p>\1. JVM使用-XX:PermSize设置非堆内存初始值，默认是物理内存的1/64；</p>
<p>\2. 由XX:MaxPermSize设置最大非堆内存的大小，默认是物理内存的1/4。</p>
<ul>
<li>还有一说：MaxPermSize缺省值和-server -client选项相关，-server选项下默认MaxPermSize为64m，-client选项下默认MaxPermSize为32m。这个我没有实验。</li>
</ul>
<p>\3. XX:MaxPermSize设置过小会导致java.lang.OutOfMemoryError: PermGen space 就是内存益出。</p>
<p>\4. 为什么会内存益出：</p>
<ul>
<li>这一部分内存用于存放Class和Meta的信息，Class在被 Load的时候被放入PermGen space区域，它和存放Instance的Heap区域不同。</li>
<li>GC(Garbage Collection)不会在主程序运行期对PermGen space进行清理，所以如果你的APP会LOAD很多CLASS 的话,就很可能出现PermGen space错误。</li>
</ul>
<p>\5. 这种错误常见在web服务器对JSP进行pre compile的时候。</p>
<p><strong>JVM内存限制(最大值)</strong></p>
<p>\1. 首先JVM内存限制于实际的最大物理内存，假设物理内存无限大的话，JVM内存的最大值跟操作系统有很大的关系。简单的说就32位处理器虽然可控内存空间有4GB,但是具体的操作系统会给一个限制，这个限制一般是2GB-3GB（一般来说Windows系统下为1.5G-2G，Linux系统下为2G-3G），而64bit以上的处理器就不会有限制了。</p>
<p>\2. 为什么有的机器我将-Xmx和-XX:MaxPermSize都设置为512M之后Eclipse可以启动，而有些机器无法启动？</p>
<p>通过上面对JVM内存管理的介绍我们已经了解到JVM内存包含两种：堆内存和非堆内存，另外JVM最大内存首先取决于实际的物理内存和操作系统。所以说设置VM参数导致程序无法启动主要有以下几种原因：</p>
<ul>
<li>参数中-Xms的值大于-Xmx，或者-XX:PermSize的值大于-XX:MaxPermSize；</li>
<li>-Xmx的值和-XX:MaxPermSize的总和超过了JVM内存的最大限制，比如当前操作系统最大内存限制，或者实际的物理内存等等。说到实际物理内存这里需要说明一点的是，如果你的内存是1024MB，但实际系统中用到的并不可能是1024MB，因为有一部分被硬件占用了。</li>
</ul>
<p>\3. 如果你有一个双核的CPU，也许可以尝试这个参数: -XX:+UseParallelGC 让GC可以更快的执行。（只是JDK 5里对GC新增加的参数）</p>
<p>\4. 如果你的WEB APP下都用了大量的第三方jar，其大小超过了服务器jvm默认的大小，那么就会产生内存益出问题了。解决方法： 设置MaxPermSize大小。</p>
<ul>
<li>增加服务器启动的JVM参数设置： -Xms128m -Xmx256m -XX:PermSize=128M -XX:MaxNewSize=256m -XX:MaxPermSize=256m</li>
<li>如tomcat，修改TOMCAT_HOME/bin/catalina.sh，在echo “Using CATALINA_BASE: $CATALINA_BASE”上面加入以下行：JAVA_OPTS=”-server -XX:PermSize=64M -XX:MaxPermSize=128m</li>
</ul>
<p>\5. 建议：将相同的第三方jar文件移置到tomcat/shared/lib目录下，这样可以减少jar 文档重复占用内存</p>
<p><strong>JVM内存设置参数</strong></p>
<ul>
<li>内存设置参数</li>
</ul>
<p><img src="/2018/01/02/JVM堆内存和非堆内存/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<ul>
<li>说明：</li>
</ul>
<ol>
<li>如果-Xmx不指定或者指定偏小，应用可能会导致java.lang.OutOfMemory错误，此错误来自JVM不是Throwable的，无法用try…catch捕捉。</li>
<li>PermSize和MaxPermSize指明虚拟机为java永久生成对象（Permanate generation）如，class对象、方法对象这些可反射（reflective）对象分配内存限制，这些内存不包括在Heap（堆内存）区之中。</li>
<li>-XX:MaxPermSize分配过小会导致：java.lang.OutOfMemoryError: PermGen space。</li>
<li>MaxPermSize缺省值和-server -client选项相关：-server选项下默认MaxPermSize为64m、-client选项下默认MaxPermSize为32m。</li>
</ol>
<ul>
<li>申请一块内存的过程</li>
</ul>
<ol>
<li>JVM会试图为相关Java对象在Eden中初始化一块内存区域</li>
<li>当Eden空间足够时，内存申请结束。否则到下一步</li>
<li>JVM试图释放在Eden中所有不活跃的对象（这属于1或更高级的垃圾回收）；释放后若Eden空间仍然不足以放入新对象，则试图将部分Eden中活跃对象放入Survivor区/OLD区</li>
<li>Survivor区被用来作为Eden及OLD的中间交换区域，当OLD区空间足够时，Survivor区的对象会被移到Old区，否则会被保留在Survivor区</li>
<li>当OLD区空间不够时，JVM会在OLD区进行完全的垃圾收集（0级）</li>
<li>完全垃圾收集后，若Survivor及OLD区仍然无法存放从Eden复制过来的部分对象，导致JVM无法在Eden区为新对象创建内存区域，则出现”out of memory错误”</li>
</ol>
<p>resin服务器典型的响应时间优先型的jvm配置：</p>
<blockquote>
<p>-Xmx2000M -Xms2000M -Xmn500M</p>
<p>-XX:PermSize=250M -XX:MaxPermSize=250M</p>
<p>-Xss256K</p>
<p>-XX:+DisableExplicitGC</p>
<p>-XX:SurvivorRatio=1</p>
<p>-XX:+UseConcMarkSweepGC</p>
<p>-XX:+UseParNewGC</p>
<p>-XX:+CMSParallelRemarkEnabled</p>
<p>-XX:+UseCMSCompactAtFullCollection</p>
<p>-XX:CMSFullGCsBeforeCompaction=0</p>
<p>-XX:+CMSClassUnloadingEnabled</p>
<p>-XX:LargePageSizeInBytes=128M</p>
<p>-XX:+UseFastAccessorMethods</p>
<p>-XX:+UseCMSInitiatingOccupancyOnly</p>
<p>-XX:CMSInitiatingOccupancyFraction=60</p>
<p>-XX:SoftRefLRUPolicyMSPerMB=0</p>
<p>-XX:+PrintClassHistogram</p>
<p>-XX:+PrintGCDetails</p>
<p>-XX:+PrintGCTimeStamps</p>
<p>-XX:+PrintHeapAtGC</p>
<p>-Xloggc:log/gc.log</p>
</blockquote>
<p><strong>内存回收算法</strong></p>
<p>Java中有四种不同的回收算法，对应的启动参数为:</p>
<blockquote>
<p>–XX:+UseSerialGC</p>
<p>–XX:+UseParallelGC</p>
<p>–XX:+UseParallelOldGC</p>
<p>–XX:+UseConcMarkSweepGC</p>
</blockquote>
<p><strong>Serial Collector</strong></p>
<p>大部分平台或者强制 java -client 默认会使用这种。</p>
<p>young generation算法 = serial</p>
<p>old generation算法 = serial (mark-sweep-compact)</p>
<p>这种方法的缺点很明显, stop-the-world, 速度慢。服务器应用不推荐使用。</p>
<p><strong>Parallel Collector</strong></p>
<p>在linux x64上默认是这种，其他平台要加 java -server 参数才会默认选用这种。</p>
<p>young = parallel，多个thread同时copy</p>
<p>old = mark-sweep-compact = 1</p>
<p>优点：新生代回收更快。因为系统大部分时间做的gc都是新生代的，这样提高了throughput(cpu用于非gc时间)</p>
<p>缺点：当运行在8G/16G server上old generation live object太多时候pause time过长</p>
<p><strong>Parallel Compact Collector (ParallelOld)</strong></p>
<p>young = parallel = 2</p>
<p>old = parallel，分成多个独立的单元，如果单元中live object少则回收，多则跳过</p>
<p>优点：old old generation上性能较 parallel 方式有提高</p>
<p>缺点：大部分server系统old generation内存占用会达到60%-80%, 没有那么多理想的单元live object很少方便迅速回收，同时compact方面开销比起parallel并没明显减少。</p>
<p><strong>Concurrent Mark-Sweep(CMS) Collector</strong></p>
<p>young generation = parallel collector = 2</p>
<p>old = cms</p>
<p>同时不做 compact 操作。</p>
<p>优点：pause time会降低, pause敏感但CPU有空闲的场景需要建议使用策略4.</p>
<p>缺点：cpu占用过多，cpu密集型服务器不适合。另外碎片太多，每个object的存储都要通过链表连续跳n个地方，空间浪费问题也会增大。</p>
<p><strong>内存监控方法</strong></p>
<ul>
<li>jmap -heap 查看java 堆（heap）使用情况</li>
</ul>
<blockquote>
<p>jmap -heap pid</p>
<p>using thread-local object allocation.</p>
<p>Parallel GC with 4 thread(s)   #GC 方式</p>
<p>Heap Configuration:  #堆内存初始化配置</p>
<p>MinHeapFreeRatio=40  #对应jvm启动参数-XX:MinHeapFreeRatio设置JVM堆最小空闲比率(default 40)</p>
<p>MaxHeapFreeRatio=70  #对应jvm启动参数 -XX:MaxHeapFreeRatio设置JVM堆最大空闲比率(default 70)</p>
<p>MaxHeapSize=512.0MB  #对应jvm启动参数-XX:MaxHeapSize=设置JVM堆的最大大小</p>
<p>NewSize  = 1.0MB     #对应jvm启动参数-XX:NewSize=设置JVM堆的‘新生代’的默认大小</p>
<p>MaxNewSize =4095MB   #对应jvm启动参数-XX:MaxNewSize=设置JVM堆的‘新生代’的最大大小</p>
<p>OldSize  = 4.0MB     #对应jvm启动参数-XX:OldSize=<value>:设置JVM堆的‘老生代’的大小</value></p>
<p>NewRatio  = 8        #对应jvm启动参数-XX:NewRatio=:‘新生代’和‘老生代’的大小比率</p>
<p>SurvivorRatio = 8    #对应jvm启动参数-XX:SurvivorRatio=设置年轻代中Eden区与Survivor区的大小比值</p>
<p>PermSize= 16.0MB     #对应jvm启动参数-XX:PermSize=<value>:设置JVM堆的‘永生代’的初始大小</value></p>
<p>MaxPermSize=64.0MB   #对应jvm启动参数-XX:MaxPermSize=<value>:设置JVM堆的‘永生代’的最大大小</value></p>
<p>Heap Usage:          #堆内存分步</p>
<p>PS Young Generation</p>
<p>Eden Space:         #Eden区内存分布</p>
<p>capacity = 20381696 (19.4375MB)             #Eden区总容量</p>
<p>used     = 20370032 (19.426376342773438MB)  #Eden区已使用</p>
<p>free     = 11664 (0.0111236572265625MB)     #Eden区剩余容量</p>
<p>99.94277218147106% used                     #Eden区使用比率</p>
<p>From Space:        #其中一个Survivor区的内存分布</p>
<p>capacity = 8519680 (8.125MB)</p>
<p>used     = 32768 (0.03125MB)</p>
<p>free     = 8486912 (8.09375MB)</p>
<p>0.38461538461538464% used</p>
<p>To Space:          #另一个Survivor区的内存分布</p>
<p>capacity = 9306112 (8.875MB)</p>
<p>used     = 0 (0.0MB)</p>
<p>free     = 9306112 (8.875MB)</p>
<p>0.0% used</p>
<p>PS Old Generation  #当前的Old区内存分布</p>
<p>capacity = 366280704 (349.3125MB)</p>
<p>used     = 322179848 (307.25464630126953MB)</p>
<p>free     = 44100856 (42.05785369873047MB)</p>
<p>87.95982001825573% used</p>
<p>PS Perm Generation #当前的 “永生代” 内存分布</p>
<p>capacity = 32243712 (30.75MB)</p>
<p>used     = 28918584 (27.57891082763672MB)</p>
<p>free     = 3325128 (3.1710891723632812MB)</p>
<p>89.68751488662348% used</p>
</blockquote>
<ul>
<li>JVM内存监控工具</li>
</ul>
<blockquote>
<p>&lt;%@ page import=”java.lang.management.*” %&gt;</p>
<p>&lt;%@ page import=”java.util.*” %&gt;</p>
<html><br><br><head><br><br>  <title>JVM Memory Monitor</title><br><br></head><br><br><body><br><br><table border="0" width="100%"><br><br>​    <tr><td colspan="2" align="center"><h3>Memory MXBean</h3></td></tr><br><br>​    <tr><td width="200">Heap Memory Usage</td><td>&lt;%=ManagementFactory.getMemoryMXBean().getHeapMemoryUsage()%&gt;</td></tr><br><br>​    <tr><td>Non-Heap Memory Usage</td><td>&lt;%=ManagementFactory.getMemoryMXBean().getNonHeapMemoryUsage()%&gt;</td></tr><br><br>​    <tr><td colspan="2"> </td></tr><br><br>​    <tr><td colspan="2" align="center"><h3>Memory Pool MXBeans</h3></td></tr><br><br>&lt;%<br><br>​        Iterator iter = ManagementFactory.getMemoryPoolMXBeans().iterator();<br><br>​        while (iter.hasNext()) {<br><br>​            MemoryPoolMXBean item = (MemoryPoolMXBean) iter.next();<br><br>%&gt;<br><br><tr><td colspan="2"><br><br>​    <table border="0" width="100%" style="border: 1px #98AAB1 solid;"><br><br>​        <tr><td colspan="2" align="center"><b>&lt;%= item.getName() %&gt;</b></td></tr><br><br>​        <tr><td width="200">Type</td><td>&lt;%= item.getType() %&gt;</td></tr><br><br>​        <tr><td>Usage</td><td>&lt;%= item.getUsage() %&gt;</td></tr><br><br>​        <tr><td>Peak Usage</td><td>&lt;%= item.getPeakUsage() %&gt;</td></tr><br><br>​        <tr><td>Collection Usage</td><td>&lt;%= item.getCollectionUsage() %&gt;</td></tr><br><br>​    </table><br><br></td></tr><br><br><tr><td colspan="2"> </td></tr><br><br>&lt;%} %&gt;<br><br></table><br><br></body><br><br></html></blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2017/12/28/MySQL-select子查询引用变量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/28/MySQL-select子查询引用变量/" itemprop="url">MySQL select子查询引用变量</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-28T14:25:39+08:00">
                2017-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/28/MySQL-select子查询引用变量/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/28/MySQL-select子查询引用变量/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  816
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="示例一"><a href="#示例一" class="headerlink" title="示例一"></a>示例一</h1><p>前几天看别人的代码中看到在字段中使用select子查询的方法，第一次见这种写法，然后研究了一下，记录下来</p>
<p>大概的形式是这样的:</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a .*,(<span class="keyword">select</span> b.another_field <span class="keyword">from</span> b <span class="keyword">where</span> a.id=b.aid) another_field <span class="keyword">from</span> a <span class="keyword">where</span> <span class="number">1</span> <span class="keyword">limit</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>下面还是以实例来说明，要不然不好理解，新建两张表，一张是商品表，另外一张是商品的评论表</p>
<p>商品表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`product`</span> (</span><br><span class="line"> <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"> <span class="string">`product_name`</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> <span class="string">`price`</span> <span class="built_in">float</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure>
<p>评论表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`comment`</span> (</span><br><span class="line"> <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"> <span class="string">`entity_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> <span class="string">`content`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure>
<p>然后插入一些数据：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="symbol">`product`</span> (<span class="symbol">`id`</span>, <span class="symbol">`product_name`</span>, <span class="symbol">`price`</span>) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">'肉松饼'</span>, <span class="number">5</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">'可乐'</span>, <span class="number">5</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">'鸡翅'</span>, <span class="number">12</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">'杯子'</span>, <span class="number">42</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="symbol">`comment`</span> (<span class="symbol">`id`</span>, <span class="symbol">`entity_id`</span>, <span class="symbol">`content`</span>) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>, <span class="string">'味道还不错'</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="number">1</span>, <span class="string">'还行啊'</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="number">3</span>, <span class="string">'很实用哦'</span>);</span><br></pre></td></tr></table></figure>
<p>下面我们用子查询的方式来查出商品的信息以及每个商品的评论数量</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product.*,(<span class="keyword">select</span> <span class="built_in">count</span>(comment.id) <span class="keyword">from</span> comment <span class="keyword">where</span> product.id=comment.entity_id) comment_count <span class="keyword">FROM</span> <span class="symbol">`product`</span> <span class="keyword">limit</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<p>查询结果如下：</p>
<p><a href="http://www.zjj.com/phpmyadmin/sql.php?db=test&amp;table=product&amp;sql_query=SELECT+product.%2A%2C%28select+count%28comment.id%29+from+comment+where+product.id%3Dcomment.entity_id%29+comment_count+FROM+%60product%60+ORDER+BY+%60product%60.%60id%60+ASC+limit+5&amp;session_max_rows=30&amp;token=c43efc1718c35c767060bafb6158d147" target="_blank" rel="external">id</a> <a href="http://www.zjj.com/phpmyadmin/sql.php?db=test&amp;table=product&amp;sql_query=SELECT+product.%2A%2C%28select+count%28comment.id%29+from+comment+where+product.id%3Dcomment.entity_id%29+comment_count+FROM+%60product%60+ORDER+BY+%60product%60.%60product_name%60+ASC+limit+5&amp;session_max_rows=30&amp;token=c43efc1718c35c767060bafb6158d147" target="_blank" rel="external">product_name</a> <a href="http://www.zjj.com/phpmyadmin/sql.php?db=test&amp;table=product&amp;sql_query=SELECT+product.%2A%2C%28select+count%28comment.id%29+from+comment+where+product.id%3Dcomment.entity_id%29+comment_count+FROM+%60product%60+ORDER+BY+%60product%60.%60price%60+ASC+limit+5&amp;session_max_rows=30&amp;token=c43efc1718c35c767060bafb6158d147" target="_blank" rel="external">price</a> <a href="http://www.zjj.com/phpmyadmin/sql.php?db=test&amp;table=product&amp;sql_query=SELECT+product.%2A%2C%28select+count%28comment.id%29+from+comment+where+product.id%3Dcomment.entity_id%29+comment_count+FROM+%60product%60+ORDER+BY+%60comment_count%60+ASC+limit+5&amp;session_max_rows=30&amp;token=c43efc1718c35c767060bafb6158d147" target="_blank" rel="external">comment_count</a></p>
<p>1 肉松饼 5  2</p>
<p>2 可乐 5  0</p>
<p>3 鸡翅 12  1</p>
<p>4 杯子 42  0</p>
<p><strong>对于这种查询，可以分成两部来理解，首先忽略整个select子查询，查出商品表中的数据，然后根据商品的id执行子查询，对于一个商品id,子查询只能返回一条数据，如果子查询返回多条数据则会出错，另外，每一条select子查询只能查询一个字段。</strong></p>
<p>另外的列子，查出每个商品信息以及商品的最新评论内容：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product.*,(<span class="keyword">select</span> comment.content <span class="keyword">from</span> comment <span class="keyword">where</span> product.id=comment.entity_id <span class="keyword">order</span> <span class="keyword">by</span> comment.id <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1</span>) comment_count <span class="keyword">FROM</span> <span class="symbol">`product`</span> <span class="keyword">limit</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<p>查询结果如下：</p>
<p><a href="http://www.zjj.com/phpmyadmin/sql.php?db=test&amp;table=product&amp;sql_query=SELECT+product.%2A%2C%28select+comment.content+from+comment+where+product.id%3Dcomment.entity_id+limit+1+%29last_comment+FROM+%60product%60+ORDER+BY+%60product%60.%60id%60+ASC+limit+5&amp;session_max_rows=30&amp;token=c43efc1718c35c767060bafb6158d147" target="_blank" rel="external">id</a> <a href="http://www.zjj.com/phpmyadmin/sql.php?db=test&amp;table=product&amp;sql_query=SELECT+product.%2A%2C%28select+comment.content+from+comment+where+product.id%3Dcomment.entity_id+limit+1+%29last_comment+FROM+%60product%60+ORDER+BY+%60product%60.%60product_name%60+ASC+limit+5&amp;session_max_rows=30&amp;token=c43efc1718c35c767060bafb6158d147" target="_blank" rel="external">product_name</a> <a href="http://www.zjj.com/phpmyadmin/sql.php?db=test&amp;table=product&amp;sql_query=SELECT+product.%2A%2C%28select+comment.content+from+comment+where+product.id%3Dcomment.entity_id+limit+1+%29last_comment+FROM+%60product%60+ORDER+BY+%60product%60.%60price%60+ASC+limit+5&amp;session_max_rows=30&amp;token=c43efc1718c35c767060bafb6158d147" target="_blank" rel="external">price</a> <a href="http://www.zjj.com/phpmyadmin/sql.php?db=test&amp;table=product&amp;sql_query=SELECT+product.%2A%2C%28select+comment.content+from+comment+where+product.id%3Dcomment.entity_id+limit+1+%29last_comment+FROM+%60product%60+ORDER+BY+%60last_comment%60+ASC+limit+5&amp;session_max_rows=30&amp;token=c43efc1718c35c767060bafb6158d147" target="_blank" rel="external">last_comment</a></p>
<p>1 肉松饼 5  还行啊</p>
<p>2 可乐 5  <em>NULL</em></p>
<p>3 鸡翅 12  很实用哦</p>
<p>4 杯子 42  <em>NULL</em></p>
<h1 id="示例二-billing"><a href="#示例二-billing" class="headerlink" title="示例二 billing"></a>示例二 billing</h1><p>分两步看，</p>
<ol>
<li>不看字查询bi.id not in () , 相当于查询出所有的status为1的id，和记录</li>
</ol>
<ol>
<li>SELECT substring_index(group_concat(id ORDER BY product_start_time desc) , ‘,’ , 1)<br>​                                    FROM cash_billing_item<br>​                                    WHERE status = 1<br>​                                    GROUP BY product_no, customer_no</li>
</ol>
<p>SELECT SUBSTRING_INDEX(‘15,151,152,16’,’,’,1); ==&gt;得到结果为： 15</p>
<p>然后每一条记录的bi.product_no 和bi.customer_no，分别和select的结果比较</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> bi.id</span><br><span class="line"><span class="keyword">FROM</span> cash_billing_item bi</span><br><span class="line"><span class="keyword">WHERE</span> bi.id <span class="keyword">and</span> bi.status = <span class="number">1</span> <span class="keyword">and</span> bi.id</span><br><span class="line">                                  <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">                                  (</span><br><span class="line">                                    <span class="keyword">SELECT</span> substring_index(<span class="keyword">group_concat</span>(<span class="keyword">id</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> product_start_time <span class="keyword">desc</span>) , <span class="string">','</span> , <span class="number">1</span>)</span><br><span class="line">                                    <span class="keyword">FROM</span> cash_billing_item</span><br><span class="line">                                    <span class="keyword">WHERE</span> product_no = bi.product_no <span class="keyword">AND</span> customer_no = bi.customer_no <span class="keyword">and</span> <span class="keyword">status</span> = <span class="number">1</span></span><br><span class="line">                                    <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_no, customer_no</span><br><span class="line">                                  );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">UPDATE</span> cash_billing_item bi,</span><br><span class="line">          (</span><br><span class="line">            <span class="keyword">SELECT</span> bi.id</span><br><span class="line">            <span class="keyword">FROM</span> cash_billing_item bi</span><br><span class="line">            <span class="keyword">WHERE</span> bi.id <span class="keyword">and</span> bi.status = <span class="number">1</span> <span class="keyword">and</span> bi.id</span><br><span class="line">                            <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">                            (</span><br><span class="line">                              <span class="keyword">SELECT</span> <span class="keyword">group_concat</span>(<span class="keyword">id</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> product_start_time <span class="keyword">desc</span>)</span><br><span class="line">                              <span class="keyword">FROM</span> cash_billing_item</span><br><span class="line">                              <span class="keyword">WHERE</span> product_no = bi.product_no <span class="keyword">AND</span> customer_no = bi.customer_no</span><br><span class="line">                                <span class="keyword">and</span> <span class="keyword">status</span> = <span class="number">1</span></span><br><span class="line">                              <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_no, customer_no</span><br><span class="line">                            )</span><br><span class="line">          ) temp</span><br><span class="line">        <span class="keyword">SET</span> bi.status = <span class="number">2</span></span><br><span class="line">        <span class="keyword">WHERE</span> bi.id = temp.id;</span><br></pre></td></tr></table></figure>
<p><strong>cash_billing_item_copy</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> cash_billing_item_copy</span><br><span class="line">(</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">bigint</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> auto_increment <span class="keyword">comment</span> <span class="string">'自增id'</span></span><br><span class="line">    primary <span class="keyword">key</span>,</span><br><span class="line">  customer_no <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'客户编号'</span>,</span><br><span class="line">  product_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'产品表pk'</span>,</span><br><span class="line">  product_start_time <span class="keyword">timestamp</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'产品生效时间'</span>,</span><br><span class="line">  gmt_create <span class="keyword">timestamp</span> <span class="keyword">default</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  gmt_modify <span class="keyword">timestamp</span> <span class="keyword">default</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'修改时间'</span></span><br><span class="line">)</span><br><span class="line">  <span class="keyword">comment</span> <span class="string">'从账务系统推来的计费项'</span></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> cash_billing_item_copy (customer_no, product_id, product_start_time) <span class="keyword">VALUES</span></span><br><span class="line">  (<span class="string">'ct2'</span>,<span class="number">1</span>,<span class="string">'2017-12-27 00:00:00'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> cash_billing_item_copy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span>  <span class="keyword">group_concat</span>(<span class="keyword">id</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> product_start_time <span class="keyword">DESC</span>), customer_no , product_id</span><br><span class="line"><span class="keyword">FROM</span> cash_billing_item_copy</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> customer_no  , product_id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> c.id</span><br><span class="line"></span><br><span class="line">  <span class="keyword">FROM</span> cash_billing_item_copy c</span><br><span class="line"><span class="keyword">WHERE</span> c.id <span class="keyword">AND</span> c.id <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">               (</span><br><span class="line">                 <span class="keyword">SELECT</span></span><br><span class="line">                   substring_index(<span class="keyword">group_concat</span>(<span class="keyword">id</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> product_start_time <span class="keyword">DESC</span>), <span class="string">','</span>, <span class="number">1</span>)</span><br><span class="line">                 <span class="keyword">FROM</span> cash_billing_item_copy</span><br><span class="line">                 <span class="keyword">GROUP</span> <span class="keyword">BY</span> customer_no, product_id</span><br><span class="line">               );</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTRING_INDEX(<span class="string">'15,151,152,16'</span>,<span class="string">','</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2017/12/27/React生命周期/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/27/React生命周期/" itemprop="url">React生命周期</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-27T18:13:26+08:00">
                2017-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/27/React生命周期/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/27/React生命周期/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>学习React，生命周期很重要，我们了解完生命周期的各个组件，对写高性能组件会有很大的帮助.</p>
<h3 id="Ract生命周期"><a href="#Ract生命周期" class="headerlink" title="Ract生命周期"></a>Ract生命周期</h3><p>React 生命周期分为三种状态 1. 初始化 2.更新 3.销毁</p>
<p><img src="http://images2015.cnblogs.com/blog/588767/201612/588767-20161205190022429-1074951616.jpg" alt="img"></p>
<ul>
<li><strong>初始化</strong></li>
</ul>
<p><em>1、getDefaultProps()</em></p>
<blockquote>
<p>设置默认的props，也可以用dufaultProps设置组件的默认属性.</p>
</blockquote>
<p><em>2、getInitialState()</em></p>
<blockquote>
<p>在使用es6的class语法时是没有这个钩子函数的，可以直接在constructor中定义this.state。此时可以访问this.props</p>
</blockquote>
<p><em>3、componentWillMount()</em></p>
<blockquote>
<p>组件初始化时只调用，以后组件更新不调用，整个生命周期只调用一次，此时可以修改state。</p>
</blockquote>
<p><em>4、 render()</em></p>
<blockquote>
<p>react最重要的步骤，创建虚拟dom，进行diff算法，更新dom树都在此进行。此时就不能更改state了。</p>
</blockquote>
<p><em>5、componentDidMount()</em></p>
<blockquote>
<p>组件渲染之后调用，只调用一次。</p>
</blockquote>
<ul>
<li><strong>更新</strong></li>
</ul>
<p><em>6、componentWillReceiveProps(nextProps)</em></p>
<blockquote>
<p>组件初始化时不调用，组件接受新的props时调用。</p>
</blockquote>
<p><em>7、shouldComponentUpdate(nextProps, nextState)</em></p>
<blockquote>
<p>react性能优化非常重要的一环。组件接受新的state或者props时调用，我们可以设置在此对比前后两个props和state是否相同，如果相同则返回false阻止更新，因为相同的属性状态一定会生成相同的dom树，这样就不需要创造新的dom树和旧的dom树进行diff算法对比，节省大量性能，尤其是在dom结构复杂的时候</p>
</blockquote>
<p><em>8、componentWillUpdata(nextProps, nextState)</em></p>
<blockquote>
<p>组件初始化时不调用，只有在组件将要更新时才调用，此时可以修改state</p>
</blockquote>
<p><em>9、render()</em></p>
<blockquote>
<p>组件渲染</p>
</blockquote>
<p><em>10、componentDidUpdate()</em></p>
<blockquote>
<p>组件初始化时不调用，组件更新完成后调用，此时可以获取dom节点。</p>
</blockquote>
<ul>
<li><strong>卸载</strong></li>
</ul>
<p><em>11、componentWillUnmount()</em></p>
<blockquote>
<p>组件将要卸载时调用，一些事件监听和定时器需要在此时清除。</p>
</blockquote>
<h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h3><p>以上就是React 的生命周期，大家可以自行写下code测试一下，在这里我就不贴code 了。</p>
<p><strong>下面所写的，只适合前端的React。（React也支持后端渲染，而且和前端有点小区别，不过我没用过。）</strong></p>
<h1 id="相关函数"><a href="#相关函数" class="headerlink" title="相关函数"></a>相关函数</h1><p>简单地说，React Component通过其定义的几个函数来控制组件在生命周期的各个阶段的动作。</p>
<p>在ES6中，一个React组件是用一个class来表示的（具体可以参考<a href="https://link.jianshu.com?t=http://facebook.github.io/react/docs/reusable-components.html#es6-classes" target="_blank" rel="external">官方文档</a>），如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个TodoList的React组件，通过继承React.Component来实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这几个生命周期相关的函数有：</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">constructor</span><span class="params">(props, context)</span></span></span><br></pre></td></tr></table></figure>
<p>构造函数，在创建组件的时候调用一次。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> componentWillMount()</span><br></pre></td></tr></table></figure>
<p>在组件挂载之前调用一次。如果在这个函数里面调用setState，本次的render函数可以看到更新后的state，并且只渲染一次。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> componentDidMount()</span><br></pre></td></tr></table></figure>
<p>在组件挂载之后调用一次。这个时候，子主键也都挂载好了，可以在这里使用refs。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void componentWillReceiveProps(<span class="name">nextProps</span>)</span><br></pre></td></tr></table></figure>
<p>props是父组件传递给子组件的。父组件发生render的时候子组件就会调用componentWillReceiveProps（不管props有没有更新，也不管父子组件之间有没有数据交换）。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool shouldComponentUpdate(<span class="name">nextProps</span>, nextState)</span><br></pre></td></tr></table></figure>
<p>组件挂载之后，每次调用setState后都会调用shouldComponentUpdate判断是否需要重新渲染组件。默认返回true，需要重新render。在比较复杂的应用里，有一些数据的改变并不影响界面展示，可以在这里做判断，优化渲染效率。</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void componentWillUpdate(<span class="name">nextProps</span>, nextState)</span><br></pre></td></tr></table></figure>
<p>shouldComponentUpdate返回true或者调用forceUpdate之后，componentWillUpdate会被调用。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> componentDidUpdate()</span><br></pre></td></tr></table></figure>
<p>除了首次render之后调用componentDidMount，其它render结束之后都是调用componentDidUpdate。</p>
<p>componentWillMount、componentDidMount和componentWillUpdate、componentDidUpdate可以对应起来。区别在于，前者只有在挂载的时候会被调用；而后者在以后的每次更新渲染之后都会被调用。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ReactElement</span> <span class="selector-tag">render</span>()</span><br></pre></td></tr></table></figure>
<p>render是一个React组件所必不可少的核心函数（上面的其它函数都不是必须的）。记住，不要在render里面修改state。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> componentWillUnmount()</span><br></pre></td></tr></table></figure>
<p>组件被卸载的时候调用。一般在componentDidMount里面注册的事件需要在这里删除。</p>
<h1 id="更新方式"><a href="#更新方式" class="headerlink" title="更新方式"></a>更新方式</h1><p>在react中，触发render的有4条路径。</p>
<p><strong>以下假设shouldComponentUpdate都是按照默认返回true的方式。</strong></p>
<ol>
<li>首次渲染Initial Render</li>
<li>调用this.setState （并不是一次setState会触发一次render，React可能会合并操作，再一次性进行render）</li>
<li>父组件发生更新（一般就是props发生改变，但是就算props没有改变或者父子组件之间没有数据交换也会触发render）</li>
<li>调用this.forceUpdate</li>
</ol>
<p>下面是我对React组件四条更新路径地总结：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1814354-4bf62e54553a32b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="img"></p>
<p>React组件更新路径.png</p>
<p>注意，如果在shouldComponentUpdate里面返回false可以提前退出更新路径。</p>
<h1 id="一个React组件生命周期的测试例子"><a href="#一个React组件生命周期的测试例子" class="headerlink" title="一个React组件生命周期的测试例子"></a>一个React组件生命周期的测试例子</h1><p>代码比较简单，没有逻辑，只是在每个相关函数里面alert一下。</p><h1><a href="https://link.jianshu.com?t=http://wximg.gtimg.com/shake_tv/test/lifeCycle2113.html" target="_blank" rel="external">点击链接</a>来试试这个例子。</h1><br>源码：<p></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LifeCycle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        alert(<span class="string">"Initial render"</span>);</span><br><span class="line">        alert(<span class="string">"constructor"</span>);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;<span class="attr">str</span>: <span class="string">"hello"</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        alert(<span class="string">"componentWillMount"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        alert(<span class="string">"componentDidMount"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">        alert(<span class="string">"componentWillReceiveProps"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    shouldComponentUpdate() &#123;</span><br><span class="line">        alert(<span class="string">"shouldComponentUpdate"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;        <span class="comment">// 记得要返回true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillUpdate() &#123;</span><br><span class="line">        alert(<span class="string">"componentWillUpdate"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidUpdate() &#123;</span><br><span class="line">        alert(<span class="string">"componentDidUpdate"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        alert(<span class="string">"componentWillUnmount"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setTheState() &#123;</span><br><span class="line">        <span class="keyword">let</span> s = <span class="string">"hello"</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.state.str === s) &#123;</span><br><span class="line">            s = <span class="string">"HELLO"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            str: s</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    forceItUpdate() &#123;</span><br><span class="line">        <span class="keyword">this</span>.forceUpdate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        alert(<span class="string">"render"</span>);</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;span&gt;&#123;<span class="string">"Props:"</span>&#125;&lt;h2&gt;&#123;<span class="built_in">parseInt</span>(<span class="keyword">this</span>.props.num)&#125;&lt;<span class="regexp">/h2&gt;&lt;/</span>span&gt;</span><br><span class="line">                &lt;br /&gt;</span><br><span class="line">                &lt;span&gt;&#123;<span class="string">"State:"</span>&#125;&lt;h2&gt;&#123;<span class="keyword">this</span>.state.str&#125;&lt;<span class="regexp">/h2&gt;&lt;/</span>span&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">class Container  extends React.Component &#123;</span></span><br><span class="line"><span class="regexp">    constructor(props) &#123;</span></span><br><span class="line"><span class="regexp">        super(props);</span></span><br><span class="line"><span class="regexp">        this.state = &#123;</span></span><br><span class="line"><span class="regexp">            num: Math.random() * 100</span></span><br><span class="line"><span class="regexp">        &#125;;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    propsChange() &#123;</span></span><br><span class="line"><span class="regexp">        this.setState(&#123;</span></span><br><span class="line"><span class="regexp">            num: Math.random() * 100</span></span><br><span class="line"><span class="regexp">        &#125;);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    setLifeCycleState() &#123;</span></span><br><span class="line"><span class="regexp">        this.refs.rLifeCycle.setTheState();</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    forceLifeCycleUpdate() &#123;</span></span><br><span class="line"><span class="regexp">        this.refs.rLifeCycle.forceItUpdate();</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    unmountLifeCycle() &#123;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/ 这里卸载父组件也会导致卸载子组件</span></span><br><span class="line"><span class="regexp">        React.unmountComponentAtNode(document.getElementById("container"));</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    parentForceUpdate() &#123;</span></span><br><span class="line"><span class="regexp">        this.forceUpdate();</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    render() &#123;</span></span><br><span class="line"><span class="regexp">        return (</span></span><br><span class="line"><span class="regexp">            &lt;div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;a href="javascript:;" className="weui_btn weui_btn_primary" onClick=&#123;this.propsChange.bind(this)&#125;&gt;propsChange&lt;/</span>a&gt;</span><br><span class="line">                &lt;a href=<span class="string">"javascript:;"</span> className=<span class="string">"weui_btn weui_btn_primary"</span> onClick=&#123;<span class="keyword">this</span>.setLifeCycleState.bind(<span class="keyword">this</span>)&#125;&gt;setState&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">                &lt;a href="javascript:;" className="weui_btn weui_btn_primary" onClick=&#123;this.forceLifeCycleUpdate.bind(this)&#125;&gt;forceUpdate&lt;/</span>a&gt;</span><br><span class="line">                &lt;a href=<span class="string">"javascript:;"</span> className=<span class="string">"weui_btn weui_btn_primary"</span> onClick=&#123;<span class="keyword">this</span>.unmountLifeCycle.bind(<span class="keyword">this</span>)&#125;&gt;unmount&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">                &lt;a href="javascript:;" className="weui_btn weui_btn_primary" onClick=&#123;this.parentForceUpdate.bind(this)&#125;&gt;parentForceUpdateWithoutChange&lt;/</span>a&gt;</span><br><span class="line">                &lt;LifeCycle ref=<span class="string">"rLifeCycle"</span> num=&#123;<span class="keyword">this</span>.state.num&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">LifeCycle</span>&gt;</span></span></span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDom.render(</span></span><br><span class="line"><span class="regexp">    &lt;Container&gt;&lt;/</span>Container&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'container'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2017/12/23/前端指南-react快速开发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/23/前端指南-react快速开发/" itemprop="url">前端指南-react快速开发</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-23T17:20:14+08:00">
                2017-12-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/23/前端指南-react快速开发/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/23/前端指南-react快速开发/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  507
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="React项目开发"><a href="#React项目开发" class="headerlink" title="React项目开发"></a>React项目开发</h1><h2 id="通过-npm-使用-React"><a href="#通过-npm-使用-React" class="headerlink" title="通过 npm 使用 React"></a>通过 npm 使用 React</h2><p>如果你的系统还不支持 Node.js 及 NPM 可以参考我们的 <a href="http://www.runoob.com/nodejs/nodejs-tutorial.html" target="_blank" rel="external">Node.js 教程</a>。</p>
<p>我们建议在 React 中使用 CommonJS 模块系统，比如 browserify 或 webpack，本教程使用 webpack。</p>
<p>国内使用 npm 速度很慢，你可以使用淘宝定制的 cnpm (gzip 压缩支持) 命令行工具代替默认的 npm:</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span> npm install -g cnpm --registry=https:<span class="comment">//registry.npm.taobao.org</span></span><br><span class="line"><span class="symbol">$</span> npm config <span class="keyword">set</span> registry <span class="comment">https:</span>//<span class="comment">registry.npm.taobao.org</span></span><br></pre></td></tr></table></figure>
<p>这样就可以使用 cnpm 命令来安装模块了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cnpm install [name]</span></span><br></pre></td></tr></table></figure>
<p>更多信息可以查阅：<a href="http://npm.taobao.org/" target="_blank" rel="external">http://npm.taobao.org/</a>。</p>
<hr>
<h2 id="使用-create-react-app-快速构建-React-开发环境"><a href="#使用-create-react-app-快速构建-React-开发环境" class="headerlink" title="使用 create-react-app 快速构建 React 开发环境"></a>使用 create-react-app 快速构建 React 开发环境</h2><p>create-react-app 是来自于 Facebook，通过该命令我们无需配置就能快速构建 React 开发环境。</p>
<p>create-react-app 自动创建的项目是基于 Webpack + ES6 。</p>
<p>执行以下命令创建项目：</p>
<figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="string">cnpm </span><span class="string">install </span>-g <span class="built_in">create-react-app</span></span><br><span class="line"><span class="built_in">$</span> <span class="built_in">create-react-app</span> <span class="string">my-app</span></span><br><span class="line"><span class="string">$</span> <span class="string">cd </span><span class="string">my-app/</span></span><br><span class="line">$ <span class="string">npm </span><span class="string">start</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">yarn </span><span class="string">start</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">yarn </span><span class="string">build</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  yarn <span class="keyword">start</span></span><br><span class="line">    Starts the development server.</span><br><span class="line"></span><br><span class="line">  yarn <span class="keyword">build</span></span><br><span class="line">    Bundles the app <span class="keyword">into</span> <span class="keyword">static</span> files <span class="keyword">for</span> production.</span><br><span class="line"></span><br><span class="line">  yarn <span class="keyword">test</span></span><br><span class="line">    Starts the <span class="keyword">test</span> runner.</span><br><span class="line"></span><br><span class="line">  yarn eject</span><br><span class="line">    Removes this tool <span class="keyword">and</span> copies <span class="keyword">build</span> dependencies, configuration files</span><br><span class="line">    <span class="keyword">and</span> scripts <span class="keyword">into</span> the app directory. <span class="keyword">If</span> you <span class="keyword">do</span> this, you can’t <span class="keyword">go</span> back!</span><br><span class="line"></span><br><span class="line">We suggest that you <span class="keyword">begin</span> <span class="keyword">by</span> typing:</span><br><span class="line"></span><br><span class="line">  cd billing-monitor-web</span><br><span class="line">  yarn <span class="keyword">start</span></span><br></pre></td></tr></table></figure>
<h1 id="使用yarn构建前端"><a href="#使用yarn构建前端" class="headerlink" title="使用yarn构建前端"></a>使用yarn构建前端</h1><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3425</span>  npm install yarn -g  <span class="comment">//全局安装yarn,不在package.json文件</span></span><br><span class="line"><span class="number">3426</span>  ls</span><br><span class="line"><span class="number">3427</span>  yarn add serve -g <span class="comment">//全局安装serve,有个服务容器</span></span><br><span class="line"><span class="number">3428</span>  lsysq</span><br><span class="line"><span class="number">3429</span>  yarn start <span class="comment">//启动项目</span></span><br><span class="line">yarn build 构建前端</span><br></pre></td></tr></table></figure>
<h1 id="node项目开发"><a href="#node项目开发" class="headerlink" title="node项目开发"></a>node项目开发</h1><p>##进入工程目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;project_path&#125;</span></span><br></pre></td></tr></table></figure>
<p>##从git中获取最新代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git pull</span><br><span class="line">git checkout $&#123;tag_name&#125;</span><br></pre></td></tr></table></figure>
<p>##运行npm install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>
<h2 id="查看pm2进程id"><a href="#查看pm2进程id" class="headerlink" title="查看pm2进程id"></a>查看pm2进程id</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 list</span><br></pre></td></tr></table></figure>
<ol>
<li><p>停止原服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 delete <span class="variable">$&#123;pm2_ID&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务</p>
<ol>
<li><p>切换NODE_VERSION</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use <span class="variable">$&#123;node_version&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=<span class="variable">$&#123;env&#125;</span> pm2 start <span class="variable">$&#123;main_script&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>检查服务运行情况</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pm2 list <span class="comment">#查看当前所有运行服务</span></span><br><span class="line">pm2 logs <span class="variable">$&#123;pm2_ID&#125;</span> <span class="comment">#查看某服务的日志</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&#123;project_path&#125;: ~/lss_core</span><br><span class="line">$&#123;tag_name&#125;: release-20160705-GATEWAY-40</span><br><span class="line">$&#123;pm2_ID&#125;: // Get by pm2 list</span><br><span class="line">$&#123;node_version&#125;: 0.10.44</span><br><span class="line">$&#123;env&#125;: prod  // dev | test | uat | prod</span><br><span class="line">$&#123;main_script&#125;: lss-core.js</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> xxx —<span class="keyword">save</span></span><br><span class="line">pm2 <span class="keyword">logs</span> <span class="number">39</span></span><br><span class="line">pm2 <span class="keyword">list</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2017/12/20/Linux探究-硬连接与符号连接/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/20/Linux探究-硬连接与符号连接/" itemprop="url">Linux探究-硬连接与符号连接</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-20T10:56:09+08:00">
                2017-12-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/运维/" itemprop="url" rel="index">
                    <span itemprop="name">运维</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/20/Linux探究-硬连接与符号连接/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/20/Linux探究-硬连接与符号连接/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  118
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="创建硬连接"><a href="#创建硬连接" class="headerlink" title="创建硬连接"></a>创建硬连接</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdit aa.txt</span><br><span class="line">vim aa.txt</span><br><span class="line"></span><br><span class="line">ln aa<span class="selector-class">.txt</span> aa-hard</span><br></pre></td></tr></table></figure>
<ul>
<li>注意无论修改aa.txt aa-hard中的任何一个，内容都会同时变化。</li>
<li>删除其中任何一个，另一个还会存在。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看当前目录的字节数</span></span><br><span class="line">du -sb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看iNode会指向同一个</span></span><br><span class="line">ls -i</span><br></pre></td></tr></table></figure>
<h3 id="创建符号连接Symbolic"><a href="#创建符号连接Symbolic" class="headerlink" title="创建符号连接Symbolic"></a>创建符号连接Symbolic</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s aa<span class="selector-class">.txt</span> aa-symbolic</span><br></pre></td></tr></table></figure>
<ul>
<li>注意符号连接如果指向目录，会直接对原目录的内容操作，增删改，要小心。</li>
</ul>
<p>###</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2017/12/19/Tomcat解惑-之-CATALINA-HOME与CATALINA-BASE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/19/Tomcat解惑-之-CATALINA-HOME与CATALINA-BASE/" itemprop="url">Tomcat解惑 之 CATALINA_HOME与CATALINA_BASE</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-19T19:46:10+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/tomcat/" itemprop="url" rel="index">
                    <span itemprop="name">tomcat</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/19/Tomcat解惑-之-CATALINA-HOME与CATALINA-BASE/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/19/Tomcat解惑-之-CATALINA-HOME与CATALINA-BASE/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  468
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  2
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>看Tomcat源码一段时间一直很好奇为什么有CATALINA_HOME和CATALINA_BASE区别：</p>
<p>分CATALINA_HOME和CATALINA_BASE概念是为了解决这样的场景：</p>
<p>你需要在一台机器上面部署多个Tomcat实例，但是你又不想创建多个Tomcat的副本，换句话说就是让这些Tomcat副本拥有自己的工作目录但是共享Tomcat的代码。</p>
<p>关于CATALINA_HOME和CATALINA_BASE<a href="https://tomcat.apache.org/tomcat-8.5-doc/introduction.html" target="_blank" rel="external">官方文档</a>上面是这样解释的：</p>
<p><strong>[html]</strong> <a href="http://blog.csdn.net/jiaotuwoaini/article/details/51455829#" target="_blank" rel="external">view plain</a> <a href="http://blog.csdn.net/jiaotuwoaini/article/details/51455829#" target="_blank" rel="external">copy</a></p>
<ol>
<li>Throughout the docs, you’ll notice there are numerous references to $CATALINA_HOME. This represents the root of your Tomcat installation. When we say, “This information can be found in your $CATALINA_HOME/README.txt file” we mean to look at the README.txt file at the root of your Tomcat install. Optionally, Tomcat may be configured for multiple instances by defining $CATALINA_BASE for each instance. If multiple instances are not configured, $CATALINA_BASE is the same as $CATALINA_HOME.</li>
</ol>
<p>翻译过来就是<strong>CATALINA_HOME是Tomcat的安装目录，CATALINA_BASE是Tomcat的工作目录</strong></p>
<p>CATALINA_BASE是和每个Tomcat实例相关的，接下来我们来一起玩一下上面描述的那个场景</p>
<p>描述:<br>CATALINA_HOME是Tomcat的安装目录，CATALINA_BASE是Tomcat的工作目录<br>作用:<br>通过多工作目录(CATALINA_BASE),单安装目录(CATALINA_HOME). 可实现每个应用共用一个tomcat但不入侵安装目录,可以分别配置.</p>
<p>先下一个Tomcat的zip发布版本可以在这里下载：<a href="http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.69/bin/" target="_blank" rel="external">http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.69/bin/</a></p>
<p>解压到F盘，然后新建两个目录 分别为tomcat ins1和tomcat ins2</p>
<p><img src="http://img.blog.csdn.net/20160519181326484" alt="img"></p>
<p>把Tomcat的共享文件夹分别拷贝到tomcat ins1和tomcat ins2中，有</p>
<p><img src="http://img.blog.csdn.net/20160519181516597" alt="img"></p>
<p>然后在<img src="http://blog.csdn.net/jiaotuwoaini/article/details/51455829" alt="img"></p>
<p>然后在tomcat ins1的文件夹下创建startup.bat</p>
<p>文件内容如下：</p>
<p><strong>[plain]</strong> <a href="http://blog.csdn.net/jiaotuwoaini/article/details/51455829#" target="_blank" rel="external">view plain</a> <a href="http://blog.csdn.net/jiaotuwoaini/article/details/51455829#" target="_blank" rel="external">copy</a></p>
<ol>
<li>set “CATALINA_BASE=%cd%”</li>
<li>set “CATALINA_HOME=F:\apache-tomcat-7.0.69”</li>
<li>set “EXECUTABLE=%CATALINA_HOME%\bin\catalina.bat”<br>4.<br>5.</li>
<li>call “%EXECUTABLE%” start</li>
</ol>
<p>然后我们可以在tomcat ins1下的conf中的server.xml中修改http端口号分别为7070</p>
<p>tomcat ins2的做法和tomcat ins1一样只不过端口号改为9090</p>
<p>分别双击startup.bat</p>
<p>然后访问Tomcat你会看到：</p>
<p><img src="http://img.blog.csdn.net/20160519182041179" alt="img"></p>
<p><img src="http://img.blog.csdn.net/20160519182046181" alt="img"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2017/12/19/精细化JVM应用性能剖析工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/19/精细化JVM应用性能剖析工具/" itemprop="url">精细化JVM应用性能剖析工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-19T16:07:31+08:00">
                2017-12-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/线上故障排查/" itemprop="url" rel="index">
                    <span itemprop="name">线上故障排查</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/19/精细化JVM应用性能剖析工具/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/19/精细化JVM应用性能剖析工具/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="何为精细化？"><a href="#何为精细化？" class="headerlink" title="何为精细化？"></a>何为精细化？</h3><p>长期以来各个业务线开发饱受性能问题的困扰。</p>
<p>从反馈和观察来看，我们面临下面一系列的问题：</p>
<ul>
<li>不清楚应用的运行情况，包括但不限于GC情况、热点代码、线程、异常（特别是被吞没的异常）；</li>
<li>不清楚应用代码执行情况，甚至不知道某个模块是否还可能会运行，尤其是对于有着一定历史的应用，可能已经有很多开发在上面贡献过代码，但随着业务发展这些功能可能已经不再被使用；</li>
<li>不清楚应用的IO情况，注意，这里说的绝对不仅仅是zabbix上的”磁盘IO”，而是具体到某个文件、某个端口、某个线程的IO情况；</li>
</ul>
<p>这些问题导致的直接后果就是：对于性能优化，无从下手，只能凭经验和直觉去猜测、埋点、优化，当然，最终结果一般就是“<strong>加机器扩容</strong>”。</p>
<p>是时候结束这种粗放野蛮的性能分析调优了！</p>
<p>值得高兴的是现在所有的JDK7以上版本已经内置了一款新型的性能剖析工具，也就是今天要重点介绍的－Java Flight Recorder，简称JFR。</p>
<h3 id="JFR究竟是什么？"><a href="#JFR究竟是什么？" class="headerlink" title="JFR究竟是什么？"></a>JFR究竟是什么？</h3><p>Java Flight Recorder（JFR）本来是一个商业特性，用在生产服务器上是需要商业许可（这其实是废话，因为现在不需要许可也可以直接用）。</p>
<p>JFR 记录了关于 Java 运行时及运行在其内的 Java 应用程序的详细信息，记录用少量的开销完成。数据是作为时间上的数据点（称为事件）记录的。典型的事件可以是线程等待锁、GC、CPU 周期使用数据等。</p>
<p>在创建飞行记录时，你可以选择哪些事件应当保存，这叫做记录模板。有些模板只保存基本事件，对性能几乎没有影响。其他模板可能有轻微的性能开销，还可能触发 GC 来收集更多信息。通常，超过百分之几的开销是很罕见。飞行记录可用于调试很大范围的问题，从性能问题到内存泄漏或严重的锁竞争。</p>
<p>注意，JFR是一个性能数据采集工具，它把最终采集到的数据存在一个格式为jfr的文件中，由于本身并不具备数据分析或者可视化功能，所以一般我们需要配合JDK另外一个内置工具，即JMC一起使用。</p>
<h3 id="JMC又是什么？"><a href="#JMC又是什么？" class="headerlink" title="JMC又是什么？"></a>JMC又是什么？</h3><p>它是在 JAVA 7u40 发布中加入的图形化性能监控工具，它可以直接打开由jfr生成的原始数据采集文件，</p>
<p>请在自己机器的命令行输入 jmc 来体验。</p>
<h3 id="相比其它Profile工具有什么优点？"><a href="#相比其它Profile工具有什么优点？" class="headerlink" title="相比其它Profile工具有什么优点？"></a>相比其它Profile工具有什么优点？</h3><p>在开发环境中，我们用VisualVM、JProfiler等，功能强大，支持图形化界面操作，可以很快定位代码问题。</p>
<p>但是他们对应用性能的影响也非常大，所以不适合在生产环境下使用。还有这些软件要attach到jvm进程上，生产环境一般网络隔离，很难做到。</p>
<p>在生产环境我们最常用的profiling工具就是java/bin下的jstack，多做几次jstack，也相当于profiling了。</p>
<p>jstack方便易用，但并不是特别适合来做profiling，操作频率低，会导致safepoint指标急剧增长等等。</p>
<p><strong>重点来了，使用jfr不需要在现有应用上额外添加任何参数、重启进程等，直接在命令行执行即可，实时生效，100%无入侵，且稳定可靠，不影响线上应用运行。</strong></p>
<h3 id="安全性如何？"><a href="#安全性如何？" class="headerlink" title="安全性如何？"></a>安全性如何？</h3><p>由于这个工具可以直接在线上使用，那么它会有安全性问题吗？会造成客户数据泄露吗？</p>
<p>答案是否定的，因为jfr采集的性能数据其实可以看作是JVM本身的元数据而不是业务数据，因此不存在任何安全性问题，可以放心使用。</p>
<h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><p>看了以上这么多理（废）论（话）相信各位已经跃跃欲试，那么，JFR该如何使用？很简单，按照下面三个步骤操作；</p>
<ul>
<li><p>选定一台机器，登陆上去，并找到要监控的进程PID</p>
</li>
<li><p>将附件文件(tongdun.jfc)放入到 /usr/install/java/jdk1.8.0_60/jre/lib/jfr 目录，注意，这个配置文件是在官方配置上增加了对异常数据的采集。推荐使用。</p>
</li>
<li><p>执行下列命令，其中<pid>请自行替换：</pid></p>
</li>
<li><p>这样就好了，如上，等待2分钟＋20秒，/tmp/pid.jfr文件就生成好了，这个文件直接导入JMC工具即可</p>
</li>
</ul>
<h3 id="JMC信息"><a href="#JMC信息" class="headerlink" title="JMC信息"></a>JMC信息</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhouxiaowu.coding.me/2017/12/18/intelliJ-远程调试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="周小伍 Joey">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/xiaowu_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiaowu's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/18/intelliJ-远程调试/" itemprop="url">intelliJ 远程调试</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-18T19:10:15+08:00">
                2017-12-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/线上故障排查/" itemprop="url" rel="index">
                    <span itemprop="name">线上故障排查</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/18/intelliJ-远程调试/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/18/intelliJ-远程调试/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  206
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>查看address为9996</li>
</ul>
<figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep java | grep address</span><br></pre></td></tr></table></figure>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin     3052     1 19 19:02 ?        00:02:10 /usr/install/jdk1.8.0_60/bin/java -Djava.util.logging.config.<span class="attribute">file</span>=/home/admin/billing/deploy/tomcat/conf/logging.properties -Djava.util.logging.<span class="attribute">manager</span>=org.apache.juli.ClassLoaderLogManager -server -Xms2g -Xmx2g -XX:<span class="attribute">PermSize</span>=512m -XX:<span class="attribute">SurvivorRatio</span>=2 -XX:+UseParallelOldGC -Dtrace.<span class="attribute">flag</span>=<span class="literal">true</span> -Dtrace.output.<span class="attribute">dir</span>=/home/admin/billing/deploy/trace/ -server -Xdebug -Xnoagent -Djava.<span class="attribute">compiler</span>=NONE -Xrunjdwp:<span class="attribute">transport</span>=dt_socket,address=9996,server=y,suspend=n -Djava.awt.<span class="attribute">headless</span>=<span class="literal">true</span> -Djava.net.<span class="attribute">preferIPv4Stack</span>=<span class="literal">true</span> -Dfile.<span class="attribute">encoding</span>=UTF-8 <span class="attribute">-DdisableIntlRMIStatTask</span>=<span class="literal">true</span> -Ddubbo.application.<span class="attribute">logger</span>=slf4j -Djdk.tls.<span class="attribute">ephemeralDHKeySize</span>=2048 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.<span class="attribute">authenticate</span>=<span class="literal">false</span> -Dcom.sun.management.jmxremote.<span class="attribute">ssl</span>=<span class="literal">false</span> -Djava.rmi.server.<span class="attribute">hostname</span>=10.57.19.253 -Djava.endorsed.<span class="attribute">dirs</span>=/usr/install/tomcat/endorsed -classpath /usr/install/tomcat/bin/bootstrap.jar:/usr/install/tomcat/bin/tomcat-juli.jar -Dcatalina.<span class="attribute">base</span>=/home/admin/billing/deploy/tomcat -Dcatalina.<span class="attribute">home</span>=/usr/install/tomcat -Djava.io.<span class="attribute">tmpdir</span>=/home/admin/billing/deploy/tomcat/temp org.apache.catalina.startup.Bootstrap start</span><br></pre></td></tr></table></figure>
<ul>
<li>查看当前进程远程成功</li>
</ul>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an <span class="string">| grep 9996</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tcp</span>        0      0 10<span class="selector-class">.57</span><span class="selector-class">.19</span><span class="selector-class">.253</span><span class="selector-pseudo">:9996</span>       10<span class="selector-class">.57</span><span class="selector-class">.241</span><span class="selector-class">.56</span><span class="selector-pseudo">:62655</span>      <span class="selector-tag">ESTABLISHED</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/xiaowu_avatar.jpg"
                alt="周小伍 Joey" />
            
              <p class="site-author-name" itemprop="name">周小伍 Joey</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">151</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">42</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">周小伍 Joey</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">279.8k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://joeyblog.disqus.com/count.js" async></script>
    

    

  




	





  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
